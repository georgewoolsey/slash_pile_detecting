<!DOCTYPE html>
<html lang="en-US" xml:lang="en-US">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Section 9 Detection Accuracy | Aerial Imagery and Point Cloud Data for Slash Pile Quantification</title>
  <meta name="description" content="Using the bookdown package to write a book of data exploration. The output format for this example is bookdown::gitbook." />
  <meta name="generator" content="bookdown 0.34 and GitBook 2.6.7" />

  <meta property="og:title" content="Section 9 Detection Accuracy | Aerial Imagery and Point Cloud Data for Slash Pile Quantification" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="Using the bookdown package to write a book of data exploration. The output format for this example is bookdown::gitbook." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Section 9 Detection Accuracy | Aerial Imagery and Point Cloud Data for Slash Pile Quantification" />
  
  <meta name="twitter:description" content="Using the bookdown package to write a book of data exploration. The output format for this example is bookdown::gitbook." />
  

<meta name="author" content="George Woolsey" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="preds_detect.html"/>

<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<link href="libs/htmltools-fill-0.5.9/fill.css" rel="stylesheet" />
<script src="libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/proj4-2.6.2/proj4.min.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.2.2/leaflet.js"></script>
<script src="libs/leaflet-providers-2.0.0/leaflet-providers_2.0.0.js"></script>
<script src="libs/leaflet-providers-plugin-2.2.2/leaflet-providers-plugin.js"></script>
<script src="libs/HomeButton-0.0.1/home-button.js"></script>
<script src="libs/HomeButton-0.0.1/easy-button-src.min.js"></script>
<link href="libs/study sites-CSS-0.0.1/study sites_home-button.css" rel="stylesheet" />
<script src="libs/clipboard-0.0.1/setClipboardText.js"></script>
<link href="libs/mapviewCSS-0.0.1/mapview-popup.css" rel="stylesheet" />
<link href="libs/mapviewCSS-0.0.1/mapview.css" rel="stylesheet" />
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<link href="libs/bsTable-3.3.7/bootstrapTable.min.css" rel="stylesheet" />
<script src="libs/bsTable-3.3.7/bootstrapTable.js"></script>
<script type="text/javascript">

// toggle visibility of R source blocks in R Markdown output
function toggle_R() {
  var x = document.getElementsByClassName('r');
  if (x.length == 0) return;
  function toggle_vis(o) {
    var d = o.style.display;
    o.style.display = (d == 'block' || d == '') ? 'none':'block';
  }

  for (i = 0; i < x.length; i++) {
    var y = x[i];
    if (y.tagName.toLowerCase() === 'pre') toggle_vis(y);
  }

    var elem = document.getElementById("myButton1");
    if (elem.value === "Hide Code") elem.value = "Show Code";
    else elem.value = "Hide Code";
}

document.write('<input onclick="toggle_R();" type="button" value="Hide Code" id="myButton1" style="position: absolute; top: 10%; right: 2%; z-index: 200"></input>')

</script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#objective"><i class="fa fa-check"></i><b>1.1</b> Objective</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#data_desc"><i class="fa fa-check"></i><b>1.2</b> Data and Site Descriptions</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="index.html"><a href="index.html#silvicultural-prescriptions"><i class="fa fa-check"></i><b>1.2.1</b> Silvicultural Prescriptions</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#analysis-plan"><i class="fa fa-check"></i><b>1.3</b> Analysis Plan</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="data_load.html"><a href="data_load.html"><i class="fa fa-check"></i><b>2</b> Data Overview</a>
<ul>
<li class="chapter" data-level="2.1" data-path="data_load.html"><a href="data_load.html#study-units-vector-data"><i class="fa fa-check"></i><b>2.1</b> Study Units Vector Data</a></li>
<li class="chapter" data-level="2.2" data-path="data_load.html"><a href="data_load.html#slash-pile-vector-data"><i class="fa fa-check"></i><b>2.2</b> Slash Pile Vector Data</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="data_load.html"><a href="data_load.html#standardize-pile-data"><i class="fa fa-check"></i><b>2.2.1</b> Standardize Pile Data</a></li>
<li class="chapter" data-level="2.2.2" data-path="data_load.html"><a href="data_load.html#pile-form-measurements"><i class="fa fa-check"></i><b>2.2.2</b> Pile Form Measurements</a></li>
<li class="chapter" data-level="2.2.3" data-path="data_load.html"><a href="data_load.html#image-annotation-comparison"><i class="fa fa-check"></i><b>2.2.3</b> Image-Annotation Comparison</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="data_load.html"><a href="data_load.html#rgb-orthomosaic"><i class="fa fa-check"></i><b>2.3</b> RGB orthomosaic</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="data_load.html"><a href="data_load.html#psinf-mixed-conifer-site-1"><i class="fa fa-check"></i><b>2.3.1</b> PSINF Mixed Conifer Site</a></li>
<li class="chapter" data-level="2.3.2" data-path="data_load.html"><a href="data_load.html#trfo-blm-pinyon-juniper-site-1"><i class="fa fa-check"></i><b>2.3.2</b> TRFO-BLM Pinyon-Juniper Site</a></li>
<li class="chapter" data-level="2.3.3" data-path="data_load.html"><a href="data_load.html#bhef-ponderosa-pine-site-1"><i class="fa fa-check"></i><b>2.3.3</b> BHEF Ponderosa Pine Site</a></li>
<li class="chapter" data-level="2.3.4" data-path="data_load.html"><a href="data_load.html#arnf-ponderosa-pine-site-1"><i class="fa fa-check"></i><b>2.3.4</b> ARNF Ponderosa Pine Site</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="data_load.html"><a href="data_load.html#slash-pile-rgb-imagery"><i class="fa fa-check"></i><b>2.4</b> Slash Pile RGB Imagery</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="data_load.html"><a href="data_load.html#psinf-mixed-conifer-site-2"><i class="fa fa-check"></i><b>2.4.1</b> PSINF Mixed Conifer Site</a></li>
<li class="chapter" data-level="2.4.2" data-path="data_load.html"><a href="data_load.html#trfo-blm-pinyon-juniper-site-2"><i class="fa fa-check"></i><b>2.4.2</b> TRFO-BLM Pinyon-Juniper Site</a></li>
<li class="chapter" data-level="2.4.3" data-path="data_load.html"><a href="data_load.html#bhef-ponderosa-pine-site-2"><i class="fa fa-check"></i><b>2.4.3</b> BHEF Ponderosa Pine Site</a></li>
<li class="chapter" data-level="2.4.4" data-path="data_load.html"><a href="data_load.html#arnf-ponderosa-pine-site-2"><i class="fa fa-check"></i><b>2.4.4</b> ARNF Ponderosa Pine Site</a></li>
<li class="chapter" data-level="2.4.5" data-path="data_load.html"><a href="data_load.html#all"><i class="fa fa-check"></i><b>2.4.5</b> All</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="ptcld_process.html"><a href="ptcld_process.html"><i class="fa fa-check"></i><b>3</b> Point Cloud Processing</a>
<ul>
<li class="chapter" data-level="3.1" data-path="ptcld_process.html"><a href="ptcld_process.html#process-raw-point-cloud"><i class="fa fa-check"></i><b>3.1</b> Process Raw Point Cloud</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="ptcld_process.html"><a href="ptcld_process.html#ptcld_process_psinf"><i class="fa fa-check"></i><b>3.1.1</b> PSINF Mixed Conifer Site</a></li>
<li class="chapter" data-level="3.1.2" data-path="ptcld_process.html"><a href="ptcld_process.html#trfo-blm-pinyon-juniper-site-3"><i class="fa fa-check"></i><b>3.1.2</b> TRFO-BLM Pinyon-Juniper Site</a></li>
<li class="chapter" data-level="3.1.3" data-path="ptcld_process.html"><a href="ptcld_process.html#bhef-ponderosa-pine-site-3"><i class="fa fa-check"></i><b>3.1.3</b> BHEF Ponderosa Pine Site</a></li>
<li class="chapter" data-level="3.1.4" data-path="ptcld_process.html"><a href="ptcld_process.html#arnf-ponderosa-pine-site-3"><i class="fa fa-check"></i><b>3.1.4</b> ARNF Ponderosa Pine Site</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="ptcld_process.html"><a href="ptcld_process.html#clean-up"><i class="fa fa-check"></i><b>3.2</b> Clean Up</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="geom_detect.html"><a href="geom_detect.html"><i class="fa fa-check"></i><b>4</b> Geometry-based Slash Pile Detection</a>
<ul>
<li class="chapter" data-level="4.1" data-path="geom_detect.html"><a href="geom_detect.html#d_area"><i class="fa fa-check"></i><b>4.1</b> Demonstration Area</a></li>
<li class="chapter" data-level="4.2" data-path="geom_detect.html"><a href="geom_detect.html#segmentation-methods"><i class="fa fa-check"></i><b>4.2</b> Segmentation Methods</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="geom_detect.html"><a href="geom_detect.html#seg_methods"><i class="fa fa-check"></i><b>4.2.1</b> Overview of Methods</a></li>
<li class="chapter" data-level="4.2.2" data-path="geom_detect.html"><a href="geom_detect.html#watershed-segmentation-demonstration"><i class="fa fa-check"></i><b>4.2.2</b> Watershed Segmentation Demonstration</a></li>
<li class="chapter" data-level="4.2.3" data-path="geom_detect.html"><a href="geom_detect.html#dbscan-segmentation-demonstration"><i class="fa fa-check"></i><b>4.2.3</b> DBSCAN Segmentation Demonstration</a></li>
<li class="chapter" data-level="4.2.4" data-path="geom_detect.html"><a href="geom_detect.html#comparison-of-candidate-segments"><i class="fa fa-check"></i><b>4.2.4</b> Comparison of Candidate Segments</a></li>
<li class="chapter" data-level="4.2.5" data-path="geom_detect.html"><a href="geom_detect.html#segmentation-function"><i class="fa fa-check"></i><b>4.2.5</b> Segmentation Function</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="geom_detect.html"><a href="geom_detect.html#candidate-shape-refinement-and-area-filtering"><i class="fa fa-check"></i><b>4.3</b> Candidate Shape Refinement and Area filtering</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="geom_detect.html"><a href="geom_detect.html#watershed-segmentation"><i class="fa fa-check"></i><b>4.3.1</b> Watershed Segmentation</a></li>
<li class="chapter" data-level="4.3.2" data-path="geom_detect.html"><a href="geom_detect.html#dbscan-segmentation"><i class="fa fa-check"></i><b>4.3.2</b> DBSCAN Segmentation</a></li>
<li class="chapter" data-level="4.3.3" data-path="geom_detect.html"><a href="geom_detect.html#quick-methods-comparison"><i class="fa fa-check"></i><b>4.3.3</b> Quick methods comparison</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="geom_detect.html"><a href="geom_detect.html#candidate-geometric-filtering"><i class="fa fa-check"></i><b>4.4</b> Candidate Geometric filtering</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="geom_detect.html"><a href="geom_detect.html#shape-irregularity-convexity"><i class="fa fa-check"></i><b>4.4.1</b> Shape Irregularity: Convexity</a></li>
<li class="chapter" data-level="4.4.2" data-path="geom_detect.html"><a href="geom_detect.html#shape-irregularity-circularity"><i class="fa fa-check"></i><b>4.4.2</b> Shape Irregularity: Circularity</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="geom_detect.html"><a href="geom_detect.html#structural-metrics-from-chm"><i class="fa fa-check"></i><b>4.5</b> Structural Metrics from CHM</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="geom_detect.html"><a href="geom_detect.html#structural-rasters"><i class="fa fa-check"></i><b>4.5.1</b> Structural Rasters</a></li>
<li class="chapter" data-level="4.5.2" data-path="geom_detect.html"><a href="geom_detect.html#demonstration-candidate-segment-metrics"><i class="fa fa-check"></i><b>4.5.2</b> Demonstration Candidate Segment Metrics</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="geom_detect.html"><a href="geom_detect.html#final-shape-refinement"><i class="fa fa-check"></i><b>4.6</b> Final Shape Refinement</a>
<ul>
<li class="chapter" data-level="4.6.1" data-path="geom_detect.html"><a href="geom_detect.html#watershed-segmentation-3"><i class="fa fa-check"></i><b>4.6.1</b> Watershed Segmentation</a></li>
<li class="chapter" data-level="4.6.2" data-path="geom_detect.html"><a href="geom_detect.html#dbscan-segmentation-3"><i class="fa fa-check"></i><b>4.6.2</b> DBSCAN Segmentation</a></li>
<li class="chapter" data-level="4.6.3" data-path="geom_detect.html"><a href="geom_detect.html#quick-methods-comparison-2"><i class="fa fa-check"></i><b>4.6.3</b> Quick methods comparison</a></li>
</ul></li>
<li class="chapter" data-level="4.7" data-path="geom_detect.html"><a href="geom_detect.html#slash_pile_detect_fn"><i class="fa fa-check"></i><b>4.7</b> Pile Detection Function</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="data_fusion.html"><a href="data_fusion.html"><i class="fa fa-check"></i><b>5</b> Data Fusion</a>
<ul>
<li class="chapter" data-level="5.1" data-path="data_fusion.html"><a href="data_fusion.html#rgb-indices"><i class="fa fa-check"></i><b>5.1</b> RGB Indices</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="data_fusion.html"><a href="data_fusion.html#spectral-index-functions"><i class="fa fa-check"></i><b>5.1.1</b> Spectral Index Functions</a></li>
<li class="chapter" data-level="5.1.2" data-path="data_fusion.html"><a href="data_fusion.html#spectral-index-of-polygons"><i class="fa fa-check"></i><b>5.1.2</b> Spectral Index of Polygons</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="data_fusion.html"><a href="data_fusion.html#demonstration-pile-spectral-summary"><i class="fa fa-check"></i><b>5.2</b> Demonstration Pile Spectral Summary</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="data_fusion.html"><a href="data_fusion.html#voting-system"><i class="fa fa-check"></i><b>5.2.1</b> Voting System</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="data_fusion.html"><a href="data_fusion.html#polygon_spectral_filtering"><i class="fa fa-check"></i><b>5.3</b> Candidate Polygon Spectral Filtering Function</a></li>
<li class="chapter" data-level="5.4" data-path="data_fusion.html"><a href="data_fusion.html#data-fusion-method-demonstration"><i class="fa fa-check"></i><b>5.4</b> Data Fusion Method Demonstration</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="meth_eval.html"><a href="meth_eval.html"><i class="fa fa-check"></i><b>6</b> Method Evaluation</a>
<ul>
<li class="chapter" data-level="6.1" data-path="meth_eval.html"><a href="meth_eval.html#iou_match"><i class="fa fa-check"></i><b>6.1</b> Instance Matching</a></li>
<li class="chapter" data-level="6.2" data-path="meth_eval.html"><a href="meth_eval.html#detect_metrics_form"><i class="fa fa-check"></i><b>6.2</b> Detection Accuracy Metrics</a></li>
<li class="chapter" data-level="6.3" data-path="meth_eval.html"><a href="meth_eval.html#quant_metrics_form"><i class="fa fa-check"></i><b>6.3</b> Quantification Accuracy Metrics</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="meth_preds.html"><a href="meth_preds.html"><i class="fa fa-check"></i><b>7</b> Method Predictions</a>
<ul>
<li class="chapter" data-level="7.1" data-path="meth_preds.html"><a href="meth_preds.html#size-and-geometric-parameter-settings"><i class="fa fa-check"></i><b>7.1</b> Size and Geometric Parameter Settings</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="meth_preds.html"><a href="meth_preds.html#psinf-mixed-conifer-site-3"><i class="fa fa-check"></i><b>7.1.1</b> PSINF Mixed Conifer Site</a></li>
<li class="chapter" data-level="7.1.2" data-path="meth_preds.html"><a href="meth_preds.html#trfo-blm-pinyon-juniper-site-4"><i class="fa fa-check"></i><b>7.1.2</b> TRFO-BLM Pinyon-Juniper Site</a></li>
<li class="chapter" data-level="7.1.3" data-path="meth_preds.html"><a href="meth_preds.html#bhef-ponderosa-pine-site-4"><i class="fa fa-check"></i><b>7.1.3</b> BHEF Ponderosa Pine Site</a></li>
<li class="chapter" data-level="7.1.4" data-path="meth_preds.html"><a href="meth_preds.html#arnf-ponderosa-pine-site-4"><i class="fa fa-check"></i><b>7.1.4</b> ARNF Ponderosa Pine Site</a></li>
<li class="chapter" data-level="7.1.5" data-path="meth_preds.html"><a href="meth_preds.html#study-paremeter-settings"><i class="fa fa-check"></i><b>7.1.5</b> Study Paremeter Settings</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="meth_preds.html"><a href="meth_preds.html#chm-based-slash-pile-candidates"><i class="fa fa-check"></i><b>7.2</b> CHM-based Slash Pile Candidates</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="meth_preds.html"><a href="meth_preds.html#dbscan-candidates"><i class="fa fa-check"></i><b>7.2.1</b> DBSCAN Candidates</a></li>
<li class="chapter" data-level="7.2.2" data-path="meth_preds.html"><a href="meth_preds.html#watershed-candidates"><i class="fa fa-check"></i><b>7.2.2</b> Watershed Candidates</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="meth_preds.html"><a href="meth_preds.html#spectral-filter-slash-pile-candidates"><i class="fa fa-check"></i><b>7.3</b> Spectral Filter Slash Pile Candidates</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="meth_preds.html"><a href="meth_preds.html#dbscan-predictions"><i class="fa fa-check"></i><b>7.3.1</b> DBSCAN Predictions</a></li>
<li class="chapter" data-level="7.3.2" data-path="meth_preds.html"><a href="meth_preds.html#watershed-predictions"><i class="fa fa-check"></i><b>7.3.2</b> Watershed Predictions</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="preds_detect.html"><a href="preds_detect.html"><i class="fa fa-check"></i><b>8</b> Detection Accuracy</a>
<ul>
<li class="chapter" data-level="8.1" data-path="preds_detect.html"><a href="preds_detect.html#instance-matching"><i class="fa fa-check"></i><b>8.1</b> Instance Matching</a></li>
<li class="chapter" data-level="8.2" data-path="preds_detect.html"><a href="preds_detect.html#detection-accuracy-metrics"><i class="fa fa-check"></i><b>8.2</b> Detection Accuracy Metrics</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="preds_detect.html"><a href="preds_detect.html#agg_inst_match"><i class="fa fa-check"></i><b>8.2.1</b> Aggregate Instance Match Results</a></li>
<li class="chapter" data-level="8.2.2" data-path="preds_detect.html"><a href="preds_detect.html#detection-accuracy-results"><i class="fa fa-check"></i><b>8.2.2</b> Detection Accuracy Results</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="preds_detect.html"><a href="preds_detect.html#segmentation-method-accuracy-comparison"><i class="fa fa-check"></i><b>8.3</b> Segmentation Method Accuracy Comparison</a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="preds_detect.html"><a href="preds_detect.html#paired-t-test"><i class="fa fa-check"></i><b>8.3.1</b> Paired T-Test</a></li>
<li class="chapter" data-level="8.3.2" data-path="preds_detect.html"><a href="preds_detect.html#bayesian-approach"><i class="fa fa-check"></i><b>8.3.2</b> Bayesian Approach</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="preds_detect.html"><a href="preds_detect.html#individual-pile-evaluation"><i class="fa fa-check"></i><b>8.4</b> Individual Pile Evaluation</a>
<ul>
<li class="chapter" data-level="8.4.1" data-path="preds_detect.html"><a href="preds_detect.html#true-positives"><i class="fa fa-check"></i><b>8.4.1</b> True Positives</a></li>
<li class="chapter" data-level="8.4.2" data-path="preds_detect.html"><a href="preds_detect.html#omissions-false-negatives"><i class="fa fa-check"></i><b>8.4.2</b> Omissions (False Negatives)</a></li>
<li class="chapter" data-level="8.4.3" data-path="preds_detect.html"><a href="preds_detect.html#commissions-false-positives"><i class="fa fa-check"></i><b>8.4.3</b> commissions (False Positives)</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="preds_quantit.html"><a href="preds_quantit.html"><i class="fa fa-check"></i><b>9</b> Detection Accuracy</a>
<ul>
<li class="chapter" data-level="9.1" data-path="preds_quantit.html"><a href="preds_quantit.html#height-and-diameter-accuracy"><i class="fa fa-check"></i><b>9.1</b> Height and Diameter Accuracy</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="preds_quantit.html"><a href="preds_quantit.html#stand-level-aggregation"><i class="fa fa-check"></i><b>9.1.1</b> Stand-level Aggregation</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="preds_quantit.html"><a href="preds_quantit.html#area-accuracy"><i class="fa fa-check"></i><b>9.2</b> Area Accuracy</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="preds_quantit.html"><a href="preds_quantit.html#stand-level-aggregation-1"><i class="fa fa-check"></i><b>9.2.1</b> Stand-level Aggregation</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="preds_quantit.html"><a href="preds_quantit.html#vol_comp"><i class="fa fa-check"></i><b>9.3</b> Volume Comparison</a>
<ul>
<li class="chapter" data-level="9.3.1" data-path="preds_quantit.html"><a href="preds_quantit.html#extreme-volume-disagreements"><i class="fa fa-check"></i><b>9.3.1</b> Extreme Volume Disagreements</a></li>
<li class="chapter" data-level="9.3.2" data-path="preds_quantit.html"><a href="preds_quantit.html#allometric-volume-comparison"><i class="fa fa-check"></i><b>9.3.2</b> Allometric Volume Comparison</a></li>
<li class="chapter" data-level="9.3.3" data-path="preds_quantit.html"><a href="preds_quantit.html#stand-level-aggregation-2"><i class="fa fa-check"></i><b>9.3.3</b> Stand-level Aggregation</a></li>
</ul></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Aerial Imagery and Point Cloud Data for Slash Pile Quantification</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="preds_quantit" class="section level1 hasAnchor" number="9">
<h1><span class="header-section-number">Section 9</span> Detection Accuracy<a href="preds_quantit.html#preds_quantit" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>To this point we have:</p>
<ol style="list-style-type: decimal">
<li>Provided a data overview: <a href="index.html#data_desc">here</a> and <a href="data_load.html#data_load">here</a></li>
<li><a href="ptcld_process.html#ptcld_process">Processed the UAS point cloud</a></li>
<li><a href="geom_detect.html#geom_detect">Demonstrated our geometry-based slash pile detection methodology</a></li>
<li><a href="data_fusion.html#data_fusion">Demonstrated our spectral refinement (i.e. data fusion) methodology</a></li>
<li><a href="meth_eval.html#meth_eval">Reviewed how we will evaluate our method</a></li>
<li><a href="meth_preds.html#meth_preds">Made predictions using our method on four experimental sites</a></li>
<li>and <a href="preds_detect.html#preds_detect">Evaluated the pile detection accuracy of the structural-plus-spectral data fusion methodology</a></li>
</ol>
<p>In this section, we’ll evaluate the effectiveness of the proposed geometric, rules-based slash pile detection methodology by assessing its quantification accuracy performance. We fully reviewed the quantification accuracy assessment <a href="meth_eval.html#quant_metrics_form">workflow here</a>, but here is a quick overview:</p>
<p>While <a href="preds_detect.html#preds_detect">detection accuracy</a> evaluates the ability of the method to correctly locate slash piles, the quantification accuracy assessment measures the precision of the physical pile form dimensions estimated for the successfully identified piles. The quantification accuracy assessment focuses exclusively on TP matches to calculate performance metrics such as Root Mean Square Error (RMSE), Mean Absolute Percentage Error (MAPE), and Mean Error (ME) for pile form measurements height and diameter. Unlike the detection validation which includes all four study sites, this quantification accuracy evaluation is limited to the PSINF Mixed Conifer site where direct field-measured ground truth data is available.</p>
<p>We intentionally limit the quantification accuracy reporting to measurements of height and diameter which were made directly in the field rather than derived volume. To evaluate volume, we will perform a direct comparison between the volumes calculated from our predicted segments and those calculated from field measurements using identical geometric formulas. This comparison functions as a test of measurement consistency rather than a formal accuracy assessment of the remote-sensing method itself. This approach ensures our quantification metrics reflect the actual performance of the detection method instead of a composite error involving sensor noise, field variance, and geometric assumptions. Because both the predicted and field-based volumes rely on the same simplified shape assumptions, any resulting differences are not treated as true errors. Instead, this evaluation highlights how variations in the primary inputs of height and diameter propagate through to the final volume estimate. This distinction is critical because it separates the verifiable accuracy of our sensor-derived physical pile form measurements from the subsequent modeling of three-dimensional space.</p>
<div id="height-and-diameter-accuracy" class="section level2 hasAnchor" number="9.1">
<h2><span class="header-section-number">9.1</span> Height and Diameter Accuracy<a href="preds_quantit.html#height-and-diameter-accuracy" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Let’s evaluate the height and diameter accuracy of our slash pile detection and quantification framework using field measurements for the PSINF site which were taken by measuring the height and diameter (longest side of pile) using a laser hypsometer</p>
<p>We already computed the performance metrics RMSE, MAPE, and ME for pile form measurements height and diameter at the study site and detection methodology level in the <a href="preds_detect.html#agg_inst_match">prior section</a> using our <code>agg_ground_truth_match()</code> function that we <a href="meth_eval.html#quant_metrics_form">defined earlier</a></p>
<p>let’s check out what we got</p>
<div class="sourceCode" id="cb325"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb325-1"><a href="preds_quantit.html#cb325-1" tabindex="-1"></a>df_temp <span class="ot">&lt;-</span> </span>
<span id="cb325-2"><a href="preds_quantit.html#cb325-2" tabindex="-1"></a>  agg_ground_truth_match_ans <span class="sc">%&gt;%</span> </span>
<span id="cb325-3"><a href="preds_quantit.html#cb325-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb325-4"><a href="preds_quantit.html#cb325-4" tabindex="-1"></a>    <span class="at">ref_trees =</span> tp_n<span class="sc">+</span>fn_n</span>
<span id="cb325-5"><a href="preds_quantit.html#cb325-5" tabindex="-1"></a>    , <span class="at">det_trees =</span> tp_n<span class="sc">+</span>fp_n</span>
<span id="cb325-6"><a href="preds_quantit.html#cb325-6" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb325-7"><a href="preds_quantit.html#cb325-7" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb325-8"><a href="preds_quantit.html#cb325-8" tabindex="-1"></a>    site, method</span>
<span id="cb325-9"><a href="preds_quantit.html#cb325-9" tabindex="-1"></a>    <span class="co"># , site_area_m2</span></span>
<span id="cb325-10"><a href="preds_quantit.html#cb325-10" tabindex="-1"></a>    <span class="co"># detection</span></span>
<span id="cb325-11"><a href="preds_quantit.html#cb325-11" tabindex="-1"></a>    , ref_trees</span>
<span id="cb325-12"><a href="preds_quantit.html#cb325-12" tabindex="-1"></a>    , det_trees</span>
<span id="cb325-13"><a href="preds_quantit.html#cb325-13" tabindex="-1"></a>    , tp_n</span>
<span id="cb325-14"><a href="preds_quantit.html#cb325-14" tabindex="-1"></a>    , omission_rate,commission_rate,recall,precision,f_score</span>
<span id="cb325-15"><a href="preds_quantit.html#cb325-15" tabindex="-1"></a>    <span class="co"># quantification</span></span>
<span id="cb325-16"><a href="preds_quantit.html#cb325-16" tabindex="-1"></a>    , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_mean&quot;</span>)</span>
<span id="cb325-17"><a href="preds_quantit.html#cb325-17" tabindex="-1"></a>    , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_rmse&quot;</span>)</span>
<span id="cb325-18"><a href="preds_quantit.html#cb325-18" tabindex="-1"></a>    , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_mape&quot;</span>)</span>
<span id="cb325-19"><a href="preds_quantit.html#cb325-19" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb325-20"><a href="preds_quantit.html#cb325-20" tabindex="-1"></a>  <span class="co"># second select to arrange pile_metric</span></span>
<span id="cb325-21"><a href="preds_quantit.html#cb325-21" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb325-22"><a href="preds_quantit.html#cb325-22" tabindex="-1"></a>    site, method</span>
<span id="cb325-23"><a href="preds_quantit.html#cb325-23" tabindex="-1"></a>    <span class="co"># , site_area_m2</span></span>
<span id="cb325-24"><a href="preds_quantit.html#cb325-24" tabindex="-1"></a>    <span class="co"># detection</span></span>
<span id="cb325-25"><a href="preds_quantit.html#cb325-25" tabindex="-1"></a>    , ref_trees</span>
<span id="cb325-26"><a href="preds_quantit.html#cb325-26" tabindex="-1"></a>    , det_trees</span>
<span id="cb325-27"><a href="preds_quantit.html#cb325-27" tabindex="-1"></a>    , tp_n</span>
<span id="cb325-28"><a href="preds_quantit.html#cb325-28" tabindex="-1"></a>    , omission_rate,commission_rate,recall,precision,f_score</span>
<span id="cb325-29"><a href="preds_quantit.html#cb325-29" tabindex="-1"></a>    <span class="co"># quantification</span></span>
<span id="cb325-30"><a href="preds_quantit.html#cb325-30" tabindex="-1"></a>    <span class="co"># , c(tidyselect::contains(&quot;volume&quot;) &amp; !tidyselect::contains(&quot;paraboloid&quot;))</span></span>
<span id="cb325-31"><a href="preds_quantit.html#cb325-31" tabindex="-1"></a>    , tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;area&quot;</span>)</span>
<span id="cb325-32"><a href="preds_quantit.html#cb325-32" tabindex="-1"></a>    , tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;height&quot;</span>)</span>
<span id="cb325-33"><a href="preds_quantit.html#cb325-33" tabindex="-1"></a>    , tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;diameter&quot;</span>)</span>
<span id="cb325-34"><a href="preds_quantit.html#cb325-34" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb325-35"><a href="preds_quantit.html#cb325-35" tabindex="-1"></a>  <span class="co"># names()</span></span>
<span id="cb325-36"><a href="preds_quantit.html#cb325-36" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb325-37"><a href="preds_quantit.html#cb325-37" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">across</span>(</span>
<span id="cb325-38"><a href="preds_quantit.html#cb325-38" tabindex="-1"></a>      <span class="at">.cols =</span> <span class="fu">c</span>(</span>
<span id="cb325-39"><a href="preds_quantit.html#cb325-39" tabindex="-1"></a>        f_score, recall, precision, tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_mape&quot;</span>)</span>
<span id="cb325-40"><a href="preds_quantit.html#cb325-40" tabindex="-1"></a>        , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_rate&quot;</span>)</span>
<span id="cb325-41"><a href="preds_quantit.html#cb325-41" tabindex="-1"></a>      )</span>
<span id="cb325-42"><a href="preds_quantit.html#cb325-42" tabindex="-1"></a>      , <span class="at">.fn =</span> <span class="sc">~</span> scales<span class="sc">::</span><span class="fu">percent</span>(.x, <span class="at">accuracy =</span> <span class="dv">1</span>)</span>
<span id="cb325-43"><a href="preds_quantit.html#cb325-43" tabindex="-1"></a>    )</span>
<span id="cb325-44"><a href="preds_quantit.html#cb325-44" tabindex="-1"></a>    , dplyr<span class="sc">::</span><span class="fu">across</span>(</span>
<span id="cb325-45"><a href="preds_quantit.html#cb325-45" tabindex="-1"></a>      <span class="at">.cols =</span> <span class="fu">c</span>(tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_mean&quot;</span>))</span>
<span id="cb325-46"><a href="preds_quantit.html#cb325-46" tabindex="-1"></a>      , <span class="at">.fn =</span> <span class="sc">~</span> scales<span class="sc">::</span><span class="fu">comma</span>(.x, <span class="at">accuracy =</span> <span class="fl">0.01</span>)</span>
<span id="cb325-47"><a href="preds_quantit.html#cb325-47" tabindex="-1"></a>    )</span>
<span id="cb325-48"><a href="preds_quantit.html#cb325-48" tabindex="-1"></a>    , dplyr<span class="sc">::</span><span class="fu">across</span>(</span>
<span id="cb325-49"><a href="preds_quantit.html#cb325-49" tabindex="-1"></a>      <span class="at">.cols =</span> <span class="fu">c</span>(tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_rmse&quot;</span>))</span>
<span id="cb325-50"><a href="preds_quantit.html#cb325-50" tabindex="-1"></a>      , <span class="at">.fn =</span> <span class="sc">~</span> scales<span class="sc">::</span><span class="fu">comma</span>(.x, <span class="at">accuracy =</span> <span class="fl">0.1</span>)</span>
<span id="cb325-51"><a href="preds_quantit.html#cb325-51" tabindex="-1"></a>    )</span>
<span id="cb325-52"><a href="preds_quantit.html#cb325-52" tabindex="-1"></a>  )</span>
<span id="cb325-53"><a href="preds_quantit.html#cb325-53" tabindex="-1"></a>  <span class="co"># dplyr::glimpse()</span></span>
<span id="cb325-54"><a href="preds_quantit.html#cb325-54" tabindex="-1"></a></span>
<span id="cb325-55"><a href="preds_quantit.html#cb325-55" tabindex="-1"></a>  <span class="do">########################## adj this if want lots of cols</span></span>
<span id="cb325-56"><a href="preds_quantit.html#cb325-56" tabindex="-1"></a>df_temp <span class="sc">%&gt;%</span> </span>
<span id="cb325-57"><a href="preds_quantit.html#cb325-57" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">inner_join</span>(</span>
<span id="cb325-58"><a href="preds_quantit.html#cb325-58" tabindex="-1"></a>    all_stand_boundary <span class="sc">%&gt;%</span> </span>
<span id="cb325-59"><a href="preds_quantit.html#cb325-59" tabindex="-1"></a>      sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb325-60"><a href="preds_quantit.html#cb325-60" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">filter</span>(site_data_lab <span class="sc">==</span> <span class="st">&quot;psinf&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb325-61"><a href="preds_quantit.html#cb325-61" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">select</span>(site,site_area_ha)</span>
<span id="cb325-62"><a href="preds_quantit.html#cb325-62" tabindex="-1"></a>    , <span class="at">by =</span> <span class="st">&quot;site&quot;</span></span>
<span id="cb325-63"><a href="preds_quantit.html#cb325-63" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb325-64"><a href="preds_quantit.html#cb325-64" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb325-65"><a href="preds_quantit.html#cb325-65" tabindex="-1"></a>    <span class="sc">!</span>tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;_area_&quot;</span>)</span>
<span id="cb325-66"><a href="preds_quantit.html#cb325-66" tabindex="-1"></a>    <span class="sc">&amp;</span> <span class="sc">!</span>tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;diff_diameter_&quot;</span>)</span>
<span id="cb325-67"><a href="preds_quantit.html#cb325-67" tabindex="-1"></a>    <span class="sc">&amp;</span> <span class="sc">!</span>tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_trees&quot;</span>)</span>
<span id="cb325-68"><a href="preds_quantit.html#cb325-68" tabindex="-1"></a>    <span class="co"># &amp; !tidyselect::ends_with(&quot;_n&quot;)</span></span>
<span id="cb325-69"><a href="preds_quantit.html#cb325-69" tabindex="-1"></a>    <span class="sc">&amp;</span> <span class="sc">!</span>tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_rate&quot;</span>)</span>
<span id="cb325-70"><a href="preds_quantit.html#cb325-70" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb325-71"><a href="preds_quantit.html#cb325-71" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb325-72"><a href="preds_quantit.html#cb325-72" tabindex="-1"></a>    <span class="sc">-</span><span class="fu">c</span>(recall,precision,f_score)</span>
<span id="cb325-73"><a href="preds_quantit.html#cb325-73" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb325-74"><a href="preds_quantit.html#cb325-74" tabindex="-1"></a>  <span class="do">########################## adj this if want lots of cols</span></span>
<span id="cb325-75"><a href="preds_quantit.html#cb325-75" tabindex="-1"></a>  <span class="co"># dplyr::glimpse()</span></span>
<span id="cb325-76"><a href="preds_quantit.html#cb325-76" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">relocate</span>(site,method,tp_n) <span class="sc">%&gt;%</span> </span>
<span id="cb325-77"><a href="preds_quantit.html#cb325-77" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(site,method) <span class="sc">%&gt;%</span> </span>
<span id="cb325-78"><a href="preds_quantit.html#cb325-78" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kbl</span>(</span>
<span id="cb325-79"><a href="preds_quantit.html#cb325-79" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">&quot;Quantification Accuracy&quot;</span></span>
<span id="cb325-80"><a href="preds_quantit.html#cb325-80" tabindex="-1"></a>    , <span class="at">col.names =</span> <span class="fu">c</span>(</span>
<span id="cb325-81"><a href="preds_quantit.html#cb325-81" tabindex="-1"></a>      <span class="st">&quot;site&quot;</span>, <span class="st">&quot;method&quot;</span>, <span class="st">&quot;TP predictions&quot;</span></span>
<span id="cb325-82"><a href="preds_quantit.html#cb325-82" tabindex="-1"></a>      , <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;ME&quot;</span>,<span class="st">&quot;RMSE&quot;</span>,<span class="st">&quot;MAPE&quot;</span>), <span class="at">times =</span> <span class="dv">2</span>)</span>
<span id="cb325-83"><a href="preds_quantit.html#cb325-83" tabindex="-1"></a>    )</span>
<span id="cb325-84"><a href="preds_quantit.html#cb325-84" tabindex="-1"></a>    , <span class="at">escape =</span> F</span>
<span id="cb325-85"><a href="preds_quantit.html#cb325-85" tabindex="-1"></a>    <span class="co"># , digits = 2</span></span>
<span id="cb325-86"><a href="preds_quantit.html#cb325-86" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb325-87"><a href="preds_quantit.html#cb325-87" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kable_styling</span>(<span class="at">font_size =</span> <span class="fl">11.5</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb325-88"><a href="preds_quantit.html#cb325-88" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">add_header_above</span>(<span class="fu">c</span>(</span>
<span id="cb325-89"><a href="preds_quantit.html#cb325-89" tabindex="-1"></a>    <span class="st">&quot; &quot;</span><span class="ot">=</span><span class="dv">3</span></span>
<span id="cb325-90"><a href="preds_quantit.html#cb325-90" tabindex="-1"></a>    <span class="co"># , &quot;Detection&quot; = 3</span></span>
<span id="cb325-91"><a href="preds_quantit.html#cb325-91" tabindex="-1"></a>    <span class="co"># , &quot;Area&quot; = 3</span></span>
<span id="cb325-92"><a href="preds_quantit.html#cb325-92" tabindex="-1"></a>    , <span class="st">&quot;Height (m)&quot;</span> <span class="ot">=</span> <span class="dv">3</span></span>
<span id="cb325-93"><a href="preds_quantit.html#cb325-93" tabindex="-1"></a>    , <span class="st">&quot;Diameter (m)&quot;</span> <span class="ot">=</span> <span class="dv">3</span></span>
<span id="cb325-94"><a href="preds_quantit.html#cb325-94" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb325-95"><a href="preds_quantit.html#cb325-95" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">column_spec</span>(<span class="fu">seq</span>(<span class="dv">3</span>,<span class="dv">9</span>,<span class="at">by=</span><span class="dv">3</span>), <span class="at">border_right =</span> <span class="cn">TRUE</span>, <span class="at">include_thead =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb325-96"><a href="preds_quantit.html#cb325-96" tabindex="-1"></a>  <span class="co"># kableExtra::column_spec(</span></span>
<span id="cb325-97"><a href="preds_quantit.html#cb325-97" tabindex="-1"></a>  <span class="co">#   column = 3:9</span></span>
<span id="cb325-98"><a href="preds_quantit.html#cb325-98" tabindex="-1"></a>  <span class="co">#   , extra_css = &quot;font-size: 10px;&quot;</span></span>
<span id="cb325-99"><a href="preds_quantit.html#cb325-99" tabindex="-1"></a>  <span class="co">#   , include_thead = T</span></span>
<span id="cb325-100"><a href="preds_quantit.html#cb325-100" tabindex="-1"></a>  <span class="co"># ) %&gt;% </span></span>
<span id="cb325-101"><a href="preds_quantit.html#cb325-101" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">collapse_rows</span>(<span class="at">columns =</span> <span class="dv">1</span>, <span class="at">valign =</span> <span class="st">&quot;top&quot;</span>)</span></code></pre></div>
<table class="table" style="font-size: 11.5px; margin-left: auto; margin-right: auto;">
<caption style="font-size: initial !important;">
<span id="tab:unnamed-chunk-364">Table 9.1: </span>Quantification Accuracy
</caption>
<thead>
<tr>
<th style="empty-cells: hide;border-bottom:hidden;" colspan="3">
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="3">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Height (m)
</div>
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="3">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Diameter (m)
</div>
</th>
</tr>
<tr>
<th style="text-align:left;">
site
</th>
<th style="text-align:left;">
method
</th>
<th style="text-align:right;border-right:1px solid;">
TP predictions
</th>
<th style="text-align:left;">
ME
</th>
<th style="text-align:left;">
RMSE
</th>
<th style="text-align:left;border-right:1px solid;">
MAPE
</th>
<th style="text-align:left;">
ME
</th>
<th style="text-align:left;">
RMSE
</th>
<th style="text-align:left;border-right:1px solid;">
MAPE
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="2">
PSINF Mixed Conifer Site
</td>
<td style="text-align:left;">
DBSCAN
</td>
<td style="text-align:right;border-right:1px solid;">
115
</td>
<td style="text-align:left;">
-0.07
</td>
<td style="text-align:left;">
0.7
</td>
<td style="text-align:left;border-right:1px solid;">
19%
</td>
<td style="text-align:left;">
0.19
</td>
<td style="text-align:left;">
0.5
</td>
<td style="text-align:left;border-right:1px solid;">
10%
</td>
</tr>
<tr>
<td style="text-align:left;">
Watershed
</td>
<td style="text-align:right;border-right:1px solid;">
115
</td>
<td style="text-align:left;">
-0.07
</td>
<td style="text-align:left;">
0.7
</td>
<td style="text-align:left;border-right:1px solid;">
19%
</td>
<td style="text-align:left;">
0.19
</td>
<td style="text-align:left;">
0.5
</td>
<td style="text-align:left;border-right:1px solid;">
10%
</td>
</tr>
</tbody>
</table>
<p>These results demonstrate that the two segmentation methods, DBSCAN and Watershed, show no significant difference in their ability to represent the physical form of correctly identified piles. Because the quantification of pile form is derived directly from the underlying structural CHM data, the two methods naturally yield similar results once a pile is successfully detected. Since both algorithms operate on the same input data to generate measurements for a given location, major differences in quantification accuracy are only expected if there are significant disparities in detection performance. Our detection accuracy evaluation confirmed that both methods performed similarly, and as a result, they produced <del>nearly</del> identical representations of physical pile attributes.</p>
<p>before we compare the measurements in aggregate, let’s look at the distributions</p>
<div class="sourceCode" id="cb326"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb326-1"><a href="preds_quantit.html#cb326-1" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(</span>
<span id="cb326-2"><a href="preds_quantit.html#cb326-2" tabindex="-1"></a>  dbscan_gt_pred_match[[<span class="st">&quot;psinf&quot;</span>]] <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(match_grp<span class="sc">==</span><span class="st">&quot;true positive&quot;</span>) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">method =</span> <span class="st">&quot;dbscan&quot;</span>)</span>
<span id="cb326-3"><a href="preds_quantit.html#cb326-3" tabindex="-1"></a>  , watershed_gt_pred_match[[<span class="st">&quot;psinf&quot;</span>]] <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(match_grp<span class="sc">==</span><span class="st">&quot;true positive&quot;</span>) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">method =</span> <span class="st">&quot;watershed&quot;</span>)</span>
<span id="cb326-4"><a href="preds_quantit.html#cb326-4" tabindex="-1"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb326-5"><a href="preds_quantit.html#cb326-5" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(pile_id,method,field_height_m,pred_height_m,field_diameter_m,pred_diameter_m) <span class="sc">%&gt;%</span> </span>
<span id="cb326-6"><a href="preds_quantit.html#cb326-6" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(</span>
<span id="cb326-7"><a href="preds_quantit.html#cb326-7" tabindex="-1"></a>    <span class="at">cols =</span> <span class="sc">-</span><span class="fu">c</span>(pile_id,method)</span>
<span id="cb326-8"><a href="preds_quantit.html#cb326-8" tabindex="-1"></a>    , <span class="at">names_to =</span> <span class="st">&quot;metric&quot;</span></span>
<span id="cb326-9"><a href="preds_quantit.html#cb326-9" tabindex="-1"></a>    , <span class="at">values_to =</span> <span class="st">&quot;value&quot;</span></span>
<span id="cb326-10"><a href="preds_quantit.html#cb326-10" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb326-11"><a href="preds_quantit.html#cb326-11" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb326-12"><a href="preds_quantit.html#cb326-12" tabindex="-1"></a>    <span class="at">which_data =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb326-13"><a href="preds_quantit.html#cb326-13" tabindex="-1"></a>        stringr<span class="sc">::</span><span class="fu">str_starts</span>(metric,<span class="st">&quot;field_&quot;</span>) <span class="sc">~</span> <span class="st">&quot;field&quot;</span></span>
<span id="cb326-14"><a href="preds_quantit.html#cb326-14" tabindex="-1"></a>        , stringr<span class="sc">::</span><span class="fu">str_starts</span>(metric,<span class="st">&quot;gt_&quot;</span>) <span class="sc">~</span> <span class="st">&quot;image-annotated&quot;</span></span>
<span id="cb326-15"><a href="preds_quantit.html#cb326-15" tabindex="-1"></a>        , stringr<span class="sc">::</span><span class="fu">str_starts</span>(metric,<span class="st">&quot;pred_&quot;</span>) <span class="sc">~</span> <span class="st">&quot;prediction&quot;</span></span>
<span id="cb326-16"><a href="preds_quantit.html#cb326-16" tabindex="-1"></a>        , T <span class="sc">~</span> <span class="st">&quot;error&quot;</span></span>
<span id="cb326-17"><a href="preds_quantit.html#cb326-17" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span> </span>
<span id="cb326-18"><a href="preds_quantit.html#cb326-18" tabindex="-1"></a>      <span class="fu">ordered</span>()</span>
<span id="cb326-19"><a href="preds_quantit.html#cb326-19" tabindex="-1"></a>    , <span class="at">pile_metric =</span> metric <span class="sc">%&gt;%</span> </span>
<span id="cb326-20"><a href="preds_quantit.html#cb326-20" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_remove</span>(<span class="st">&quot;(_rmse|_rrmse|_mean|_mape)$&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb326-21"><a href="preds_quantit.html#cb326-21" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_extract</span>(<span class="st">&quot;(area|height|diameter)&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb326-22"><a href="preds_quantit.html#cb326-22" tabindex="-1"></a>      <span class="fu">factor</span>(</span>
<span id="cb326-23"><a href="preds_quantit.html#cb326-23" tabindex="-1"></a>        <span class="at">ordered =</span> T</span>
<span id="cb326-24"><a href="preds_quantit.html#cb326-24" tabindex="-1"></a>        , <span class="at">levels =</span> <span class="fu">c</span>(</span>
<span id="cb326-25"><a href="preds_quantit.html#cb326-25" tabindex="-1"></a>          <span class="st">&quot;height&quot;</span></span>
<span id="cb326-26"><a href="preds_quantit.html#cb326-26" tabindex="-1"></a>          , <span class="st">&quot;diameter&quot;</span></span>
<span id="cb326-27"><a href="preds_quantit.html#cb326-27" tabindex="-1"></a>          , <span class="st">&quot;area&quot;</span></span>
<span id="cb326-28"><a href="preds_quantit.html#cb326-28" tabindex="-1"></a>        )</span>
<span id="cb326-29"><a href="preds_quantit.html#cb326-29" tabindex="-1"></a>        , <span class="at">labels =</span> <span class="fu">c</span>(</span>
<span id="cb326-30"><a href="preds_quantit.html#cb326-30" tabindex="-1"></a>          <span class="st">&quot;Height (m)&quot;</span></span>
<span id="cb326-31"><a href="preds_quantit.html#cb326-31" tabindex="-1"></a>          , <span class="st">&quot;Diameter (m)&quot;</span></span>
<span id="cb326-32"><a href="preds_quantit.html#cb326-32" tabindex="-1"></a>          , <span class="st">&quot;Area (m2)&quot;</span></span>
<span id="cb326-33"><a href="preds_quantit.html#cb326-33" tabindex="-1"></a>        )</span>
<span id="cb326-34"><a href="preds_quantit.html#cb326-34" tabindex="-1"></a>      )</span>
<span id="cb326-35"><a href="preds_quantit.html#cb326-35" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb326-36"><a href="preds_quantit.html#cb326-36" tabindex="-1"></a>  <span class="co"># dplyr::glimpse()</span></span>
<span id="cb326-37"><a href="preds_quantit.html#cb326-37" tabindex="-1"></a><span class="co"># plot dist</span></span>
<span id="cb326-38"><a href="preds_quantit.html#cb326-38" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">color =</span> which_data, <span class="at">fill =</span> which_data)) <span class="sc">+</span></span>
<span id="cb326-39"><a href="preds_quantit.html#cb326-39" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_density</span>(<span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">y=</span>ggplot2<span class="sc">::</span><span class="fu">after_stat</span>(scaled)), <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb326-40"><a href="preds_quantit.html#cb326-40" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">facet_grid</span>(</span>
<span id="cb326-41"><a href="preds_quantit.html#cb326-41" tabindex="-1"></a>    <span class="at">rows =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(method)</span>
<span id="cb326-42"><a href="preds_quantit.html#cb326-42" tabindex="-1"></a>    , <span class="at">cols =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(pile_metric)</span>
<span id="cb326-43"><a href="preds_quantit.html#cb326-43" tabindex="-1"></a>    , <span class="at">scales =</span> <span class="st">&quot;free_x&quot;</span>, <span class="at">axes =</span> <span class="st">&quot;all_x&quot;</span></span>
<span id="cb326-44"><a href="preds_quantit.html#cb326-44" tabindex="-1"></a>    , <span class="at">switch =</span> <span class="st">&quot;y&quot;</span></span>
<span id="cb326-45"><a href="preds_quantit.html#cb326-45" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb326-46"><a href="preds_quantit.html#cb326-46" tabindex="-1"></a>  harrypotter<span class="sc">::</span><span class="fu">scale_color_hp_d</span>(<span class="at">option =</span> <span class="st">&quot;lunalovegood&quot;</span>) <span class="sc">+</span></span>
<span id="cb326-47"><a href="preds_quantit.html#cb326-47" tabindex="-1"></a>  harrypotter<span class="sc">::</span><span class="fu">scale_fill_hp_d</span>(<span class="at">option =</span> <span class="st">&quot;lunalovegood&quot;</span>) <span class="sc">+</span></span>
<span id="cb326-48"><a href="preds_quantit.html#cb326-48" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>,<span class="at">breaks=</span><span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb326-49"><a href="preds_quantit.html#cb326-49" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb326-50"><a href="preds_quantit.html#cb326-50" tabindex="-1"></a>    <span class="at">color=</span><span class="st">&quot;&quot;</span>,<span class="at">fill=</span><span class="st">&quot;&quot;</span>,<span class="at">x=</span><span class="st">&quot;&quot;</span></span>
<span id="cb326-51"><a href="preds_quantit.html#cb326-51" tabindex="-1"></a>    , <span class="at">subtitle =</span> <span class="st">&quot;comparison of height and diameter distributions&quot;</span></span>
<span id="cb326-52"><a href="preds_quantit.html#cb326-52" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb326-53"><a href="preds_quantit.html#cb326-53" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb326-54"><a href="preds_quantit.html#cb326-54" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb326-55"><a href="preds_quantit.html#cb326-55" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;top&quot;</span></span>
<span id="cb326-56"><a href="preds_quantit.html#cb326-56" tabindex="-1"></a>    , <span class="at">strip.text =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb326-57"><a href="preds_quantit.html#cb326-57" tabindex="-1"></a>    , <span class="at">panel.grid =</span> ggplot2<span class="sc">::</span><span class="fu">element_blank</span>()</span>
<span id="cb326-58"><a href="preds_quantit.html#cb326-58" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="slash_pile_detecting_files/figure-html/unnamed-chunk-365-1.png" alt="" width="1008" /></p>
<div id="stand-level-aggregation" class="section level3 hasAnchor" number="9.1.1">
<h3><span class="header-section-number">9.1.1</span> Stand-level Aggregation<a href="preds_quantit.html#stand-level-aggregation" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Let’s summarize the measurement values of the predictions (true positive and false positive) and the ground truth data (true positive and false negative) over the entire stand (this is similar to a basal area comparison in a forest inventory). Summarizing the predicted and ground truth pile height and diameter form measurements for all instances across the entire study area, regardless of whether individual piles were successfully matched between datasets, for comparison provides insight into the method’s aggregated performance in predicting total pile size in an area. Such totals are often required for administrative needs like submitting burn permits which do not typically focus on individual pile quantification differences.</p>
<div class="sourceCode" id="cb327"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb327-1"><a href="preds_quantit.html#cb327-1" tabindex="-1"></a><span class="co"># sum_df_temp &lt;- </span></span>
<span id="cb327-2"><a href="preds_quantit.html#cb327-2" tabindex="-1"></a>stand_agg_fn <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb327-3"><a href="preds_quantit.html#cb327-3" tabindex="-1"></a>    df</span>
<span id="cb327-4"><a href="preds_quantit.html#cb327-4" tabindex="-1"></a>    ,<span class="at">which_comp =</span> <span class="st">&quot;field&quot;</span> <span class="co"># or &quot;gt&quot;</span></span>
<span id="cb327-5"><a href="preds_quantit.html#cb327-5" tabindex="-1"></a>) {</span>
<span id="cb327-6"><a href="preds_quantit.html#cb327-6" tabindex="-1"></a>  df <span class="sc">%&gt;%</span> </span>
<span id="cb327-7"><a href="preds_quantit.html#cb327-7" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb327-8"><a href="preds_quantit.html#cb327-8" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(pred_id)) <span class="sc">%&gt;%</span> </span>
<span id="cb327-9"><a href="preds_quantit.html#cb327-9" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(</span>
<span id="cb327-10"><a href="preds_quantit.html#cb327-10" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">across</span>(</span>
<span id="cb327-11"><a href="preds_quantit.html#cb327-11" tabindex="-1"></a>      <span class="at">.cols =</span> tidyselect<span class="sc">::</span><span class="fu">starts_with</span>( <span class="fu">paste0</span>(which_comp,<span class="st">&quot;_&quot;</span>) ) <span class="sc">|</span> tidyselect<span class="sc">::</span><span class="fu">starts_with</span>(<span class="st">&quot;pred_&quot;</span>)</span>
<span id="cb327-12"><a href="preds_quantit.html#cb327-12" tabindex="-1"></a>      , <span class="sc">~</span><span class="fu">sum</span>(.x,<span class="at">na.rm=</span>T)</span>
<span id="cb327-13"><a href="preds_quantit.html#cb327-13" tabindex="-1"></a>    )</span>
<span id="cb327-14"><a href="preds_quantit.html#cb327-14" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb327-15"><a href="preds_quantit.html#cb327-15" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(</span>
<span id="cb327-16"><a href="preds_quantit.html#cb327-16" tabindex="-1"></a>    <span class="at">cols =</span> dplyr<span class="sc">::</span><span class="fu">everything</span>()</span>
<span id="cb327-17"><a href="preds_quantit.html#cb327-17" tabindex="-1"></a>    , <span class="at">names_to =</span> <span class="st">&quot;metric&quot;</span></span>
<span id="cb327-18"><a href="preds_quantit.html#cb327-18" tabindex="-1"></a>    , <span class="at">values_to =</span> <span class="st">&quot;value&quot;</span></span>
<span id="cb327-19"><a href="preds_quantit.html#cb327-19" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb327-20"><a href="preds_quantit.html#cb327-20" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb327-21"><a href="preds_quantit.html#cb327-21" tabindex="-1"></a>    <span class="at">which_data =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb327-22"><a href="preds_quantit.html#cb327-22" tabindex="-1"></a>        stringr<span class="sc">::</span><span class="fu">str_starts</span>(metric,<span class="st">&quot;field_&quot;</span>) <span class="sc">~</span> <span class="st">&quot;field&quot;</span></span>
<span id="cb327-23"><a href="preds_quantit.html#cb327-23" tabindex="-1"></a>        , stringr<span class="sc">::</span><span class="fu">str_starts</span>(metric,<span class="st">&quot;gt_&quot;</span>) <span class="sc">~</span> <span class="st">&quot;image-annotated&quot;</span></span>
<span id="cb327-24"><a href="preds_quantit.html#cb327-24" tabindex="-1"></a>        , stringr<span class="sc">::</span><span class="fu">str_starts</span>(metric,<span class="st">&quot;pred_&quot;</span>) <span class="sc">~</span> <span class="st">&quot;prediction&quot;</span></span>
<span id="cb327-25"><a href="preds_quantit.html#cb327-25" tabindex="-1"></a>        , T <span class="sc">~</span> <span class="st">&quot;error&quot;</span></span>
<span id="cb327-26"><a href="preds_quantit.html#cb327-26" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span> </span>
<span id="cb327-27"><a href="preds_quantit.html#cb327-27" tabindex="-1"></a>      <span class="fu">ordered</span>()</span>
<span id="cb327-28"><a href="preds_quantit.html#cb327-28" tabindex="-1"></a>    , <span class="at">pile_metric =</span> metric <span class="sc">%&gt;%</span> </span>
<span id="cb327-29"><a href="preds_quantit.html#cb327-29" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_remove</span>(<span class="st">&quot;(_rmse|_rrmse|_mean|_mape)$&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb327-30"><a href="preds_quantit.html#cb327-30" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_extract</span>(<span class="st">&quot;(allom_volume|volume|area|height|diameter)&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb327-31"><a href="preds_quantit.html#cb327-31" tabindex="-1"></a>      <span class="fu">factor</span>(</span>
<span id="cb327-32"><a href="preds_quantit.html#cb327-32" tabindex="-1"></a>        <span class="at">ordered =</span> T</span>
<span id="cb327-33"><a href="preds_quantit.html#cb327-33" tabindex="-1"></a>        , <span class="at">levels =</span> <span class="fu">c</span>(</span>
<span id="cb327-34"><a href="preds_quantit.html#cb327-34" tabindex="-1"></a>          <span class="st">&quot;height&quot;</span></span>
<span id="cb327-35"><a href="preds_quantit.html#cb327-35" tabindex="-1"></a>          , <span class="st">&quot;diameter&quot;</span></span>
<span id="cb327-36"><a href="preds_quantit.html#cb327-36" tabindex="-1"></a>          , <span class="st">&quot;area&quot;</span></span>
<span id="cb327-37"><a href="preds_quantit.html#cb327-37" tabindex="-1"></a>          , <span class="st">&quot;allom_volume&quot;</span></span>
<span id="cb327-38"><a href="preds_quantit.html#cb327-38" tabindex="-1"></a>          , <span class="st">&quot;volume&quot;</span></span>
<span id="cb327-39"><a href="preds_quantit.html#cb327-39" tabindex="-1"></a>        )</span>
<span id="cb327-40"><a href="preds_quantit.html#cb327-40" tabindex="-1"></a>        , <span class="at">labels =</span> <span class="fu">c</span>(</span>
<span id="cb327-41"><a href="preds_quantit.html#cb327-41" tabindex="-1"></a>          <span class="st">&quot;Height (m)&quot;</span></span>
<span id="cb327-42"><a href="preds_quantit.html#cb327-42" tabindex="-1"></a>          , <span class="st">&quot;Diameter (m)&quot;</span></span>
<span id="cb327-43"><a href="preds_quantit.html#cb327-43" tabindex="-1"></a>          , <span class="st">&quot;Area (m2)&quot;</span></span>
<span id="cb327-44"><a href="preds_quantit.html#cb327-44" tabindex="-1"></a>          <span class="co"># , &quot;Allometric Volume (m3)&quot;</span></span>
<span id="cb327-45"><a href="preds_quantit.html#cb327-45" tabindex="-1"></a>          <span class="co"># , &quot;Volume (m3)&quot;</span></span>
<span id="cb327-46"><a href="preds_quantit.html#cb327-46" tabindex="-1"></a>          , <span class="st">&quot;Allometric Field vs Allometric Predicted Volume (m3)&quot;</span></span>
<span id="cb327-47"><a href="preds_quantit.html#cb327-47" tabindex="-1"></a>          , <span class="st">&quot;Allometric Field vs Irregular Predicted Volume (m3)&quot;</span></span>
<span id="cb327-48"><a href="preds_quantit.html#cb327-48" tabindex="-1"></a>        )</span>
<span id="cb327-49"><a href="preds_quantit.html#cb327-49" tabindex="-1"></a>      )</span>
<span id="cb327-50"><a href="preds_quantit.html#cb327-50" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb327-51"><a href="preds_quantit.html#cb327-51" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(pile_metric) <span class="sc">%&gt;%</span> </span>
<span id="cb327-52"><a href="preds_quantit.html#cb327-52" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(pile_metric,which_data) <span class="sc">%&gt;%</span> </span>
<span id="cb327-53"><a href="preds_quantit.html#cb327-53" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb327-54"><a href="preds_quantit.html#cb327-54" tabindex="-1"></a>    <span class="at">pct_diff =</span> (value<span class="sc">-</span>dplyr<span class="sc">::</span><span class="fu">lag</span>(value))<span class="sc">/</span>dplyr<span class="sc">::</span><span class="fu">lag</span>(value) </span>
<span id="cb327-55"><a href="preds_quantit.html#cb327-55" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb327-56"><a href="preds_quantit.html#cb327-56" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>()</span>
<span id="cb327-57"><a href="preds_quantit.html#cb327-57" tabindex="-1"></a>}</span>
<span id="cb327-58"><a href="preds_quantit.html#cb327-58" tabindex="-1"></a><span class="co"># do it</span></span>
<span id="cb327-59"><a href="preds_quantit.html#cb327-59" tabindex="-1"></a>sum_df_temp <span class="ot">&lt;-</span> </span>
<span id="cb327-60"><a href="preds_quantit.html#cb327-60" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(</span>
<span id="cb327-61"><a href="preds_quantit.html#cb327-61" tabindex="-1"></a>    dbscan_gt_pred_match[[<span class="st">&quot;psinf&quot;</span>]] <span class="sc">%&gt;%</span> <span class="fu">stand_agg_fn</span>() <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">method =</span> <span class="st">&quot;dbscan&quot;</span>)</span>
<span id="cb327-62"><a href="preds_quantit.html#cb327-62" tabindex="-1"></a>    , watershed_gt_pred_match[[<span class="st">&quot;psinf&quot;</span>]] <span class="sc">%&gt;%</span> <span class="fu">stand_agg_fn</span>() <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">method =</span> <span class="st">&quot;watershed&quot;</span>)</span>
<span id="cb327-63"><a href="preds_quantit.html#cb327-63" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb327-64"><a href="preds_quantit.html#cb327-64" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(</span>
<span id="cb327-65"><a href="preds_quantit.html#cb327-65" tabindex="-1"></a>    <span class="sc">!</span>stringr<span class="sc">::</span><span class="fu">str_detect</span>(metric,<span class="st">&quot;volume&quot;</span>)</span>
<span id="cb327-66"><a href="preds_quantit.html#cb327-66" tabindex="-1"></a>    , <span class="sc">!</span>stringr<span class="sc">::</span><span class="fu">str_detect</span>(metric,<span class="st">&quot;area&quot;</span>)</span>
<span id="cb327-67"><a href="preds_quantit.html#cb327-67" tabindex="-1"></a>  )</span>
<span id="cb327-68"><a href="preds_quantit.html#cb327-68" tabindex="-1"></a><span class="co"># sum_df_temp %&gt;% dplyr::glimpse()</span></span></code></pre></div>
<p>plot the aggregated, stand-level height and diameter comparison between field-measured and predicted piles</p>
<div class="sourceCode" id="cb328"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb328-1"><a href="preds_quantit.html#cb328-1" tabindex="-1"></a><span class="co"># plot it</span></span>
<span id="cb328-2"><a href="preds_quantit.html#cb328-2" tabindex="-1"></a>sum_df_temp <span class="sc">%&gt;%</span> </span>
<span id="cb328-3"><a href="preds_quantit.html#cb328-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb328-4"><a href="preds_quantit.html#cb328-4" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb328-5"><a href="preds_quantit.html#cb328-5" tabindex="-1"></a>    <span class="at">stand_id=</span><span class="dv">1</span></span>
<span id="cb328-6"><a href="preds_quantit.html#cb328-6" tabindex="-1"></a>    , <span class="at">lab =</span> <span class="fu">paste0</span>(</span>
<span id="cb328-7"><a href="preds_quantit.html#cb328-7" tabindex="-1"></a>      scales<span class="sc">::</span><span class="fu">comma</span>(value,<span class="at">accuracy=</span><span class="fl">0.1</span>)</span>
<span id="cb328-8"><a href="preds_quantit.html#cb328-8" tabindex="-1"></a>      , dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb328-9"><a href="preds_quantit.html#cb328-9" tabindex="-1"></a>        <span class="fu">is.na</span>(pct_diff) <span class="sc">~</span> <span class="st">&quot;&quot;</span></span>
<span id="cb328-10"><a href="preds_quantit.html#cb328-10" tabindex="-1"></a>        , T <span class="sc">~</span> <span class="fu">paste0</span>(</span>
<span id="cb328-11"><a href="preds_quantit.html#cb328-11" tabindex="-1"></a>          <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span></span>
<span id="cb328-12"><a href="preds_quantit.html#cb328-12" tabindex="-1"></a>          , <span class="fu">ifelse</span>(pct_diff<span class="sc">&lt;</span><span class="dv">0</span>,<span class="st">&quot;-&quot;</span>,<span class="st">&quot;+&quot;</span>)</span>
<span id="cb328-13"><a href="preds_quantit.html#cb328-13" tabindex="-1"></a>          ,scales<span class="sc">::</span><span class="fu">percent</span>(<span class="fu">abs</span>(pct_diff),<span class="at">accuracy=</span><span class="fl">0.1</span>)</span>
<span id="cb328-14"><a href="preds_quantit.html#cb328-14" tabindex="-1"></a>        )</span>
<span id="cb328-15"><a href="preds_quantit.html#cb328-15" tabindex="-1"></a>      )</span>
<span id="cb328-16"><a href="preds_quantit.html#cb328-16" tabindex="-1"></a>    )</span>
<span id="cb328-17"><a href="preds_quantit.html#cb328-17" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb328-18"><a href="preds_quantit.html#cb328-18" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(</span>
<span id="cb328-19"><a href="preds_quantit.html#cb328-19" tabindex="-1"></a>    <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(</span>
<span id="cb328-20"><a href="preds_quantit.html#cb328-20" tabindex="-1"></a>      <span class="at">x =</span> which_data</span>
<span id="cb328-21"><a href="preds_quantit.html#cb328-21" tabindex="-1"></a>      , <span class="at">y =</span> value</span>
<span id="cb328-22"><a href="preds_quantit.html#cb328-22" tabindex="-1"></a>      , <span class="at">label =</span> lab</span>
<span id="cb328-23"><a href="preds_quantit.html#cb328-23" tabindex="-1"></a>      , <span class="at">group =</span> stand_id</span>
<span id="cb328-24"><a href="preds_quantit.html#cb328-24" tabindex="-1"></a>    )</span>
<span id="cb328-25"><a href="preds_quantit.html#cb328-25" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb328-26"><a href="preds_quantit.html#cb328-26" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_line</span>(<span class="at">key_glyph =</span> <span class="st">&quot;point&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>, <span class="at">color =</span> <span class="st">&quot;gray&quot;</span>, <span class="at">lwd =</span> <span class="fl">1.1</span>) <span class="sc">+</span></span>
<span id="cb328-27"><a href="preds_quantit.html#cb328-27" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_col</span>(<span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">fill =</span> which_data), <span class="at">alpha =</span> <span class="dv">1</span>, <span class="at">width =</span> <span class="fl">0.4</span>) <span class="sc">+</span></span>
<span id="cb328-28"><a href="preds_quantit.html#cb328-28" tabindex="-1"></a>  harrypotter<span class="sc">::</span><span class="fu">scale_color_hp_d</span>(<span class="at">option =</span> <span class="st">&quot;lunalovegood&quot;</span>) <span class="sc">+</span></span>
<span id="cb328-29"><a href="preds_quantit.html#cb328-29" tabindex="-1"></a>  harrypotter<span class="sc">::</span><span class="fu">scale_fill_hp_d</span>(<span class="at">option =</span> <span class="st">&quot;lunalovegood&quot;</span>) <span class="sc">+</span></span>
<span id="cb328-30"><a href="preds_quantit.html#cb328-30" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_text</span>(</span>
<span id="cb328-31"><a href="preds_quantit.html#cb328-31" tabindex="-1"></a>    <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.25</span></span>
<span id="cb328-32"><a href="preds_quantit.html#cb328-32" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb328-33"><a href="preds_quantit.html#cb328-33" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">facet_grid</span>(</span>
<span id="cb328-34"><a href="preds_quantit.html#cb328-34" tabindex="-1"></a>    <span class="at">rows =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(pile_metric)</span>
<span id="cb328-35"><a href="preds_quantit.html#cb328-35" tabindex="-1"></a>    , <span class="at">cols =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(method)</span>
<span id="cb328-36"><a href="preds_quantit.html#cb328-36" tabindex="-1"></a>    , <span class="at">scales =</span> <span class="st">&quot;free_y&quot;</span>, <span class="at">axes =</span> <span class="st">&quot;all_x&quot;</span></span>
<span id="cb328-37"><a href="preds_quantit.html#cb328-37" tabindex="-1"></a>    , <span class="at">switch =</span> <span class="st">&quot;y&quot;</span></span>
<span id="cb328-38"><a href="preds_quantit.html#cb328-38" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb328-39"><a href="preds_quantit.html#cb328-39" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>comma, <span class="at">expand =</span> ggplot2<span class="sc">::</span><span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="dv">0</span>,.<span class="dv">3</span>)), <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb328-40"><a href="preds_quantit.html#cb328-40" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb328-41"><a href="preds_quantit.html#cb328-41" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;&quot;</span>, <span class="at">y =</span> <span class="st">&quot;&quot;</span></span>
<span id="cb328-42"><a href="preds_quantit.html#cb328-42" tabindex="-1"></a>    , <span class="at">subtitle =</span> <span class="st">&quot;Comparison of aggregated measurements at the PSINF site&quot;</span></span>
<span id="cb328-43"><a href="preds_quantit.html#cb328-43" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb328-44"><a href="preds_quantit.html#cb328-44" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb328-45"><a href="preds_quantit.html#cb328-45" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb328-46"><a href="preds_quantit.html#cb328-46" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb328-47"><a href="preds_quantit.html#cb328-47" tabindex="-1"></a>    , <span class="at">axis.text.x =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb328-48"><a href="preds_quantit.html#cb328-48" tabindex="-1"></a>    , <span class="at">strip.text =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb328-49"><a href="preds_quantit.html#cb328-49" tabindex="-1"></a>    , <span class="at">panel.grid =</span> ggplot2<span class="sc">::</span><span class="fu">element_blank</span>()</span>
<span id="cb328-50"><a href="preds_quantit.html#cb328-50" tabindex="-1"></a>  ) </span></code></pre></div>
<p><img src="slash_pile_detecting_files/figure-html/unnamed-chunk-367-1.png" alt="" width="1008" /></p>
<p>table the aggregated, stand-level height and diameter comparison between field-measured and predicted piles</p>
<div class="sourceCode" id="cb329"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb329-1"><a href="preds_quantit.html#cb329-1" tabindex="-1"></a>sum_df_temp <span class="sc">%&gt;%</span> </span>
<span id="cb329-2"><a href="preds_quantit.html#cb329-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb329-3"><a href="preds_quantit.html#cb329-3" tabindex="-1"></a>    <span class="at">pile_metric=</span>stringr<span class="sc">::</span><span class="fu">word</span>(pile_metric)</span>
<span id="cb329-4"><a href="preds_quantit.html#cb329-4" tabindex="-1"></a>    , <span class="at">value =</span> scales<span class="sc">::</span><span class="fu">comma</span>(value,<span class="at">accuracy=</span><span class="fl">0.1</span>)</span>
<span id="cb329-5"><a href="preds_quantit.html#cb329-5" tabindex="-1"></a>    , <span class="at">pct_diff =</span> scales<span class="sc">::</span><span class="fu">percent</span>(pct_diff,<span class="at">accuracy=</span><span class="fl">0.1</span>)</span>
<span id="cb329-6"><a href="preds_quantit.html#cb329-6" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb329-7"><a href="preds_quantit.html#cb329-7" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_wider</span>(</span>
<span id="cb329-8"><a href="preds_quantit.html#cb329-8" tabindex="-1"></a>    <span class="at">id_cols =</span> method</span>
<span id="cb329-9"><a href="preds_quantit.html#cb329-9" tabindex="-1"></a>    , <span class="at">values_from =</span> <span class="fu">c</span>(value,pct_diff)</span>
<span id="cb329-10"><a href="preds_quantit.html#cb329-10" tabindex="-1"></a>    , <span class="at">names_from =</span> <span class="fu">c</span>(pile_metric,which_data)</span>
<span id="cb329-11"><a href="preds_quantit.html#cb329-11" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb329-12"><a href="preds_quantit.html#cb329-12" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(dplyr<span class="sc">::</span><span class="fu">where</span>(<span class="sc">~</span> <span class="sc">!</span><span class="fu">all</span>(<span class="fu">is.na</span>(.x)))) <span class="sc">%&gt;%</span> </span>
<span id="cb329-13"><a href="preds_quantit.html#cb329-13" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename_with</span>(</span>
<span id="cb329-14"><a href="preds_quantit.html#cb329-14" tabindex="-1"></a>    <span class="at">.cols =</span> dplyr<span class="sc">::</span><span class="fu">everything</span>()</span>
<span id="cb329-15"><a href="preds_quantit.html#cb329-15" tabindex="-1"></a>    , <span class="at">.fn =</span> <span class="sc">~</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb329-16"><a href="preds_quantit.html#cb329-16" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_starts</span>(.x,<span class="st">&quot;value_&quot;</span>) <span class="sc">~</span> stringr<span class="sc">::</span><span class="fu">str_remove</span>(.x,<span class="st">&quot;^value_&quot;</span>) <span class="sc">%&gt;%</span> stringr<span class="sc">::</span><span class="fu">str_c</span>(<span class="st">&quot;_value&quot;</span>)</span>
<span id="cb329-17"><a href="preds_quantit.html#cb329-17" tabindex="-1"></a>      , stringr<span class="sc">::</span><span class="fu">str_starts</span>(.x,<span class="st">&quot;pct_diff_&quot;</span>) <span class="sc">~</span> stringr<span class="sc">::</span><span class="fu">str_remove</span>(.x,<span class="st">&quot;^pct_diff_&quot;</span>) <span class="sc">%&gt;%</span> stringr<span class="sc">::</span><span class="fu">str_c</span>(<span class="st">&quot;_zzpct_diff&quot;</span>)</span>
<span id="cb329-18"><a href="preds_quantit.html#cb329-18" tabindex="-1"></a>      , T <span class="sc">~</span> .x</span>
<span id="cb329-19"><a href="preds_quantit.html#cb329-19" tabindex="-1"></a>    )</span>
<span id="cb329-20"><a href="preds_quantit.html#cb329-20" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb329-21"><a href="preds_quantit.html#cb329-21" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">order</span>(<span class="fu">colnames</span>(.))) <span class="sc">%&gt;%</span> </span>
<span id="cb329-22"><a href="preds_quantit.html#cb329-22" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">site =</span> all_stand_boundary <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(site_data_lab<span class="sc">==</span><span class="st">&quot;psinf&quot;</span>) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">pull</span>(site)) <span class="sc">%&gt;%</span> </span>
<span id="cb329-23"><a href="preds_quantit.html#cb329-23" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">relocate</span>(site,method) <span class="sc">%&gt;%</span> </span>
<span id="cb329-24"><a href="preds_quantit.html#cb329-24" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(site,method) <span class="sc">%&gt;%</span> </span>
<span id="cb329-25"><a href="preds_quantit.html#cb329-25" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kbl</span>(</span>
<span id="cb329-26"><a href="preds_quantit.html#cb329-26" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">&quot;Comparison of aggregated measurements at the PSINF site&quot;</span></span>
<span id="cb329-27"><a href="preds_quantit.html#cb329-27" tabindex="-1"></a>    , <span class="at">col.names =</span> <span class="fu">c</span>(</span>
<span id="cb329-28"><a href="preds_quantit.html#cb329-28" tabindex="-1"></a>      <span class="st">&quot;site&quot;</span>, <span class="st">&quot;method&quot;</span></span>
<span id="cb329-29"><a href="preds_quantit.html#cb329-29" tabindex="-1"></a>      , <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;Field&quot;</span>,<span class="st">&quot;Predicted&quot;</span>,<span class="st">&quot;Pct Diff&quot;</span>), <span class="at">times =</span> <span class="dv">2</span>)</span>
<span id="cb329-30"><a href="preds_quantit.html#cb329-30" tabindex="-1"></a>    )</span>
<span id="cb329-31"><a href="preds_quantit.html#cb329-31" tabindex="-1"></a>    , <span class="at">escape =</span> F</span>
<span id="cb329-32"><a href="preds_quantit.html#cb329-32" tabindex="-1"></a>    <span class="co"># , digits = 2</span></span>
<span id="cb329-33"><a href="preds_quantit.html#cb329-33" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb329-34"><a href="preds_quantit.html#cb329-34" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kable_styling</span>(<span class="at">font_size =</span> <span class="fl">11.5</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb329-35"><a href="preds_quantit.html#cb329-35" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">add_header_above</span>(<span class="fu">c</span>(</span>
<span id="cb329-36"><a href="preds_quantit.html#cb329-36" tabindex="-1"></a>    <span class="st">&quot; &quot;</span><span class="ot">=</span><span class="dv">2</span></span>
<span id="cb329-37"><a href="preds_quantit.html#cb329-37" tabindex="-1"></a>    <span class="co"># , &quot;Detection&quot; = 3</span></span>
<span id="cb329-38"><a href="preds_quantit.html#cb329-38" tabindex="-1"></a>    <span class="co"># , &quot;Area&quot; = 3</span></span>
<span id="cb329-39"><a href="preds_quantit.html#cb329-39" tabindex="-1"></a>    , <span class="st">&quot;Diameter (m)&quot;</span> <span class="ot">=</span> <span class="dv">3</span></span>
<span id="cb329-40"><a href="preds_quantit.html#cb329-40" tabindex="-1"></a>    , <span class="st">&quot;Height (m)&quot;</span> <span class="ot">=</span> <span class="dv">3</span></span>
<span id="cb329-41"><a href="preds_quantit.html#cb329-41" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb329-42"><a href="preds_quantit.html#cb329-42" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">column_spec</span>(<span class="fu">seq</span>(<span class="dv">2</span>,<span class="dv">8</span>,<span class="at">by=</span><span class="dv">3</span>), <span class="at">border_right =</span> <span class="cn">TRUE</span>, <span class="at">include_thead =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb329-43"><a href="preds_quantit.html#cb329-43" tabindex="-1"></a>  <span class="co"># kableExtra::column_spec(</span></span>
<span id="cb329-44"><a href="preds_quantit.html#cb329-44" tabindex="-1"></a>  <span class="co">#   column = 3:9</span></span>
<span id="cb329-45"><a href="preds_quantit.html#cb329-45" tabindex="-1"></a>  <span class="co">#   , extra_css = &quot;font-size: 10px;&quot;</span></span>
<span id="cb329-46"><a href="preds_quantit.html#cb329-46" tabindex="-1"></a>  <span class="co">#   , include_thead = T</span></span>
<span id="cb329-47"><a href="preds_quantit.html#cb329-47" tabindex="-1"></a>  <span class="co"># ) %&gt;% </span></span>
<span id="cb329-48"><a href="preds_quantit.html#cb329-48" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">collapse_rows</span>(<span class="at">columns =</span> <span class="dv">1</span>, <span class="at">valign =</span> <span class="st">&quot;top&quot;</span>)</span></code></pre></div>
<table class="table" style="font-size: 11.5px; margin-left: auto; margin-right: auto;">
<caption style="font-size: initial !important;">
<span id="tab:unnamed-chunk-368">Table 9.2: </span>Comparison of aggregated measurements at the PSINF site
</caption>
<thead>
<tr>
<th style="empty-cells: hide;border-bottom:hidden;" colspan="2">
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="3">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Diameter (m)
</div>
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="3">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Height (m)
</div>
</th>
</tr>
<tr>
<th style="text-align:left;">
site
</th>
<th style="text-align:left;border-right:1px solid;">
method
</th>
<th style="text-align:left;">
Field
</th>
<th style="text-align:left;">
Predicted
</th>
<th style="text-align:left;border-right:1px solid;">
Pct Diff
</th>
<th style="text-align:left;">
Field
</th>
<th style="text-align:left;">
Predicted
</th>
<th style="text-align:left;border-right:1px solid;">
Pct Diff
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="2">
PSINF Mixed Conifer Site
</td>
<td style="text-align:left;border-right:1px solid;">
dbscan
</td>
<td style="text-align:left;">
417.1
</td>
<td style="text-align:left;">
433.7
</td>
<td style="text-align:left;border-right:1px solid;">
4.0%
</td>
<td style="text-align:left;">
263.7
</td>
<td style="text-align:left;">
258.8
</td>
<td style="text-align:left;border-right:1px solid;">
-1.9%
</td>
</tr>
<tr>
<td style="text-align:left;border-right:1px solid;">
watershed
</td>
<td style="text-align:left;">
417.1
</td>
<td style="text-align:left;">
447.2
</td>
<td style="text-align:left;border-right:1px solid;">
7.2%
</td>
<td style="text-align:left;">
263.7
</td>
<td style="text-align:left;">
270.7
</td>
<td style="text-align:left;border-right:1px solid;">
2.7%
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="area-accuracy" class="section level2 hasAnchor" number="9.2">
<h2><span class="header-section-number">9.2</span> Area Accuracy<a href="preds_quantit.html#area-accuracy" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We could also evaluate quantification accuracy using pile areas based on the image annotations, though these are less presumptive than the “gold standard” field measurements. These annotations were occasionally limited by the difficulty of pinpointing exact pile boundaries, even when using high-resolution RGB data. Despite the potential for human error in the digitizing process, these area measurements provide additional validation data that is available across all four study sites.</p>
<div class="sourceCode" id="cb330"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb330-1"><a href="preds_quantit.html#cb330-1" tabindex="-1"></a>  <span class="do">########################## adj this if want lots of cols</span></span>
<span id="cb330-2"><a href="preds_quantit.html#cb330-2" tabindex="-1"></a>df_temp <span class="sc">%&gt;%</span> </span>
<span id="cb330-3"><a href="preds_quantit.html#cb330-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb330-4"><a href="preds_quantit.html#cb330-4" tabindex="-1"></a>    <span class="sc">!</span>tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;_height_&quot;</span>)</span>
<span id="cb330-5"><a href="preds_quantit.html#cb330-5" tabindex="-1"></a>    <span class="sc">&amp;</span> <span class="sc">!</span>tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;_diameter_&quot;</span>)</span>
<span id="cb330-6"><a href="preds_quantit.html#cb330-6" tabindex="-1"></a>    <span class="sc">&amp;</span> <span class="sc">!</span>tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_trees&quot;</span>)</span>
<span id="cb330-7"><a href="preds_quantit.html#cb330-7" tabindex="-1"></a>    <span class="co"># &amp; !tidyselect::ends_with(&quot;_n&quot;)</span></span>
<span id="cb330-8"><a href="preds_quantit.html#cb330-8" tabindex="-1"></a>    <span class="sc">&amp;</span> <span class="sc">!</span>tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_rate&quot;</span>)</span>
<span id="cb330-9"><a href="preds_quantit.html#cb330-9" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb330-10"><a href="preds_quantit.html#cb330-10" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb330-11"><a href="preds_quantit.html#cb330-11" tabindex="-1"></a>    <span class="sc">-</span><span class="fu">c</span>(recall,precision,f_score)</span>
<span id="cb330-12"><a href="preds_quantit.html#cb330-12" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb330-13"><a href="preds_quantit.html#cb330-13" tabindex="-1"></a>  <span class="do">########################## adj this if want lots of cols</span></span>
<span id="cb330-14"><a href="preds_quantit.html#cb330-14" tabindex="-1"></a>  <span class="co"># dplyr::glimpse()</span></span>
<span id="cb330-15"><a href="preds_quantit.html#cb330-15" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">relocate</span>(site,method,tp_n) <span class="sc">%&gt;%</span> </span>
<span id="cb330-16"><a href="preds_quantit.html#cb330-16" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(site,method) <span class="sc">%&gt;%</span> </span>
<span id="cb330-17"><a href="preds_quantit.html#cb330-17" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kbl</span>(</span>
<span id="cb330-18"><a href="preds_quantit.html#cb330-18" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">&quot;Quantification Accuracy&quot;</span></span>
<span id="cb330-19"><a href="preds_quantit.html#cb330-19" tabindex="-1"></a>    , <span class="at">col.names =</span> <span class="fu">c</span>(</span>
<span id="cb330-20"><a href="preds_quantit.html#cb330-20" tabindex="-1"></a>      <span class="st">&quot;site&quot;</span>, <span class="st">&quot;method&quot;</span>, <span class="st">&quot;TP predictions&quot;</span></span>
<span id="cb330-21"><a href="preds_quantit.html#cb330-21" tabindex="-1"></a>      , <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;ME&quot;</span>,<span class="st">&quot;RMSE&quot;</span>,<span class="st">&quot;MAPE&quot;</span>), <span class="at">times =</span> <span class="dv">1</span>)</span>
<span id="cb330-22"><a href="preds_quantit.html#cb330-22" tabindex="-1"></a>    )</span>
<span id="cb330-23"><a href="preds_quantit.html#cb330-23" tabindex="-1"></a>    , <span class="at">escape =</span> F</span>
<span id="cb330-24"><a href="preds_quantit.html#cb330-24" tabindex="-1"></a>    <span class="co"># , digits = 2</span></span>
<span id="cb330-25"><a href="preds_quantit.html#cb330-25" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb330-26"><a href="preds_quantit.html#cb330-26" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kable_styling</span>(<span class="at">font_size =</span> <span class="fl">11.5</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb330-27"><a href="preds_quantit.html#cb330-27" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">add_header_above</span>(<span class="fu">c</span>(</span>
<span id="cb330-28"><a href="preds_quantit.html#cb330-28" tabindex="-1"></a>    <span class="st">&quot; &quot;</span><span class="ot">=</span><span class="dv">3</span></span>
<span id="cb330-29"><a href="preds_quantit.html#cb330-29" tabindex="-1"></a>    <span class="co"># , &quot;Detection&quot; = 3</span></span>
<span id="cb330-30"><a href="preds_quantit.html#cb330-30" tabindex="-1"></a>    <span class="co"># , &quot;Area&quot; = 3</span></span>
<span id="cb330-31"><a href="preds_quantit.html#cb330-31" tabindex="-1"></a>    , <span class="st">&quot;Area (m&lt;sup&gt;2&lt;/sup&gt;)&quot;</span> <span class="ot">=</span> <span class="dv">3</span></span>
<span id="cb330-32"><a href="preds_quantit.html#cb330-32" tabindex="-1"></a>    </span>
<span id="cb330-33"><a href="preds_quantit.html#cb330-33" tabindex="-1"></a>  ), <span class="at">escape =</span> F) <span class="sc">%&gt;%</span> </span>
<span id="cb330-34"><a href="preds_quantit.html#cb330-34" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">column_spec</span>(<span class="fu">seq</span>(<span class="dv">3</span>,<span class="dv">6</span>,<span class="at">by=</span><span class="dv">3</span>), <span class="at">border_right =</span> <span class="cn">TRUE</span>, <span class="at">include_thead =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb330-35"><a href="preds_quantit.html#cb330-35" tabindex="-1"></a>  <span class="co"># kableExtra::column_spec(</span></span>
<span id="cb330-36"><a href="preds_quantit.html#cb330-36" tabindex="-1"></a>  <span class="co">#   column = 3:9</span></span>
<span id="cb330-37"><a href="preds_quantit.html#cb330-37" tabindex="-1"></a>  <span class="co">#   , extra_css = &quot;font-size: 10px;&quot;</span></span>
<span id="cb330-38"><a href="preds_quantit.html#cb330-38" tabindex="-1"></a>  <span class="co">#   , include_thead = T</span></span>
<span id="cb330-39"><a href="preds_quantit.html#cb330-39" tabindex="-1"></a>  <span class="co"># ) %&gt;% </span></span>
<span id="cb330-40"><a href="preds_quantit.html#cb330-40" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">collapse_rows</span>(<span class="at">columns =</span> <span class="dv">1</span>, <span class="at">valign =</span> <span class="st">&quot;top&quot;</span>)</span></code></pre></div>
<table class="table" style="font-size: 11.5px; margin-left: auto; margin-right: auto;">
<caption style="font-size: initial !important;">
<span id="tab:unnamed-chunk-369">Table 9.3: </span>Quantification Accuracy
</caption>
<thead>
<tr>
<th style="empty-cells: hide;border-bottom:hidden;" colspan="3">
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="3">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Area (m<sup>2</sup>)
</div>
</th>
</tr>
<tr>
<th style="text-align:left;">
site
</th>
<th style="text-align:left;">
method
</th>
<th style="text-align:right;border-right:1px solid;">
TP predictions
</th>
<th style="text-align:left;">
ME
</th>
<th style="text-align:left;">
RMSE
</th>
<th style="text-align:left;border-right:1px solid;">
MAPE
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="2">
ARNF Ponderosa Pine Site
</td>
<td style="text-align:left;">
DBSCAN
</td>
<td style="text-align:right;border-right:1px solid;">
18
</td>
<td style="text-align:left;">
12.76
</td>
<td style="text-align:left;">
16.6
</td>
<td style="text-align:left;border-right:1px solid;">
4%
</td>
</tr>
<tr>
<td style="text-align:left;">
Watershed
</td>
<td style="text-align:right;border-right:1px solid;">
18
</td>
<td style="text-align:left;">
13.33
</td>
<td style="text-align:left;">
17.0
</td>
<td style="text-align:left;border-right:1px solid;">
4%
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="2">
BHEF Ponderosa Pine Site
</td>
<td style="text-align:left;">
DBSCAN
</td>
<td style="text-align:right;border-right:1px solid;">
24
</td>
<td style="text-align:left;">
-24.85
</td>
<td style="text-align:left;">
48.4
</td>
<td style="text-align:left;border-right:1px solid;">
15%
</td>
</tr>
<tr>
<td style="text-align:left;">
Watershed
</td>
<td style="text-align:right;border-right:1px solid;">
24
</td>
<td style="text-align:left;">
-24.86
</td>
<td style="text-align:left;">
48.3
</td>
<td style="text-align:left;border-right:1px solid;">
15%
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="2">
PSINF Mixed Conifer Site
</td>
<td style="text-align:left;">
DBSCAN
</td>
<td style="text-align:right;border-right:1px solid;">
115
</td>
<td style="text-align:left;">
-0.78
</td>
<td style="text-align:left;">
2.1
</td>
<td style="text-align:left;border-right:1px solid;">
10%
</td>
</tr>
<tr>
<td style="text-align:left;">
Watershed
</td>
<td style="text-align:right;border-right:1px solid;">
115
</td>
<td style="text-align:left;">
-0.78
</td>
<td style="text-align:left;">
2.1
</td>
<td style="text-align:left;border-right:1px solid;">
10%
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="2">
TRFO-BLM Pinyon-Juniper Site
</td>
<td style="text-align:left;">
DBSCAN
</td>
<td style="text-align:right;border-right:1px solid;">
246
</td>
<td style="text-align:left;">
-0.95
</td>
<td style="text-align:left;">
1.7
</td>
<td style="text-align:left;border-right:1px solid;">
13%
</td>
</tr>
<tr>
<td style="text-align:left;">
Watershed
</td>
<td style="text-align:right;border-right:1px solid;">
246
</td>
<td style="text-align:left;">
-0.95
</td>
<td style="text-align:left;">
1.8
</td>
<td style="text-align:left;border-right:1px solid;">
13%
</td>
</tr>
</tbody>
</table>
<p>These results further confirm that the two segmentation methods yield similar quantification accuracies for pile area, mirroring the patterns observed for height and diameter. While the absolute area accuracy naturally varies across study sites according to the average pile size, the MAPE remains decently low, ranging between 3.5% and 14.9% across all locations. These metrics suggest that both DBSCAN and Watershed are capable of delineating pile boundaries with acceptable precision.</p>
<p>before we compare the measurements in aggregate, let’s look at the distributions</p>
<div class="sourceCode" id="cb331"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb331-1"><a href="preds_quantit.html#cb331-1" tabindex="-1"></a>all_stand_boundary<span class="sc">$</span>site_data_lab <span class="sc">%&gt;%</span> </span>
<span id="cb331-2"><a href="preds_quantit.html#cb331-2" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">map</span>(</span>
<span id="cb331-3"><a href="preds_quantit.html#cb331-3" tabindex="-1"></a>    \(x)</span>
<span id="cb331-4"><a href="preds_quantit.html#cb331-4" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(</span>
<span id="cb331-5"><a href="preds_quantit.html#cb331-5" tabindex="-1"></a>      dbscan_gt_pred_match[[x]] <span class="sc">%&gt;%</span> </span>
<span id="cb331-6"><a href="preds_quantit.html#cb331-6" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">filter</span>(match_grp<span class="sc">==</span><span class="st">&quot;true positive&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb331-7"><a href="preds_quantit.html#cb331-7" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">select</span>(pile_id,gt_area_m2,pred_area_m2) <span class="sc">%&gt;%</span> </span>
<span id="cb331-8"><a href="preds_quantit.html#cb331-8" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb331-9"><a href="preds_quantit.html#cb331-9" tabindex="-1"></a>          <span class="at">method =</span> <span class="st">&quot;dbscan&quot;</span></span>
<span id="cb331-10"><a href="preds_quantit.html#cb331-10" tabindex="-1"></a>          , <span class="at">site =</span> all_stand_boundary <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(site_data_lab<span class="sc">==</span>x) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">pull</span>(site)</span>
<span id="cb331-11"><a href="preds_quantit.html#cb331-11" tabindex="-1"></a>        )</span>
<span id="cb331-12"><a href="preds_quantit.html#cb331-12" tabindex="-1"></a>      , watershed_gt_pred_match[[x]] <span class="sc">%&gt;%</span> </span>
<span id="cb331-13"><a href="preds_quantit.html#cb331-13" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">filter</span>(match_grp<span class="sc">==</span><span class="st">&quot;true positive&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb331-14"><a href="preds_quantit.html#cb331-14" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">select</span>(pile_id,gt_area_m2,pred_area_m2) <span class="sc">%&gt;%</span> </span>
<span id="cb331-15"><a href="preds_quantit.html#cb331-15" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb331-16"><a href="preds_quantit.html#cb331-16" tabindex="-1"></a>          <span class="at">method =</span> <span class="st">&quot;watershed&quot;</span></span>
<span id="cb331-17"><a href="preds_quantit.html#cb331-17" tabindex="-1"></a>          , <span class="at">site =</span> all_stand_boundary <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(site_data_lab<span class="sc">==</span>x) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">pull</span>(site)</span>
<span id="cb331-18"><a href="preds_quantit.html#cb331-18" tabindex="-1"></a>        )</span>
<span id="cb331-19"><a href="preds_quantit.html#cb331-19" tabindex="-1"></a>    ) </span>
<span id="cb331-20"><a href="preds_quantit.html#cb331-20" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb331-21"><a href="preds_quantit.html#cb331-21" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">bind_rows</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb331-22"><a href="preds_quantit.html#cb331-22" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(</span>
<span id="cb331-23"><a href="preds_quantit.html#cb331-23" tabindex="-1"></a>    <span class="at">cols =</span> <span class="sc">-</span><span class="fu">c</span>(site,pile_id,method)</span>
<span id="cb331-24"><a href="preds_quantit.html#cb331-24" tabindex="-1"></a>    , <span class="at">names_to =</span> <span class="st">&quot;metric&quot;</span></span>
<span id="cb331-25"><a href="preds_quantit.html#cb331-25" tabindex="-1"></a>    , <span class="at">values_to =</span> <span class="st">&quot;value&quot;</span></span>
<span id="cb331-26"><a href="preds_quantit.html#cb331-26" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb331-27"><a href="preds_quantit.html#cb331-27" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb331-28"><a href="preds_quantit.html#cb331-28" tabindex="-1"></a>    <span class="at">which_data =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb331-29"><a href="preds_quantit.html#cb331-29" tabindex="-1"></a>        stringr<span class="sc">::</span><span class="fu">str_starts</span>(metric,<span class="st">&quot;field_&quot;</span>) <span class="sc">~</span> <span class="st">&quot;field&quot;</span></span>
<span id="cb331-30"><a href="preds_quantit.html#cb331-30" tabindex="-1"></a>        , stringr<span class="sc">::</span><span class="fu">str_starts</span>(metric,<span class="st">&quot;gt_&quot;</span>) <span class="sc">~</span> <span class="st">&quot;image-annotated&quot;</span></span>
<span id="cb331-31"><a href="preds_quantit.html#cb331-31" tabindex="-1"></a>        , stringr<span class="sc">::</span><span class="fu">str_starts</span>(metric,<span class="st">&quot;pred_&quot;</span>) <span class="sc">~</span> <span class="st">&quot;prediction&quot;</span></span>
<span id="cb331-32"><a href="preds_quantit.html#cb331-32" tabindex="-1"></a>        , T <span class="sc">~</span> <span class="st">&quot;error&quot;</span></span>
<span id="cb331-33"><a href="preds_quantit.html#cb331-33" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span> </span>
<span id="cb331-34"><a href="preds_quantit.html#cb331-34" tabindex="-1"></a>      <span class="fu">ordered</span>()</span>
<span id="cb331-35"><a href="preds_quantit.html#cb331-35" tabindex="-1"></a>    , <span class="at">pile_metric =</span> metric <span class="sc">%&gt;%</span> </span>
<span id="cb331-36"><a href="preds_quantit.html#cb331-36" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_remove</span>(<span class="st">&quot;(_rmse|_rrmse|_mean|_mape)$&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb331-37"><a href="preds_quantit.html#cb331-37" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_extract</span>(<span class="st">&quot;(area|height|diameter)&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb331-38"><a href="preds_quantit.html#cb331-38" tabindex="-1"></a>      <span class="fu">factor</span>(</span>
<span id="cb331-39"><a href="preds_quantit.html#cb331-39" tabindex="-1"></a>        <span class="at">ordered =</span> T</span>
<span id="cb331-40"><a href="preds_quantit.html#cb331-40" tabindex="-1"></a>        , <span class="at">levels =</span> <span class="fu">c</span>(</span>
<span id="cb331-41"><a href="preds_quantit.html#cb331-41" tabindex="-1"></a>          <span class="st">&quot;height&quot;</span></span>
<span id="cb331-42"><a href="preds_quantit.html#cb331-42" tabindex="-1"></a>          , <span class="st">&quot;diameter&quot;</span></span>
<span id="cb331-43"><a href="preds_quantit.html#cb331-43" tabindex="-1"></a>          , <span class="st">&quot;area&quot;</span></span>
<span id="cb331-44"><a href="preds_quantit.html#cb331-44" tabindex="-1"></a>        )</span>
<span id="cb331-45"><a href="preds_quantit.html#cb331-45" tabindex="-1"></a>        , <span class="at">labels =</span> <span class="fu">c</span>(</span>
<span id="cb331-46"><a href="preds_quantit.html#cb331-46" tabindex="-1"></a>          <span class="st">&quot;Height (m)&quot;</span></span>
<span id="cb331-47"><a href="preds_quantit.html#cb331-47" tabindex="-1"></a>          , <span class="st">&quot;Diameter (m)&quot;</span></span>
<span id="cb331-48"><a href="preds_quantit.html#cb331-48" tabindex="-1"></a>          , <span class="st">&quot;Area (m2)&quot;</span></span>
<span id="cb331-49"><a href="preds_quantit.html#cb331-49" tabindex="-1"></a>        )</span>
<span id="cb331-50"><a href="preds_quantit.html#cb331-50" tabindex="-1"></a>      )</span>
<span id="cb331-51"><a href="preds_quantit.html#cb331-51" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb331-52"><a href="preds_quantit.html#cb331-52" tabindex="-1"></a>  <span class="co"># dplyr::glimpse()</span></span>
<span id="cb331-53"><a href="preds_quantit.html#cb331-53" tabindex="-1"></a><span class="co"># plot dist</span></span>
<span id="cb331-54"><a href="preds_quantit.html#cb331-54" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">color =</span> which_data, <span class="at">fill =</span> which_data)) <span class="sc">+</span></span>
<span id="cb331-55"><a href="preds_quantit.html#cb331-55" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_density</span>(<span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">y=</span>ggplot2<span class="sc">::</span><span class="fu">after_stat</span>(scaled)), <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb331-56"><a href="preds_quantit.html#cb331-56" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">facet_grid</span>(</span>
<span id="cb331-57"><a href="preds_quantit.html#cb331-57" tabindex="-1"></a>    <span class="at">rows =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(method)</span>
<span id="cb331-58"><a href="preds_quantit.html#cb331-58" tabindex="-1"></a>    , <span class="at">cols =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(site)</span>
<span id="cb331-59"><a href="preds_quantit.html#cb331-59" tabindex="-1"></a>    , <span class="at">scales =</span> <span class="st">&quot;free_x&quot;</span>, <span class="at">axes =</span> <span class="st">&quot;all_x&quot;</span></span>
<span id="cb331-60"><a href="preds_quantit.html#cb331-60" tabindex="-1"></a>    , <span class="at">switch =</span> <span class="st">&quot;y&quot;</span></span>
<span id="cb331-61"><a href="preds_quantit.html#cb331-61" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb331-62"><a href="preds_quantit.html#cb331-62" tabindex="-1"></a>  harrypotter<span class="sc">::</span><span class="fu">scale_color_hp_d</span>(<span class="at">option =</span> <span class="st">&quot;lunalovegood&quot;</span>) <span class="sc">+</span></span>
<span id="cb331-63"><a href="preds_quantit.html#cb331-63" tabindex="-1"></a>  harrypotter<span class="sc">::</span><span class="fu">scale_fill_hp_d</span>(<span class="at">option =</span> <span class="st">&quot;lunalovegood&quot;</span>) <span class="sc">+</span></span>
<span id="cb331-64"><a href="preds_quantit.html#cb331-64" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>,<span class="at">breaks=</span><span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb331-65"><a href="preds_quantit.html#cb331-65" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb331-66"><a href="preds_quantit.html#cb331-66" tabindex="-1"></a>    <span class="at">color=</span><span class="st">&quot;&quot;</span>,<span class="at">fill=</span><span class="st">&quot;&quot;</span></span>
<span id="cb331-67"><a href="preds_quantit.html#cb331-67" tabindex="-1"></a>    , <span class="at">x=</span>latex2exp<span class="sc">::</span><span class="fu">TeX</span>(<span class="st">&quot;area $m^2$&quot;</span>)</span>
<span id="cb331-68"><a href="preds_quantit.html#cb331-68" tabindex="-1"></a>    , <span class="at">subtitle =</span> latex2exp<span class="sc">::</span><span class="fu">TeX</span>(<span class="st">&quot;Comparison of pile Area ($m^2$) distributions&quot;</span>)</span>
<span id="cb331-69"><a href="preds_quantit.html#cb331-69" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb331-70"><a href="preds_quantit.html#cb331-70" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb331-71"><a href="preds_quantit.html#cb331-71" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb331-72"><a href="preds_quantit.html#cb331-72" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;top&quot;</span></span>
<span id="cb331-73"><a href="preds_quantit.html#cb331-73" tabindex="-1"></a>    , <span class="at">strip.text =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb331-74"><a href="preds_quantit.html#cb331-74" tabindex="-1"></a>    , <span class="at">panel.grid =</span> ggplot2<span class="sc">::</span><span class="fu">element_blank</span>()</span>
<span id="cb331-75"><a href="preds_quantit.html#cb331-75" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="slash_pile_detecting_files/figure-html/unnamed-chunk-370-1.png" alt="" width="1008" /></p>
<div id="stand-level-aggregation-1" class="section level3 hasAnchor" number="9.2.1">
<h3><span class="header-section-number">9.2.1</span> Stand-level Aggregation<a href="preds_quantit.html#stand-level-aggregation-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Let’s summarize the measurement values of the predictions (true positive and false positive) and the ground truth data (true positive and false negative) over the entire stand (this is similar to a basal area comparison in a forest inventory). Summarizing the predicted and ground truth pile height and diameter form measurements for all instances across the entire study area, regardless of whether individual piles were successfully matched between datasets, for comparison provides insight into the method’s aggregated performance in predicting total pile size in an area. Such totals are often required for administrative needs like submitting burn permits which do not typically focus on individual pile quantification differences.</p>
<div class="sourceCode" id="cb332"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb332-1"><a href="preds_quantit.html#cb332-1" tabindex="-1"></a><span class="co"># do it</span></span>
<span id="cb332-2"><a href="preds_quantit.html#cb332-2" tabindex="-1"></a>sum_df_temp <span class="ot">&lt;-</span></span>
<span id="cb332-3"><a href="preds_quantit.html#cb332-3" tabindex="-1"></a>  all_stand_boundary<span class="sc">$</span>site_data_lab <span class="sc">%&gt;%</span> </span>
<span id="cb332-4"><a href="preds_quantit.html#cb332-4" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">map</span>(</span>
<span id="cb332-5"><a href="preds_quantit.html#cb332-5" tabindex="-1"></a>    \(x)</span>
<span id="cb332-6"><a href="preds_quantit.html#cb332-6" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(</span>
<span id="cb332-7"><a href="preds_quantit.html#cb332-7" tabindex="-1"></a>      dbscan_gt_pred_match[[x]] <span class="sc">%&gt;%</span> </span>
<span id="cb332-8"><a href="preds_quantit.html#cb332-8" tabindex="-1"></a>        <span class="fu">stand_agg_fn</span>(<span class="at">which_comp =</span> <span class="st">&quot;gt&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb332-9"><a href="preds_quantit.html#cb332-9" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb332-10"><a href="preds_quantit.html#cb332-10" tabindex="-1"></a>          <span class="at">method =</span> <span class="st">&quot;dbscan&quot;</span></span>
<span id="cb332-11"><a href="preds_quantit.html#cb332-11" tabindex="-1"></a>          , <span class="at">site =</span> all_stand_boundary <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(site_data_lab<span class="sc">==</span>x) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">pull</span>(site)</span>
<span id="cb332-12"><a href="preds_quantit.html#cb332-12" tabindex="-1"></a>        )</span>
<span id="cb332-13"><a href="preds_quantit.html#cb332-13" tabindex="-1"></a>      , watershed_gt_pred_match[[x]] <span class="sc">%&gt;%</span> </span>
<span id="cb332-14"><a href="preds_quantit.html#cb332-14" tabindex="-1"></a>        <span class="fu">stand_agg_fn</span>(<span class="at">which_comp =</span> <span class="st">&quot;gt&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb332-15"><a href="preds_quantit.html#cb332-15" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb332-16"><a href="preds_quantit.html#cb332-16" tabindex="-1"></a>          <span class="at">method =</span> <span class="st">&quot;watershed&quot;</span></span>
<span id="cb332-17"><a href="preds_quantit.html#cb332-17" tabindex="-1"></a>          , <span class="at">site =</span> all_stand_boundary <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(site_data_lab<span class="sc">==</span>x) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">pull</span>(site)</span>
<span id="cb332-18"><a href="preds_quantit.html#cb332-18" tabindex="-1"></a>        )</span>
<span id="cb332-19"><a href="preds_quantit.html#cb332-19" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb332-20"><a href="preds_quantit.html#cb332-20" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(</span>
<span id="cb332-21"><a href="preds_quantit.html#cb332-21" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_detect</span>(metric,<span class="st">&quot;area&quot;</span>)</span>
<span id="cb332-22"><a href="preds_quantit.html#cb332-22" tabindex="-1"></a>    ) </span>
<span id="cb332-23"><a href="preds_quantit.html#cb332-23" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb332-24"><a href="preds_quantit.html#cb332-24" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">bind_rows</span>()</span>
<span id="cb332-25"><a href="preds_quantit.html#cb332-25" tabindex="-1"></a>  </span>
<span id="cb332-26"><a href="preds_quantit.html#cb332-26" tabindex="-1"></a><span class="co"># sum_df_temp %&gt;% dplyr::glimpse()</span></span></code></pre></div>
<p>plot the aggregated, stand-level area comparison between image-annotated and predicted piles</p>
<div class="sourceCode" id="cb333"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb333-1"><a href="preds_quantit.html#cb333-1" tabindex="-1"></a><span class="co"># plot it</span></span>
<span id="cb333-2"><a href="preds_quantit.html#cb333-2" tabindex="-1"></a>sum_df_temp <span class="sc">%&gt;%</span> </span>
<span id="cb333-3"><a href="preds_quantit.html#cb333-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb333-4"><a href="preds_quantit.html#cb333-4" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb333-5"><a href="preds_quantit.html#cb333-5" tabindex="-1"></a>    <span class="at">stand_id=</span><span class="dv">1</span></span>
<span id="cb333-6"><a href="preds_quantit.html#cb333-6" tabindex="-1"></a>    , <span class="at">lab =</span> <span class="fu">paste0</span>(</span>
<span id="cb333-7"><a href="preds_quantit.html#cb333-7" tabindex="-1"></a>      scales<span class="sc">::</span><span class="fu">comma</span>(value,<span class="at">accuracy=</span><span class="fl">0.1</span>)</span>
<span id="cb333-8"><a href="preds_quantit.html#cb333-8" tabindex="-1"></a>      , dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb333-9"><a href="preds_quantit.html#cb333-9" tabindex="-1"></a>        <span class="fu">is.na</span>(pct_diff) <span class="sc">~</span> <span class="st">&quot;&quot;</span></span>
<span id="cb333-10"><a href="preds_quantit.html#cb333-10" tabindex="-1"></a>        , T <span class="sc">~</span> <span class="fu">paste0</span>(</span>
<span id="cb333-11"><a href="preds_quantit.html#cb333-11" tabindex="-1"></a>          <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span></span>
<span id="cb333-12"><a href="preds_quantit.html#cb333-12" tabindex="-1"></a>          , <span class="fu">ifelse</span>(pct_diff<span class="sc">&lt;</span><span class="dv">0</span>,<span class="st">&quot;-&quot;</span>,<span class="st">&quot;+&quot;</span>)</span>
<span id="cb333-13"><a href="preds_quantit.html#cb333-13" tabindex="-1"></a>          ,scales<span class="sc">::</span><span class="fu">percent</span>(<span class="fu">abs</span>(pct_diff),<span class="at">accuracy=</span><span class="fl">0.1</span>)</span>
<span id="cb333-14"><a href="preds_quantit.html#cb333-14" tabindex="-1"></a>        )</span>
<span id="cb333-15"><a href="preds_quantit.html#cb333-15" tabindex="-1"></a>      )</span>
<span id="cb333-16"><a href="preds_quantit.html#cb333-16" tabindex="-1"></a>    )</span>
<span id="cb333-17"><a href="preds_quantit.html#cb333-17" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb333-18"><a href="preds_quantit.html#cb333-18" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(</span>
<span id="cb333-19"><a href="preds_quantit.html#cb333-19" tabindex="-1"></a>    <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(</span>
<span id="cb333-20"><a href="preds_quantit.html#cb333-20" tabindex="-1"></a>      <span class="at">x =</span> which_data</span>
<span id="cb333-21"><a href="preds_quantit.html#cb333-21" tabindex="-1"></a>      , <span class="at">y =</span> value</span>
<span id="cb333-22"><a href="preds_quantit.html#cb333-22" tabindex="-1"></a>      , <span class="at">label =</span> lab</span>
<span id="cb333-23"><a href="preds_quantit.html#cb333-23" tabindex="-1"></a>      , <span class="at">group =</span> stand_id</span>
<span id="cb333-24"><a href="preds_quantit.html#cb333-24" tabindex="-1"></a>    )</span>
<span id="cb333-25"><a href="preds_quantit.html#cb333-25" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb333-26"><a href="preds_quantit.html#cb333-26" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_line</span>(<span class="at">key_glyph =</span> <span class="st">&quot;point&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>, <span class="at">color =</span> <span class="st">&quot;gray&quot;</span>, <span class="at">lwd =</span> <span class="fl">1.1</span>) <span class="sc">+</span></span>
<span id="cb333-27"><a href="preds_quantit.html#cb333-27" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_col</span>(<span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">fill =</span> which_data), <span class="at">alpha =</span> <span class="dv">1</span>, <span class="at">width =</span> <span class="fl">0.4</span>) <span class="sc">+</span></span>
<span id="cb333-28"><a href="preds_quantit.html#cb333-28" tabindex="-1"></a>  harrypotter<span class="sc">::</span><span class="fu">scale_color_hp_d</span>(<span class="at">option =</span> <span class="st">&quot;lunalovegood&quot;</span>) <span class="sc">+</span></span>
<span id="cb333-29"><a href="preds_quantit.html#cb333-29" tabindex="-1"></a>  harrypotter<span class="sc">::</span><span class="fu">scale_fill_hp_d</span>(<span class="at">option =</span> <span class="st">&quot;lunalovegood&quot;</span>) <span class="sc">+</span></span>
<span id="cb333-30"><a href="preds_quantit.html#cb333-30" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_text</span>(</span>
<span id="cb333-31"><a href="preds_quantit.html#cb333-31" tabindex="-1"></a>    <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.25</span></span>
<span id="cb333-32"><a href="preds_quantit.html#cb333-32" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb333-33"><a href="preds_quantit.html#cb333-33" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">facet_grid</span>(</span>
<span id="cb333-34"><a href="preds_quantit.html#cb333-34" tabindex="-1"></a>    <span class="at">rows =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(site)</span>
<span id="cb333-35"><a href="preds_quantit.html#cb333-35" tabindex="-1"></a>    , <span class="at">cols =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(method)</span>
<span id="cb333-36"><a href="preds_quantit.html#cb333-36" tabindex="-1"></a>    , <span class="at">scales =</span> <span class="st">&quot;free_y&quot;</span>, <span class="at">axes =</span> <span class="st">&quot;all_x&quot;</span></span>
<span id="cb333-37"><a href="preds_quantit.html#cb333-37" tabindex="-1"></a>    , <span class="at">switch =</span> <span class="st">&quot;y&quot;</span></span>
<span id="cb333-38"><a href="preds_quantit.html#cb333-38" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb333-39"><a href="preds_quantit.html#cb333-39" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>comma, <span class="at">expand =</span> ggplot2<span class="sc">::</span><span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="dv">0</span>,.<span class="dv">3</span>)), <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb333-40"><a href="preds_quantit.html#cb333-40" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb333-41"><a href="preds_quantit.html#cb333-41" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;&quot;</span>, <span class="at">y =</span> <span class="st">&quot;&quot;</span></span>
<span id="cb333-42"><a href="preds_quantit.html#cb333-42" tabindex="-1"></a>    , <span class="at">subtitle =</span> </span>
<span id="cb333-43"><a href="preds_quantit.html#cb333-43" tabindex="-1"></a>      latex2exp<span class="sc">::</span><span class="fu">TeX</span>(<span class="st">&quot;Comparison of aggregated pile Area ($m^2$) measurements for all sites&quot;</span>)</span>
<span id="cb333-44"><a href="preds_quantit.html#cb333-44" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb333-45"><a href="preds_quantit.html#cb333-45" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb333-46"><a href="preds_quantit.html#cb333-46" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb333-47"><a href="preds_quantit.html#cb333-47" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb333-48"><a href="preds_quantit.html#cb333-48" tabindex="-1"></a>    , <span class="at">axis.text.x =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb333-49"><a href="preds_quantit.html#cb333-49" tabindex="-1"></a>    , <span class="at">strip.text =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb333-50"><a href="preds_quantit.html#cb333-50" tabindex="-1"></a>    , <span class="at">panel.grid =</span> ggplot2<span class="sc">::</span><span class="fu">element_blank</span>()</span>
<span id="cb333-51"><a href="preds_quantit.html#cb333-51" tabindex="-1"></a>  ) </span></code></pre></div>
<p><img src="slash_pile_detecting_files/figure-html/unnamed-chunk-372-1.png" alt="" width="1008" /></p>
<p>table the aggregated, stand-level area comparison between image-annotated and predicted piles</p>
<div class="sourceCode" id="cb334"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb334-1"><a href="preds_quantit.html#cb334-1" tabindex="-1"></a>sum_df_temp <span class="sc">%&gt;%</span> </span>
<span id="cb334-2"><a href="preds_quantit.html#cb334-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb334-3"><a href="preds_quantit.html#cb334-3" tabindex="-1"></a>    <span class="at">pile_metric=</span>stringr<span class="sc">::</span><span class="fu">word</span>(pile_metric)</span>
<span id="cb334-4"><a href="preds_quantit.html#cb334-4" tabindex="-1"></a>    , <span class="at">value =</span> scales<span class="sc">::</span><span class="fu">comma</span>(value,<span class="at">accuracy=</span><span class="fl">0.1</span>)</span>
<span id="cb334-5"><a href="preds_quantit.html#cb334-5" tabindex="-1"></a>    , <span class="at">pct_diff =</span> scales<span class="sc">::</span><span class="fu">percent</span>(pct_diff,<span class="at">accuracy=</span><span class="fl">0.1</span>)</span>
<span id="cb334-6"><a href="preds_quantit.html#cb334-6" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb334-7"><a href="preds_quantit.html#cb334-7" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_wider</span>(</span>
<span id="cb334-8"><a href="preds_quantit.html#cb334-8" tabindex="-1"></a>    <span class="at">id_cols =</span> <span class="fu">c</span>(site,method)</span>
<span id="cb334-9"><a href="preds_quantit.html#cb334-9" tabindex="-1"></a>    , <span class="at">values_from =</span> <span class="fu">c</span>(value,pct_diff)</span>
<span id="cb334-10"><a href="preds_quantit.html#cb334-10" tabindex="-1"></a>    , <span class="at">names_from =</span> <span class="fu">c</span>(pile_metric,which_data)</span>
<span id="cb334-11"><a href="preds_quantit.html#cb334-11" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb334-12"><a href="preds_quantit.html#cb334-12" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(dplyr<span class="sc">::</span><span class="fu">where</span>(<span class="sc">~</span> <span class="sc">!</span><span class="fu">all</span>(<span class="fu">is.na</span>(.x)))) <span class="sc">%&gt;%</span> </span>
<span id="cb334-13"><a href="preds_quantit.html#cb334-13" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename_with</span>(</span>
<span id="cb334-14"><a href="preds_quantit.html#cb334-14" tabindex="-1"></a>    <span class="at">.cols =</span> dplyr<span class="sc">::</span><span class="fu">everything</span>()</span>
<span id="cb334-15"><a href="preds_quantit.html#cb334-15" tabindex="-1"></a>    , <span class="at">.fn =</span> <span class="sc">~</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb334-16"><a href="preds_quantit.html#cb334-16" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_starts</span>(.x,<span class="st">&quot;value_&quot;</span>) <span class="sc">~</span> stringr<span class="sc">::</span><span class="fu">str_remove</span>(.x,<span class="st">&quot;^value_&quot;</span>) <span class="sc">%&gt;%</span> stringr<span class="sc">::</span><span class="fu">str_c</span>(<span class="st">&quot;_value&quot;</span>)</span>
<span id="cb334-17"><a href="preds_quantit.html#cb334-17" tabindex="-1"></a>      , stringr<span class="sc">::</span><span class="fu">str_starts</span>(.x,<span class="st">&quot;pct_diff_&quot;</span>) <span class="sc">~</span> stringr<span class="sc">::</span><span class="fu">str_remove</span>(.x,<span class="st">&quot;^pct_diff_&quot;</span>) <span class="sc">%&gt;%</span> stringr<span class="sc">::</span><span class="fu">str_c</span>(<span class="st">&quot;_zzpct_diff&quot;</span>)</span>
<span id="cb334-18"><a href="preds_quantit.html#cb334-18" tabindex="-1"></a>      , T <span class="sc">~</span> .x</span>
<span id="cb334-19"><a href="preds_quantit.html#cb334-19" tabindex="-1"></a>    )</span>
<span id="cb334-20"><a href="preds_quantit.html#cb334-20" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb334-21"><a href="preds_quantit.html#cb334-21" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">order</span>(<span class="fu">colnames</span>(.))) <span class="sc">%&gt;%</span> </span>
<span id="cb334-22"><a href="preds_quantit.html#cb334-22" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">relocate</span>(site,method) <span class="sc">%&gt;%</span> </span>
<span id="cb334-23"><a href="preds_quantit.html#cb334-23" tabindex="-1"></a>  <span class="co"># dplyr::glimpse()</span></span>
<span id="cb334-24"><a href="preds_quantit.html#cb334-24" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(site,method) <span class="sc">%&gt;%</span> </span>
<span id="cb334-25"><a href="preds_quantit.html#cb334-25" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kbl</span>(</span>
<span id="cb334-26"><a href="preds_quantit.html#cb334-26" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">&quot;Comparison of aggregated area measurements for all sites&quot;</span></span>
<span id="cb334-27"><a href="preds_quantit.html#cb334-27" tabindex="-1"></a>    , <span class="at">col.names =</span> <span class="fu">c</span>(</span>
<span id="cb334-28"><a href="preds_quantit.html#cb334-28" tabindex="-1"></a>      <span class="st">&quot;site&quot;</span>, <span class="st">&quot;method&quot;</span></span>
<span id="cb334-29"><a href="preds_quantit.html#cb334-29" tabindex="-1"></a>      , <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;Image-annotated&quot;</span>,<span class="st">&quot;Predicted&quot;</span>,<span class="st">&quot;Pct Diff&quot;</span>), <span class="at">times =</span> <span class="dv">1</span>)</span>
<span id="cb334-30"><a href="preds_quantit.html#cb334-30" tabindex="-1"></a>    )</span>
<span id="cb334-31"><a href="preds_quantit.html#cb334-31" tabindex="-1"></a>    , <span class="at">escape =</span> F</span>
<span id="cb334-32"><a href="preds_quantit.html#cb334-32" tabindex="-1"></a>    <span class="co"># , digits = 2</span></span>
<span id="cb334-33"><a href="preds_quantit.html#cb334-33" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb334-34"><a href="preds_quantit.html#cb334-34" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kable_styling</span>(<span class="at">font_size =</span> <span class="fl">11.5</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb334-35"><a href="preds_quantit.html#cb334-35" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">add_header_above</span>(<span class="fu">c</span>(</span>
<span id="cb334-36"><a href="preds_quantit.html#cb334-36" tabindex="-1"></a>    <span class="st">&quot; &quot;</span><span class="ot">=</span><span class="dv">2</span></span>
<span id="cb334-37"><a href="preds_quantit.html#cb334-37" tabindex="-1"></a>    <span class="co"># , &quot;Detection&quot; = 3</span></span>
<span id="cb334-38"><a href="preds_quantit.html#cb334-38" tabindex="-1"></a>    <span class="co"># , &quot;Area&quot; = 3</span></span>
<span id="cb334-39"><a href="preds_quantit.html#cb334-39" tabindex="-1"></a>    , <span class="st">&quot;Area (m&lt;sup&gt;2&lt;/sup&gt;)&quot;</span> <span class="ot">=</span> <span class="dv">3</span></span>
<span id="cb334-40"><a href="preds_quantit.html#cb334-40" tabindex="-1"></a>  ),<span class="at">escape =</span> F) <span class="sc">%&gt;%</span> </span>
<span id="cb334-41"><a href="preds_quantit.html#cb334-41" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">column_spec</span>(<span class="fu">seq</span>(<span class="dv">2</span>,<span class="dv">5</span>,<span class="at">by=</span><span class="dv">3</span>), <span class="at">border_right =</span> <span class="cn">TRUE</span>, <span class="at">include_thead =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb334-42"><a href="preds_quantit.html#cb334-42" tabindex="-1"></a>  <span class="co"># kableExtra::column_spec(</span></span>
<span id="cb334-43"><a href="preds_quantit.html#cb334-43" tabindex="-1"></a>  <span class="co">#   column = 3:9</span></span>
<span id="cb334-44"><a href="preds_quantit.html#cb334-44" tabindex="-1"></a>  <span class="co">#   , extra_css = &quot;font-size: 10px;&quot;</span></span>
<span id="cb334-45"><a href="preds_quantit.html#cb334-45" tabindex="-1"></a>  <span class="co">#   , include_thead = T</span></span>
<span id="cb334-46"><a href="preds_quantit.html#cb334-46" tabindex="-1"></a>  <span class="co"># ) %&gt;% </span></span>
<span id="cb334-47"><a href="preds_quantit.html#cb334-47" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">collapse_rows</span>(<span class="at">columns =</span> <span class="dv">1</span>, <span class="at">valign =</span> <span class="st">&quot;top&quot;</span>)</span></code></pre></div>
<table class="table" style="font-size: 11.5px; margin-left: auto; margin-right: auto;">
<caption style="font-size: initial !important;">
<span id="tab:unnamed-chunk-373">Table 9.4: </span>Comparison of aggregated area measurements for all sites
</caption>
<thead>
<tr>
<th style="empty-cells: hide;border-bottom:hidden;" colspan="2">
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="3">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Area (m<sup>2</sup>)
</div>
</th>
</tr>
<tr>
<th style="text-align:left;">
site
</th>
<th style="text-align:left;border-right:1px solid;">
method
</th>
<th style="text-align:left;">
Image-annotated
</th>
<th style="text-align:left;">
Predicted
</th>
<th style="text-align:left;border-right:1px solid;">
Pct Diff
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="2">
ARNF Ponderosa Pine Site
</td>
<td style="text-align:left;border-right:1px solid;">
dbscan
</td>
<td style="text-align:left;">
7,770.4
</td>
<td style="text-align:left;">
8,553.0
</td>
<td style="text-align:left;border-right:1px solid;">
10.1%
</td>
</tr>
<tr>
<td style="text-align:left;border-right:1px solid;">
watershed
</td>
<td style="text-align:left;">
7,770.4
</td>
<td style="text-align:left;">
8,487.8
</td>
<td style="text-align:left;border-right:1px solid;">
9.2%
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="2">
BHEF Ponderosa Pine Site
</td>
<td style="text-align:left;border-right:1px solid;">
dbscan
</td>
<td style="text-align:left;">
5,198.6
</td>
<td style="text-align:left;">
4,339.2
</td>
<td style="text-align:left;border-right:1px solid;">
-16.5%
</td>
</tr>
<tr>
<td style="text-align:left;border-right:1px solid;">
watershed
</td>
<td style="text-align:left;">
5,198.6
</td>
<td style="text-align:left;">
4,434.4
</td>
<td style="text-align:left;border-right:1px solid;">
-14.7%
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="2">
PSINF Mixed Conifer Site
</td>
<td style="text-align:left;border-right:1px solid;">
dbscan
</td>
<td style="text-align:left;">
1,185.5
</td>
<td style="text-align:left;">
1,072.5
</td>
<td style="text-align:left;border-right:1px solid;">
-9.5%
</td>
</tr>
<tr>
<td style="text-align:left;border-right:1px solid;">
watershed
</td>
<td style="text-align:left;">
1,185.5
</td>
<td style="text-align:left;">
1,112.7
</td>
<td style="text-align:left;border-right:1px solid;">
-6.1%
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="2">
TRFO-BLM Pinyon-Juniper Site
</td>
<td style="text-align:left;border-right:1px solid;">
dbscan
</td>
<td style="text-align:left;">
2,942.6
</td>
<td style="text-align:left;">
2,941.5
</td>
<td style="text-align:left;border-right:1px solid;">
0.0%
</td>
</tr>
<tr>
<td style="text-align:left;border-right:1px solid;">
watershed
</td>
<td style="text-align:left;">
2,942.6
</td>
<td style="text-align:left;">
2,911.4
</td>
<td style="text-align:left;border-right:1px solid;">
-1.1%
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="vol_comp" class="section level2 hasAnchor" number="9.3">
<h2><span class="header-section-number">9.3</span> Volume Comparison<a href="preds_quantit.html#vol_comp" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We excluded quantification accuracy metrics for derived volume because the resulting value would not constitute a true “error”. Comparing our predicted volume to a volume that was <em>not</em> directly measured, but instead calculated using a geometric assumption (like assuming a perfectly circular base and paraboloid shape) would be inappropriate. This is because any resulting difference between the prediction and the ground truth would be a blend of three inseparable factors: the error of the remote-sensing prediction method, the error in the direct field measurements (diameter/height), and the error introduced by the geometric shape assumption. Reporting such combined errors would be misleading, as it would be impossible to isolate the true performance of our remote-sensing method alone.</p>
<p>Instead, data involving derived values of volume based on field measurements and a shape assumption and its comparison to our irregularly shaped CHM-derived volume will be treated simply as data points for insight into the differences. Using geometric shape assumptions for estimating pile volume is the standard practice when implementing prescriptions or preparing for slash pile burning (<a href="https://permanent.fdlp.gov/gpo45282/index.htm">Hardy 1996</a>; <a href="https://doi.org/10.5849/forsci.13-501">Long &amp; Boston 2014</a>). This comparison will help us understand the discrepancy between our irregularly shaped CHM-derived volume and the volume calculated assuming a perfectly circular base and paraboloid shape with field-measured height and diameter. This approach will still provide valuable context about the impact of the perfectly circular base and paraboloid geometric assumptions without falsely attributing the error of the simplified model to the remote-sensing method itself.</p>
<p>let’s do that now</p>
<ul>
<li><strong>field-measured piles</strong>
<ul>
<li><strong>volume</strong> assumes a paraboloid shape, with volume calculated using the field-measured diameter (as the width) and height. we’ll refer to this as “Allometric Field Volume” to indicate the field measurement is derived using a shape assumption.</li>
</ul></li>
<li><strong>predicted piles</strong>
<ul>
<li><strong>volume</strong> calculated from the elevation profile of the irregular predicted pile footprint, without assuming a specific geometric shape. we’ll refer to this as “Predicted Volume” to indicate the predicted measurement is from our CHM-based detection methodology</li>
</ul></li>
</ul>
<p>We would generally expect that the allometric field volume is larger than the predicted volume because the allometric calculation assumes a perfectly regular geometric shape (circular base and paraboloid) based on maximum field dimensions (height and diameter). this process effectively encloses the actual, irregular pile form within a simplified geometric dome which inherently neglects and sits above the actual irregularities and voids in the pile structure, likely leading to an overestimation of the volume.</p>
<p>we already added volume measurements to the TP matches for both the ground truth and predicted piles, summary of that data</p>
<div class="sourceCode" id="cb335"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb335-1"><a href="preds_quantit.html#cb335-1" tabindex="-1"></a>dbscan_gt_pred_match[[<span class="st">&quot;psinf&quot;</span>]] <span class="sc">%&gt;%</span> </span>
<span id="cb335-2"><a href="preds_quantit.html#cb335-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(match_grp<span class="sc">==</span><span class="st">&quot;true positive&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb335-3"><a href="preds_quantit.html#cb335-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(field_volume_m3, pred_volume_m3) <span class="sc">%&gt;%</span> </span>
<span id="cb335-4"><a href="preds_quantit.html#cb335-4" tabindex="-1"></a>  <span class="fu">summary</span>()</span></code></pre></div>
<pre><code>##  field_volume_m3   pred_volume_m3  
##  Min.   :  4.270   Min.   : 1.710  
##  1st Qu.:  6.602   1st Qu.: 4.449  
##  Median :  7.536   Median : 5.346  
##  Mean   : 15.403   Mean   : 8.889  
##  3rd Qu.:  8.777   3rd Qu.: 7.341  
##  Max.   :183.080   Max.   :89.497</code></pre>
<p>those don’t really look like they match up well…let’s explore</p>
<div class="sourceCode" id="cb337"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb337-1"><a href="preds_quantit.html#cb337-1" tabindex="-1"></a>dbscan_gt_pred_match[[<span class="st">&quot;psinf&quot;</span>]] <span class="sc">%&gt;%</span> </span>
<span id="cb337-2"><a href="preds_quantit.html#cb337-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(match_grp<span class="sc">==</span><span class="st">&quot;true positive&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb337-3"><a href="preds_quantit.html#cb337-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">diff_volume_m3 =</span> field_volume_m3 <span class="sc">-</span> pred_volume_m3) <span class="sc">%&gt;%</span> </span>
<span id="cb337-4"><a href="preds_quantit.html#cb337-4" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">y =</span> field_volume_m3, <span class="at">x =</span> pred_volume_m3)) <span class="sc">+</span></span>
<span id="cb337-5"><a href="preds_quantit.html#cb337-5" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_abline</span>(<span class="at">lwd =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb337-6"><a href="preds_quantit.html#cb337-6" tabindex="-1"></a>  <span class="co"># ggplot2::geom_point(ggplot2::aes(color = diff_volume_m3)) +</span></span>
<span id="cb337-7"><a href="preds_quantit.html#cb337-7" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">&quot;navy&quot;</span>) <span class="sc">+</span></span>
<span id="cb337-8"><a href="preds_quantit.html#cb337-8" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="at">se=</span>F, <span class="at">color =</span> <span class="st">&quot;tomato&quot;</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb337-9"><a href="preds_quantit.html#cb337-9" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_color_viridis_c</span>(<span class="at">option =</span> <span class="st">&quot;mako&quot;</span>, <span class="at">direction =</span> <span class="sc">-</span><span class="dv">1</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb337-10"><a href="preds_quantit.html#cb337-10" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">max</span>( <span class="fu">max</span>(dbscan_gt_pred_match[[<span class="st">&quot;psinf&quot;</span>]]<span class="sc">$</span>pred_volume_m3,<span class="at">na.rm=</span>T), <span class="fu">max</span>(dbscan_gt_pred_match[[<span class="st">&quot;psinf&quot;</span>]]<span class="sc">$</span>field_volume_m3,<span class="at">na.rm=</span>T) ) )) <span class="sc">+</span></span>
<span id="cb337-11"><a href="preds_quantit.html#cb337-11" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">max</span>( <span class="fu">max</span>(dbscan_gt_pred_match[[<span class="st">&quot;psinf&quot;</span>]]<span class="sc">$</span>pred_volume_m3,<span class="at">na.rm=</span>T), <span class="fu">max</span>(dbscan_gt_pred_match[[<span class="st">&quot;psinf&quot;</span>]]<span class="sc">$</span>field_volume_m3,<span class="at">na.rm=</span>T) ) )) <span class="sc">+</span></span>
<span id="cb337-12"><a href="preds_quantit.html#cb337-12" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb337-13"><a href="preds_quantit.html#cb337-13" tabindex="-1"></a>    <span class="at">y =</span> latex2exp<span class="sc">::</span><span class="fu">TeX</span>(<span class="st">&quot;allometric field volume $m^3$&quot;</span>)</span>
<span id="cb337-14"><a href="preds_quantit.html#cb337-14" tabindex="-1"></a>    , <span class="at">x =</span> latex2exp<span class="sc">::</span><span class="fu">TeX</span>(<span class="st">&quot;predicted volume $m^3$&quot;</span>)</span>
<span id="cb337-15"><a href="preds_quantit.html#cb337-15" tabindex="-1"></a>    <span class="co"># , color = &quot;image-field\ndiameter diff.&quot;</span></span>
<span id="cb337-16"><a href="preds_quantit.html#cb337-16" tabindex="-1"></a>    , <span class="at">subtitle =</span> latex2exp<span class="sc">::</span><span class="fu">TeX</span>(<span class="st">&quot;bulk volume ($m^3$) comparison&quot;</span>)</span>
<span id="cb337-17"><a href="preds_quantit.html#cb337-17" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb337-18"><a href="preds_quantit.html#cb337-18" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_light</span>()</span></code></pre></div>
<p><img src="slash_pile_detecting_files/figure-html/unnamed-chunk-376-1.png" alt="" width="1008" /></p>
<p>this is exactly what we expected: for true positive matches, there is a clear systematic difference with the plot showing that the volume calculated using the idealized, regular shape assumption (allometric field volume) is consistently larger than the predicted volume derived from the CHM</p>
<p>let’s check these using <code>lm()</code></p>
<div class="sourceCode" id="cb338"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb338-1"><a href="preds_quantit.html#cb338-1" tabindex="-1"></a>lm_temp <span class="ot">&lt;-</span> <span class="fu">lm</span>(field_volume_m3 <span class="sc">~</span> pred_volume_m3, <span class="at">data =</span> dbscan_gt_pred_match[[<span class="st">&quot;psinf&quot;</span>]] <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(match_grp<span class="sc">==</span><span class="st">&quot;true positive&quot;</span>))</span>
<span id="cb338-2"><a href="preds_quantit.html#cb338-2" tabindex="-1"></a><span class="fu">summary</span>(lm_temp)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = field_volume_m3 ~ pred_volume_m3, data = dbscan_gt_pred_match[[&quot;psinf&quot;]] %&gt;% 
##     dplyr::filter(match_grp == &quot;true positive&quot;))
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -33.505  -2.876  -0.166   2.393  61.011 
## 
## Coefficients:
##                Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)     -3.5787     1.1270  -3.175  0.00193 ** 
## pred_volume_m3   2.1353     0.0725  29.453  &lt; 2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 9.915 on 113 degrees of freedom
## Multiple R-squared:  0.8847, Adjusted R-squared:  0.8837 
## F-statistic: 867.5 on 1 and 113 DF,  p-value: &lt; 2.2e-16</code></pre>
<p>These linear model results (intercept = -3.58, slope = 2.14) indicate a strong proportional bias that significantly increases with pile size. The high slope (2.14) coupled with the negative intercept (-3.58) indicate that the volume difference is not a simple constant offset (e.g. slope of ~1.0 and intercept of &gt;0 if our hypothesis of consistently higher allometric field volume is true), but rather a scaling issue that is driven by the largest piles. The much larger allometric field volume estimates relative to the CHM-predicted volumes for the largest piles exert a strong influence on the predicted form of the liner model, pulling the slope steeply upward and forcing the intercept below zero as a mathematical artifact. Despite the predicted negative intercept, visual inspection of the data shows that most allometric field volumes are larger than the CHM-predicted volumes, even for smaller piles. The slope value indicates that for every 1 m<sup>3</sup> increase in predicted volume, the allometric field volume increases by nearly 2.14 m<sup>3</sup>. This data suggests that the geometric assumptions of the allometric model potentially introduce substantial scaling error which may limit its reliability (especially for larger piles) for accurately estimating the volume of real-world piles which have heterogeneous footprints and elevation profiles.</p>
<p>before we compare the volume measurements in aggregate, let’s look at the distributions</p>
<div class="sourceCode" id="cb340"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb340-1"><a href="preds_quantit.html#cb340-1" tabindex="-1"></a>vol_df_temp <span class="ot">&lt;-</span> </span>
<span id="cb340-2"><a href="preds_quantit.html#cb340-2" tabindex="-1"></a>  dbscan_gt_pred_match[[<span class="st">&quot;psinf&quot;</span>]] <span class="sc">%&gt;%</span> </span>
<span id="cb340-3"><a href="preds_quantit.html#cb340-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(match_grp<span class="sc">==</span><span class="st">&quot;true positive&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb340-4"><a href="preds_quantit.html#cb340-4" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(pile_id,field_volume_m3,pred_volume_m3) <span class="sc">%&gt;%</span> </span>
<span id="cb340-5"><a href="preds_quantit.html#cb340-5" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span><span class="fu">c</span>(pile_id)) <span class="sc">%&gt;%</span> </span>
<span id="cb340-6"><a href="preds_quantit.html#cb340-6" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb340-7"><a href="preds_quantit.html#cb340-7" tabindex="-1"></a>    <span class="at">name =</span> <span class="fu">factor</span>(</span>
<span id="cb340-8"><a href="preds_quantit.html#cb340-8" tabindex="-1"></a>      name</span>
<span id="cb340-9"><a href="preds_quantit.html#cb340-9" tabindex="-1"></a>      , <span class="at">ordered =</span> T</span>
<span id="cb340-10"><a href="preds_quantit.html#cb340-10" tabindex="-1"></a>      , <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;field_volume_m3&quot;</span>,<span class="st">&quot;pred_volume_m3&quot;</span>)</span>
<span id="cb340-11"><a href="preds_quantit.html#cb340-11" tabindex="-1"></a>      , <span class="at">labels =</span> <span class="fu">c</span>(</span>
<span id="cb340-12"><a href="preds_quantit.html#cb340-12" tabindex="-1"></a>        <span class="st">&quot;allometric field volume&quot;</span></span>
<span id="cb340-13"><a href="preds_quantit.html#cb340-13" tabindex="-1"></a>        , <span class="st">&quot;predicted volume&quot;</span></span>
<span id="cb340-14"><a href="preds_quantit.html#cb340-14" tabindex="-1"></a>      )</span>
<span id="cb340-15"><a href="preds_quantit.html#cb340-15" tabindex="-1"></a>    )</span>
<span id="cb340-16"><a href="preds_quantit.html#cb340-16" tabindex="-1"></a>  ) </span>
<span id="cb340-17"><a href="preds_quantit.html#cb340-17" tabindex="-1"></a><span class="co"># plot dist</span></span>
<span id="cb340-18"><a href="preds_quantit.html#cb340-18" tabindex="-1"></a>vol_df_temp <span class="sc">%&gt;%</span> </span>
<span id="cb340-19"><a href="preds_quantit.html#cb340-19" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">color =</span> name, <span class="at">fill =</span> name)) <span class="sc">+</span></span>
<span id="cb340-20"><a href="preds_quantit.html#cb340-20" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_density</span>(<span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">y=</span>ggplot2<span class="sc">::</span><span class="fu">after_stat</span>(scaled)), <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb340-21"><a href="preds_quantit.html#cb340-21" tabindex="-1"></a>  harrypotter<span class="sc">::</span><span class="fu">scale_color_hp_d</span>(<span class="at">option =</span> <span class="st">&quot;lunalovegood&quot;</span>) <span class="sc">+</span></span>
<span id="cb340-22"><a href="preds_quantit.html#cb340-22" tabindex="-1"></a>  harrypotter<span class="sc">::</span><span class="fu">scale_fill_hp_d</span>(<span class="at">option =</span> <span class="st">&quot;lunalovegood&quot;</span>) <span class="sc">+</span></span>
<span id="cb340-23"><a href="preds_quantit.html#cb340-23" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>,<span class="at">breaks=</span><span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb340-24"><a href="preds_quantit.html#cb340-24" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb340-25"><a href="preds_quantit.html#cb340-25" tabindex="-1"></a>    <span class="at">color=</span><span class="st">&quot;&quot;</span>,<span class="at">fill=</span><span class="st">&quot;&quot;</span>,<span class="at">x=</span>latex2exp<span class="sc">::</span><span class="fu">TeX</span>(<span class="st">&quot;volume $m^3$&quot;</span>)</span>
<span id="cb340-26"><a href="preds_quantit.html#cb340-26" tabindex="-1"></a>    , <span class="at">subtitle =</span> latex2exp<span class="sc">::</span><span class="fu">TeX</span>(<span class="st">&quot;bulk volume ($m^3$) comparison of distributions&quot;</span>)</span>
<span id="cb340-27"><a href="preds_quantit.html#cb340-27" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb340-28"><a href="preds_quantit.html#cb340-28" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb340-29"><a href="preds_quantit.html#cb340-29" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb340-30"><a href="preds_quantit.html#cb340-30" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;top&quot;</span></span>
<span id="cb340-31"><a href="preds_quantit.html#cb340-31" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="slash_pile_detecting_files/figure-html/unnamed-chunk-378-1.png" alt="" width="1008" /></p>
<p>slope plots are neat too</p>
<div class="sourceCode" id="cb341"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb341-1"><a href="preds_quantit.html#cb341-1" tabindex="-1"></a>vol_df_temp <span class="sc">%&gt;%</span> </span>
<span id="cb341-2"><a href="preds_quantit.html#cb341-2" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(</span>
<span id="cb341-3"><a href="preds_quantit.html#cb341-3" tabindex="-1"></a>    <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> name, <span class="at">y =</span> value, <span class="at">group =</span> pile_id)</span>
<span id="cb341-4"><a href="preds_quantit.html#cb341-4" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb341-5"><a href="preds_quantit.html#cb341-5" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_line</span>(<span class="at">key_glyph =</span> <span class="st">&quot;point&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>, <span class="at">color =</span> <span class="st">&quot;gray&quot;</span>, <span class="at">lwd =</span> <span class="fl">1.1</span>) <span class="sc">+</span></span>
<span id="cb341-6"><a href="preds_quantit.html#cb341-6" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_point</span>(<span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">color =</span> name), <span class="at">alpha =</span> <span class="fl">0.7</span>, <span class="at">size =</span> <span class="fl">2.5</span>) <span class="sc">+</span></span>
<span id="cb341-7"><a href="preds_quantit.html#cb341-7" tabindex="-1"></a>  harrypotter<span class="sc">::</span><span class="fu">scale_color_hp_d</span>(<span class="at">option =</span> <span class="st">&quot;lunalovegood&quot;</span>) <span class="sc">+</span></span>
<span id="cb341-8"><a href="preds_quantit.html#cb341-8" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb341-9"><a href="preds_quantit.html#cb341-9" tabindex="-1"></a>    <span class="at">color=</span><span class="st">&quot;&quot;</span></span>
<span id="cb341-10"><a href="preds_quantit.html#cb341-10" tabindex="-1"></a>    , <span class="at">y =</span> latex2exp<span class="sc">::</span><span class="fu">TeX</span>(<span class="st">&quot;volume $m^3$&quot;</span>)</span>
<span id="cb341-11"><a href="preds_quantit.html#cb341-11" tabindex="-1"></a>    , <span class="at">x =</span> <span class="st">&quot;&quot;</span></span>
<span id="cb341-12"><a href="preds_quantit.html#cb341-12" tabindex="-1"></a>    , <span class="at">subtitle =</span> latex2exp<span class="sc">::</span><span class="fu">TeX</span>(<span class="st">&quot;bulk volume ($m^3$) comparison at the pile level&quot;</span>)</span>
<span id="cb341-13"><a href="preds_quantit.html#cb341-13" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb341-14"><a href="preds_quantit.html#cb341-14" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb341-15"><a href="preds_quantit.html#cb341-15" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb341-16"><a href="preds_quantit.html#cb341-16" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb341-17"><a href="preds_quantit.html#cb341-17" tabindex="-1"></a>    , <span class="at">axis.title =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>)</span>
<span id="cb341-18"><a href="preds_quantit.html#cb341-18" tabindex="-1"></a>    , <span class="at">axis.text =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>)</span>
<span id="cb341-19"><a href="preds_quantit.html#cb341-19" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="slash_pile_detecting_files/figure-html/unnamed-chunk-379-1.png" alt="" width="1008" /></p>
<p>what if we only look at the smaller piles?</p>
<div class="sourceCode" id="cb342"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb342-1"><a href="preds_quantit.html#cb342-1" tabindex="-1"></a>vol_df_temp <span class="sc">%&gt;%</span> </span>
<span id="cb342-2"><a href="preds_quantit.html#cb342-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb342-3"><a href="preds_quantit.html#cb342-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">x =</span> value <span class="sc">&lt;</span> <span class="fu">quantile</span>(vol_df_temp<span class="sc">$</span>value, <span class="at">probs =</span> <span class="fl">0.90</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb342-4"><a href="preds_quantit.html#cb342-4" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(pile_id) <span class="sc">%&gt;%</span> </span>
<span id="cb342-5"><a href="preds_quantit.html#cb342-5" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(</span>
<span id="cb342-6"><a href="preds_quantit.html#cb342-6" tabindex="-1"></a>    <span class="fu">max</span>(x) <span class="sc">==</span> <span class="dv">1</span></span>
<span id="cb342-7"><a href="preds_quantit.html#cb342-7" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb342-8"><a href="preds_quantit.html#cb342-8" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(</span>
<span id="cb342-9"><a href="preds_quantit.html#cb342-9" tabindex="-1"></a>    <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> name, <span class="at">y =</span> value, <span class="at">group =</span> pile_id)</span>
<span id="cb342-10"><a href="preds_quantit.html#cb342-10" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb342-11"><a href="preds_quantit.html#cb342-11" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_line</span>(<span class="at">key_glyph =</span> <span class="st">&quot;point&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>, <span class="at">color =</span> <span class="st">&quot;gray&quot;</span>, <span class="at">lwd =</span> <span class="fl">1.1</span>) <span class="sc">+</span></span>
<span id="cb342-12"><a href="preds_quantit.html#cb342-12" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_point</span>(<span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">color =</span> name), <span class="at">alpha =</span> <span class="fl">0.7</span>, <span class="at">size =</span> <span class="fl">2.5</span>) <span class="sc">+</span></span>
<span id="cb342-13"><a href="preds_quantit.html#cb342-13" tabindex="-1"></a>  harrypotter<span class="sc">::</span><span class="fu">scale_color_hp_d</span>(<span class="at">option =</span> <span class="st">&quot;lunalovegood&quot;</span>) <span class="sc">+</span></span>
<span id="cb342-14"><a href="preds_quantit.html#cb342-14" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb342-15"><a href="preds_quantit.html#cb342-15" tabindex="-1"></a>    <span class="at">color=</span><span class="st">&quot;&quot;</span></span>
<span id="cb342-16"><a href="preds_quantit.html#cb342-16" tabindex="-1"></a>    , <span class="at">y =</span> latex2exp<span class="sc">::</span><span class="fu">TeX</span>(<span class="st">&quot;volume $m^3$&quot;</span>)</span>
<span id="cb342-17"><a href="preds_quantit.html#cb342-17" tabindex="-1"></a>    , <span class="at">x =</span> <span class="st">&quot;&quot;</span></span>
<span id="cb342-18"><a href="preds_quantit.html#cb342-18" tabindex="-1"></a>    , <span class="at">subtitle =</span> latex2exp<span class="sc">::</span><span class="fu">TeX</span>(<span class="st">&quot;bulk volume ($m^3$) comparison at the pile level for the smaller piles&quot;</span>)</span>
<span id="cb342-19"><a href="preds_quantit.html#cb342-19" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb342-20"><a href="preds_quantit.html#cb342-20" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb342-21"><a href="preds_quantit.html#cb342-21" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb342-22"><a href="preds_quantit.html#cb342-22" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb342-23"><a href="preds_quantit.html#cb342-23" tabindex="-1"></a>    , <span class="at">axis.title =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>)</span>
<span id="cb342-24"><a href="preds_quantit.html#cb342-24" tabindex="-1"></a>    , <span class="at">axis.text =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>)</span>
<span id="cb342-25"><a href="preds_quantit.html#cb342-25" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="slash_pile_detecting_files/figure-html/unnamed-chunk-380-1.png" alt="" width="1008" /></p>
<p>let’s compare aggregated volume measurements for the true positive matches</p>
<p><strong>Mean Difference (MD):</strong>
<span class="math display">\[\text{MD} = \frac{1}{N} \sum_{i=1}^{N} (\text{Allometric Volume}_i - \text{Predicted Volume}_i)\]</span></p>
<p><strong>Percent Mean Difference:</strong>
<span class="math display">\[\%\text{MD} = \frac{\text{MD}}{\text{Mean}(\text{Predicted Volume})} \times 100\]</span></p>
<div class="sourceCode" id="cb343"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb343-1"><a href="preds_quantit.html#cb343-1" tabindex="-1"></a>vol_agg_df_temp <span class="ot">&lt;-</span> </span>
<span id="cb343-2"><a href="preds_quantit.html#cb343-2" tabindex="-1"></a>  dbscan_gt_pred_match[[<span class="st">&quot;psinf&quot;</span>]] <span class="sc">%&gt;%</span> </span>
<span id="cb343-3"><a href="preds_quantit.html#cb343-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(match_grp<span class="sc">==</span><span class="st">&quot;true positive&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb343-4"><a href="preds_quantit.html#cb343-4" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb343-5"><a href="preds_quantit.html#cb343-5" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(</span>
<span id="cb343-6"><a href="preds_quantit.html#cb343-6" tabindex="-1"></a>    <span class="at">mean_diff =</span> <span class="fu">mean</span>(field_volume_m3<span class="sc">-</span>pred_volume_m3)</span>
<span id="cb343-7"><a href="preds_quantit.html#cb343-7" tabindex="-1"></a>    , <span class="at">sd_diff =</span> <span class="fu">sd</span>(field_volume_m3<span class="sc">-</span>pred_volume_m3)</span>
<span id="cb343-8"><a href="preds_quantit.html#cb343-8" tabindex="-1"></a>    , <span class="at">mean_field_volume_m3 =</span> <span class="fu">mean</span>(field_volume_m3,<span class="at">na.rm =</span> T)</span>
<span id="cb343-9"><a href="preds_quantit.html#cb343-9" tabindex="-1"></a>    , <span class="at">mean_pred_volume_m3 =</span> <span class="fu">mean</span>(pred_volume_m3,<span class="at">na.rm =</span> T)</span>
<span id="cb343-10"><a href="preds_quantit.html#cb343-10" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb343-11"><a href="preds_quantit.html#cb343-11" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb343-12"><a href="preds_quantit.html#cb343-12" tabindex="-1"></a>    <span class="at">pct_mean_diff =</span> mean_diff<span class="sc">/</span>mean_pred_volume_m3</span>
<span id="cb343-13"><a href="preds_quantit.html#cb343-13" tabindex="-1"></a>  )</span></code></pre></div>
<p>what did we get?</p>
<div class="sourceCode" id="cb344"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb344-1"><a href="preds_quantit.html#cb344-1" tabindex="-1"></a>vol_agg_df_temp <span class="sc">%&gt;%</span> </span>
<span id="cb344-2"><a href="preds_quantit.html#cb344-2" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(dplyr<span class="sc">::</span><span class="fu">everything</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb344-3"><a href="preds_quantit.html#cb344-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb344-4"><a href="preds_quantit.html#cb344-4" tabindex="-1"></a>    <span class="at">value =</span> </span>
<span id="cb344-5"><a href="preds_quantit.html#cb344-5" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb344-6"><a href="preds_quantit.html#cb344-6" tabindex="-1"></a>        stringr<span class="sc">::</span><span class="fu">str_starts</span>(name, <span class="st">&quot;pct_&quot;</span>) <span class="sc">~</span> scales<span class="sc">::</span><span class="fu">percent</span>(value, <span class="at">accuracy =</span> <span class="fl">0.1</span>)</span>
<span id="cb344-7"><a href="preds_quantit.html#cb344-7" tabindex="-1"></a>        , T <span class="sc">~</span> scales<span class="sc">::</span><span class="fu">comma</span>(value, <span class="at">accuracy =</span> <span class="fl">0.1</span>)</span>
<span id="cb344-8"><a href="preds_quantit.html#cb344-8" tabindex="-1"></a>      )</span>
<span id="cb344-9"><a href="preds_quantit.html#cb344-9" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb344-10"><a href="preds_quantit.html#cb344-10" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kbl</span>(</span>
<span id="cb344-11"><a href="preds_quantit.html#cb344-11" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">&quot;comparison of aggregated allometric field volume and predicted volume&quot;</span></span>
<span id="cb344-12"><a href="preds_quantit.html#cb344-12" tabindex="-1"></a>    , <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">&quot;metric&quot;</span>, <span class="st">&quot;value&quot;</span>)</span>
<span id="cb344-13"><a href="preds_quantit.html#cb344-13" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb344-14"><a href="preds_quantit.html#cb344-14" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kable_styling</span>()</span></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-382">Table 9.5: </span>comparison of aggregated allometric field volume and predicted volume
</caption>
<thead>
<tr>
<th style="text-align:left;">
metric
</th>
<th style="text-align:left;">
value
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
mean_diff
</td>
<td style="text-align:left;">
6.5
</td>
</tr>
<tr>
<td style="text-align:left;">
sd_diff
</td>
<td style="text-align:left;">
17.6
</td>
</tr>
<tr>
<td style="text-align:left;">
mean_field_volume_m3
</td>
<td style="text-align:left;">
15.4
</td>
</tr>
<tr>
<td style="text-align:left;">
mean_pred_volume_m3
</td>
<td style="text-align:left;">
8.9
</td>
</tr>
<tr>
<td style="text-align:left;">
pct_mean_diff
</td>
<td style="text-align:left;">
73.3%
</td>
</tr>
</tbody>
</table>
<p>we’ll dig into the MD shortly but before we move on let’s focus on the percent mean difference. We calcualted a %MD of 73.3% which indicates a major systematic difference where the allometric field volume is, on average, 73.3% larger than our CHM-predicted volume. This large relative difference shows how much the geometric assumptions inflate the volume compared to the irregular volumes measured by our remote sensing-based method.</p>
<p>let’s make a Bland-Altman plot to compare the two measurement methods. this plot uses the average of the two measurements (approximate size) on the x-axis and the difference (bias) between the two measurements on the y-axis</p>
<div class="sourceCode" id="cb345"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb345-1"><a href="preds_quantit.html#cb345-1" tabindex="-1"></a>dbscan_gt_pred_match[[<span class="st">&quot;psinf&quot;</span>]] <span class="sc">%&gt;%</span> </span>
<span id="cb345-2"><a href="preds_quantit.html#cb345-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(match_grp<span class="sc">==</span><span class="st">&quot;true positive&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb345-3"><a href="preds_quantit.html#cb345-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb345-4"><a href="preds_quantit.html#cb345-4" tabindex="-1"></a>  <span class="co"># calc needed metrics</span></span>
<span id="cb345-5"><a href="preds_quantit.html#cb345-5" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb345-6"><a href="preds_quantit.html#cb345-6" tabindex="-1"></a>    <span class="at">mean_vol =</span> (field_volume_m3<span class="sc">+</span>pred_volume_m3)<span class="sc">/</span><span class="dv">2</span></span>
<span id="cb345-7"><a href="preds_quantit.html#cb345-7" tabindex="-1"></a>    , <span class="at">diff_vol =</span> (field_volume_m3<span class="sc">-</span>pred_volume_m3) <span class="co"># match the order used in vol_agg_df_temp</span></span>
<span id="cb345-8"><a href="preds_quantit.html#cb345-8" tabindex="-1"></a>    , <span class="at">scale_diff =</span> <span class="fu">ifelse</span>(diff_vol <span class="sc">&lt;</span> <span class="dv">0</span>, <span class="sc">-</span><span class="fu">abs</span>(diff_vol) <span class="sc">/</span> <span class="fu">abs</span>(<span class="fu">min</span>(diff_vol)), diff_vol <span class="sc">/</span> <span class="fu">max</span>(diff_vol))</span>
<span id="cb345-9"><a href="preds_quantit.html#cb345-9" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb345-10"><a href="preds_quantit.html#cb345-10" tabindex="-1"></a>  <span class="co"># ggplot() + geom_point(aes(x=diff_vol,y=0, color=scale_diff)) + scale_color_gradient2(mid = &quot;gray&quot;, midpoint = 0, low = &quot;red&quot;, high = &quot;blue&quot;)</span></span>
<span id="cb345-11"><a href="preds_quantit.html#cb345-11" tabindex="-1"></a>  <span class="co"># plot</span></span>
<span id="cb345-12"><a href="preds_quantit.html#cb345-12" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(</span>
<span id="cb345-13"><a href="preds_quantit.html#cb345-13" tabindex="-1"></a>    <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> mean_vol, <span class="at">y =</span> diff_vol)</span>
<span id="cb345-14"><a href="preds_quantit.html#cb345-14" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb345-15"><a href="preds_quantit.html#cb345-15" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">lwd =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb345-16"><a href="preds_quantit.html#cb345-16" tabindex="-1"></a>  <span class="co"># mean difference (bias)</span></span>
<span id="cb345-17"><a href="preds_quantit.html#cb345-17" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_hline</span>(</span>
<span id="cb345-18"><a href="preds_quantit.html#cb345-18" tabindex="-1"></a>    <span class="at">yintercept =</span> vol_agg_df_temp<span class="sc">$</span>mean_diff</span>
<span id="cb345-19"><a href="preds_quantit.html#cb345-19" tabindex="-1"></a>    , <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>, <span class="at">color =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">lwd =</span> <span class="dv">1</span></span>
<span id="cb345-20"><a href="preds_quantit.html#cb345-20" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb345-21"><a href="preds_quantit.html#cb345-21" tabindex="-1"></a>  <span class="co"># upper limit</span></span>
<span id="cb345-22"><a href="preds_quantit.html#cb345-22" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_hline</span>(</span>
<span id="cb345-23"><a href="preds_quantit.html#cb345-23" tabindex="-1"></a>    <span class="at">yintercept =</span> vol_agg_df_temp<span class="sc">$</span>mean_diff<span class="fl">+1.96</span><span class="sc">*</span>vol_agg_df_temp<span class="sc">$</span>sd_diff</span>
<span id="cb345-24"><a href="preds_quantit.html#cb345-24" tabindex="-1"></a>    , <span class="at">linetype =</span> <span class="st">&quot;dotted&quot;</span>, <span class="at">color =</span> <span class="st">&quot;red&quot;</span>, <span class="at">lwd =</span> <span class="dv">1</span></span>
<span id="cb345-25"><a href="preds_quantit.html#cb345-25" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb345-26"><a href="preds_quantit.html#cb345-26" tabindex="-1"></a>  <span class="co"># lower limit</span></span>
<span id="cb345-27"><a href="preds_quantit.html#cb345-27" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_hline</span>(</span>
<span id="cb345-28"><a href="preds_quantit.html#cb345-28" tabindex="-1"></a>    <span class="at">yintercept =</span> vol_agg_df_temp<span class="sc">$</span>mean_diff<span class="fl">-1.96</span><span class="sc">*</span>vol_agg_df_temp<span class="sc">$</span>sd_diff</span>
<span id="cb345-29"><a href="preds_quantit.html#cb345-29" tabindex="-1"></a>    , <span class="at">linetype =</span> <span class="st">&quot;dotted&quot;</span>, <span class="at">color =</span> <span class="st">&quot;red&quot;</span>, <span class="at">lwd =</span> <span class="dv">1</span></span>
<span id="cb345-30"><a href="preds_quantit.html#cb345-30" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb345-31"><a href="preds_quantit.html#cb345-31" tabindex="-1"></a>  <span class="co"># annotations</span></span>
<span id="cb345-32"><a href="preds_quantit.html#cb345-32" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">annotate</span>(</span>
<span id="cb345-33"><a href="preds_quantit.html#cb345-33" tabindex="-1"></a>    <span class="st">&quot;text&quot;</span></span>
<span id="cb345-34"><a href="preds_quantit.html#cb345-34" tabindex="-1"></a>    , <span class="at">x =</span> <span class="cn">Inf</span></span>
<span id="cb345-35"><a href="preds_quantit.html#cb345-35" tabindex="-1"></a>    , <span class="at">y =</span> vol_agg_df_temp<span class="sc">$</span>mean_diff</span>
<span id="cb345-36"><a href="preds_quantit.html#cb345-36" tabindex="-1"></a>    , <span class="at">label =</span> latex2exp<span class="sc">::</span><span class="fu">TeX</span>(</span>
<span id="cb345-37"><a href="preds_quantit.html#cb345-37" tabindex="-1"></a>      <span class="fu">paste0</span>(</span>
<span id="cb345-38"><a href="preds_quantit.html#cb345-38" tabindex="-1"></a>        <span class="st">&quot;mean difference (bias): &quot;</span></span>
<span id="cb345-39"><a href="preds_quantit.html#cb345-39" tabindex="-1"></a>        , scales<span class="sc">::</span><span class="fu">comma</span>(vol_agg_df_temp<span class="sc">$</span>mean_diff, <span class="at">accuracy =</span> <span class="fl">0.01</span>)</span>
<span id="cb345-40"><a href="preds_quantit.html#cb345-40" tabindex="-1"></a>        , <span class="st">&quot; $m^3$&quot;</span></span>
<span id="cb345-41"><a href="preds_quantit.html#cb345-41" tabindex="-1"></a>      )</span>
<span id="cb345-42"><a href="preds_quantit.html#cb345-42" tabindex="-1"></a>      , <span class="at">output =</span> <span class="st">&quot;character&quot;</span></span>
<span id="cb345-43"><a href="preds_quantit.html#cb345-43" tabindex="-1"></a>    )</span>
<span id="cb345-44"><a href="preds_quantit.html#cb345-44" tabindex="-1"></a>    , <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.5</span></span>
<span id="cb345-45"><a href="preds_quantit.html#cb345-45" tabindex="-1"></a>    , <span class="at">hjust =</span> <span class="dv">1</span></span>
<span id="cb345-46"><a href="preds_quantit.html#cb345-46" tabindex="-1"></a>    , <span class="at">color =</span> <span class="st">&quot;blue&quot;</span></span>
<span id="cb345-47"><a href="preds_quantit.html#cb345-47" tabindex="-1"></a>    , <span class="at">size =</span> <span class="dv">4</span></span>
<span id="cb345-48"><a href="preds_quantit.html#cb345-48" tabindex="-1"></a>    , <span class="at">parse =</span> <span class="cn">TRUE</span></span>
<span id="cb345-49"><a href="preds_quantit.html#cb345-49" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb345-50"><a href="preds_quantit.html#cb345-50" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">annotate</span>(</span>
<span id="cb345-51"><a href="preds_quantit.html#cb345-51" tabindex="-1"></a>    <span class="st">&quot;text&quot;</span></span>
<span id="cb345-52"><a href="preds_quantit.html#cb345-52" tabindex="-1"></a>    , <span class="at">x =</span> <span class="cn">Inf</span></span>
<span id="cb345-53"><a href="preds_quantit.html#cb345-53" tabindex="-1"></a>    , <span class="at">y =</span> vol_agg_df_temp<span class="sc">$</span>mean_diff<span class="fl">+1.96</span><span class="sc">*</span>vol_agg_df_temp<span class="sc">$</span>sd_diff</span>
<span id="cb345-54"><a href="preds_quantit.html#cb345-54" tabindex="-1"></a>    , <span class="at">label =</span> latex2exp<span class="sc">::</span><span class="fu">TeX</span>(</span>
<span id="cb345-55"><a href="preds_quantit.html#cb345-55" tabindex="-1"></a>      <span class="fu">paste0</span>(</span>
<span id="cb345-56"><a href="preds_quantit.html#cb345-56" tabindex="-1"></a>        <span class="st">&quot;+1.96 SD: &quot;</span></span>
<span id="cb345-57"><a href="preds_quantit.html#cb345-57" tabindex="-1"></a>        , scales<span class="sc">::</span><span class="fu">comma</span>(vol_agg_df_temp<span class="sc">$</span>mean_diff<span class="fl">+1.96</span><span class="sc">*</span>vol_agg_df_temp<span class="sc">$</span>sd_diff, <span class="at">accuracy =</span> <span class="fl">0.01</span>)</span>
<span id="cb345-58"><a href="preds_quantit.html#cb345-58" tabindex="-1"></a>        , <span class="st">&quot; $m^3$&quot;</span></span>
<span id="cb345-59"><a href="preds_quantit.html#cb345-59" tabindex="-1"></a>      )</span>
<span id="cb345-60"><a href="preds_quantit.html#cb345-60" tabindex="-1"></a>      , <span class="at">output =</span> <span class="st">&quot;character&quot;</span></span>
<span id="cb345-61"><a href="preds_quantit.html#cb345-61" tabindex="-1"></a>    )</span>
<span id="cb345-62"><a href="preds_quantit.html#cb345-62" tabindex="-1"></a>    , <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.5</span></span>
<span id="cb345-63"><a href="preds_quantit.html#cb345-63" tabindex="-1"></a>    , <span class="at">hjust =</span> <span class="dv">1</span></span>
<span id="cb345-64"><a href="preds_quantit.html#cb345-64" tabindex="-1"></a>    , <span class="at">color =</span> <span class="st">&quot;red&quot;</span></span>
<span id="cb345-65"><a href="preds_quantit.html#cb345-65" tabindex="-1"></a>    , <span class="at">size =</span> <span class="dv">4</span></span>
<span id="cb345-66"><a href="preds_quantit.html#cb345-66" tabindex="-1"></a>    , <span class="at">parse =</span> <span class="cn">TRUE</span></span>
<span id="cb345-67"><a href="preds_quantit.html#cb345-67" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb345-68"><a href="preds_quantit.html#cb345-68" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">annotate</span>(</span>
<span id="cb345-69"><a href="preds_quantit.html#cb345-69" tabindex="-1"></a>    <span class="st">&quot;text&quot;</span></span>
<span id="cb345-70"><a href="preds_quantit.html#cb345-70" tabindex="-1"></a>    , <span class="at">x =</span> <span class="cn">Inf</span></span>
<span id="cb345-71"><a href="preds_quantit.html#cb345-71" tabindex="-1"></a>    , <span class="at">y =</span> vol_agg_df_temp<span class="sc">$</span>mean_diff<span class="fl">-1.96</span><span class="sc">*</span>vol_agg_df_temp<span class="sc">$</span>sd_diff</span>
<span id="cb345-72"><a href="preds_quantit.html#cb345-72" tabindex="-1"></a>    , <span class="at">label =</span> latex2exp<span class="sc">::</span><span class="fu">TeX</span>(</span>
<span id="cb345-73"><a href="preds_quantit.html#cb345-73" tabindex="-1"></a>      <span class="fu">paste0</span>(</span>
<span id="cb345-74"><a href="preds_quantit.html#cb345-74" tabindex="-1"></a>        <span class="st">&quot;-1.96 SD: &quot;</span></span>
<span id="cb345-75"><a href="preds_quantit.html#cb345-75" tabindex="-1"></a>        , scales<span class="sc">::</span><span class="fu">comma</span>(vol_agg_df_temp<span class="sc">$</span>mean_diff<span class="fl">-1.96</span><span class="sc">*</span>vol_agg_df_temp<span class="sc">$</span>sd_diff, <span class="at">accuracy =</span> <span class="fl">0.01</span>)</span>
<span id="cb345-76"><a href="preds_quantit.html#cb345-76" tabindex="-1"></a>        , <span class="st">&quot; $m^3$&quot;</span></span>
<span id="cb345-77"><a href="preds_quantit.html#cb345-77" tabindex="-1"></a>      )</span>
<span id="cb345-78"><a href="preds_quantit.html#cb345-78" tabindex="-1"></a>      , <span class="at">output =</span> <span class="st">&quot;character&quot;</span></span>
<span id="cb345-79"><a href="preds_quantit.html#cb345-79" tabindex="-1"></a>    )</span>
<span id="cb345-80"><a href="preds_quantit.html#cb345-80" tabindex="-1"></a>    , <span class="at">vjust =</span> <span class="fl">1.5</span></span>
<span id="cb345-81"><a href="preds_quantit.html#cb345-81" tabindex="-1"></a>    , <span class="at">hjust =</span> <span class="dv">1</span></span>
<span id="cb345-82"><a href="preds_quantit.html#cb345-82" tabindex="-1"></a>    , <span class="at">color =</span> <span class="st">&quot;red&quot;</span></span>
<span id="cb345-83"><a href="preds_quantit.html#cb345-83" tabindex="-1"></a>    , <span class="at">size =</span> <span class="dv">4</span></span>
<span id="cb345-84"><a href="preds_quantit.html#cb345-84" tabindex="-1"></a>    , <span class="at">parse =</span> <span class="cn">TRUE</span></span>
<span id="cb345-85"><a href="preds_quantit.html#cb345-85" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb345-86"><a href="preds_quantit.html#cb345-86" tabindex="-1"></a>  <span class="co"># points</span></span>
<span id="cb345-87"><a href="preds_quantit.html#cb345-87" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_point</span>(<span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">color =</span> scale_diff), <span class="at">size =</span> <span class="fl">1.9</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb345-88"><a href="preds_quantit.html#cb345-88" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_color_steps2</span>(<span class="at">mid =</span> <span class="st">&quot;gray&quot;</span>, <span class="at">midpoint =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb345-89"><a href="preds_quantit.html#cb345-89" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb345-90"><a href="preds_quantit.html#cb345-90" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">&quot;Bland-Altman plot: allometric field volume vs predicted volume&quot;</span></span>
<span id="cb345-91"><a href="preds_quantit.html#cb345-91" tabindex="-1"></a>    , <span class="at">x =</span> latex2exp<span class="sc">::</span><span class="fu">TeX</span>(<span class="st">&quot;mean volume ($m^3$)&quot;</span>)</span>
<span id="cb345-92"><a href="preds_quantit.html#cb345-92" tabindex="-1"></a>    , <span class="at">y =</span> latex2exp<span class="sc">::</span><span class="fu">TeX</span>(<span class="st">&quot;difference (allometric - predicted volume $m^3$)&quot;</span>)</span>
<span id="cb345-93"><a href="preds_quantit.html#cb345-93" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb345-94"><a href="preds_quantit.html#cb345-94" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb345-95"><a href="preds_quantit.html#cb345-95" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span></code></pre></div>
<p><img src="slash_pile_detecting_files/figure-html/unnamed-chunk-383-1.png" alt="" width="1008" /></p>
<p>That’s a lot of plotting to show that the mean difference is 6.51 m<sup>3</sup>. Points falling outside the 95% interval on the plot are instances of significant disagreement between the two volume measurements for those specific data points. These outliers indicate that, for a particular pile, the difference between the allometric field volume and the predicted volume is unusually large, suggesting a potential failure in either the CHM segmentation process, the quality of the original field measurements, the geometric shape assumption, or a combination thereof. We should investigate these extreme disagreements further to see what is happening</p>
<p>before we do that, let’s use a paired t-test to determine if the mean difference (MD) between the allometric field volume and the predicted volume is statistically significant (i.e. significantly different from zero)</p>
<div class="sourceCode" id="cb346"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb346-1"><a href="preds_quantit.html#cb346-1" tabindex="-1"></a><span class="co"># is the mean difference between the two volumes significantly different from zero</span></span>
<span id="cb346-2"><a href="preds_quantit.html#cb346-2" tabindex="-1"></a>ttest_temp <span class="ot">&lt;-</span> <span class="fu">t.test</span>(</span>
<span id="cb346-3"><a href="preds_quantit.html#cb346-3" tabindex="-1"></a>  dbscan_gt_pred_match[[<span class="st">&quot;psinf&quot;</span>]] <span class="sc">%&gt;%</span> </span>
<span id="cb346-4"><a href="preds_quantit.html#cb346-4" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(match_grp <span class="sc">==</span> <span class="st">&quot;true positive&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb346-5"><a href="preds_quantit.html#cb346-5" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">pull</span>(field_volume_m3)</span>
<span id="cb346-6"><a href="preds_quantit.html#cb346-6" tabindex="-1"></a>  , dbscan_gt_pred_match[[<span class="st">&quot;psinf&quot;</span>]] <span class="sc">%&gt;%</span> </span>
<span id="cb346-7"><a href="preds_quantit.html#cb346-7" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(match_grp <span class="sc">==</span> <span class="st">&quot;true positive&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb346-8"><a href="preds_quantit.html#cb346-8" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">pull</span>(pred_volume_m3)</span>
<span id="cb346-9"><a href="preds_quantit.html#cb346-9" tabindex="-1"></a>  , <span class="at">paired =</span> <span class="cn">TRUE</span></span>
<span id="cb346-10"><a href="preds_quantit.html#cb346-10" tabindex="-1"></a>)</span>
<span id="cb346-11"><a href="preds_quantit.html#cb346-11" tabindex="-1"></a>ttest_temp</span></code></pre></div>
<pre><code>## 
##  Paired t-test
## 
## data:  dbscan_gt_pred_match[[&quot;psinf&quot;]] %&gt;% dplyr::filter(match_grp == &quot;true positive&quot;) %&gt;% dplyr::pull(field_volume_m3) and dbscan_gt_pred_match[[&quot;psinf&quot;]] %&gt;% dplyr::filter(match_grp == &quot;true positive&quot;) %&gt;% dplyr::pull(pred_volume_m3)
## t = 3.9741, df = 114, p-value = 0.0001243
## alternative hypothesis: true mean difference is not equal to 0
## 95 percent confidence interval:
##  3.266685 9.760398
## sample estimates:
## mean difference 
##        6.513542</code></pre>
<p>that’s neat, the test gave us the same mean difference (MD) of 6.51 m<sup>3</sup> that we calculated above. also, the p-value of 0.00012 is less than 0.05, meaning we should reject the null hypothesis that the true mean difference is zero. this confirms that the systematic difference (or bias) we observed where allometric volume is larger than our predicted volume is statistically significant and not due to random chance.</p>
<div id="extreme-volume-disagreements" class="section level3 hasAnchor" number="9.3.1">
<h3><span class="header-section-number">9.3.1</span> Extreme Volume Disagreements<a href="preds_quantit.html#extreme-volume-disagreements" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>let’s investigate the extreme disagreements further to see what is happening</p>
<div class="sourceCode" id="cb348"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb348-1"><a href="preds_quantit.html#cb348-1" tabindex="-1"></a>bad_vol_df_temp <span class="ot">&lt;-</span> </span>
<span id="cb348-2"><a href="preds_quantit.html#cb348-2" tabindex="-1"></a>  dbscan_gt_pred_match[[<span class="st">&quot;psinf&quot;</span>]] <span class="sc">%&gt;%</span> </span>
<span id="cb348-3"><a href="preds_quantit.html#cb348-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(match_grp<span class="sc">==</span><span class="st">&quot;true positive&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb348-4"><a href="preds_quantit.html#cb348-4" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb348-5"><a href="preds_quantit.html#cb348-5" tabindex="-1"></a>  <span class="co"># calc needed metrics</span></span>
<span id="cb348-6"><a href="preds_quantit.html#cb348-6" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb348-7"><a href="preds_quantit.html#cb348-7" tabindex="-1"></a>    <span class="at">diff_vol =</span> (field_volume_m3<span class="sc">-</span>pred_volume_m3) <span class="co"># match the order used in vol_agg_df_temp</span></span>
<span id="cb348-8"><a href="preds_quantit.html#cb348-8" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb348-9"><a href="preds_quantit.html#cb348-9" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(</span>
<span id="cb348-10"><a href="preds_quantit.html#cb348-10" tabindex="-1"></a>    diff_vol <span class="sc">&lt;</span> (vol_agg_df_temp<span class="sc">$</span>mean_diff<span class="fl">-1.96</span><span class="sc">*</span>vol_agg_df_temp<span class="sc">$</span>sd_diff)</span>
<span id="cb348-11"><a href="preds_quantit.html#cb348-11" tabindex="-1"></a>    <span class="sc">|</span> diff_vol <span class="sc">&gt;</span> (vol_agg_df_temp<span class="sc">$</span>mean_diff<span class="fl">+1.96</span><span class="sc">*</span>vol_agg_df_temp<span class="sc">$</span>sd_diff)</span>
<span id="cb348-12"><a href="preds_quantit.html#cb348-12" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb348-13"><a href="preds_quantit.html#cb348-13" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(</span>
<span id="cb348-14"><a href="preds_quantit.html#cb348-14" tabindex="-1"></a>    slash_piles_polys[[<span class="st">&quot;psinf&quot;</span>]] <span class="sc">%&gt;%</span> </span>
<span id="cb348-15"><a href="preds_quantit.html#cb348-15" tabindex="-1"></a>      sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb348-16"><a href="preds_quantit.html#cb348-16" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">select</span>(pile_id, comment) <span class="sc">%&gt;%</span> </span>
<span id="cb348-17"><a href="preds_quantit.html#cb348-17" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">pile_type =</span> comment)</span>
<span id="cb348-18"><a href="preds_quantit.html#cb348-18" tabindex="-1"></a>    , <span class="at">by =</span> <span class="st">&quot;pile_id&quot;</span></span>
<span id="cb348-19"><a href="preds_quantit.html#cb348-19" tabindex="-1"></a>  )</span>
<span id="cb348-20"><a href="preds_quantit.html#cb348-20" tabindex="-1"></a><span class="co"># what are the differences?</span></span>
<span id="cb348-21"><a href="preds_quantit.html#cb348-21" tabindex="-1"></a>bad_vol_df_temp <span class="sc">%&gt;%</span> </span>
<span id="cb348-22"><a href="preds_quantit.html#cb348-22" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb348-23"><a href="preds_quantit.html#cb348-23" tabindex="-1"></a>    pile_id, pile_type</span>
<span id="cb348-24"><a href="preds_quantit.html#cb348-24" tabindex="-1"></a>    , field_height_m, pred_height_m, diff_field_height_m</span>
<span id="cb348-25"><a href="preds_quantit.html#cb348-25" tabindex="-1"></a>    , field_diameter_m, pred_diameter_m, diff_field_diameter_m</span>
<span id="cb348-26"><a href="preds_quantit.html#cb348-26" tabindex="-1"></a>    , field_volume_m3, pred_volume_m3</span>
<span id="cb348-27"><a href="preds_quantit.html#cb348-27" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb348-28"><a href="preds_quantit.html#cb348-28" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb348-29"><a href="preds_quantit.html#cb348-29" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">across</span>(</span>
<span id="cb348-30"><a href="preds_quantit.html#cb348-30" tabindex="-1"></a>      <span class="at">.cols =</span> <span class="sc">-</span><span class="fu">c</span>(pile_id,pile_type)</span>
<span id="cb348-31"><a href="preds_quantit.html#cb348-31" tabindex="-1"></a>      , <span class="at">.fns =</span> <span class="sc">~</span> scales<span class="sc">::</span><span class="fu">comma</span>(.x,<span class="at">accuracy=</span><span class="fl">0.01</span>)</span>
<span id="cb348-32"><a href="preds_quantit.html#cb348-32" tabindex="-1"></a>    )</span>
<span id="cb348-33"><a href="preds_quantit.html#cb348-33" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb348-34"><a href="preds_quantit.html#cb348-34" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kbl</span>(</span>
<span id="cb348-35"><a href="preds_quantit.html#cb348-35" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">&quot;Volume measurement outliers: comparison of ground truth and predicted piles&quot;</span></span>
<span id="cb348-36"><a href="preds_quantit.html#cb348-36" tabindex="-1"></a>    <span class="co"># , col.names = c(&quot;metric&quot;, &quot;value&quot;)</span></span>
<span id="cb348-37"><a href="preds_quantit.html#cb348-37" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb348-38"><a href="preds_quantit.html#cb348-38" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kable_styling</span>(<span class="at">font_size =</span> <span class="fl">9.8</span>)</span></code></pre></div>
<table class="table" style="font-size: 9.8px; margin-left: auto; margin-right: auto;">
<caption style="font-size: initial !important;">
<span id="tab:unnamed-chunk-385">Table 9.6: </span>Volume measurement outliers: comparison of ground truth and predicted piles
</caption>
<thead>
<tr>
<th style="text-align:right;">
pile_id
</th>
<th style="text-align:left;">
pile_type
</th>
<th style="text-align:left;">
field_height_m
</th>
<th style="text-align:left;">
pred_height_m
</th>
<th style="text-align:left;">
diff_field_height_m
</th>
<th style="text-align:left;">
field_diameter_m
</th>
<th style="text-align:left;">
pred_diameter_m
</th>
<th style="text-align:left;">
diff_field_diameter_m
</th>
<th style="text-align:left;">
field_volume_m3
</th>
<th style="text-align:left;">
pred_volume_m3
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
190
</td>
<td style="text-align:left;">
Mechanical Pile
</td>
<td style="text-align:left;">
4.42
</td>
<td style="text-align:left;">
3.25
</td>
<td style="text-align:left;">
-1.17
</td>
<td style="text-align:left;">
8.96
</td>
<td style="text-align:left;">
8.68
</td>
<td style="text-align:left;">
-0.28
</td>
<td style="text-align:left;">
139.37
</td>
<td style="text-align:left;">
59.11
</td>
</tr>
<tr>
<td style="text-align:right;">
194
</td>
<td style="text-align:left;">
Mechanical Pile
</td>
<td style="text-align:left;">
6.40
</td>
<td style="text-align:left;">
3.65
</td>
<td style="text-align:left;">
-2.75
</td>
<td style="text-align:left;">
8.53
</td>
<td style="text-align:left;">
8.48
</td>
<td style="text-align:left;">
-0.06
</td>
<td style="text-align:left;">
183.08
</td>
<td style="text-align:left;">
62.97
</td>
</tr>
<tr>
<td style="text-align:right;">
195
</td>
<td style="text-align:left;">
Mechanical Pile
</td>
<td style="text-align:left;">
5.79
</td>
<td style="text-align:left;">
4.01
</td>
<td style="text-align:left;">
-1.78
</td>
<td style="text-align:left;">
8.23
</td>
<td style="text-align:left;">
8.99
</td>
<td style="text-align:left;">
0.76
</td>
<td style="text-align:left;">
154.02
</td>
<td style="text-align:left;">
89.50
</td>
</tr>
<tr>
<td style="text-align:right;">
82
</td>
<td style="text-align:left;">
Mechanical Pile
</td>
<td style="text-align:left;">
4.27
</td>
<td style="text-align:left;">
3.40
</td>
<td style="text-align:left;">
-0.87
</td>
<td style="text-align:left;">
7.62
</td>
<td style="text-align:left;">
7.56
</td>
<td style="text-align:left;">
-0.06
</td>
<td style="text-align:left;">
97.30
</td>
<td style="text-align:left;">
52.95
</td>
</tr>
<tr>
<td style="text-align:right;">
197
</td>
<td style="text-align:left;">
Mechanical Pile
</td>
<td style="text-align:left;">
5.18
</td>
<td style="text-align:left;">
3.21
</td>
<td style="text-align:left;">
-1.97
</td>
<td style="text-align:left;">
7.32
</td>
<td style="text-align:left;">
7.84
</td>
<td style="text-align:left;">
0.53
</td>
<td style="text-align:left;">
108.89
</td>
<td style="text-align:left;">
47.61
</td>
</tr>
<tr>
<td style="text-align:right;">
8
</td>
<td style="text-align:left;">
Mechanical Pile
</td>
<td style="text-align:left;">
4.27
</td>
<td style="text-align:left;">
3.00
</td>
<td style="text-align:left;">
-1.27
</td>
<td style="text-align:left;">
6.71
</td>
<td style="text-align:left;">
7.38
</td>
<td style="text-align:left;">
0.67
</td>
<td style="text-align:left;">
75.35
</td>
<td style="text-align:left;">
32.67
</td>
</tr>
<tr>
<td style="text-align:right;">
76
</td>
<td style="text-align:left;">
Mechanical Pile
</td>
<td style="text-align:left;">
4.72
</td>
<td style="text-align:left;">
1.73
</td>
<td style="text-align:left;">
-2.99
</td>
<td style="text-align:left;">
7.01
</td>
<td style="text-align:left;">
5.68
</td>
<td style="text-align:left;">
-1.33
</td>
<td style="text-align:left;">
91.18
</td>
<td style="text-align:left;">
15.80
</td>
</tr>
</tbody>
</table>
<p>All of the extreme volume discrepancies at the PSINF site occur for mechanical piles, where field-measured heights exceed the predicted, CHM-derived heights. One possible cause of this height discrepancy is that the <code>max_ht_m</code> parameter was set too low to capture the upper extent of these taller structures. If this is the case, then the predicted height would be right at the maximum height allowed by <code>max_ht_m</code>. However, we set the <code>max_ht_m</code> parameter to 5.0 m and the maximum predicted height of these piles was 4.0 m which means that it is not likely that the height-filtered CHM removed the top of the pile from the unfiltered CHM.</p>
<p>Instead, the under-prediction appears to stem from artifacts in height normalization during point cloud processing. If we go back to look at <a href="ptcld_process.html#ptcld_process_psinf">the DTM of this site</a> we can see slight vertical variations within the pile footprints, suggesting that the ground classification algorithm incorrectly identified the lower portions of these larger piles as terrain. Because the DTM was incorrectly inflated within the pile footprint the height-normalized CHM slightly underestimates the true height of the piles.</p>
<div class="sourceCode" id="cb349"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb349-1"><a href="preds_quantit.html#cb349-1" tabindex="-1"></a>bad_vol_df_temp <span class="sc">%&gt;%</span> </span>
<span id="cb349-2"><a href="preds_quantit.html#cb349-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb349-3"><a href="preds_quantit.html#cb349-3" tabindex="-1"></a>    pile_id</span>
<span id="cb349-4"><a href="preds_quantit.html#cb349-4" tabindex="-1"></a>    , field_height_m, pred_height_m</span>
<span id="cb349-5"><a href="preds_quantit.html#cb349-5" tabindex="-1"></a>    , field_diameter_m, pred_diameter_m</span>
<span id="cb349-6"><a href="preds_quantit.html#cb349-6" tabindex="-1"></a>    , field_volume_m3, pred_volume_m3</span>
<span id="cb349-7"><a href="preds_quantit.html#cb349-7" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb349-8"><a href="preds_quantit.html#cb349-8" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(</span>
<span id="cb349-9"><a href="preds_quantit.html#cb349-9" tabindex="-1"></a>    <span class="at">cols =</span> <span class="sc">-</span><span class="fu">c</span>(pile_id)</span>
<span id="cb349-10"><a href="preds_quantit.html#cb349-10" tabindex="-1"></a>    , <span class="at">names_to =</span> <span class="st">&quot;metric&quot;</span></span>
<span id="cb349-11"><a href="preds_quantit.html#cb349-11" tabindex="-1"></a>    , <span class="at">values_to =</span> <span class="st">&quot;value&quot;</span></span>
<span id="cb349-12"><a href="preds_quantit.html#cb349-12" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb349-13"><a href="preds_quantit.html#cb349-13" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb349-14"><a href="preds_quantit.html#cb349-14" tabindex="-1"></a>    <span class="at">which_data =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb349-15"><a href="preds_quantit.html#cb349-15" tabindex="-1"></a>        stringr<span class="sc">::</span><span class="fu">str_starts</span>(metric,<span class="st">&quot;field_&quot;</span>) <span class="sc">~</span> <span class="st">&quot;field&quot;</span></span>
<span id="cb349-16"><a href="preds_quantit.html#cb349-16" tabindex="-1"></a>        , stringr<span class="sc">::</span><span class="fu">str_starts</span>(metric,<span class="st">&quot;pred_&quot;</span>) <span class="sc">~</span> <span class="st">&quot;prediction&quot;</span></span>
<span id="cb349-17"><a href="preds_quantit.html#cb349-17" tabindex="-1"></a>        , T <span class="sc">~</span> <span class="st">&quot;error&quot;</span></span>
<span id="cb349-18"><a href="preds_quantit.html#cb349-18" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span> </span>
<span id="cb349-19"><a href="preds_quantit.html#cb349-19" tabindex="-1"></a>      <span class="fu">ordered</span>()</span>
<span id="cb349-20"><a href="preds_quantit.html#cb349-20" tabindex="-1"></a>    , <span class="at">pile_metric =</span> metric <span class="sc">%&gt;%</span> </span>
<span id="cb349-21"><a href="preds_quantit.html#cb349-21" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_remove</span>(<span class="st">&quot;(_rmse|_rrmse|_mean|_mape)$&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb349-22"><a href="preds_quantit.html#cb349-22" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_extract</span>(<span class="st">&quot;(paraboloid_volume|volume|area|height|diameter)&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb349-23"><a href="preds_quantit.html#cb349-23" tabindex="-1"></a>      <span class="fu">factor</span>(</span>
<span id="cb349-24"><a href="preds_quantit.html#cb349-24" tabindex="-1"></a>        <span class="at">ordered =</span> T</span>
<span id="cb349-25"><a href="preds_quantit.html#cb349-25" tabindex="-1"></a>        , <span class="at">levels =</span> <span class="fu">c</span>(</span>
<span id="cb349-26"><a href="preds_quantit.html#cb349-26" tabindex="-1"></a>          <span class="st">&quot;volume&quot;</span></span>
<span id="cb349-27"><a href="preds_quantit.html#cb349-27" tabindex="-1"></a>          , <span class="st">&quot;area&quot;</span></span>
<span id="cb349-28"><a href="preds_quantit.html#cb349-28" tabindex="-1"></a>          , <span class="st">&quot;height&quot;</span></span>
<span id="cb349-29"><a href="preds_quantit.html#cb349-29" tabindex="-1"></a>          , <span class="st">&quot;diameter&quot;</span></span>
<span id="cb349-30"><a href="preds_quantit.html#cb349-30" tabindex="-1"></a>        )</span>
<span id="cb349-31"><a href="preds_quantit.html#cb349-31" tabindex="-1"></a>        , <span class="at">labels =</span> <span class="fu">c</span>(</span>
<span id="cb349-32"><a href="preds_quantit.html#cb349-32" tabindex="-1"></a>          <span class="st">&quot;Volume (m3)&quot;</span></span>
<span id="cb349-33"><a href="preds_quantit.html#cb349-33" tabindex="-1"></a>          , <span class="st">&quot;Area (m2)&quot;</span></span>
<span id="cb349-34"><a href="preds_quantit.html#cb349-34" tabindex="-1"></a>          , <span class="st">&quot;Height (m)&quot;</span></span>
<span id="cb349-35"><a href="preds_quantit.html#cb349-35" tabindex="-1"></a>          , <span class="st">&quot;Diameter (m)&quot;</span></span>
<span id="cb349-36"><a href="preds_quantit.html#cb349-36" tabindex="-1"></a>        )</span>
<span id="cb349-37"><a href="preds_quantit.html#cb349-37" tabindex="-1"></a>      )</span>
<span id="cb349-38"><a href="preds_quantit.html#cb349-38" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb349-39"><a href="preds_quantit.html#cb349-39" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(</span>
<span id="cb349-40"><a href="preds_quantit.html#cb349-40" tabindex="-1"></a>    <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> which_data, <span class="at">y =</span> value, <span class="at">label =</span> scales<span class="sc">::</span><span class="fu">comma</span>(value,<span class="at">accuracy=</span><span class="fl">0.1</span>), <span class="at">group =</span> pile_id)</span>
<span id="cb349-41"><a href="preds_quantit.html#cb349-41" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb349-42"><a href="preds_quantit.html#cb349-42" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_line</span>(<span class="at">key_glyph =</span> <span class="st">&quot;point&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>, <span class="at">color =</span> <span class="st">&quot;gray&quot;</span>, <span class="at">lwd =</span> <span class="fl">1.1</span>) <span class="sc">+</span></span>
<span id="cb349-43"><a href="preds_quantit.html#cb349-43" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_point</span>(<span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">color =</span> which_data), <span class="at">alpha =</span> <span class="fl">0.8</span>, <span class="at">size =</span> <span class="fl">2.5</span>) <span class="sc">+</span></span>
<span id="cb349-44"><a href="preds_quantit.html#cb349-44" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;cyan&quot;</span>,<span class="st">&quot;magenta&quot;</span>)) <span class="sc">+</span></span>
<span id="cb349-45"><a href="preds_quantit.html#cb349-45" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_text</span>(</span>
<span id="cb349-46"><a href="preds_quantit.html#cb349-46" tabindex="-1"></a>    <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.25</span></span>
<span id="cb349-47"><a href="preds_quantit.html#cb349-47" tabindex="-1"></a>    , <span class="at">show.legend =</span> <span class="cn">FALSE</span></span>
<span id="cb349-48"><a href="preds_quantit.html#cb349-48" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb349-49"><a href="preds_quantit.html#cb349-49" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">facet_grid</span>(<span class="at">rows =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(pile_metric), <span class="at">scales =</span> <span class="st">&quot;free_y&quot;</span>) <span class="sc">+</span></span>
<span id="cb349-50"><a href="preds_quantit.html#cb349-50" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>comma, <span class="at">expand =</span> ggplot2<span class="sc">::</span><span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.05</span>,.<span class="dv">32</span>))) <span class="sc">+</span></span>
<span id="cb349-51"><a href="preds_quantit.html#cb349-51" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb349-52"><a href="preds_quantit.html#cb349-52" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;&quot;</span>, <span class="at">y =</span> <span class="st">&quot;&quot;</span>, <span class="at">color =</span> <span class="st">&quot;&quot;</span></span>
<span id="cb349-53"><a href="preds_quantit.html#cb349-53" tabindex="-1"></a>    , <span class="at">subtitle =</span> <span class="st">&quot;Volume measurement outliers: comparison of measurements&quot;</span></span>
<span id="cb349-54"><a href="preds_quantit.html#cb349-54" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb349-55"><a href="preds_quantit.html#cb349-55" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb349-56"><a href="preds_quantit.html#cb349-56" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb349-57"><a href="preds_quantit.html#cb349-57" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb349-58"><a href="preds_quantit.html#cb349-58" tabindex="-1"></a>    , <span class="at">strip.text =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb349-59"><a href="preds_quantit.html#cb349-59" tabindex="-1"></a>  ) </span></code></pre></div>
<p><img src="slash_pile_detecting_files/figure-html/unnamed-chunk-386-1.png" alt="" width="1008" /></p>
<p>RGB with the predicted piles (magenta) and the ground-truth piles (cyan) overlaid with the CHM</p>
<div class="sourceCode" id="cb350"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb350-1"><a href="preds_quantit.html#cb350-1" tabindex="-1"></a><span class="co"># cloud2raster_ans$chm_rast %&gt;% </span></span>
<span id="cb350-2"><a href="preds_quantit.html#cb350-2" tabindex="-1"></a><span class="co">#   terra::clamp(upper = structural_params_settings$max_ht_m, lower = 0, values = F) %&gt;% </span></span>
<span id="cb350-3"><a href="preds_quantit.html#cb350-3" tabindex="-1"></a><span class="co">#   terra::plot()</span></span>
<span id="cb350-4"><a href="preds_quantit.html#cb350-4" tabindex="-1"></a><span class="co"># bad_vol_df_temp %&gt;% dplyr::glimpse()</span></span>
<span id="cb350-5"><a href="preds_quantit.html#cb350-5" tabindex="-1"></a><span class="co"># plot RGB + CHM</span></span>
<span id="cb350-6"><a href="preds_quantit.html#cb350-6" tabindex="-1"></a><span class="co"># plot RGB</span></span>
<span id="cb350-7"><a href="preds_quantit.html#cb350-7" tabindex="-1"></a>plts_temp <span class="ot">&lt;-</span></span>
<span id="cb350-8"><a href="preds_quantit.html#cb350-8" tabindex="-1"></a>  <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(bad_vol_df_temp) <span class="sc">%&gt;%</span> </span>
<span id="cb350-9"><a href="preds_quantit.html#cb350-9" tabindex="-1"></a>  <span class="co"># sample(1) %&gt;% </span></span>
<span id="cb350-10"><a href="preds_quantit.html#cb350-10" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">map</span>(<span class="cf">function</span>(x){</span>
<span id="cb350-11"><a href="preds_quantit.html#cb350-11" tabindex="-1"></a>    dta <span class="ot">&lt;-</span> bad_vol_df_temp <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">slice</span>(x)</span>
<span id="cb350-12"><a href="preds_quantit.html#cb350-12" tabindex="-1"></a>    gt <span class="ot">&lt;-</span> slash_piles_polys[[<span class="st">&quot;psinf&quot;</span>]] <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(pile_id<span class="sc">==</span>dta<span class="sc">$</span>pile_id)</span>
<span id="cb350-13"><a href="preds_quantit.html#cb350-13" tabindex="-1"></a>    pr <span class="ot">&lt;-</span> dbscan_spectral_preds[[<span class="st">&quot;psinf&quot;</span>]] <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(pred_id<span class="sc">==</span>dta<span class="sc">$</span>pred_id)</span>
<span id="cb350-14"><a href="preds_quantit.html#cb350-14" tabindex="-1"></a>    <span class="co">#plt</span></span>
<span id="cb350-15"><a href="preds_quantit.html#cb350-15" tabindex="-1"></a>    <span class="fu">ortho_plt_fn</span>(</span>
<span id="cb350-16"><a href="preds_quantit.html#cb350-16" tabindex="-1"></a>      <span class="at">rgb_rast =</span> rgb_rast[[<span class="st">&quot;psinf&quot;</span>]]</span>
<span id="cb350-17"><a href="preds_quantit.html#cb350-17" tabindex="-1"></a>      , <span class="at">stand =</span> gt</span>
<span id="cb350-18"><a href="preds_quantit.html#cb350-18" tabindex="-1"></a>      , <span class="at">add_stand =</span> F</span>
<span id="cb350-19"><a href="preds_quantit.html#cb350-19" tabindex="-1"></a>      , <span class="at">buffer =</span> <span class="dv">7</span></span>
<span id="cb350-20"><a href="preds_quantit.html#cb350-20" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb350-21"><a href="preds_quantit.html#cb350-21" tabindex="-1"></a>      ggnewscale<span class="sc">::</span><span class="fu">new_scale_fill</span>() <span class="sc">+</span></span>
<span id="cb350-22"><a href="preds_quantit.html#cb350-22" tabindex="-1"></a>      ggplot2<span class="sc">::</span><span class="fu">geom_tile</span>(</span>
<span id="cb350-23"><a href="preds_quantit.html#cb350-23" tabindex="-1"></a>        <span class="at">data =</span> chm_rast[[<span class="st">&quot;psinf&quot;</span>]] <span class="sc">%&gt;%</span> </span>
<span id="cb350-24"><a href="preds_quantit.html#cb350-24" tabindex="-1"></a>          terra<span class="sc">::</span><span class="fu">crop</span>(</span>
<span id="cb350-25"><a href="preds_quantit.html#cb350-25" tabindex="-1"></a>            sf<span class="sc">::</span><span class="fu">st_union</span>(gt,pr) <span class="sc">%&gt;%</span> </span>
<span id="cb350-26"><a href="preds_quantit.html#cb350-26" tabindex="-1"></a>              sf<span class="sc">::</span><span class="fu">st_transform</span>(terra<span class="sc">::</span><span class="fu">crs</span>(chm_rast[[<span class="st">&quot;psinf&quot;</span>]])) <span class="sc">%&gt;%</span> </span>
<span id="cb350-27"><a href="preds_quantit.html#cb350-27" tabindex="-1"></a>              terra<span class="sc">::</span><span class="fu">vect</span>()</span>
<span id="cb350-28"><a href="preds_quantit.html#cb350-28" tabindex="-1"></a>            , <span class="at">mask =</span> T</span>
<span id="cb350-29"><a href="preds_quantit.html#cb350-29" tabindex="-1"></a>          ) <span class="sc">%&gt;%</span> </span>
<span id="cb350-30"><a href="preds_quantit.html#cb350-30" tabindex="-1"></a>          terra<span class="sc">::</span><span class="fu">as.data.frame</span>(<span class="at">xy=</span>T) <span class="sc">%&gt;%</span> </span>
<span id="cb350-31"><a href="preds_quantit.html#cb350-31" tabindex="-1"></a>          dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">f=</span><span class="dv">3</span>)</span>
<span id="cb350-32"><a href="preds_quantit.html#cb350-32" tabindex="-1"></a>        , <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x=</span>x,<span class="at">y=</span>y,<span class="at">fill=</span>f)</span>
<span id="cb350-33"><a href="preds_quantit.html#cb350-33" tabindex="-1"></a>        , <span class="at">alpha =</span> <span class="fl">0.5</span></span>
<span id="cb350-34"><a href="preds_quantit.html#cb350-34" tabindex="-1"></a>        , <span class="at">inherit.aes =</span> F</span>
<span id="cb350-35"><a href="preds_quantit.html#cb350-35" tabindex="-1"></a>        , <span class="at">show.legend =</span> T</span>
<span id="cb350-36"><a href="preds_quantit.html#cb350-36" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb350-37"><a href="preds_quantit.html#cb350-37" tabindex="-1"></a>      ggplot2<span class="sc">::</span><span class="fu">scale_fill_viridis_c</span>(</span>
<span id="cb350-38"><a href="preds_quantit.html#cb350-38" tabindex="-1"></a>        <span class="at">option =</span> <span class="st">&quot;plasma&quot;</span>, <span class="at">na.value =</span> <span class="st">&quot;gray&quot;</span>,<span class="at">name =</span> <span class="st">&quot;CHM (m)&quot;</span></span>
<span id="cb350-39"><a href="preds_quantit.html#cb350-39" tabindex="-1"></a>        , <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,all_stand_boundary <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(site_data_lab<span class="sc">==</span><span class="st">&quot;psinf&quot;</span>) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">pull</span>(max_ht_m))</span>
<span id="cb350-40"><a href="preds_quantit.html#cb350-40" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb350-41"><a href="preds_quantit.html#cb350-41" tabindex="-1"></a>      ggplot2<span class="sc">::</span><span class="fu">geom_sf</span>(<span class="at">data =</span> gt, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">color =</span> <span class="st">&quot;cyan&quot;</span>, <span class="at">lwd =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb350-42"><a href="preds_quantit.html#cb350-42" tabindex="-1"></a>      ggplot2<span class="sc">::</span><span class="fu">geom_sf</span>(<span class="at">data =</span> pr, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">color =</span> <span class="st">&quot;magenta&quot;</span>, <span class="at">lwd =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb350-43"><a href="preds_quantit.html#cb350-43" tabindex="-1"></a>      ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb350-44"><a href="preds_quantit.html#cb350-44" tabindex="-1"></a>        <span class="at">subtitle =</span> <span class="fu">paste0</span>(</span>
<span id="cb350-45"><a href="preds_quantit.html#cb350-45" tabindex="-1"></a>          <span class="st">&quot;Fld ht: &quot;</span>, <span class="fu">round</span>(dta<span class="sc">$</span>field_height_m,<span class="dv">1</span>)</span>
<span id="cb350-46"><a href="preds_quantit.html#cb350-46" tabindex="-1"></a>          , <span class="st">&quot; | Pred ht: &quot;</span>, <span class="fu">round</span>(dta<span class="sc">$</span>pred_height_m,<span class="dv">1</span>)</span>
<span id="cb350-47"><a href="preds_quantit.html#cb350-47" tabindex="-1"></a>          , <span class="st">&quot;</span><span class="sc">\n</span><span class="st">Fld dia: &quot;</span>, <span class="fu">round</span>(dta<span class="sc">$</span>field_diameter_m,<span class="dv">1</span>)</span>
<span id="cb350-48"><a href="preds_quantit.html#cb350-48" tabindex="-1"></a>          , <span class="st">&quot; | Pred dia: &quot;</span>, <span class="fu">round</span>(dta<span class="sc">$</span>pred_diameter_m,<span class="dv">1</span>)</span>
<span id="cb350-49"><a href="preds_quantit.html#cb350-49" tabindex="-1"></a>        )</span>
<span id="cb350-50"><a href="preds_quantit.html#cb350-50" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb350-51"><a href="preds_quantit.html#cb350-51" tabindex="-1"></a>      ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb350-52"><a href="preds_quantit.html#cb350-52" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span></span>
<span id="cb350-53"><a href="preds_quantit.html#cb350-53" tabindex="-1"></a>        , <span class="at">legend.text =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>)</span>
<span id="cb350-54"><a href="preds_quantit.html#cb350-54" tabindex="-1"></a>        , <span class="at">legend.title =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>)</span>
<span id="cb350-55"><a href="preds_quantit.html#cb350-55" tabindex="-1"></a>      )</span>
<span id="cb350-56"><a href="preds_quantit.html#cb350-56" tabindex="-1"></a>  })</span>
<span id="cb350-57"><a href="preds_quantit.html#cb350-57" tabindex="-1"></a><span class="co"># plts_temp</span></span>
<span id="cb350-58"><a href="preds_quantit.html#cb350-58" tabindex="-1"></a><span class="co"># combine</span></span>
<span id="cb350-59"><a href="preds_quantit.html#cb350-59" tabindex="-1"></a>patchwork<span class="sc">::</span><span class="fu">wrap_plots</span>(</span>
<span id="cb350-60"><a href="preds_quantit.html#cb350-60" tabindex="-1"></a>  plts_temp</span>
<span id="cb350-61"><a href="preds_quantit.html#cb350-61" tabindex="-1"></a>  , <span class="at">ncol =</span> <span class="dv">3</span></span>
<span id="cb350-62"><a href="preds_quantit.html#cb350-62" tabindex="-1"></a>  , <span class="at">guides =</span> <span class="st">&quot;collect&quot;</span></span>
<span id="cb350-63"><a href="preds_quantit.html#cb350-63" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb350-64"><a href="preds_quantit.html#cb350-64" tabindex="-1"></a>patchwork<span class="sc">::</span><span class="fu">plot_annotation</span>(</span>
<span id="cb350-65"><a href="preds_quantit.html#cb350-65" tabindex="-1"></a>  <span class="at">theme =</span> ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb350-66"><a href="preds_quantit.html#cb350-66" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span></span>
<span id="cb350-67"><a href="preds_quantit.html#cb350-67" tabindex="-1"></a>    , <span class="at">legend.text =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>)</span>
<span id="cb350-68"><a href="preds_quantit.html#cb350-68" tabindex="-1"></a>    , <span class="at">legend.title =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>)</span>
<span id="cb350-69"><a href="preds_quantit.html#cb350-69" tabindex="-1"></a>    , <span class="at">legend.margin =</span> ggplot2<span class="sc">::</span><span class="fu">margin</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>)</span>
<span id="cb350-70"><a href="preds_quantit.html#cb350-70" tabindex="-1"></a>  )</span>
<span id="cb350-71"><a href="preds_quantit.html#cb350-71" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="slash_pile_detecting_files/figure-html/unnamed-chunk-387-1.png" alt="" width="816" /></p>
</div>
<div id="allometric-volume-comparison" class="section level3 hasAnchor" number="9.3.2">
<h3><span class="header-section-number">9.3.2</span> Allometric Volume Comparison<a href="preds_quantit.html#allometric-volume-comparison" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The volume comparison <a href="preds_quantit.html#vol_comp">immediately above</a> compared the allometric field volume using a geometric shape assumption (paraboloid) with the predicted volume based on the irregular CHM elevation profile. Thus, the volume difference included the impact of the shape assumption. In an attempt to remove the influence of comparing a regular shape (field measured) to an irregular shape (predicted volume), we’ll perform a comparison analysis where both volume calculations are based on the same paraboloid shape assumption. This should provide insight into the differences related only to the predicted versus field-measured maximum dimensions of height and diameter.</p>
<p>In the following section, we compare volume predictions against field measured data where both volume calculations utilize the same paraboloid shape assumption. For this analysis, we’ll update the predicted volume only using the following volume definitions:</p>
<ul>
<li><strong>field-measured piles</strong>
<ul>
<li><strong>volume</strong> assumes a paraboloid shape, with volume calculated using the field-measured diameter (as the width) and height. we’ll refer to this as “Allometric Field Volume” to indicate the field measurement is derived using a shape assumption.</li>
</ul></li>
<li><strong>predicted piles</strong>
<ul>
<li><strong>volume</strong> assumes a paraboloid shape, with volume calculated using the predicted diameter (as the width) and height. we’ll refer to this as “Allometric Predicted Volume” to indicate the measurement is derived using a shape assumption.</li>
</ul></li>
</ul>
<p>We would generally expect that the allometric field volume will not be uniformly larger or smaller than the predicted allometric volume, as the volume difference will be the net result of two competing influences: the overestimation/underestimation of diameter and the overestimation/underestimation of height propagating through the volume calculation formula.</p>
<p>let’s first update the predicted volume to calculate the allometric predicted volume where the volume formula for a paraboloid is:</p>
<p><span class="math display">\[
V = \frac{1}{8}\pi \cdot width^2 \cdot height
\]</span></p>
<div class="sourceCode" id="cb351"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb351-1"><a href="preds_quantit.html#cb351-1" tabindex="-1"></a>dbscan_gt_pred_match[[<span class="st">&quot;psinf&quot;</span>]] <span class="ot">&lt;-</span></span>
<span id="cb351-2"><a href="preds_quantit.html#cb351-2" tabindex="-1"></a>  dbscan_gt_pred_match[[<span class="st">&quot;psinf&quot;</span>]] <span class="sc">%&gt;%</span> </span>
<span id="cb351-3"><a href="preds_quantit.html#cb351-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb351-4"><a href="preds_quantit.html#cb351-4" tabindex="-1"></a>    <span class="at">pred_allom_volume_m3 =</span> (<span class="dv">1</span><span class="sc">/</span><span class="dv">8</span>) <span class="sc">*</span> pi <span class="sc">*</span> (pred_diameter_m<span class="sc">^</span><span class="dv">2</span>) <span class="sc">*</span> pred_height_m</span>
<span id="cb351-5"><a href="preds_quantit.html#cb351-5" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb351-6"><a href="preds_quantit.html#cb351-6" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">glimpse</span>()</span></code></pre></div>
<pre><code>## Rows: 126
## Columns: 24
## $ pile_id                   &lt;dbl&gt; 190, 194, 195, 82, 197, 77, 189, 8, 187, 76,…
## $ i_area                    &lt;dbl&gt; 46.420164, 44.907459, 46.605098, 36.810987, …
## $ u_area                    &lt;dbl&gt; 62.038111, 54.767766, 53.639576, 41.666730, …
## $ iou                       &lt;dbl&gt; 0.7482524, 0.8199615, 0.8688566, 0.8834624, …
## $ pred_id                   &lt;dbl&gt; 2064, 3161, 3597, 5659, 4086, 5234, 2190, 50…
## $ match_grp                 &lt;ord&gt; true positive, true positive, true positive,…
## $ gt_diameter_m             &lt;dbl&gt; 10.216924, 8.966741, 9.030139, 7.892174, 8.6…
## $ gt_area_m2                &lt;dbl&gt; 59.263275, 54.040225, 50.979673, 40.292717, …
## $ field_height_m            &lt;dbl&gt; 4.4196, 6.4008, 5.7912, 4.2672, 5.1816, 2.43…
## $ field_diameter_m          &lt;dbl&gt; 8.96112, 8.53440, 8.22960, 7.62000, 7.31520,…
## $ field_volume_m3           &lt;dbl&gt; 139.369402, 183.079674, 154.023115, 97.29999…
## $ pred_diameter_m           &lt;dbl&gt; 8.683317, 8.475848, 8.988882, 7.564390, 7.84…
## $ pred_area_m2              &lt;dbl&gt; 49.195, 45.635, 49.265, 38.185, 34.985, 27.7…
## $ pred_volume_m3            &lt;dbl&gt; 59.110490, 62.972508, 89.496626, 52.950735, …
## $ pred_height_m             &lt;dbl&gt; 3.246000, 3.652000, 4.014000, 3.396000, 3.21…
## $ diff_area_m2              &lt;dbl&gt; -10.06827455, -8.40522481, -1.71467337, -2.1…
## $ pct_diff_area_m2          &lt;dbl&gt; 0.169890622, 0.155536452, 0.033634452, 0.052…
## $ diff_diameter_m           &lt;dbl&gt; -1.53360713, -0.49089339, -0.04125673, -0.32…
## $ pct_diff_diameter_m       &lt;dbl&gt; 0.150104577, 0.054746018, 0.004568782, 0.041…
## $ diff_field_diameter_m     &lt;dbl&gt; -0.27780266, -0.05855196, 0.75928202, -0.055…
## $ pct_diff_field_diameter_m &lt;dbl&gt; 0.031000886, 0.006860700, -0.092262324, 0.00…
## $ diff_field_height_m       &lt;dbl&gt; -1.17359995, -2.74880005, -1.77720006, -0.87…
## $ pct_diff_field_height_m   &lt;dbl&gt; 0.26554438, 0.42944633, 0.30687941, 0.204162…
## $ pred_allom_volume_m3      &lt;dbl&gt; 96.112473, 103.028404, 127.364562, 76.308938…</code></pre>
<div class="sourceCode" id="cb353"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb353-1"><a href="preds_quantit.html#cb353-1" tabindex="-1"></a><span class="co"># summarize it</span></span>
<span id="cb353-2"><a href="preds_quantit.html#cb353-2" tabindex="-1"></a>dbscan_gt_pred_match[[<span class="st">&quot;psinf&quot;</span>]] <span class="sc">%&gt;%</span> </span>
<span id="cb353-3"><a href="preds_quantit.html#cb353-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(match_grp<span class="sc">==</span><span class="st">&quot;true positive&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb353-4"><a href="preds_quantit.html#cb353-4" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(field_volume_m3, pred_volume_m3, pred_allom_volume_m3) <span class="sc">%&gt;%</span> </span>
<span id="cb353-5"><a href="preds_quantit.html#cb353-5" tabindex="-1"></a>  <span class="fu">summary</span>()</span></code></pre></div>
<pre><code>##  field_volume_m3   pred_volume_m3   pred_allom_volume_m3
##  Min.   :  4.270   Min.   : 1.710   Min.   :  2.822     
##  1st Qu.:  6.602   1st Qu.: 4.449   1st Qu.:  6.912     
##  Median :  7.536   Median : 5.346   Median :  8.201     
##  Mean   : 15.403   Mean   : 8.889   Mean   : 14.445     
##  3rd Qu.:  8.777   3rd Qu.: 7.341   3rd Qu.: 12.133     
##  Max.   :183.080   Max.   :89.497   Max.   :127.365</code></pre>
<p>nice, the allometric predicted volume is larger than the predicted volume calculated based on the irregular elevation profile in the CHM</p>
<div class="sourceCode" id="cb355"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb355-1"><a href="preds_quantit.html#cb355-1" tabindex="-1"></a>dbscan_gt_pred_match[[<span class="st">&quot;psinf&quot;</span>]] <span class="sc">%&gt;%</span> </span>
<span id="cb355-2"><a href="preds_quantit.html#cb355-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(match_grp<span class="sc">==</span><span class="st">&quot;true positive&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb355-3"><a href="preds_quantit.html#cb355-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">diff_volume_m3 =</span> field_volume_m3 <span class="sc">-</span> pred_allom_volume_m3) <span class="sc">%&gt;%</span> </span>
<span id="cb355-4"><a href="preds_quantit.html#cb355-4" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">y =</span> field_volume_m3, <span class="at">x =</span> pred_allom_volume_m3)) <span class="sc">+</span></span>
<span id="cb355-5"><a href="preds_quantit.html#cb355-5" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_abline</span>(<span class="at">lwd =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb355-6"><a href="preds_quantit.html#cb355-6" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">&quot;navy&quot;</span>) <span class="sc">+</span></span>
<span id="cb355-7"><a href="preds_quantit.html#cb355-7" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="at">se=</span>F, <span class="at">color =</span> <span class="st">&quot;tomato&quot;</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb355-8"><a href="preds_quantit.html#cb355-8" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_color_viridis_c</span>(<span class="at">option =</span> <span class="st">&quot;mako&quot;</span>, <span class="at">direction =</span> <span class="sc">-</span><span class="dv">1</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb355-9"><a href="preds_quantit.html#cb355-9" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">max</span>( <span class="fu">max</span>(dbscan_gt_pred_match[[<span class="st">&quot;psinf&quot;</span>]]<span class="sc">$</span>pred_allom_volume_m3,<span class="at">na.rm=</span>T), <span class="fu">max</span>(dbscan_gt_pred_match[[<span class="st">&quot;psinf&quot;</span>]]<span class="sc">$</span>field_volume_m3,<span class="at">na.rm=</span>T) ) )) <span class="sc">+</span></span>
<span id="cb355-10"><a href="preds_quantit.html#cb355-10" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">max</span>( <span class="fu">max</span>(dbscan_gt_pred_match[[<span class="st">&quot;psinf&quot;</span>]]<span class="sc">$</span>pred_allom_volume_m3,<span class="at">na.rm=</span>T), <span class="fu">max</span>(dbscan_gt_pred_match[[<span class="st">&quot;psinf&quot;</span>]]<span class="sc">$</span>field_volume_m3,<span class="at">na.rm=</span>T) ) )) <span class="sc">+</span></span>
<span id="cb355-11"><a href="preds_quantit.html#cb355-11" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb355-12"><a href="preds_quantit.html#cb355-12" tabindex="-1"></a>    <span class="at">y =</span> latex2exp<span class="sc">::</span><span class="fu">TeX</span>(<span class="st">&quot;allometric field volume $m^3$&quot;</span>)</span>
<span id="cb355-13"><a href="preds_quantit.html#cb355-13" tabindex="-1"></a>    , <span class="at">x =</span> latex2exp<span class="sc">::</span><span class="fu">TeX</span>(<span class="st">&quot;allometric predicted volume $m^3$&quot;</span>)</span>
<span id="cb355-14"><a href="preds_quantit.html#cb355-14" tabindex="-1"></a>    <span class="co"># , color = &quot;image-field\ndiameter diff.&quot;</span></span>
<span id="cb355-15"><a href="preds_quantit.html#cb355-15" tabindex="-1"></a>    , <span class="at">subtitle =</span> latex2exp<span class="sc">::</span><span class="fu">TeX</span>(<span class="st">&quot;bulk volume ($m^3$) comparison&quot;</span>)</span>
<span id="cb355-16"><a href="preds_quantit.html#cb355-16" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb355-17"><a href="preds_quantit.html#cb355-17" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_light</span>()</span></code></pre></div>
<p><img src="slash_pile_detecting_files/figure-html/unnamed-chunk-390-1.png" alt="" width="1008" /></p>
<p>the differences between the predictions for the larger field measured piles are pulling the slope of the line upwards but for the smaller piles, the volume differences are clustered around the line of equality</p>
<p>before we compare the volume measurements in aggregate, let’s look at the distributions</p>
<div class="sourceCode" id="cb356"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb356-1"><a href="preds_quantit.html#cb356-1" tabindex="-1"></a>vol_df_temp <span class="ot">&lt;-</span> </span>
<span id="cb356-2"><a href="preds_quantit.html#cb356-2" tabindex="-1"></a>  dbscan_gt_pred_match[[<span class="st">&quot;psinf&quot;</span>]] <span class="sc">%&gt;%</span> </span>
<span id="cb356-3"><a href="preds_quantit.html#cb356-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(match_grp<span class="sc">==</span><span class="st">&quot;true positive&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb356-4"><a href="preds_quantit.html#cb356-4" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(pile_id,field_volume_m3,pred_allom_volume_m3) <span class="sc">%&gt;%</span> </span>
<span id="cb356-5"><a href="preds_quantit.html#cb356-5" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span><span class="fu">c</span>(pile_id)) <span class="sc">%&gt;%</span> </span>
<span id="cb356-6"><a href="preds_quantit.html#cb356-6" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb356-7"><a href="preds_quantit.html#cb356-7" tabindex="-1"></a>    <span class="at">name =</span> <span class="fu">factor</span>(</span>
<span id="cb356-8"><a href="preds_quantit.html#cb356-8" tabindex="-1"></a>      name</span>
<span id="cb356-9"><a href="preds_quantit.html#cb356-9" tabindex="-1"></a>      , <span class="at">ordered =</span> T</span>
<span id="cb356-10"><a href="preds_quantit.html#cb356-10" tabindex="-1"></a>      , <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;field_volume_m3&quot;</span>,<span class="st">&quot;pred_allom_volume_m3&quot;</span>)</span>
<span id="cb356-11"><a href="preds_quantit.html#cb356-11" tabindex="-1"></a>      , <span class="at">labels =</span> <span class="fu">c</span>(</span>
<span id="cb356-12"><a href="preds_quantit.html#cb356-12" tabindex="-1"></a>        <span class="st">&quot;allometric field volume&quot;</span></span>
<span id="cb356-13"><a href="preds_quantit.html#cb356-13" tabindex="-1"></a>        , <span class="st">&quot;allometric predicted volume&quot;</span></span>
<span id="cb356-14"><a href="preds_quantit.html#cb356-14" tabindex="-1"></a>      )</span>
<span id="cb356-15"><a href="preds_quantit.html#cb356-15" tabindex="-1"></a>    )</span>
<span id="cb356-16"><a href="preds_quantit.html#cb356-16" tabindex="-1"></a>  ) </span>
<span id="cb356-17"><a href="preds_quantit.html#cb356-17" tabindex="-1"></a><span class="co"># plot dist</span></span>
<span id="cb356-18"><a href="preds_quantit.html#cb356-18" tabindex="-1"></a>vol_df_temp <span class="sc">%&gt;%</span> </span>
<span id="cb356-19"><a href="preds_quantit.html#cb356-19" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">color =</span> name, <span class="at">fill =</span> name)) <span class="sc">+</span></span>
<span id="cb356-20"><a href="preds_quantit.html#cb356-20" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_density</span>(<span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">y=</span>ggplot2<span class="sc">::</span><span class="fu">after_stat</span>(scaled)), <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb356-21"><a href="preds_quantit.html#cb356-21" tabindex="-1"></a>  harrypotter<span class="sc">::</span><span class="fu">scale_color_hp_d</span>(<span class="at">option =</span> <span class="st">&quot;lunalovegood&quot;</span>) <span class="sc">+</span></span>
<span id="cb356-22"><a href="preds_quantit.html#cb356-22" tabindex="-1"></a>  harrypotter<span class="sc">::</span><span class="fu">scale_fill_hp_d</span>(<span class="at">option =</span> <span class="st">&quot;lunalovegood&quot;</span>) <span class="sc">+</span></span>
<span id="cb356-23"><a href="preds_quantit.html#cb356-23" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>,<span class="at">breaks=</span><span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb356-24"><a href="preds_quantit.html#cb356-24" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb356-25"><a href="preds_quantit.html#cb356-25" tabindex="-1"></a>    <span class="at">color=</span><span class="st">&quot;&quot;</span>,<span class="at">fill=</span><span class="st">&quot;&quot;</span>,<span class="at">x=</span>latex2exp<span class="sc">::</span><span class="fu">TeX</span>(<span class="st">&quot;allometric volume $m^3$&quot;</span>)</span>
<span id="cb356-26"><a href="preds_quantit.html#cb356-26" tabindex="-1"></a>    , <span class="at">subtitle =</span> latex2exp<span class="sc">::</span><span class="fu">TeX</span>(<span class="st">&quot;Allometric bulk volume ($m^3$) comparison of distributions&quot;</span>)</span>
<span id="cb356-27"><a href="preds_quantit.html#cb356-27" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb356-28"><a href="preds_quantit.html#cb356-28" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb356-29"><a href="preds_quantit.html#cb356-29" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb356-30"><a href="preds_quantit.html#cb356-30" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;top&quot;</span></span>
<span id="cb356-31"><a href="preds_quantit.html#cb356-31" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="slash_pile_detecting_files/figure-html/unnamed-chunk-391-1.png" alt="" width="1008" /></p>
<p>nice, the distributions overlap much more than the volume comparison between the allometric field value and the irregular, CHM-derived prediction</p>
<p>slope plots are neat too</p>
<div class="sourceCode" id="cb357"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb357-1"><a href="preds_quantit.html#cb357-1" tabindex="-1"></a>vol_df_temp <span class="sc">%&gt;%</span> </span>
<span id="cb357-2"><a href="preds_quantit.html#cb357-2" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(</span>
<span id="cb357-3"><a href="preds_quantit.html#cb357-3" tabindex="-1"></a>    <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> name, <span class="at">y =</span> value, <span class="at">group =</span> pile_id)</span>
<span id="cb357-4"><a href="preds_quantit.html#cb357-4" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb357-5"><a href="preds_quantit.html#cb357-5" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_line</span>(<span class="at">key_glyph =</span> <span class="st">&quot;point&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>, <span class="at">color =</span> <span class="st">&quot;gray&quot;</span>, <span class="at">lwd =</span> <span class="fl">1.1</span>) <span class="sc">+</span></span>
<span id="cb357-6"><a href="preds_quantit.html#cb357-6" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_point</span>(<span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">color =</span> name), <span class="at">alpha =</span> <span class="fl">0.7</span>, <span class="at">size =</span> <span class="fl">2.5</span>) <span class="sc">+</span></span>
<span id="cb357-7"><a href="preds_quantit.html#cb357-7" tabindex="-1"></a>  harrypotter<span class="sc">::</span><span class="fu">scale_color_hp_d</span>(<span class="at">option =</span> <span class="st">&quot;lunalovegood&quot;</span>) <span class="sc">+</span></span>
<span id="cb357-8"><a href="preds_quantit.html#cb357-8" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb357-9"><a href="preds_quantit.html#cb357-9" tabindex="-1"></a>    <span class="at">color=</span><span class="st">&quot;&quot;</span></span>
<span id="cb357-10"><a href="preds_quantit.html#cb357-10" tabindex="-1"></a>    , <span class="at">y =</span> latex2exp<span class="sc">::</span><span class="fu">TeX</span>(<span class="st">&quot;allometric volume $m^3$&quot;</span>)</span>
<span id="cb357-11"><a href="preds_quantit.html#cb357-11" tabindex="-1"></a>    , <span class="at">x =</span> <span class="st">&quot;&quot;</span></span>
<span id="cb357-12"><a href="preds_quantit.html#cb357-12" tabindex="-1"></a>    , <span class="at">subtitle =</span> latex2exp<span class="sc">::</span><span class="fu">TeX</span>(<span class="st">&quot;Allometric bulk volume ($m^3$) comparison at the pile level&quot;</span>)</span>
<span id="cb357-13"><a href="preds_quantit.html#cb357-13" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb357-14"><a href="preds_quantit.html#cb357-14" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb357-15"><a href="preds_quantit.html#cb357-15" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb357-16"><a href="preds_quantit.html#cb357-16" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb357-17"><a href="preds_quantit.html#cb357-17" tabindex="-1"></a>    , <span class="at">axis.title =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>)</span>
<span id="cb357-18"><a href="preds_quantit.html#cb357-18" tabindex="-1"></a>    , <span class="at">axis.text =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>)</span>
<span id="cb357-19"><a href="preds_quantit.html#cb357-19" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="slash_pile_detecting_files/figure-html/unnamed-chunk-392-1.png" alt="" width="1008" /></p>
<p>what if we only look at the smaller piles?</p>
<div class="sourceCode" id="cb358"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb358-1"><a href="preds_quantit.html#cb358-1" tabindex="-1"></a>vol_df_temp <span class="sc">%&gt;%</span> </span>
<span id="cb358-2"><a href="preds_quantit.html#cb358-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb358-3"><a href="preds_quantit.html#cb358-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">x =</span> value <span class="sc">&lt;</span> <span class="fu">quantile</span>(vol_df_temp<span class="sc">$</span>value, <span class="at">probs =</span> <span class="fl">0.90</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb358-4"><a href="preds_quantit.html#cb358-4" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(pile_id) <span class="sc">%&gt;%</span> </span>
<span id="cb358-5"><a href="preds_quantit.html#cb358-5" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(</span>
<span id="cb358-6"><a href="preds_quantit.html#cb358-6" tabindex="-1"></a>    <span class="fu">max</span>(x) <span class="sc">==</span> <span class="dv">1</span></span>
<span id="cb358-7"><a href="preds_quantit.html#cb358-7" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb358-8"><a href="preds_quantit.html#cb358-8" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(</span>
<span id="cb358-9"><a href="preds_quantit.html#cb358-9" tabindex="-1"></a>    <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> name, <span class="at">y =</span> value, <span class="at">group =</span> pile_id)</span>
<span id="cb358-10"><a href="preds_quantit.html#cb358-10" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb358-11"><a href="preds_quantit.html#cb358-11" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_line</span>(<span class="at">key_glyph =</span> <span class="st">&quot;point&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>, <span class="at">color =</span> <span class="st">&quot;gray&quot;</span>, <span class="at">lwd =</span> <span class="fl">1.1</span>) <span class="sc">+</span></span>
<span id="cb358-12"><a href="preds_quantit.html#cb358-12" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_point</span>(<span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">color =</span> name), <span class="at">alpha =</span> <span class="fl">0.7</span>, <span class="at">size =</span> <span class="fl">2.5</span>) <span class="sc">+</span></span>
<span id="cb358-13"><a href="preds_quantit.html#cb358-13" tabindex="-1"></a>  harrypotter<span class="sc">::</span><span class="fu">scale_color_hp_d</span>(<span class="at">option =</span> <span class="st">&quot;lunalovegood&quot;</span>) <span class="sc">+</span></span>
<span id="cb358-14"><a href="preds_quantit.html#cb358-14" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb358-15"><a href="preds_quantit.html#cb358-15" tabindex="-1"></a>    <span class="at">color=</span><span class="st">&quot;&quot;</span></span>
<span id="cb358-16"><a href="preds_quantit.html#cb358-16" tabindex="-1"></a>    , <span class="at">y =</span> latex2exp<span class="sc">::</span><span class="fu">TeX</span>(<span class="st">&quot;volume $m^3$&quot;</span>)</span>
<span id="cb358-17"><a href="preds_quantit.html#cb358-17" tabindex="-1"></a>    , <span class="at">x =</span> <span class="st">&quot;&quot;</span></span>
<span id="cb358-18"><a href="preds_quantit.html#cb358-18" tabindex="-1"></a>    , <span class="at">subtitle =</span> latex2exp<span class="sc">::</span><span class="fu">TeX</span>(<span class="st">&quot;bulk volume ($m^3$) comparison at the pile level for the smaller piles&quot;</span>)</span>
<span id="cb358-19"><a href="preds_quantit.html#cb358-19" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb358-20"><a href="preds_quantit.html#cb358-20" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb358-21"><a href="preds_quantit.html#cb358-21" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb358-22"><a href="preds_quantit.html#cb358-22" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb358-23"><a href="preds_quantit.html#cb358-23" tabindex="-1"></a>    , <span class="at">axis.title =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>)</span>
<span id="cb358-24"><a href="preds_quantit.html#cb358-24" tabindex="-1"></a>    , <span class="at">axis.text =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>)</span>
<span id="cb358-25"><a href="preds_quantit.html#cb358-25" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="slash_pile_detecting_files/figure-html/unnamed-chunk-393-1.png" alt="" width="1008" /></p>
<p>there is much more variability in this slope plot than the volume comparison between the allometric field value and the irregular, CHM-derived prediction</p>
<p>let’s compare aggregated volume measurements for the true positive matches</p>
<div class="sourceCode" id="cb359"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb359-1"><a href="preds_quantit.html#cb359-1" tabindex="-1"></a>vol_agg_df_temp <span class="ot">&lt;-</span> </span>
<span id="cb359-2"><a href="preds_quantit.html#cb359-2" tabindex="-1"></a>  dbscan_gt_pred_match[[<span class="st">&quot;psinf&quot;</span>]] <span class="sc">%&gt;%</span> </span>
<span id="cb359-3"><a href="preds_quantit.html#cb359-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(match_grp<span class="sc">==</span><span class="st">&quot;true positive&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb359-4"><a href="preds_quantit.html#cb359-4" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb359-5"><a href="preds_quantit.html#cb359-5" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(</span>
<span id="cb359-6"><a href="preds_quantit.html#cb359-6" tabindex="-1"></a>    <span class="at">mean_diff =</span> <span class="fu">mean</span>(field_volume_m3<span class="sc">-</span>pred_allom_volume_m3)</span>
<span id="cb359-7"><a href="preds_quantit.html#cb359-7" tabindex="-1"></a>    , <span class="at">sd_diff =</span> <span class="fu">sd</span>(field_volume_m3<span class="sc">-</span>pred_allom_volume_m3)</span>
<span id="cb359-8"><a href="preds_quantit.html#cb359-8" tabindex="-1"></a>    , <span class="at">mean_field_volume_m3 =</span> <span class="fu">mean</span>(field_volume_m3,<span class="at">na.rm =</span> T)</span>
<span id="cb359-9"><a href="preds_quantit.html#cb359-9" tabindex="-1"></a>    , <span class="at">mean_pred_allom_volume_m3 =</span> <span class="fu">mean</span>(pred_allom_volume_m3,<span class="at">na.rm =</span> T)</span>
<span id="cb359-10"><a href="preds_quantit.html#cb359-10" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb359-11"><a href="preds_quantit.html#cb359-11" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb359-12"><a href="preds_quantit.html#cb359-12" tabindex="-1"></a>    <span class="at">pct_mean_diff =</span> mean_diff<span class="sc">/</span>mean_pred_allom_volume_m3</span>
<span id="cb359-13"><a href="preds_quantit.html#cb359-13" tabindex="-1"></a>  )</span></code></pre></div>
<p>what did we get?</p>
<div class="sourceCode" id="cb360"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb360-1"><a href="preds_quantit.html#cb360-1" tabindex="-1"></a>vol_agg_df_temp <span class="sc">%&gt;%</span> </span>
<span id="cb360-2"><a href="preds_quantit.html#cb360-2" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(dplyr<span class="sc">::</span><span class="fu">everything</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb360-3"><a href="preds_quantit.html#cb360-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb360-4"><a href="preds_quantit.html#cb360-4" tabindex="-1"></a>    <span class="at">value =</span> </span>
<span id="cb360-5"><a href="preds_quantit.html#cb360-5" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb360-6"><a href="preds_quantit.html#cb360-6" tabindex="-1"></a>        stringr<span class="sc">::</span><span class="fu">str_starts</span>(name, <span class="st">&quot;pct_&quot;</span>) <span class="sc">~</span> scales<span class="sc">::</span><span class="fu">percent</span>(value, <span class="at">accuracy =</span> <span class="fl">0.1</span>)</span>
<span id="cb360-7"><a href="preds_quantit.html#cb360-7" tabindex="-1"></a>        , T <span class="sc">~</span> scales<span class="sc">::</span><span class="fu">comma</span>(value, <span class="at">accuracy =</span> <span class="fl">0.1</span>)</span>
<span id="cb360-8"><a href="preds_quantit.html#cb360-8" tabindex="-1"></a>      )</span>
<span id="cb360-9"><a href="preds_quantit.html#cb360-9" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb360-10"><a href="preds_quantit.html#cb360-10" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kbl</span>(</span>
<span id="cb360-11"><a href="preds_quantit.html#cb360-11" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">&quot;comparison of aggregated allometric field volume and allometric predicted volume&quot;</span></span>
<span id="cb360-12"><a href="preds_quantit.html#cb360-12" tabindex="-1"></a>    , <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">&quot;metric&quot;</span>, <span class="st">&quot;value&quot;</span>)</span>
<span id="cb360-13"><a href="preds_quantit.html#cb360-13" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb360-14"><a href="preds_quantit.html#cb360-14" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kable_styling</span>()</span></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-395">Table 9.7: </span>comparison of aggregated allometric field volume and allometric predicted volume
</caption>
<thead>
<tr>
<th style="text-align:left;">
metric
</th>
<th style="text-align:left;">
value
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
mean_diff
</td>
<td style="text-align:left;">
1.0
</td>
</tr>
<tr>
<td style="text-align:left;">
sd_diff
</td>
<td style="text-align:left;">
12.4
</td>
</tr>
<tr>
<td style="text-align:left;">
mean_field_volume_m3
</td>
<td style="text-align:left;">
15.4
</td>
</tr>
<tr>
<td style="text-align:left;">
mean_pred_allom_volume_m3
</td>
<td style="text-align:left;">
14.4
</td>
</tr>
<tr>
<td style="text-align:left;">
pct_mean_diff
</td>
<td style="text-align:left;">
6.6%
</td>
</tr>
</tbody>
</table>
<p>we’ll dig into the MD shortly but before we move on let’s focus on the percent mean difference. We calcualted a %MD of 6.6% which indicates a slight systematic difference where the allometric field volume is, on average, 6.6% larger than our predicted allometric volume.</p>
<p>let’s make a Bland-Altman plot to compare the two measurement methods. this plot uses the average of the two measurements (approximate size) on the x-axis and the difference (bias) between the two measurements on the y-axis</p>
<div class="sourceCode" id="cb361"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb361-1"><a href="preds_quantit.html#cb361-1" tabindex="-1"></a>dbscan_gt_pred_match[[<span class="st">&quot;psinf&quot;</span>]] <span class="sc">%&gt;%</span> </span>
<span id="cb361-2"><a href="preds_quantit.html#cb361-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(match_grp<span class="sc">==</span><span class="st">&quot;true positive&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb361-3"><a href="preds_quantit.html#cb361-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb361-4"><a href="preds_quantit.html#cb361-4" tabindex="-1"></a>  <span class="co"># calc needed metrics</span></span>
<span id="cb361-5"><a href="preds_quantit.html#cb361-5" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb361-6"><a href="preds_quantit.html#cb361-6" tabindex="-1"></a>    <span class="at">mean_vol =</span> (field_volume_m3<span class="sc">+</span>pred_allom_volume_m3)<span class="sc">/</span><span class="dv">2</span></span>
<span id="cb361-7"><a href="preds_quantit.html#cb361-7" tabindex="-1"></a>    , <span class="at">diff_vol =</span> (field_volume_m3<span class="sc">-</span>pred_allom_volume_m3) <span class="co"># match the order used in vol_agg_df_temp</span></span>
<span id="cb361-8"><a href="preds_quantit.html#cb361-8" tabindex="-1"></a>    , <span class="at">scale_diff =</span> <span class="fu">ifelse</span>(diff_vol <span class="sc">&lt;</span> <span class="dv">0</span>, <span class="sc">-</span><span class="fu">abs</span>(diff_vol) <span class="sc">/</span> <span class="fu">abs</span>(<span class="fu">min</span>(diff_vol)), diff_vol <span class="sc">/</span> <span class="fu">max</span>(diff_vol))</span>
<span id="cb361-9"><a href="preds_quantit.html#cb361-9" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb361-10"><a href="preds_quantit.html#cb361-10" tabindex="-1"></a>  <span class="co"># ggplot() + geom_point(aes(x=diff_vol,y=0, color=scale_diff)) + scale_color_gradient2(mid = &quot;gray&quot;, midpoint = 0, low = &quot;red&quot;, high = &quot;blue&quot;)</span></span>
<span id="cb361-11"><a href="preds_quantit.html#cb361-11" tabindex="-1"></a>  <span class="co"># plot</span></span>
<span id="cb361-12"><a href="preds_quantit.html#cb361-12" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(</span>
<span id="cb361-13"><a href="preds_quantit.html#cb361-13" tabindex="-1"></a>    <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> mean_vol, <span class="at">y =</span> diff_vol)</span>
<span id="cb361-14"><a href="preds_quantit.html#cb361-14" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb361-15"><a href="preds_quantit.html#cb361-15" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">lwd =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb361-16"><a href="preds_quantit.html#cb361-16" tabindex="-1"></a>  <span class="co"># mean difference (bias)</span></span>
<span id="cb361-17"><a href="preds_quantit.html#cb361-17" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_hline</span>(</span>
<span id="cb361-18"><a href="preds_quantit.html#cb361-18" tabindex="-1"></a>    <span class="at">yintercept =</span> vol_agg_df_temp<span class="sc">$</span>mean_diff</span>
<span id="cb361-19"><a href="preds_quantit.html#cb361-19" tabindex="-1"></a>    , <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>, <span class="at">color =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">lwd =</span> <span class="dv">1</span></span>
<span id="cb361-20"><a href="preds_quantit.html#cb361-20" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb361-21"><a href="preds_quantit.html#cb361-21" tabindex="-1"></a>  <span class="co"># upper limit</span></span>
<span id="cb361-22"><a href="preds_quantit.html#cb361-22" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_hline</span>(</span>
<span id="cb361-23"><a href="preds_quantit.html#cb361-23" tabindex="-1"></a>    <span class="at">yintercept =</span> vol_agg_df_temp<span class="sc">$</span>mean_diff<span class="fl">+1.96</span><span class="sc">*</span>vol_agg_df_temp<span class="sc">$</span>sd_diff</span>
<span id="cb361-24"><a href="preds_quantit.html#cb361-24" tabindex="-1"></a>    , <span class="at">linetype =</span> <span class="st">&quot;dotted&quot;</span>, <span class="at">color =</span> <span class="st">&quot;red&quot;</span>, <span class="at">lwd =</span> <span class="dv">1</span></span>
<span id="cb361-25"><a href="preds_quantit.html#cb361-25" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb361-26"><a href="preds_quantit.html#cb361-26" tabindex="-1"></a>  <span class="co"># lower limit</span></span>
<span id="cb361-27"><a href="preds_quantit.html#cb361-27" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_hline</span>(</span>
<span id="cb361-28"><a href="preds_quantit.html#cb361-28" tabindex="-1"></a>    <span class="at">yintercept =</span> vol_agg_df_temp<span class="sc">$</span>mean_diff<span class="fl">-1.96</span><span class="sc">*</span>vol_agg_df_temp<span class="sc">$</span>sd_diff</span>
<span id="cb361-29"><a href="preds_quantit.html#cb361-29" tabindex="-1"></a>    , <span class="at">linetype =</span> <span class="st">&quot;dotted&quot;</span>, <span class="at">color =</span> <span class="st">&quot;red&quot;</span>, <span class="at">lwd =</span> <span class="dv">1</span></span>
<span id="cb361-30"><a href="preds_quantit.html#cb361-30" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb361-31"><a href="preds_quantit.html#cb361-31" tabindex="-1"></a>  <span class="co"># annotations</span></span>
<span id="cb361-32"><a href="preds_quantit.html#cb361-32" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">annotate</span>(</span>
<span id="cb361-33"><a href="preds_quantit.html#cb361-33" tabindex="-1"></a>    <span class="st">&quot;text&quot;</span></span>
<span id="cb361-34"><a href="preds_quantit.html#cb361-34" tabindex="-1"></a>    , <span class="at">x =</span> <span class="cn">Inf</span></span>
<span id="cb361-35"><a href="preds_quantit.html#cb361-35" tabindex="-1"></a>    , <span class="at">y =</span> vol_agg_df_temp<span class="sc">$</span>mean_diff</span>
<span id="cb361-36"><a href="preds_quantit.html#cb361-36" tabindex="-1"></a>    , <span class="at">label =</span> latex2exp<span class="sc">::</span><span class="fu">TeX</span>(</span>
<span id="cb361-37"><a href="preds_quantit.html#cb361-37" tabindex="-1"></a>      <span class="fu">paste0</span>(</span>
<span id="cb361-38"><a href="preds_quantit.html#cb361-38" tabindex="-1"></a>        <span class="st">&quot;mean difference (bias): &quot;</span></span>
<span id="cb361-39"><a href="preds_quantit.html#cb361-39" tabindex="-1"></a>        , scales<span class="sc">::</span><span class="fu">comma</span>(vol_agg_df_temp<span class="sc">$</span>mean_diff, <span class="at">accuracy =</span> <span class="fl">0.01</span>)</span>
<span id="cb361-40"><a href="preds_quantit.html#cb361-40" tabindex="-1"></a>        , <span class="st">&quot; $m^3$&quot;</span></span>
<span id="cb361-41"><a href="preds_quantit.html#cb361-41" tabindex="-1"></a>      )</span>
<span id="cb361-42"><a href="preds_quantit.html#cb361-42" tabindex="-1"></a>      , <span class="at">output =</span> <span class="st">&quot;character&quot;</span></span>
<span id="cb361-43"><a href="preds_quantit.html#cb361-43" tabindex="-1"></a>    )</span>
<span id="cb361-44"><a href="preds_quantit.html#cb361-44" tabindex="-1"></a>    , <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.5</span></span>
<span id="cb361-45"><a href="preds_quantit.html#cb361-45" tabindex="-1"></a>    , <span class="at">hjust =</span> <span class="dv">1</span></span>
<span id="cb361-46"><a href="preds_quantit.html#cb361-46" tabindex="-1"></a>    , <span class="at">color =</span> <span class="st">&quot;blue&quot;</span></span>
<span id="cb361-47"><a href="preds_quantit.html#cb361-47" tabindex="-1"></a>    , <span class="at">size =</span> <span class="dv">4</span></span>
<span id="cb361-48"><a href="preds_quantit.html#cb361-48" tabindex="-1"></a>    , <span class="at">parse =</span> <span class="cn">TRUE</span></span>
<span id="cb361-49"><a href="preds_quantit.html#cb361-49" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb361-50"><a href="preds_quantit.html#cb361-50" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">annotate</span>(</span>
<span id="cb361-51"><a href="preds_quantit.html#cb361-51" tabindex="-1"></a>    <span class="st">&quot;text&quot;</span></span>
<span id="cb361-52"><a href="preds_quantit.html#cb361-52" tabindex="-1"></a>    , <span class="at">x =</span> <span class="cn">Inf</span></span>
<span id="cb361-53"><a href="preds_quantit.html#cb361-53" tabindex="-1"></a>    , <span class="at">y =</span> vol_agg_df_temp<span class="sc">$</span>mean_diff<span class="fl">+1.96</span><span class="sc">*</span>vol_agg_df_temp<span class="sc">$</span>sd_diff</span>
<span id="cb361-54"><a href="preds_quantit.html#cb361-54" tabindex="-1"></a>    , <span class="at">label =</span> latex2exp<span class="sc">::</span><span class="fu">TeX</span>(</span>
<span id="cb361-55"><a href="preds_quantit.html#cb361-55" tabindex="-1"></a>      <span class="fu">paste0</span>(</span>
<span id="cb361-56"><a href="preds_quantit.html#cb361-56" tabindex="-1"></a>        <span class="st">&quot;+1.96 SD: &quot;</span></span>
<span id="cb361-57"><a href="preds_quantit.html#cb361-57" tabindex="-1"></a>        , scales<span class="sc">::</span><span class="fu">comma</span>(vol_agg_df_temp<span class="sc">$</span>mean_diff<span class="fl">+1.96</span><span class="sc">*</span>vol_agg_df_temp<span class="sc">$</span>sd_diff, <span class="at">accuracy =</span> <span class="fl">0.01</span>)</span>
<span id="cb361-58"><a href="preds_quantit.html#cb361-58" tabindex="-1"></a>        , <span class="st">&quot; $m^3$&quot;</span></span>
<span id="cb361-59"><a href="preds_quantit.html#cb361-59" tabindex="-1"></a>      )</span>
<span id="cb361-60"><a href="preds_quantit.html#cb361-60" tabindex="-1"></a>      , <span class="at">output =</span> <span class="st">&quot;character&quot;</span></span>
<span id="cb361-61"><a href="preds_quantit.html#cb361-61" tabindex="-1"></a>    )</span>
<span id="cb361-62"><a href="preds_quantit.html#cb361-62" tabindex="-1"></a>    , <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.5</span></span>
<span id="cb361-63"><a href="preds_quantit.html#cb361-63" tabindex="-1"></a>    , <span class="at">hjust =</span> <span class="dv">1</span></span>
<span id="cb361-64"><a href="preds_quantit.html#cb361-64" tabindex="-1"></a>    , <span class="at">color =</span> <span class="st">&quot;red&quot;</span></span>
<span id="cb361-65"><a href="preds_quantit.html#cb361-65" tabindex="-1"></a>    , <span class="at">size =</span> <span class="dv">4</span></span>
<span id="cb361-66"><a href="preds_quantit.html#cb361-66" tabindex="-1"></a>    , <span class="at">parse =</span> <span class="cn">TRUE</span></span>
<span id="cb361-67"><a href="preds_quantit.html#cb361-67" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb361-68"><a href="preds_quantit.html#cb361-68" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">annotate</span>(</span>
<span id="cb361-69"><a href="preds_quantit.html#cb361-69" tabindex="-1"></a>    <span class="st">&quot;text&quot;</span></span>
<span id="cb361-70"><a href="preds_quantit.html#cb361-70" tabindex="-1"></a>    , <span class="at">x =</span> <span class="cn">Inf</span></span>
<span id="cb361-71"><a href="preds_quantit.html#cb361-71" tabindex="-1"></a>    , <span class="at">y =</span> vol_agg_df_temp<span class="sc">$</span>mean_diff<span class="fl">-1.96</span><span class="sc">*</span>vol_agg_df_temp<span class="sc">$</span>sd_diff</span>
<span id="cb361-72"><a href="preds_quantit.html#cb361-72" tabindex="-1"></a>    , <span class="at">label =</span> latex2exp<span class="sc">::</span><span class="fu">TeX</span>(</span>
<span id="cb361-73"><a href="preds_quantit.html#cb361-73" tabindex="-1"></a>      <span class="fu">paste0</span>(</span>
<span id="cb361-74"><a href="preds_quantit.html#cb361-74" tabindex="-1"></a>        <span class="st">&quot;-1.96 SD: &quot;</span></span>
<span id="cb361-75"><a href="preds_quantit.html#cb361-75" tabindex="-1"></a>        , scales<span class="sc">::</span><span class="fu">comma</span>(vol_agg_df_temp<span class="sc">$</span>mean_diff<span class="fl">-1.96</span><span class="sc">*</span>vol_agg_df_temp<span class="sc">$</span>sd_diff, <span class="at">accuracy =</span> <span class="fl">0.01</span>)</span>
<span id="cb361-76"><a href="preds_quantit.html#cb361-76" tabindex="-1"></a>        , <span class="st">&quot; $m^3$&quot;</span></span>
<span id="cb361-77"><a href="preds_quantit.html#cb361-77" tabindex="-1"></a>      )</span>
<span id="cb361-78"><a href="preds_quantit.html#cb361-78" tabindex="-1"></a>      , <span class="at">output =</span> <span class="st">&quot;character&quot;</span></span>
<span id="cb361-79"><a href="preds_quantit.html#cb361-79" tabindex="-1"></a>    )</span>
<span id="cb361-80"><a href="preds_quantit.html#cb361-80" tabindex="-1"></a>    , <span class="at">vjust =</span> <span class="fl">1.5</span></span>
<span id="cb361-81"><a href="preds_quantit.html#cb361-81" tabindex="-1"></a>    , <span class="at">hjust =</span> <span class="dv">1</span></span>
<span id="cb361-82"><a href="preds_quantit.html#cb361-82" tabindex="-1"></a>    , <span class="at">color =</span> <span class="st">&quot;red&quot;</span></span>
<span id="cb361-83"><a href="preds_quantit.html#cb361-83" tabindex="-1"></a>    , <span class="at">size =</span> <span class="dv">4</span></span>
<span id="cb361-84"><a href="preds_quantit.html#cb361-84" tabindex="-1"></a>    , <span class="at">parse =</span> <span class="cn">TRUE</span></span>
<span id="cb361-85"><a href="preds_quantit.html#cb361-85" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb361-86"><a href="preds_quantit.html#cb361-86" tabindex="-1"></a>  <span class="co"># points</span></span>
<span id="cb361-87"><a href="preds_quantit.html#cb361-87" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_point</span>(<span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">color =</span> scale_diff), <span class="at">size =</span> <span class="fl">1.9</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb361-88"><a href="preds_quantit.html#cb361-88" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_color_steps2</span>(<span class="at">mid =</span> <span class="st">&quot;gray&quot;</span>, <span class="at">midpoint =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb361-89"><a href="preds_quantit.html#cb361-89" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb361-90"><a href="preds_quantit.html#cb361-90" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">&quot;Bland-Altman plot: allometric field volume vs allometric predicted volume&quot;</span></span>
<span id="cb361-91"><a href="preds_quantit.html#cb361-91" tabindex="-1"></a>    , <span class="at">x =</span> latex2exp<span class="sc">::</span><span class="fu">TeX</span>(<span class="st">&quot;mean allometric volume ($m^3$)&quot;</span>)</span>
<span id="cb361-92"><a href="preds_quantit.html#cb361-92" tabindex="-1"></a>    , <span class="at">y =</span> latex2exp<span class="sc">::</span><span class="fu">TeX</span>(<span class="st">&quot;difference (allometric field - allometric predicted volume $m^3$)&quot;</span>)</span>
<span id="cb361-93"><a href="preds_quantit.html#cb361-93" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb361-94"><a href="preds_quantit.html#cb361-94" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb361-95"><a href="preds_quantit.html#cb361-95" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span></code></pre></div>
<p><img src="slash_pile_detecting_files/figure-html/unnamed-chunk-396-1.png" alt="" width="1008" /></p>
<p>That’s a lot of plotting to show that the mean difference is 0.96 m<sup>3</sup>. This is a significant improvement over our comparison between the allometric field value and the irregular, CHM-derived prediction</p>
<p>let’s use a paired t-test to determine if the mean difference (MD) between the allometric field volume and the allometric predicted volume is statistically significant (i.e. significantly different from zero)</p>
<div class="sourceCode" id="cb362"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb362-1"><a href="preds_quantit.html#cb362-1" tabindex="-1"></a><span class="co"># is the mean difference between the two volumes significantly different from zero</span></span>
<span id="cb362-2"><a href="preds_quantit.html#cb362-2" tabindex="-1"></a>ttest_temp <span class="ot">&lt;-</span> <span class="fu">t.test</span>(</span>
<span id="cb362-3"><a href="preds_quantit.html#cb362-3" tabindex="-1"></a>  dbscan_gt_pred_match[[<span class="st">&quot;psinf&quot;</span>]] <span class="sc">%&gt;%</span> </span>
<span id="cb362-4"><a href="preds_quantit.html#cb362-4" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(match_grp <span class="sc">==</span> <span class="st">&quot;true positive&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb362-5"><a href="preds_quantit.html#cb362-5" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">pull</span>(field_volume_m3)</span>
<span id="cb362-6"><a href="preds_quantit.html#cb362-6" tabindex="-1"></a>  , dbscan_gt_pred_match[[<span class="st">&quot;psinf&quot;</span>]] <span class="sc">%&gt;%</span> </span>
<span id="cb362-7"><a href="preds_quantit.html#cb362-7" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(match_grp <span class="sc">==</span> <span class="st">&quot;true positive&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb362-8"><a href="preds_quantit.html#cb362-8" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">pull</span>(pred_allom_volume_m3)</span>
<span id="cb362-9"><a href="preds_quantit.html#cb362-9" tabindex="-1"></a>  , <span class="at">paired =</span> <span class="cn">TRUE</span></span>
<span id="cb362-10"><a href="preds_quantit.html#cb362-10" tabindex="-1"></a>)</span>
<span id="cb362-11"><a href="preds_quantit.html#cb362-11" tabindex="-1"></a>ttest_temp</span></code></pre></div>
<pre><code>## 
##  Paired t-test
## 
## data:  dbscan_gt_pred_match[[&quot;psinf&quot;]] %&gt;% dplyr::filter(match_grp == &quot;true positive&quot;) %&gt;% dplyr::pull(field_volume_m3) and dbscan_gt_pred_match[[&quot;psinf&quot;]] %&gt;% dplyr::filter(match_grp == &quot;true positive&quot;) %&gt;% dplyr::pull(pred_allom_volume_m3)
## t = 0.82545, df = 114, p-value = 0.4108
## alternative hypothesis: true mean difference is not equal to 0
## 95 percent confidence interval:
##  -1.340997  3.256869
## sample estimates:
## mean difference 
##       0.9579359</code></pre>
<p>Wow, the p-value of 0.411 is greater than 0.05 (even 0.10), meaning we <em>fail</em> to reject the null hypothesis that the true mean difference is zero. That is, the mean difference between the field-measured volume and the predicted volume is not different than zero when both are forced to use the same paraboloid shape assumption. This contrasts sharply with the previously observed major systematic difference between the allometric field volume and the predicted irregular, CHM-derived volume. The non-significant difference strongly suggests that the major volume discrepancy noted earlier was primarily due to the geometric irregularity of the actual piles, and not to systematic prediction bias in our CHM-derived height and diameter measurements.</p>
</div>
<div id="stand-level-aggregation-2" class="section level3 hasAnchor" number="9.3.3">
<h3><span class="header-section-number">9.3.3</span> Stand-level Aggregation<a href="preds_quantit.html#stand-level-aggregation-2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Let’s summarize the measurement values of the predictions (true positive and false positive) and the ground truth data (true positive and false negative) over the entire stand (this is similar to a basal area comparison in a forest inventory). Summarizing the predicted and ground truth pile height and diameter form measurements for all instances across the entire study area, regardless of whether individual piles were successfully matched between datasets, for comparison provides insight into the method’s aggregated performance in predicting total pile size in an area. Such totals are often required for administrative needs like submitting burn permits which do not typically focus on individual pile quantification differences.</p>
<div class="sourceCode" id="cb364"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb364-1"><a href="preds_quantit.html#cb364-1" tabindex="-1"></a><span class="co"># do it</span></span>
<span id="cb364-2"><a href="preds_quantit.html#cb364-2" tabindex="-1"></a>sum_df_temp <span class="ot">&lt;-</span> </span>
<span id="cb364-3"><a href="preds_quantit.html#cb364-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(</span>
<span id="cb364-4"><a href="preds_quantit.html#cb364-4" tabindex="-1"></a>    dbscan_gt_pred_match[[<span class="st">&quot;psinf&quot;</span>]] <span class="sc">%&gt;%</span> </span>
<span id="cb364-5"><a href="preds_quantit.html#cb364-5" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb364-6"><a href="preds_quantit.html#cb364-6" tabindex="-1"></a>        <span class="at">pred_allom_volume_m3 =</span> (<span class="dv">1</span><span class="sc">/</span><span class="dv">8</span>) <span class="sc">*</span> pi <span class="sc">*</span> (pred_diameter_m<span class="sc">^</span><span class="dv">2</span>) <span class="sc">*</span> pred_height_m</span>
<span id="cb364-7"><a href="preds_quantit.html#cb364-7" tabindex="-1"></a>        , <span class="at">field_allom_volume_m3 =</span> field_volume_m3</span>
<span id="cb364-8"><a href="preds_quantit.html#cb364-8" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span> </span>
<span id="cb364-9"><a href="preds_quantit.html#cb364-9" tabindex="-1"></a>      <span class="fu">stand_agg_fn</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb364-10"><a href="preds_quantit.html#cb364-10" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">method =</span> <span class="st">&quot;dbscan&quot;</span>)</span>
<span id="cb364-11"><a href="preds_quantit.html#cb364-11" tabindex="-1"></a>    , watershed_gt_pred_match[[<span class="st">&quot;psinf&quot;</span>]] <span class="sc">%&gt;%</span> </span>
<span id="cb364-12"><a href="preds_quantit.html#cb364-12" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb364-13"><a href="preds_quantit.html#cb364-13" tabindex="-1"></a>        <span class="at">pred_allom_volume_m3 =</span> (<span class="dv">1</span><span class="sc">/</span><span class="dv">8</span>) <span class="sc">*</span> pi <span class="sc">*</span> (pred_diameter_m<span class="sc">^</span><span class="dv">2</span>) <span class="sc">*</span> pred_height_m</span>
<span id="cb364-14"><a href="preds_quantit.html#cb364-14" tabindex="-1"></a>        , <span class="at">field_allom_volume_m3 =</span> field_volume_m3</span>
<span id="cb364-15"><a href="preds_quantit.html#cb364-15" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span> </span>
<span id="cb364-16"><a href="preds_quantit.html#cb364-16" tabindex="-1"></a>      <span class="fu">stand_agg_fn</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb364-17"><a href="preds_quantit.html#cb364-17" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">method =</span> <span class="st">&quot;watershed&quot;</span>)</span>
<span id="cb364-18"><a href="preds_quantit.html#cb364-18" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb364-19"><a href="preds_quantit.html#cb364-19" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(</span>
<span id="cb364-20"><a href="preds_quantit.html#cb364-20" tabindex="-1"></a>    stringr<span class="sc">::</span><span class="fu">str_detect</span>(metric,<span class="st">&quot;volume&quot;</span>)</span>
<span id="cb364-21"><a href="preds_quantit.html#cb364-21" tabindex="-1"></a>  )</span>
<span id="cb364-22"><a href="preds_quantit.html#cb364-22" tabindex="-1"></a><span class="co"># sum_df_temp %&gt;% dplyr::glimpse()</span></span></code></pre></div>
<p>plot the aggregated, stand-level volume comparison between field-measured and predicted piles</p>
<div class="sourceCode" id="cb365"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb365-1"><a href="preds_quantit.html#cb365-1" tabindex="-1"></a><span class="co"># plot it</span></span>
<span id="cb365-2"><a href="preds_quantit.html#cb365-2" tabindex="-1"></a>sum_df_temp <span class="sc">%&gt;%</span> </span>
<span id="cb365-3"><a href="preds_quantit.html#cb365-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb365-4"><a href="preds_quantit.html#cb365-4" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb365-5"><a href="preds_quantit.html#cb365-5" tabindex="-1"></a>    <span class="at">stand_id=</span><span class="dv">1</span></span>
<span id="cb365-6"><a href="preds_quantit.html#cb365-6" tabindex="-1"></a>    , <span class="at">lab =</span> <span class="fu">paste0</span>(</span>
<span id="cb365-7"><a href="preds_quantit.html#cb365-7" tabindex="-1"></a>      scales<span class="sc">::</span><span class="fu">comma</span>(value,<span class="at">accuracy=</span><span class="fl">0.1</span>)</span>
<span id="cb365-8"><a href="preds_quantit.html#cb365-8" tabindex="-1"></a>      , dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb365-9"><a href="preds_quantit.html#cb365-9" tabindex="-1"></a>        <span class="fu">is.na</span>(pct_diff) <span class="sc">~</span> <span class="st">&quot;&quot;</span></span>
<span id="cb365-10"><a href="preds_quantit.html#cb365-10" tabindex="-1"></a>        , T <span class="sc">~</span> <span class="fu">paste0</span>(</span>
<span id="cb365-11"><a href="preds_quantit.html#cb365-11" tabindex="-1"></a>          <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span></span>
<span id="cb365-12"><a href="preds_quantit.html#cb365-12" tabindex="-1"></a>          , <span class="fu">ifelse</span>(pct_diff<span class="sc">&lt;</span><span class="dv">0</span>,<span class="st">&quot;-&quot;</span>,<span class="st">&quot;+&quot;</span>)</span>
<span id="cb365-13"><a href="preds_quantit.html#cb365-13" tabindex="-1"></a>          ,scales<span class="sc">::</span><span class="fu">percent</span>(<span class="fu">abs</span>(pct_diff),<span class="at">accuracy=</span><span class="fl">0.1</span>)</span>
<span id="cb365-14"><a href="preds_quantit.html#cb365-14" tabindex="-1"></a>        )</span>
<span id="cb365-15"><a href="preds_quantit.html#cb365-15" tabindex="-1"></a>      )</span>
<span id="cb365-16"><a href="preds_quantit.html#cb365-16" tabindex="-1"></a>    )</span>
<span id="cb365-17"><a href="preds_quantit.html#cb365-17" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb365-18"><a href="preds_quantit.html#cb365-18" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(</span>
<span id="cb365-19"><a href="preds_quantit.html#cb365-19" tabindex="-1"></a>    <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(</span>
<span id="cb365-20"><a href="preds_quantit.html#cb365-20" tabindex="-1"></a>      <span class="at">x =</span> which_data</span>
<span id="cb365-21"><a href="preds_quantit.html#cb365-21" tabindex="-1"></a>      , <span class="at">y =</span> value</span>
<span id="cb365-22"><a href="preds_quantit.html#cb365-22" tabindex="-1"></a>      , <span class="at">label =</span> lab</span>
<span id="cb365-23"><a href="preds_quantit.html#cb365-23" tabindex="-1"></a>      , <span class="at">group =</span> stand_id</span>
<span id="cb365-24"><a href="preds_quantit.html#cb365-24" tabindex="-1"></a>    )</span>
<span id="cb365-25"><a href="preds_quantit.html#cb365-25" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb365-26"><a href="preds_quantit.html#cb365-26" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_line</span>(<span class="at">key_glyph =</span> <span class="st">&quot;point&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>, <span class="at">color =</span> <span class="st">&quot;gray&quot;</span>, <span class="at">lwd =</span> <span class="fl">1.1</span>) <span class="sc">+</span></span>
<span id="cb365-27"><a href="preds_quantit.html#cb365-27" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_col</span>(<span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">fill =</span> which_data), <span class="at">alpha =</span> <span class="dv">1</span>, <span class="at">width =</span> <span class="fl">0.4</span>) <span class="sc">+</span></span>
<span id="cb365-28"><a href="preds_quantit.html#cb365-28" tabindex="-1"></a>  harrypotter<span class="sc">::</span><span class="fu">scale_color_hp_d</span>(<span class="at">option =</span> <span class="st">&quot;lunalovegood&quot;</span>) <span class="sc">+</span></span>
<span id="cb365-29"><a href="preds_quantit.html#cb365-29" tabindex="-1"></a>  harrypotter<span class="sc">::</span><span class="fu">scale_fill_hp_d</span>(<span class="at">option =</span> <span class="st">&quot;lunalovegood&quot;</span>) <span class="sc">+</span></span>
<span id="cb365-30"><a href="preds_quantit.html#cb365-30" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_text</span>(</span>
<span id="cb365-31"><a href="preds_quantit.html#cb365-31" tabindex="-1"></a>    <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.25</span></span>
<span id="cb365-32"><a href="preds_quantit.html#cb365-32" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb365-33"><a href="preds_quantit.html#cb365-33" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">facet_grid</span>(</span>
<span id="cb365-34"><a href="preds_quantit.html#cb365-34" tabindex="-1"></a>    <span class="at">rows =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(pile_metric)</span>
<span id="cb365-35"><a href="preds_quantit.html#cb365-35" tabindex="-1"></a>    , <span class="at">cols =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(method)</span>
<span id="cb365-36"><a href="preds_quantit.html#cb365-36" tabindex="-1"></a>    , <span class="at">scales =</span> <span class="st">&quot;free_y&quot;</span>, <span class="at">axes =</span> <span class="st">&quot;all_x&quot;</span></span>
<span id="cb365-37"><a href="preds_quantit.html#cb365-37" tabindex="-1"></a>    , <span class="at">switch =</span> <span class="st">&quot;y&quot;</span></span>
<span id="cb365-38"><a href="preds_quantit.html#cb365-38" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb365-39"><a href="preds_quantit.html#cb365-39" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>comma, <span class="at">expand =</span> ggplot2<span class="sc">::</span><span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="dv">0</span>,.<span class="dv">3</span>)), <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb365-40"><a href="preds_quantit.html#cb365-40" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb365-41"><a href="preds_quantit.html#cb365-41" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;&quot;</span>, <span class="at">y =</span> <span class="st">&quot;&quot;</span></span>
<span id="cb365-42"><a href="preds_quantit.html#cb365-42" tabindex="-1"></a>    , <span class="at">subtitle =</span> <span class="st">&quot;Comparison of aggregated volume estimates at the PSINF site&quot;</span></span>
<span id="cb365-43"><a href="preds_quantit.html#cb365-43" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb365-44"><a href="preds_quantit.html#cb365-44" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb365-45"><a href="preds_quantit.html#cb365-45" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb365-46"><a href="preds_quantit.html#cb365-46" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb365-47"><a href="preds_quantit.html#cb365-47" tabindex="-1"></a>    , <span class="at">axis.text.x =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb365-48"><a href="preds_quantit.html#cb365-48" tabindex="-1"></a>    , <span class="at">strip.text =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb365-49"><a href="preds_quantit.html#cb365-49" tabindex="-1"></a>    , <span class="at">panel.grid =</span> ggplot2<span class="sc">::</span><span class="fu">element_blank</span>()</span>
<span id="cb365-50"><a href="preds_quantit.html#cb365-50" tabindex="-1"></a>  ) </span></code></pre></div>
<p><img src="slash_pile_detecting_files/figure-html/unnamed-chunk-399-1.png" alt="" width="1008" /></p>
<p>table the aggregated, stand-level volume comparison between field-measured and predicted piles</p>
<div class="sourceCode" id="cb366"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb366-1"><a href="preds_quantit.html#cb366-1" tabindex="-1"></a>sum_df_temp <span class="sc">%&gt;%</span> </span>
<span id="cb366-2"><a href="preds_quantit.html#cb366-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb366-3"><a href="preds_quantit.html#cb366-3" tabindex="-1"></a>    <span class="at">pile_metric=</span>dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb366-4"><a href="preds_quantit.html#cb366-4" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_detect</span>(metric,<span class="st">&quot;_allom_&quot;</span>) <span class="sc">~</span> <span class="st">&quot;allometric&quot;</span></span>
<span id="cb366-5"><a href="preds_quantit.html#cb366-5" tabindex="-1"></a>      , T <span class="sc">~</span> <span class="st">&quot;irregular&quot;</span></span>
<span id="cb366-6"><a href="preds_quantit.html#cb366-6" tabindex="-1"></a>    )</span>
<span id="cb366-7"><a href="preds_quantit.html#cb366-7" tabindex="-1"></a>    , <span class="at">value =</span> scales<span class="sc">::</span><span class="fu">comma</span>(value,<span class="at">accuracy=</span><span class="fl">0.1</span>)</span>
<span id="cb366-8"><a href="preds_quantit.html#cb366-8" tabindex="-1"></a>    , <span class="at">pct_diff =</span> scales<span class="sc">::</span><span class="fu">percent</span>(pct_diff,<span class="at">accuracy=</span><span class="fl">0.1</span>)</span>
<span id="cb366-9"><a href="preds_quantit.html#cb366-9" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb366-10"><a href="preds_quantit.html#cb366-10" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_wider</span>(</span>
<span id="cb366-11"><a href="preds_quantit.html#cb366-11" tabindex="-1"></a>    <span class="at">id_cols =</span> method</span>
<span id="cb366-12"><a href="preds_quantit.html#cb366-12" tabindex="-1"></a>    , <span class="at">values_from =</span> <span class="fu">c</span>(value,pct_diff)</span>
<span id="cb366-13"><a href="preds_quantit.html#cb366-13" tabindex="-1"></a>    , <span class="at">names_from =</span> <span class="fu">c</span>(pile_metric,which_data)</span>
<span id="cb366-14"><a href="preds_quantit.html#cb366-14" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb366-15"><a href="preds_quantit.html#cb366-15" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(dplyr<span class="sc">::</span><span class="fu">where</span>(<span class="sc">~</span> <span class="sc">!</span><span class="fu">all</span>(<span class="fu">is.na</span>(.x)))) <span class="sc">%&gt;%</span> </span>
<span id="cb366-16"><a href="preds_quantit.html#cb366-16" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename_with</span>(</span>
<span id="cb366-17"><a href="preds_quantit.html#cb366-17" tabindex="-1"></a>    <span class="at">.cols =</span> dplyr<span class="sc">::</span><span class="fu">everything</span>()</span>
<span id="cb366-18"><a href="preds_quantit.html#cb366-18" tabindex="-1"></a>    , <span class="at">.fn =</span> <span class="sc">~</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb366-19"><a href="preds_quantit.html#cb366-19" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_starts</span>(.x,<span class="st">&quot;value_&quot;</span>) <span class="sc">~</span> stringr<span class="sc">::</span><span class="fu">str_remove</span>(.x,<span class="st">&quot;^value_&quot;</span>) <span class="sc">%&gt;%</span> stringr<span class="sc">::</span><span class="fu">str_c</span>(<span class="st">&quot;_value&quot;</span>)</span>
<span id="cb366-20"><a href="preds_quantit.html#cb366-20" tabindex="-1"></a>      , stringr<span class="sc">::</span><span class="fu">str_starts</span>(.x,<span class="st">&quot;pct_diff_&quot;</span>) <span class="sc">~</span> stringr<span class="sc">::</span><span class="fu">str_remove</span>(.x,<span class="st">&quot;^pct_diff_&quot;</span>) <span class="sc">%&gt;%</span> stringr<span class="sc">::</span><span class="fu">str_c</span>(<span class="st">&quot;_zzpct_diff&quot;</span>)</span>
<span id="cb366-21"><a href="preds_quantit.html#cb366-21" tabindex="-1"></a>      , T <span class="sc">~</span> .x</span>
<span id="cb366-22"><a href="preds_quantit.html#cb366-22" tabindex="-1"></a>    )</span>
<span id="cb366-23"><a href="preds_quantit.html#cb366-23" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb366-24"><a href="preds_quantit.html#cb366-24" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">order</span>(<span class="fu">colnames</span>(.))) <span class="sc">%&gt;%</span> </span>
<span id="cb366-25"><a href="preds_quantit.html#cb366-25" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">site =</span> all_stand_boundary <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(site_data_lab<span class="sc">==</span><span class="st">&quot;psinf&quot;</span>) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">pull</span>(site)) <span class="sc">%&gt;%</span> </span>
<span id="cb366-26"><a href="preds_quantit.html#cb366-26" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">relocate</span>(site,method) <span class="sc">%&gt;%</span> </span>
<span id="cb366-27"><a href="preds_quantit.html#cb366-27" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(site,method) <span class="sc">%&gt;%</span> </span>
<span id="cb366-28"><a href="preds_quantit.html#cb366-28" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kbl</span>(</span>
<span id="cb366-29"><a href="preds_quantit.html#cb366-29" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">&quot;Comparison of aggregated volume estimates at the PSINF site&quot;</span></span>
<span id="cb366-30"><a href="preds_quantit.html#cb366-30" tabindex="-1"></a>    , <span class="at">col.names =</span> <span class="fu">c</span>(</span>
<span id="cb366-31"><a href="preds_quantit.html#cb366-31" tabindex="-1"></a>      <span class="st">&quot;site&quot;</span>, <span class="st">&quot;method&quot;</span></span>
<span id="cb366-32"><a href="preds_quantit.html#cb366-32" tabindex="-1"></a>      , <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;Field&quot;</span>,<span class="st">&quot;Predicted&quot;</span>,<span class="st">&quot;Pct Diff&quot;</span>), <span class="at">times =</span> <span class="dv">2</span>)</span>
<span id="cb366-33"><a href="preds_quantit.html#cb366-33" tabindex="-1"></a>    )</span>
<span id="cb366-34"><a href="preds_quantit.html#cb366-34" tabindex="-1"></a>    , <span class="at">escape =</span> F</span>
<span id="cb366-35"><a href="preds_quantit.html#cb366-35" tabindex="-1"></a>    <span class="co"># , digits = 2</span></span>
<span id="cb366-36"><a href="preds_quantit.html#cb366-36" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb366-37"><a href="preds_quantit.html#cb366-37" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kable_styling</span>(<span class="at">font_size =</span> <span class="fl">11.5</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb366-38"><a href="preds_quantit.html#cb366-38" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">add_header_above</span>(<span class="fu">c</span>(</span>
<span id="cb366-39"><a href="preds_quantit.html#cb366-39" tabindex="-1"></a>    <span class="st">&quot; &quot;</span><span class="ot">=</span><span class="dv">2</span></span>
<span id="cb366-40"><a href="preds_quantit.html#cb366-40" tabindex="-1"></a>    , <span class="st">&quot;Allometric Field vs Allometric Predicted Volume (m&lt;sup&gt;3&lt;/sup&gt;)&quot;</span> <span class="ot">=</span> <span class="dv">3</span></span>
<span id="cb366-41"><a href="preds_quantit.html#cb366-41" tabindex="-1"></a>    , <span class="st">&quot;Allometric Field vs Irregular Predicted Volume (m&lt;sup&gt;3&lt;/sup&gt;)&quot;</span> <span class="ot">=</span> <span class="dv">3</span></span>
<span id="cb366-42"><a href="preds_quantit.html#cb366-42" tabindex="-1"></a>  ),<span class="at">escape =</span> F) <span class="sc">%&gt;%</span> </span>
<span id="cb366-43"><a href="preds_quantit.html#cb366-43" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">column_spec</span>(<span class="fu">seq</span>(<span class="dv">2</span>,<span class="dv">8</span>,<span class="at">by=</span><span class="dv">3</span>), <span class="at">border_right =</span> <span class="cn">TRUE</span>, <span class="at">include_thead =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb366-44"><a href="preds_quantit.html#cb366-44" tabindex="-1"></a>  <span class="co"># kableExtra::column_spec(</span></span>
<span id="cb366-45"><a href="preds_quantit.html#cb366-45" tabindex="-1"></a>  <span class="co">#   column = 2:8</span></span>
<span id="cb366-46"><a href="preds_quantit.html#cb366-46" tabindex="-1"></a>  <span class="co">#   , extra_css = &quot;font-size: 10px;&quot;</span></span>
<span id="cb366-47"><a href="preds_quantit.html#cb366-47" tabindex="-1"></a>  <span class="co">#   , include_thead = T</span></span>
<span id="cb366-48"><a href="preds_quantit.html#cb366-48" tabindex="-1"></a>  <span class="co"># ) %&gt;%</span></span>
<span id="cb366-49"><a href="preds_quantit.html#cb366-49" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">collapse_rows</span>(<span class="at">columns =</span> <span class="dv">1</span>, <span class="at">valign =</span> <span class="st">&quot;top&quot;</span>)</span></code></pre></div>
<table class="table" style="font-size: 11.5px; margin-left: auto; margin-right: auto;">
<caption style="font-size: initial !important;">
<span id="tab:unnamed-chunk-400">Table 9.8: </span>Comparison of aggregated volume estimates at the PSINF site
</caption>
<thead>
<tr>
<th style="empty-cells: hide;border-bottom:hidden;" colspan="2">
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="3">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Allometric Field vs Allometric Predicted Volume (m<sup>3</sup>)
</div>
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="3">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Allometric Field vs Irregular Predicted Volume (m<sup>3</sup>)
</div>
</th>
</tr>
<tr>
<th style="text-align:left;">
site
</th>
<th style="text-align:left;border-right:1px solid;">
method
</th>
<th style="text-align:left;">
Field
</th>
<th style="text-align:left;">
Predicted
</th>
<th style="text-align:left;border-right:1px solid;">
Pct Diff
</th>
<th style="text-align:left;">
Field
</th>
<th style="text-align:left;">
Predicted
</th>
<th style="text-align:left;border-right:1px solid;">
Pct Diff
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="2">
PSINF Mixed Conifer Site
</td>
<td style="text-align:left;border-right:1px solid;">
dbscan
</td>
<td style="text-align:left;">
1,813.8
</td>
<td style="text-align:left;">
1,698.8
</td>
<td style="text-align:left;border-right:1px solid;">
-6.3%
</td>
<td style="text-align:left;">
1,813.8
</td>
<td style="text-align:left;">
1,053.6
</td>
<td style="text-align:left;border-right:1px solid;">
-41.9%
</td>
</tr>
<tr>
<td style="text-align:left;border-right:1px solid;">
watershed
</td>
<td style="text-align:left;">
1,813.8
</td>
<td style="text-align:left;">
1,794.4
</td>
<td style="text-align:left;border-right:1px solid;">
-1.1%
</td>
<td style="text-align:left;">
1,813.8
</td>
<td style="text-align:left;">
1,111.1
</td>
<td style="text-align:left;border-right:1px solid;">
-38.7%
</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="preds_detect.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
  "sharing": {
    "github": false,
    "facebook": true,
    "twitter": true,
    "linkedin": false,
    "weibo": false,
    "instapaper": false,
    "vk": false,
    "whatsapp": false,
    "all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
  },
  "fontsettings": {
    "theme": "white",
    "family": "sans",
    "size": 2
  },
  "edit": {
    "link": null,
    "text": null
  },
  "history": {
    "link": null,
    "text": null
  },
  "view": {
    "link": null,
    "text": null
  },
  "download": null,
  "search": {
    "engine": "fuse",
    "options": null
  },
  "toc": {
    "collapse": "subsection"
  }
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
