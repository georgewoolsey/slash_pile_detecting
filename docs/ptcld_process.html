<!DOCTYPE html>
<html lang="en-US" xml:lang="en-US">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Section 3 Point Cloud Processing | Aerial Imagery and Point Cloud Data for Slash Pile Quantification</title>
  <meta name="description" content="Using the bookdown package to write a book of data exploration. The output format for this example is bookdown::gitbook." />
  <meta name="generator" content="bookdown 0.34 and GitBook 2.6.7" />

  <meta property="og:title" content="Section 3 Point Cloud Processing | Aerial Imagery and Point Cloud Data for Slash Pile Quantification" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="Using the bookdown package to write a book of data exploration. The output format for this example is bookdown::gitbook." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Section 3 Point Cloud Processing | Aerial Imagery and Point Cloud Data for Slash Pile Quantification" />
  
  <meta name="twitter:description" content="Using the bookdown package to write a book of data exploration. The output format for this example is bookdown::gitbook." />
  

<meta name="author" content="George Woolsey" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="data_load.html"/>
<link rel="next" href="geom_detect.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<link href="libs/htmltools-fill-0.5.9/fill.css" rel="stylesheet" />
<script src="libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/proj4-2.6.2/proj4.min.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.2.2/leaflet.js"></script>
<script src="libs/leaflet-providers-2.0.0/leaflet-providers_2.0.0.js"></script>
<script src="libs/leaflet-providers-plugin-2.2.2/leaflet-providers-plugin.js"></script>
<script src="libs/HomeButton-0.0.1/home-button.js"></script>
<script src="libs/HomeButton-0.0.1/easy-button-src.min.js"></script>
<link href="libs/study sites-CSS-0.0.1/study sites_home-button.css" rel="stylesheet" />
<script src="libs/clipboard-0.0.1/setClipboardText.js"></script>
<link href="libs/mapviewCSS-0.0.1/mapview-popup.css" rel="stylesheet" />
<link href="libs/mapviewCSS-0.0.1/mapview.css" rel="stylesheet" />
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<link href="libs/bsTable-3.3.7/bootstrapTable.min.css" rel="stylesheet" />
<script src="libs/bsTable-3.3.7/bootstrapTable.js"></script>
<script type="text/javascript">

// toggle visibility of R source blocks in R Markdown output
function toggle_R() {
  var x = document.getElementsByClassName('r');
  if (x.length == 0) return;
  function toggle_vis(o) {
    var d = o.style.display;
    o.style.display = (d == 'block' || d == '') ? 'none':'block';
  }

  for (i = 0; i < x.length; i++) {
    var y = x[i];
    if (y.tagName.toLowerCase() === 'pre') toggle_vis(y);
  }

    var elem = document.getElementById("myButton1");
    if (elem.value === "Hide Code") elem.value = "Show Code";
    else elem.value = "Hide Code";
}

document.write('<input onclick="toggle_R();" type="button" value="Hide Code" id="myButton1" style="position: absolute; top: 10%; right: 2%; z-index: 200"></input>')

</script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#objective"><i class="fa fa-check"></i><b>1.1</b> Objective</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#data_desc"><i class="fa fa-check"></i><b>1.2</b> Data and Site Descriptions</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="index.html"><a href="index.html#silvicultural-prescriptions"><i class="fa fa-check"></i><b>1.2.1</b> Silvicultural Prescriptions</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#analysis-plan"><i class="fa fa-check"></i><b>1.3</b> Analysis Plan</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="data_load.html"><a href="data_load.html"><i class="fa fa-check"></i><b>2</b> Data Overview</a>
<ul>
<li class="chapter" data-level="2.1" data-path="data_load.html"><a href="data_load.html#study-units-vector-data"><i class="fa fa-check"></i><b>2.1</b> Study Units Vector Data</a></li>
<li class="chapter" data-level="2.2" data-path="data_load.html"><a href="data_load.html#slash-pile-vector-data"><i class="fa fa-check"></i><b>2.2</b> Slash Pile Vector Data</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="data_load.html"><a href="data_load.html#standardize-pile-data"><i class="fa fa-check"></i><b>2.2.1</b> Standardize Pile Data</a></li>
<li class="chapter" data-level="2.2.2" data-path="data_load.html"><a href="data_load.html#pile-form-measurements"><i class="fa fa-check"></i><b>2.2.2</b> Pile Form Measurements</a></li>
<li class="chapter" data-level="2.2.3" data-path="data_load.html"><a href="data_load.html#image-annotation-comparison"><i class="fa fa-check"></i><b>2.2.3</b> Image-Annotation Comparison</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="data_load.html"><a href="data_load.html#rgb-orthomosaic"><i class="fa fa-check"></i><b>2.3</b> RGB orthomosaic</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="data_load.html"><a href="data_load.html#psinf-mixed-conifer-site-1"><i class="fa fa-check"></i><b>2.3.1</b> PSINF Mixed Conifer Site</a></li>
<li class="chapter" data-level="2.3.2" data-path="data_load.html"><a href="data_load.html#trfo-blm-pinyon-juniper-site-1"><i class="fa fa-check"></i><b>2.3.2</b> TRFO-BLM Pinyon-Juniper Site</a></li>
<li class="chapter" data-level="2.3.3" data-path="data_load.html"><a href="data_load.html#bhef-ponderosa-pine-site-1"><i class="fa fa-check"></i><b>2.3.3</b> BHEF Ponderosa Pine Site</a></li>
<li class="chapter" data-level="2.3.4" data-path="data_load.html"><a href="data_load.html#arnf-ponderosa-pine-site-1"><i class="fa fa-check"></i><b>2.3.4</b> ARNF Ponderosa Pine Site</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="data_load.html"><a href="data_load.html#slash-pile-rgb-imagery"><i class="fa fa-check"></i><b>2.4</b> Slash Pile RGB Imagery</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="data_load.html"><a href="data_load.html#psinf-mixed-conifer-site-2"><i class="fa fa-check"></i><b>2.4.1</b> PSINF Mixed Conifer Site</a></li>
<li class="chapter" data-level="2.4.2" data-path="data_load.html"><a href="data_load.html#trfo-blm-pinyon-juniper-site-2"><i class="fa fa-check"></i><b>2.4.2</b> TRFO-BLM Pinyon-Juniper Site</a></li>
<li class="chapter" data-level="2.4.3" data-path="data_load.html"><a href="data_load.html#bhef-ponderosa-pine-site-2"><i class="fa fa-check"></i><b>2.4.3</b> BHEF Ponderosa Pine Site</a></li>
<li class="chapter" data-level="2.4.4" data-path="data_load.html"><a href="data_load.html#arnf-ponderosa-pine-site-2"><i class="fa fa-check"></i><b>2.4.4</b> ARNF Ponderosa Pine Site</a></li>
<li class="chapter" data-level="2.4.5" data-path="data_load.html"><a href="data_load.html#all"><i class="fa fa-check"></i><b>2.4.5</b> All</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="ptcld_process.html"><a href="ptcld_process.html"><i class="fa fa-check"></i><b>3</b> Point Cloud Processing</a>
<ul>
<li class="chapter" data-level="3.1" data-path="ptcld_process.html"><a href="ptcld_process.html#process-raw-point-cloud"><i class="fa fa-check"></i><b>3.1</b> Process Raw Point Cloud</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="ptcld_process.html"><a href="ptcld_process.html#ptcld_process_psinf"><i class="fa fa-check"></i><b>3.1.1</b> PSINF Mixed Conifer Site</a></li>
<li class="chapter" data-level="3.1.2" data-path="ptcld_process.html"><a href="ptcld_process.html#trfo-blm-pinyon-juniper-site-3"><i class="fa fa-check"></i><b>3.1.2</b> TRFO-BLM Pinyon-Juniper Site</a></li>
<li class="chapter" data-level="3.1.3" data-path="ptcld_process.html"><a href="ptcld_process.html#bhef-ponderosa-pine-site-3"><i class="fa fa-check"></i><b>3.1.3</b> BHEF Ponderosa Pine Site</a></li>
<li class="chapter" data-level="3.1.4" data-path="ptcld_process.html"><a href="ptcld_process.html#arnf-ponderosa-pine-site-3"><i class="fa fa-check"></i><b>3.1.4</b> ARNF Ponderosa Pine Site</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="ptcld_process.html"><a href="ptcld_process.html#clean-up"><i class="fa fa-check"></i><b>3.2</b> Clean Up</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="geom_detect.html"><a href="geom_detect.html"><i class="fa fa-check"></i><b>4</b> Geometry-based Slash Pile Detection</a>
<ul>
<li class="chapter" data-level="4.1" data-path="geom_detect.html"><a href="geom_detect.html#d_area"><i class="fa fa-check"></i><b>4.1</b> Demonstration Area</a></li>
<li class="chapter" data-level="4.2" data-path="geom_detect.html"><a href="geom_detect.html#segmentation-methods"><i class="fa fa-check"></i><b>4.2</b> Segmentation Methods</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="geom_detect.html"><a href="geom_detect.html#seg_methods"><i class="fa fa-check"></i><b>4.2.1</b> Overview of Methods</a></li>
<li class="chapter" data-level="4.2.2" data-path="geom_detect.html"><a href="geom_detect.html#watershed-segmentation-demonstration"><i class="fa fa-check"></i><b>4.2.2</b> Watershed Segmentation Demonstration</a></li>
<li class="chapter" data-level="4.2.3" data-path="geom_detect.html"><a href="geom_detect.html#dbscan-segmentation-demonstration"><i class="fa fa-check"></i><b>4.2.3</b> DBSCAN Segmentation Demonstration</a></li>
<li class="chapter" data-level="4.2.4" data-path="geom_detect.html"><a href="geom_detect.html#comparison-of-candidate-segments"><i class="fa fa-check"></i><b>4.2.4</b> Comparison of Candidate Segments</a></li>
<li class="chapter" data-level="4.2.5" data-path="geom_detect.html"><a href="geom_detect.html#segmentation-function"><i class="fa fa-check"></i><b>4.2.5</b> Segmentation Function</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="geom_detect.html"><a href="geom_detect.html#candidate-shape-refinement-and-area-filtering"><i class="fa fa-check"></i><b>4.3</b> Candidate Shape Refinement and Area filtering</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="geom_detect.html"><a href="geom_detect.html#watershed-segmentation"><i class="fa fa-check"></i><b>4.3.1</b> Watershed Segmentation</a></li>
<li class="chapter" data-level="4.3.2" data-path="geom_detect.html"><a href="geom_detect.html#dbscan-segmentation"><i class="fa fa-check"></i><b>4.3.2</b> DBSCAN Segmentation</a></li>
<li class="chapter" data-level="4.3.3" data-path="geom_detect.html"><a href="geom_detect.html#quick-methods-comparison"><i class="fa fa-check"></i><b>4.3.3</b> Quick methods comparison</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="geom_detect.html"><a href="geom_detect.html#candidate-geometric-filtering"><i class="fa fa-check"></i><b>4.4</b> Candidate Geometric filtering</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="geom_detect.html"><a href="geom_detect.html#shape-irregularity-convexity"><i class="fa fa-check"></i><b>4.4.1</b> Shape Irregularity: Convexity</a></li>
<li class="chapter" data-level="4.4.2" data-path="geom_detect.html"><a href="geom_detect.html#shape-irregularity-circularity"><i class="fa fa-check"></i><b>4.4.2</b> Shape Irregularity: Circularity</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="geom_detect.html"><a href="geom_detect.html#structural-metrics-from-chm"><i class="fa fa-check"></i><b>4.5</b> Structural Metrics from CHM</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="geom_detect.html"><a href="geom_detect.html#structural-rasters"><i class="fa fa-check"></i><b>4.5.1</b> Structural Rasters</a></li>
<li class="chapter" data-level="4.5.2" data-path="geom_detect.html"><a href="geom_detect.html#demonstration-candidate-segment-metrics"><i class="fa fa-check"></i><b>4.5.2</b> Demonstration Candidate Segment Metrics</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="geom_detect.html"><a href="geom_detect.html#final-shape-refinement"><i class="fa fa-check"></i><b>4.6</b> Final Shape Refinement</a>
<ul>
<li class="chapter" data-level="4.6.1" data-path="geom_detect.html"><a href="geom_detect.html#watershed-segmentation-3"><i class="fa fa-check"></i><b>4.6.1</b> Watershed Segmentation</a></li>
<li class="chapter" data-level="4.6.2" data-path="geom_detect.html"><a href="geom_detect.html#dbscan-segmentation-3"><i class="fa fa-check"></i><b>4.6.2</b> DBSCAN Segmentation</a></li>
<li class="chapter" data-level="4.6.3" data-path="geom_detect.html"><a href="geom_detect.html#quick-methods-comparison-2"><i class="fa fa-check"></i><b>4.6.3</b> Quick methods comparison</a></li>
</ul></li>
<li class="chapter" data-level="4.7" data-path="geom_detect.html"><a href="geom_detect.html#slash_pile_detect_fn"><i class="fa fa-check"></i><b>4.7</b> Pile Detection Function</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="data_fusion.html"><a href="data_fusion.html"><i class="fa fa-check"></i><b>5</b> Data Fusion</a>
<ul>
<li class="chapter" data-level="5.1" data-path="data_fusion.html"><a href="data_fusion.html#rgb-indices"><i class="fa fa-check"></i><b>5.1</b> RGB Indices</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="data_fusion.html"><a href="data_fusion.html#spectral-index-functions"><i class="fa fa-check"></i><b>5.1.1</b> Spectral Index Functions</a></li>
<li class="chapter" data-level="5.1.2" data-path="data_fusion.html"><a href="data_fusion.html#spectral-index-of-polygons"><i class="fa fa-check"></i><b>5.1.2</b> Spectral Index of Polygons</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="data_fusion.html"><a href="data_fusion.html#demonstration-pile-spectral-summary"><i class="fa fa-check"></i><b>5.2</b> Demonstration Pile Spectral Summary</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="data_fusion.html"><a href="data_fusion.html#voting-system"><i class="fa fa-check"></i><b>5.2.1</b> Voting System</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="data_fusion.html"><a href="data_fusion.html#polygon_spectral_filtering"><i class="fa fa-check"></i><b>5.3</b> Candidate Polygon Spectral Filtering Function</a></li>
<li class="chapter" data-level="5.4" data-path="data_fusion.html"><a href="data_fusion.html#data-fusion-method-demonstration"><i class="fa fa-check"></i><b>5.4</b> Data Fusion Method Demonstration</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="meth_eval.html"><a href="meth_eval.html"><i class="fa fa-check"></i><b>6</b> Method Evaluation</a>
<ul>
<li class="chapter" data-level="6.1" data-path="meth_eval.html"><a href="meth_eval.html#iou_match"><i class="fa fa-check"></i><b>6.1</b> Instance Matching</a></li>
<li class="chapter" data-level="6.2" data-path="meth_eval.html"><a href="meth_eval.html#detect_metrics_form"><i class="fa fa-check"></i><b>6.2</b> Detection Accuracy Metrics</a></li>
<li class="chapter" data-level="6.3" data-path="meth_eval.html"><a href="meth_eval.html#quant_metrics_form"><i class="fa fa-check"></i><b>6.3</b> Quantification Accuracy Metrics</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="meth_preds.html"><a href="meth_preds.html"><i class="fa fa-check"></i><b>7</b> Method Predictions</a>
<ul>
<li class="chapter" data-level="7.1" data-path="meth_preds.html"><a href="meth_preds.html#size-and-geometric-parameter-settings"><i class="fa fa-check"></i><b>7.1</b> Size and Geometric Parameter Settings</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="meth_preds.html"><a href="meth_preds.html#psinf-mixed-conifer-site-3"><i class="fa fa-check"></i><b>7.1.1</b> PSINF Mixed Conifer Site</a></li>
<li class="chapter" data-level="7.1.2" data-path="meth_preds.html"><a href="meth_preds.html#trfo-blm-pinyon-juniper-site-4"><i class="fa fa-check"></i><b>7.1.2</b> TRFO-BLM Pinyon-Juniper Site</a></li>
<li class="chapter" data-level="7.1.3" data-path="meth_preds.html"><a href="meth_preds.html#bhef-ponderosa-pine-site-4"><i class="fa fa-check"></i><b>7.1.3</b> BHEF Ponderosa Pine Site</a></li>
<li class="chapter" data-level="7.1.4" data-path="meth_preds.html"><a href="meth_preds.html#arnf-ponderosa-pine-site-4"><i class="fa fa-check"></i><b>7.1.4</b> ARNF Ponderosa Pine Site</a></li>
<li class="chapter" data-level="7.1.5" data-path="meth_preds.html"><a href="meth_preds.html#study-paremeter-settings"><i class="fa fa-check"></i><b>7.1.5</b> Study Paremeter Settings</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="meth_preds.html"><a href="meth_preds.html#chm-based-slash-pile-candidates"><i class="fa fa-check"></i><b>7.2</b> CHM-based Slash Pile Candidates</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="meth_preds.html"><a href="meth_preds.html#dbscan-candidates"><i class="fa fa-check"></i><b>7.2.1</b> DBSCAN Candidates</a></li>
<li class="chapter" data-level="7.2.2" data-path="meth_preds.html"><a href="meth_preds.html#watershed-candidates"><i class="fa fa-check"></i><b>7.2.2</b> Watershed Candidates</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="meth_preds.html"><a href="meth_preds.html#spectral-filter-slash-pile-candidates"><i class="fa fa-check"></i><b>7.3</b> Spectral Filter Slash Pile Candidates</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="meth_preds.html"><a href="meth_preds.html#dbscan-predictions"><i class="fa fa-check"></i><b>7.3.1</b> DBSCAN Predictions</a></li>
<li class="chapter" data-level="7.3.2" data-path="meth_preds.html"><a href="meth_preds.html#watershed-predictions"><i class="fa fa-check"></i><b>7.3.2</b> Watershed Predictions</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="preds_detect.html"><a href="preds_detect.html"><i class="fa fa-check"></i><b>8</b> Detection Accuracy</a>
<ul>
<li class="chapter" data-level="8.1" data-path="preds_detect.html"><a href="preds_detect.html#instance-matching"><i class="fa fa-check"></i><b>8.1</b> Instance Matching</a></li>
<li class="chapter" data-level="8.2" data-path="preds_detect.html"><a href="preds_detect.html#detection-accuracy-metrics"><i class="fa fa-check"></i><b>8.2</b> Detection Accuracy Metrics</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="preds_detect.html"><a href="preds_detect.html#agg_inst_match"><i class="fa fa-check"></i><b>8.2.1</b> Aggregate Instance Match Results</a></li>
<li class="chapter" data-level="8.2.2" data-path="preds_detect.html"><a href="preds_detect.html#detection-accuracy-results"><i class="fa fa-check"></i><b>8.2.2</b> Detection Accuracy Results</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="preds_detect.html"><a href="preds_detect.html#segmentation-method-accuracy-comparison"><i class="fa fa-check"></i><b>8.3</b> Segmentation Method Accuracy Comparison</a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="preds_detect.html"><a href="preds_detect.html#paired-t-test"><i class="fa fa-check"></i><b>8.3.1</b> Paired T-Test</a></li>
<li class="chapter" data-level="8.3.2" data-path="preds_detect.html"><a href="preds_detect.html#bayesian-approach"><i class="fa fa-check"></i><b>8.3.2</b> Bayesian Approach</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="preds_detect.html"><a href="preds_detect.html#individual-pile-evaluation"><i class="fa fa-check"></i><b>8.4</b> Individual Pile Evaluation</a>
<ul>
<li class="chapter" data-level="8.4.1" data-path="preds_detect.html"><a href="preds_detect.html#true-positives"><i class="fa fa-check"></i><b>8.4.1</b> True Positives</a></li>
<li class="chapter" data-level="8.4.2" data-path="preds_detect.html"><a href="preds_detect.html#omissions-false-negatives"><i class="fa fa-check"></i><b>8.4.2</b> Omissions (False Negatives)</a></li>
<li class="chapter" data-level="8.4.3" data-path="preds_detect.html"><a href="preds_detect.html#commissions-false-positives"><i class="fa fa-check"></i><b>8.4.3</b> commissions (False Positives)</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="preds_quantit.html"><a href="preds_quantit.html"><i class="fa fa-check"></i><b>9</b> Detection Accuracy</a>
<ul>
<li class="chapter" data-level="9.1" data-path="preds_quantit.html"><a href="preds_quantit.html#height-and-diameter-accuracy"><i class="fa fa-check"></i><b>9.1</b> Height and Diameter Accuracy</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="preds_quantit.html"><a href="preds_quantit.html#stand-level-aggregation"><i class="fa fa-check"></i><b>9.1.1</b> Stand-level Aggregation</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="preds_quantit.html"><a href="preds_quantit.html#area-accuracy"><i class="fa fa-check"></i><b>9.2</b> Area Accuracy</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="preds_quantit.html"><a href="preds_quantit.html#stand-level-aggregation-1"><i class="fa fa-check"></i><b>9.2.1</b> Stand-level Aggregation</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="preds_quantit.html"><a href="preds_quantit.html#vol_comp"><i class="fa fa-check"></i><b>9.3</b> Volume Comparison</a>
<ul>
<li class="chapter" data-level="9.3.1" data-path="preds_quantit.html"><a href="preds_quantit.html#extreme-volume-disagreements"><i class="fa fa-check"></i><b>9.3.1</b> Extreme Volume Disagreements</a></li>
<li class="chapter" data-level="9.3.2" data-path="preds_quantit.html"><a href="preds_quantit.html#allometric-volume-comparison"><i class="fa fa-check"></i><b>9.3.2</b> Allometric Volume Comparison</a></li>
<li class="chapter" data-level="9.3.3" data-path="preds_quantit.html"><a href="preds_quantit.html#stand-level-aggregation-2"><i class="fa fa-check"></i><b>9.3.3</b> Stand-level Aggregation</a></li>
</ul></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Aerial Imagery and Point Cloud Data for Slash Pile Quantification</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="ptcld_process" class="section level1 hasAnchor" number="3">
<h1><span class="header-section-number">Section 3</span> Point Cloud Processing<a href="ptcld_process.html#ptcld_process" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>We’ll use the <code>cloud2trees</code> <a href="https://github.com/georgewoolsey/cloud2trees">package</a> to perform all preprocessing of point cloud data which includes:</p>
<ul>
<li>ground classification and noise removal</li>
<li>raster data (DTM and CHM) generation</li>
<li>point cloud height normalization</li>
</ul>
<p>All of this can be accomplished using the <code>cloud2trees::cloud2raster()</code> function. After generating these products from the raw point cloud we’ll perform object segmentation to attempt to detect slash piles from the CHM which we’ll generate by setting the minimum height to zero (essentially a digital surface model [DSM] with the ground removed).</p>
<p>To attempt to identify slash piles from the CHM/DSM, we can use watershed segmentation or DBSCAN (Density-Based Spatial Clustering of Applications with Noise), for example. Both of these methods are common in segmenting individual trees and coarse woody debris from CHM data.</p>
<div id="process-raw-point-cloud" class="section level2 hasAnchor" number="3.1">
<h2><span class="header-section-number">3.1</span> Process Raw Point Cloud<a href="ptcld_process.html#process-raw-point-cloud" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We’ll use <code>cloud2trees::cloud2raster()</code> to process the raw point cloud data. For each site we’ll generate a fine-resolution (0.1 m) CHM data set which can be aggregated to coarser resolution for sensitivity testing. Fine resolution CHM data would include granular details which may be important for delineating smaller slash piles while more coarse resolution data may help smooth out noise in the data to reduce false positive pile detections and potentially better represent the form of the actual piles</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="ptcld_process.html#cb56-1" tabindex="-1"></a><span class="co"># set chm res</span></span>
<span id="cb56-2"><a href="ptcld_process.html#cb56-2" tabindex="-1"></a>my_chm_res_m <span class="ot">&lt;-</span> <span class="fl">0.1</span></span></code></pre></div>
<div id="ptcld_process_psinf" class="section level3 hasAnchor" number="3.1.1">
<h3><span class="header-section-number">3.1.1</span> PSINF Mixed Conifer Site<a href="ptcld_process.html#ptcld_process_psinf" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>look at the summary of the point cloud data we’ll be processing</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="ptcld_process.html#cb57-1" tabindex="-1"></a><span class="co"># processing dirs</span></span>
<span id="cb57-2"><a href="ptcld_process.html#cb57-2" tabindex="-1"></a>c2t_out_dir_temp <span class="ot">&lt;-</span> <span class="st">&quot;../data/PFDP_Data/&quot;</span></span>
<span id="cb57-3"><a href="ptcld_process.html#cb57-3" tabindex="-1"></a>out_dir_temp <span class="ot">&lt;-</span> <span class="fu">file.path</span>(c2t_out_dir_temp, <span class="fu">paste0</span>(<span class="st">&quot;point_cloud_processing_delivery_chm&quot;</span>,my_chm_res_m,<span class="st">&quot;m&quot;</span>) )</span>
<span id="cb57-4"><a href="ptcld_process.html#cb57-4" tabindex="-1"></a>las_dir_temp <span class="ot">&lt;-</span> <span class="st">&quot;f:</span><span class="sc">\\</span><span class="st">PFDP_Data</span><span class="sc">\\</span><span class="st">p4pro_images</span><span class="sc">\\</span><span class="st">P4Pro_06_17_2021_half_half_optimal</span><span class="sc">\\</span><span class="st">2_densification</span><span class="sc">\\</span><span class="st">point_cloud&quot;</span></span>
<span id="cb57-5"><a href="ptcld_process.html#cb57-5" tabindex="-1"></a><span class="co"># read header with catalog</span></span>
<span id="cb57-6"><a href="ptcld_process.html#cb57-6" tabindex="-1"></a>lidR<span class="sc">::</span><span class="fu">readLAScatalog</span>(las_dir_temp)</span></code></pre></div>
<pre><code>## class       : LAScatalog (v1.2 format 3)
## extent      : 499264.2, 499958.8, 4317541, 4318147 (xmin, xmax, ymin, ymax)
## coord. ref. : WGS 84 / UTM zone 13N 
## area        : 420912.1 m²
## points      : 158.01 million points
## type        : terrestrial
## density     : 375.4 points/m²
## num. files  : 1</code></pre>
<p>process the point cloud with the <code>cloud2trees::cloud2raster()</code> workflow</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="ptcld_process.html#cb59-1" tabindex="-1"></a><span class="co"># do it</span></span>
<span id="cb59-2"><a href="ptcld_process.html#cb59-2" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">dir.exists</span>(out_dir_temp)){</span>
<span id="cb59-3"><a href="ptcld_process.html#cb59-3" tabindex="-1"></a>  <span class="co"># cloud2trees</span></span>
<span id="cb59-4"><a href="ptcld_process.html#cb59-4" tabindex="-1"></a>  psinf_cloud2raster_ans <span class="ot">&lt;-</span> cloud2trees<span class="sc">::</span><span class="fu">cloud2raster</span>(</span>
<span id="cb59-5"><a href="ptcld_process.html#cb59-5" tabindex="-1"></a>    <span class="at">output_dir =</span> c2t_out_dir_temp</span>
<span id="cb59-6"><a href="ptcld_process.html#cb59-6" tabindex="-1"></a>    , <span class="at">input_las_dir =</span> las_dir_temp</span>
<span id="cb59-7"><a href="ptcld_process.html#cb59-7" tabindex="-1"></a>    , <span class="at">accuracy_level =</span> <span class="dv">2</span></span>
<span id="cb59-8"><a href="ptcld_process.html#cb59-8" tabindex="-1"></a>    , <span class="at">keep_intrmdt =</span> T</span>
<span id="cb59-9"><a href="ptcld_process.html#cb59-9" tabindex="-1"></a>    , <span class="at">dtm_res_m =</span> <span class="fl">0.25</span></span>
<span id="cb59-10"><a href="ptcld_process.html#cb59-10" tabindex="-1"></a>    , <span class="at">chm_res_m =</span> my_chm_res_m</span>
<span id="cb59-11"><a href="ptcld_process.html#cb59-11" tabindex="-1"></a>    , <span class="at">min_height =</span> <span class="dv">0</span> <span class="co"># effectively generates a DSM based on non-ground points</span></span>
<span id="cb59-12"><a href="ptcld_process.html#cb59-12" tabindex="-1"></a>  )</span>
<span id="cb59-13"><a href="ptcld_process.html#cb59-13" tabindex="-1"></a>  <span class="co"># rename</span></span>
<span id="cb59-14"><a href="ptcld_process.html#cb59-14" tabindex="-1"></a>  <span class="fu">file.rename</span>(<span class="at">from =</span> <span class="fu">file.path</span>(c2t_out_dir_temp,<span class="st">&quot;point_cloud_processing_delivery&quot;</span>), <span class="at">to =</span> out_dir_temp)</span>
<span id="cb59-15"><a href="ptcld_process.html#cb59-15" tabindex="-1"></a>}<span class="cf">else</span>{</span>
<span id="cb59-16"><a href="ptcld_process.html#cb59-16" tabindex="-1"></a>  dtm_temp <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rast</span>( <span class="fu">file.path</span>(out_dir_temp, <span class="st">&quot;dtm_0.25m.tif&quot;</span>) )</span>
<span id="cb59-17"><a href="ptcld_process.html#cb59-17" tabindex="-1"></a>  chm_temp <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rast</span>( <span class="fu">file.path</span>(out_dir_temp, <span class="fu">paste0</span>(<span class="st">&quot;chm_&quot;</span>, my_chm_res_m,<span class="st">&quot;m.tif&quot;</span>)) )</span>
<span id="cb59-18"><a href="ptcld_process.html#cb59-18" tabindex="-1"></a>  <span class="co"># combine</span></span>
<span id="cb59-19"><a href="ptcld_process.html#cb59-19" tabindex="-1"></a>  psinf_cloud2raster_ans <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb59-20"><a href="ptcld_process.html#cb59-20" tabindex="-1"></a>    <span class="st">&quot;dtm_rast&quot;</span> <span class="ot">=</span> dtm_temp</span>
<span id="cb59-21"><a href="ptcld_process.html#cb59-21" tabindex="-1"></a>    , <span class="st">&quot;chm_rast&quot;</span> <span class="ot">=</span> chm_temp</span>
<span id="cb59-22"><a href="ptcld_process.html#cb59-22" tabindex="-1"></a>  )</span>
<span id="cb59-23"><a href="ptcld_process.html#cb59-23" tabindex="-1"></a>}</span></code></pre></div>
<p>let’s check out the DTM</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="ptcld_process.html#cb60-1" tabindex="-1"></a>psinf_cloud2raster_ans<span class="sc">$</span>dtm_rast <span class="sc">%&gt;%</span> </span>
<span id="cb60-2"><a href="ptcld_process.html#cb60-2" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">crop</span>(</span>
<span id="cb60-3"><a href="ptcld_process.html#cb60-3" tabindex="-1"></a>    psinf_stand_boundary <span class="sc">%&gt;%</span> </span>
<span id="cb60-4"><a href="ptcld_process.html#cb60-4" tabindex="-1"></a>    sf<span class="sc">::</span><span class="fu">st_buffer</span>(<span class="dv">22</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb60-5"><a href="ptcld_process.html#cb60-5" tabindex="-1"></a>    sf<span class="sc">::</span><span class="fu">st_transform</span>(terra<span class="sc">::</span><span class="fu">crs</span>(psinf_cloud2raster_ans<span class="sc">$</span>dtm_rast)) <span class="sc">%&gt;%</span> </span>
<span id="cb60-6"><a href="ptcld_process.html#cb60-6" tabindex="-1"></a>    terra<span class="sc">::</span><span class="fu">vect</span>()</span>
<span id="cb60-7"><a href="ptcld_process.html#cb60-7" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb60-8"><a href="ptcld_process.html#cb60-8" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">aggregate</span>(<span class="at">fact =</span> <span class="dv">2</span>, <span class="at">na.rm =</span> T, <span class="at">cores =</span> lasR<span class="sc">::</span><span class="fu">half_cores</span>()) <span class="sc">%&gt;%</span>  </span>
<span id="cb60-9"><a href="ptcld_process.html#cb60-9" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">plot</span>(</span>
<span id="cb60-10"><a href="ptcld_process.html#cb60-10" tabindex="-1"></a>    <span class="at">col =</span> viridis<span class="sc">::</span><span class="fu">viridis</span>(<span class="at">n =</span> <span class="dv">100</span>)</span>
<span id="cb60-11"><a href="ptcld_process.html#cb60-11" tabindex="-1"></a>    , <span class="at">axes =</span> F</span>
<span id="cb60-12"><a href="ptcld_process.html#cb60-12" tabindex="-1"></a>    , <span class="at">main =</span> <span class="st">&quot;DTM (m)&quot;</span></span>
<span id="cb60-13"><a href="ptcld_process.html#cb60-13" tabindex="-1"></a>  )</span>
<span id="cb60-14"><a href="ptcld_process.html#cb60-14" tabindex="-1"></a><span class="co"># add stand boundary</span></span>
<span id="cb60-15"><a href="ptcld_process.html#cb60-15" tabindex="-1"></a>terra<span class="sc">::</span><span class="fu">plot</span>(</span>
<span id="cb60-16"><a href="ptcld_process.html#cb60-16" tabindex="-1"></a>  psinf_stand_boundary <span class="sc">%&gt;%</span> </span>
<span id="cb60-17"><a href="ptcld_process.html#cb60-17" tabindex="-1"></a>    sf<span class="sc">::</span><span class="fu">st_transform</span>(terra<span class="sc">::</span><span class="fu">crs</span>(psinf_cloud2raster_ans<span class="sc">$</span>dtm_rast)) <span class="sc">%&gt;%</span> </span>
<span id="cb60-18"><a href="ptcld_process.html#cb60-18" tabindex="-1"></a>    terra<span class="sc">::</span><span class="fu">vect</span>()</span>
<span id="cb60-19"><a href="ptcld_process.html#cb60-19" tabindex="-1"></a>  , <span class="at">add =</span> T, <span class="at">border =</span> <span class="st">&quot;black&quot;</span>, <span class="at">col =</span> <span class="cn">NA</span>, <span class="at">lwd =</span> <span class="fl">1.2</span></span>
<span id="cb60-20"><a href="ptcld_process.html#cb60-20" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="slash_pile_detecting_files/figure-html/unnamed-chunk-65-1.png" alt="" width="1008" /></p>
<p>and CHM</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="ptcld_process.html#cb61-1" tabindex="-1"></a>psinf_cloud2raster_ans<span class="sc">$</span>chm_rast <span class="sc">%&gt;%</span> </span>
<span id="cb61-2"><a href="ptcld_process.html#cb61-2" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">crop</span>(</span>
<span id="cb61-3"><a href="ptcld_process.html#cb61-3" tabindex="-1"></a>    psinf_stand_boundary <span class="sc">%&gt;%</span> </span>
<span id="cb61-4"><a href="ptcld_process.html#cb61-4" tabindex="-1"></a>    sf<span class="sc">::</span><span class="fu">st_buffer</span>(<span class="dv">22</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb61-5"><a href="ptcld_process.html#cb61-5" tabindex="-1"></a>    sf<span class="sc">::</span><span class="fu">st_transform</span>(terra<span class="sc">::</span><span class="fu">crs</span>(psinf_cloud2raster_ans<span class="sc">$</span>chm_rast)) <span class="sc">%&gt;%</span> </span>
<span id="cb61-6"><a href="ptcld_process.html#cb61-6" tabindex="-1"></a>    terra<span class="sc">::</span><span class="fu">vect</span>()</span>
<span id="cb61-7"><a href="ptcld_process.html#cb61-7" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb61-8"><a href="ptcld_process.html#cb61-8" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">aggregate</span>(<span class="at">fact =</span> <span class="dv">2</span>, <span class="at">na.rm =</span> T, <span class="at">cores =</span> lasR<span class="sc">::</span><span class="fu">half_cores</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb61-9"><a href="ptcld_process.html#cb61-9" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">plot</span>(</span>
<span id="cb61-10"><a href="ptcld_process.html#cb61-10" tabindex="-1"></a>    <span class="at">col =</span> viridis<span class="sc">::</span><span class="fu">plasma</span>(<span class="dv">100</span>)</span>
<span id="cb61-11"><a href="ptcld_process.html#cb61-11" tabindex="-1"></a>    , <span class="at">axes =</span> F</span>
<span id="cb61-12"><a href="ptcld_process.html#cb61-12" tabindex="-1"></a>    , <span class="at">main =</span> <span class="st">&quot;CHM (m)&quot;</span></span>
<span id="cb61-13"><a href="ptcld_process.html#cb61-13" tabindex="-1"></a>  )</span>
<span id="cb61-14"><a href="ptcld_process.html#cb61-14" tabindex="-1"></a><span class="co"># add stand boundary</span></span>
<span id="cb61-15"><a href="ptcld_process.html#cb61-15" tabindex="-1"></a>terra<span class="sc">::</span><span class="fu">plot</span>(</span>
<span id="cb61-16"><a href="ptcld_process.html#cb61-16" tabindex="-1"></a>  psinf_stand_boundary <span class="sc">%&gt;%</span> </span>
<span id="cb61-17"><a href="ptcld_process.html#cb61-17" tabindex="-1"></a>    sf<span class="sc">::</span><span class="fu">st_transform</span>(terra<span class="sc">::</span><span class="fu">crs</span>(psinf_cloud2raster_ans<span class="sc">$</span>chm_rast)) <span class="sc">%&gt;%</span> </span>
<span id="cb61-18"><a href="ptcld_process.html#cb61-18" tabindex="-1"></a>    terra<span class="sc">::</span><span class="fu">vect</span>()</span>
<span id="cb61-19"><a href="ptcld_process.html#cb61-19" tabindex="-1"></a>  , <span class="at">add =</span> T, <span class="at">border =</span> <span class="st">&quot;black&quot;</span>, <span class="at">col =</span> <span class="cn">NA</span>, <span class="at">lwd =</span> <span class="fl">1.2</span></span>
<span id="cb61-20"><a href="ptcld_process.html#cb61-20" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="slash_pile_detecting_files/figure-html/unnamed-chunk-66-1.png" alt="" width="1008" /></p>
<div id="dtm-and-chm-piles" class="section level4 hasAnchor" number="3.1.1.1">
<h4><span class="header-section-number">3.1.1.1</span> DTM and CHM + piles<a href="ptcld_process.html#dtm-and-chm-piles" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>let’s visually inspect the DTM and CHM with the pile outlines overlaid. we’ll make some functions to use for the different study areas</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="ptcld_process.html#cb62-1" tabindex="-1"></a>plt_rast_fn <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb62-2"><a href="ptcld_process.html#cb62-2" tabindex="-1"></a>    rn</span>
<span id="cb62-3"><a href="ptcld_process.html#cb62-3" tabindex="-1"></a>    , df</span>
<span id="cb62-4"><a href="ptcld_process.html#cb62-4" tabindex="-1"></a>    , rast</span>
<span id="cb62-5"><a href="ptcld_process.html#cb62-5" tabindex="-1"></a>    , <span class="at">my_title =</span> <span class="st">&quot;&quot;</span></span>
<span id="cb62-6"><a href="ptcld_process.html#cb62-6" tabindex="-1"></a>    , <span class="at">vopt =</span> <span class="st">&quot;viridis&quot;</span></span>
<span id="cb62-7"><a href="ptcld_process.html#cb62-7" tabindex="-1"></a>    , <span class="at">lim =</span> <span class="cn">NULL</span></span>
<span id="cb62-8"><a href="ptcld_process.html#cb62-8" tabindex="-1"></a>    , <span class="at">buff =</span> <span class="dv">10</span></span>
<span id="cb62-9"><a href="ptcld_process.html#cb62-9" tabindex="-1"></a>) {</span>
<span id="cb62-10"><a href="ptcld_process.html#cb62-10" tabindex="-1"></a>  <span class="co"># scale the buffer based on the largest</span></span>
<span id="cb62-11"><a href="ptcld_process.html#cb62-11" tabindex="-1"></a>    d_temp <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb62-12"><a href="ptcld_process.html#cb62-12" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">arrange</span>(<span class="fu">desc</span>(image_gt_diameter_m)) <span class="sc">%&gt;%</span> </span>
<span id="cb62-13"><a href="ptcld_process.html#cb62-13" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">slice</span>(rn) <span class="sc">%&gt;%</span> </span>
<span id="cb62-14"><a href="ptcld_process.html#cb62-14" tabindex="-1"></a>      sf<span class="sc">::</span><span class="fu">st_transform</span>(terra<span class="sc">::</span><span class="fu">crs</span>(rast))</span>
<span id="cb62-15"><a href="ptcld_process.html#cb62-15" tabindex="-1"></a>    </span>
<span id="cb62-16"><a href="ptcld_process.html#cb62-16" tabindex="-1"></a>    <span class="co"># convert rast to df</span></span>
<span id="cb62-17"><a href="ptcld_process.html#cb62-17" tabindex="-1"></a>    comp_st <span class="ot">&lt;-</span> rast <span class="sc">%&gt;%</span>  </span>
<span id="cb62-18"><a href="ptcld_process.html#cb62-18" tabindex="-1"></a>      terra<span class="sc">::</span><span class="fu">crop</span>(</span>
<span id="cb62-19"><a href="ptcld_process.html#cb62-19" tabindex="-1"></a>        d_temp <span class="sc">%&gt;%</span> sf<span class="sc">::</span><span class="fu">st_buffer</span>(buff) <span class="sc">%&gt;%</span> terra<span class="sc">::</span><span class="fu">vect</span>()</span>
<span id="cb62-20"><a href="ptcld_process.html#cb62-20" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span> </span>
<span id="cb62-21"><a href="ptcld_process.html#cb62-21" tabindex="-1"></a>      terra<span class="sc">::</span><span class="fu">as.data.frame</span>(<span class="at">xy =</span> T) <span class="sc">%&gt;%</span> </span>
<span id="cb62-22"><a href="ptcld_process.html#cb62-22" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">f=</span><span class="dv">3</span>)</span>
<span id="cb62-23"><a href="ptcld_process.html#cb62-23" tabindex="-1"></a>    </span>
<span id="cb62-24"><a href="ptcld_process.html#cb62-24" tabindex="-1"></a>    <span class="co"># ggplot</span></span>
<span id="cb62-25"><a href="ptcld_process.html#cb62-25" tabindex="-1"></a>    comp_temp <span class="ot">&lt;-</span> ggplot2<span class="sc">::</span><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb62-26"><a href="ptcld_process.html#cb62-26" tabindex="-1"></a>      ggplot2<span class="sc">::</span><span class="fu">geom_tile</span>(<span class="at">data =</span> comp_st, ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x=</span>x,<span class="at">y=</span>y,<span class="at">fill=</span>f)) <span class="sc">+</span></span>
<span id="cb62-27"><a href="ptcld_process.html#cb62-27" tabindex="-1"></a>      ggplot2<span class="sc">::</span><span class="fu">geom_sf</span>(<span class="at">data =</span> d_temp, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">color =</span> <span class="st">&quot;cyan&quot;</span>, <span class="at">lwd =</span> <span class="fl">0.4</span>) <span class="sc">+</span></span>
<span id="cb62-28"><a href="ptcld_process.html#cb62-28" tabindex="-1"></a>      ggplot2<span class="sc">::</span><span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb62-29"><a href="ptcld_process.html#cb62-29" tabindex="-1"></a>      ggplot2<span class="sc">::</span><span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb62-30"><a href="ptcld_process.html#cb62-30" tabindex="-1"></a>      ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb62-31"><a href="ptcld_process.html#cb62-31" tabindex="-1"></a>        <span class="at">x =</span> <span class="st">&quot;&quot;</span></span>
<span id="cb62-32"><a href="ptcld_process.html#cb62-32" tabindex="-1"></a>        , <span class="at">y =</span> <span class="st">&quot;&quot;</span></span>
<span id="cb62-33"><a href="ptcld_process.html#cb62-33" tabindex="-1"></a>        , <span class="at">subtitle =</span> my_title</span>
<span id="cb62-34"><a href="ptcld_process.html#cb62-34" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb62-35"><a href="ptcld_process.html#cb62-35" tabindex="-1"></a>      ggplot2<span class="sc">::</span><span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb62-36"><a href="ptcld_process.html#cb62-36" tabindex="-1"></a>      ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb62-37"><a href="ptcld_process.html#cb62-37" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span> <span class="co"># c(0.5,1)</span></span>
<span id="cb62-38"><a href="ptcld_process.html#cb62-38" tabindex="-1"></a>        , <span class="at">legend.margin =</span> <span class="fu">margin</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>)</span>
<span id="cb62-39"><a href="ptcld_process.html#cb62-39" tabindex="-1"></a>        , <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>)</span>
<span id="cb62-40"><a href="ptcld_process.html#cb62-40" tabindex="-1"></a>        , <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>)</span>
<span id="cb62-41"><a href="ptcld_process.html#cb62-41" tabindex="-1"></a>        , <span class="at">legend.key =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;white&quot;</span>)</span>
<span id="cb62-42"><a href="ptcld_process.html#cb62-42" tabindex="-1"></a>        <span class="co"># , plot.title = ggtext::element_markdown(size = 10, hjust = 0.5)</span></span>
<span id="cb62-43"><a href="ptcld_process.html#cb62-43" tabindex="-1"></a>        , <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb62-44"><a href="ptcld_process.html#cb62-44" tabindex="-1"></a>        , <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">6</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">&quot;italic&quot;</span>)</span>
<span id="cb62-45"><a href="ptcld_process.html#cb62-45" tabindex="-1"></a>      )</span>
<span id="cb62-46"><a href="ptcld_process.html#cb62-46" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.null</span>(lim)){</span>
<span id="cb62-47"><a href="ptcld_process.html#cb62-47" tabindex="-1"></a>    comp_temp <span class="ot">&lt;-</span> comp_temp <span class="sc">+</span> </span>
<span id="cb62-48"><a href="ptcld_process.html#cb62-48" tabindex="-1"></a>      ggplot2<span class="sc">::</span><span class="fu">scale_fill_viridis_c</span>(<span class="at">option =</span> vopt, <span class="at">limits =</span> lim)</span>
<span id="cb62-49"><a href="ptcld_process.html#cb62-49" tabindex="-1"></a>  }<span class="cf">else</span>{</span>
<span id="cb62-50"><a href="ptcld_process.html#cb62-50" tabindex="-1"></a>    comp_temp <span class="ot">&lt;-</span> comp_temp <span class="sc">+</span> </span>
<span id="cb62-51"><a href="ptcld_process.html#cb62-51" tabindex="-1"></a>      ggplot2<span class="sc">::</span><span class="fu">scale_fill_viridis_c</span>(<span class="at">option =</span> vopt)</span>
<span id="cb62-52"><a href="ptcld_process.html#cb62-52" tabindex="-1"></a>  }</span>
<span id="cb62-53"><a href="ptcld_process.html#cb62-53" tabindex="-1"></a>    </span>
<span id="cb62-54"><a href="ptcld_process.html#cb62-54" tabindex="-1"></a>  plt_temp <span class="ot">&lt;-</span> comp_temp</span>
<span id="cb62-55"><a href="ptcld_process.html#cb62-55" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="st">&quot;plt&quot;</span><span class="ot">=</span>plt_temp,<span class="st">&quot;d&quot;</span><span class="ot">=</span>d_temp))</span>
<span id="cb62-56"><a href="ptcld_process.html#cb62-56" tabindex="-1"></a>}</span>
<span id="cb62-57"><a href="ptcld_process.html#cb62-57" tabindex="-1"></a></span>
<span id="cb62-58"><a href="ptcld_process.html#cb62-58" tabindex="-1"></a><span class="co"># plt_rast_fn(rn = 9, df = psinf_slash_piles_polys, rast = psinf_cloud2raster_ans$dtm_rast, vopt = &quot;viridis&quot;)</span></span>
<span id="cb62-59"><a href="ptcld_process.html#cb62-59" tabindex="-1"></a></span>
<span id="cb62-60"><a href="ptcld_process.html#cb62-60" tabindex="-1"></a><span class="co"># combine 3</span></span>
<span id="cb62-61"><a href="ptcld_process.html#cb62-61" tabindex="-1"></a>plt_rast_combine <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb62-62"><a href="ptcld_process.html#cb62-62" tabindex="-1"></a>    rn</span>
<span id="cb62-63"><a href="ptcld_process.html#cb62-63" tabindex="-1"></a>    , df</span>
<span id="cb62-64"><a href="ptcld_process.html#cb62-64" tabindex="-1"></a>    , dtm_rast</span>
<span id="cb62-65"><a href="ptcld_process.html#cb62-65" tabindex="-1"></a>    , <span class="at">dtm_rast_vopt =</span> <span class="st">&quot;viridis&quot;</span></span>
<span id="cb62-66"><a href="ptcld_process.html#cb62-66" tabindex="-1"></a>    , chm_rast</span>
<span id="cb62-67"><a href="ptcld_process.html#cb62-67" tabindex="-1"></a>    , <span class="at">chm_rast_vopt =</span> <span class="st">&quot;plasma&quot;</span></span>
<span id="cb62-68"><a href="ptcld_process.html#cb62-68" tabindex="-1"></a>    , rgb_rast</span>
<span id="cb62-69"><a href="ptcld_process.html#cb62-69" tabindex="-1"></a>    , <span class="at">buffer =</span> <span class="dv">10</span></span>
<span id="cb62-70"><a href="ptcld_process.html#cb62-70" tabindex="-1"></a>) {</span>
<span id="cb62-71"><a href="ptcld_process.html#cb62-71" tabindex="-1"></a>  <span class="co"># composite 1</span></span>
<span id="cb62-72"><a href="ptcld_process.html#cb62-72" tabindex="-1"></a>  ans1 <span class="ot">&lt;-</span> <span class="fu">plt_rast_fn</span>(</span>
<span id="cb62-73"><a href="ptcld_process.html#cb62-73" tabindex="-1"></a>    <span class="at">rn =</span> rn</span>
<span id="cb62-74"><a href="ptcld_process.html#cb62-74" tabindex="-1"></a>    , <span class="at">df =</span> df</span>
<span id="cb62-75"><a href="ptcld_process.html#cb62-75" tabindex="-1"></a>    , <span class="at">rast =</span> dtm_rast</span>
<span id="cb62-76"><a href="ptcld_process.html#cb62-76" tabindex="-1"></a>    , <span class="at">my_title =</span> <span class="st">&quot;DTM&quot;</span></span>
<span id="cb62-77"><a href="ptcld_process.html#cb62-77" tabindex="-1"></a>    , <span class="at">vopt =</span> dtm_rast_vopt</span>
<span id="cb62-78"><a href="ptcld_process.html#cb62-78" tabindex="-1"></a>    , <span class="at">buff =</span> buffer</span>
<span id="cb62-79"><a href="ptcld_process.html#cb62-79" tabindex="-1"></a>  )</span>
<span id="cb62-80"><a href="ptcld_process.html#cb62-80" tabindex="-1"></a>  <span class="co"># composite 2</span></span>
<span id="cb62-81"><a href="ptcld_process.html#cb62-81" tabindex="-1"></a>  ans2 <span class="ot">&lt;-</span> <span class="fu">plt_rast_fn</span>(</span>
<span id="cb62-82"><a href="ptcld_process.html#cb62-82" tabindex="-1"></a>    <span class="at">rn =</span> rn</span>
<span id="cb62-83"><a href="ptcld_process.html#cb62-83" tabindex="-1"></a>    , <span class="at">df =</span> df</span>
<span id="cb62-84"><a href="ptcld_process.html#cb62-84" tabindex="-1"></a>    , <span class="at">rast =</span> chm_rast</span>
<span id="cb62-85"><a href="ptcld_process.html#cb62-85" tabindex="-1"></a>    , <span class="at">my_title =</span> <span class="st">&quot;CHM&quot;</span></span>
<span id="cb62-86"><a href="ptcld_process.html#cb62-86" tabindex="-1"></a>    , <span class="at">vopt =</span> chm_rast_vopt</span>
<span id="cb62-87"><a href="ptcld_process.html#cb62-87" tabindex="-1"></a>    , <span class="at">buff =</span> buffer</span>
<span id="cb62-88"><a href="ptcld_process.html#cb62-88" tabindex="-1"></a>  )</span>
<span id="cb62-89"><a href="ptcld_process.html#cb62-89" tabindex="-1"></a>  <span class="co"># plt rgb</span></span>
<span id="cb62-90"><a href="ptcld_process.html#cb62-90" tabindex="-1"></a>    rgb_temp <span class="ot">&lt;-</span></span>
<span id="cb62-91"><a href="ptcld_process.html#cb62-91" tabindex="-1"></a>      <span class="fu">ortho_plt_fn</span>(</span>
<span id="cb62-92"><a href="ptcld_process.html#cb62-92" tabindex="-1"></a>        <span class="at">rgb_rast =</span> rgb_rast</span>
<span id="cb62-93"><a href="ptcld_process.html#cb62-93" tabindex="-1"></a>        , <span class="at">stand =</span>ans1<span class="sc">$</span>d</span>
<span id="cb62-94"><a href="ptcld_process.html#cb62-94" tabindex="-1"></a>        , <span class="at">buffer =</span> buffer</span>
<span id="cb62-95"><a href="ptcld_process.html#cb62-95" tabindex="-1"></a>        , <span class="at">add_stand =</span> F</span>
<span id="cb62-96"><a href="ptcld_process.html#cb62-96" tabindex="-1"></a>      ) <span class="sc">+</span> </span>
<span id="cb62-97"><a href="ptcld_process.html#cb62-97" tabindex="-1"></a>      ggplot2<span class="sc">::</span><span class="fu">geom_sf</span>(<span class="at">data =</span> ans1<span class="sc">$</span>d, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">color =</span> <span class="st">&quot;cyan&quot;</span>, <span class="at">lwd =</span> <span class="fl">0.3</span>)</span>
<span id="cb62-98"><a href="ptcld_process.html#cb62-98" tabindex="-1"></a>  <span class="co"># combine</span></span>
<span id="cb62-99"><a href="ptcld_process.html#cb62-99" tabindex="-1"></a>    r <span class="ot">&lt;-</span> patchwork<span class="sc">::</span><span class="fu">wrap_plots</span>(<span class="fu">list</span>(rgb_temp,ans1<span class="sc">$</span>plt,ans2<span class="sc">$</span>plt), <span class="at">nrow =</span> <span class="dv">1</span>)</span>
<span id="cb62-100"><a href="ptcld_process.html#cb62-100" tabindex="-1"></a>    <span class="fu">return</span>(r)</span>
<span id="cb62-101"><a href="ptcld_process.html#cb62-101" tabindex="-1"></a>}</span>
<span id="cb62-102"><a href="ptcld_process.html#cb62-102" tabindex="-1"></a></span>
<span id="cb62-103"><a href="ptcld_process.html#cb62-103" tabindex="-1"></a><span class="co"># plt_rast_combine(</span></span>
<span id="cb62-104"><a href="ptcld_process.html#cb62-104" tabindex="-1"></a><span class="co">#   rn = 11</span></span>
<span id="cb62-105"><a href="ptcld_process.html#cb62-105" tabindex="-1"></a><span class="co">#   , df = psinf_slash_piles_polys %&gt;% dplyr::filter(is_in_stand)</span></span>
<span id="cb62-106"><a href="ptcld_process.html#cb62-106" tabindex="-1"></a><span class="co">#   , dtm_rast = psinf_cloud2raster_ans$dtm_rast</span></span>
<span id="cb62-107"><a href="ptcld_process.html#cb62-107" tabindex="-1"></a><span class="co">#   , chm_rast = psinf_cloud2raster_ans$chm_rast</span></span>
<span id="cb62-108"><a href="ptcld_process.html#cb62-108" tabindex="-1"></a><span class="co">#   , rgb_rast = psinf_rgb_rast</span></span>
<span id="cb62-109"><a href="ptcld_process.html#cb62-109" tabindex="-1"></a><span class="co"># )</span></span></code></pre></div>
<p>use this handy plotting function for some piles</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="ptcld_process.html#cb63-1" tabindex="-1"></a><span class="co"># add pile locations</span></span>
<span id="cb63-2"><a href="ptcld_process.html#cb63-2" tabindex="-1"></a>plt_list_rast_temp <span class="ot">&lt;-</span> </span>
<span id="cb63-3"><a href="ptcld_process.html#cb63-3" tabindex="-1"></a>  <span class="dv">1</span><span class="sc">:</span><span class="fu">sum</span>(psinf_slash_piles_polys<span class="sc">$</span>is_in_stand) <span class="sc">%&gt;%</span> </span>
<span id="cb63-4"><a href="ptcld_process.html#cb63-4" tabindex="-1"></a>  <span class="fu">sample</span>(</span>
<span id="cb63-5"><a href="ptcld_process.html#cb63-5" tabindex="-1"></a>    <span class="fu">min</span>(<span class="dv">10</span>, <span class="fu">sum</span>(psinf_slash_piles_polys<span class="sc">$</span>is_in_stand))</span>
<span id="cb63-6"><a href="ptcld_process.html#cb63-6" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb63-7"><a href="ptcld_process.html#cb63-7" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">map</span>(</span>
<span id="cb63-8"><a href="ptcld_process.html#cb63-8" tabindex="-1"></a>    \(x) </span>
<span id="cb63-9"><a href="ptcld_process.html#cb63-9" tabindex="-1"></a>    <span class="fu">plt_rast_combine</span>(</span>
<span id="cb63-10"><a href="ptcld_process.html#cb63-10" tabindex="-1"></a>      <span class="at">rn =</span> x</span>
<span id="cb63-11"><a href="ptcld_process.html#cb63-11" tabindex="-1"></a>      , <span class="at">df =</span> psinf_slash_piles_polys <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(is_in_stand)</span>
<span id="cb63-12"><a href="ptcld_process.html#cb63-12" tabindex="-1"></a>      , <span class="at">dtm_rast =</span> psinf_cloud2raster_ans<span class="sc">$</span>dtm_rast</span>
<span id="cb63-13"><a href="ptcld_process.html#cb63-13" tabindex="-1"></a>      , <span class="at">chm_rast =</span> psinf_cloud2raster_ans<span class="sc">$</span>chm_rast</span>
<span id="cb63-14"><a href="ptcld_process.html#cb63-14" tabindex="-1"></a>      , <span class="at">rgb_rast =</span> psinf_rgb_rast</span>
<span id="cb63-15"><a href="ptcld_process.html#cb63-15" tabindex="-1"></a>    )</span>
<span id="cb63-16"><a href="ptcld_process.html#cb63-16" tabindex="-1"></a>  )</span>
<span id="cb63-17"><a href="ptcld_process.html#cb63-17" tabindex="-1"></a><span class="co"># plt_list_rast_temp[[2]]</span></span></code></pre></div>
<p>combine the plots with <code>patchwork</code></p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="ptcld_process.html#cb64-1" tabindex="-1"></a>patchwork<span class="sc">::</span><span class="fu">wrap_plots</span>(</span>
<span id="cb64-2"><a href="ptcld_process.html#cb64-2" tabindex="-1"></a>  plt_list_rast_temp</span>
<span id="cb64-3"><a href="ptcld_process.html#cb64-3" tabindex="-1"></a>  , <span class="at">ncol =</span> <span class="dv">2</span></span>
<span id="cb64-4"><a href="ptcld_process.html#cb64-4" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="slash_pile_detecting_files/figure-html/unnamed-chunk-69-1.png" alt="" width="1008" /></p>
<p>a few things are noteworthy in these examples:</p>
<ul>
<li>Piles are clearly visible in some areas of the DTM but less visible in other areas</li>
<li>Piles are delineated in the CHM but with varying degrees of definition based on surrounding terrain and pile structure</li>
<li>The DTM and CHM were rarely impacted by shadows in the RGB imagery</li>
<li>It is interesting to see coarse woody debris occasionally visible in the CHM</li>
</ul>
</div>
</div>
<div id="trfo-blm-pinyon-juniper-site-3" class="section level3 hasAnchor" number="3.1.2">
<h3><span class="header-section-number">3.1.2</span> TRFO-BLM Pinyon-Juniper Site<a href="ptcld_process.html#trfo-blm-pinyon-juniper-site-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>for this site, the full point cloud data we have covers a much larger extent than the treatment unit used for this study. we will therefore crop point cloud to a buffered area of interest so that we limit the amount of data processed</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="ptcld_process.html#cb65-1" tabindex="-1"></a><span class="do">###############################################################</span></span>
<span id="cb65-2"><a href="ptcld_process.html#cb65-2" tabindex="-1"></a><span class="co"># read/crop point cloud</span></span>
<span id="cb65-3"><a href="ptcld_process.html#cb65-3" tabindex="-1"></a><span class="do">###############################################################</span></span>
<span id="cb65-4"><a href="ptcld_process.html#cb65-4" tabindex="-1"></a><span class="co"># output dir for clipped las</span></span>
<span id="cb65-5"><a href="ptcld_process.html#cb65-5" tabindex="-1"></a>las_dir_temp <span class="ot">&lt;-</span> <span class="st">&quot;../data/Dawson_Data/point_cloud&quot;</span> </span>
<span id="cb65-6"><a href="ptcld_process.html#cb65-6" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">dir.exists</span>(las_dir_temp)){<span class="fu">dir.create</span>(las_dir_temp, <span class="at">showWarnings =</span> F)}</span>
<span id="cb65-7"><a href="ptcld_process.html#cb65-7" tabindex="-1"></a><span class="co"># do it if not already done</span></span>
<span id="cb65-8"><a href="ptcld_process.html#cb65-8" tabindex="-1"></a><span class="cf">if</span>(dplyr<span class="sc">::</span><span class="fu">coalesce</span>(<span class="fu">length</span>(<span class="fu">list.files</span>(las_dir_temp)),<span class="dv">0</span>)<span class="sc">&lt;</span><span class="dv">1</span>){</span>
<span id="cb65-9"><a href="ptcld_process.html#cb65-9" tabindex="-1"></a>  <span class="co"># this reads the metadata from all files in the folder, not the points themselves.</span></span>
<span id="cb65-10"><a href="ptcld_process.html#cb65-10" tabindex="-1"></a>  las_ctg_temp <span class="ot">&lt;-</span> lidR<span class="sc">::</span><span class="fu">readLAScatalog</span>(<span class="st">&quot;d:/BLM_CO_SWDF_DawsonFuelsTreatment/Final/PointCloud/Tiles/&quot;</span>)</span>
<span id="cb65-11"><a href="ptcld_process.html#cb65-11" tabindex="-1"></a>  las_ctg_temp</span>
<span id="cb65-12"><a href="ptcld_process.html#cb65-12" tabindex="-1"></a>  cloud2trees<span class="sc">:::</span><span class="fu">check_las_ctg_empty</span>(las_ctg_temp)</span>
<span id="cb65-13"><a href="ptcld_process.html#cb65-13" tabindex="-1"></a>  <span class="co"># set ctg opts</span></span>
<span id="cb65-14"><a href="ptcld_process.html#cb65-14" tabindex="-1"></a>  lidR<span class="sc">::</span><span class="fu">opt_select</span>(las_ctg_temp) <span class="ot">&lt;-</span> <span class="st">&quot;xyzainrcRGBNC&quot;</span></span>
<span id="cb65-15"><a href="ptcld_process.html#cb65-15" tabindex="-1"></a>  lidR<span class="sc">::</span><span class="fu">opt_progress</span>(las_ctg_temp) <span class="ot">&lt;-</span> T</span>
<span id="cb65-16"><a href="ptcld_process.html#cb65-16" tabindex="-1"></a>  <span class="co"># write generated results to disk storage rather than keeping everything in memory. This option can be activated with opt_output_files()</span></span>
<span id="cb65-17"><a href="ptcld_process.html#cb65-17" tabindex="-1"></a>  lidR<span class="sc">::</span><span class="fu">opt_output_files</span>(las_ctg_temp) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="fu">normalizePath</span>(las_dir_temp),<span class="st">&quot;/&quot;</span>, <span class="st">&quot;_{XLEFT}_{YBOTTOM}&quot;</span>) <span class="co"># label outputs based on coordinates</span></span>
<span id="cb65-18"><a href="ptcld_process.html#cb65-18" tabindex="-1"></a>  lidR<span class="sc">::</span><span class="fu">opt_filter</span>(las_ctg_temp) <span class="ot">&lt;-</span> <span class="st">&quot;-drop_duplicates&quot;</span></span>
<span id="cb65-19"><a href="ptcld_process.html#cb65-19" tabindex="-1"></a>  </span>
<span id="cb65-20"><a href="ptcld_process.html#cb65-20" tabindex="-1"></a>  <span class="co"># clip the point cloud using the polygon and write to a new file</span></span>
<span id="cb65-21"><a href="ptcld_process.html#cb65-21" tabindex="-1"></a>  <span class="co"># the lidR::opt_output_files is key to writing the output to disk without loading the entire clipped result into memory.</span></span>
<span id="cb65-22"><a href="ptcld_process.html#cb65-22" tabindex="-1"></a>  clip_las_ctg_temp <span class="ot">&lt;-</span> lidR<span class="sc">::</span><span class="fu">clip_roi</span>(</span>
<span id="cb65-23"><a href="ptcld_process.html#cb65-23" tabindex="-1"></a>    <span class="at">las =</span> las_ctg_temp</span>
<span id="cb65-24"><a href="ptcld_process.html#cb65-24" tabindex="-1"></a>    , <span class="at">geometry =</span> pj_stand_boundary <span class="sc">%&gt;%</span> </span>
<span id="cb65-25"><a href="ptcld_process.html#cb65-25" tabindex="-1"></a>      sf<span class="sc">::</span><span class="fu">st_buffer</span>(<span class="dv">100</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb65-26"><a href="ptcld_process.html#cb65-26" tabindex="-1"></a>      sf<span class="sc">::</span><span class="fu">st_bbox</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb65-27"><a href="ptcld_process.html#cb65-27" tabindex="-1"></a>      sf<span class="sc">::</span><span class="fu">st_as_sfc</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb65-28"><a href="ptcld_process.html#cb65-28" tabindex="-1"></a>      sf<span class="sc">::</span><span class="fu">st_as_sf</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb65-29"><a href="ptcld_process.html#cb65-29" tabindex="-1"></a>      sf<span class="sc">::</span><span class="fu">st_transform</span>(sf<span class="sc">::</span><span class="fu">st_crs</span>(las_ctg_temp))</span>
<span id="cb65-30"><a href="ptcld_process.html#cb65-30" tabindex="-1"></a>  )</span>
<span id="cb65-31"><a href="ptcld_process.html#cb65-31" tabindex="-1"></a>}<span class="cf">else</span>{</span>
<span id="cb65-32"><a href="ptcld_process.html#cb65-32" tabindex="-1"></a>  clip_las_ctg_temp <span class="ot">&lt;-</span> lidR<span class="sc">::</span><span class="fu">readLAScatalog</span>(las_dir_temp)</span>
<span id="cb65-33"><a href="ptcld_process.html#cb65-33" tabindex="-1"></a>}</span>
<span id="cb65-34"><a href="ptcld_process.html#cb65-34" tabindex="-1"></a><span class="co"># clip_las_ctg_temp</span></span>
<span id="cb65-35"><a href="ptcld_process.html#cb65-35" tabindex="-1"></a><span class="co"># clip_las_ctg_temp$filename</span></span></code></pre></div>
<p>look at the summary of the point cloud data we’ll be processing</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="ptcld_process.html#cb66-1" tabindex="-1"></a><span class="co"># processing dirs</span></span>
<span id="cb66-2"><a href="ptcld_process.html#cb66-2" tabindex="-1"></a>c2t_out_dir_temp <span class="ot">&lt;-</span> <span class="st">&quot;../data/Dawson_Data/&quot;</span></span>
<span id="cb66-3"><a href="ptcld_process.html#cb66-3" tabindex="-1"></a>out_dir_temp <span class="ot">&lt;-</span> <span class="fu">file.path</span>(c2t_out_dir_temp, <span class="fu">paste0</span>(<span class="st">&quot;point_cloud_processing_delivery_chm&quot;</span>,my_chm_res_m,<span class="st">&quot;m&quot;</span>) )</span>
<span id="cb66-4"><a href="ptcld_process.html#cb66-4" tabindex="-1"></a><span class="co"># las_dir_temp &lt;- las_dir_temp</span></span>
<span id="cb66-5"><a href="ptcld_process.html#cb66-5" tabindex="-1"></a><span class="co"># read header with catalog</span></span>
<span id="cb66-6"><a href="ptcld_process.html#cb66-6" tabindex="-1"></a>lidR<span class="sc">::</span><span class="fu">readLAScatalog</span>(las_dir_temp)</span></code></pre></div>
<pre><code>## class       : LAScatalog (v1.2 format 2)
## extent      : 707813.6, 708409.9, 4193155, 4193638 (xmin, xmax, ymin, ymax)
## coord. ref. : NAD83(2011) / UTM zone 12N 
## area        : 288106.3 m²
## points      : 163.84 million points
## type        : terrestrial
## density     : 568.7 points/m²
## density     : 568.7 pulses/m²
## num. files  : 1</code></pre>
<p>process the point cloud with the <code>cloud2trees::cloud2raster()</code> workflow</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="ptcld_process.html#cb68-1" tabindex="-1"></a><span class="co"># do it</span></span>
<span id="cb68-2"><a href="ptcld_process.html#cb68-2" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">dir.exists</span>(out_dir_temp)){</span>
<span id="cb68-3"><a href="ptcld_process.html#cb68-3" tabindex="-1"></a>  <span class="co"># cloud2trees</span></span>
<span id="cb68-4"><a href="ptcld_process.html#cb68-4" tabindex="-1"></a>  pj_cloud2raster_ans <span class="ot">&lt;-</span> cloud2trees<span class="sc">::</span><span class="fu">cloud2raster</span>(</span>
<span id="cb68-5"><a href="ptcld_process.html#cb68-5" tabindex="-1"></a>    <span class="at">output_dir =</span> c2t_out_dir_temp</span>
<span id="cb68-6"><a href="ptcld_process.html#cb68-6" tabindex="-1"></a>    , <span class="at">input_las_dir =</span> las_dir_temp</span>
<span id="cb68-7"><a href="ptcld_process.html#cb68-7" tabindex="-1"></a>    , <span class="at">accuracy_level =</span> <span class="dv">2</span></span>
<span id="cb68-8"><a href="ptcld_process.html#cb68-8" tabindex="-1"></a>    , <span class="at">keep_intrmdt =</span> T</span>
<span id="cb68-9"><a href="ptcld_process.html#cb68-9" tabindex="-1"></a>    , <span class="at">dtm_res_m =</span> <span class="fl">0.2</span></span>
<span id="cb68-10"><a href="ptcld_process.html#cb68-10" tabindex="-1"></a>    , <span class="at">chm_res_m =</span> my_chm_res_m</span>
<span id="cb68-11"><a href="ptcld_process.html#cb68-11" tabindex="-1"></a>    , <span class="at">min_height =</span> <span class="dv">0</span> <span class="co"># effectively generates a DSM based on non-ground points</span></span>
<span id="cb68-12"><a href="ptcld_process.html#cb68-12" tabindex="-1"></a>  )</span>
<span id="cb68-13"><a href="ptcld_process.html#cb68-13" tabindex="-1"></a>  <span class="co"># rename</span></span>
<span id="cb68-14"><a href="ptcld_process.html#cb68-14" tabindex="-1"></a>  <span class="fu">file.rename</span>(<span class="at">from =</span> <span class="fu">file.path</span>(c2t_out_dir_temp,<span class="st">&quot;point_cloud_processing_delivery&quot;</span>), <span class="at">to =</span> out_dir_temp)</span>
<span id="cb68-15"><a href="ptcld_process.html#cb68-15" tabindex="-1"></a>}<span class="cf">else</span>{</span>
<span id="cb68-16"><a href="ptcld_process.html#cb68-16" tabindex="-1"></a>  dtm_temp <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rast</span>( <span class="fu">file.path</span>(out_dir_temp, <span class="st">&quot;dtm_0.2m.tif&quot;</span>) ) <span class="sc">%&gt;%</span> </span>
<span id="cb68-17"><a href="ptcld_process.html#cb68-17" tabindex="-1"></a>    terra<span class="sc">::</span><span class="fu">aggregate</span>(<span class="at">fact =</span> <span class="dv">2</span>, <span class="at">na.rm=</span>T, <span class="at">cores =</span> lasR<span class="sc">::</span><span class="fu">half_cores</span>())</span>
<span id="cb68-18"><a href="ptcld_process.html#cb68-18" tabindex="-1"></a>  chm_temp <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rast</span>( <span class="fu">file.path</span>(out_dir_temp, <span class="fu">paste0</span>(<span class="st">&quot;chm_&quot;</span>, my_chm_res_m,<span class="st">&quot;m.tif&quot;</span>)) )</span>
<span id="cb68-19"><a href="ptcld_process.html#cb68-19" tabindex="-1"></a>  <span class="co"># combine</span></span>
<span id="cb68-20"><a href="ptcld_process.html#cb68-20" tabindex="-1"></a>  pj_cloud2raster_ans <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb68-21"><a href="ptcld_process.html#cb68-21" tabindex="-1"></a>    <span class="st">&quot;dtm_rast&quot;</span> <span class="ot">=</span> dtm_temp</span>
<span id="cb68-22"><a href="ptcld_process.html#cb68-22" tabindex="-1"></a>    , <span class="st">&quot;chm_rast&quot;</span> <span class="ot">=</span> chm_temp</span>
<span id="cb68-23"><a href="ptcld_process.html#cb68-23" tabindex="-1"></a>  )</span>
<span id="cb68-24"><a href="ptcld_process.html#cb68-24" tabindex="-1"></a>}</span></code></pre></div>
<p>let’s check out the DTM</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="ptcld_process.html#cb69-1" tabindex="-1"></a>pj_cloud2raster_ans<span class="sc">$</span>dtm_rast <span class="sc">%&gt;%</span> </span>
<span id="cb69-2"><a href="ptcld_process.html#cb69-2" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">crop</span>(</span>
<span id="cb69-3"><a href="ptcld_process.html#cb69-3" tabindex="-1"></a>    pj_stand_boundary <span class="sc">%&gt;%</span> </span>
<span id="cb69-4"><a href="ptcld_process.html#cb69-4" tabindex="-1"></a>    sf<span class="sc">::</span><span class="fu">st_buffer</span>(<span class="dv">22</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb69-5"><a href="ptcld_process.html#cb69-5" tabindex="-1"></a>    sf<span class="sc">::</span><span class="fu">st_transform</span>(terra<span class="sc">::</span><span class="fu">crs</span>(pj_cloud2raster_ans<span class="sc">$</span>dtm_rast)) <span class="sc">%&gt;%</span> </span>
<span id="cb69-6"><a href="ptcld_process.html#cb69-6" tabindex="-1"></a>    terra<span class="sc">::</span><span class="fu">vect</span>()</span>
<span id="cb69-7"><a href="ptcld_process.html#cb69-7" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb69-8"><a href="ptcld_process.html#cb69-8" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">plot</span>(</span>
<span id="cb69-9"><a href="ptcld_process.html#cb69-9" tabindex="-1"></a>    <span class="at">col =</span> viridis<span class="sc">::</span><span class="fu">viridis</span>(<span class="at">n =</span> <span class="dv">100</span>)</span>
<span id="cb69-10"><a href="ptcld_process.html#cb69-10" tabindex="-1"></a>    , <span class="at">axes =</span> F</span>
<span id="cb69-11"><a href="ptcld_process.html#cb69-11" tabindex="-1"></a>    , <span class="at">main =</span> <span class="st">&quot;DTM (m)&quot;</span></span>
<span id="cb69-12"><a href="ptcld_process.html#cb69-12" tabindex="-1"></a>  )</span>
<span id="cb69-13"><a href="ptcld_process.html#cb69-13" tabindex="-1"></a><span class="co"># add stand boundary</span></span>
<span id="cb69-14"><a href="ptcld_process.html#cb69-14" tabindex="-1"></a>terra<span class="sc">::</span><span class="fu">plot</span>(</span>
<span id="cb69-15"><a href="ptcld_process.html#cb69-15" tabindex="-1"></a>  pj_stand_boundary <span class="sc">%&gt;%</span> </span>
<span id="cb69-16"><a href="ptcld_process.html#cb69-16" tabindex="-1"></a>    sf<span class="sc">::</span><span class="fu">st_transform</span>(terra<span class="sc">::</span><span class="fu">crs</span>(pj_cloud2raster_ans<span class="sc">$</span>dtm_rast)) <span class="sc">%&gt;%</span> </span>
<span id="cb69-17"><a href="ptcld_process.html#cb69-17" tabindex="-1"></a>    terra<span class="sc">::</span><span class="fu">vect</span>()</span>
<span id="cb69-18"><a href="ptcld_process.html#cb69-18" tabindex="-1"></a>  , <span class="at">add =</span> T, <span class="at">border =</span> <span class="st">&quot;black&quot;</span>, <span class="at">col =</span> <span class="cn">NA</span>, <span class="at">lwd =</span> <span class="fl">1.2</span></span>
<span id="cb69-19"><a href="ptcld_process.html#cb69-19" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="slash_pile_detecting_files/figure-html/unnamed-chunk-76-1.png" alt="" width="1008" /></p>
<p>and CHM</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="ptcld_process.html#cb70-1" tabindex="-1"></a>pj_cloud2raster_ans<span class="sc">$</span>chm_rast <span class="sc">%&gt;%</span> </span>
<span id="cb70-2"><a href="ptcld_process.html#cb70-2" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">crop</span>(</span>
<span id="cb70-3"><a href="ptcld_process.html#cb70-3" tabindex="-1"></a>    pj_stand_boundary <span class="sc">%&gt;%</span> </span>
<span id="cb70-4"><a href="ptcld_process.html#cb70-4" tabindex="-1"></a>    sf<span class="sc">::</span><span class="fu">st_buffer</span>(<span class="dv">22</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb70-5"><a href="ptcld_process.html#cb70-5" tabindex="-1"></a>    sf<span class="sc">::</span><span class="fu">st_transform</span>(terra<span class="sc">::</span><span class="fu">crs</span>(pj_cloud2raster_ans<span class="sc">$</span>chm_rast)) <span class="sc">%&gt;%</span> </span>
<span id="cb70-6"><a href="ptcld_process.html#cb70-6" tabindex="-1"></a>    terra<span class="sc">::</span><span class="fu">vect</span>()</span>
<span id="cb70-7"><a href="ptcld_process.html#cb70-7" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb70-8"><a href="ptcld_process.html#cb70-8" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">aggregate</span>(<span class="at">fact =</span> <span class="dv">2</span>, <span class="at">na.rm =</span> T, <span class="at">cores =</span> lasR<span class="sc">::</span><span class="fu">half_cores</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb70-9"><a href="ptcld_process.html#cb70-9" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">plot</span>(</span>
<span id="cb70-10"><a href="ptcld_process.html#cb70-10" tabindex="-1"></a>    <span class="at">col =</span> viridis<span class="sc">::</span><span class="fu">plasma</span>(<span class="dv">100</span>)</span>
<span id="cb70-11"><a href="ptcld_process.html#cb70-11" tabindex="-1"></a>    , <span class="at">axes =</span> F</span>
<span id="cb70-12"><a href="ptcld_process.html#cb70-12" tabindex="-1"></a>    , <span class="at">main =</span> <span class="st">&quot;CHM (m)&quot;</span></span>
<span id="cb70-13"><a href="ptcld_process.html#cb70-13" tabindex="-1"></a>  )</span>
<span id="cb70-14"><a href="ptcld_process.html#cb70-14" tabindex="-1"></a><span class="co"># add stand boundary</span></span>
<span id="cb70-15"><a href="ptcld_process.html#cb70-15" tabindex="-1"></a>terra<span class="sc">::</span><span class="fu">plot</span>(</span>
<span id="cb70-16"><a href="ptcld_process.html#cb70-16" tabindex="-1"></a>  pj_stand_boundary <span class="sc">%&gt;%</span> </span>
<span id="cb70-17"><a href="ptcld_process.html#cb70-17" tabindex="-1"></a>    sf<span class="sc">::</span><span class="fu">st_transform</span>(terra<span class="sc">::</span><span class="fu">crs</span>(pj_cloud2raster_ans<span class="sc">$</span>chm_rast)) <span class="sc">%&gt;%</span> </span>
<span id="cb70-18"><a href="ptcld_process.html#cb70-18" tabindex="-1"></a>    terra<span class="sc">::</span><span class="fu">vect</span>()</span>
<span id="cb70-19"><a href="ptcld_process.html#cb70-19" tabindex="-1"></a>  , <span class="at">add =</span> T, <span class="at">border =</span> <span class="st">&quot;black&quot;</span>, <span class="at">col =</span> <span class="cn">NA</span>, <span class="at">lwd =</span> <span class="fl">1.2</span></span>
<span id="cb70-20"><a href="ptcld_process.html#cb70-20" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="slash_pile_detecting_files/figure-html/unnamed-chunk-77-1.png" alt="" width="1008" /></p>
<div id="dtm-and-chm-piles-1" class="section level4 hasAnchor" number="3.1.2.1">
<h4><span class="header-section-number">3.1.2.1</span> DTM and CHM + piles<a href="ptcld_process.html#dtm-and-chm-piles-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>let’s visually inspect the DTM and CHM with the pile outlines overlaid for a sample of piles</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="ptcld_process.html#cb71-1" tabindex="-1"></a><span class="co"># add pile locations</span></span>
<span id="cb71-2"><a href="ptcld_process.html#cb71-2" tabindex="-1"></a>plt_list_rast_temp <span class="ot">&lt;-</span> </span>
<span id="cb71-3"><a href="ptcld_process.html#cb71-3" tabindex="-1"></a>  <span class="dv">1</span><span class="sc">:</span><span class="fu">sum</span>(pj_slash_piles_polys<span class="sc">$</span>is_in_stand) <span class="sc">%&gt;%</span> </span>
<span id="cb71-4"><a href="ptcld_process.html#cb71-4" tabindex="-1"></a>  <span class="fu">sample</span>(</span>
<span id="cb71-5"><a href="ptcld_process.html#cb71-5" tabindex="-1"></a>    <span class="fu">min</span>(<span class="dv">10</span>, <span class="fu">sum</span>(pj_slash_piles_polys<span class="sc">$</span>is_in_stand))</span>
<span id="cb71-6"><a href="ptcld_process.html#cb71-6" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb71-7"><a href="ptcld_process.html#cb71-7" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">map</span>(</span>
<span id="cb71-8"><a href="ptcld_process.html#cb71-8" tabindex="-1"></a>    \(x) </span>
<span id="cb71-9"><a href="ptcld_process.html#cb71-9" tabindex="-1"></a>    <span class="fu">plt_rast_combine</span>(</span>
<span id="cb71-10"><a href="ptcld_process.html#cb71-10" tabindex="-1"></a>      <span class="at">rn =</span> x</span>
<span id="cb71-11"><a href="ptcld_process.html#cb71-11" tabindex="-1"></a>      , <span class="at">df =</span> pj_slash_piles_polys <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(is_in_stand)</span>
<span id="cb71-12"><a href="ptcld_process.html#cb71-12" tabindex="-1"></a>      , <span class="at">dtm_rast =</span> pj_cloud2raster_ans<span class="sc">$</span>dtm_rast</span>
<span id="cb71-13"><a href="ptcld_process.html#cb71-13" tabindex="-1"></a>      , <span class="at">chm_rast =</span> pj_cloud2raster_ans<span class="sc">$</span>chm_rast</span>
<span id="cb71-14"><a href="ptcld_process.html#cb71-14" tabindex="-1"></a>      , <span class="at">rgb_rast =</span> pj_rgb_rast</span>
<span id="cb71-15"><a href="ptcld_process.html#cb71-15" tabindex="-1"></a>    )</span>
<span id="cb71-16"><a href="ptcld_process.html#cb71-16" tabindex="-1"></a>  )</span>
<span id="cb71-17"><a href="ptcld_process.html#cb71-17" tabindex="-1"></a><span class="co"># plt_list_rast_temp[[2]]</span></span></code></pre></div>
<p>combine the plots with <code>patchwork</code></p>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="ptcld_process.html#cb72-1" tabindex="-1"></a>patchwork<span class="sc">::</span><span class="fu">wrap_plots</span>(</span>
<span id="cb72-2"><a href="ptcld_process.html#cb72-2" tabindex="-1"></a>  plt_list_rast_temp</span>
<span id="cb72-3"><a href="ptcld_process.html#cb72-3" tabindex="-1"></a>  , <span class="at">ncol =</span> <span class="dv">2</span></span>
<span id="cb72-4"><a href="ptcld_process.html#cb72-4" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="slash_pile_detecting_files/figure-html/unnamed-chunk-79-1.png" alt="" width="1008" /></p>
</div>
</div>
<div id="bhef-ponderosa-pine-site-3" class="section level3 hasAnchor" number="3.1.3">
<h3><span class="header-section-number">3.1.3</span> BHEF Ponderosa Pine Site<a href="ptcld_process.html#bhef-ponderosa-pine-site-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>for this site, the point cloud files are dispersed across different folders. so, we’ll manually specify which files to use.</p>
<p>look at the summary of the point cloud data we’ll be processing</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="ptcld_process.html#cb73-1" tabindex="-1"></a><span class="co"># processing dirs</span></span>
<span id="cb73-2"><a href="ptcld_process.html#cb73-2" tabindex="-1"></a>c2t_out_dir_temp <span class="ot">&lt;-</span> <span class="st">&quot;../data/BHEF_202306/&quot;</span></span>
<span id="cb73-3"><a href="ptcld_process.html#cb73-3" tabindex="-1"></a>out_dir_temp <span class="ot">&lt;-</span> <span class="fu">file.path</span>(c2t_out_dir_temp, <span class="fu">paste0</span>(<span class="st">&quot;point_cloud_processing_delivery_chm&quot;</span>,my_chm_res_m,<span class="st">&quot;m&quot;</span>) )</span>
<span id="cb73-4"><a href="ptcld_process.html#cb73-4" tabindex="-1"></a><span class="co"># las_dir_temp &lt;- &quot;where/are/the/pointcloud&quot;</span></span>
<span id="cb73-5"><a href="ptcld_process.html#cb73-5" tabindex="-1"></a>las_flist_temp <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb73-6"><a href="ptcld_process.html#cb73-6" tabindex="-1"></a>  <span class="st">&quot;F:</span><span class="sc">\\</span><span class="st">UAS_Collections</span><span class="sc">\\</span><span class="st">BHEF_202306/Unit1and3Processing.files/BHEF_202306_Unit1and3_laz.laz&quot;</span></span>
<span id="cb73-7"><a href="ptcld_process.html#cb73-7" tabindex="-1"></a>  , <span class="st">&quot;F:</span><span class="sc">\\</span><span class="st">UAS_Collections</span><span class="sc">\\</span><span class="st">BHEF_202306/Unit2Processing.files/BHEF_202306_Unit2_laz.laz&quot;</span>        </span>
<span id="cb73-8"><a href="ptcld_process.html#cb73-8" tabindex="-1"></a>  , <span class="fu">list.files</span>(</span>
<span id="cb73-9"><a href="ptcld_process.html#cb73-9" tabindex="-1"></a>    <span class="st">&quot;F:</span><span class="sc">\\</span><span class="st">UAS_Collections</span><span class="sc">\\</span><span class="st">BHEF_202306</span><span class="sc">\\</span><span class="st">00good_simplified_point_clouds_reduced_overlap&quot;</span></span>
<span id="cb73-10"><a href="ptcld_process.html#cb73-10" tabindex="-1"></a>    , <span class="at">pattern =</span> <span class="st">&quot;.*</span><span class="sc">\\</span><span class="st">.(laz|las)$&quot;</span></span>
<span id="cb73-11"><a href="ptcld_process.html#cb73-11" tabindex="-1"></a>    , <span class="at">full.names =</span> <span class="cn">TRUE</span>, <span class="at">recursive =</span> T</span>
<span id="cb73-12"><a href="ptcld_process.html#cb73-12" tabindex="-1"></a>  )</span>
<span id="cb73-13"><a href="ptcld_process.html#cb73-13" tabindex="-1"></a>)</span>
<span id="cb73-14"><a href="ptcld_process.html#cb73-14" tabindex="-1"></a><span class="co"># read header with catalog</span></span>
<span id="cb73-15"><a href="ptcld_process.html#cb73-15" tabindex="-1"></a>lidR<span class="sc">::</span><span class="fu">readLAScatalog</span>(las_flist_temp)</span></code></pre></div>
<pre><code>## class       : LAScatalog (v1.2 format 2)
## extent      : 608234, 610968.2, 4888216, 4889418 (xmin, xmax, ymin, ymax)
## coord. ref. : NAD83 / UTM zone 13N 
## area        : 3.48 km²
## points      : 1.42 billion points
## type        : airborne
## density     : 408 points/m²
## density     : 408 pulses/m²
## num. files  : 7</code></pre>
<p>process the point cloud with the <code>cloud2trees::cloud2raster()</code> workflow</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="ptcld_process.html#cb75-1" tabindex="-1"></a><span class="co"># do it</span></span>
<span id="cb75-2"><a href="ptcld_process.html#cb75-2" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">dir.exists</span>(out_dir_temp)){</span>
<span id="cb75-3"><a href="ptcld_process.html#cb75-3" tabindex="-1"></a>  <span class="co"># cloud2trees</span></span>
<span id="cb75-4"><a href="ptcld_process.html#cb75-4" tabindex="-1"></a>  bhef_cloud2raster_ans <span class="ot">&lt;-</span> cloud2trees<span class="sc">::</span><span class="fu">cloud2raster</span>(</span>
<span id="cb75-5"><a href="ptcld_process.html#cb75-5" tabindex="-1"></a>    <span class="at">output_dir =</span> c2t_out_dir_temp</span>
<span id="cb75-6"><a href="ptcld_process.html#cb75-6" tabindex="-1"></a>    , <span class="at">input_las_dir =</span> las_flist_temp</span>
<span id="cb75-7"><a href="ptcld_process.html#cb75-7" tabindex="-1"></a>    , <span class="at">accuracy_level =</span> <span class="dv">2</span></span>
<span id="cb75-8"><a href="ptcld_process.html#cb75-8" tabindex="-1"></a>    , <span class="at">keep_intrmdt =</span> T</span>
<span id="cb75-9"><a href="ptcld_process.html#cb75-9" tabindex="-1"></a>    , <span class="at">dtm_res_m =</span> <span class="fl">0.2</span></span>
<span id="cb75-10"><a href="ptcld_process.html#cb75-10" tabindex="-1"></a>    , <span class="at">chm_res_m =</span> my_chm_res_m</span>
<span id="cb75-11"><a href="ptcld_process.html#cb75-11" tabindex="-1"></a>    , <span class="at">min_height =</span> <span class="dv">0</span> <span class="co"># effectively generates a DSM based on non-ground points</span></span>
<span id="cb75-12"><a href="ptcld_process.html#cb75-12" tabindex="-1"></a>  )</span>
<span id="cb75-13"><a href="ptcld_process.html#cb75-13" tabindex="-1"></a>  <span class="co"># rename</span></span>
<span id="cb75-14"><a href="ptcld_process.html#cb75-14" tabindex="-1"></a>  <span class="fu">file.rename</span>(<span class="at">from =</span> <span class="fu">file.path</span>(c2t_out_dir_temp,<span class="st">&quot;point_cloud_processing_delivery&quot;</span>), <span class="at">to =</span> out_dir_temp)</span>
<span id="cb75-15"><a href="ptcld_process.html#cb75-15" tabindex="-1"></a>}<span class="cf">else</span>{</span>
<span id="cb75-16"><a href="ptcld_process.html#cb75-16" tabindex="-1"></a>  dtm_temp <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rast</span>( <span class="fu">file.path</span>(out_dir_temp, <span class="st">&quot;dtm_0.2m.tif&quot;</span>) ) <span class="sc">%&gt;%</span> </span>
<span id="cb75-17"><a href="ptcld_process.html#cb75-17" tabindex="-1"></a>    terra<span class="sc">::</span><span class="fu">aggregate</span>(<span class="at">fact =</span> <span class="dv">2</span>, <span class="at">na.rm=</span>T, <span class="at">cores =</span> lasR<span class="sc">::</span><span class="fu">half_cores</span>())</span>
<span id="cb75-18"><a href="ptcld_process.html#cb75-18" tabindex="-1"></a>  chm_temp <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rast</span>( <span class="fu">file.path</span>(out_dir_temp, <span class="fu">paste0</span>(<span class="st">&quot;chm_&quot;</span>, my_chm_res_m,<span class="st">&quot;m.tif&quot;</span>)) )</span>
<span id="cb75-19"><a href="ptcld_process.html#cb75-19" tabindex="-1"></a>  <span class="co"># combine</span></span>
<span id="cb75-20"><a href="ptcld_process.html#cb75-20" tabindex="-1"></a>  bhef_cloud2raster_ans <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb75-21"><a href="ptcld_process.html#cb75-21" tabindex="-1"></a>    <span class="st">&quot;dtm_rast&quot;</span> <span class="ot">=</span> dtm_temp</span>
<span id="cb75-22"><a href="ptcld_process.html#cb75-22" tabindex="-1"></a>    , <span class="st">&quot;chm_rast&quot;</span> <span class="ot">=</span> chm_temp</span>
<span id="cb75-23"><a href="ptcld_process.html#cb75-23" tabindex="-1"></a>  )</span>
<span id="cb75-24"><a href="ptcld_process.html#cb75-24" tabindex="-1"></a>}</span></code></pre></div>
<p>let’s check out the DTM</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="ptcld_process.html#cb76-1" tabindex="-1"></a>bhef_cloud2raster_ans<span class="sc">$</span>dtm_rast <span class="sc">%&gt;%</span> </span>
<span id="cb76-2"><a href="ptcld_process.html#cb76-2" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">crop</span>(</span>
<span id="cb76-3"><a href="ptcld_process.html#cb76-3" tabindex="-1"></a>    bhef_stand_boundary <span class="sc">%&gt;%</span> </span>
<span id="cb76-4"><a href="ptcld_process.html#cb76-4" tabindex="-1"></a>    sf<span class="sc">::</span><span class="fu">st_buffer</span>(<span class="dv">22</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb76-5"><a href="ptcld_process.html#cb76-5" tabindex="-1"></a>    sf<span class="sc">::</span><span class="fu">st_transform</span>(terra<span class="sc">::</span><span class="fu">crs</span>(bhef_cloud2raster_ans<span class="sc">$</span>dtm_rast)) <span class="sc">%&gt;%</span> </span>
<span id="cb76-6"><a href="ptcld_process.html#cb76-6" tabindex="-1"></a>    terra<span class="sc">::</span><span class="fu">vect</span>()</span>
<span id="cb76-7"><a href="ptcld_process.html#cb76-7" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb76-8"><a href="ptcld_process.html#cb76-8" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">plot</span>(</span>
<span id="cb76-9"><a href="ptcld_process.html#cb76-9" tabindex="-1"></a>    <span class="at">col =</span> viridis<span class="sc">::</span><span class="fu">viridis</span>(<span class="at">n =</span> <span class="dv">100</span>)</span>
<span id="cb76-10"><a href="ptcld_process.html#cb76-10" tabindex="-1"></a>    , <span class="at">axes =</span> F</span>
<span id="cb76-11"><a href="ptcld_process.html#cb76-11" tabindex="-1"></a>    , <span class="at">main =</span> <span class="st">&quot;DTM (m)&quot;</span></span>
<span id="cb76-12"><a href="ptcld_process.html#cb76-12" tabindex="-1"></a>  )</span>
<span id="cb76-13"><a href="ptcld_process.html#cb76-13" tabindex="-1"></a><span class="co"># add stand boundary</span></span>
<span id="cb76-14"><a href="ptcld_process.html#cb76-14" tabindex="-1"></a>terra<span class="sc">::</span><span class="fu">plot</span>(</span>
<span id="cb76-15"><a href="ptcld_process.html#cb76-15" tabindex="-1"></a>  bhef_stand_boundary <span class="sc">%&gt;%</span> </span>
<span id="cb76-16"><a href="ptcld_process.html#cb76-16" tabindex="-1"></a>    sf<span class="sc">::</span><span class="fu">st_transform</span>(terra<span class="sc">::</span><span class="fu">crs</span>(bhef_cloud2raster_ans<span class="sc">$</span>dtm_rast)) <span class="sc">%&gt;%</span> </span>
<span id="cb76-17"><a href="ptcld_process.html#cb76-17" tabindex="-1"></a>    terra<span class="sc">::</span><span class="fu">vect</span>()</span>
<span id="cb76-18"><a href="ptcld_process.html#cb76-18" tabindex="-1"></a>  , <span class="at">add =</span> T, <span class="at">border =</span> <span class="st">&quot;black&quot;</span>, <span class="at">col =</span> <span class="cn">NA</span>, <span class="at">lwd =</span> <span class="fl">1.2</span></span>
<span id="cb76-19"><a href="ptcld_process.html#cb76-19" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="slash_pile_detecting_files/figure-html/unnamed-chunk-85-1.png" alt="" width="1008" /></p>
<p>and CHM</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="ptcld_process.html#cb77-1" tabindex="-1"></a>bhef_cloud2raster_ans<span class="sc">$</span>chm_rast <span class="sc">%&gt;%</span> </span>
<span id="cb77-2"><a href="ptcld_process.html#cb77-2" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">crop</span>(</span>
<span id="cb77-3"><a href="ptcld_process.html#cb77-3" tabindex="-1"></a>    bhef_stand_boundary <span class="sc">%&gt;%</span> </span>
<span id="cb77-4"><a href="ptcld_process.html#cb77-4" tabindex="-1"></a>    sf<span class="sc">::</span><span class="fu">st_buffer</span>(<span class="dv">22</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb77-5"><a href="ptcld_process.html#cb77-5" tabindex="-1"></a>    sf<span class="sc">::</span><span class="fu">st_transform</span>(terra<span class="sc">::</span><span class="fu">crs</span>(bhef_cloud2raster_ans<span class="sc">$</span>chm_rast)) <span class="sc">%&gt;%</span> </span>
<span id="cb77-6"><a href="ptcld_process.html#cb77-6" tabindex="-1"></a>    terra<span class="sc">::</span><span class="fu">vect</span>()</span>
<span id="cb77-7"><a href="ptcld_process.html#cb77-7" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb77-8"><a href="ptcld_process.html#cb77-8" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">aggregate</span>(<span class="at">fact =</span> <span class="dv">2</span>, <span class="at">na.rm =</span> T, <span class="at">cores =</span> lasR<span class="sc">::</span><span class="fu">half_cores</span>()) <span class="sc">%&gt;%</span>  </span>
<span id="cb77-9"><a href="ptcld_process.html#cb77-9" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">plot</span>(</span>
<span id="cb77-10"><a href="ptcld_process.html#cb77-10" tabindex="-1"></a>    <span class="at">col =</span> viridis<span class="sc">::</span><span class="fu">plasma</span>(<span class="dv">100</span>)</span>
<span id="cb77-11"><a href="ptcld_process.html#cb77-11" tabindex="-1"></a>    , <span class="at">axes =</span> F</span>
<span id="cb77-12"><a href="ptcld_process.html#cb77-12" tabindex="-1"></a>    , <span class="at">main =</span> <span class="st">&quot;CHM (m)&quot;</span></span>
<span id="cb77-13"><a href="ptcld_process.html#cb77-13" tabindex="-1"></a>  )</span>
<span id="cb77-14"><a href="ptcld_process.html#cb77-14" tabindex="-1"></a><span class="co"># add stand boundary</span></span>
<span id="cb77-15"><a href="ptcld_process.html#cb77-15" tabindex="-1"></a>terra<span class="sc">::</span><span class="fu">plot</span>(</span>
<span id="cb77-16"><a href="ptcld_process.html#cb77-16" tabindex="-1"></a>  bhef_stand_boundary <span class="sc">%&gt;%</span> </span>
<span id="cb77-17"><a href="ptcld_process.html#cb77-17" tabindex="-1"></a>    sf<span class="sc">::</span><span class="fu">st_transform</span>(terra<span class="sc">::</span><span class="fu">crs</span>(bhef_cloud2raster_ans<span class="sc">$</span>chm_rast)) <span class="sc">%&gt;%</span> </span>
<span id="cb77-18"><a href="ptcld_process.html#cb77-18" tabindex="-1"></a>    terra<span class="sc">::</span><span class="fu">vect</span>()</span>
<span id="cb77-19"><a href="ptcld_process.html#cb77-19" tabindex="-1"></a>  , <span class="at">add =</span> T, <span class="at">border =</span> <span class="st">&quot;black&quot;</span>, <span class="at">col =</span> <span class="cn">NA</span>, <span class="at">lwd =</span> <span class="fl">1.2</span></span>
<span id="cb77-20"><a href="ptcld_process.html#cb77-20" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="slash_pile_detecting_files/figure-html/unnamed-chunk-86-1.png" alt="" width="1008" /></p>
<div id="dtm-and-chm-piles-2" class="section level4 hasAnchor" number="3.1.3.1">
<h4><span class="header-section-number">3.1.3.1</span> DTM and CHM + piles<a href="ptcld_process.html#dtm-and-chm-piles-2" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>let’s visually inspect the DTM and CHM with the pile outlines overlaid for a sample of piles</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="ptcld_process.html#cb78-1" tabindex="-1"></a><span class="co"># add pile locations</span></span>
<span id="cb78-2"><a href="ptcld_process.html#cb78-2" tabindex="-1"></a>plt_list_rast_temp <span class="ot">&lt;-</span> </span>
<span id="cb78-3"><a href="ptcld_process.html#cb78-3" tabindex="-1"></a>  <span class="dv">1</span><span class="sc">:</span><span class="fu">sum</span>(bhef_slash_piles_polys<span class="sc">$</span>is_in_stand) <span class="sc">%&gt;%</span> </span>
<span id="cb78-4"><a href="ptcld_process.html#cb78-4" tabindex="-1"></a>  <span class="fu">sample</span>(</span>
<span id="cb78-5"><a href="ptcld_process.html#cb78-5" tabindex="-1"></a>    <span class="fu">min</span>(<span class="dv">10</span>, <span class="fu">sum</span>(bhef_slash_piles_polys<span class="sc">$</span>is_in_stand))</span>
<span id="cb78-6"><a href="ptcld_process.html#cb78-6" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb78-7"><a href="ptcld_process.html#cb78-7" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">map</span>(</span>
<span id="cb78-8"><a href="ptcld_process.html#cb78-8" tabindex="-1"></a>    \(x) </span>
<span id="cb78-9"><a href="ptcld_process.html#cb78-9" tabindex="-1"></a>    <span class="fu">plt_rast_combine</span>(</span>
<span id="cb78-10"><a href="ptcld_process.html#cb78-10" tabindex="-1"></a>      <span class="at">rn =</span> x</span>
<span id="cb78-11"><a href="ptcld_process.html#cb78-11" tabindex="-1"></a>      , <span class="at">df =</span> bhef_slash_piles_polys <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(is_in_stand)</span>
<span id="cb78-12"><a href="ptcld_process.html#cb78-12" tabindex="-1"></a>      , <span class="at">dtm_rast =</span> bhef_cloud2raster_ans<span class="sc">$</span>dtm_rast</span>
<span id="cb78-13"><a href="ptcld_process.html#cb78-13" tabindex="-1"></a>      , <span class="at">chm_rast =</span> bhef_cloud2raster_ans<span class="sc">$</span>chm_rast</span>
<span id="cb78-14"><a href="ptcld_process.html#cb78-14" tabindex="-1"></a>      , <span class="at">rgb_rast =</span> bhef_rgb_rast</span>
<span id="cb78-15"><a href="ptcld_process.html#cb78-15" tabindex="-1"></a>    )</span>
<span id="cb78-16"><a href="ptcld_process.html#cb78-16" tabindex="-1"></a>  )</span>
<span id="cb78-17"><a href="ptcld_process.html#cb78-17" tabindex="-1"></a><span class="co"># plt_list_rast_temp[[2]]</span></span></code></pre></div>
<p>combine the plots with <code>patchwork</code></p>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="ptcld_process.html#cb79-1" tabindex="-1"></a>patchwork<span class="sc">::</span><span class="fu">wrap_plots</span>(</span>
<span id="cb79-2"><a href="ptcld_process.html#cb79-2" tabindex="-1"></a>  plt_list_rast_temp</span>
<span id="cb79-3"><a href="ptcld_process.html#cb79-3" tabindex="-1"></a>  , <span class="at">ncol =</span> <span class="dv">2</span></span>
<span id="cb79-4"><a href="ptcld_process.html#cb79-4" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="slash_pile_detecting_files/figure-html/unnamed-chunk-88-1.png" alt="" width="1008" /></p>
</div>
</div>
<div id="arnf-ponderosa-pine-site-3" class="section level3 hasAnchor" number="3.1.4">
<h3><span class="header-section-number">3.1.4</span> ARNF Ponderosa Pine Site<a href="ptcld_process.html#arnf-ponderosa-pine-site-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>look at the summary of the point cloud data we’ll be processing</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="ptcld_process.html#cb80-1" tabindex="-1"></a><span class="co"># processing dirs</span></span>
<span id="cb80-2"><a href="ptcld_process.html#cb80-2" tabindex="-1"></a>c2t_out_dir_temp <span class="ot">&lt;-</span> <span class="st">&quot;../data/ARNF_DiamondView_202510/&quot;</span> <span class="co"># where do you want to save processed data to?</span></span>
<span id="cb80-3"><a href="ptcld_process.html#cb80-3" tabindex="-1"></a>out_dir_temp <span class="ot">&lt;-</span> <span class="fu">file.path</span>(c2t_out_dir_temp, <span class="fu">paste0</span>(<span class="st">&quot;point_cloud_processing_delivery_chm&quot;</span>,my_chm_res_m,<span class="st">&quot;m&quot;</span>) )</span>
<span id="cb80-4"><a href="ptcld_process.html#cb80-4" tabindex="-1"></a>las_dir_temp <span class="ot">&lt;-</span> <span class="st">&quot;F:/UAS_Collections/ARNF_DiamondView_202510/point_cloud_high_density&quot;</span> <span class="co"># where is the raw las</span></span>
<span id="cb80-5"><a href="ptcld_process.html#cb80-5" tabindex="-1"></a><span class="co"># read header with catalog</span></span>
<span id="cb80-6"><a href="ptcld_process.html#cb80-6" tabindex="-1"></a>lidR<span class="sc">::</span><span class="fu">readLAScatalog</span>(las_dir_temp)</span></code></pre></div>
<pre><code>## class       : LAScatalog (v1.2 format 3)
## extent      : 455073.8, 456582.3, 4535127, 4536067 (xmin, xmax, ymin, ymax)
## coord. ref. : WGS 84 / UTM zone 13N 
## area        : 1.24 km²
## points      : 1.37 billion points
## type        : airborne
## density     : 1102.8 points/m²
## density     : 39.9 pulses/m²
## num. files  : 44</code></pre>
<p>process the point cloud with the <code>cloud2trees::cloud2raster()</code> workflow</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="ptcld_process.html#cb82-1" tabindex="-1"></a><span class="co"># do it</span></span>
<span id="cb82-2"><a href="ptcld_process.html#cb82-2" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">dir.exists</span>(out_dir_temp)){</span>
<span id="cb82-3"><a href="ptcld_process.html#cb82-3" tabindex="-1"></a>  <span class="co"># cloud2trees</span></span>
<span id="cb82-4"><a href="ptcld_process.html#cb82-4" tabindex="-1"></a>  arnf_cloud2raster_ans <span class="ot">&lt;-</span> cloud2trees<span class="sc">::</span><span class="fu">cloud2raster</span>(</span>
<span id="cb82-5"><a href="ptcld_process.html#cb82-5" tabindex="-1"></a>    <span class="at">output_dir =</span> c2t_out_dir_temp</span>
<span id="cb82-6"><a href="ptcld_process.html#cb82-6" tabindex="-1"></a>    , <span class="at">input_las_dir =</span> las_dir_temp</span>
<span id="cb82-7"><a href="ptcld_process.html#cb82-7" tabindex="-1"></a>    , <span class="at">accuracy_level =</span> <span class="dv">2</span></span>
<span id="cb82-8"><a href="ptcld_process.html#cb82-8" tabindex="-1"></a>    , <span class="at">keep_intrmdt =</span> T</span>
<span id="cb82-9"><a href="ptcld_process.html#cb82-9" tabindex="-1"></a>    , <span class="at">dtm_res_m =</span> <span class="fl">0.2</span></span>
<span id="cb82-10"><a href="ptcld_process.html#cb82-10" tabindex="-1"></a>    , <span class="at">chm_res_m =</span> my_chm_res_m</span>
<span id="cb82-11"><a href="ptcld_process.html#cb82-11" tabindex="-1"></a>    , <span class="at">min_height =</span> <span class="dv">0</span> <span class="co"># effectively generates a DSM based on non-ground points</span></span>
<span id="cb82-12"><a href="ptcld_process.html#cb82-12" tabindex="-1"></a>  )</span>
<span id="cb82-13"><a href="ptcld_process.html#cb82-13" tabindex="-1"></a>  <span class="co"># rename</span></span>
<span id="cb82-14"><a href="ptcld_process.html#cb82-14" tabindex="-1"></a>  <span class="fu">file.rename</span>(<span class="at">from =</span> <span class="fu">file.path</span>(c2t_out_dir_temp,<span class="st">&quot;point_cloud_processing_delivery&quot;</span>), <span class="at">to =</span> out_dir_temp)</span>
<span id="cb82-15"><a href="ptcld_process.html#cb82-15" tabindex="-1"></a>}<span class="cf">else</span>{</span>
<span id="cb82-16"><a href="ptcld_process.html#cb82-16" tabindex="-1"></a>  dtm_temp <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rast</span>( <span class="fu">file.path</span>(out_dir_temp, <span class="st">&quot;dtm_0.2m.tif&quot;</span>) ) <span class="sc">%&gt;%</span> </span>
<span id="cb82-17"><a href="ptcld_process.html#cb82-17" tabindex="-1"></a>    terra<span class="sc">::</span><span class="fu">aggregate</span>(<span class="at">fact =</span> <span class="dv">2</span>, <span class="at">na.rm=</span>T, <span class="at">cores =</span> lasR<span class="sc">::</span><span class="fu">half_cores</span>())</span>
<span id="cb82-18"><a href="ptcld_process.html#cb82-18" tabindex="-1"></a>  chm_temp <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rast</span>( <span class="fu">file.path</span>(out_dir_temp, <span class="fu">paste0</span>(<span class="st">&quot;chm_&quot;</span>, my_chm_res_m,<span class="st">&quot;m.tif&quot;</span>)) )</span>
<span id="cb82-19"><a href="ptcld_process.html#cb82-19" tabindex="-1"></a>  <span class="co"># combine</span></span>
<span id="cb82-20"><a href="ptcld_process.html#cb82-20" tabindex="-1"></a>  arnf_cloud2raster_ans <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb82-21"><a href="ptcld_process.html#cb82-21" tabindex="-1"></a>    <span class="st">&quot;dtm_rast&quot;</span> <span class="ot">=</span> dtm_temp</span>
<span id="cb82-22"><a href="ptcld_process.html#cb82-22" tabindex="-1"></a>    , <span class="st">&quot;chm_rast&quot;</span> <span class="ot">=</span> chm_temp</span>
<span id="cb82-23"><a href="ptcld_process.html#cb82-23" tabindex="-1"></a>  )</span>
<span id="cb82-24"><a href="ptcld_process.html#cb82-24" tabindex="-1"></a>}</span></code></pre></div>
<p>let’s check out the DTM</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="ptcld_process.html#cb83-1" tabindex="-1"></a>arnf_cloud2raster_ans<span class="sc">$</span>dtm_rast <span class="sc">%&gt;%</span> </span>
<span id="cb83-2"><a href="ptcld_process.html#cb83-2" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">crop</span>(</span>
<span id="cb83-3"><a href="ptcld_process.html#cb83-3" tabindex="-1"></a>    arnf_stand_boundary <span class="sc">%&gt;%</span> </span>
<span id="cb83-4"><a href="ptcld_process.html#cb83-4" tabindex="-1"></a>    sf<span class="sc">::</span><span class="fu">st_buffer</span>(<span class="dv">22</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb83-5"><a href="ptcld_process.html#cb83-5" tabindex="-1"></a>    sf<span class="sc">::</span><span class="fu">st_transform</span>(terra<span class="sc">::</span><span class="fu">crs</span>(arnf_cloud2raster_ans<span class="sc">$</span>dtm_rast)) <span class="sc">%&gt;%</span> </span>
<span id="cb83-6"><a href="ptcld_process.html#cb83-6" tabindex="-1"></a>    terra<span class="sc">::</span><span class="fu">vect</span>()</span>
<span id="cb83-7"><a href="ptcld_process.html#cb83-7" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb83-8"><a href="ptcld_process.html#cb83-8" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">plot</span>(</span>
<span id="cb83-9"><a href="ptcld_process.html#cb83-9" tabindex="-1"></a>    <span class="at">col =</span> viridis<span class="sc">::</span><span class="fu">viridis</span>(<span class="at">n =</span> <span class="dv">100</span>)</span>
<span id="cb83-10"><a href="ptcld_process.html#cb83-10" tabindex="-1"></a>    , <span class="at">axes =</span> F</span>
<span id="cb83-11"><a href="ptcld_process.html#cb83-11" tabindex="-1"></a>    , <span class="at">main =</span> <span class="st">&quot;DTM (m)&quot;</span></span>
<span id="cb83-12"><a href="ptcld_process.html#cb83-12" tabindex="-1"></a>  )</span>
<span id="cb83-13"><a href="ptcld_process.html#cb83-13" tabindex="-1"></a><span class="co"># add stand boundary</span></span>
<span id="cb83-14"><a href="ptcld_process.html#cb83-14" tabindex="-1"></a>terra<span class="sc">::</span><span class="fu">plot</span>(</span>
<span id="cb83-15"><a href="ptcld_process.html#cb83-15" tabindex="-1"></a>  arnf_stand_boundary <span class="sc">%&gt;%</span> </span>
<span id="cb83-16"><a href="ptcld_process.html#cb83-16" tabindex="-1"></a>    sf<span class="sc">::</span><span class="fu">st_transform</span>(terra<span class="sc">::</span><span class="fu">crs</span>(arnf_cloud2raster_ans<span class="sc">$</span>dtm_rast)) <span class="sc">%&gt;%</span> </span>
<span id="cb83-17"><a href="ptcld_process.html#cb83-17" tabindex="-1"></a>    terra<span class="sc">::</span><span class="fu">vect</span>()</span>
<span id="cb83-18"><a href="ptcld_process.html#cb83-18" tabindex="-1"></a>  , <span class="at">add =</span> T, <span class="at">border =</span> <span class="st">&quot;black&quot;</span>, <span class="at">col =</span> <span class="cn">NA</span>, <span class="at">lwd =</span> <span class="fl">1.2</span></span>
<span id="cb83-19"><a href="ptcld_process.html#cb83-19" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="slash_pile_detecting_files/figure-html/unnamed-chunk-94-1.png" alt="" width="1008" /></p>
<p>and CHM</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="ptcld_process.html#cb84-1" tabindex="-1"></a>arnf_cloud2raster_ans<span class="sc">$</span>chm_rast <span class="sc">%&gt;%</span> </span>
<span id="cb84-2"><a href="ptcld_process.html#cb84-2" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">crop</span>(</span>
<span id="cb84-3"><a href="ptcld_process.html#cb84-3" tabindex="-1"></a>    arnf_stand_boundary <span class="sc">%&gt;%</span> </span>
<span id="cb84-4"><a href="ptcld_process.html#cb84-4" tabindex="-1"></a>    sf<span class="sc">::</span><span class="fu">st_buffer</span>(<span class="dv">22</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb84-5"><a href="ptcld_process.html#cb84-5" tabindex="-1"></a>    sf<span class="sc">::</span><span class="fu">st_transform</span>(terra<span class="sc">::</span><span class="fu">crs</span>(arnf_cloud2raster_ans<span class="sc">$</span>chm_rast)) <span class="sc">%&gt;%</span> </span>
<span id="cb84-6"><a href="ptcld_process.html#cb84-6" tabindex="-1"></a>    terra<span class="sc">::</span><span class="fu">vect</span>()</span>
<span id="cb84-7"><a href="ptcld_process.html#cb84-7" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb84-8"><a href="ptcld_process.html#cb84-8" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">aggregate</span>(<span class="at">fact =</span> <span class="dv">2</span>, <span class="at">na.rm =</span> T, <span class="at">cores =</span> lasR<span class="sc">::</span><span class="fu">half_cores</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb84-9"><a href="ptcld_process.html#cb84-9" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">plot</span>(</span>
<span id="cb84-10"><a href="ptcld_process.html#cb84-10" tabindex="-1"></a>    <span class="at">col =</span> viridis<span class="sc">::</span><span class="fu">plasma</span>(<span class="dv">100</span>)</span>
<span id="cb84-11"><a href="ptcld_process.html#cb84-11" tabindex="-1"></a>    , <span class="at">axes =</span> F</span>
<span id="cb84-12"><a href="ptcld_process.html#cb84-12" tabindex="-1"></a>    , <span class="at">main =</span> <span class="st">&quot;CHM (m)&quot;</span></span>
<span id="cb84-13"><a href="ptcld_process.html#cb84-13" tabindex="-1"></a>  )</span>
<span id="cb84-14"><a href="ptcld_process.html#cb84-14" tabindex="-1"></a><span class="co"># add stand boundary</span></span>
<span id="cb84-15"><a href="ptcld_process.html#cb84-15" tabindex="-1"></a>terra<span class="sc">::</span><span class="fu">plot</span>(</span>
<span id="cb84-16"><a href="ptcld_process.html#cb84-16" tabindex="-1"></a>  arnf_stand_boundary <span class="sc">%&gt;%</span> </span>
<span id="cb84-17"><a href="ptcld_process.html#cb84-17" tabindex="-1"></a>    sf<span class="sc">::</span><span class="fu">st_transform</span>(terra<span class="sc">::</span><span class="fu">crs</span>(arnf_cloud2raster_ans<span class="sc">$</span>chm_rast)) <span class="sc">%&gt;%</span> </span>
<span id="cb84-18"><a href="ptcld_process.html#cb84-18" tabindex="-1"></a>    terra<span class="sc">::</span><span class="fu">vect</span>()</span>
<span id="cb84-19"><a href="ptcld_process.html#cb84-19" tabindex="-1"></a>  , <span class="at">add =</span> T, <span class="at">border =</span> <span class="st">&quot;black&quot;</span>, <span class="at">col =</span> <span class="cn">NA</span>, <span class="at">lwd =</span> <span class="fl">1.2</span></span>
<span id="cb84-20"><a href="ptcld_process.html#cb84-20" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="slash_pile_detecting_files/figure-html/unnamed-chunk-95-1.png" alt="" width="1008" /></p>
<div id="dtm-and-chm-piles-3" class="section level4 hasAnchor" number="3.1.4.1">
<h4><span class="header-section-number">3.1.4.1</span> DTM and CHM + piles<a href="ptcld_process.html#dtm-and-chm-piles-3" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>let’s visually inspect the DTM and CHM with the pile outlines overlaid for a sample of piles</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="ptcld_process.html#cb85-1" tabindex="-1"></a><span class="co"># add pile locations</span></span>
<span id="cb85-2"><a href="ptcld_process.html#cb85-2" tabindex="-1"></a>plt_list_rast_temp <span class="ot">&lt;-</span> </span>
<span id="cb85-3"><a href="ptcld_process.html#cb85-3" tabindex="-1"></a>  <span class="dv">1</span><span class="sc">:</span><span class="fu">sum</span>(arnf_slash_piles_polys<span class="sc">$</span>is_in_stand) <span class="sc">%&gt;%</span> </span>
<span id="cb85-4"><a href="ptcld_process.html#cb85-4" tabindex="-1"></a>  <span class="fu">sample</span>(</span>
<span id="cb85-5"><a href="ptcld_process.html#cb85-5" tabindex="-1"></a>    <span class="fu">min</span>(<span class="dv">10</span>, <span class="fu">sum</span>(arnf_slash_piles_polys<span class="sc">$</span>is_in_stand))</span>
<span id="cb85-6"><a href="ptcld_process.html#cb85-6" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb85-7"><a href="ptcld_process.html#cb85-7" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">map</span>(</span>
<span id="cb85-8"><a href="ptcld_process.html#cb85-8" tabindex="-1"></a>    \(x) </span>
<span id="cb85-9"><a href="ptcld_process.html#cb85-9" tabindex="-1"></a>    <span class="fu">plt_rast_combine</span>(</span>
<span id="cb85-10"><a href="ptcld_process.html#cb85-10" tabindex="-1"></a>      <span class="at">rn =</span> x</span>
<span id="cb85-11"><a href="ptcld_process.html#cb85-11" tabindex="-1"></a>      , <span class="at">df =</span> arnf_slash_piles_polys <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(is_in_stand)</span>
<span id="cb85-12"><a href="ptcld_process.html#cb85-12" tabindex="-1"></a>      , <span class="at">dtm_rast =</span> arnf_cloud2raster_ans<span class="sc">$</span>dtm_rast</span>
<span id="cb85-13"><a href="ptcld_process.html#cb85-13" tabindex="-1"></a>      , <span class="at">chm_rast =</span> arnf_cloud2raster_ans<span class="sc">$</span>chm_rast</span>
<span id="cb85-14"><a href="ptcld_process.html#cb85-14" tabindex="-1"></a>      , <span class="at">rgb_rast =</span> arnf_rgb_rast</span>
<span id="cb85-15"><a href="ptcld_process.html#cb85-15" tabindex="-1"></a>    )</span>
<span id="cb85-16"><a href="ptcld_process.html#cb85-16" tabindex="-1"></a>  )</span>
<span id="cb85-17"><a href="ptcld_process.html#cb85-17" tabindex="-1"></a><span class="co"># plt_list_rast_temp[[2]]</span></span></code></pre></div>
<p>combine the plots with <code>patchwork</code></p>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="ptcld_process.html#cb86-1" tabindex="-1"></a>patchwork<span class="sc">::</span><span class="fu">wrap_plots</span>(</span>
<span id="cb86-2"><a href="ptcld_process.html#cb86-2" tabindex="-1"></a>  plt_list_rast_temp</span>
<span id="cb86-3"><a href="ptcld_process.html#cb86-3" tabindex="-1"></a>  , <span class="at">ncol =</span> <span class="dv">2</span></span>
<span id="cb86-4"><a href="ptcld_process.html#cb86-4" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="slash_pile_detecting_files/figure-html/unnamed-chunk-97-1.png" alt="" width="1008" /></p>
</div>
</div>
</div>
<div id="clean-up" class="section level2 hasAnchor" number="3.2">
<h2><span class="header-section-number">3.2</span> Clean Up<a href="ptcld_process.html#clean-up" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>going forward, we only need the CHM data, so we can drop the DTM data from our session</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="data_load.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="geom_detect.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
  "sharing": {
    "github": false,
    "facebook": true,
    "twitter": true,
    "linkedin": false,
    "weibo": false,
    "instapaper": false,
    "vk": false,
    "whatsapp": false,
    "all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
  },
  "fontsettings": {
    "theme": "white",
    "family": "sans",
    "size": 2
  },
  "edit": {
    "link": null,
    "text": null
  },
  "history": {
    "link": null,
    "text": null
  },
  "view": {
    "link": null,
    "text": null
  },
  "download": null,
  "search": {
    "engine": "fuse",
    "options": null
  },
  "toc": {
    "collapse": "subsection"
  }
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
