<!DOCTYPE html>
<html lang="en-US" xml:lang="en-US">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Section 8 CHM Raster Resolution Testing | Aerial Imagery and Point Cloud Data for Slash Pile Quantification</title>
  <meta name="description" content="Using the bookdown package to write a book of data exploration. The output format for this example is bookdown::gitbook." />
  <meta name="generator" content="bookdown 0.34 and GitBook 2.6.7" />

  <meta property="og:title" content="Section 8 CHM Raster Resolution Testing | Aerial Imagery and Point Cloud Data for Slash Pile Quantification" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="Using the bookdown package to write a book of data exploration. The output format for this example is bookdown::gitbook." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Section 8 CHM Raster Resolution Testing | Aerial Imagery and Point Cloud Data for Slash Pile Quantification" />
  
  <meta name="twitter:description" content="Using the bookdown package to write a book of data exploration. The output format for this example is bookdown::gitbook." />
  

<meta name="author" content="George Woolsey" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="wshed_params_test.html"/>
<link rel="next" href="stats_method.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<link href="libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet" />
<script src="libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/proj4-2.6.2/proj4.min.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.2.2/leaflet.js"></script>
<script src="libs/leaflet-providers-2.0.0/leaflet-providers_2.0.0.js"></script>
<script src="libs/leaflet-providers-plugin-2.2.2/leaflet-providers-plugin.js"></script>
<script src="libs/clipboard-0.0.1/setClipboardText.js"></script>
<link href="libs/mapviewCSS-0.0.1/mapview-popup.css" rel="stylesheet" />
<link href="libs/mapviewCSS-0.0.1/mapview.css" rel="stylesheet" />
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<link href="libs/bsTable-3.3.7/bootstrapTable.min.css" rel="stylesheet" />
<script src="libs/bsTable-3.3.7/bootstrapTable.js"></script>
<script src="libs/. - 1_9c1ae0-1/data_stars_1903d4b.txt"></script>
<script src="libs/joda-0.0.1/joda.js"></script>
<script src="libs/joda-0.0.1/addImageQuery-bindings.js"></script>
<script type="text/javascript">

// toggle visibility of R source blocks in R Markdown output
function toggle_R() {
  var x = document.getElementsByClassName('r');
  if (x.length == 0) return;
  function toggle_vis(o) {
    var d = o.style.display;
    o.style.display = (d == 'block' || d == '') ? 'none':'block';
  }

  for (i = 0; i < x.length; i++) {
    var y = x[i];
    if (y.tagName.toLowerCase() === 'pre') toggle_vis(y);
  }

    var elem = document.getElementById("myButton1");
    if (elem.value === "Hide Code") elem.value = "Show Code";
    else elem.value = "Hide Code";
}

document.write('<input onclick="toggle_R();" type="button" value="Hide Code" id="myButton1" style="position: absolute; top: 10%; right: 2%; z-index: 200"></input>')

</script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#objective"><i class="fa fa-check"></i><b>1.1</b> Objective</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#data_desc"><i class="fa fa-check"></i><b>1.2</b> Data</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#analysis-plan"><i class="fa fa-check"></i><b>1.3</b> Analysis Plan</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="training-data.html"><a href="training-data.html"><i class="fa fa-check"></i><b>2</b> Training Data</a>
<ul>
<li class="chapter" data-level="2.1" data-path="training-data.html"><a href="training-data.html#slash-pile-vector-data"><i class="fa fa-check"></i><b>2.1</b> Slash Pile Vector Data</a></li>
<li class="chapter" data-level="2.2" data-path="training-data.html"><a href="training-data.html#rgb-orthomosaic"><i class="fa fa-check"></i><b>2.2</b> RGB orthomosaic</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="training-data.html"><a href="training-data.html#example-ratio-based-index"><i class="fa fa-check"></i><b>2.2.1</b> Example ratio-based index</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="training-data.html"><a href="training-data.html#study-area-imagery"><i class="fa fa-check"></i><b>2.3</b> Study area imagery</a></li>
<li class="chapter" data-level="2.4" data-path="training-data.html"><a href="training-data.html#point-cloud-data"><i class="fa fa-check"></i><b>2.4</b> Point Cloud Data</a></li>
<li class="chapter" data-level="2.5" data-path="training-data.html"><a href="training-data.html#check-out-one-pile"><i class="fa fa-check"></i><b>2.5</b> Check out one pile</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="method-evaluation.html"><a href="method-evaluation.html"><i class="fa fa-check"></i><b>3</b> Method Evaluation</a>
<ul>
<li class="chapter" data-level="3.1" data-path="method-evaluation.html"><a href="method-evaluation.html#iou_match"><i class="fa fa-check"></i><b>3.1</b> Instance Matching</a></li>
<li class="chapter" data-level="3.2" data-path="method-evaluation.html"><a href="method-evaluation.html#detect_metrics_form"><i class="fa fa-check"></i><b>3.2</b> Detection Accuracy Metrics</a></li>
<li class="chapter" data-level="3.3" data-path="method-evaluation.html"><a href="method-evaluation.html#quant_metrics_form"><i class="fa fa-check"></i><b>3.3</b> Quantification Accuracy Metrics</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="ptcld_process.html"><a href="ptcld_process.html"><i class="fa fa-check"></i><b>4</b> Point Cloud Processing and Pile Segmentation</a>
<ul>
<li class="chapter" data-level="4.1" data-path="ptcld_process.html"><a href="ptcld_process.html#process-raw-point-cloud"><i class="fa fa-check"></i><b>4.1</b> Process Raw Point Cloud</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="ptcld_process.html"><a href="ptcld_process.html#dtm-and-chm-piles"><i class="fa fa-check"></i><b>4.1.1</b> DTM and CHM + piles</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="raster_watershed.html"><a href="raster_watershed.html"><i class="fa fa-check"></i><b>5</b> Structural Detection from CHM</a>
<ul>
<li class="chapter" data-level="5.1" data-path="raster_watershed.html"><a href="raster_watershed.html#method-demonstration"><i class="fa fa-check"></i><b>5.1</b> Method Demonstration</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="raster_watershed.html"><a href="raster_watershed.html#geometric-filtering-irregularity-filtering"><i class="fa fa-check"></i><b>5.1.1</b> Geometric filtering: Irregularity Filtering</a></li>
<li class="chapter" data-level="5.1.2" data-path="raster_watershed.html"><a href="raster_watershed.html#area-filtering"><i class="fa fa-check"></i><b>5.1.2</b> Area Filtering</a></li>
<li class="chapter" data-level="5.1.3" data-path="raster_watershed.html"><a href="raster_watershed.html#geometric-filtering-circularity-filtering"><i class="fa fa-check"></i><b>5.1.3</b> Geometric filtering: Circularity Filtering</a></li>
<li class="chapter" data-level="5.1.4" data-path="raster_watershed.html"><a href="raster_watershed.html#area-and-volume-from-chm"><i class="fa fa-check"></i><b>5.1.4</b> Area and Volume from CHM</a></li>
<li class="chapter" data-level="5.1.5" data-path="raster_watershed.html"><a href="raster_watershed.html#shape-refinement"><i class="fa fa-check"></i><b>5.1.5</b> Shape Refinement</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="raster_watershed.html"><a href="raster_watershed.html#instance-matching"><i class="fa fa-check"></i><b>5.2</b> Instance Matching</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="raster_watershed.html"><a href="raster_watershed.html#example-area"><i class="fa fa-check"></i><b>5.2.1</b> Example Area</a></li>
<li class="chapter" data-level="5.2.2" data-path="raster_watershed.html"><a href="raster_watershed.html#full-study-area"><i class="fa fa-check"></i><b>5.2.2</b> Full Study Area</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="raster_watershed.html"><a href="raster_watershed.html#slash_pile_detect_watershed"><i class="fa fa-check"></i><b>5.3</b> Watershed Pile Detection Function</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="data_fusion.html"><a href="data_fusion.html"><i class="fa fa-check"></i><b>6</b> Data Fusion</a>
<ul>
<li class="chapter" data-level="6.1" data-path="data_fusion.html"><a href="data_fusion.html#rgb-indices"><i class="fa fa-check"></i><b>6.1</b> RGB Indices</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="data_fusion.html"><a href="data_fusion.html#spectral-index-functions"><i class="fa fa-check"></i><b>6.1.1</b> Spectral Index Functions</a></li>
<li class="chapter" data-level="6.1.2" data-path="data_fusion.html"><a href="data_fusion.html#spectral-index-of-polygons"><i class="fa fa-check"></i><b>6.1.2</b> Spectral Index of Polygons</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="data_fusion.html"><a href="data_fusion.html#ground-truth-pile-spectral-summary"><i class="fa fa-check"></i><b>6.2</b> Ground Truth Pile Spectral Summary</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="data_fusion.html"><a href="data_fusion.html#voting-system"><i class="fa fa-check"></i><b>6.2.1</b> Voting System</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="data_fusion.html"><a href="data_fusion.html#polygon_spectral_filtering"><i class="fa fa-check"></i><b>6.3</b> Candidate Polygon Spectral Filtering Function</a></li>
<li class="chapter" data-level="6.4" data-path="data_fusion.html"><a href="data_fusion.html#data-fusion-example"><i class="fa fa-check"></i><b>6.4</b> Data Fusion Example</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="data_fusion.html"><a href="data_fusion.html#instance-matching-1"><i class="fa fa-check"></i><b>6.4.1</b> Instance Matching</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="wshed_params_test.html"><a href="wshed_params_test.html"><i class="fa fa-check"></i><b>7</b> Sensitivity Testing</a>
<ul>
<li class="chapter" data-level="7.1" data-path="wshed_params_test.html"><a href="wshed_params_test.html#all_the_combos"><i class="fa fa-check"></i><b>7.1</b> Workflow over parameter combinations</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="wshed_params_test.html"><a href="wshed_params_test.html#test-workflow"><i class="fa fa-check"></i><b>7.1.1</b> Test Workflow</a></li>
<li class="chapter" data-level="7.1.2" data-path="wshed_params_test.html"><a href="wshed_params_test.html#test-instance-matching"><i class="fa fa-check"></i><b>7.1.2</b> Test Instance Matching</a></li>
<li class="chapter" data-level="7.1.3" data-path="wshed_params_test.html"><a href="wshed_params_test.html#test-accuracy"><i class="fa fa-check"></i><b>7.1.3</b> Test Accuracy</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="chm-raster-resolution-testing.html"><a href="chm-raster-resolution-testing.html"><i class="fa fa-check"></i><b>8</b> CHM Raster Resolution Testing</a>
<ul>
<li class="chapter" data-level="8.1" data-path="chm-raster-resolution-testing.html"><a href="chm-raster-resolution-testing.html#process-raw-point-cloud-1"><i class="fa fa-check"></i><b>8.1</b> Process Raw Point Cloud</a></li>
<li class="chapter" data-level="8.2" data-path="chm-raster-resolution-testing.html"><a href="chm-raster-resolution-testing.html#structural-only-parameter-testing"><i class="fa fa-check"></i><b>8.2</b> Structural Only: Parameter Testing</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="chm-raster-resolution-testing.html"><a href="chm-raster-resolution-testing.html#validation-over-parameter-combinations"><i class="fa fa-check"></i><b>8.2.1</b> Validation over parameter combinations</a></li>
<li class="chapter" data-level="8.2.2" data-path="chm-raster-resolution-testing.html"><a href="chm-raster-resolution-testing.html#aggregate-validation-metrics-to-parameter-combination"><i class="fa fa-check"></i><b>8.2.2</b> Aggregate Validation Metrics to Parameter Combination</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="chm-raster-resolution-testing.html"><a href="chm-raster-resolution-testing.html#data-fusion-parameter-testing"><i class="fa fa-check"></i><b>8.3</b> Data Fusion: Parameter Testing</a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="chm-raster-resolution-testing.html"><a href="chm-raster-resolution-testing.html#aggregate-validation-metrics-to-parameter-combination-1"><i class="fa fa-check"></i><b>8.3.1</b> Aggregate Validation Metrics to Parameter Combination</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="chm-raster-resolution-testing.html"><a href="chm-raster-resolution-testing.html#read-data-for-analysis"><i class="fa fa-check"></i><b>8.4</b> Read Data for Analysis</a>
<ul>
<li class="chapter" data-level="8.4.1" data-path="chm-raster-resolution-testing.html"><a href="chm-raster-resolution-testing.html#structural-only"><i class="fa fa-check"></i><b>8.4.1</b> Structural Only</a></li>
<li class="chapter" data-level="8.4.2" data-path="chm-raster-resolution-testing.html"><a href="chm-raster-resolution-testing.html#data-fusion"><i class="fa fa-check"></i><b>8.4.2</b> Data Fusion</a></li>
</ul></li>
<li class="chapter" data-level="8.5" data-path="chm-raster-resolution-testing.html"><a href="chm-raster-resolution-testing.html#allthetests"><i class="fa fa-check"></i><b>8.5</b> Structural Only: Sensitivity Testing</a>
<ul>
<li class="chapter" data-level="8.5.1" data-path="chm-raster-resolution-testing.html"><a href="chm-raster-resolution-testing.html#detect_trends"><i class="fa fa-check"></i><b>8.5.1</b> Main Effects: pile detection</a></li>
<li class="chapter" data-level="8.5.2" data-path="chm-raster-resolution-testing.html"><a href="chm-raster-resolution-testing.html#quant_trends"><i class="fa fa-check"></i><b>8.5.2</b> Main Effects: form quantification</a></li>
<li class="chapter" data-level="8.5.3" data-path="chm-raster-resolution-testing.html"><a href="chm-raster-resolution-testing.html#final-recommended-settings"><i class="fa fa-check"></i><b>8.5.3</b> Final recommended settings</a></li>
</ul></li>
<li class="chapter" data-level="8.6" data-path="chm-raster-resolution-testing.html"><a href="chm-raster-resolution-testing.html#data-fusion-sensitivity-testing"><i class="fa fa-check"></i><b>8.6</b> Data Fusion: Sensitivity Testing</a>
<ul>
<li class="chapter" data-level="8.6.1" data-path="chm-raster-resolution-testing.html"><a href="chm-raster-resolution-testing.html#main-effects-pile-detection"><i class="fa fa-check"></i><b>8.6.1</b> Main Effects: pile detection</a></li>
<li class="chapter" data-level="8.6.2" data-path="chm-raster-resolution-testing.html"><a href="chm-raster-resolution-testing.html#main-effects-form-quantification"><i class="fa fa-check"></i><b>8.6.2</b> Main Effects: form quantification</a></li>
<li class="chapter" data-level="8.6.3" data-path="chm-raster-resolution-testing.html"><a href="chm-raster-resolution-testing.html#balanced_acc_assess"><i class="fa fa-check"></i><b>8.6.3</b> Final recommended settings</a></li>
</ul></li>
<li class="chapter" data-level="8.7" data-path="chm-raster-resolution-testing.html"><a href="chm-raster-resolution-testing.html#save-the-data"><i class="fa fa-check"></i><b>8.7</b> save the data</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="stats_method.html"><a href="stats_method.html"><i class="fa fa-check"></i><b>9</b> Statistical Testing of Method Settings</a>
<ul>
<li class="chapter" data-level="9.1" data-path="stats_method.html"><a href="stats_method.html#bayesian-generalized-linear-model---f-score"><i class="fa fa-check"></i><b>9.1</b> Bayesian generalized linear model - F-score</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="stats_method.html"><a href="stats_method.html#model-selection"><i class="fa fa-check"></i><b>9.1.1</b> Model selection</a></li>
<li class="chapter" data-level="9.1.2" data-path="stats_method.html"><a href="stats_method.html#modeling"><i class="fa fa-check"></i><b>9.1.2</b> Modeling</a></li>
<li class="chapter" data-level="9.1.3" data-path="stats_method.html"><a href="stats_method.html#posterior-predictive-checks"><i class="fa fa-check"></i><b>9.1.3</b> Posterior Predictive Checks</a></li>
<li class="chapter" data-level="9.1.4" data-path="stats_method.html"><a href="stats_method.html#conditional-effects"><i class="fa fa-check"></i><b>9.1.4</b> Conditional Effects</a></li>
<li class="chapter" data-level="9.1.5" data-path="stats_method.html"><a href="stats_method.html#posterior-predictive-expectation"><i class="fa fa-check"></i><b>9.1.5</b> Posterior Predictive Expectation</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="stats_method.html"><a href="stats_method.html#mod_diam_mape"><i class="fa fa-check"></i><b>9.2</b> Bayesian generalized linear model - Diameter MAPE</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="stats_method.html"><a href="stats_method.html#model-selection-1"><i class="fa fa-check"></i><b>9.2.1</b> Model selection</a></li>
<li class="chapter" data-level="9.2.2" data-path="stats_method.html"><a href="stats_method.html#modeling-1"><i class="fa fa-check"></i><b>9.2.2</b> Modeling</a></li>
<li class="chapter" data-level="9.2.3" data-path="stats_method.html"><a href="stats_method.html#posterior-predictive-checks-1"><i class="fa fa-check"></i><b>9.2.3</b> Posterior Predictive Checks</a></li>
<li class="chapter" data-level="9.2.4" data-path="stats_method.html"><a href="stats_method.html#conditional-effects-1"><i class="fa fa-check"></i><b>9.2.4</b> Conditional Effects</a></li>
<li class="chapter" data-level="9.2.5" data-path="stats_method.html"><a href="stats_method.html#posterior-predictive-expectation-1"><i class="fa fa-check"></i><b>9.2.5</b> Posterior Predictive Expectation</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="stats_method.html"><a href="stats_method.html#bayesian-generalized-linear-model---height-mape"><i class="fa fa-check"></i><b>9.3</b> Bayesian generalized linear model - Height MAPE</a>
<ul>
<li class="chapter" data-level="9.3.1" data-path="stats_method.html"><a href="stats_method.html#model-selection-2"><i class="fa fa-check"></i><b>9.3.1</b> Model selection</a></li>
<li class="chapter" data-level="9.3.2" data-path="stats_method.html"><a href="stats_method.html#modeling-2"><i class="fa fa-check"></i><b>9.3.2</b> Modeling</a></li>
<li class="chapter" data-level="9.3.3" data-path="stats_method.html"><a href="stats_method.html#posterior-predictive-checks-2"><i class="fa fa-check"></i><b>9.3.3</b> Posterior Predictive Checks</a></li>
<li class="chapter" data-level="9.3.4" data-path="stats_method.html"><a href="stats_method.html#conditional-effects-2"><i class="fa fa-check"></i><b>9.3.4</b> Conditional Effects</a></li>
<li class="chapter" data-level="9.3.5" data-path="stats_method.html"><a href="stats_method.html#posterior-predictive-expectation-2"><i class="fa fa-check"></i><b>9.3.5</b> Posterior Predictive Expectation</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="stats_method.html"><a href="stats_method.html#balanced-accuracy-bayesian-optimization"><i class="fa fa-check"></i><b>9.4</b> Balanced Accuracy Bayesian Optimization</a>
<ul>
<li class="chapter" data-level="9.4.1" data-path="stats_method.html"><a href="stats_method.html#balanced-accuracy-selection"><i class="fa fa-check"></i><b>9.4.1</b> Balanced Accuracy Selection</a></li>
<li class="chapter" data-level="9.4.2" data-path="stats_method.html"><a href="stats_method.html#overall-across-chm-resolution-2"><i class="fa fa-check"></i><b>9.4.2</b> Overall (across CHM resolution)</a></li>
<li class="chapter" data-level="9.4.3" data-path="stats_method.html"><a href="stats_method.html#by-chm-resolution-2"><i class="fa fa-check"></i><b>9.4.3</b> by CHM resolution</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="method-validation.html"><a href="method-validation.html"><i class="fa fa-check"></i><b>10</b> Method Validation</a>
<ul>
<li class="chapter" data-level="10.1" data-path="method-validation.html"><a href="method-validation.html#data-processing"><i class="fa fa-check"></i><b>10.1</b> Data Processing</a>
<ul>
<li class="chapter" data-level="10.1.1" data-path="method-validation.html"><a href="method-validation.html#vector-data"><i class="fa fa-check"></i><b>10.1.1</b> Vector Data</a></li>
<li class="chapter" data-level="10.1.2" data-path="method-validation.html"><a href="method-validation.html#rgb-data"><i class="fa fa-check"></i><b>10.1.2</b> RGB Data</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="method-validation.html"><a href="method-validation.html#process-raw-point-cloud-2"><i class="fa fa-check"></i><b>10.2</b> Process Raw Point Cloud</a></li>
<li class="chapter" data-level="10.3" data-path="method-validation.html"><a href="method-validation.html#pile-detection"><i class="fa fa-check"></i><b>10.3</b> Pile Detection</a>
<ul>
<li class="chapter" data-level="10.3.1" data-path="method-validation.html"><a href="method-validation.html#structural-candidate-segments"><i class="fa fa-check"></i><b>10.3.1</b> Structural Candidate Segments</a></li>
<li class="chapter" data-level="10.3.2" data-path="method-validation.html"><a href="method-validation.html#spect_filtering_final"><i class="fa fa-check"></i><b>10.3.2</b> Spectral Filtering of Candidate Segments</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="method-validation.html"><a href="method-validation.html#detection-and-quantification-accuracy"><i class="fa fa-check"></i><b>10.4</b> Detection and Quantification Accuracy</a>
<ul>
<li class="chapter" data-level="10.4.1" data-path="method-validation.html"><a href="method-validation.html#instance-matching-2"><i class="fa fa-check"></i><b>10.4.1</b> Instance matching</a></li>
<li class="chapter" data-level="10.4.2" data-path="method-validation.html"><a href="method-validation.html#overall-stand-level"><i class="fa fa-check"></i><b>10.4.2</b> Overall (stand level)</a></li>
<li class="chapter" data-level="10.4.3" data-path="method-validation.html"><a href="method-validation.html#instance-level-pile-level"><i class="fa fa-check"></i><b>10.4.3</b> Instance level (pile level)</a></li>
</ul></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Aerial Imagery and Point Cloud Data for Slash Pile Quantification</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="chm-raster-resolution-testing" class="section level1 hasAnchor" number="8">
<h1><span class="header-section-number">Section 8</span> CHM Raster Resolution Testing<a href="chm-raster-resolution-testing.html#chm-raster-resolution-testing" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>In this prior <a href="ptcld_process.html#ptcld_process">section</a> we demonstrated how to use <code>cloud2trees::cloud2raster()</code> to process the raw point cloud data to generate the CHM (a DSM with the ground removed) for our raster-based watershed segmentation methodology. The <code>cloud2trees</code> package makes it easy to process raw point cloud data to generate a CHM at practically any resolution from coarse to fine grain. We performed sensitivity testing of our slash pile detection method using only a single CHM raster resolution. What is the influence of different raster resolution on the ability of the method to accurately detect and quantify piles?</p>
<div id="process-raw-point-cloud-1" class="section level2 hasAnchor" number="8.1">
<h2><span class="header-section-number">8.1</span> Process Raw Point Cloud<a href="chm-raster-resolution-testing.html#process-raw-point-cloud-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We’ll use <code>cloud2trees::cloud2raster()</code> to process the raw point cloud data to generate a set of CHM rasters at varying resolutions</p>
<div class="sourceCode" id="cb220"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb220-1"><a href="chm-raster-resolution-testing.html#cb220-1" tabindex="-1"></a>chm_res_list <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from=</span><span class="fl">0.10</span>,<span class="at">to=</span><span class="fl">0.50</span>,<span class="at">by=</span><span class="fl">0.1</span>)</span>
<span id="cb220-2"><a href="chm-raster-resolution-testing.html#cb220-2" tabindex="-1"></a><span class="co"># process point clouds</span></span>
<span id="cb220-3"><a href="chm-raster-resolution-testing.html#cb220-3" tabindex="-1"></a>chm_res_list <span class="sc">%&gt;%</span> </span>
<span id="cb220-4"><a href="chm-raster-resolution-testing.html#cb220-4" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">map</span>(<span class="cf">function</span>(chm_res_m){</span>
<span id="cb220-5"><a href="chm-raster-resolution-testing.html#cb220-5" tabindex="-1"></a>    <span class="fu">message</span>(<span class="fu">paste0</span>(<span class="st">&quot;CHMing...........&quot;</span>,chm_res_m))</span>
<span id="cb220-6"><a href="chm-raster-resolution-testing.html#cb220-6" tabindex="-1"></a>    dir_temp <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&quot;../data/point_cloud_processing_delivery_chm&quot;</span>,chm_res_m,<span class="st">&quot;m&quot;</span>)</span>
<span id="cb220-7"><a href="chm-raster-resolution-testing.html#cb220-7" tabindex="-1"></a>    <span class="co"># do it</span></span>
<span id="cb220-8"><a href="chm-raster-resolution-testing.html#cb220-8" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span><span class="fu">dir.exists</span>(dir_temp)){</span>
<span id="cb220-9"><a href="chm-raster-resolution-testing.html#cb220-9" tabindex="-1"></a>      <span class="co"># cloud2trees</span></span>
<span id="cb220-10"><a href="chm-raster-resolution-testing.html#cb220-10" tabindex="-1"></a>      cloud2raster_ans <span class="ot">&lt;-</span> cloud2trees<span class="sc">::</span><span class="fu">cloud2raster</span>(</span>
<span id="cb220-11"><a href="chm-raster-resolution-testing.html#cb220-11" tabindex="-1"></a>        <span class="at">output_dir =</span> <span class="st">&quot;../data&quot;</span></span>
<span id="cb220-12"><a href="chm-raster-resolution-testing.html#cb220-12" tabindex="-1"></a>        , <span class="at">input_las_dir =</span> <span class="st">&quot;f:</span><span class="sc">\\</span><span class="st">PFDP_Data</span><span class="sc">\\</span><span class="st">p4pro_images</span><span class="sc">\\</span><span class="st">P4Pro_06_17_2021_half_half_optimal</span><span class="sc">\\</span><span class="st">2_densification</span><span class="sc">\\</span><span class="st">point_cloud&quot;</span></span>
<span id="cb220-13"><a href="chm-raster-resolution-testing.html#cb220-13" tabindex="-1"></a>        , <span class="at">accuracy_level =</span> <span class="dv">2</span></span>
<span id="cb220-14"><a href="chm-raster-resolution-testing.html#cb220-14" tabindex="-1"></a>        , <span class="at">keep_intrmdt =</span> T</span>
<span id="cb220-15"><a href="chm-raster-resolution-testing.html#cb220-15" tabindex="-1"></a>        , <span class="at">dtm_res_m =</span> <span class="fl">0.25</span></span>
<span id="cb220-16"><a href="chm-raster-resolution-testing.html#cb220-16" tabindex="-1"></a>        , <span class="at">chm_res_m =</span> chm_res_m</span>
<span id="cb220-17"><a href="chm-raster-resolution-testing.html#cb220-17" tabindex="-1"></a>        , <span class="at">min_height =</span> <span class="dv">0</span> <span class="co"># effectively generates a DSM based on non-ground points</span></span>
<span id="cb220-18"><a href="chm-raster-resolution-testing.html#cb220-18" tabindex="-1"></a>      )</span>
<span id="cb220-19"><a href="chm-raster-resolution-testing.html#cb220-19" tabindex="-1"></a>      <span class="co"># rename</span></span>
<span id="cb220-20"><a href="chm-raster-resolution-testing.html#cb220-20" tabindex="-1"></a>      <span class="fu">file.rename</span>(<span class="at">from =</span> <span class="st">&quot;../data/point_cloud_processing_delivery&quot;</span>, <span class="at">to =</span> dir_temp)</span>
<span id="cb220-21"><a href="chm-raster-resolution-testing.html#cb220-21" tabindex="-1"></a>    }    </span>
<span id="cb220-22"><a href="chm-raster-resolution-testing.html#cb220-22" tabindex="-1"></a>  })</span>
<span id="cb220-23"><a href="chm-raster-resolution-testing.html#cb220-23" tabindex="-1"></a><span class="co"># which dirs?</span></span>
<span id="cb220-24"><a href="chm-raster-resolution-testing.html#cb220-24" tabindex="-1"></a>chm_res_list[</span>
<span id="cb220-25"><a href="chm-raster-resolution-testing.html#cb220-25" tabindex="-1"></a>  chm_res_list <span class="sc">%&gt;%</span></span>
<span id="cb220-26"><a href="chm-raster-resolution-testing.html#cb220-26" tabindex="-1"></a>    purrr<span class="sc">::</span><span class="fu">map</span>(<span class="sc">~</span><span class="fu">paste0</span>(<span class="st">&quot;../data/point_cloud_processing_delivery_chm&quot;</span>,.x,<span class="st">&quot;m&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb220-27"><a href="chm-raster-resolution-testing.html#cb220-27" tabindex="-1"></a>    <span class="fu">unlist</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb220-28"><a href="chm-raster-resolution-testing.html#cb220-28" tabindex="-1"></a>    <span class="fu">dir.exists</span>()</span>
<span id="cb220-29"><a href="chm-raster-resolution-testing.html#cb220-29" tabindex="-1"></a>]</span></code></pre></div>
</div>
<div id="structural-only-parameter-testing" class="section level2 hasAnchor" number="8.2">
<h2><span class="header-section-number">8.2</span> Structural Only: Parameter Testing<a href="chm-raster-resolution-testing.html#structural-only-parameter-testing" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>we could simply map these combinations over our <code>slash_pile_detect_watershed()</code> function we reviewed in this <a href="raster_watershed.html#slash_pile_detect_watershed">prior section</a>, but that would entail performing the same action multiple times. we defined a specialized function to efficiently map over all of these combinations in this <a href="wshed_params_test.html#all_the_combos">section</a> to obtain pile predictions based on the different settings.</p>
<p>let’s test different parameter combinations of our watershed segmentation, rules-based slash pile detection methodology for each CHM raster resolution from more coarse, to finer resolution</p>
<div class="sourceCode" id="cb221"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb221-1"><a href="chm-raster-resolution-testing.html#cb221-1" tabindex="-1"></a>param_combos_df <span class="ot">&lt;-</span></span>
<span id="cb221-2"><a href="chm-raster-resolution-testing.html#cb221-2" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">crossing</span>(</span>
<span id="cb221-3"><a href="chm-raster-resolution-testing.html#cb221-3" tabindex="-1"></a>    <span class="at">max_ht_m =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">2</span>, <span class="at">to =</span>  <span class="dv">5</span>, <span class="at">by =</span> <span class="dv">1</span>) <span class="co"># set the max expected pile height (could also do a minimum??)</span></span>
<span id="cb221-4"><a href="chm-raster-resolution-testing.html#cb221-4" tabindex="-1"></a>    , <span class="at">min_area_m2 =</span> <span class="fu">c</span>(<span class="dv">2</span>) <span class="co"># seq(from = 1, to =  2, by = 1) # set the min expected pile area</span></span>
<span id="cb221-5"><a href="chm-raster-resolution-testing.html#cb221-5" tabindex="-1"></a>    , <span class="at">max_area_m2 =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">10</span>, <span class="at">to =</span> <span class="dv">60</span>, <span class="at">by =</span> <span class="dv">10</span>) <span class="co"># set the max expected pile area</span></span>
<span id="cb221-6"><a href="chm-raster-resolution-testing.html#cb221-6" tabindex="-1"></a>    , <span class="at">convexity_pct =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fl">0.05</span>, <span class="at">to =</span> <span class="fl">0.95</span>, <span class="at">length.out =</span> <span class="dv">7</span>) <span class="co"># min required overlap between the predicted pile and the convex hull of the predicted pile</span></span>
<span id="cb221-7"><a href="chm-raster-resolution-testing.html#cb221-7" tabindex="-1"></a>    , <span class="at">circle_fit_iou_pct =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fl">0.05</span>, <span class="at">to =</span> <span class="fl">0.95</span>, <span class="at">length.out =</span> <span class="dv">7</span>) </span>
<span id="cb221-8"><a href="chm-raster-resolution-testing.html#cb221-8" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb221-9"><a href="chm-raster-resolution-testing.html#cb221-9" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">rn =</span> dplyr<span class="sc">::</span><span class="fu">row_number</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb221-10"><a href="chm-raster-resolution-testing.html#cb221-10" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">relocate</span>(rn)</span>
<span id="cb221-11"><a href="chm-raster-resolution-testing.html#cb221-11" tabindex="-1"></a><span class="co"># param_combos_df %&gt;% dplyr::glimpse()</span></span>
<span id="cb221-12"><a href="chm-raster-resolution-testing.html#cb221-12" tabindex="-1"></a><span class="co"># param_combos_df %&gt;% dplyr::count(convexity_pct)</span></span>
<span id="cb221-13"><a href="chm-raster-resolution-testing.html#cb221-13" tabindex="-1"></a><span class="co"># param_combos_df %&gt;% dplyr::count(circle_fit_iou_pct)</span></span>
<span id="cb221-14"><a href="chm-raster-resolution-testing.html#cb221-14" tabindex="-1"></a><span class="co"># seq(from = 0.05, to = 0.95, length.out = 7)</span></span>
<span id="cb221-15"><a href="chm-raster-resolution-testing.html#cb221-15" tabindex="-1"></a></span>
<span id="cb221-16"><a href="chm-raster-resolution-testing.html#cb221-16" tabindex="-1"></a><span class="co"># how many combos are we testing?</span></span>
<span id="cb221-17"><a href="chm-raster-resolution-testing.html#cb221-17" tabindex="-1"></a>n_combos_tested_chm <span class="ot">&lt;-</span> <span class="fu">nrow</span>(param_combos_df) <span class="co">#combos per chm</span></span>
<span id="cb221-18"><a href="chm-raster-resolution-testing.html#cb221-18" tabindex="-1"></a>n_combos_tested <span class="ot">&lt;-</span> <span class="fu">length</span>(chm_res_list)<span class="sc">*</span>n_combos_tested_chm <span class="co">#combos overall structural only</span></span>
<span id="cb221-19"><a href="chm-raster-resolution-testing.html#cb221-19" tabindex="-1"></a><span class="co"># there are 5 spectral_weight settings + no spectral data (spectral_weight=0) = 6</span></span>
<span id="cb221-20"><a href="chm-raster-resolution-testing.html#cb221-20" tabindex="-1"></a>spectral_settings_tested <span class="ot">&lt;-</span> <span class="dv">6</span></span>
<span id="cb221-21"><a href="chm-raster-resolution-testing.html#cb221-21" tabindex="-1"></a><span class="co"># how many combos overall is this for the spectral testing?</span></span>
<span id="cb221-22"><a href="chm-raster-resolution-testing.html#cb221-22" tabindex="-1"></a>n_combos_tested_spectral <span class="ot">&lt;-</span> n_combos_tested<span class="sc">*</span>spectral_settings_tested </span>
<span id="cb221-23"><a href="chm-raster-resolution-testing.html#cb221-23" tabindex="-1"></a><span class="co"># how many combos PER CHM is this for the spectral testing?</span></span>
<span id="cb221-24"><a href="chm-raster-resolution-testing.html#cb221-24" tabindex="-1"></a>n_combos_tested_spectral_chm <span class="ot">&lt;-</span> n_combos_tested_chm<span class="sc">*</span>spectral_settings_tested</span></code></pre></div>
<p>map over each CHM raster for pile detection using each of these parameter combinations</p>
<div class="sourceCode" id="cb222"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb222-1"><a href="chm-raster-resolution-testing.html#cb222-1" tabindex="-1"></a>param_combos_piles_flist <span class="ot">&lt;-</span> chm_res_list <span class="sc">%&gt;%</span> </span>
<span id="cb222-2"><a href="chm-raster-resolution-testing.html#cb222-2" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">map</span>(<span class="cf">function</span>(chm_res_m){</span>
<span id="cb222-3"><a href="chm-raster-resolution-testing.html#cb222-3" tabindex="-1"></a>    <span class="fu">message</span>(<span class="fu">paste0</span>(<span class="st">&quot;param_combos_piles_detect_fn...........&quot;</span>,chm_res_m))</span>
<span id="cb222-4"><a href="chm-raster-resolution-testing.html#cb222-4" tabindex="-1"></a>    <span class="co"># file</span></span>
<span id="cb222-5"><a href="chm-raster-resolution-testing.html#cb222-5" tabindex="-1"></a>    f_temp <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">&quot;../data&quot;</span>,<span class="fu">paste0</span>(<span class="st">&quot;param_combos_piles_chm&quot;</span>,chm_res_m,<span class="st">&quot;m.gpkg&quot;</span>))</span>
<span id="cb222-6"><a href="chm-raster-resolution-testing.html#cb222-6" tabindex="-1"></a>    <span class="co"># chm dir</span></span>
<span id="cb222-7"><a href="chm-raster-resolution-testing.html#cb222-7" tabindex="-1"></a>    dir_temp <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&quot;../data/point_cloud_processing_delivery_chm&quot;</span>,chm_res_m,<span class="st">&quot;m&quot;</span>)</span>
<span id="cb222-8"><a href="chm-raster-resolution-testing.html#cb222-8" tabindex="-1"></a>    <span class="co"># chm file</span></span>
<span id="cb222-9"><a href="chm-raster-resolution-testing.html#cb222-9" tabindex="-1"></a>    chm_f <span class="ot">&lt;-</span> <span class="fu">file.path</span>(dir_temp, <span class="fu">paste0</span>(<span class="st">&quot;chm_&quot;</span>, chm_res_m,<span class="st">&quot;m.tif&quot;</span>))</span>
<span id="cb222-10"><a href="chm-raster-resolution-testing.html#cb222-10" tabindex="-1"></a>    <span class="co"># check and do it</span></span>
<span id="cb222-11"><a href="chm-raster-resolution-testing.html#cb222-11" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(f_temp) <span class="sc">&amp;&amp;</span> <span class="fu">file.exists</span>(chm_f) ){</span>
<span id="cb222-12"><a href="chm-raster-resolution-testing.html#cb222-12" tabindex="-1"></a>      <span class="co"># read chm</span></span>
<span id="cb222-13"><a href="chm-raster-resolution-testing.html#cb222-13" tabindex="-1"></a>      chm_rast <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rast</span>(chm_f)</span>
<span id="cb222-14"><a href="chm-raster-resolution-testing.html#cb222-14" tabindex="-1"></a>      <span class="co"># do it</span></span>
<span id="cb222-15"><a href="chm-raster-resolution-testing.html#cb222-15" tabindex="-1"></a>      param_combos_piles <span class="ot">&lt;-</span> <span class="fu">param_combos_piles_detect_fn</span>(</span>
<span id="cb222-16"><a href="chm-raster-resolution-testing.html#cb222-16" tabindex="-1"></a>        <span class="at">chm =</span> chm_rast <span class="sc">%&gt;%</span> </span>
<span id="cb222-17"><a href="chm-raster-resolution-testing.html#cb222-17" tabindex="-1"></a>          terra<span class="sc">::</span><span class="fu">crop</span>(</span>
<span id="cb222-18"><a href="chm-raster-resolution-testing.html#cb222-18" tabindex="-1"></a>            stand_boundary <span class="sc">%&gt;%</span></span>
<span id="cb222-19"><a href="chm-raster-resolution-testing.html#cb222-19" tabindex="-1"></a>              dplyr<span class="sc">::</span><span class="fu">slice</span>(<span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb222-20"><a href="chm-raster-resolution-testing.html#cb222-20" tabindex="-1"></a>              sf<span class="sc">::</span><span class="fu">st_buffer</span>(<span class="dv">5</span>) <span class="sc">%&gt;%</span></span>
<span id="cb222-21"><a href="chm-raster-resolution-testing.html#cb222-21" tabindex="-1"></a>              sf<span class="sc">::</span><span class="fu">st_transform</span>(terra<span class="sc">::</span><span class="fu">crs</span>(chm_rast)) <span class="sc">%&gt;%</span></span>
<span id="cb222-22"><a href="chm-raster-resolution-testing.html#cb222-22" tabindex="-1"></a>              terra<span class="sc">::</span><span class="fu">vect</span>()</span>
<span id="cb222-23"><a href="chm-raster-resolution-testing.html#cb222-23" tabindex="-1"></a>          )</span>
<span id="cb222-24"><a href="chm-raster-resolution-testing.html#cb222-24" tabindex="-1"></a>        , <span class="at">param_combos_df =</span> param_combos_df</span>
<span id="cb222-25"><a href="chm-raster-resolution-testing.html#cb222-25" tabindex="-1"></a>        , <span class="at">smooth_segs =</span> T</span>
<span id="cb222-26"><a href="chm-raster-resolution-testing.html#cb222-26" tabindex="-1"></a>        , <span class="at">ofile =</span> f_temp</span>
<span id="cb222-27"><a href="chm-raster-resolution-testing.html#cb222-27" tabindex="-1"></a>      )</span>
<span id="cb222-28"><a href="chm-raster-resolution-testing.html#cb222-28" tabindex="-1"></a>      <span class="co"># param_combos_piles %&gt;% dplyr::glimpse()</span></span>
<span id="cb222-29"><a href="chm-raster-resolution-testing.html#cb222-29" tabindex="-1"></a>      </span>
<span id="cb222-30"><a href="chm-raster-resolution-testing.html#cb222-30" tabindex="-1"></a>      <span class="co"># save it</span></span>
<span id="cb222-31"><a href="chm-raster-resolution-testing.html#cb222-31" tabindex="-1"></a>      sf<span class="sc">::</span><span class="fu">st_write</span>(param_combos_piles, f_temp, <span class="at">append =</span> F, <span class="at">quiet =</span> T)</span>
<span id="cb222-32"><a href="chm-raster-resolution-testing.html#cb222-32" tabindex="-1"></a>      <span class="fu">return</span>(f_temp)</span>
<span id="cb222-33"><a href="chm-raster-resolution-testing.html#cb222-33" tabindex="-1"></a>    }<span class="cf">else</span> <span class="cf">if</span>(<span class="fu">file.exists</span>(f_temp)){</span>
<span id="cb222-34"><a href="chm-raster-resolution-testing.html#cb222-34" tabindex="-1"></a>      <span class="fu">return</span>(f_temp)</span>
<span id="cb222-35"><a href="chm-raster-resolution-testing.html#cb222-35" tabindex="-1"></a>    }<span class="cf">else</span>{</span>
<span id="cb222-36"><a href="chm-raster-resolution-testing.html#cb222-36" tabindex="-1"></a>      <span class="fu">return</span>(<span class="cn">NULL</span>)</span>
<span id="cb222-37"><a href="chm-raster-resolution-testing.html#cb222-37" tabindex="-1"></a>    }</span>
<span id="cb222-38"><a href="chm-raster-resolution-testing.html#cb222-38" tabindex="-1"></a>  })</span>
<span id="cb222-39"><a href="chm-raster-resolution-testing.html#cb222-39" tabindex="-1"></a><span class="co"># which successes?</span></span>
<span id="cb222-40"><a href="chm-raster-resolution-testing.html#cb222-40" tabindex="-1"></a>param_combos_piles_flist</span></code></pre></div>
<div id="validation-over-parameter-combinations" class="section level3 hasAnchor" number="8.2.1">
<h3><span class="header-section-number">8.2.1</span> Validation over parameter combinations<a href="chm-raster-resolution-testing.html#validation-over-parameter-combinations" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>now we need to validate these combinations against the ground truth data and we can map over the <code>ground_truth_prediction_match()</code> function to get true positive, false positive (commission), and false negative (omission) classifications for the predicted and ground truth piles</p>
<div class="sourceCode" id="cb223"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb223-1"><a href="chm-raster-resolution-testing.html#cb223-1" tabindex="-1"></a>param_combos_gt_flist <span class="ot">&lt;-</span> chm_res_list <span class="sc">%&gt;%</span> </span>
<span id="cb223-2"><a href="chm-raster-resolution-testing.html#cb223-2" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">map</span>(<span class="cf">function</span>(chm_res_m){</span>
<span id="cb223-3"><a href="chm-raster-resolution-testing.html#cb223-3" tabindex="-1"></a>    <span class="fu">message</span>(<span class="fu">paste0</span>(<span class="st">&quot;ground_truth_prediction_match...........&quot;</span>,chm_res_m))</span>
<span id="cb223-4"><a href="chm-raster-resolution-testing.html#cb223-4" tabindex="-1"></a>    param_combos_piles_fnm <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">&quot;../data&quot;</span>,<span class="fu">paste0</span>(<span class="st">&quot;param_combos_piles_chm&quot;</span>,chm_res_m,<span class="st">&quot;m.gpkg&quot;</span>))</span>
<span id="cb223-5"><a href="chm-raster-resolution-testing.html#cb223-5" tabindex="-1"></a>    <span class="co"># file creating now</span></span>
<span id="cb223-6"><a href="chm-raster-resolution-testing.html#cb223-6" tabindex="-1"></a>    f_temp <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">&quot;../data&quot;</span>,<span class="fu">paste0</span>(<span class="st">&quot;param_combos_gt_chm&quot;</span>,chm_res_m,<span class="st">&quot;m.csv&quot;</span>))</span>
<span id="cb223-7"><a href="chm-raster-resolution-testing.html#cb223-7" tabindex="-1"></a>    <span class="co"># check</span></span>
<span id="cb223-8"><a href="chm-raster-resolution-testing.html#cb223-8" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(f_temp) <span class="sc">&amp;&amp;</span> <span class="fu">file.exists</span>(param_combos_piles_fnm)){</span>
<span id="cb223-9"><a href="chm-raster-resolution-testing.html#cb223-9" tabindex="-1"></a>      <span class="co"># read it</span></span>
<span id="cb223-10"><a href="chm-raster-resolution-testing.html#cb223-10" tabindex="-1"></a>      param_combos_piles <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_read</span>(param_combos_piles_fnm)</span>
<span id="cb223-11"><a href="chm-raster-resolution-testing.html#cb223-11" tabindex="-1"></a>      <span class="co"># do it</span></span>
<span id="cb223-12"><a href="chm-raster-resolution-testing.html#cb223-12" tabindex="-1"></a>      param_combos_gt <span class="ot">&lt;-</span> </span>
<span id="cb223-13"><a href="chm-raster-resolution-testing.html#cb223-13" tabindex="-1"></a>        <span class="fu">unique</span>(param_combos_df<span class="sc">$</span>rn) <span class="sc">%&gt;%</span> </span>
<span id="cb223-14"><a href="chm-raster-resolution-testing.html#cb223-14" tabindex="-1"></a>        purrr<span class="sc">::</span><span class="fu">map</span>(\(x)</span>
<span id="cb223-15"><a href="chm-raster-resolution-testing.html#cb223-15" tabindex="-1"></a>          <span class="fu">ground_truth_prediction_match</span>(</span>
<span id="cb223-16"><a href="chm-raster-resolution-testing.html#cb223-16" tabindex="-1"></a>            <span class="at">ground_truth =</span> slash_piles_polys <span class="sc">%&gt;%</span> </span>
<span id="cb223-17"><a href="chm-raster-resolution-testing.html#cb223-17" tabindex="-1"></a>              dplyr<span class="sc">::</span><span class="fu">filter</span>(is_in_stand) <span class="sc">%&gt;%</span> </span>
<span id="cb223-18"><a href="chm-raster-resolution-testing.html#cb223-18" tabindex="-1"></a>              dplyr<span class="sc">::</span><span class="fu">arrange</span>(<span class="fu">desc</span>(field_diameter_m)) <span class="sc">%&gt;%</span> </span>
<span id="cb223-19"><a href="chm-raster-resolution-testing.html#cb223-19" tabindex="-1"></a>              sf<span class="sc">::</span><span class="fu">st_transform</span>(sf<span class="sc">::</span><span class="fu">st_crs</span>(param_combos_piles))</span>
<span id="cb223-20"><a href="chm-raster-resolution-testing.html#cb223-20" tabindex="-1"></a>            , <span class="at">gt_id =</span> <span class="st">&quot;pile_id&quot;</span></span>
<span id="cb223-21"><a href="chm-raster-resolution-testing.html#cb223-21" tabindex="-1"></a>            , <span class="at">predictions =</span> param_combos_piles <span class="sc">%&gt;%</span> </span>
<span id="cb223-22"><a href="chm-raster-resolution-testing.html#cb223-22" tabindex="-1"></a>              dplyr<span class="sc">::</span><span class="fu">filter</span>(rn <span class="sc">==</span> x) <span class="sc">%&gt;%</span> </span>
<span id="cb223-23"><a href="chm-raster-resolution-testing.html#cb223-23" tabindex="-1"></a>              dplyr<span class="sc">::</span><span class="fu">filter</span>(</span>
<span id="cb223-24"><a href="chm-raster-resolution-testing.html#cb223-24" tabindex="-1"></a>                pred_id <span class="sc">%in%</span> (param_combos_piles <span class="sc">%&gt;%</span> </span>
<span id="cb223-25"><a href="chm-raster-resolution-testing.html#cb223-25" tabindex="-1"></a>                  dplyr<span class="sc">::</span><span class="fu">filter</span>(rn <span class="sc">==</span> x) <span class="sc">%&gt;%</span> </span>
<span id="cb223-26"><a href="chm-raster-resolution-testing.html#cb223-26" tabindex="-1"></a>                  sf<span class="sc">::</span><span class="fu">st_intersection</span>(</span>
<span id="cb223-27"><a href="chm-raster-resolution-testing.html#cb223-27" tabindex="-1"></a>                    stand_boundary <span class="sc">%&gt;%</span> </span>
<span id="cb223-28"><a href="chm-raster-resolution-testing.html#cb223-28" tabindex="-1"></a>                      sf<span class="sc">::</span><span class="fu">st_transform</span>(sf<span class="sc">::</span><span class="fu">st_crs</span>(param_combos_piles))</span>
<span id="cb223-29"><a href="chm-raster-resolution-testing.html#cb223-29" tabindex="-1"></a>                  ) <span class="sc">%&gt;%</span> </span>
<span id="cb223-30"><a href="chm-raster-resolution-testing.html#cb223-30" tabindex="-1"></a>                  sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb223-31"><a href="chm-raster-resolution-testing.html#cb223-31" tabindex="-1"></a>                  dplyr<span class="sc">::</span><span class="fu">pull</span>(pred_id))</span>
<span id="cb223-32"><a href="chm-raster-resolution-testing.html#cb223-32" tabindex="-1"></a>              )</span>
<span id="cb223-33"><a href="chm-raster-resolution-testing.html#cb223-33" tabindex="-1"></a>            , <span class="at">pred_id =</span> <span class="st">&quot;pred_id&quot;</span></span>
<span id="cb223-34"><a href="chm-raster-resolution-testing.html#cb223-34" tabindex="-1"></a>            , <span class="at">min_iou_pct =</span> <span class="fl">0.05</span></span>
<span id="cb223-35"><a href="chm-raster-resolution-testing.html#cb223-35" tabindex="-1"></a>          ) <span class="sc">%&gt;%</span> </span>
<span id="cb223-36"><a href="chm-raster-resolution-testing.html#cb223-36" tabindex="-1"></a>          dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">rn=</span>x)</span>
<span id="cb223-37"><a href="chm-raster-resolution-testing.html#cb223-37" tabindex="-1"></a>        ) <span class="sc">%&gt;%</span> </span>
<span id="cb223-38"><a href="chm-raster-resolution-testing.html#cb223-38" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">bind_rows</span>()</span>
<span id="cb223-39"><a href="chm-raster-resolution-testing.html#cb223-39" tabindex="-1"></a>      <span class="co"># write it</span></span>
<span id="cb223-40"><a href="chm-raster-resolution-testing.html#cb223-40" tabindex="-1"></a>      param_combos_gt <span class="sc">%&gt;%</span> readr<span class="sc">::</span><span class="fu">write_csv</span>(f_temp, <span class="at">append =</span> F, <span class="at">progress =</span> F)</span>
<span id="cb223-41"><a href="chm-raster-resolution-testing.html#cb223-41" tabindex="-1"></a>      <span class="fu">return</span>(f_temp)</span>
<span id="cb223-42"><a href="chm-raster-resolution-testing.html#cb223-42" tabindex="-1"></a>    }<span class="cf">else</span> <span class="cf">if</span>(<span class="fu">file.exists</span>(f_temp)){</span>
<span id="cb223-43"><a href="chm-raster-resolution-testing.html#cb223-43" tabindex="-1"></a>      <span class="fu">return</span>(f_temp)</span>
<span id="cb223-44"><a href="chm-raster-resolution-testing.html#cb223-44" tabindex="-1"></a>    }<span class="cf">else</span>{</span>
<span id="cb223-45"><a href="chm-raster-resolution-testing.html#cb223-45" tabindex="-1"></a>      <span class="fu">return</span>(<span class="cn">NULL</span>)</span>
<span id="cb223-46"><a href="chm-raster-resolution-testing.html#cb223-46" tabindex="-1"></a>    }</span>
<span id="cb223-47"><a href="chm-raster-resolution-testing.html#cb223-47" tabindex="-1"></a>  })</span>
<span id="cb223-48"><a href="chm-raster-resolution-testing.html#cb223-48" tabindex="-1"></a><span class="co"># which successes?</span></span>
<span id="cb223-49"><a href="chm-raster-resolution-testing.html#cb223-49" tabindex="-1"></a>param_combos_gt_flist</span></code></pre></div>
</div>
<div id="aggregate-validation-metrics-to-parameter-combination" class="section level3 hasAnchor" number="8.2.2">
<h3><span class="header-section-number">8.2.2</span> Aggregate Validation Metrics to Parameter Combination<a href="chm-raster-resolution-testing.html#aggregate-validation-metrics-to-parameter-combination" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>now we’re going to calculate aggregated detection accuracy metrics and quantification accuracy metrics</p>
<p><strong>detection accuracy metrics</strong>:</p>
<ul>
<li><strong>Precision</strong> precision measures how many of the objects our method detected as slash piles were actually correct. A high precision means the method has a low rate of false alarms.</li>
<li><strong>Recall</strong> recall (i.e. detection rate) indicates how many actual (ground truth) slash piles our method successfully identified. High recall means the method is good at finding most existing piles, minimizing omissions.</li>
<li><strong>F-score</strong> provides a single, balanced measure that combines both precision and recall. A high F-score indicates overall effectiveness in both finding most piles and ensuring most detections are correct.</li>
</ul>
<p><strong>quantification accuracy metrics</strong>:</p>
<ul>
<li><strong>Mean Error (ME)</strong> represents the direction of bias (over or under-prediction) in the original units</li>
<li><strong>RMSE</strong> represents the typical magnitude of error in the original units, with a stronger penalty for large errors</li>
<li><strong>MAPE</strong> represents the typical magnitude of error as a percentage, allowing for scale-independent comparisons</li>
</ul>
<p>as a reminder regarding the form quantification accuracy evaluation, we will assess the method’s accuracy by comparing the true-positive matches using the following metrics:</p>
<ul>
<li><strong>Volume</strong> compares the predicted volume from the irregular elevation profile and footprint to the ground truth paraboloid volume</li>
<li><strong>Diameter</strong> compares the predicted diameter (from the maximum internal distance) to the ground truth field-measured diameter.</li>
<li><strong>Area</strong> compares the predicted area from the irregular shape to the ground truth assumed circular area</li>
<li><strong>Height</strong> compares the predicted maximum height from the CHM to the ground truth field-measured height</li>
</ul>
<div class="sourceCode" id="cb224"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb224-1"><a href="chm-raster-resolution-testing.html#cb224-1" tabindex="-1"></a>param_combos_gt_agg_flist <span class="ot">&lt;-</span> chm_res_list <span class="sc">%&gt;%</span> </span>
<span id="cb224-2"><a href="chm-raster-resolution-testing.html#cb224-2" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">map</span>(<span class="cf">function</span>(chm_res_m){</span>
<span id="cb224-3"><a href="chm-raster-resolution-testing.html#cb224-3" tabindex="-1"></a>    <span class="fu">message</span>(<span class="fu">paste0</span>(<span class="st">&quot;param_combos_gt_agg...........&quot;</span>,chm_res_m))</span>
<span id="cb224-4"><a href="chm-raster-resolution-testing.html#cb224-4" tabindex="-1"></a>    <span class="co"># param_combos_piles file</span></span>
<span id="cb224-5"><a href="chm-raster-resolution-testing.html#cb224-5" tabindex="-1"></a>    param_combos_piles_fnm <span class="ot">&lt;-</span> param_combos_piles_flist <span class="sc">%&gt;%</span> stringr<span class="sc">::</span><span class="fu">str_subset</span>(<span class="at">pattern =</span> <span class="fu">paste0</span>(<span class="st">&quot;chm&quot;</span>,chm_res_m,<span class="st">&quot;m.gpkg&quot;</span>)) <span class="sc">%&gt;%</span> purrr<span class="sc">::</span><span class="fu">pluck</span>(<span class="dv">1</span>)</span>
<span id="cb224-6"><a href="chm-raster-resolution-testing.html#cb224-6" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">is.null</span>(param_combos_piles_fnm) <span class="sc">||</span> <span class="sc">!</span><span class="fu">file.exists</span>(param_combos_piles_fnm)){<span class="fu">return</span>(<span class="cn">NULL</span>)}</span>
<span id="cb224-7"><a href="chm-raster-resolution-testing.html#cb224-7" tabindex="-1"></a>    <span class="co"># param_combos_gt file</span></span>
<span id="cb224-8"><a href="chm-raster-resolution-testing.html#cb224-8" tabindex="-1"></a>    param_combos_gt_fnm <span class="ot">&lt;-</span> param_combos_gt_flist <span class="sc">%&gt;%</span> stringr<span class="sc">::</span><span class="fu">str_subset</span>(<span class="at">pattern =</span> <span class="fu">paste0</span>(<span class="st">&quot;chm&quot;</span>,chm_res_m,<span class="st">&quot;m.csv&quot;</span>)) <span class="sc">%&gt;%</span> purrr<span class="sc">::</span><span class="fu">pluck</span>(<span class="dv">1</span>)</span>
<span id="cb224-9"><a href="chm-raster-resolution-testing.html#cb224-9" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">is.null</span>(param_combos_gt_fnm) <span class="sc">||</span> <span class="sc">!</span><span class="fu">file.exists</span>(param_combos_gt_fnm)){<span class="fu">return</span>(<span class="cn">NULL</span>)}</span>
<span id="cb224-10"><a href="chm-raster-resolution-testing.html#cb224-10" tabindex="-1"></a>    <span class="co"># file creating now</span></span>
<span id="cb224-11"><a href="chm-raster-resolution-testing.html#cb224-11" tabindex="-1"></a>    f_temp <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">&quot;../data&quot;</span>,<span class="fu">paste0</span>(<span class="st">&quot;param_combos_gt_agg_chm&quot;</span>,chm_res_m,<span class="st">&quot;m.csv&quot;</span>))</span>
<span id="cb224-12"><a href="chm-raster-resolution-testing.html#cb224-12" tabindex="-1"></a>    <span class="co"># check and do it</span></span>
<span id="cb224-13"><a href="chm-raster-resolution-testing.html#cb224-13" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(f_temp)){</span>
<span id="cb224-14"><a href="chm-raster-resolution-testing.html#cb224-14" tabindex="-1"></a>      <span class="co"># read param_combos_piles</span></span>
<span id="cb224-15"><a href="chm-raster-resolution-testing.html#cb224-15" tabindex="-1"></a>      param_combos_piles <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_read</span>(param_combos_piles_fnm)</span>
<span id="cb224-16"><a href="chm-raster-resolution-testing.html#cb224-16" tabindex="-1"></a>      <span class="co"># read param_combos_piles</span></span>
<span id="cb224-17"><a href="chm-raster-resolution-testing.html#cb224-17" tabindex="-1"></a>      param_combos_gt <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(param_combos_gt_fnm)</span>
<span id="cb224-18"><a href="chm-raster-resolution-testing.html#cb224-18" tabindex="-1"></a>      </span>
<span id="cb224-19"><a href="chm-raster-resolution-testing.html#cb224-19" tabindex="-1"></a>      <span class="do">#######################################</span></span>
<span id="cb224-20"><a href="chm-raster-resolution-testing.html#cb224-20" tabindex="-1"></a>      <span class="co"># let&#39;s attach a flag to only work with piles that intersect with the stand boundary</span></span>
<span id="cb224-21"><a href="chm-raster-resolution-testing.html#cb224-21" tabindex="-1"></a>      <span class="co"># add in/out to piles data</span></span>
<span id="cb224-22"><a href="chm-raster-resolution-testing.html#cb224-22" tabindex="-1"></a>      <span class="do">#######################################</span></span>
<span id="cb224-23"><a href="chm-raster-resolution-testing.html#cb224-23" tabindex="-1"></a>      param_combos_piles <span class="ot">&lt;-</span> param_combos_piles <span class="sc">%&gt;%</span> </span>
<span id="cb224-24"><a href="chm-raster-resolution-testing.html#cb224-24" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">left_join</span>(</span>
<span id="cb224-25"><a href="chm-raster-resolution-testing.html#cb224-25" tabindex="-1"></a>          param_combos_piles <span class="sc">%&gt;%</span> </span>
<span id="cb224-26"><a href="chm-raster-resolution-testing.html#cb224-26" tabindex="-1"></a>            sf<span class="sc">::</span><span class="fu">st_intersection</span>(</span>
<span id="cb224-27"><a href="chm-raster-resolution-testing.html#cb224-27" tabindex="-1"></a>              stand_boundary <span class="sc">%&gt;%</span> </span>
<span id="cb224-28"><a href="chm-raster-resolution-testing.html#cb224-28" tabindex="-1"></a>                sf<span class="sc">::</span><span class="fu">st_transform</span>(sf<span class="sc">::</span><span class="fu">st_crs</span>(param_combos_piles))</span>
<span id="cb224-29"><a href="chm-raster-resolution-testing.html#cb224-29" tabindex="-1"></a>            ) <span class="sc">%&gt;%</span> </span>
<span id="cb224-30"><a href="chm-raster-resolution-testing.html#cb224-30" tabindex="-1"></a>            sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb224-31"><a href="chm-raster-resolution-testing.html#cb224-31" tabindex="-1"></a>            dplyr<span class="sc">::</span><span class="fu">select</span>(rn,pred_id) <span class="sc">%&gt;%</span> </span>
<span id="cb224-32"><a href="chm-raster-resolution-testing.html#cb224-32" tabindex="-1"></a>            dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">is_in_stand =</span> T)</span>
<span id="cb224-33"><a href="chm-raster-resolution-testing.html#cb224-33" tabindex="-1"></a>          , <span class="at">by =</span> dplyr<span class="sc">::</span><span class="fu">join_by</span>(rn,pred_id)</span>
<span id="cb224-34"><a href="chm-raster-resolution-testing.html#cb224-34" tabindex="-1"></a>        ) <span class="sc">%&gt;%</span> </span>
<span id="cb224-35"><a href="chm-raster-resolution-testing.html#cb224-35" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb224-36"><a href="chm-raster-resolution-testing.html#cb224-36" tabindex="-1"></a>          <span class="at">is_in_stand =</span> dplyr<span class="sc">::</span><span class="fu">coalesce</span>(is_in_stand,F)</span>
<span id="cb224-37"><a href="chm-raster-resolution-testing.html#cb224-37" tabindex="-1"></a>        ) <span class="sc">%&gt;%</span> </span>
<span id="cb224-38"><a href="chm-raster-resolution-testing.html#cb224-38" tabindex="-1"></a>        <span class="co"># # get the length (diameter) and width of the polygon</span></span>
<span id="cb224-39"><a href="chm-raster-resolution-testing.html#cb224-39" tabindex="-1"></a>        <span class="co"># st_bbox_by_row(dimensions = T) %&gt;% # gets shape_length, where shape_length=length of longest bbox side</span></span>
<span id="cb224-40"><a href="chm-raster-resolution-testing.html#cb224-40" tabindex="-1"></a>        <span class="co"># and paraboloid volume</span></span>
<span id="cb224-41"><a href="chm-raster-resolution-testing.html#cb224-41" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb224-42"><a href="chm-raster-resolution-testing.html#cb224-42" tabindex="-1"></a>          <span class="co"># paraboloid_volume_m3 = (1/8) * pi * (shape_length^2) * max_height_m</span></span>
<span id="cb224-43"><a href="chm-raster-resolution-testing.html#cb224-43" tabindex="-1"></a>          <span class="at">paraboloid_volume_m3 =</span> (<span class="dv">1</span><span class="sc">/</span><span class="dv">8</span>) <span class="sc">*</span> pi <span class="sc">*</span> (diameter_m<span class="sc">^</span><span class="dv">2</span>) <span class="sc">*</span> max_height_m</span>
<span id="cb224-44"><a href="chm-raster-resolution-testing.html#cb224-44" tabindex="-1"></a>        )</span>
<span id="cb224-45"><a href="chm-raster-resolution-testing.html#cb224-45" tabindex="-1"></a>      <span class="co"># param_combos_piles %&gt;% dplyr::glimpse()</span></span>
<span id="cb224-46"><a href="chm-raster-resolution-testing.html#cb224-46" tabindex="-1"></a>      <span class="do">#######################################</span></span>
<span id="cb224-47"><a href="chm-raster-resolution-testing.html#cb224-47" tabindex="-1"></a>      <span class="co"># add data to validation</span></span>
<span id="cb224-48"><a href="chm-raster-resolution-testing.html#cb224-48" tabindex="-1"></a>      <span class="do">#######################################</span></span>
<span id="cb224-49"><a href="chm-raster-resolution-testing.html#cb224-49" tabindex="-1"></a>      param_combos_gt <span class="ot">&lt;-</span></span>
<span id="cb224-50"><a href="chm-raster-resolution-testing.html#cb224-50" tabindex="-1"></a>        param_combos_gt <span class="sc">%&gt;%</span> </span>
<span id="cb224-51"><a href="chm-raster-resolution-testing.html#cb224-51" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">pile_id =</span> <span class="fu">as.numeric</span>(pile_id)) <span class="sc">%&gt;%</span> </span>
<span id="cb224-52"><a href="chm-raster-resolution-testing.html#cb224-52" tabindex="-1"></a>        <span class="co"># add area of gt</span></span>
<span id="cb224-53"><a href="chm-raster-resolution-testing.html#cb224-53" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">left_join</span>(</span>
<span id="cb224-54"><a href="chm-raster-resolution-testing.html#cb224-54" tabindex="-1"></a>          slash_piles_polys <span class="sc">%&gt;%</span> </span>
<span id="cb224-55"><a href="chm-raster-resolution-testing.html#cb224-55" tabindex="-1"></a>            sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb224-56"><a href="chm-raster-resolution-testing.html#cb224-56" tabindex="-1"></a>            dplyr<span class="sc">::</span><span class="fu">select</span>(pile_id,image_gt_area_m2,height_m,field_diameter_m) <span class="sc">%&gt;%</span> </span>
<span id="cb224-57"><a href="chm-raster-resolution-testing.html#cb224-57" tabindex="-1"></a>            dplyr<span class="sc">::</span><span class="fu">rename</span>(</span>
<span id="cb224-58"><a href="chm-raster-resolution-testing.html#cb224-58" tabindex="-1"></a>              <span class="at">gt_height_m =</span> height_m</span>
<span id="cb224-59"><a href="chm-raster-resolution-testing.html#cb224-59" tabindex="-1"></a>              , <span class="at">gt_diameter_m =</span> field_diameter_m</span>
<span id="cb224-60"><a href="chm-raster-resolution-testing.html#cb224-60" tabindex="-1"></a>              , <span class="at">gt_area_m2 =</span> image_gt_area_m2</span>
<span id="cb224-61"><a href="chm-raster-resolution-testing.html#cb224-61" tabindex="-1"></a>            ) <span class="sc">%&gt;%</span> </span>
<span id="cb224-62"><a href="chm-raster-resolution-testing.html#cb224-62" tabindex="-1"></a>            dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">pile_id=</span><span class="fu">as.numeric</span>(pile_id))</span>
<span id="cb224-63"><a href="chm-raster-resolution-testing.html#cb224-63" tabindex="-1"></a>          , <span class="at">by =</span> <span class="st">&quot;pile_id&quot;</span></span>
<span id="cb224-64"><a href="chm-raster-resolution-testing.html#cb224-64" tabindex="-1"></a>        ) <span class="sc">%&gt;%</span> </span>
<span id="cb224-65"><a href="chm-raster-resolution-testing.html#cb224-65" tabindex="-1"></a>        <span class="co"># add info from predictions</span></span>
<span id="cb224-66"><a href="chm-raster-resolution-testing.html#cb224-66" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">left_join</span>(</span>
<span id="cb224-67"><a href="chm-raster-resolution-testing.html#cb224-67" tabindex="-1"></a>          param_combos_piles <span class="sc">%&gt;%</span></span>
<span id="cb224-68"><a href="chm-raster-resolution-testing.html#cb224-68" tabindex="-1"></a>            sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span></span>
<span id="cb224-69"><a href="chm-raster-resolution-testing.html#cb224-69" tabindex="-1"></a>            dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb224-70"><a href="chm-raster-resolution-testing.html#cb224-70" tabindex="-1"></a>              rn,pred_id</span>
<span id="cb224-71"><a href="chm-raster-resolution-testing.html#cb224-71" tabindex="-1"></a>              , is_in_stand</span>
<span id="cb224-72"><a href="chm-raster-resolution-testing.html#cb224-72" tabindex="-1"></a>              , area_m2, volume_m3, max_height_m, diameter_m</span>
<span id="cb224-73"><a href="chm-raster-resolution-testing.html#cb224-73" tabindex="-1"></a>              , paraboloid_volume_m3</span>
<span id="cb224-74"><a href="chm-raster-resolution-testing.html#cb224-74" tabindex="-1"></a>              <span class="co"># , shape_length # , shape_width</span></span>
<span id="cb224-75"><a href="chm-raster-resolution-testing.html#cb224-75" tabindex="-1"></a>            ) <span class="sc">%&gt;%</span> </span>
<span id="cb224-76"><a href="chm-raster-resolution-testing.html#cb224-76" tabindex="-1"></a>            dplyr<span class="sc">::</span><span class="fu">rename</span>(</span>
<span id="cb224-77"><a href="chm-raster-resolution-testing.html#cb224-77" tabindex="-1"></a>              <span class="at">pred_area_m2 =</span> area_m2, <span class="at">pred_volume_m3 =</span> volume_m3</span>
<span id="cb224-78"><a href="chm-raster-resolution-testing.html#cb224-78" tabindex="-1"></a>              , <span class="at">pred_height_m =</span> max_height_m, <span class="at">pred_diameter_m =</span> diameter_m</span>
<span id="cb224-79"><a href="chm-raster-resolution-testing.html#cb224-79" tabindex="-1"></a>              , <span class="at">pred_paraboloid_volume_m3 =</span> paraboloid_volume_m3</span>
<span id="cb224-80"><a href="chm-raster-resolution-testing.html#cb224-80" tabindex="-1"></a>            )</span>
<span id="cb224-81"><a href="chm-raster-resolution-testing.html#cb224-81" tabindex="-1"></a>          , <span class="at">by =</span> dplyr<span class="sc">::</span><span class="fu">join_by</span>(rn,pred_id)</span>
<span id="cb224-82"><a href="chm-raster-resolution-testing.html#cb224-82" tabindex="-1"></a>        ) <span class="sc">%&gt;%</span></span>
<span id="cb224-83"><a href="chm-raster-resolution-testing.html#cb224-83" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb224-84"><a href="chm-raster-resolution-testing.html#cb224-84" tabindex="-1"></a>          <span class="at">is_in_stand =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb224-85"><a href="chm-raster-resolution-testing.html#cb224-85" tabindex="-1"></a>            is_in_stand <span class="sc">==</span> T <span class="sc">~</span> T</span>
<span id="cb224-86"><a href="chm-raster-resolution-testing.html#cb224-86" tabindex="-1"></a>            , is_in_stand <span class="sc">==</span> F <span class="sc">~</span> F</span>
<span id="cb224-87"><a href="chm-raster-resolution-testing.html#cb224-87" tabindex="-1"></a>            , match_grp <span class="sc">==</span> <span class="st">&quot;omission&quot;</span> <span class="sc">~</span> T</span>
<span id="cb224-88"><a href="chm-raster-resolution-testing.html#cb224-88" tabindex="-1"></a>            , T <span class="sc">~</span> F</span>
<span id="cb224-89"><a href="chm-raster-resolution-testing.html#cb224-89" tabindex="-1"></a>          )</span>
<span id="cb224-90"><a href="chm-raster-resolution-testing.html#cb224-90" tabindex="-1"></a>          <span class="do">### calculate these based on the formulas below...agg_ground_truth_match() depends on those formulas</span></span>
<span id="cb224-91"><a href="chm-raster-resolution-testing.html#cb224-91" tabindex="-1"></a>          <span class="co"># area_m2</span></span>
<span id="cb224-92"><a href="chm-raster-resolution-testing.html#cb224-92" tabindex="-1"></a>          , <span class="at">diff_area_m2 =</span> pred_area_m2<span class="sc">-</span>gt_area_m2</span>
<span id="cb224-93"><a href="chm-raster-resolution-testing.html#cb224-93" tabindex="-1"></a>          , <span class="at">pct_diff_area_m2 =</span> (gt_area_m2<span class="sc">-</span>pred_area_m2)<span class="sc">/</span>gt_area_m2</span>
<span id="cb224-94"><a href="chm-raster-resolution-testing.html#cb224-94" tabindex="-1"></a>          <span class="co"># height_m</span></span>
<span id="cb224-95"><a href="chm-raster-resolution-testing.html#cb224-95" tabindex="-1"></a>          , <span class="at">diff_height_m =</span> pred_height_m<span class="sc">-</span>gt_height_m</span>
<span id="cb224-96"><a href="chm-raster-resolution-testing.html#cb224-96" tabindex="-1"></a>          , <span class="at">pct_diff_height_m =</span> (gt_height_m<span class="sc">-</span>pred_height_m)<span class="sc">/</span>gt_height_m</span>
<span id="cb224-97"><a href="chm-raster-resolution-testing.html#cb224-97" tabindex="-1"></a>          <span class="co"># diameter_m</span></span>
<span id="cb224-98"><a href="chm-raster-resolution-testing.html#cb224-98" tabindex="-1"></a>          , <span class="at">diff_diameter_m =</span> pred_diameter_m<span class="sc">-</span>gt_diameter_m</span>
<span id="cb224-99"><a href="chm-raster-resolution-testing.html#cb224-99" tabindex="-1"></a>          , <span class="at">pct_diff_diameter_m =</span> (gt_diameter_m<span class="sc">-</span>pred_diameter_m)<span class="sc">/</span>gt_diameter_m</span>
<span id="cb224-100"><a href="chm-raster-resolution-testing.html#cb224-100" tabindex="-1"></a>        )</span>
<span id="cb224-101"><a href="chm-raster-resolution-testing.html#cb224-101" tabindex="-1"></a>      <span class="do">#######################################</span></span>
<span id="cb224-102"><a href="chm-raster-resolution-testing.html#cb224-102" tabindex="-1"></a>      <span class="co"># aggregate results from ground_truth_prediction_match()</span></span>
<span id="cb224-103"><a href="chm-raster-resolution-testing.html#cb224-103" tabindex="-1"></a>      <span class="do">#######################################</span></span>
<span id="cb224-104"><a href="chm-raster-resolution-testing.html#cb224-104" tabindex="-1"></a>      param_combos_gt_agg <span class="ot">&lt;-</span> <span class="fu">unique</span>(param_combos_gt<span class="sc">$</span>rn) <span class="sc">%&gt;%</span> </span>
<span id="cb224-105"><a href="chm-raster-resolution-testing.html#cb224-105" tabindex="-1"></a>        purrr<span class="sc">::</span><span class="fu">map</span>(\(x)</span>
<span id="cb224-106"><a href="chm-raster-resolution-testing.html#cb224-106" tabindex="-1"></a>          <span class="fu">agg_ground_truth_match</span>(</span>
<span id="cb224-107"><a href="chm-raster-resolution-testing.html#cb224-107" tabindex="-1"></a>            param_combos_gt <span class="sc">%&gt;%</span> </span>
<span id="cb224-108"><a href="chm-raster-resolution-testing.html#cb224-108" tabindex="-1"></a>              dplyr<span class="sc">::</span><span class="fu">filter</span>(</span>
<span id="cb224-109"><a href="chm-raster-resolution-testing.html#cb224-109" tabindex="-1"></a>                is_in_stand</span>
<span id="cb224-110"><a href="chm-raster-resolution-testing.html#cb224-110" tabindex="-1"></a>                <span class="sc">&amp;</span> rn <span class="sc">==</span> x</span>
<span id="cb224-111"><a href="chm-raster-resolution-testing.html#cb224-111" tabindex="-1"></a>              )</span>
<span id="cb224-112"><a href="chm-raster-resolution-testing.html#cb224-112" tabindex="-1"></a>          ) <span class="sc">%&gt;%</span> </span>
<span id="cb224-113"><a href="chm-raster-resolution-testing.html#cb224-113" tabindex="-1"></a>          dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">rn =</span> x) <span class="sc">%&gt;%</span> </span>
<span id="cb224-114"><a href="chm-raster-resolution-testing.html#cb224-114" tabindex="-1"></a>          dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">!</span>tidyselect<span class="sc">::</span><span class="fu">starts_with</span>(<span class="st">&quot;gt_&quot;</span>))</span>
<span id="cb224-115"><a href="chm-raster-resolution-testing.html#cb224-115" tabindex="-1"></a>        ) <span class="sc">%&gt;%</span> </span>
<span id="cb224-116"><a href="chm-raster-resolution-testing.html#cb224-116" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">bind_rows</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb224-117"><a href="chm-raster-resolution-testing.html#cb224-117" tabindex="-1"></a>        <span class="co"># add in info on all parameter combinations</span></span>
<span id="cb224-118"><a href="chm-raster-resolution-testing.html#cb224-118" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">inner_join</span>(</span>
<span id="cb224-119"><a href="chm-raster-resolution-testing.html#cb224-119" tabindex="-1"></a>          param_combos_piles <span class="sc">%&gt;%</span> </span>
<span id="cb224-120"><a href="chm-raster-resolution-testing.html#cb224-120" tabindex="-1"></a>          sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb224-121"><a href="chm-raster-resolution-testing.html#cb224-121" tabindex="-1"></a>          dplyr<span class="sc">::</span><span class="fu">distinct</span>(</span>
<span id="cb224-122"><a href="chm-raster-resolution-testing.html#cb224-122" tabindex="-1"></a>            rn,max_ht_m,min_area_m2,max_area_m2,convexity_pct,circle_fit_iou_pct</span>
<span id="cb224-123"><a href="chm-raster-resolution-testing.html#cb224-123" tabindex="-1"></a>          )</span>
<span id="cb224-124"><a href="chm-raster-resolution-testing.html#cb224-124" tabindex="-1"></a>          , <span class="at">by =</span> <span class="st">&quot;rn&quot;</span></span>
<span id="cb224-125"><a href="chm-raster-resolution-testing.html#cb224-125" tabindex="-1"></a>          , <span class="at">relationship =</span> <span class="st">&quot;one-to-one&quot;</span></span>
<span id="cb224-126"><a href="chm-raster-resolution-testing.html#cb224-126" tabindex="-1"></a>        )</span>
<span id="cb224-127"><a href="chm-raster-resolution-testing.html#cb224-127" tabindex="-1"></a>      <span class="co"># write it</span></span>
<span id="cb224-128"><a href="chm-raster-resolution-testing.html#cb224-128" tabindex="-1"></a>      param_combos_gt_agg <span class="sc">%&gt;%</span> readr<span class="sc">::</span><span class="fu">write_csv</span>(f_temp, <span class="at">append =</span> F, <span class="at">progress =</span> F)</span>
<span id="cb224-129"><a href="chm-raster-resolution-testing.html#cb224-129" tabindex="-1"></a>      <span class="fu">return</span>(f_temp)</span>
<span id="cb224-130"><a href="chm-raster-resolution-testing.html#cb224-130" tabindex="-1"></a>    }<span class="cf">else</span> <span class="cf">if</span>(<span class="fu">file.exists</span>(f_temp)){</span>
<span id="cb224-131"><a href="chm-raster-resolution-testing.html#cb224-131" tabindex="-1"></a>      <span class="fu">return</span>(f_temp)</span>
<span id="cb224-132"><a href="chm-raster-resolution-testing.html#cb224-132" tabindex="-1"></a>    }<span class="cf">else</span>{</span>
<span id="cb224-133"><a href="chm-raster-resolution-testing.html#cb224-133" tabindex="-1"></a>      <span class="fu">return</span>(<span class="cn">NULL</span>)</span>
<span id="cb224-134"><a href="chm-raster-resolution-testing.html#cb224-134" tabindex="-1"></a>    }</span>
<span id="cb224-135"><a href="chm-raster-resolution-testing.html#cb224-135" tabindex="-1"></a>  })</span>
<span id="cb224-136"><a href="chm-raster-resolution-testing.html#cb224-136" tabindex="-1"></a><span class="co"># which successes?</span></span>
<span id="cb224-137"><a href="chm-raster-resolution-testing.html#cb224-137" tabindex="-1"></a>param_combos_gt_agg_flist</span></code></pre></div>
</div>
</div>
<div id="data-fusion-parameter-testing" class="section level2 hasAnchor" number="8.3">
<h2><span class="header-section-number">8.3</span> Data Fusion: Parameter Testing<a href="chm-raster-resolution-testing.html#data-fusion-parameter-testing" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We also reviewed a <a href="data_fusion.html#data_fusion">data fusion approach</a> that uses both a CHM generated from aerial point cloud data (for structural information) and RGB imagery, whereby initial candidate slash piles are first identified based on their structural form and then, filtered spectrally using the RGB imagery. We created a <a href="data_fusion.html#polygon_spectral_filtering">process</a> to perform this filtering which takes as input: 1) a spatial data frame of candidate polygons; 2) a raster with RGB spectral data; 3) user-defined spectral weighting (voting system). let’s apply that process to the candidate piles detected using the structural data only from the prior section.</p>
<div class="sourceCode" id="cb225"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb225-1"><a href="chm-raster-resolution-testing.html#cb225-1" tabindex="-1"></a>param_combos_spectral_gt_flist <span class="ot">&lt;-</span> chm_res_list <span class="sc">%&gt;%</span> </span>
<span id="cb225-2"><a href="chm-raster-resolution-testing.html#cb225-2" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">map</span>(<span class="cf">function</span>(chm_res_m){</span>
<span id="cb225-3"><a href="chm-raster-resolution-testing.html#cb225-3" tabindex="-1"></a>    <span class="fu">message</span>(<span class="fu">paste0</span>(<span class="st">&quot;param_combos_spectral_gt...........&quot;</span>,chm_res_m))</span>
<span id="cb225-4"><a href="chm-raster-resolution-testing.html#cb225-4" tabindex="-1"></a>    <span class="co"># param_combos_piles file</span></span>
<span id="cb225-5"><a href="chm-raster-resolution-testing.html#cb225-5" tabindex="-1"></a>    param_combos_piles_fnm <span class="ot">&lt;-</span> param_combos_piles_flist <span class="sc">%&gt;%</span> stringr<span class="sc">::</span><span class="fu">str_subset</span>(<span class="at">pattern =</span> <span class="fu">paste0</span>(<span class="st">&quot;chm&quot;</span>,chm_res_m,<span class="st">&quot;m.gpkg&quot;</span>)) <span class="sc">%&gt;%</span> purrr<span class="sc">::</span><span class="fu">pluck</span>(<span class="dv">1</span>)</span>
<span id="cb225-6"><a href="chm-raster-resolution-testing.html#cb225-6" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">is.null</span>(param_combos_piles_fnm) <span class="sc">||</span> <span class="sc">!</span><span class="fu">file.exists</span>(param_combos_piles_fnm)){<span class="fu">return</span>(<span class="cn">NULL</span>)}</span>
<span id="cb225-7"><a href="chm-raster-resolution-testing.html#cb225-7" tabindex="-1"></a>    <span class="co"># param_combos_gt file</span></span>
<span id="cb225-8"><a href="chm-raster-resolution-testing.html#cb225-8" tabindex="-1"></a>    param_combos_gt_fnm <span class="ot">&lt;-</span> param_combos_gt_flist <span class="sc">%&gt;%</span> stringr<span class="sc">::</span><span class="fu">str_subset</span>(<span class="at">pattern =</span> <span class="fu">paste0</span>(<span class="st">&quot;chm&quot;</span>,chm_res_m,<span class="st">&quot;m.csv&quot;</span>)) <span class="sc">%&gt;%</span> purrr<span class="sc">::</span><span class="fu">pluck</span>(<span class="dv">1</span>)</span>
<span id="cb225-9"><a href="chm-raster-resolution-testing.html#cb225-9" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">is.null</span>(param_combos_gt_fnm) <span class="sc">||</span> <span class="sc">!</span><span class="fu">file.exists</span>(param_combos_gt_fnm)){<span class="fu">return</span>(<span class="cn">NULL</span>)}</span>
<span id="cb225-10"><a href="chm-raster-resolution-testing.html#cb225-10" tabindex="-1"></a>    <span class="co"># file creating now</span></span>
<span id="cb225-11"><a href="chm-raster-resolution-testing.html#cb225-11" tabindex="-1"></a>    f_temp <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">&quot;../data&quot;</span>,<span class="fu">paste0</span>(<span class="st">&quot;param_combos_spectral_gt_chm&quot;</span>,chm_res_m,<span class="st">&quot;m.csv&quot;</span>))</span>
<span id="cb225-12"><a href="chm-raster-resolution-testing.html#cb225-12" tabindex="-1"></a>    <span class="co"># check and do it</span></span>
<span id="cb225-13"><a href="chm-raster-resolution-testing.html#cb225-13" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(f_temp)){</span>
<span id="cb225-14"><a href="chm-raster-resolution-testing.html#cb225-14" tabindex="-1"></a>      <span class="co"># read param_combos_piles</span></span>
<span id="cb225-15"><a href="chm-raster-resolution-testing.html#cb225-15" tabindex="-1"></a>      param_combos_piles <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_read</span>(param_combos_piles_fnm)</span>
<span id="cb225-16"><a href="chm-raster-resolution-testing.html#cb225-16" tabindex="-1"></a>      <span class="co"># read param_combos_piles</span></span>
<span id="cb225-17"><a href="chm-raster-resolution-testing.html#cb225-17" tabindex="-1"></a>      param_combos_gt <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(param_combos_gt_fnm)</span>
<span id="cb225-18"><a href="chm-raster-resolution-testing.html#cb225-18" tabindex="-1"></a>      </span>
<span id="cb225-19"><a href="chm-raster-resolution-testing.html#cb225-19" tabindex="-1"></a>      <span class="do">#######################################</span></span>
<span id="cb225-20"><a href="chm-raster-resolution-testing.html#cb225-20" tabindex="-1"></a>      <span class="co"># let&#39;s attach a flag to only work with piles that intersect with the stand boundary</span></span>
<span id="cb225-21"><a href="chm-raster-resolution-testing.html#cb225-21" tabindex="-1"></a>      <span class="co"># add in/out to piles data</span></span>
<span id="cb225-22"><a href="chm-raster-resolution-testing.html#cb225-22" tabindex="-1"></a>      <span class="do">#######################################</span></span>
<span id="cb225-23"><a href="chm-raster-resolution-testing.html#cb225-23" tabindex="-1"></a>      param_combos_spectral_gt <span class="ot">&lt;-</span> </span>
<span id="cb225-24"><a href="chm-raster-resolution-testing.html#cb225-24" tabindex="-1"></a>        <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>) <span class="sc">%&gt;%</span></span>
<span id="cb225-25"><a href="chm-raster-resolution-testing.html#cb225-25" tabindex="-1"></a>        purrr<span class="sc">::</span><span class="fu">map</span>(<span class="cf">function</span>(sw){</span>
<span id="cb225-26"><a href="chm-raster-resolution-testing.html#cb225-26" tabindex="-1"></a>          <span class="co"># polygon_spectral_filtering</span></span>
<span id="cb225-27"><a href="chm-raster-resolution-testing.html#cb225-27" tabindex="-1"></a>          param_combos_piles_filtered <span class="ot">&lt;-</span> <span class="fu">polygon_spectral_filtering</span>(</span>
<span id="cb225-28"><a href="chm-raster-resolution-testing.html#cb225-28" tabindex="-1"></a>              <span class="at">sf_data =</span> param_combos_piles</span>
<span id="cb225-29"><a href="chm-raster-resolution-testing.html#cb225-29" tabindex="-1"></a>              , <span class="at">rgb_rast =</span> ortho_rast</span>
<span id="cb225-30"><a href="chm-raster-resolution-testing.html#cb225-30" tabindex="-1"></a>              , <span class="at">red_band_idx =</span> <span class="dv">1</span></span>
<span id="cb225-31"><a href="chm-raster-resolution-testing.html#cb225-31" tabindex="-1"></a>              , <span class="at">green_band_idx =</span> <span class="dv">2</span></span>
<span id="cb225-32"><a href="chm-raster-resolution-testing.html#cb225-32" tabindex="-1"></a>              , <span class="at">blue_band_idx =</span> <span class="dv">3</span></span>
<span id="cb225-33"><a href="chm-raster-resolution-testing.html#cb225-33" tabindex="-1"></a>              , <span class="at">spectral_weight =</span> sw</span>
<span id="cb225-34"><a href="chm-raster-resolution-testing.html#cb225-34" tabindex="-1"></a>            ) <span class="sc">%&gt;%</span></span>
<span id="cb225-35"><a href="chm-raster-resolution-testing.html#cb225-35" tabindex="-1"></a>            dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">spectral_weight=</span>sw)</span>
<span id="cb225-36"><a href="chm-raster-resolution-testing.html#cb225-36" tabindex="-1"></a>          </span>
<span id="cb225-37"><a href="chm-raster-resolution-testing.html#cb225-37" tabindex="-1"></a>          <span class="co"># dplyr::glimpse(param_combos_piles_filtered)</span></span>
<span id="cb225-38"><a href="chm-raster-resolution-testing.html#cb225-38" tabindex="-1"></a>          <span class="co"># param_combos_piles_filtered %&gt;% sf::st_drop_geometry() %&gt;% dplyr::count(rn) %&gt;%  </span></span>
<span id="cb225-39"><a href="chm-raster-resolution-testing.html#cb225-39" tabindex="-1"></a>          <span class="co">#   dplyr::inner_join(</span></span>
<span id="cb225-40"><a href="chm-raster-resolution-testing.html#cb225-40" tabindex="-1"></a>          <span class="co">#     param_combos_piles %&gt;% sf::st_drop_geometry() %&gt;% dplyr::count(rn) %&gt;% dplyr::rename(orig_n=n)</span></span>
<span id="cb225-41"><a href="chm-raster-resolution-testing.html#cb225-41" tabindex="-1"></a>          <span class="co">#   ) %&gt;% </span></span>
<span id="cb225-42"><a href="chm-raster-resolution-testing.html#cb225-42" tabindex="-1"></a>          <span class="co">#   dplyr::arrange(desc(orig_n-n))</span></span>
<span id="cb225-43"><a href="chm-raster-resolution-testing.html#cb225-43" tabindex="-1"></a>          </span>
<span id="cb225-44"><a href="chm-raster-resolution-testing.html#cb225-44" tabindex="-1"></a>          <span class="co"># now we need to reclassify the combinations against the ground truth data</span></span>
<span id="cb225-45"><a href="chm-raster-resolution-testing.html#cb225-45" tabindex="-1"></a>          gt_reclassify <span class="ot">&lt;-</span></span>
<span id="cb225-46"><a href="chm-raster-resolution-testing.html#cb225-46" tabindex="-1"></a>            param_combos_gt <span class="sc">%&gt;%</span> </span>
<span id="cb225-47"><a href="chm-raster-resolution-testing.html#cb225-47" tabindex="-1"></a>              <span class="co"># add info from predictions</span></span>
<span id="cb225-48"><a href="chm-raster-resolution-testing.html#cb225-48" tabindex="-1"></a>              dplyr<span class="sc">::</span><span class="fu">left_join</span>(</span>
<span id="cb225-49"><a href="chm-raster-resolution-testing.html#cb225-49" tabindex="-1"></a>                param_combos_piles_filtered <span class="sc">%&gt;%</span></span>
<span id="cb225-50"><a href="chm-raster-resolution-testing.html#cb225-50" tabindex="-1"></a>                  sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span></span>
<span id="cb225-51"><a href="chm-raster-resolution-testing.html#cb225-51" tabindex="-1"></a>                  dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb225-52"><a href="chm-raster-resolution-testing.html#cb225-52" tabindex="-1"></a>                    rn,pred_id,spectral_weight</span>
<span id="cb225-53"><a href="chm-raster-resolution-testing.html#cb225-53" tabindex="-1"></a>                  )</span>
<span id="cb225-54"><a href="chm-raster-resolution-testing.html#cb225-54" tabindex="-1"></a>                , <span class="at">by =</span> dplyr<span class="sc">::</span><span class="fu">join_by</span>(rn,pred_id)</span>
<span id="cb225-55"><a href="chm-raster-resolution-testing.html#cb225-55" tabindex="-1"></a>              ) <span class="sc">%&gt;%</span></span>
<span id="cb225-56"><a href="chm-raster-resolution-testing.html#cb225-56" tabindex="-1"></a>              <span class="co"># dplyr::count(match_grp)</span></span>
<span id="cb225-57"><a href="chm-raster-resolution-testing.html#cb225-57" tabindex="-1"></a>              <span class="co"># reclassify</span></span>
<span id="cb225-58"><a href="chm-raster-resolution-testing.html#cb225-58" tabindex="-1"></a>              dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb225-59"><a href="chm-raster-resolution-testing.html#cb225-59" tabindex="-1"></a>                <span class="co"># reclassify match_grp</span></span>
<span id="cb225-60"><a href="chm-raster-resolution-testing.html#cb225-60" tabindex="-1"></a>                <span class="at">match_grp =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb225-61"><a href="chm-raster-resolution-testing.html#cb225-61" tabindex="-1"></a>                  match_grp <span class="sc">==</span> <span class="st">&quot;true positive&quot;</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(spectral_weight) <span class="sc">~</span> <span class="st">&quot;omission&quot;</span> <span class="co"># is.na(spectral_weight) =&gt; removed by spectral filtering</span></span>
<span id="cb225-62"><a href="chm-raster-resolution-testing.html#cb225-62" tabindex="-1"></a>                  , match_grp <span class="sc">==</span> <span class="st">&quot;commission&quot;</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(spectral_weight) <span class="sc">~</span> <span class="st">&quot;remove&quot;</span> <span class="co"># is.na(spectral_weight) =&gt; removed by spectral filtering</span></span>
<span id="cb225-63"><a href="chm-raster-resolution-testing.html#cb225-63" tabindex="-1"></a>                  , T <span class="sc">~</span> match_grp</span>
<span id="cb225-64"><a href="chm-raster-resolution-testing.html#cb225-64" tabindex="-1"></a>                )</span>
<span id="cb225-65"><a href="chm-raster-resolution-testing.html#cb225-65" tabindex="-1"></a>                <span class="co"># update pred_id</span></span>
<span id="cb225-66"><a href="chm-raster-resolution-testing.html#cb225-66" tabindex="-1"></a>                , <span class="at">pred_id =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb225-67"><a href="chm-raster-resolution-testing.html#cb225-67" tabindex="-1"></a>                  match_grp <span class="sc">==</span> <span class="st">&quot;omission&quot;</span> <span class="sc">~</span> <span class="cn">NA</span></span>
<span id="cb225-68"><a href="chm-raster-resolution-testing.html#cb225-68" tabindex="-1"></a>                  , T <span class="sc">~</span> pred_id</span>
<span id="cb225-69"><a href="chm-raster-resolution-testing.html#cb225-69" tabindex="-1"></a>                )</span>
<span id="cb225-70"><a href="chm-raster-resolution-testing.html#cb225-70" tabindex="-1"></a>                <span class="co"># update spectral_weight (just adds it to this iteration&#39;s omissions)</span></span>
<span id="cb225-71"><a href="chm-raster-resolution-testing.html#cb225-71" tabindex="-1"></a>                , <span class="at">spectral_weight =</span> sw</span>
<span id="cb225-72"><a href="chm-raster-resolution-testing.html#cb225-72" tabindex="-1"></a>              ) <span class="sc">%&gt;%</span> </span>
<span id="cb225-73"><a href="chm-raster-resolution-testing.html#cb225-73" tabindex="-1"></a>              <span class="co"># remove old commissions</span></span>
<span id="cb225-74"><a href="chm-raster-resolution-testing.html#cb225-74" tabindex="-1"></a>              <span class="co"># dplyr::count(match_grp)</span></span>
<span id="cb225-75"><a href="chm-raster-resolution-testing.html#cb225-75" tabindex="-1"></a>              dplyr<span class="sc">::</span><span class="fu">filter</span>(match_grp<span class="sc">!=</span><span class="st">&quot;remove&quot;</span>)</span>
<span id="cb225-76"><a href="chm-raster-resolution-testing.html#cb225-76" tabindex="-1"></a>          <span class="co"># return</span></span>
<span id="cb225-77"><a href="chm-raster-resolution-testing.html#cb225-77" tabindex="-1"></a>          <span class="fu">return</span>(gt_reclassify)</span>
<span id="cb225-78"><a href="chm-raster-resolution-testing.html#cb225-78" tabindex="-1"></a>        }) <span class="sc">%&gt;%</span> </span>
<span id="cb225-79"><a href="chm-raster-resolution-testing.html#cb225-79" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">bind_rows</span>()</span>
<span id="cb225-80"><a href="chm-raster-resolution-testing.html#cb225-80" tabindex="-1"></a>      </span>
<span id="cb225-81"><a href="chm-raster-resolution-testing.html#cb225-81" tabindex="-1"></a>      <span class="co"># write it</span></span>
<span id="cb225-82"><a href="chm-raster-resolution-testing.html#cb225-82" tabindex="-1"></a>      param_combos_spectral_gt <span class="sc">%&gt;%</span> readr<span class="sc">::</span><span class="fu">write_csv</span>(f_temp, <span class="at">append =</span> F, <span class="at">progress =</span> F)</span>
<span id="cb225-83"><a href="chm-raster-resolution-testing.html#cb225-83" tabindex="-1"></a>      <span class="fu">return</span>(f_temp)</span>
<span id="cb225-84"><a href="chm-raster-resolution-testing.html#cb225-84" tabindex="-1"></a>    }<span class="cf">else</span> <span class="cf">if</span>(<span class="fu">file.exists</span>(f_temp)){</span>
<span id="cb225-85"><a href="chm-raster-resolution-testing.html#cb225-85" tabindex="-1"></a>      <span class="fu">return</span>(f_temp)</span>
<span id="cb225-86"><a href="chm-raster-resolution-testing.html#cb225-86" tabindex="-1"></a>    }<span class="cf">else</span>{</span>
<span id="cb225-87"><a href="chm-raster-resolution-testing.html#cb225-87" tabindex="-1"></a>      <span class="fu">return</span>(<span class="cn">NULL</span>)</span>
<span id="cb225-88"><a href="chm-raster-resolution-testing.html#cb225-88" tabindex="-1"></a>    }</span>
<span id="cb225-89"><a href="chm-raster-resolution-testing.html#cb225-89" tabindex="-1"></a>  })</span>
<span id="cb225-90"><a href="chm-raster-resolution-testing.html#cb225-90" tabindex="-1"></a><span class="co"># which successes?</span></span>
<span id="cb225-91"><a href="chm-raster-resolution-testing.html#cb225-91" tabindex="-1"></a>param_combos_spectral_gt_flist</span></code></pre></div>
<div id="aggregate-validation-metrics-to-parameter-combination-1" class="section level3 hasAnchor" number="8.3.1">
<h3><span class="header-section-number">8.3.1</span> Aggregate Validation Metrics to Parameter Combination<a href="chm-raster-resolution-testing.html#aggregate-validation-metrics-to-parameter-combination-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>now we’re going to calculate aggregated detection accuracy metrics and quantification accuracy metrics</p>
<div class="sourceCode" id="cb226"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb226-1"><a href="chm-raster-resolution-testing.html#cb226-1" tabindex="-1"></a>param_combos_spectral_gt_agg_flist <span class="ot">&lt;-</span> chm_res_list <span class="sc">%&gt;%</span> </span>
<span id="cb226-2"><a href="chm-raster-resolution-testing.html#cb226-2" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">map</span>(<span class="cf">function</span>(chm_res_m){</span>
<span id="cb226-3"><a href="chm-raster-resolution-testing.html#cb226-3" tabindex="-1"></a>    <span class="fu">message</span>(<span class="fu">paste0</span>(<span class="st">&quot;param_combos_spectral_gt_agg...........&quot;</span>,chm_res_m))</span>
<span id="cb226-4"><a href="chm-raster-resolution-testing.html#cb226-4" tabindex="-1"></a>    <span class="co"># param_combos_piles file</span></span>
<span id="cb226-5"><a href="chm-raster-resolution-testing.html#cb226-5" tabindex="-1"></a>    param_combos_piles_fnm <span class="ot">&lt;-</span> param_combos_piles_flist <span class="sc">%&gt;%</span> stringr<span class="sc">::</span><span class="fu">str_subset</span>(<span class="at">pattern =</span> <span class="fu">paste0</span>(<span class="st">&quot;chm&quot;</span>,chm_res_m,<span class="st">&quot;m.gpkg&quot;</span>)) <span class="sc">%&gt;%</span> purrr<span class="sc">::</span><span class="fu">pluck</span>(<span class="dv">1</span>)</span>
<span id="cb226-6"><a href="chm-raster-resolution-testing.html#cb226-6" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">is.null</span>(param_combos_piles_fnm) <span class="sc">||</span> <span class="sc">!</span><span class="fu">file.exists</span>(param_combos_piles_fnm)){<span class="fu">return</span>(<span class="cn">NULL</span>)}</span>
<span id="cb226-7"><a href="chm-raster-resolution-testing.html#cb226-7" tabindex="-1"></a>    <span class="co"># param_combos_gt file</span></span>
<span id="cb226-8"><a href="chm-raster-resolution-testing.html#cb226-8" tabindex="-1"></a>    param_combos_gt_fnm <span class="ot">&lt;-</span> param_combos_gt_flist <span class="sc">%&gt;%</span> stringr<span class="sc">::</span><span class="fu">str_subset</span>(<span class="at">pattern =</span> <span class="fu">paste0</span>(<span class="st">&quot;chm&quot;</span>,chm_res_m,<span class="st">&quot;m.csv&quot;</span>)) <span class="sc">%&gt;%</span> purrr<span class="sc">::</span><span class="fu">pluck</span>(<span class="dv">1</span>)</span>
<span id="cb226-9"><a href="chm-raster-resolution-testing.html#cb226-9" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">is.null</span>(param_combos_gt_fnm) <span class="sc">||</span> <span class="sc">!</span><span class="fu">file.exists</span>(param_combos_gt_fnm)){<span class="fu">return</span>(<span class="cn">NULL</span>)}</span>
<span id="cb226-10"><a href="chm-raster-resolution-testing.html#cb226-10" tabindex="-1"></a>    <span class="co"># param_combos_spectral_gt_flist file</span></span>
<span id="cb226-11"><a href="chm-raster-resolution-testing.html#cb226-11" tabindex="-1"></a>    param_combos_spectral_gt_fnm <span class="ot">&lt;-</span> param_combos_spectral_gt_flist <span class="sc">%&gt;%</span> stringr<span class="sc">::</span><span class="fu">str_subset</span>(<span class="at">pattern =</span> <span class="fu">paste0</span>(<span class="st">&quot;chm&quot;</span>,chm_res_m,<span class="st">&quot;m.csv&quot;</span>)) <span class="sc">%&gt;%</span> purrr<span class="sc">::</span><span class="fu">pluck</span>(<span class="dv">1</span>)</span>
<span id="cb226-12"><a href="chm-raster-resolution-testing.html#cb226-12" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">is.null</span>(param_combos_spectral_gt_fnm) <span class="sc">||</span> <span class="sc">!</span><span class="fu">file.exists</span>(param_combos_spectral_gt_fnm)){<span class="fu">return</span>(<span class="cn">NULL</span>)}</span>
<span id="cb226-13"><a href="chm-raster-resolution-testing.html#cb226-13" tabindex="-1"></a>    <span class="co"># file creating now</span></span>
<span id="cb226-14"><a href="chm-raster-resolution-testing.html#cb226-14" tabindex="-1"></a>    f_temp <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">&quot;../data&quot;</span>,<span class="fu">paste0</span>(<span class="st">&quot;param_combos_spectral_gt_agg_chm&quot;</span>,chm_res_m,<span class="st">&quot;m.csv&quot;</span>))</span>
<span id="cb226-15"><a href="chm-raster-resolution-testing.html#cb226-15" tabindex="-1"></a>    <span class="co"># check and do it</span></span>
<span id="cb226-16"><a href="chm-raster-resolution-testing.html#cb226-16" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(f_temp)){</span>
<span id="cb226-17"><a href="chm-raster-resolution-testing.html#cb226-17" tabindex="-1"></a>      <span class="co"># read param_combos_piles</span></span>
<span id="cb226-18"><a href="chm-raster-resolution-testing.html#cb226-18" tabindex="-1"></a>      param_combos_piles <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_read</span>(param_combos_piles_fnm)</span>
<span id="cb226-19"><a href="chm-raster-resolution-testing.html#cb226-19" tabindex="-1"></a>      <span class="co"># read param_combos_gt</span></span>
<span id="cb226-20"><a href="chm-raster-resolution-testing.html#cb226-20" tabindex="-1"></a>      param_combos_gt <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(param_combos_gt_fnm)</span>
<span id="cb226-21"><a href="chm-raster-resolution-testing.html#cb226-21" tabindex="-1"></a>      <span class="co"># read param_combos_spectral_gt</span></span>
<span id="cb226-22"><a href="chm-raster-resolution-testing.html#cb226-22" tabindex="-1"></a>      param_combos_spectral_gt <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(param_combos_spectral_gt_fnm)</span>
<span id="cb226-23"><a href="chm-raster-resolution-testing.html#cb226-23" tabindex="-1"></a>      </span>
<span id="cb226-24"><a href="chm-raster-resolution-testing.html#cb226-24" tabindex="-1"></a>      <span class="do">#######################################</span></span>
<span id="cb226-25"><a href="chm-raster-resolution-testing.html#cb226-25" tabindex="-1"></a>      <span class="co"># let&#39;s attach a flag to only work with piles that intersect with the stand boundary</span></span>
<span id="cb226-26"><a href="chm-raster-resolution-testing.html#cb226-26" tabindex="-1"></a>      <span class="co"># add in/out to piles data</span></span>
<span id="cb226-27"><a href="chm-raster-resolution-testing.html#cb226-27" tabindex="-1"></a>      <span class="do">#######################################</span></span>
<span id="cb226-28"><a href="chm-raster-resolution-testing.html#cb226-28" tabindex="-1"></a>      param_combos_piles <span class="ot">&lt;-</span> param_combos_piles <span class="sc">%&gt;%</span> </span>
<span id="cb226-29"><a href="chm-raster-resolution-testing.html#cb226-29" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">left_join</span>(</span>
<span id="cb226-30"><a href="chm-raster-resolution-testing.html#cb226-30" tabindex="-1"></a>          param_combos_piles <span class="sc">%&gt;%</span> </span>
<span id="cb226-31"><a href="chm-raster-resolution-testing.html#cb226-31" tabindex="-1"></a>            sf<span class="sc">::</span><span class="fu">st_intersection</span>(</span>
<span id="cb226-32"><a href="chm-raster-resolution-testing.html#cb226-32" tabindex="-1"></a>              stand_boundary <span class="sc">%&gt;%</span> </span>
<span id="cb226-33"><a href="chm-raster-resolution-testing.html#cb226-33" tabindex="-1"></a>                sf<span class="sc">::</span><span class="fu">st_transform</span>(sf<span class="sc">::</span><span class="fu">st_crs</span>(param_combos_piles))</span>
<span id="cb226-34"><a href="chm-raster-resolution-testing.html#cb226-34" tabindex="-1"></a>            ) <span class="sc">%&gt;%</span> </span>
<span id="cb226-35"><a href="chm-raster-resolution-testing.html#cb226-35" tabindex="-1"></a>            sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb226-36"><a href="chm-raster-resolution-testing.html#cb226-36" tabindex="-1"></a>            dplyr<span class="sc">::</span><span class="fu">select</span>(rn,pred_id) <span class="sc">%&gt;%</span> </span>
<span id="cb226-37"><a href="chm-raster-resolution-testing.html#cb226-37" tabindex="-1"></a>            dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">is_in_stand =</span> T)</span>
<span id="cb226-38"><a href="chm-raster-resolution-testing.html#cb226-38" tabindex="-1"></a>          , <span class="at">by =</span> dplyr<span class="sc">::</span><span class="fu">join_by</span>(rn,pred_id)</span>
<span id="cb226-39"><a href="chm-raster-resolution-testing.html#cb226-39" tabindex="-1"></a>        ) <span class="sc">%&gt;%</span> </span>
<span id="cb226-40"><a href="chm-raster-resolution-testing.html#cb226-40" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb226-41"><a href="chm-raster-resolution-testing.html#cb226-41" tabindex="-1"></a>          <span class="at">is_in_stand =</span> dplyr<span class="sc">::</span><span class="fu">coalesce</span>(is_in_stand,F)</span>
<span id="cb226-42"><a href="chm-raster-resolution-testing.html#cb226-42" tabindex="-1"></a>        ) <span class="sc">%&gt;%</span> </span>
<span id="cb226-43"><a href="chm-raster-resolution-testing.html#cb226-43" tabindex="-1"></a>        <span class="co"># # get the length (diameter) and width of the polygon</span></span>
<span id="cb226-44"><a href="chm-raster-resolution-testing.html#cb226-44" tabindex="-1"></a>        <span class="co"># st_bbox_by_row(dimensions = T) %&gt;% # gets shape_length, where shape_length=length of longest bbox side</span></span>
<span id="cb226-45"><a href="chm-raster-resolution-testing.html#cb226-45" tabindex="-1"></a>        <span class="co"># and paraboloid volume</span></span>
<span id="cb226-46"><a href="chm-raster-resolution-testing.html#cb226-46" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb226-47"><a href="chm-raster-resolution-testing.html#cb226-47" tabindex="-1"></a>          <span class="co"># paraboloid_volume_m3 = (1/8) * pi * (shape_length^2) * max_height_m</span></span>
<span id="cb226-48"><a href="chm-raster-resolution-testing.html#cb226-48" tabindex="-1"></a>          <span class="at">paraboloid_volume_m3 =</span> (<span class="dv">1</span><span class="sc">/</span><span class="dv">8</span>) <span class="sc">*</span> pi <span class="sc">*</span> (diameter_m<span class="sc">^</span><span class="dv">2</span>) <span class="sc">*</span> max_height_m</span>
<span id="cb226-49"><a href="chm-raster-resolution-testing.html#cb226-49" tabindex="-1"></a>        )</span>
<span id="cb226-50"><a href="chm-raster-resolution-testing.html#cb226-50" tabindex="-1"></a>      <span class="co"># param_combos_piles %&gt;% dplyr::glimpse()</span></span>
<span id="cb226-51"><a href="chm-raster-resolution-testing.html#cb226-51" tabindex="-1"></a>      <span class="do">#######################################</span></span>
<span id="cb226-52"><a href="chm-raster-resolution-testing.html#cb226-52" tabindex="-1"></a>      <span class="co"># add data to validation</span></span>
<span id="cb226-53"><a href="chm-raster-resolution-testing.html#cb226-53" tabindex="-1"></a>      <span class="do">#######################################</span></span>
<span id="cb226-54"><a href="chm-raster-resolution-testing.html#cb226-54" tabindex="-1"></a>      <span class="co"># add it to validation</span></span>
<span id="cb226-55"><a href="chm-raster-resolution-testing.html#cb226-55" tabindex="-1"></a>      param_combos_spectral_gt <span class="ot">&lt;-</span></span>
<span id="cb226-56"><a href="chm-raster-resolution-testing.html#cb226-56" tabindex="-1"></a>        param_combos_spectral_gt <span class="sc">%&gt;%</span> </span>
<span id="cb226-57"><a href="chm-raster-resolution-testing.html#cb226-57" tabindex="-1"></a>        <span class="co"># add original candidate piles from the structural watershed method with spectral_weight=0</span></span>
<span id="cb226-58"><a href="chm-raster-resolution-testing.html#cb226-58" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(</span>
<span id="cb226-59"><a href="chm-raster-resolution-testing.html#cb226-59" tabindex="-1"></a>          param_combos_gt <span class="sc">%&gt;%</span> </span>
<span id="cb226-60"><a href="chm-raster-resolution-testing.html#cb226-60" tabindex="-1"></a>            dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">spectral_weight=</span><span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb226-61"><a href="chm-raster-resolution-testing.html#cb226-61" tabindex="-1"></a>            dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">names</span>(param_combos_spectral_gt))</span>
<span id="cb226-62"><a href="chm-raster-resolution-testing.html#cb226-62" tabindex="-1"></a>        ) <span class="sc">%&gt;%</span> </span>
<span id="cb226-63"><a href="chm-raster-resolution-testing.html#cb226-63" tabindex="-1"></a>        <span class="co"># make a description of spectral_weight</span></span>
<span id="cb226-64"><a href="chm-raster-resolution-testing.html#cb226-64" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb226-65"><a href="chm-raster-resolution-testing.html#cb226-65" tabindex="-1"></a>          <span class="at">spectral_weight_desc =</span> <span class="fu">factor</span>(</span>
<span id="cb226-66"><a href="chm-raster-resolution-testing.html#cb226-66" tabindex="-1"></a>            spectral_weight</span>
<span id="cb226-67"><a href="chm-raster-resolution-testing.html#cb226-67" tabindex="-1"></a>            , <span class="at">ordered =</span> T</span>
<span id="cb226-68"><a href="chm-raster-resolution-testing.html#cb226-68" tabindex="-1"></a>            , <span class="at">levels =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">5</span></span>
<span id="cb226-69"><a href="chm-raster-resolution-testing.html#cb226-69" tabindex="-1"></a>            , <span class="at">labels =</span> <span class="fu">c</span>(</span>
<span id="cb226-70"><a href="chm-raster-resolution-testing.html#cb226-70" tabindex="-1"></a>              <span class="st">&quot;no spectral criteria&quot;</span></span>
<span id="cb226-71"><a href="chm-raster-resolution-testing.html#cb226-71" tabindex="-1"></a>              , <span class="st">&quot;1 spectral criteria req.&quot;</span></span>
<span id="cb226-72"><a href="chm-raster-resolution-testing.html#cb226-72" tabindex="-1"></a>              , <span class="st">&quot;2 spectral criteria req.&quot;</span></span>
<span id="cb226-73"><a href="chm-raster-resolution-testing.html#cb226-73" tabindex="-1"></a>              , <span class="st">&quot;3 spectral criteria req.&quot;</span></span>
<span id="cb226-74"><a href="chm-raster-resolution-testing.html#cb226-74" tabindex="-1"></a>              , <span class="st">&quot;4 spectral criteria req.&quot;</span></span>
<span id="cb226-75"><a href="chm-raster-resolution-testing.html#cb226-75" tabindex="-1"></a>              , <span class="st">&quot;5 spectral criteria req.&quot;</span></span>
<span id="cb226-76"><a href="chm-raster-resolution-testing.html#cb226-76" tabindex="-1"></a>            )</span>
<span id="cb226-77"><a href="chm-raster-resolution-testing.html#cb226-77" tabindex="-1"></a>          )</span>
<span id="cb226-78"><a href="chm-raster-resolution-testing.html#cb226-78" tabindex="-1"></a>        ) <span class="sc">%&gt;%</span> </span>
<span id="cb226-79"><a href="chm-raster-resolution-testing.html#cb226-79" tabindex="-1"></a>        <span class="co"># add area of gt</span></span>
<span id="cb226-80"><a href="chm-raster-resolution-testing.html#cb226-80" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">left_join</span>(</span>
<span id="cb226-81"><a href="chm-raster-resolution-testing.html#cb226-81" tabindex="-1"></a>          slash_piles_polys <span class="sc">%&gt;%</span> </span>
<span id="cb226-82"><a href="chm-raster-resolution-testing.html#cb226-82" tabindex="-1"></a>            sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb226-83"><a href="chm-raster-resolution-testing.html#cb226-83" tabindex="-1"></a>            dplyr<span class="sc">::</span><span class="fu">select</span>(pile_id,image_gt_area_m2,height_m,field_diameter_m) <span class="sc">%&gt;%</span> </span>
<span id="cb226-84"><a href="chm-raster-resolution-testing.html#cb226-84" tabindex="-1"></a>            dplyr<span class="sc">::</span><span class="fu">rename</span>(</span>
<span id="cb226-85"><a href="chm-raster-resolution-testing.html#cb226-85" tabindex="-1"></a>              <span class="at">gt_height_m =</span> height_m</span>
<span id="cb226-86"><a href="chm-raster-resolution-testing.html#cb226-86" tabindex="-1"></a>              , <span class="at">gt_diameter_m =</span> field_diameter_m</span>
<span id="cb226-87"><a href="chm-raster-resolution-testing.html#cb226-87" tabindex="-1"></a>              , <span class="at">gt_area_m2 =</span> image_gt_area_m2</span>
<span id="cb226-88"><a href="chm-raster-resolution-testing.html#cb226-88" tabindex="-1"></a>            ) <span class="sc">%&gt;%</span> </span>
<span id="cb226-89"><a href="chm-raster-resolution-testing.html#cb226-89" tabindex="-1"></a>            dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">pile_id=</span><span class="fu">as.numeric</span>(pile_id))</span>
<span id="cb226-90"><a href="chm-raster-resolution-testing.html#cb226-90" tabindex="-1"></a>          , <span class="at">by =</span> <span class="st">&quot;pile_id&quot;</span></span>
<span id="cb226-91"><a href="chm-raster-resolution-testing.html#cb226-91" tabindex="-1"></a>        ) <span class="sc">%&gt;%</span> </span>
<span id="cb226-92"><a href="chm-raster-resolution-testing.html#cb226-92" tabindex="-1"></a>        <span class="co"># add info from predictions</span></span>
<span id="cb226-93"><a href="chm-raster-resolution-testing.html#cb226-93" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">left_join</span>(</span>
<span id="cb226-94"><a href="chm-raster-resolution-testing.html#cb226-94" tabindex="-1"></a>          param_combos_piles <span class="sc">%&gt;%</span></span>
<span id="cb226-95"><a href="chm-raster-resolution-testing.html#cb226-95" tabindex="-1"></a>            sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span></span>
<span id="cb226-96"><a href="chm-raster-resolution-testing.html#cb226-96" tabindex="-1"></a>            dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb226-97"><a href="chm-raster-resolution-testing.html#cb226-97" tabindex="-1"></a>              rn,pred_id</span>
<span id="cb226-98"><a href="chm-raster-resolution-testing.html#cb226-98" tabindex="-1"></a>              ,is_in_stand</span>
<span id="cb226-99"><a href="chm-raster-resolution-testing.html#cb226-99" tabindex="-1"></a>              , area_m2, volume_m3, max_height_m, diameter_m</span>
<span id="cb226-100"><a href="chm-raster-resolution-testing.html#cb226-100" tabindex="-1"></a>              , paraboloid_volume_m3</span>
<span id="cb226-101"><a href="chm-raster-resolution-testing.html#cb226-101" tabindex="-1"></a>              <span class="co"># , shape_length # , shape_width</span></span>
<span id="cb226-102"><a href="chm-raster-resolution-testing.html#cb226-102" tabindex="-1"></a>            ) <span class="sc">%&gt;%</span> </span>
<span id="cb226-103"><a href="chm-raster-resolution-testing.html#cb226-103" tabindex="-1"></a>            dplyr<span class="sc">::</span><span class="fu">rename</span>(</span>
<span id="cb226-104"><a href="chm-raster-resolution-testing.html#cb226-104" tabindex="-1"></a>              <span class="at">pred_area_m2 =</span> area_m2, <span class="at">pred_volume_m3 =</span> volume_m3</span>
<span id="cb226-105"><a href="chm-raster-resolution-testing.html#cb226-105" tabindex="-1"></a>              , <span class="at">pred_height_m =</span> max_height_m, <span class="at">pred_diameter_m =</span> diameter_m</span>
<span id="cb226-106"><a href="chm-raster-resolution-testing.html#cb226-106" tabindex="-1"></a>              , <span class="at">pred_paraboloid_volume_m3 =</span> paraboloid_volume_m3</span>
<span id="cb226-107"><a href="chm-raster-resolution-testing.html#cb226-107" tabindex="-1"></a>            )</span>
<span id="cb226-108"><a href="chm-raster-resolution-testing.html#cb226-108" tabindex="-1"></a>          , <span class="at">by =</span> dplyr<span class="sc">::</span><span class="fu">join_by</span>(rn,pred_id)</span>
<span id="cb226-109"><a href="chm-raster-resolution-testing.html#cb226-109" tabindex="-1"></a>        ) <span class="sc">%&gt;%</span></span>
<span id="cb226-110"><a href="chm-raster-resolution-testing.html#cb226-110" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb226-111"><a href="chm-raster-resolution-testing.html#cb226-111" tabindex="-1"></a>          <span class="at">is_in_stand =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb226-112"><a href="chm-raster-resolution-testing.html#cb226-112" tabindex="-1"></a>            is_in_stand <span class="sc">==</span> T <span class="sc">~</span> T</span>
<span id="cb226-113"><a href="chm-raster-resolution-testing.html#cb226-113" tabindex="-1"></a>            , is_in_stand <span class="sc">==</span> F <span class="sc">~</span> F</span>
<span id="cb226-114"><a href="chm-raster-resolution-testing.html#cb226-114" tabindex="-1"></a>            , match_grp <span class="sc">==</span> <span class="st">&quot;omission&quot;</span> <span class="sc">~</span> T</span>
<span id="cb226-115"><a href="chm-raster-resolution-testing.html#cb226-115" tabindex="-1"></a>            , T <span class="sc">~</span> F</span>
<span id="cb226-116"><a href="chm-raster-resolution-testing.html#cb226-116" tabindex="-1"></a>          )</span>
<span id="cb226-117"><a href="chm-raster-resolution-testing.html#cb226-117" tabindex="-1"></a>          <span class="do">### calculate these based on the formulas below...agg_ground_truth_match() depends on those formulas</span></span>
<span id="cb226-118"><a href="chm-raster-resolution-testing.html#cb226-118" tabindex="-1"></a>          <span class="co"># area_m2</span></span>
<span id="cb226-119"><a href="chm-raster-resolution-testing.html#cb226-119" tabindex="-1"></a>          , <span class="at">diff_area_m2 =</span> pred_area_m2<span class="sc">-</span>gt_area_m2</span>
<span id="cb226-120"><a href="chm-raster-resolution-testing.html#cb226-120" tabindex="-1"></a>          , <span class="at">pct_diff_area_m2 =</span> (gt_area_m2<span class="sc">-</span>pred_area_m2)<span class="sc">/</span>gt_area_m2</span>
<span id="cb226-121"><a href="chm-raster-resolution-testing.html#cb226-121" tabindex="-1"></a>          <span class="co"># height_m</span></span>
<span id="cb226-122"><a href="chm-raster-resolution-testing.html#cb226-122" tabindex="-1"></a>          , <span class="at">diff_height_m =</span> pred_height_m<span class="sc">-</span>gt_height_m</span>
<span id="cb226-123"><a href="chm-raster-resolution-testing.html#cb226-123" tabindex="-1"></a>          , <span class="at">pct_diff_height_m =</span> (gt_height_m<span class="sc">-</span>pred_height_m)<span class="sc">/</span>gt_height_m</span>
<span id="cb226-124"><a href="chm-raster-resolution-testing.html#cb226-124" tabindex="-1"></a>          <span class="co"># diameter_m</span></span>
<span id="cb226-125"><a href="chm-raster-resolution-testing.html#cb226-125" tabindex="-1"></a>          , <span class="at">diff_diameter_m =</span> pred_diameter_m<span class="sc">-</span>gt_diameter_m</span>
<span id="cb226-126"><a href="chm-raster-resolution-testing.html#cb226-126" tabindex="-1"></a>          , <span class="at">pct_diff_diameter_m =</span> (gt_diameter_m<span class="sc">-</span>pred_diameter_m)<span class="sc">/</span>gt_diameter_m</span>
<span id="cb226-127"><a href="chm-raster-resolution-testing.html#cb226-127" tabindex="-1"></a>        )</span>
<span id="cb226-128"><a href="chm-raster-resolution-testing.html#cb226-128" tabindex="-1"></a>      </span>
<span id="cb226-129"><a href="chm-raster-resolution-testing.html#cb226-129" tabindex="-1"></a>      <span class="do">#######################################</span></span>
<span id="cb226-130"><a href="chm-raster-resolution-testing.html#cb226-130" tabindex="-1"></a>      <span class="co"># aggregate results from ground_truth_prediction_match()</span></span>
<span id="cb226-131"><a href="chm-raster-resolution-testing.html#cb226-131" tabindex="-1"></a>      <span class="do">#######################################</span></span>
<span id="cb226-132"><a href="chm-raster-resolution-testing.html#cb226-132" tabindex="-1"></a>      <span class="co"># unique combinations</span></span>
<span id="cb226-133"><a href="chm-raster-resolution-testing.html#cb226-133" tabindex="-1"></a>      combo_temp <span class="ot">&lt;-</span> param_combos_spectral_gt <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">distinct</span>(rn,spectral_weight)</span>
<span id="cb226-134"><a href="chm-raster-resolution-testing.html#cb226-134" tabindex="-1"></a>      <span class="co"># aggregate results from ground_truth_prediction_match()</span></span>
<span id="cb226-135"><a href="chm-raster-resolution-testing.html#cb226-135" tabindex="-1"></a>      param_combos_spectral_gt_agg <span class="ot">&lt;-</span> </span>
<span id="cb226-136"><a href="chm-raster-resolution-testing.html#cb226-136" tabindex="-1"></a>        <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(combo_temp) <span class="sc">%&gt;%</span></span>
<span id="cb226-137"><a href="chm-raster-resolution-testing.html#cb226-137" tabindex="-1"></a>        purrr<span class="sc">::</span><span class="fu">map</span>(\(x)</span>
<span id="cb226-138"><a href="chm-raster-resolution-testing.html#cb226-138" tabindex="-1"></a>          <span class="fu">agg_ground_truth_match</span>(</span>
<span id="cb226-139"><a href="chm-raster-resolution-testing.html#cb226-139" tabindex="-1"></a>            param_combos_spectral_gt <span class="sc">%&gt;%</span> </span>
<span id="cb226-140"><a href="chm-raster-resolution-testing.html#cb226-140" tabindex="-1"></a>              dplyr<span class="sc">::</span><span class="fu">filter</span>(</span>
<span id="cb226-141"><a href="chm-raster-resolution-testing.html#cb226-141" tabindex="-1"></a>                is_in_stand</span>
<span id="cb226-142"><a href="chm-raster-resolution-testing.html#cb226-142" tabindex="-1"></a>                <span class="sc">&amp;</span> rn <span class="sc">==</span> combo_temp<span class="sc">$</span>rn[x]</span>
<span id="cb226-143"><a href="chm-raster-resolution-testing.html#cb226-143" tabindex="-1"></a>                <span class="sc">&amp;</span> spectral_weight <span class="sc">==</span> combo_temp<span class="sc">$</span>spectral_weight[x]</span>
<span id="cb226-144"><a href="chm-raster-resolution-testing.html#cb226-144" tabindex="-1"></a>              )</span>
<span id="cb226-145"><a href="chm-raster-resolution-testing.html#cb226-145" tabindex="-1"></a>          ) <span class="sc">%&gt;%</span> </span>
<span id="cb226-146"><a href="chm-raster-resolution-testing.html#cb226-146" tabindex="-1"></a>          dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb226-147"><a href="chm-raster-resolution-testing.html#cb226-147" tabindex="-1"></a>            <span class="at">rn =</span> combo_temp<span class="sc">$</span>rn[x]</span>
<span id="cb226-148"><a href="chm-raster-resolution-testing.html#cb226-148" tabindex="-1"></a>            , <span class="at">spectral_weight =</span> combo_temp<span class="sc">$</span>spectral_weight[x]</span>
<span id="cb226-149"><a href="chm-raster-resolution-testing.html#cb226-149" tabindex="-1"></a>          ) <span class="sc">%&gt;%</span> </span>
<span id="cb226-150"><a href="chm-raster-resolution-testing.html#cb226-150" tabindex="-1"></a>          dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">!</span>tidyselect<span class="sc">::</span><span class="fu">starts_with</span>(<span class="st">&quot;gt_&quot;</span>))</span>
<span id="cb226-151"><a href="chm-raster-resolution-testing.html#cb226-151" tabindex="-1"></a>        ) <span class="sc">%&gt;%</span> </span>
<span id="cb226-152"><a href="chm-raster-resolution-testing.html#cb226-152" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">bind_rows</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb226-153"><a href="chm-raster-resolution-testing.html#cb226-153" tabindex="-1"></a>        <span class="co"># add in info on all parameter combinations</span></span>
<span id="cb226-154"><a href="chm-raster-resolution-testing.html#cb226-154" tabindex="-1"></a>        <span class="co"># add in info on all parameter combinations</span></span>
<span id="cb226-155"><a href="chm-raster-resolution-testing.html#cb226-155" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">inner_join</span>(</span>
<span id="cb226-156"><a href="chm-raster-resolution-testing.html#cb226-156" tabindex="-1"></a>          param_combos_df</span>
<span id="cb226-157"><a href="chm-raster-resolution-testing.html#cb226-157" tabindex="-1"></a>          , <span class="at">by =</span> <span class="st">&quot;rn&quot;</span></span>
<span id="cb226-158"><a href="chm-raster-resolution-testing.html#cb226-158" tabindex="-1"></a>          , <span class="at">relationship =</span> <span class="st">&quot;many-to-one&quot;</span></span>
<span id="cb226-159"><a href="chm-raster-resolution-testing.html#cb226-159" tabindex="-1"></a>        )</span>
<span id="cb226-160"><a href="chm-raster-resolution-testing.html#cb226-160" tabindex="-1"></a>      <span class="co"># write it</span></span>
<span id="cb226-161"><a href="chm-raster-resolution-testing.html#cb226-161" tabindex="-1"></a>      param_combos_spectral_gt_agg <span class="sc">%&gt;%</span> readr<span class="sc">::</span><span class="fu">write_csv</span>(f_temp, <span class="at">append =</span> F, <span class="at">progress =</span> F)</span>
<span id="cb226-162"><a href="chm-raster-resolution-testing.html#cb226-162" tabindex="-1"></a>      <span class="fu">return</span>(f_temp)</span>
<span id="cb226-163"><a href="chm-raster-resolution-testing.html#cb226-163" tabindex="-1"></a>    }<span class="cf">else</span> <span class="cf">if</span>(<span class="fu">file.exists</span>(f_temp)){</span>
<span id="cb226-164"><a href="chm-raster-resolution-testing.html#cb226-164" tabindex="-1"></a>      <span class="fu">return</span>(f_temp)</span>
<span id="cb226-165"><a href="chm-raster-resolution-testing.html#cb226-165" tabindex="-1"></a>    }<span class="cf">else</span>{</span>
<span id="cb226-166"><a href="chm-raster-resolution-testing.html#cb226-166" tabindex="-1"></a>      <span class="fu">return</span>(<span class="cn">NULL</span>)</span>
<span id="cb226-167"><a href="chm-raster-resolution-testing.html#cb226-167" tabindex="-1"></a>    }</span>
<span id="cb226-168"><a href="chm-raster-resolution-testing.html#cb226-168" tabindex="-1"></a>  })</span>
<span id="cb226-169"><a href="chm-raster-resolution-testing.html#cb226-169" tabindex="-1"></a><span class="co"># which successes?</span></span>
<span id="cb226-170"><a href="chm-raster-resolution-testing.html#cb226-170" tabindex="-1"></a>param_combos_spectral_gt_agg_flist</span></code></pre></div>
</div>
</div>
<div id="read-data-for-analysis" class="section level2 hasAnchor" number="8.4">
<h2><span class="header-section-number">8.4</span> Read Data for Analysis<a href="chm-raster-resolution-testing.html#read-data-for-analysis" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>let’s read this data in for analysis</p>
<div id="structural-only" class="section level3 hasAnchor" number="8.4.1">
<h3><span class="header-section-number">8.4.1</span> Structural Only<a href="chm-raster-resolution-testing.html#structural-only" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb227"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb227-1"><a href="chm-raster-resolution-testing.html#cb227-1" tabindex="-1"></a>param_combos_gt_agg <span class="ot">&lt;-</span> </span>
<span id="cb227-2"><a href="chm-raster-resolution-testing.html#cb227-2" tabindex="-1"></a>  chm_res_list <span class="sc">%&gt;%</span> </span>
<span id="cb227-3"><a href="chm-raster-resolution-testing.html#cb227-3" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">map</span>(<span class="cf">function</span>(chm_res_m){</span>
<span id="cb227-4"><a href="chm-raster-resolution-testing.html#cb227-4" tabindex="-1"></a>    <span class="co"># param_combos_gt file</span></span>
<span id="cb227-5"><a href="chm-raster-resolution-testing.html#cb227-5" tabindex="-1"></a>    fnm <span class="ot">&lt;-</span> param_combos_gt_agg_flist <span class="sc">%&gt;%</span> stringr<span class="sc">::</span><span class="fu">str_subset</span>(<span class="at">pattern =</span> <span class="fu">paste0</span>(<span class="st">&quot;chm&quot;</span>,chm_res_m,<span class="st">&quot;m.csv&quot;</span>)) <span class="sc">%&gt;%</span> purrr<span class="sc">::</span><span class="fu">pluck</span>(<span class="dv">1</span>)</span>
<span id="cb227-6"><a href="chm-raster-resolution-testing.html#cb227-6" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">is.null</span>(fnm) <span class="sc">||</span> <span class="sc">!</span><span class="fu">file.exists</span>(fnm)){<span class="fu">return</span>(<span class="cn">NULL</span>)}</span>
<span id="cb227-7"><a href="chm-raster-resolution-testing.html#cb227-7" tabindex="-1"></a>    <span class="co"># read it</span></span>
<span id="cb227-8"><a href="chm-raster-resolution-testing.html#cb227-8" tabindex="-1"></a>    readr<span class="sc">::</span><span class="fu">read_csv</span>(fnm, <span class="at">progress =</span> F, <span class="at">show_col_types =</span> F) <span class="sc">%&gt;%</span> </span>
<span id="cb227-9"><a href="chm-raster-resolution-testing.html#cb227-9" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">chm_res_m =</span> chm_res_m)</span>
<span id="cb227-10"><a href="chm-raster-resolution-testing.html#cb227-10" tabindex="-1"></a>  }) <span class="sc">%&gt;%</span> </span>
<span id="cb227-11"><a href="chm-raster-resolution-testing.html#cb227-11" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">bind_rows</span>()</span>
<span id="cb227-12"><a href="chm-raster-resolution-testing.html#cb227-12" tabindex="-1"></a>  </span>
<span id="cb227-13"><a href="chm-raster-resolution-testing.html#cb227-13" tabindex="-1"></a><span class="co"># add in combos that returned no results</span></span>
<span id="cb227-14"><a href="chm-raster-resolution-testing.html#cb227-14" tabindex="-1"></a><span class="co"># param_combos_gt_agg %&gt;% dplyr::mutate(tot = tp_n + fn_n) %&gt;% dplyr::select(tot) %&gt;% summary()</span></span>
<span id="cb227-15"><a href="chm-raster-resolution-testing.html#cb227-15" tabindex="-1"></a><span class="co"># (slash_piles_polys %&gt;% dplyr::filter(is_in_stand) %&gt;% nrow())</span></span>
<span id="cb227-16"><a href="chm-raster-resolution-testing.html#cb227-16" tabindex="-1"></a>param_combos_gt_agg <span class="ot">&lt;-</span> param_combos_df <span class="sc">%&gt;%</span> </span>
<span id="cb227-17"><a href="chm-raster-resolution-testing.html#cb227-17" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">crossing</span>(</span>
<span id="cb227-18"><a href="chm-raster-resolution-testing.html#cb227-18" tabindex="-1"></a>    <span class="at">chm_res_m =</span> chm_res_list</span>
<span id="cb227-19"><a href="chm-raster-resolution-testing.html#cb227-19" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb227-20"><a href="chm-raster-resolution-testing.html#cb227-20" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(</span>
<span id="cb227-21"><a href="chm-raster-resolution-testing.html#cb227-21" tabindex="-1"></a>   param_combos_gt_agg <span class="sc">%&gt;%</span> </span>
<span id="cb227-22"><a href="chm-raster-resolution-testing.html#cb227-22" tabindex="-1"></a>    <span class="co"># throw in hey_xxxxxxxxxx to test it works if we include non-existant columns</span></span>
<span id="cb227-23"><a href="chm-raster-resolution-testing.html#cb227-23" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>( <span class="sc">-</span>dplyr<span class="sc">::</span><span class="fu">any_of</span>(<span class="fu">c</span>(</span>
<span id="cb227-24"><a href="chm-raster-resolution-testing.html#cb227-24" tabindex="-1"></a>      <span class="st">&quot;hey_xxxxxxxxxx&quot;</span></span>
<span id="cb227-25"><a href="chm-raster-resolution-testing.html#cb227-25" tabindex="-1"></a>      , <span class="fu">names</span>(param_combos_df <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(rn)))</span>
<span id="cb227-26"><a href="chm-raster-resolution-testing.html#cb227-26" tabindex="-1"></a>    )))</span>
<span id="cb227-27"><a href="chm-raster-resolution-testing.html#cb227-27" tabindex="-1"></a>   , <span class="at">by =</span> dplyr<span class="sc">::</span><span class="fu">join_by</span>(rn,chm_res_m)</span>
<span id="cb227-28"><a href="chm-raster-resolution-testing.html#cb227-28" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb227-29"><a href="chm-raster-resolution-testing.html#cb227-29" tabindex="-1"></a>  <span class="co"># fill TP,FP,FN counts for those with no predictions</span></span>
<span id="cb227-30"><a href="chm-raster-resolution-testing.html#cb227-30" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb227-31"><a href="chm-raster-resolution-testing.html#cb227-31" tabindex="-1"></a>    <span class="at">chm_res_m_desc =</span> <span class="fu">paste0</span>(chm_res_m, <span class="st">&quot;m CHM&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">factor</span>() <span class="sc">%&gt;%</span> forcats<span class="sc">::</span><span class="fu">fct_reorder</span>(chm_res_m)</span>
<span id="cb227-32"><a href="chm-raster-resolution-testing.html#cb227-32" tabindex="-1"></a>    , <span class="at">fn_n =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb227-33"><a href="chm-raster-resolution-testing.html#cb227-33" tabindex="-1"></a>      <span class="fu">is.na</span>(tp_n) <span class="sc">&amp;</span> <span class="fu">is.na</span>(fp_n) <span class="sc">&amp;</span> <span class="fu">is.na</span>(fn_n) <span class="sc">~</span> (slash_piles_polys <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(is_in_stand) <span class="sc">%&gt;%</span> <span class="fu">nrow</span>())</span>
<span id="cb227-34"><a href="chm-raster-resolution-testing.html#cb227-34" tabindex="-1"></a>      , T <span class="sc">~</span> fn_n</span>
<span id="cb227-35"><a href="chm-raster-resolution-testing.html#cb227-35" tabindex="-1"></a>    )</span>
<span id="cb227-36"><a href="chm-raster-resolution-testing.html#cb227-36" tabindex="-1"></a>    , dplyr<span class="sc">::</span><span class="fu">across</span>(</span>
<span id="cb227-37"><a href="chm-raster-resolution-testing.html#cb227-37" tabindex="-1"></a>      <span class="fu">c</span>(tp_n,fp_n)</span>
<span id="cb227-38"><a href="chm-raster-resolution-testing.html#cb227-38" tabindex="-1"></a>      , <span class="sc">~</span>dplyr<span class="sc">::</span><span class="fu">coalesce</span>(.x,<span class="dv">0</span>)</span>
<span id="cb227-39"><a href="chm-raster-resolution-testing.html#cb227-39" tabindex="-1"></a>    )</span>
<span id="cb227-40"><a href="chm-raster-resolution-testing.html#cb227-40" tabindex="-1"></a>    , </span>
<span id="cb227-41"><a href="chm-raster-resolution-testing.html#cb227-41" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb227-42"><a href="chm-raster-resolution-testing.html#cb227-42" tabindex="-1"></a>  <span class="co"># fill detection rates for those with no predictions</span></span>
<span id="cb227-43"><a href="chm-raster-resolution-testing.html#cb227-43" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb227-44"><a href="chm-raster-resolution-testing.html#cb227-44" tabindex="-1"></a>    <span class="at">omission_rate =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb227-45"><a href="chm-raster-resolution-testing.html#cb227-45" tabindex="-1"></a>      <span class="fu">is.na</span>(omission_rate) <span class="sc">&amp;</span> dplyr<span class="sc">::</span><span class="fu">coalesce</span>(tp_n,<span class="dv">0</span>) <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> dplyr<span class="sc">::</span><span class="fu">coalesce</span>(fn_n,<span class="dv">0</span>) <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="dv">1</span> <span class="co"># every single actual pile was missed</span></span>
<span id="cb227-46"><a href="chm-raster-resolution-testing.html#cb227-46" tabindex="-1"></a>      , T <span class="sc">~</span> omission_rate</span>
<span id="cb227-47"><a href="chm-raster-resolution-testing.html#cb227-47" tabindex="-1"></a>    ) <span class="co"># False Negative Rate or Miss Rate</span></span>
<span id="cb227-48"><a href="chm-raster-resolution-testing.html#cb227-48" tabindex="-1"></a>    , <span class="at">commission_rate =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb227-49"><a href="chm-raster-resolution-testing.html#cb227-49" tabindex="-1"></a>      <span class="fu">is.na</span>(commission_rate) <span class="sc">&amp;</span> dplyr<span class="sc">::</span><span class="fu">coalesce</span>(tp_n,<span class="dv">0</span>) <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> dplyr<span class="sc">::</span><span class="fu">coalesce</span>(fp_n,<span class="dv">0</span>) <span class="sc">==</span> <span class="dv">0</span> <span class="sc">~</span> <span class="dv">0</span> <span class="co"># if no predictions are made, the model could not have made any commission errors</span></span>
<span id="cb227-50"><a href="chm-raster-resolution-testing.html#cb227-50" tabindex="-1"></a>      , T <span class="sc">~</span> commission_rate</span>
<span id="cb227-51"><a href="chm-raster-resolution-testing.html#cb227-51" tabindex="-1"></a>    ) <span class="co"># False Positive Rate</span></span>
<span id="cb227-52"><a href="chm-raster-resolution-testing.html#cb227-52" tabindex="-1"></a>    , <span class="at">precision =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb227-53"><a href="chm-raster-resolution-testing.html#cb227-53" tabindex="-1"></a>      <span class="fu">is.na</span>(precision) <span class="sc">&amp;</span> dplyr<span class="sc">::</span><span class="fu">coalesce</span>(tp_n,<span class="dv">0</span>) <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> dplyr<span class="sc">::</span><span class="fu">coalesce</span>(fp_n,<span class="dv">0</span>) <span class="sc">==</span> <span class="dv">0</span> <span class="sc">~</span> <span class="dv">1</span> <span class="co"># if no predictions are made, the model made zero incorrect positive claims</span></span>
<span id="cb227-54"><a href="chm-raster-resolution-testing.html#cb227-54" tabindex="-1"></a>      , T <span class="sc">~</span> precision</span>
<span id="cb227-55"><a href="chm-raster-resolution-testing.html#cb227-55" tabindex="-1"></a>    )</span>
<span id="cb227-56"><a href="chm-raster-resolution-testing.html#cb227-56" tabindex="-1"></a>    , <span class="at">recall =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb227-57"><a href="chm-raster-resolution-testing.html#cb227-57" tabindex="-1"></a>      <span class="fu">is.na</span>(recall) <span class="sc">&amp;</span> dplyr<span class="sc">::</span><span class="fu">coalesce</span>(tp_n,<span class="dv">0</span>) <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> dplyr<span class="sc">::</span><span class="fu">coalesce</span>(fn_n,<span class="dv">0</span>) <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="dv">0</span> <span class="co"># every single actual pile was missed</span></span>
<span id="cb227-58"><a href="chm-raster-resolution-testing.html#cb227-58" tabindex="-1"></a>      , T <span class="sc">~</span> recall</span>
<span id="cb227-59"><a href="chm-raster-resolution-testing.html#cb227-59" tabindex="-1"></a>    )</span>
<span id="cb227-60"><a href="chm-raster-resolution-testing.html#cb227-60" tabindex="-1"></a>    , <span class="at">f_score =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb227-61"><a href="chm-raster-resolution-testing.html#cb227-61" tabindex="-1"></a>      <span class="fu">is.na</span>(f_score) <span class="sc">&amp;</span> ( dplyr<span class="sc">::</span><span class="fu">coalesce</span>(precision,<span class="dv">0</span>) <span class="sc">==</span> <span class="dv">0</span> <span class="sc">|</span> dplyr<span class="sc">::</span><span class="fu">coalesce</span>(recall,<span class="dv">0</span>) <span class="sc">==</span> <span class="dv">0</span> ) <span class="sc">~</span> <span class="dv">0</span></span>
<span id="cb227-62"><a href="chm-raster-resolution-testing.html#cb227-62" tabindex="-1"></a>      , T <span class="sc">~</span> f_score</span>
<span id="cb227-63"><a href="chm-raster-resolution-testing.html#cb227-63" tabindex="-1"></a>    ) </span>
<span id="cb227-64"><a href="chm-raster-resolution-testing.html#cb227-64" tabindex="-1"></a>  )</span></code></pre></div>
<p>what did we get from all of that work?</p>
<div class="sourceCode" id="cb228"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb228-1"><a href="chm-raster-resolution-testing.html#cb228-1" tabindex="-1"></a>param_combos_gt_agg <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">glimpse</span>()</span></code></pre></div>
<pre><code>## Rows: 5,880
## Columns: 25
## $ rn                       &lt;dbl&gt; 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, …
## $ max_ht_m                 &lt;dbl&gt; 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, …
## $ min_area_m2              &lt;dbl&gt; 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, …
## $ max_area_m2              &lt;dbl&gt; 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 1…
## $ convexity_pct            &lt;dbl&gt; 0.05, 0.05, 0.05, 0.05, 0.05, 0.05, 0.05, 0.0…
## $ circle_fit_iou_pct       &lt;dbl&gt; 0.05, 0.05, 0.05, 0.05, 0.05, 0.20, 0.20, 0.2…
## $ chm_res_m                &lt;dbl&gt; 0.1, 0.2, 0.3, 0.4, 0.5, 0.1, 0.2, 0.3, 0.4, …
## $ tp_n                     &lt;dbl&gt; 98, 97, 91, 79, 59, 95, 90, 80, 72, 51, 91, 8…
## $ fp_n                     &lt;dbl&gt; 76, 126, 156, 184, 266, 70, 108, 140, 174, 25…
## $ fn_n                     &lt;dbl&gt; 23, 24, 30, 42, 62, 26, 31, 41, 49, 70, 30, 4…
## $ omission_rate            &lt;dbl&gt; 0.1900826, 0.1983471, 0.2479339, 0.3471074, 0…
## $ commission_rate          &lt;dbl&gt; 0.43678161, 0.56502242, 0.63157895, 0.6996197…
## $ precision                &lt;dbl&gt; 0.5632184, 0.4349776, 0.3684211, 0.3003802, 0…
## $ recall                   &lt;dbl&gt; 0.8099174, 0.8016529, 0.7520661, 0.6528926, 0…
## $ f_score                  &lt;dbl&gt; 0.6644068, 0.5639535, 0.4945652, 0.4114583, 0…
## $ diff_area_m2_rmse        &lt;dbl&gt; 0.9553187, 1.0630419, 1.7936904, 4.7264949, 3…
## $ diff_diameter_m_rmse     &lt;dbl&gt; 0.4146916, 0.6204824, 0.7931262, 1.1344303, 1…
## $ diff_height_m_rmse       &lt;dbl&gt; 0.3186457, 0.3295112, 0.3433166, 0.5022307, 0…
## $ diff_area_m2_mean        &lt;dbl&gt; -0.4845496, 0.5805644, 1.5061345, 1.7276581, …
## $ diff_diameter_m_mean     &lt;dbl&gt; 0.1722271, 0.4569563, 0.6992050, 0.8418140, 1…
## $ diff_height_m_mean       &lt;dbl&gt; -0.2039459, -0.2158827, -0.2325115, -0.284825…
## $ pct_diff_area_m2_mape    &lt;dbl&gt; 0.1077556, 0.1273854, 0.2328611, 0.3611736, 0…
## $ pct_diff_diameter_m_mape &lt;dbl&gt; 0.09959918, 0.16915037, 0.24160115, 0.3229551…
## $ pct_diff_height_m_mape   &lt;dbl&gt; 0.1255508, 0.1306792, 0.1348453, 0.1453663, 0…
## $ chm_res_m_desc           &lt;fct&gt; 0.1m CHM, 0.2m CHM, 0.3m CHM, 0.4m CHM, 0.5m …</code></pre>
<p>we should have the same number of records per tested CHM resolution as the number of parameter records tested (n = 1,176) for an overall total of 5,880 combinations tested</p>
<div class="sourceCode" id="cb230"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb230-1"><a href="chm-raster-resolution-testing.html#cb230-1" tabindex="-1"></a>param_combos_gt_agg <span class="sc">%&gt;%</span></span>
<span id="cb230-2"><a href="chm-raster-resolution-testing.html#cb230-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">count</span>(chm_res_m_desc)</span></code></pre></div>
<pre><code>## # A tibble: 5 × 2
##   chm_res_m_desc     n
##   &lt;fct&gt;          &lt;int&gt;
## 1 0.1m CHM        1176
## 2 0.2m CHM        1176
## 3 0.3m CHM        1176
## 4 0.4m CHM        1176
## 5 0.5m CHM        1176</code></pre>
<p>that is close enough as all we are looking to do is assess the sensitivity of the parameterization of the detection method and identify the most appropriate parameter settings to use for a given CHM resolution</p>
</div>
<div id="data-fusion" class="section level3 hasAnchor" number="8.4.2">
<h3><span class="header-section-number">8.4.2</span> Data Fusion<a href="chm-raster-resolution-testing.html#data-fusion" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb232"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb232-1"><a href="chm-raster-resolution-testing.html#cb232-1" tabindex="-1"></a>param_combos_spectral_gt_agg <span class="ot">&lt;-</span> </span>
<span id="cb232-2"><a href="chm-raster-resolution-testing.html#cb232-2" tabindex="-1"></a>  chm_res_list <span class="sc">%&gt;%</span> </span>
<span id="cb232-3"><a href="chm-raster-resolution-testing.html#cb232-3" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">map</span>(<span class="cf">function</span>(chm_res_m){</span>
<span id="cb232-4"><a href="chm-raster-resolution-testing.html#cb232-4" tabindex="-1"></a>    <span class="co"># param_combos_gt file</span></span>
<span id="cb232-5"><a href="chm-raster-resolution-testing.html#cb232-5" tabindex="-1"></a>    fnm <span class="ot">&lt;-</span> param_combos_spectral_gt_agg_flist <span class="sc">%&gt;%</span> stringr<span class="sc">::</span><span class="fu">str_subset</span>(<span class="at">pattern =</span> <span class="fu">paste0</span>(<span class="st">&quot;chm&quot;</span>,chm_res_m,<span class="st">&quot;m.csv&quot;</span>)) <span class="sc">%&gt;%</span> purrr<span class="sc">::</span><span class="fu">pluck</span>(<span class="dv">1</span>)</span>
<span id="cb232-6"><a href="chm-raster-resolution-testing.html#cb232-6" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">is.null</span>(fnm) <span class="sc">||</span> <span class="sc">!</span><span class="fu">file.exists</span>(fnm)){<span class="fu">return</span>(<span class="cn">NULL</span>)}</span>
<span id="cb232-7"><a href="chm-raster-resolution-testing.html#cb232-7" tabindex="-1"></a>    <span class="co"># read it</span></span>
<span id="cb232-8"><a href="chm-raster-resolution-testing.html#cb232-8" tabindex="-1"></a>    readr<span class="sc">::</span><span class="fu">read_csv</span>(fnm, <span class="at">progress =</span> F, <span class="at">show_col_types =</span> F) <span class="sc">%&gt;%</span> </span>
<span id="cb232-9"><a href="chm-raster-resolution-testing.html#cb232-9" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">chm_res_m =</span> chm_res_m)</span>
<span id="cb232-10"><a href="chm-raster-resolution-testing.html#cb232-10" tabindex="-1"></a>  }) <span class="sc">%&gt;%</span> </span>
<span id="cb232-11"><a href="chm-raster-resolution-testing.html#cb232-11" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">bind_rows</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb232-12"><a href="chm-raster-resolution-testing.html#cb232-12" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb232-13"><a href="chm-raster-resolution-testing.html#cb232-13" tabindex="-1"></a>    <span class="at">chm_res_m_desc =</span> <span class="fu">paste0</span>(chm_res_m, <span class="st">&quot;m CHM&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">factor</span>() <span class="sc">%&gt;%</span> forcats<span class="sc">::</span><span class="fu">fct_reorder</span>(chm_res_m)</span>
<span id="cb232-14"><a href="chm-raster-resolution-testing.html#cb232-14" tabindex="-1"></a>    , <span class="at">spectral_weight_fact =</span> <span class="fu">ifelse</span>(spectral_weight<span class="sc">==</span><span class="dv">0</span>,<span class="st">&quot;structural only&quot;</span>,<span class="st">&quot;structural+spectral&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">factor</span>()</span>
<span id="cb232-15"><a href="chm-raster-resolution-testing.html#cb232-15" tabindex="-1"></a>  )</span>
<span id="cb232-16"><a href="chm-raster-resolution-testing.html#cb232-16" tabindex="-1"></a><span class="co"># param_combos_spectral_gt_agg %&gt;% dplyr::glimpse()</span></span></code></pre></div>
<p>what did we get from all of that work?</p>
<div class="sourceCode" id="cb233"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb233-1"><a href="chm-raster-resolution-testing.html#cb233-1" tabindex="-1"></a>param_combos_spectral_gt_agg <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">glimpse</span>()</span></code></pre></div>
<pre><code>## Rows: 35,280
## Columns: 27
## $ tp_n                     &lt;dbl&gt; 98, 95, 91, 88, 81, 50, 0, 98, 95, 91, 88, 81…
## $ fp_n                     &lt;dbl&gt; 76, 70, 55, 36, 15, 1, 0, 76, 70, 55, 36, 15,…
## $ fn_n                     &lt;dbl&gt; 23, 26, 30, 33, 40, 71, 121, 23, 26, 30, 33, …
## $ omission_rate            &lt;dbl&gt; 0.1900826, 0.2148760, 0.2479339, 0.2727273, 0…
## $ commission_rate          &lt;dbl&gt; 0.43678161, 0.42424242, 0.37671233, 0.2903225…
## $ precision                &lt;dbl&gt; 0.5632184, 0.5757576, 0.6232877, 0.7096774, 0…
## $ recall                   &lt;dbl&gt; 0.8099174, 0.7851240, 0.7520661, 0.7272727, 0…
## $ f_score                  &lt;dbl&gt; 0.6644068, 0.6643357, 0.6816479, 0.7183673, 0…
## $ diff_area_m2_rmse        &lt;dbl&gt; 0.9553187, 0.9671790, 0.9832242, 0.9714572, 0…
## $ diff_diameter_m_rmse     &lt;dbl&gt; 0.4146916, 0.4184979, 0.4186223, 0.4221027, 0…
## $ diff_height_m_rmse       &lt;dbl&gt; 0.3186457, 0.3232764, 0.3270866, 0.3098395, 0…
## $ diff_area_m2_mean        &lt;dbl&gt; -0.4845496, -0.4896862, -0.4906696, -0.478697…
## $ diff_diameter_m_mean     &lt;dbl&gt; 0.1722271, 0.1724538, 0.1737368, 0.1746051, 0…
## $ diff_height_m_mean       &lt;dbl&gt; -0.2039459, -0.2087653, -0.2134582, -0.204894…
## $ pct_diff_area_m2_mape    &lt;dbl&gt; 0.1077556, 0.1092832, 0.1113608, 0.1094018, 0…
## $ pct_diff_diameter_m_mape &lt;dbl&gt; 0.09959918, 0.10076252, 0.10063595, 0.1007289…
## $ pct_diff_height_m_mape   &lt;dbl&gt; 0.1255508, 0.1287027, 0.1322157, 0.1283063, 0…
## $ rn                       &lt;dbl&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14…
## $ spectral_weight          &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, …
## $ max_ht_m                 &lt;dbl&gt; 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, …
## $ min_area_m2              &lt;dbl&gt; 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, …
## $ max_area_m2              &lt;dbl&gt; 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 1…
## $ convexity_pct            &lt;dbl&gt; 0.05, 0.05, 0.05, 0.05, 0.05, 0.05, 0.05, 0.2…
## $ circle_fit_iou_pct       &lt;dbl&gt; 0.05, 0.20, 0.35, 0.50, 0.65, 0.80, 0.95, 0.0…
## $ chm_res_m                &lt;dbl&gt; 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, …
## $ chm_res_m_desc           &lt;fct&gt; 0.1m CHM, 0.1m CHM, 0.1m CHM, 0.1m CHM, 0.1m …
## $ spectral_weight_fact     &lt;fct&gt; structural+spectral, structural+spectral, str…</code></pre>
<div class="sourceCode" id="cb235"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb235-1"><a href="chm-raster-resolution-testing.html#cb235-1" tabindex="-1"></a><span class="co"># scales::comma(n_combos_tested*6,accuracy=1)</span></span></code></pre></div>
<p>we should have the same number of records per tested CHM resolution as the number of parameter records tested (n = 1,176) multiplied by six for the different five levels of the <code>spectral_weight</code> parameter tested when adding the spectral data in our data fusion approach and one combination representing no spectral data; for a total of 7,056 combinations tested per CHM resolution and an overall total of 35,280 combinations tested</p>
<div class="sourceCode" id="cb236"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb236-1"><a href="chm-raster-resolution-testing.html#cb236-1" tabindex="-1"></a>param_combos_spectral_gt_agg <span class="sc">%&gt;%</span> </span>
<span id="cb236-2"><a href="chm-raster-resolution-testing.html#cb236-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">count</span>(chm_res_m_desc)</span></code></pre></div>
<pre><code>## # A tibble: 5 × 2
##   chm_res_m_desc     n
##   &lt;fct&gt;          &lt;int&gt;
## 1 0.1m CHM        7056
## 2 0.2m CHM        7056
## 3 0.3m CHM        7056
## 4 0.4m CHM        7056
## 5 0.5m CHM        7056</code></pre>
<p>that is close enough as all we are looking to do is assess the sensitivity of the parameterization of the detection method and identify the most appropriate parameter settings to use for a given CHM resolution</p>
</div>
</div>
<div id="allthetests" class="section level2 hasAnchor" number="8.5">
<h2><span class="header-section-number">8.5</span> Structural Only: Sensitivity Testing<a href="chm-raster-resolution-testing.html#allthetests" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>let’s look at the sensitivity testing results for the raster-based method using only structural data of the study area from the CHM to evaluate how changes to the specific thresholds and settings within the detection methodology impact the final results. Since the method doesn’t use training data, its performance is highly dependent on these manually defined parameters</p>
<p>we tested a total of 1,176 combinations tested per CHM resolution and an overall total of 5,880 combinations tested</p>
<div id="detect_trends" class="section level3 hasAnchor" number="8.5.1">
<h3><span class="header-section-number">8.5.1</span> Main Effects: pile detection<a href="chm-raster-resolution-testing.html#detect_trends" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>what is the detection accuracy across all parameter combinations tested for each CHM resolution?</p>
<div class="sourceCode" id="cb238"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb238-1"><a href="chm-raster-resolution-testing.html#cb238-1" tabindex="-1"></a><span class="co"># this is a lot of work, so we&#39;re going to make it a function</span></span>
<span id="cb238-2"><a href="chm-raster-resolution-testing.html#cb238-2" tabindex="-1"></a>plt_detection_dist2 <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb238-3"><a href="chm-raster-resolution-testing.html#cb238-3" tabindex="-1"></a>  df</span>
<span id="cb238-4"><a href="chm-raster-resolution-testing.html#cb238-4" tabindex="-1"></a>  , <span class="at">my_subtitle =</span> <span class="st">&quot;&quot;</span></span>
<span id="cb238-5"><a href="chm-raster-resolution-testing.html#cb238-5" tabindex="-1"></a>  , <span class="at">show_rug =</span> T</span>
<span id="cb238-6"><a href="chm-raster-resolution-testing.html#cb238-6" tabindex="-1"></a>) {</span>
<span id="cb238-7"><a href="chm-raster-resolution-testing.html#cb238-7" tabindex="-1"></a>  <span class="co"># Construct the formula for facet_grid</span></span>
<span id="cb238-8"><a href="chm-raster-resolution-testing.html#cb238-8" tabindex="-1"></a>  <span class="co"># facet_formula &lt;- reformulate(&quot;metric&quot;, &quot;chm_res_m_desc&quot;) # reformulate(col_facet_var, row_facet_var)</span></span>
<span id="cb238-9"><a href="chm-raster-resolution-testing.html#cb238-9" tabindex="-1"></a>  </span>
<span id="cb238-10"><a href="chm-raster-resolution-testing.html#cb238-10" tabindex="-1"></a>  pal_eval_metric <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb238-11"><a href="chm-raster-resolution-testing.html#cb238-11" tabindex="-1"></a>    RColorBrewer<span class="sc">::</span><span class="fu">brewer.pal</span>(<span class="dv">3</span>,<span class="st">&quot;Oranges&quot;</span>)[<span class="dv">3</span>]</span>
<span id="cb238-12"><a href="chm-raster-resolution-testing.html#cb238-12" tabindex="-1"></a>    , RColorBrewer<span class="sc">::</span><span class="fu">brewer.pal</span>(<span class="dv">3</span>,<span class="st">&quot;Greys&quot;</span>)[<span class="dv">3</span>]</span>
<span id="cb238-13"><a href="chm-raster-resolution-testing.html#cb238-13" tabindex="-1"></a>    , RColorBrewer<span class="sc">::</span><span class="fu">brewer.pal</span>(<span class="dv">3</span>,<span class="st">&quot;Purples&quot;</span>)[<span class="dv">3</span>]</span>
<span id="cb238-14"><a href="chm-raster-resolution-testing.html#cb238-14" tabindex="-1"></a>  )</span>
<span id="cb238-15"><a href="chm-raster-resolution-testing.html#cb238-15" tabindex="-1"></a>  </span>
<span id="cb238-16"><a href="chm-raster-resolution-testing.html#cb238-16" tabindex="-1"></a>  df_temp <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> </span>
<span id="cb238-17"><a href="chm-raster-resolution-testing.html#cb238-17" tabindex="-1"></a>    tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(</span>
<span id="cb238-18"><a href="chm-raster-resolution-testing.html#cb238-18" tabindex="-1"></a>      <span class="at">cols =</span> <span class="fu">c</span>(precision,recall,f_score)</span>
<span id="cb238-19"><a href="chm-raster-resolution-testing.html#cb238-19" tabindex="-1"></a>      , <span class="at">names_to =</span> <span class="st">&quot;metric&quot;</span></span>
<span id="cb238-20"><a href="chm-raster-resolution-testing.html#cb238-20" tabindex="-1"></a>      , <span class="at">values_to =</span> <span class="st">&quot;value&quot;</span></span>
<span id="cb238-21"><a href="chm-raster-resolution-testing.html#cb238-21" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb238-22"><a href="chm-raster-resolution-testing.html#cb238-22" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb238-23"><a href="chm-raster-resolution-testing.html#cb238-23" tabindex="-1"></a>      <span class="at">metric =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb238-24"><a href="chm-raster-resolution-testing.html#cb238-24" tabindex="-1"></a>          metric <span class="sc">==</span> <span class="st">&quot;f_score&quot;</span> <span class="sc">~</span> <span class="dv">1</span></span>
<span id="cb238-25"><a href="chm-raster-resolution-testing.html#cb238-25" tabindex="-1"></a>          , metric <span class="sc">==</span> <span class="st">&quot;recall&quot;</span> <span class="sc">~</span> <span class="dv">2</span></span>
<span id="cb238-26"><a href="chm-raster-resolution-testing.html#cb238-26" tabindex="-1"></a>          , metric <span class="sc">==</span> <span class="st">&quot;precision&quot;</span> <span class="sc">~</span> <span class="dv">3</span></span>
<span id="cb238-27"><a href="chm-raster-resolution-testing.html#cb238-27" tabindex="-1"></a>        ) <span class="sc">%&gt;%</span> </span>
<span id="cb238-28"><a href="chm-raster-resolution-testing.html#cb238-28" tabindex="-1"></a>        <span class="fu">factor</span>(</span>
<span id="cb238-29"><a href="chm-raster-resolution-testing.html#cb238-29" tabindex="-1"></a>          <span class="at">ordered =</span> T</span>
<span id="cb238-30"><a href="chm-raster-resolution-testing.html#cb238-30" tabindex="-1"></a>          , <span class="at">levels =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span></span>
<span id="cb238-31"><a href="chm-raster-resolution-testing.html#cb238-31" tabindex="-1"></a>          , <span class="at">labels =</span> <span class="fu">c</span>(</span>
<span id="cb238-32"><a href="chm-raster-resolution-testing.html#cb238-32" tabindex="-1"></a>            <span class="st">&quot;F-score&quot;</span></span>
<span id="cb238-33"><a href="chm-raster-resolution-testing.html#cb238-33" tabindex="-1"></a>            , <span class="st">&quot;Recall&quot;</span></span>
<span id="cb238-34"><a href="chm-raster-resolution-testing.html#cb238-34" tabindex="-1"></a>            , <span class="st">&quot;Precision&quot;</span></span>
<span id="cb238-35"><a href="chm-raster-resolution-testing.html#cb238-35" tabindex="-1"></a>          )</span>
<span id="cb238-36"><a href="chm-raster-resolution-testing.html#cb238-36" tabindex="-1"></a>        )</span>
<span id="cb238-37"><a href="chm-raster-resolution-testing.html#cb238-37" tabindex="-1"></a>    ) </span>
<span id="cb238-38"><a href="chm-raster-resolution-testing.html#cb238-38" tabindex="-1"></a>  </span>
<span id="cb238-39"><a href="chm-raster-resolution-testing.html#cb238-39" tabindex="-1"></a>  <span class="co"># chm check</span></span>
<span id="cb238-40"><a href="chm-raster-resolution-testing.html#cb238-40" tabindex="-1"></a>  nrow_check <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> </span>
<span id="cb238-41"><a href="chm-raster-resolution-testing.html#cb238-41" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">count</span>(chm_res_m_desc) <span class="sc">%&gt;%</span> </span>
<span id="cb238-42"><a href="chm-raster-resolution-testing.html#cb238-42" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">pull</span>(n) <span class="sc">%&gt;%</span> </span>
<span id="cb238-43"><a href="chm-raster-resolution-testing.html#cb238-43" tabindex="-1"></a>    <span class="fu">max</span>()</span>
<span id="cb238-44"><a href="chm-raster-resolution-testing.html#cb238-44" tabindex="-1"></a>  </span>
<span id="cb238-45"><a href="chm-raster-resolution-testing.html#cb238-45" tabindex="-1"></a>  <span class="co"># plot </span></span>
<span id="cb238-46"><a href="chm-raster-resolution-testing.html#cb238-46" tabindex="-1"></a>  <span class="cf">if</span>(nrow_check<span class="sc">&lt;=</span><span class="dv">15</span>){</span>
<span id="cb238-47"><a href="chm-raster-resolution-testing.html#cb238-47" tabindex="-1"></a>    <span class="co"># round</span></span>
<span id="cb238-48"><a href="chm-raster-resolution-testing.html#cb238-48" tabindex="-1"></a>    df_temp <span class="ot">&lt;-</span> df_temp <span class="sc">%&gt;%</span> </span>
<span id="cb238-49"><a href="chm-raster-resolution-testing.html#cb238-49" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb238-50"><a href="chm-raster-resolution-testing.html#cb238-50" tabindex="-1"></a>        <span class="at">value =</span> <span class="fu">round</span>(value,<span class="dv">2</span>)</span>
<span id="cb238-51"><a href="chm-raster-resolution-testing.html#cb238-51" tabindex="-1"></a>      )</span>
<span id="cb238-52"><a href="chm-raster-resolution-testing.html#cb238-52" tabindex="-1"></a>    <span class="co"># agg for median plotting</span></span>
<span id="cb238-53"><a href="chm-raster-resolution-testing.html#cb238-53" tabindex="-1"></a>    xxxdf_temp <span class="ot">&lt;-</span> df_temp <span class="sc">%&gt;%</span> </span>
<span id="cb238-54"><a href="chm-raster-resolution-testing.html#cb238-54" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">group_by</span>(chm_res_m_desc,metric) <span class="sc">%&gt;%</span> </span>
<span id="cb238-55"><a href="chm-raster-resolution-testing.html#cb238-55" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">summarise</span>(<span class="at">value =</span> <span class="fu">median</span>(value,<span class="at">na.rm=</span>T)) <span class="sc">%&gt;%</span> </span>
<span id="cb238-56"><a href="chm-raster-resolution-testing.html#cb238-56" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb238-57"><a href="chm-raster-resolution-testing.html#cb238-57" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb238-58"><a href="chm-raster-resolution-testing.html#cb238-58" tabindex="-1"></a>        <span class="at">value_lab =</span> <span class="fu">paste0</span>(</span>
<span id="cb238-59"><a href="chm-raster-resolution-testing.html#cb238-59" tabindex="-1"></a>          <span class="st">&quot;median:</span><span class="sc">\n</span><span class="st">&quot;</span></span>
<span id="cb238-60"><a href="chm-raster-resolution-testing.html#cb238-60" tabindex="-1"></a>          , scales<span class="sc">::</span><span class="fu">percent</span>(value,<span class="at">accuracy=</span><span class="dv">1</span>)</span>
<span id="cb238-61"><a href="chm-raster-resolution-testing.html#cb238-61" tabindex="-1"></a>        )</span>
<span id="cb238-62"><a href="chm-raster-resolution-testing.html#cb238-62" tabindex="-1"></a>      )</span>
<span id="cb238-63"><a href="chm-raster-resolution-testing.html#cb238-63" tabindex="-1"></a>    </span>
<span id="cb238-64"><a href="chm-raster-resolution-testing.html#cb238-64" tabindex="-1"></a>    <span class="co"># plot </span></span>
<span id="cb238-65"><a href="chm-raster-resolution-testing.html#cb238-65" tabindex="-1"></a>    plt <span class="ot">&lt;-</span> df_temp <span class="sc">%&gt;%</span> </span>
<span id="cb238-66"><a href="chm-raster-resolution-testing.html#cb238-66" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">count</span>(chm_res_m_desc,metric,value) <span class="sc">%&gt;%</span> </span>
<span id="cb238-67"><a href="chm-raster-resolution-testing.html#cb238-67" tabindex="-1"></a>      ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(</span>
<span id="cb238-68"><a href="chm-raster-resolution-testing.html#cb238-68" tabindex="-1"></a>        <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">fill =</span> metric, <span class="at">color =</span> metric)</span>
<span id="cb238-69"><a href="chm-raster-resolution-testing.html#cb238-69" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb238-70"><a href="chm-raster-resolution-testing.html#cb238-70" tabindex="-1"></a>      ggplot2<span class="sc">::</span><span class="fu">geom_vline</span>(</span>
<span id="cb238-71"><a href="chm-raster-resolution-testing.html#cb238-71" tabindex="-1"></a>        <span class="at">data =</span> xxxdf_temp</span>
<span id="cb238-72"><a href="chm-raster-resolution-testing.html#cb238-72" tabindex="-1"></a>        , <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">xintercept =</span> value)</span>
<span id="cb238-73"><a href="chm-raster-resolution-testing.html#cb238-73" tabindex="-1"></a>        , <span class="at">color =</span> <span class="st">&quot;gray44&quot;</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span></span>
<span id="cb238-74"><a href="chm-raster-resolution-testing.html#cb238-74" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb238-75"><a href="chm-raster-resolution-testing.html#cb238-75" tabindex="-1"></a>      <span class="co"># ggplot2::geom_jitter(mapping = ggplot2::aes(y=-0.2), width = 0, height = 0.1) +</span></span>
<span id="cb238-76"><a href="chm-raster-resolution-testing.html#cb238-76" tabindex="-1"></a>      <span class="co"># ggplot2::geom_boxplot(width = 0.1, color = &quot;black&quot;, fill = NA, outliers = F) +</span></span>
<span id="cb238-77"><a href="chm-raster-resolution-testing.html#cb238-77" tabindex="-1"></a>      ggplot2<span class="sc">::</span><span class="fu">geom_segment</span>(</span>
<span id="cb238-78"><a href="chm-raster-resolution-testing.html#cb238-78" tabindex="-1"></a>        <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">y=</span>n,<span class="at">yend=</span><span class="dv">0</span>)</span>
<span id="cb238-79"><a href="chm-raster-resolution-testing.html#cb238-79" tabindex="-1"></a>        , <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.8</span></span>
<span id="cb238-80"><a href="chm-raster-resolution-testing.html#cb238-80" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb238-81"><a href="chm-raster-resolution-testing.html#cb238-81" tabindex="-1"></a>      ggplot2<span class="sc">::</span><span class="fu">geom_point</span>(</span>
<span id="cb238-82"><a href="chm-raster-resolution-testing.html#cb238-82" tabindex="-1"></a>        <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">y=</span>n)</span>
<span id="cb238-83"><a href="chm-raster-resolution-testing.html#cb238-83" tabindex="-1"></a>        , <span class="at">alpha =</span> <span class="dv">1</span></span>
<span id="cb238-84"><a href="chm-raster-resolution-testing.html#cb238-84" tabindex="-1"></a>        , <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">color =</span> <span class="st">&quot;gray44&quot;</span>, <span class="at">size =</span> <span class="dv">5</span></span>
<span id="cb238-85"><a href="chm-raster-resolution-testing.html#cb238-85" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb238-86"><a href="chm-raster-resolution-testing.html#cb238-86" tabindex="-1"></a>      ggplot2<span class="sc">::</span><span class="fu">geom_text</span>(</span>
<span id="cb238-87"><a href="chm-raster-resolution-testing.html#cb238-87" tabindex="-1"></a>        <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">y=</span>n,<span class="at">label=</span>n)</span>
<span id="cb238-88"><a href="chm-raster-resolution-testing.html#cb238-88" tabindex="-1"></a>        , <span class="at">size =</span> <span class="fl">2.5</span>, <span class="at">color =</span> <span class="st">&quot;white&quot;</span></span>
<span id="cb238-89"><a href="chm-raster-resolution-testing.html#cb238-89" tabindex="-1"></a>        <span class="co"># , vjust = -0.01</span></span>
<span id="cb238-90"><a href="chm-raster-resolution-testing.html#cb238-90" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb238-91"><a href="chm-raster-resolution-testing.html#cb238-91" tabindex="-1"></a>      ggplot2<span class="sc">::</span><span class="fu">geom_text</span>(</span>
<span id="cb238-92"><a href="chm-raster-resolution-testing.html#cb238-92" tabindex="-1"></a>        <span class="at">data =</span> xxxdf_temp</span>
<span id="cb238-93"><a href="chm-raster-resolution-testing.html#cb238-93" tabindex="-1"></a>        , <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(</span>
<span id="cb238-94"><a href="chm-raster-resolution-testing.html#cb238-94" tabindex="-1"></a>          <span class="at">x =</span> <span class="sc">-</span><span class="cn">Inf</span>, <span class="at">y =</span> <span class="cn">Inf</span> <span class="co"># always in upper left?</span></span>
<span id="cb238-95"><a href="chm-raster-resolution-testing.html#cb238-95" tabindex="-1"></a>          <span class="co"># x = value, y = 0</span></span>
<span id="cb238-96"><a href="chm-raster-resolution-testing.html#cb238-96" tabindex="-1"></a>          , <span class="at">label =</span> value_lab</span>
<span id="cb238-97"><a href="chm-raster-resolution-testing.html#cb238-97" tabindex="-1"></a>        )</span>
<span id="cb238-98"><a href="chm-raster-resolution-testing.html#cb238-98" tabindex="-1"></a>        , <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">0.1</span>, <span class="at">vjust =</span> <span class="dv">1</span> <span class="co"># always in upper left?</span></span>
<span id="cb238-99"><a href="chm-raster-resolution-testing.html#cb238-99" tabindex="-1"></a>        <span class="co"># , hjust = -0.1, vjust = -5</span></span>
<span id="cb238-100"><a href="chm-raster-resolution-testing.html#cb238-100" tabindex="-1"></a>        , <span class="at">size =</span> <span class="fl">2.5</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span></span>
<span id="cb238-101"><a href="chm-raster-resolution-testing.html#cb238-101" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb238-102"><a href="chm-raster-resolution-testing.html#cb238-102" tabindex="-1"></a>      <span class="co"># ggplot2::geom_rug() +</span></span>
<span id="cb238-103"><a href="chm-raster-resolution-testing.html#cb238-103" tabindex="-1"></a>      ggplot2<span class="sc">::</span><span class="fu">scale_fill_manual</span>(<span class="at">values =</span> pal_eval_metric) <span class="sc">+</span></span>
<span id="cb238-104"><a href="chm-raster-resolution-testing.html#cb238-104" tabindex="-1"></a>      ggplot2<span class="sc">::</span><span class="fu">scale_color_manual</span>(<span class="at">values =</span> pal_eval_metric) <span class="sc">+</span></span>
<span id="cb238-105"><a href="chm-raster-resolution-testing.html#cb238-105" tabindex="-1"></a>      ggplot2<span class="sc">::</span><span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> ggplot2<span class="sc">::</span><span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="dv">0</span>, .<span class="dv">2</span>))) <span class="sc">+</span></span>
<span id="cb238-106"><a href="chm-raster-resolution-testing.html#cb238-106" tabindex="-1"></a>      ggplot2<span class="sc">::</span><span class="fu">scale_x_continuous</span>(</span>
<span id="cb238-107"><a href="chm-raster-resolution-testing.html#cb238-107" tabindex="-1"></a>        <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">percent_format</span>(<span class="at">accuracy =</span> <span class="dv">1</span>)</span>
<span id="cb238-108"><a href="chm-raster-resolution-testing.html#cb238-108" tabindex="-1"></a>        <span class="co"># , limits = c(0,1.05)</span></span>
<span id="cb238-109"><a href="chm-raster-resolution-testing.html#cb238-109" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb238-110"><a href="chm-raster-resolution-testing.html#cb238-110" tabindex="-1"></a>      ggplot2<span class="sc">::</span><span class="fu">facet_grid</span>(<span class="at">cols =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(metric), <span class="at">rows =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(chm_res_m_desc), <span class="at">scales =</span> <span class="st">&quot;free_x&quot;</span>) <span class="sc">+</span></span>
<span id="cb238-111"><a href="chm-raster-resolution-testing.html#cb238-111" tabindex="-1"></a>      ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb238-112"><a href="chm-raster-resolution-testing.html#cb238-112" tabindex="-1"></a>        <span class="at">x =</span> <span class="st">&quot;&quot;</span>, <span class="at">y =</span> <span class="st">&quot;&quot;</span></span>
<span id="cb238-113"><a href="chm-raster-resolution-testing.html#cb238-113" tabindex="-1"></a>        , <span class="at">subtitle =</span> my_subtitle</span>
<span id="cb238-114"><a href="chm-raster-resolution-testing.html#cb238-114" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb238-115"><a href="chm-raster-resolution-testing.html#cb238-115" tabindex="-1"></a>      ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb238-116"><a href="chm-raster-resolution-testing.html#cb238-116" tabindex="-1"></a>      ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb238-117"><a href="chm-raster-resolution-testing.html#cb238-117" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb238-118"><a href="chm-raster-resolution-testing.html#cb238-118" tabindex="-1"></a>        , <span class="at">strip.text =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb238-119"><a href="chm-raster-resolution-testing.html#cb238-119" tabindex="-1"></a>        , <span class="at">axis.text.x =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">7</span>)</span>
<span id="cb238-120"><a href="chm-raster-resolution-testing.html#cb238-120" tabindex="-1"></a>        , <span class="at">axis.text.y =</span> ggplot2<span class="sc">::</span><span class="fu">element_blank</span>()</span>
<span id="cb238-121"><a href="chm-raster-resolution-testing.html#cb238-121" tabindex="-1"></a>        , <span class="at">axis.ticks.y =</span> ggplot2<span class="sc">::</span><span class="fu">element_blank</span>()</span>
<span id="cb238-122"><a href="chm-raster-resolution-testing.html#cb238-122" tabindex="-1"></a>        , <span class="at">panel.grid.major.y =</span> ggplot2<span class="sc">::</span><span class="fu">element_blank</span>()</span>
<span id="cb238-123"><a href="chm-raster-resolution-testing.html#cb238-123" tabindex="-1"></a>        , <span class="at">panel.grid.minor.y =</span> ggplot2<span class="sc">::</span><span class="fu">element_blank</span>()</span>
<span id="cb238-124"><a href="chm-raster-resolution-testing.html#cb238-124" tabindex="-1"></a>        , <span class="at">plot.subtitle =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>)</span>
<span id="cb238-125"><a href="chm-raster-resolution-testing.html#cb238-125" tabindex="-1"></a>      )</span>
<span id="cb238-126"><a href="chm-raster-resolution-testing.html#cb238-126" tabindex="-1"></a>  }<span class="cf">else</span>{</span>
<span id="cb238-127"><a href="chm-raster-resolution-testing.html#cb238-127" tabindex="-1"></a>    <span class="co"># agg for median plotting</span></span>
<span id="cb238-128"><a href="chm-raster-resolution-testing.html#cb238-128" tabindex="-1"></a>    xxxdf_temp <span class="ot">&lt;-</span> df_temp <span class="sc">%&gt;%</span> </span>
<span id="cb238-129"><a href="chm-raster-resolution-testing.html#cb238-129" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">group_by</span>(chm_res_m_desc,metric) <span class="sc">%&gt;%</span> </span>
<span id="cb238-130"><a href="chm-raster-resolution-testing.html#cb238-130" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">summarise</span>(<span class="at">value =</span> <span class="fu">median</span>(value,<span class="at">na.rm=</span>T)) <span class="sc">%&gt;%</span> </span>
<span id="cb238-131"><a href="chm-raster-resolution-testing.html#cb238-131" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb238-132"><a href="chm-raster-resolution-testing.html#cb238-132" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb238-133"><a href="chm-raster-resolution-testing.html#cb238-133" tabindex="-1"></a>        <span class="at">value_lab =</span> <span class="fu">paste0</span>(</span>
<span id="cb238-134"><a href="chm-raster-resolution-testing.html#cb238-134" tabindex="-1"></a>          <span class="st">&quot;median:</span><span class="sc">\n</span><span class="st">&quot;</span></span>
<span id="cb238-135"><a href="chm-raster-resolution-testing.html#cb238-135" tabindex="-1"></a>          , scales<span class="sc">::</span><span class="fu">percent</span>(value,<span class="at">accuracy=</span><span class="dv">1</span>)</span>
<span id="cb238-136"><a href="chm-raster-resolution-testing.html#cb238-136" tabindex="-1"></a>        )</span>
<span id="cb238-137"><a href="chm-raster-resolution-testing.html#cb238-137" tabindex="-1"></a>      )</span>
<span id="cb238-138"><a href="chm-raster-resolution-testing.html#cb238-138" tabindex="-1"></a>    plt <span class="ot">&lt;-</span> df_temp <span class="sc">%&gt;%</span> </span>
<span id="cb238-139"><a href="chm-raster-resolution-testing.html#cb238-139" tabindex="-1"></a>      ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(</span>
<span id="cb238-140"><a href="chm-raster-resolution-testing.html#cb238-140" tabindex="-1"></a>        <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">fill =</span> metric, <span class="at">color =</span> metric)</span>
<span id="cb238-141"><a href="chm-raster-resolution-testing.html#cb238-141" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb238-142"><a href="chm-raster-resolution-testing.html#cb238-142" tabindex="-1"></a>      ggplot2<span class="sc">::</span><span class="fu">geom_density</span>(<span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">y=</span>ggplot2<span class="sc">::</span><span class="fu">after_stat</span>(scaled)), <span class="at">color =</span> <span class="cn">NA</span>, <span class="at">alpha =</span> <span class="fl">0.9</span>) <span class="sc">+</span></span>
<span id="cb238-143"><a href="chm-raster-resolution-testing.html#cb238-143" tabindex="-1"></a>      <span class="co"># ggplot2::geom_rug(</span></span>
<span id="cb238-144"><a href="chm-raster-resolution-testing.html#cb238-144" tabindex="-1"></a>      <span class="co">#   # # setting these makes the plotting more computationally intensive</span></span>
<span id="cb238-145"><a href="chm-raster-resolution-testing.html#cb238-145" tabindex="-1"></a>      <span class="co">#   # alpha = 0.5</span></span>
<span id="cb238-146"><a href="chm-raster-resolution-testing.html#cb238-146" tabindex="-1"></a>      <span class="co">#   # , length = ggplot2::unit(0.01, &quot;npc&quot;)</span></span>
<span id="cb238-147"><a href="chm-raster-resolution-testing.html#cb238-147" tabindex="-1"></a>      <span class="co"># ) +</span></span>
<span id="cb238-148"><a href="chm-raster-resolution-testing.html#cb238-148" tabindex="-1"></a>      ggplot2<span class="sc">::</span><span class="fu">geom_vline</span>(</span>
<span id="cb238-149"><a href="chm-raster-resolution-testing.html#cb238-149" tabindex="-1"></a>        <span class="at">data =</span> xxxdf_temp</span>
<span id="cb238-150"><a href="chm-raster-resolution-testing.html#cb238-150" tabindex="-1"></a>        , <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">xintercept =</span> value)</span>
<span id="cb238-151"><a href="chm-raster-resolution-testing.html#cb238-151" tabindex="-1"></a>        , <span class="at">color =</span> <span class="st">&quot;gray44&quot;</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span></span>
<span id="cb238-152"><a href="chm-raster-resolution-testing.html#cb238-152" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb238-153"><a href="chm-raster-resolution-testing.html#cb238-153" tabindex="-1"></a>      ggplot2<span class="sc">::</span><span class="fu">geom_text</span>(</span>
<span id="cb238-154"><a href="chm-raster-resolution-testing.html#cb238-154" tabindex="-1"></a>        <span class="at">data =</span> xxxdf_temp</span>
<span id="cb238-155"><a href="chm-raster-resolution-testing.html#cb238-155" tabindex="-1"></a>        , <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(</span>
<span id="cb238-156"><a href="chm-raster-resolution-testing.html#cb238-156" tabindex="-1"></a>          <span class="at">x =</span> <span class="sc">-</span><span class="cn">Inf</span>, <span class="at">y =</span> <span class="cn">Inf</span> <span class="co"># always in upper left?</span></span>
<span id="cb238-157"><a href="chm-raster-resolution-testing.html#cb238-157" tabindex="-1"></a>          <span class="co"># x = value, y = 0</span></span>
<span id="cb238-158"><a href="chm-raster-resolution-testing.html#cb238-158" tabindex="-1"></a>          , <span class="at">label =</span> value_lab</span>
<span id="cb238-159"><a href="chm-raster-resolution-testing.html#cb238-159" tabindex="-1"></a>        )</span>
<span id="cb238-160"><a href="chm-raster-resolution-testing.html#cb238-160" tabindex="-1"></a>        , <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">0.1</span>, <span class="at">vjust =</span> <span class="dv">1</span> <span class="co"># always in upper left?</span></span>
<span id="cb238-161"><a href="chm-raster-resolution-testing.html#cb238-161" tabindex="-1"></a>        <span class="co"># , hjust = -0.1, vjust = -5</span></span>
<span id="cb238-162"><a href="chm-raster-resolution-testing.html#cb238-162" tabindex="-1"></a>        , <span class="at">size =</span> <span class="fl">2.5</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span></span>
<span id="cb238-163"><a href="chm-raster-resolution-testing.html#cb238-163" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb238-164"><a href="chm-raster-resolution-testing.html#cb238-164" tabindex="-1"></a>      ggplot2<span class="sc">::</span><span class="fu">scale_fill_manual</span>(<span class="at">values =</span> pal_eval_metric) <span class="sc">+</span></span>
<span id="cb238-165"><a href="chm-raster-resolution-testing.html#cb238-165" tabindex="-1"></a>      ggplot2<span class="sc">::</span><span class="fu">scale_color_manual</span>(<span class="at">values =</span> pal_eval_metric) <span class="sc">+</span></span>
<span id="cb238-166"><a href="chm-raster-resolution-testing.html#cb238-166" tabindex="-1"></a>      ggplot2<span class="sc">::</span><span class="fu">scale_x_continuous</span>(</span>
<span id="cb238-167"><a href="chm-raster-resolution-testing.html#cb238-167" tabindex="-1"></a>        <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">percent_format</span>(<span class="at">accuracy =</span> <span class="dv">1</span>)</span>
<span id="cb238-168"><a href="chm-raster-resolution-testing.html#cb238-168" tabindex="-1"></a>        , <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">1.05</span>)</span>
<span id="cb238-169"><a href="chm-raster-resolution-testing.html#cb238-169" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb238-170"><a href="chm-raster-resolution-testing.html#cb238-170" tabindex="-1"></a>      ggplot2<span class="sc">::</span><span class="fu">facet_grid</span>(<span class="at">cols =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(metric), <span class="at">rows =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(chm_res_m_desc), <span class="at">scales =</span> <span class="st">&quot;free_y&quot;</span>) <span class="sc">+</span></span>
<span id="cb238-171"><a href="chm-raster-resolution-testing.html#cb238-171" tabindex="-1"></a>      ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb238-172"><a href="chm-raster-resolution-testing.html#cb238-172" tabindex="-1"></a>        <span class="at">x =</span> <span class="st">&quot;&quot;</span>, <span class="at">y =</span> <span class="st">&quot;&quot;</span></span>
<span id="cb238-173"><a href="chm-raster-resolution-testing.html#cb238-173" tabindex="-1"></a>        , <span class="at">subtitle =</span> my_subtitle</span>
<span id="cb238-174"><a href="chm-raster-resolution-testing.html#cb238-174" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb238-175"><a href="chm-raster-resolution-testing.html#cb238-175" tabindex="-1"></a>      ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb238-176"><a href="chm-raster-resolution-testing.html#cb238-176" tabindex="-1"></a>      ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb238-177"><a href="chm-raster-resolution-testing.html#cb238-177" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb238-178"><a href="chm-raster-resolution-testing.html#cb238-178" tabindex="-1"></a>        , <span class="at">strip.text.x =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb238-179"><a href="chm-raster-resolution-testing.html#cb238-179" tabindex="-1"></a>        , <span class="at">strip.text.y =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">9</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb238-180"><a href="chm-raster-resolution-testing.html#cb238-180" tabindex="-1"></a>        , <span class="at">axis.text.x =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">7</span>)</span>
<span id="cb238-181"><a href="chm-raster-resolution-testing.html#cb238-181" tabindex="-1"></a>        , <span class="at">axis.text.y =</span> ggplot2<span class="sc">::</span><span class="fu">element_blank</span>()</span>
<span id="cb238-182"><a href="chm-raster-resolution-testing.html#cb238-182" tabindex="-1"></a>        , <span class="at">axis.ticks.y =</span> ggplot2<span class="sc">::</span><span class="fu">element_blank</span>()</span>
<span id="cb238-183"><a href="chm-raster-resolution-testing.html#cb238-183" tabindex="-1"></a>        , <span class="at">panel.grid.major.y =</span> ggplot2<span class="sc">::</span><span class="fu">element_blank</span>()</span>
<span id="cb238-184"><a href="chm-raster-resolution-testing.html#cb238-184" tabindex="-1"></a>        , <span class="at">panel.grid.minor.y =</span> ggplot2<span class="sc">::</span><span class="fu">element_blank</span>()</span>
<span id="cb238-185"><a href="chm-raster-resolution-testing.html#cb238-185" tabindex="-1"></a>        , <span class="at">plot.subtitle =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>)</span>
<span id="cb238-186"><a href="chm-raster-resolution-testing.html#cb238-186" tabindex="-1"></a>      )</span>
<span id="cb238-187"><a href="chm-raster-resolution-testing.html#cb238-187" tabindex="-1"></a>    <span class="cf">if</span>(show_rug){</span>
<span id="cb238-188"><a href="chm-raster-resolution-testing.html#cb238-188" tabindex="-1"></a>      plt <span class="ot">&lt;-</span> plt <span class="sc">+</span> </span>
<span id="cb238-189"><a href="chm-raster-resolution-testing.html#cb238-189" tabindex="-1"></a>        ggplot2<span class="sc">::</span><span class="fu">geom_rug</span>(</span>
<span id="cb238-190"><a href="chm-raster-resolution-testing.html#cb238-190" tabindex="-1"></a>          <span class="co"># # setting these makes the plotting more computationally intensive</span></span>
<span id="cb238-191"><a href="chm-raster-resolution-testing.html#cb238-191" tabindex="-1"></a>          <span class="co"># alpha = 0.5</span></span>
<span id="cb238-192"><a href="chm-raster-resolution-testing.html#cb238-192" tabindex="-1"></a>          <span class="co"># , length = ggplot2::unit(0.01, &quot;npc&quot;)</span></span>
<span id="cb238-193"><a href="chm-raster-resolution-testing.html#cb238-193" tabindex="-1"></a>        )</span>
<span id="cb238-194"><a href="chm-raster-resolution-testing.html#cb238-194" tabindex="-1"></a>    }</span>
<span id="cb238-195"><a href="chm-raster-resolution-testing.html#cb238-195" tabindex="-1"></a>  }</span>
<span id="cb238-196"><a href="chm-raster-resolution-testing.html#cb238-196" tabindex="-1"></a>  <span class="fu">return</span>(plt)</span>
<span id="cb238-197"><a href="chm-raster-resolution-testing.html#cb238-197" tabindex="-1"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb239"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb239-1"><a href="chm-raster-resolution-testing.html#cb239-1" tabindex="-1"></a><span class="co"># plot it</span></span>
<span id="cb239-2"><a href="chm-raster-resolution-testing.html#cb239-2" tabindex="-1"></a><span class="fu">plt_detection_dist2</span>(</span>
<span id="cb239-3"><a href="chm-raster-resolution-testing.html#cb239-3" tabindex="-1"></a>  <span class="at">df =</span> param_combos_gt_agg</span>
<span id="cb239-4"><a href="chm-raster-resolution-testing.html#cb239-4" tabindex="-1"></a>  , <span class="fu">paste0</span>(</span>
<span id="cb239-5"><a href="chm-raster-resolution-testing.html#cb239-5" tabindex="-1"></a>    <span class="st">&quot;Structural Data Only&quot;</span></span>
<span id="cb239-6"><a href="chm-raster-resolution-testing.html#cb239-6" tabindex="-1"></a>      , <span class="st">&quot;</span><span class="sc">\n</span><span class="st">distribution of pile detection accuracy metrics for all&quot;</span></span>
<span id="cb239-7"><a href="chm-raster-resolution-testing.html#cb239-7" tabindex="-1"></a>     , <span class="st">&quot; (n=&quot;</span></span>
<span id="cb239-8"><a href="chm-raster-resolution-testing.html#cb239-8" tabindex="-1"></a>     , scales<span class="sc">::</span><span class="fu">comma</span>(n_combos_tested_chm, <span class="at">accuracy =</span> <span class="dv">1</span>)</span>
<span id="cb239-9"><a href="chm-raster-resolution-testing.html#cb239-9" tabindex="-1"></a>     , <span class="st">&quot;) &quot;</span></span>
<span id="cb239-10"><a href="chm-raster-resolution-testing.html#cb239-10" tabindex="-1"></a>     , <span class="st">&quot;parameter combinations tested&quot;</span></span>
<span id="cb239-11"><a href="chm-raster-resolution-testing.html#cb239-11" tabindex="-1"></a>    )</span>
<span id="cb239-12"><a href="chm-raster-resolution-testing.html#cb239-12" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-203-1.png" width="1008" /></p>
<p>collapsing across all other parameters, what is the main effect of each individual parameter or CHM resolution?</p>
<div class="sourceCode" id="cb240"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb240-1"><a href="chm-raster-resolution-testing.html#cb240-1" tabindex="-1"></a>param_combos_gt_agg <span class="sc">%&gt;%</span> </span>
<span id="cb240-2"><a href="chm-raster-resolution-testing.html#cb240-2" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(</span>
<span id="cb240-3"><a href="chm-raster-resolution-testing.html#cb240-3" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">c</span>(precision,recall,f_score)</span>
<span id="cb240-4"><a href="chm-raster-resolution-testing.html#cb240-4" tabindex="-1"></a>    , <span class="at">names_to =</span> <span class="st">&quot;metric&quot;</span></span>
<span id="cb240-5"><a href="chm-raster-resolution-testing.html#cb240-5" tabindex="-1"></a>    , <span class="at">values_to =</span> <span class="st">&quot;value&quot;</span></span>
<span id="cb240-6"><a href="chm-raster-resolution-testing.html#cb240-6" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb240-7"><a href="chm-raster-resolution-testing.html#cb240-7" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(</span>
<span id="cb240-8"><a href="chm-raster-resolution-testing.html#cb240-8" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">c</span>(max_ht_m,max_area_m2,convexity_pct,circle_fit_iou_pct,chm_res_m)</span>
<span id="cb240-9"><a href="chm-raster-resolution-testing.html#cb240-9" tabindex="-1"></a>    , <span class="at">names_to =</span> <span class="st">&quot;param&quot;</span></span>
<span id="cb240-10"><a href="chm-raster-resolution-testing.html#cb240-10" tabindex="-1"></a>    , <span class="at">values_to =</span> <span class="st">&quot;param_value&quot;</span></span>
<span id="cb240-11"><a href="chm-raster-resolution-testing.html#cb240-11" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb240-12"><a href="chm-raster-resolution-testing.html#cb240-12" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(param, param_value, metric) <span class="sc">%&gt;%</span></span>
<span id="cb240-13"><a href="chm-raster-resolution-testing.html#cb240-13" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(</span>
<span id="cb240-14"><a href="chm-raster-resolution-testing.html#cb240-14" tabindex="-1"></a>    <span class="at">median =</span> <span class="fu">median</span>(value,<span class="at">na.rm=</span>T)</span>
<span id="cb240-15"><a href="chm-raster-resolution-testing.html#cb240-15" tabindex="-1"></a>    , <span class="at">q25 =</span> stats<span class="sc">::</span><span class="fu">quantile</span>(value,<span class="at">na.rm=</span>T,<span class="at">probs =</span> <span class="fl">0.25</span>)</span>
<span id="cb240-16"><a href="chm-raster-resolution-testing.html#cb240-16" tabindex="-1"></a>    , <span class="at">q75 =</span> stats<span class="sc">::</span><span class="fu">quantile</span>(value,<span class="at">na.rm=</span>T,<span class="at">probs =</span> <span class="fl">0.75</span>)</span>
<span id="cb240-17"><a href="chm-raster-resolution-testing.html#cb240-17" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb240-18"><a href="chm-raster-resolution-testing.html#cb240-18" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb240-19"><a href="chm-raster-resolution-testing.html#cb240-19" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb240-20"><a href="chm-raster-resolution-testing.html#cb240-20" tabindex="-1"></a>    <span class="at">param =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb240-21"><a href="chm-raster-resolution-testing.html#cb240-21" tabindex="-1"></a>        param <span class="sc">==</span> <span class="st">&quot;chm_res_m&quot;</span> <span class="sc">~</span> <span class="dv">1</span></span>
<span id="cb240-22"><a href="chm-raster-resolution-testing.html#cb240-22" tabindex="-1"></a>        , param <span class="sc">==</span> <span class="st">&quot;max_ht_m&quot;</span> <span class="sc">~</span> <span class="dv">2</span></span>
<span id="cb240-23"><a href="chm-raster-resolution-testing.html#cb240-23" tabindex="-1"></a>        , param <span class="sc">==</span> <span class="st">&quot;min_area_m2&quot;</span> <span class="sc">~</span> <span class="dv">3</span></span>
<span id="cb240-24"><a href="chm-raster-resolution-testing.html#cb240-24" tabindex="-1"></a>        , param <span class="sc">==</span> <span class="st">&quot;max_area_m2&quot;</span> <span class="sc">~</span> <span class="dv">4</span></span>
<span id="cb240-25"><a href="chm-raster-resolution-testing.html#cb240-25" tabindex="-1"></a>        , param <span class="sc">==</span> <span class="st">&quot;convexity_pct&quot;</span> <span class="sc">~</span> <span class="dv">5</span></span>
<span id="cb240-26"><a href="chm-raster-resolution-testing.html#cb240-26" tabindex="-1"></a>        , param <span class="sc">==</span> <span class="st">&quot;circle_fit_iou_pct&quot;</span> <span class="sc">~</span> <span class="dv">6</span></span>
<span id="cb240-27"><a href="chm-raster-resolution-testing.html#cb240-27" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span> </span>
<span id="cb240-28"><a href="chm-raster-resolution-testing.html#cb240-28" tabindex="-1"></a>      <span class="fu">factor</span>(</span>
<span id="cb240-29"><a href="chm-raster-resolution-testing.html#cb240-29" tabindex="-1"></a>        <span class="at">ordered =</span> T</span>
<span id="cb240-30"><a href="chm-raster-resolution-testing.html#cb240-30" tabindex="-1"></a>        , <span class="at">levels =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">6</span></span>
<span id="cb240-31"><a href="chm-raster-resolution-testing.html#cb240-31" tabindex="-1"></a>        , <span class="at">labels =</span> <span class="fu">c</span>(</span>
<span id="cb240-32"><a href="chm-raster-resolution-testing.html#cb240-32" tabindex="-1"></a>          <span class="st">&quot;CHM resolution (m)&quot;</span></span>
<span id="cb240-33"><a href="chm-raster-resolution-testing.html#cb240-33" tabindex="-1"></a>          , <span class="st">&quot;max_ht_m&quot;</span></span>
<span id="cb240-34"><a href="chm-raster-resolution-testing.html#cb240-34" tabindex="-1"></a>          , <span class="st">&quot;min_area_m2&quot;</span></span>
<span id="cb240-35"><a href="chm-raster-resolution-testing.html#cb240-35" tabindex="-1"></a>          , <span class="st">&quot;max_area_m2&quot;</span></span>
<span id="cb240-36"><a href="chm-raster-resolution-testing.html#cb240-36" tabindex="-1"></a>          , <span class="st">&quot;convexity_pct&quot;</span></span>
<span id="cb240-37"><a href="chm-raster-resolution-testing.html#cb240-37" tabindex="-1"></a>          , <span class="st">&quot;circle_fit_iou_pct&quot;</span></span>
<span id="cb240-38"><a href="chm-raster-resolution-testing.html#cb240-38" tabindex="-1"></a>        )</span>
<span id="cb240-39"><a href="chm-raster-resolution-testing.html#cb240-39" tabindex="-1"></a>      )</span>
<span id="cb240-40"><a href="chm-raster-resolution-testing.html#cb240-40" tabindex="-1"></a>    , <span class="at">metric =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb240-41"><a href="chm-raster-resolution-testing.html#cb240-41" tabindex="-1"></a>        metric <span class="sc">==</span> <span class="st">&quot;f_score&quot;</span> <span class="sc">~</span> <span class="dv">1</span></span>
<span id="cb240-42"><a href="chm-raster-resolution-testing.html#cb240-42" tabindex="-1"></a>        , metric <span class="sc">==</span> <span class="st">&quot;recall&quot;</span> <span class="sc">~</span> <span class="dv">2</span></span>
<span id="cb240-43"><a href="chm-raster-resolution-testing.html#cb240-43" tabindex="-1"></a>        , metric <span class="sc">==</span> <span class="st">&quot;precision&quot;</span> <span class="sc">~</span> <span class="dv">3</span></span>
<span id="cb240-44"><a href="chm-raster-resolution-testing.html#cb240-44" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span> </span>
<span id="cb240-45"><a href="chm-raster-resolution-testing.html#cb240-45" tabindex="-1"></a>      <span class="fu">factor</span>(</span>
<span id="cb240-46"><a href="chm-raster-resolution-testing.html#cb240-46" tabindex="-1"></a>        <span class="at">ordered =</span> T</span>
<span id="cb240-47"><a href="chm-raster-resolution-testing.html#cb240-47" tabindex="-1"></a>        , <span class="at">levels =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span></span>
<span id="cb240-48"><a href="chm-raster-resolution-testing.html#cb240-48" tabindex="-1"></a>        , <span class="at">labels =</span> <span class="fu">c</span>(</span>
<span id="cb240-49"><a href="chm-raster-resolution-testing.html#cb240-49" tabindex="-1"></a>          <span class="st">&quot;F-score&quot;</span></span>
<span id="cb240-50"><a href="chm-raster-resolution-testing.html#cb240-50" tabindex="-1"></a>          , <span class="st">&quot;Recall&quot;</span></span>
<span id="cb240-51"><a href="chm-raster-resolution-testing.html#cb240-51" tabindex="-1"></a>          , <span class="st">&quot;Precision&quot;</span></span>
<span id="cb240-52"><a href="chm-raster-resolution-testing.html#cb240-52" tabindex="-1"></a>        )</span>
<span id="cb240-53"><a href="chm-raster-resolution-testing.html#cb240-53" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span> </span>
<span id="cb240-54"><a href="chm-raster-resolution-testing.html#cb240-54" tabindex="-1"></a>      forcats<span class="sc">::</span><span class="fu">fct_rev</span>()</span>
<span id="cb240-55"><a href="chm-raster-resolution-testing.html#cb240-55" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb240-56"><a href="chm-raster-resolution-testing.html#cb240-56" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(</span>
<span id="cb240-57"><a href="chm-raster-resolution-testing.html#cb240-57" tabindex="-1"></a>    <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">y =</span> median, <span class="at">x =</span> param_value, <span class="at">color =</span> metric, <span class="at">fill =</span> metric, <span class="at">group =</span> metric, <span class="at">shape =</span> metric)</span>
<span id="cb240-58"><a href="chm-raster-resolution-testing.html#cb240-58" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb240-59"><a href="chm-raster-resolution-testing.html#cb240-59" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_ribbon</span>(</span>
<span id="cb240-60"><a href="chm-raster-resolution-testing.html#cb240-60" tabindex="-1"></a>    <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">ymin =</span> q25, <span class="at">ymax =</span> q75)</span>
<span id="cb240-61"><a href="chm-raster-resolution-testing.html#cb240-61" tabindex="-1"></a>    , <span class="at">alpha =</span> <span class="fl">0.2</span>, <span class="at">color =</span> <span class="cn">NA</span></span>
<span id="cb240-62"><a href="chm-raster-resolution-testing.html#cb240-62" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb240-63"><a href="chm-raster-resolution-testing.html#cb240-63" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_line</span>(<span class="at">lwd =</span> <span class="fl">1.5</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb240-64"><a href="chm-raster-resolution-testing.html#cb240-64" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb240-65"><a href="chm-raster-resolution-testing.html#cb240-65" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">facet_wrap</span>(<span class="at">facets =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(param), <span class="at">scales =</span> <span class="st">&quot;free_x&quot;</span>) <span class="sc">+</span></span>
<span id="cb240-66"><a href="chm-raster-resolution-testing.html#cb240-66" tabindex="-1"></a>  <span class="co"># ggplot2::scale_color_viridis_d(begin = 0.2, end = 0.8) +</span></span>
<span id="cb240-67"><a href="chm-raster-resolution-testing.html#cb240-67" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">rev</span>(pal_eval_metric)) <span class="sc">+</span></span>
<span id="cb240-68"><a href="chm-raster-resolution-testing.html#cb240-68" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">rev</span>(pal_eval_metric)) <span class="sc">+</span></span>
<span id="cb240-69"><a href="chm-raster-resolution-testing.html#cb240-69" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">labels =</span> scales<span class="sc">::</span>percent, <span class="at">breaks =</span> scales<span class="sc">::</span><span class="fu">breaks_extended</span>(<span class="dv">10</span>)) <span class="sc">+</span></span>
<span id="cb240-70"><a href="chm-raster-resolution-testing.html#cb240-70" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb240-71"><a href="chm-raster-resolution-testing.html#cb240-71" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;&quot;</span>, <span class="at">y =</span> <span class="st">&quot;median value&quot;</span>, <span class="at">color =</span> <span class="st">&quot;&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;&quot;</span></span>
<span id="cb240-72"><a href="chm-raster-resolution-testing.html#cb240-72" tabindex="-1"></a>    , <span class="at">subtitle =</span> <span class="st">&quot;Structural Data Only&quot;</span></span>
<span id="cb240-73"><a href="chm-raster-resolution-testing.html#cb240-73" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb240-74"><a href="chm-raster-resolution-testing.html#cb240-74" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb240-75"><a href="chm-raster-resolution-testing.html#cb240-75" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb240-76"><a href="chm-raster-resolution-testing.html#cb240-76" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;top&quot;</span></span>
<span id="cb240-77"><a href="chm-raster-resolution-testing.html#cb240-77" tabindex="-1"></a>    , <span class="at">strip.text =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb240-78"><a href="chm-raster-resolution-testing.html#cb240-78" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb240-79"><a href="chm-raster-resolution-testing.html#cb240-79" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">guides</span>(</span>
<span id="cb240-80"><a href="chm-raster-resolution-testing.html#cb240-80" tabindex="-1"></a>    <span class="at">color =</span> ggplot2<span class="sc">::</span><span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">shape =</span> <span class="dv">15</span>, <span class="at">linetype =</span> <span class="dv">0</span>, <span class="at">size =</span> <span class="dv">5</span>, <span class="at">alpha =</span> <span class="dv">1</span>))</span>
<span id="cb240-81"><a href="chm-raster-resolution-testing.html#cb240-81" tabindex="-1"></a>    , <span class="at">shape =</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb240-82"><a href="chm-raster-resolution-testing.html#cb240-82" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-204-1.png" width="1008" /></p>
<p>based on these main effect aggregated results using our point cloud and validation data:</p>
<ul>
<li>increasing the CHM resolution (making it more coarse) consistently reduced all detection accuracy metrics (F-score, precision, and recall) across the tested range of 0.1m to 0.5m</li>
<li>increasing the <code>max_ht_m</code> (which sets the maximum height of the CHM slice) steadily reduced precision. conversely, F-score and recall improved when the parameter was increased from 2 m to 3 m, remaining stable or slightly declining thereafter</li>
<li>increasing the <code>max_area_m2</code> (which determines the maximum pile area) had minimal impact on detection metrics once the value was set above 10 m<sup>2</sup>. however, an increase from 10 m<sup>2</sup> to 20 m<sup>2</sup> improved all three detection accuracy metrics given the data used in this study</li>
<li>increasing <code>convexity_pct</code> (toward 1 to favor more regular shapes) had minimal impact on metrics until values exceeded 0.7. at this point, recall decreased, but precision and F-score saw slight improvements</li>
<li>increasing <code>circle_fit_iou_pct</code> (toward 1 to favor circular shapes) improved precision and F-score up to a value of 0.5 with minimal effect on recall. Beyond this point, recall dropped significantly, with only modest improvements to F-score, and overall accuracy crashed past 0.7.</li>
</ul>
<p>do the trends vary by CHM resolution?</p>
<div class="sourceCode" id="cb241"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb241-1"><a href="chm-raster-resolution-testing.html#cb241-1" tabindex="-1"></a>param_combos_gt_agg <span class="sc">%&gt;%</span> </span>
<span id="cb241-2"><a href="chm-raster-resolution-testing.html#cb241-2" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(</span>
<span id="cb241-3"><a href="chm-raster-resolution-testing.html#cb241-3" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">c</span>(precision,recall,f_score)</span>
<span id="cb241-4"><a href="chm-raster-resolution-testing.html#cb241-4" tabindex="-1"></a>    , <span class="at">names_to =</span> <span class="st">&quot;metric&quot;</span></span>
<span id="cb241-5"><a href="chm-raster-resolution-testing.html#cb241-5" tabindex="-1"></a>    , <span class="at">values_to =</span> <span class="st">&quot;value&quot;</span></span>
<span id="cb241-6"><a href="chm-raster-resolution-testing.html#cb241-6" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb241-7"><a href="chm-raster-resolution-testing.html#cb241-7" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(</span>
<span id="cb241-8"><a href="chm-raster-resolution-testing.html#cb241-8" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">c</span>(max_ht_m,max_area_m2,convexity_pct,circle_fit_iou_pct)</span>
<span id="cb241-9"><a href="chm-raster-resolution-testing.html#cb241-9" tabindex="-1"></a>    , <span class="at">names_to =</span> <span class="st">&quot;param&quot;</span></span>
<span id="cb241-10"><a href="chm-raster-resolution-testing.html#cb241-10" tabindex="-1"></a>    , <span class="at">values_to =</span> <span class="st">&quot;param_value&quot;</span></span>
<span id="cb241-11"><a href="chm-raster-resolution-testing.html#cb241-11" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb241-12"><a href="chm-raster-resolution-testing.html#cb241-12" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(param, param_value, metric, chm_res_m) <span class="sc">%&gt;%</span></span>
<span id="cb241-13"><a href="chm-raster-resolution-testing.html#cb241-13" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(</span>
<span id="cb241-14"><a href="chm-raster-resolution-testing.html#cb241-14" tabindex="-1"></a>    <span class="at">median =</span> <span class="fu">median</span>(value,<span class="at">na.rm=</span>T)</span>
<span id="cb241-15"><a href="chm-raster-resolution-testing.html#cb241-15" tabindex="-1"></a>    , <span class="at">q25 =</span> stats<span class="sc">::</span><span class="fu">quantile</span>(value,<span class="at">na.rm=</span>T,<span class="at">probs =</span> <span class="fl">0.25</span>)</span>
<span id="cb241-16"><a href="chm-raster-resolution-testing.html#cb241-16" tabindex="-1"></a>    , <span class="at">q75 =</span> stats<span class="sc">::</span><span class="fu">quantile</span>(value,<span class="at">na.rm=</span>T,<span class="at">probs =</span> <span class="fl">0.75</span>)</span>
<span id="cb241-17"><a href="chm-raster-resolution-testing.html#cb241-17" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb241-18"><a href="chm-raster-resolution-testing.html#cb241-18" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb241-19"><a href="chm-raster-resolution-testing.html#cb241-19" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb241-20"><a href="chm-raster-resolution-testing.html#cb241-20" tabindex="-1"></a>    <span class="at">param =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb241-21"><a href="chm-raster-resolution-testing.html#cb241-21" tabindex="-1"></a>        param <span class="sc">==</span> <span class="st">&quot;chm_res_m&quot;</span> <span class="sc">~</span> <span class="dv">1</span></span>
<span id="cb241-22"><a href="chm-raster-resolution-testing.html#cb241-22" tabindex="-1"></a>        , param <span class="sc">==</span> <span class="st">&quot;max_ht_m&quot;</span> <span class="sc">~</span> <span class="dv">2</span></span>
<span id="cb241-23"><a href="chm-raster-resolution-testing.html#cb241-23" tabindex="-1"></a>        , param <span class="sc">==</span> <span class="st">&quot;min_area_m2&quot;</span> <span class="sc">~</span> <span class="dv">3</span></span>
<span id="cb241-24"><a href="chm-raster-resolution-testing.html#cb241-24" tabindex="-1"></a>        , param <span class="sc">==</span> <span class="st">&quot;max_area_m2&quot;</span> <span class="sc">~</span> <span class="dv">4</span></span>
<span id="cb241-25"><a href="chm-raster-resolution-testing.html#cb241-25" tabindex="-1"></a>        , param <span class="sc">==</span> <span class="st">&quot;convexity_pct&quot;</span> <span class="sc">~</span> <span class="dv">5</span></span>
<span id="cb241-26"><a href="chm-raster-resolution-testing.html#cb241-26" tabindex="-1"></a>        , param <span class="sc">==</span> <span class="st">&quot;circle_fit_iou_pct&quot;</span> <span class="sc">~</span> <span class="dv">6</span></span>
<span id="cb241-27"><a href="chm-raster-resolution-testing.html#cb241-27" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span> </span>
<span id="cb241-28"><a href="chm-raster-resolution-testing.html#cb241-28" tabindex="-1"></a>      <span class="fu">factor</span>(</span>
<span id="cb241-29"><a href="chm-raster-resolution-testing.html#cb241-29" tabindex="-1"></a>        <span class="at">ordered =</span> T</span>
<span id="cb241-30"><a href="chm-raster-resolution-testing.html#cb241-30" tabindex="-1"></a>        , <span class="at">levels =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">6</span></span>
<span id="cb241-31"><a href="chm-raster-resolution-testing.html#cb241-31" tabindex="-1"></a>        , <span class="at">labels =</span> <span class="fu">c</span>(</span>
<span id="cb241-32"><a href="chm-raster-resolution-testing.html#cb241-32" tabindex="-1"></a>          <span class="st">&quot;CHM resolution (m)&quot;</span></span>
<span id="cb241-33"><a href="chm-raster-resolution-testing.html#cb241-33" tabindex="-1"></a>          , <span class="st">&quot;max_ht_m&quot;</span></span>
<span id="cb241-34"><a href="chm-raster-resolution-testing.html#cb241-34" tabindex="-1"></a>          , <span class="st">&quot;min_area_m2&quot;</span></span>
<span id="cb241-35"><a href="chm-raster-resolution-testing.html#cb241-35" tabindex="-1"></a>          , <span class="st">&quot;max_area_m2&quot;</span></span>
<span id="cb241-36"><a href="chm-raster-resolution-testing.html#cb241-36" tabindex="-1"></a>          , <span class="st">&quot;convexity_pct&quot;</span></span>
<span id="cb241-37"><a href="chm-raster-resolution-testing.html#cb241-37" tabindex="-1"></a>          , <span class="st">&quot;circle_fit_iou_pct&quot;</span></span>
<span id="cb241-38"><a href="chm-raster-resolution-testing.html#cb241-38" tabindex="-1"></a>        )</span>
<span id="cb241-39"><a href="chm-raster-resolution-testing.html#cb241-39" tabindex="-1"></a>      )</span>
<span id="cb241-40"><a href="chm-raster-resolution-testing.html#cb241-40" tabindex="-1"></a>    , <span class="at">metric =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb241-41"><a href="chm-raster-resolution-testing.html#cb241-41" tabindex="-1"></a>        metric <span class="sc">==</span> <span class="st">&quot;f_score&quot;</span> <span class="sc">~</span> <span class="dv">1</span></span>
<span id="cb241-42"><a href="chm-raster-resolution-testing.html#cb241-42" tabindex="-1"></a>        , metric <span class="sc">==</span> <span class="st">&quot;recall&quot;</span> <span class="sc">~</span> <span class="dv">2</span></span>
<span id="cb241-43"><a href="chm-raster-resolution-testing.html#cb241-43" tabindex="-1"></a>        , metric <span class="sc">==</span> <span class="st">&quot;precision&quot;</span> <span class="sc">~</span> <span class="dv">3</span></span>
<span id="cb241-44"><a href="chm-raster-resolution-testing.html#cb241-44" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span> </span>
<span id="cb241-45"><a href="chm-raster-resolution-testing.html#cb241-45" tabindex="-1"></a>      <span class="fu">factor</span>(</span>
<span id="cb241-46"><a href="chm-raster-resolution-testing.html#cb241-46" tabindex="-1"></a>        <span class="at">ordered =</span> T</span>
<span id="cb241-47"><a href="chm-raster-resolution-testing.html#cb241-47" tabindex="-1"></a>        , <span class="at">levels =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span></span>
<span id="cb241-48"><a href="chm-raster-resolution-testing.html#cb241-48" tabindex="-1"></a>        , <span class="at">labels =</span> <span class="fu">c</span>(</span>
<span id="cb241-49"><a href="chm-raster-resolution-testing.html#cb241-49" tabindex="-1"></a>          <span class="st">&quot;F-score&quot;</span></span>
<span id="cb241-50"><a href="chm-raster-resolution-testing.html#cb241-50" tabindex="-1"></a>          , <span class="st">&quot;Recall&quot;</span></span>
<span id="cb241-51"><a href="chm-raster-resolution-testing.html#cb241-51" tabindex="-1"></a>          , <span class="st">&quot;Precision&quot;</span></span>
<span id="cb241-52"><a href="chm-raster-resolution-testing.html#cb241-52" tabindex="-1"></a>        )</span>
<span id="cb241-53"><a href="chm-raster-resolution-testing.html#cb241-53" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span> </span>
<span id="cb241-54"><a href="chm-raster-resolution-testing.html#cb241-54" tabindex="-1"></a>      forcats<span class="sc">::</span><span class="fu">fct_rev</span>()</span>
<span id="cb241-55"><a href="chm-raster-resolution-testing.html#cb241-55" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb241-56"><a href="chm-raster-resolution-testing.html#cb241-56" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(</span>
<span id="cb241-57"><a href="chm-raster-resolution-testing.html#cb241-57" tabindex="-1"></a>    <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">y =</span> median, <span class="at">x =</span> param_value, <span class="at">color =</span> metric, <span class="at">fill =</span> metric, <span class="at">group =</span> metric, <span class="at">shape =</span> metric)</span>
<span id="cb241-58"><a href="chm-raster-resolution-testing.html#cb241-58" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb241-59"><a href="chm-raster-resolution-testing.html#cb241-59" tabindex="-1"></a>  <span class="co"># ggplot2::geom_ribbon(</span></span>
<span id="cb241-60"><a href="chm-raster-resolution-testing.html#cb241-60" tabindex="-1"></a>  <span class="co">#   mapping = ggplot2::aes(ymin = q25, ymax = q75)</span></span>
<span id="cb241-61"><a href="chm-raster-resolution-testing.html#cb241-61" tabindex="-1"></a>  <span class="co">#   , alpha = 0.2, color = NA</span></span>
<span id="cb241-62"><a href="chm-raster-resolution-testing.html#cb241-62" tabindex="-1"></a>  <span class="co"># ) +</span></span>
<span id="cb241-63"><a href="chm-raster-resolution-testing.html#cb241-63" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_line</span>(<span class="at">lwd =</span> <span class="fl">1.5</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb241-64"><a href="chm-raster-resolution-testing.html#cb241-64" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb241-65"><a href="chm-raster-resolution-testing.html#cb241-65" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">facet_grid</span>(<span class="at">cols =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(param), <span class="at">rows =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(chm_res_m), <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>) <span class="sc">+</span></span>
<span id="cb241-66"><a href="chm-raster-resolution-testing.html#cb241-66" tabindex="-1"></a>  <span class="co"># ggplot2::scale_color_viridis_d(begin = 0.2, end = 0.8) +</span></span>
<span id="cb241-67"><a href="chm-raster-resolution-testing.html#cb241-67" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">rev</span>(pal_eval_metric)) <span class="sc">+</span></span>
<span id="cb241-68"><a href="chm-raster-resolution-testing.html#cb241-68" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">rev</span>(pal_eval_metric)) <span class="sc">+</span></span>
<span id="cb241-69"><a href="chm-raster-resolution-testing.html#cb241-69" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>percent) <span class="sc">+</span></span>
<span id="cb241-70"><a href="chm-raster-resolution-testing.html#cb241-70" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb241-71"><a href="chm-raster-resolution-testing.html#cb241-71" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;&quot;</span>, <span class="at">y =</span> <span class="st">&quot;median value&quot;</span>, <span class="at">color =</span> <span class="st">&quot;&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;&quot;</span></span>
<span id="cb241-72"><a href="chm-raster-resolution-testing.html#cb241-72" tabindex="-1"></a>    , <span class="at">subtitle =</span> <span class="st">&quot;Structural Data Only&quot;</span></span>
<span id="cb241-73"><a href="chm-raster-resolution-testing.html#cb241-73" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb241-74"><a href="chm-raster-resolution-testing.html#cb241-74" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb241-75"><a href="chm-raster-resolution-testing.html#cb241-75" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb241-76"><a href="chm-raster-resolution-testing.html#cb241-76" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;top&quot;</span></span>
<span id="cb241-77"><a href="chm-raster-resolution-testing.html#cb241-77" tabindex="-1"></a>    , <span class="at">strip.text =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb241-78"><a href="chm-raster-resolution-testing.html#cb241-78" tabindex="-1"></a>    , <span class="at">axis.text =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">7</span>)</span>
<span id="cb241-79"><a href="chm-raster-resolution-testing.html#cb241-79" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb241-80"><a href="chm-raster-resolution-testing.html#cb241-80" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">guides</span>(</span>
<span id="cb241-81"><a href="chm-raster-resolution-testing.html#cb241-81" tabindex="-1"></a>    <span class="at">color =</span> ggplot2<span class="sc">::</span><span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">shape =</span> <span class="dv">15</span>, <span class="at">linetype =</span> <span class="dv">0</span>, <span class="at">size =</span> <span class="dv">5</span>, <span class="at">alpha =</span> <span class="dv">1</span>))</span>
<span id="cb241-82"><a href="chm-raster-resolution-testing.html#cb241-82" tabindex="-1"></a>    , <span class="at">shape =</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb241-83"><a href="chm-raster-resolution-testing.html#cb241-83" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-205-1.png" width="1008" /></p>
<p>generally, the tends do not appear to vary substantially by CHM resolution. an exception might be the <code>circle_fit_iou_pct</code> parameter which appears to shift its apex from values near 0.6 (i.e. 60%) at finer resolutions to values near 0.7 (i.e. 70%) at more coarse resolutions.</p>
</div>
<div id="quant_trends" class="section level3 hasAnchor" number="8.5.2">
<h3><span class="header-section-number">8.5.2</span> Main Effects: form quantification<a href="chm-raster-resolution-testing.html#quant_trends" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>let’s check out the the ability of the method to properly extract the form of the piles by looking at the quantification accuracy metrics where:</p>
<ul>
<li><strong>Mean Error (ME)</strong> represents the direction of bias (over or under-prediction) in the original units</li>
<li><strong>RMSE</strong> represents the typical magnitude of error in the original units, with a stronger penalty for large errors</li>
<li><strong>MAPE</strong> represents the typical magnitude of error as a percentage, allowing for scale-independent comparisons</li>
</ul>
<p>as a reminder regarding the form quantification accuracy evaluation, we will assess the method’s accuracy by comparing the true-positive matches using the following metrics:</p>
<ul>
<li><strong>Volume</strong> compares the predicted volume from the irregular elevation profile and footprint to the ground truth paraboloid volume</li>
<li><strong>Diameter</strong> compares the predicted diameter (from the maximum internal distance) to the ground truth field-measured diameter.</li>
<li><strong>Area</strong> compares the predicted area from the irregular shape to the ground truth assumed circular area</li>
<li><strong>Height</strong> compares the predicted maximum height from the CHM to the ground truth field-measured height</li>
</ul>
<p>what is the quantification accuracy across all parameter combinations tested for each CHM resolution?</p>
<div class="sourceCode" id="cb242"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb242-1"><a href="chm-raster-resolution-testing.html#cb242-1" tabindex="-1"></a><span class="co"># let&#39;s average across all other factors to look at the main effect by parameter for the **MAPE** metrics quantifying the pile form accuracy</span></span>
<span id="cb242-2"><a href="chm-raster-resolution-testing.html#cb242-2" tabindex="-1"></a><span class="co"># this is a lot of work, so we&#39;re going to make it a function</span></span>
<span id="cb242-3"><a href="chm-raster-resolution-testing.html#cb242-3" tabindex="-1"></a>plt_form_quantification_trend <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb242-4"><a href="chm-raster-resolution-testing.html#cb242-4" tabindex="-1"></a>  df</span>
<span id="cb242-5"><a href="chm-raster-resolution-testing.html#cb242-5" tabindex="-1"></a>  , <span class="at">my_subtitle =</span> <span class="st">&quot;&quot;</span></span>
<span id="cb242-6"><a href="chm-raster-resolution-testing.html#cb242-6" tabindex="-1"></a>  , <span class="at">quant_metric =</span> <span class="st">&quot;mape&quot;</span> <span class="co"># rmse, mean, mape</span></span>
<span id="cb242-7"><a href="chm-raster-resolution-testing.html#cb242-7" tabindex="-1"></a>) {</span>
<span id="cb242-8"><a href="chm-raster-resolution-testing.html#cb242-8" tabindex="-1"></a>  quant_metric <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb242-9"><a href="chm-raster-resolution-testing.html#cb242-9" tabindex="-1"></a>      <span class="fu">tolower</span>(quant_metric) <span class="sc">==</span> <span class="st">&quot;mape&quot;</span> <span class="sc">~</span> <span class="st">&quot;mape&quot;</span></span>
<span id="cb242-10"><a href="chm-raster-resolution-testing.html#cb242-10" tabindex="-1"></a>      , <span class="fu">tolower</span>(quant_metric) <span class="sc">==</span> <span class="st">&quot;rmse&quot;</span> <span class="sc">~</span> <span class="st">&quot;rmse&quot;</span></span>
<span id="cb242-11"><a href="chm-raster-resolution-testing.html#cb242-11" tabindex="-1"></a>      , <span class="fu">tolower</span>(quant_metric) <span class="sc">==</span> <span class="st">&quot;mean&quot;</span> <span class="sc">~</span> <span class="st">&quot;mean&quot;</span></span>
<span id="cb242-12"><a href="chm-raster-resolution-testing.html#cb242-12" tabindex="-1"></a>      , T <span class="sc">~</span> <span class="st">&quot;mape&quot;</span></span>
<span id="cb242-13"><a href="chm-raster-resolution-testing.html#cb242-13" tabindex="-1"></a>    )</span>
<span id="cb242-14"><a href="chm-raster-resolution-testing.html#cb242-14" tabindex="-1"></a>  </span>
<span id="cb242-15"><a href="chm-raster-resolution-testing.html#cb242-15" tabindex="-1"></a>  p <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> </span>
<span id="cb242-16"><a href="chm-raster-resolution-testing.html#cb242-16" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(</span>
<span id="cb242-17"><a href="chm-raster-resolution-testing.html#cb242-17" tabindex="-1"></a>    <span class="at">cols =</span> tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="fu">paste0</span>(<span class="st">&quot;_&quot;</span>,quant_metric))</span>
<span id="cb242-18"><a href="chm-raster-resolution-testing.html#cb242-18" tabindex="-1"></a>    , <span class="at">names_to =</span> <span class="st">&quot;metric&quot;</span></span>
<span id="cb242-19"><a href="chm-raster-resolution-testing.html#cb242-19" tabindex="-1"></a>    , <span class="at">values_to =</span> <span class="st">&quot;value&quot;</span></span>
<span id="cb242-20"><a href="chm-raster-resolution-testing.html#cb242-20" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb242-21"><a href="chm-raster-resolution-testing.html#cb242-21" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(</span>
<span id="cb242-22"><a href="chm-raster-resolution-testing.html#cb242-22" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">c</span>(max_ht_m,max_area_m2,convexity_pct,circle_fit_iou_pct,chm_res_m)</span>
<span id="cb242-23"><a href="chm-raster-resolution-testing.html#cb242-23" tabindex="-1"></a>    , <span class="at">names_to =</span> <span class="st">&quot;param&quot;</span></span>
<span id="cb242-24"><a href="chm-raster-resolution-testing.html#cb242-24" tabindex="-1"></a>    , <span class="at">values_to =</span> <span class="st">&quot;param_value&quot;</span></span>
<span id="cb242-25"><a href="chm-raster-resolution-testing.html#cb242-25" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb242-26"><a href="chm-raster-resolution-testing.html#cb242-26" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(param, param_value, metric) <span class="sc">%&gt;%</span></span>
<span id="cb242-27"><a href="chm-raster-resolution-testing.html#cb242-27" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(</span>
<span id="cb242-28"><a href="chm-raster-resolution-testing.html#cb242-28" tabindex="-1"></a>    <span class="at">median =</span> <span class="fu">median</span>(value,<span class="at">na.rm=</span>T)</span>
<span id="cb242-29"><a href="chm-raster-resolution-testing.html#cb242-29" tabindex="-1"></a>    , <span class="at">q25 =</span> stats<span class="sc">::</span><span class="fu">quantile</span>(value,<span class="at">na.rm=</span>T,<span class="at">probs =</span> <span class="fl">0.25</span>)</span>
<span id="cb242-30"><a href="chm-raster-resolution-testing.html#cb242-30" tabindex="-1"></a>    , <span class="at">q75 =</span> stats<span class="sc">::</span><span class="fu">quantile</span>(value,<span class="at">na.rm=</span>T,<span class="at">probs =</span> <span class="fl">0.75</span>)</span>
<span id="cb242-31"><a href="chm-raster-resolution-testing.html#cb242-31" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb242-32"><a href="chm-raster-resolution-testing.html#cb242-32" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb242-33"><a href="chm-raster-resolution-testing.html#cb242-33" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb242-34"><a href="chm-raster-resolution-testing.html#cb242-34" tabindex="-1"></a>    <span class="at">param =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb242-35"><a href="chm-raster-resolution-testing.html#cb242-35" tabindex="-1"></a>        param <span class="sc">==</span> <span class="st">&quot;chm_res_m&quot;</span> <span class="sc">~</span> <span class="dv">1</span></span>
<span id="cb242-36"><a href="chm-raster-resolution-testing.html#cb242-36" tabindex="-1"></a>        , param <span class="sc">==</span> <span class="st">&quot;max_ht_m&quot;</span> <span class="sc">~</span> <span class="dv">2</span></span>
<span id="cb242-37"><a href="chm-raster-resolution-testing.html#cb242-37" tabindex="-1"></a>        , param <span class="sc">==</span> <span class="st">&quot;min_area_m2&quot;</span> <span class="sc">~</span> <span class="dv">3</span></span>
<span id="cb242-38"><a href="chm-raster-resolution-testing.html#cb242-38" tabindex="-1"></a>        , param <span class="sc">==</span> <span class="st">&quot;max_area_m2&quot;</span> <span class="sc">~</span> <span class="dv">4</span></span>
<span id="cb242-39"><a href="chm-raster-resolution-testing.html#cb242-39" tabindex="-1"></a>        , param <span class="sc">==</span> <span class="st">&quot;convexity_pct&quot;</span> <span class="sc">~</span> <span class="dv">5</span></span>
<span id="cb242-40"><a href="chm-raster-resolution-testing.html#cb242-40" tabindex="-1"></a>        , param <span class="sc">==</span> <span class="st">&quot;circle_fit_iou_pct&quot;</span> <span class="sc">~</span> <span class="dv">6</span></span>
<span id="cb242-41"><a href="chm-raster-resolution-testing.html#cb242-41" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span> </span>
<span id="cb242-42"><a href="chm-raster-resolution-testing.html#cb242-42" tabindex="-1"></a>      <span class="fu">factor</span>(</span>
<span id="cb242-43"><a href="chm-raster-resolution-testing.html#cb242-43" tabindex="-1"></a>        <span class="at">ordered =</span> T</span>
<span id="cb242-44"><a href="chm-raster-resolution-testing.html#cb242-44" tabindex="-1"></a>        , <span class="at">levels =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">6</span></span>
<span id="cb242-45"><a href="chm-raster-resolution-testing.html#cb242-45" tabindex="-1"></a>        , <span class="at">labels =</span> <span class="fu">c</span>(</span>
<span id="cb242-46"><a href="chm-raster-resolution-testing.html#cb242-46" tabindex="-1"></a>          <span class="st">&quot;CHM resolution (m)&quot;</span></span>
<span id="cb242-47"><a href="chm-raster-resolution-testing.html#cb242-47" tabindex="-1"></a>          , <span class="st">&quot;max_ht_m&quot;</span></span>
<span id="cb242-48"><a href="chm-raster-resolution-testing.html#cb242-48" tabindex="-1"></a>          , <span class="st">&quot;min_area_m2&quot;</span></span>
<span id="cb242-49"><a href="chm-raster-resolution-testing.html#cb242-49" tabindex="-1"></a>          , <span class="st">&quot;max_area_m2&quot;</span></span>
<span id="cb242-50"><a href="chm-raster-resolution-testing.html#cb242-50" tabindex="-1"></a>          , <span class="st">&quot;convexity_pct&quot;</span></span>
<span id="cb242-51"><a href="chm-raster-resolution-testing.html#cb242-51" tabindex="-1"></a>          , <span class="st">&quot;circle_fit_iou_pct&quot;</span></span>
<span id="cb242-52"><a href="chm-raster-resolution-testing.html#cb242-52" tabindex="-1"></a>        )</span>
<span id="cb242-53"><a href="chm-raster-resolution-testing.html#cb242-53" tabindex="-1"></a>      )</span>
<span id="cb242-54"><a href="chm-raster-resolution-testing.html#cb242-54" tabindex="-1"></a>    , <span class="at">pile_metric =</span> metric <span class="sc">%&gt;%</span> </span>
<span id="cb242-55"><a href="chm-raster-resolution-testing.html#cb242-55" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_remove</span>(<span class="st">&quot;(_rmse|_rrmse|_mean|_mape)$&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb242-56"><a href="chm-raster-resolution-testing.html#cb242-56" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_extract</span>(<span class="st">&quot;(paraboloid_volume|volume|area|height|diameter)&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb242-57"><a href="chm-raster-resolution-testing.html#cb242-57" tabindex="-1"></a>      <span class="fu">factor</span>(</span>
<span id="cb242-58"><a href="chm-raster-resolution-testing.html#cb242-58" tabindex="-1"></a>        <span class="at">ordered =</span> T</span>
<span id="cb242-59"><a href="chm-raster-resolution-testing.html#cb242-59" tabindex="-1"></a>        , <span class="at">levels =</span> <span class="fu">c</span>(</span>
<span id="cb242-60"><a href="chm-raster-resolution-testing.html#cb242-60" tabindex="-1"></a>          <span class="st">&quot;volume&quot;</span></span>
<span id="cb242-61"><a href="chm-raster-resolution-testing.html#cb242-61" tabindex="-1"></a>          , <span class="st">&quot;paraboloid_volume&quot;</span></span>
<span id="cb242-62"><a href="chm-raster-resolution-testing.html#cb242-62" tabindex="-1"></a>          , <span class="st">&quot;area&quot;</span></span>
<span id="cb242-63"><a href="chm-raster-resolution-testing.html#cb242-63" tabindex="-1"></a>          , <span class="st">&quot;height&quot;</span></span>
<span id="cb242-64"><a href="chm-raster-resolution-testing.html#cb242-64" tabindex="-1"></a>          , <span class="st">&quot;diameter&quot;</span></span>
<span id="cb242-65"><a href="chm-raster-resolution-testing.html#cb242-65" tabindex="-1"></a>        )</span>
<span id="cb242-66"><a href="chm-raster-resolution-testing.html#cb242-66" tabindex="-1"></a>        , <span class="at">labels =</span> <span class="fu">c</span>(</span>
<span id="cb242-67"><a href="chm-raster-resolution-testing.html#cb242-67" tabindex="-1"></a>          <span class="st">&quot;Volume&quot;</span></span>
<span id="cb242-68"><a href="chm-raster-resolution-testing.html#cb242-68" tabindex="-1"></a>          , <span class="st">&quot;Volume paraboloid&quot;</span></span>
<span id="cb242-69"><a href="chm-raster-resolution-testing.html#cb242-69" tabindex="-1"></a>          , <span class="st">&quot;Area&quot;</span></span>
<span id="cb242-70"><a href="chm-raster-resolution-testing.html#cb242-70" tabindex="-1"></a>          , <span class="st">&quot;Height&quot;</span></span>
<span id="cb242-71"><a href="chm-raster-resolution-testing.html#cb242-71" tabindex="-1"></a>          , <span class="st">&quot;Diameter&quot;</span></span>
<span id="cb242-72"><a href="chm-raster-resolution-testing.html#cb242-72" tabindex="-1"></a>        )</span>
<span id="cb242-73"><a href="chm-raster-resolution-testing.html#cb242-73" tabindex="-1"></a>      )</span>
<span id="cb242-74"><a href="chm-raster-resolution-testing.html#cb242-74" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb242-75"><a href="chm-raster-resolution-testing.html#cb242-75" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(</span>
<span id="cb242-76"><a href="chm-raster-resolution-testing.html#cb242-76" tabindex="-1"></a>    <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">y =</span> median, <span class="at">x =</span> param_value, <span class="at">color =</span> pile_metric, <span class="at">fill =</span> pile_metric, <span class="at">group =</span> pile_metric) <span class="co">#, shape = pile_metric)</span></span>
<span id="cb242-77"><a href="chm-raster-resolution-testing.html#cb242-77" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb242-78"><a href="chm-raster-resolution-testing.html#cb242-78" tabindex="-1"></a>  <span class="co"># ggplot2::geom_ribbon(</span></span>
<span id="cb242-79"><a href="chm-raster-resolution-testing.html#cb242-79" tabindex="-1"></a>  <span class="co">#   mapping = ggplot2::aes(ymin = q25, ymax = q75)</span></span>
<span id="cb242-80"><a href="chm-raster-resolution-testing.html#cb242-80" tabindex="-1"></a>  <span class="co">#   , alpha = 0.2, color = NA</span></span>
<span id="cb242-81"><a href="chm-raster-resolution-testing.html#cb242-81" tabindex="-1"></a>  <span class="co"># ) +</span></span>
<span id="cb242-82"><a href="chm-raster-resolution-testing.html#cb242-82" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_line</span>(<span class="at">lwd =</span> <span class="fl">1.5</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb242-83"><a href="chm-raster-resolution-testing.html#cb242-83" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb242-84"><a href="chm-raster-resolution-testing.html#cb242-84" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">facet_grid</span>(<span class="at">cols =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(param), <span class="at">rows =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(pile_metric), <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>, <span class="at">axes =</span> <span class="st">&quot;all&quot;</span>) <span class="sc">+</span></span>
<span id="cb242-85"><a href="chm-raster-resolution-testing.html#cb242-85" tabindex="-1"></a>  <span class="co"># ggplot2::scale_color_viridis_d(begin = 0.2, end = 0.8) +</span></span>
<span id="cb242-86"><a href="chm-raster-resolution-testing.html#cb242-86" tabindex="-1"></a>  harrypotter<span class="sc">::</span><span class="fu">scale_fill_hp_d</span>(<span class="at">option =</span> <span class="st">&quot;hermionegranger&quot;</span>) <span class="sc">+</span></span>
<span id="cb242-87"><a href="chm-raster-resolution-testing.html#cb242-87" tabindex="-1"></a>  harrypotter<span class="sc">::</span><span class="fu">scale_color_hp_d</span>(<span class="at">option =</span> <span class="st">&quot;hermionegranger&quot;</span>) <span class="sc">+</span></span>
<span id="cb242-88"><a href="chm-raster-resolution-testing.html#cb242-88" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb242-89"><a href="chm-raster-resolution-testing.html#cb242-89" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;&quot;</span></span>
<span id="cb242-90"><a href="chm-raster-resolution-testing.html#cb242-90" tabindex="-1"></a>    , <span class="at">y =</span> <span class="fu">paste0</span>(<span class="fu">ifelse</span>(quant_metric<span class="sc">==</span><span class="st">&quot;mean&quot;</span>,<span class="st">&quot;Mean Error&quot;</span>, <span class="fu">toupper</span>(quant_metric)), <span class="st">&quot; (median)&quot;</span>)</span>
<span id="cb242-91"><a href="chm-raster-resolution-testing.html#cb242-91" tabindex="-1"></a>    , <span class="at">color =</span> <span class="st">&quot;&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;&quot;</span></span>
<span id="cb242-92"><a href="chm-raster-resolution-testing.html#cb242-92" tabindex="-1"></a>    , <span class="at">title =</span> <span class="fu">ifelse</span>(quant_metric<span class="sc">==</span><span class="st">&quot;mean&quot;</span>,<span class="st">&quot;Mean Error&quot;</span>, <span class="fu">toupper</span>(quant_metric))</span>
<span id="cb242-93"><a href="chm-raster-resolution-testing.html#cb242-93" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb242-94"><a href="chm-raster-resolution-testing.html#cb242-94" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb242-95"><a href="chm-raster-resolution-testing.html#cb242-95" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb242-96"><a href="chm-raster-resolution-testing.html#cb242-96" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb242-97"><a href="chm-raster-resolution-testing.html#cb242-97" tabindex="-1"></a>    , <span class="at">strip.text =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb242-98"><a href="chm-raster-resolution-testing.html#cb242-98" tabindex="-1"></a>    , <span class="at">axis.text.x =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">7</span>)</span>
<span id="cb242-99"><a href="chm-raster-resolution-testing.html#cb242-99" tabindex="-1"></a>    , <span class="at">axis.text.y =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>)</span>
<span id="cb242-100"><a href="chm-raster-resolution-testing.html#cb242-100" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb242-101"><a href="chm-raster-resolution-testing.html#cb242-101" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">guides</span>(</span>
<span id="cb242-102"><a href="chm-raster-resolution-testing.html#cb242-102" tabindex="-1"></a>    <span class="at">color =</span> ggplot2<span class="sc">::</span><span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">shape =</span> <span class="dv">15</span>, <span class="at">linetype =</span> <span class="dv">0</span>, <span class="at">size =</span> <span class="dv">5</span>, <span class="at">alpha =</span> <span class="dv">1</span>))</span>
<span id="cb242-103"><a href="chm-raster-resolution-testing.html#cb242-103" tabindex="-1"></a>    , <span class="at">shape =</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb242-104"><a href="chm-raster-resolution-testing.html#cb242-104" tabindex="-1"></a>  )</span>
<span id="cb242-105"><a href="chm-raster-resolution-testing.html#cb242-105" tabindex="-1"></a>  </span>
<span id="cb242-106"><a href="chm-raster-resolution-testing.html#cb242-106" tabindex="-1"></a>  <span class="cf">if</span>(quant_metric <span class="sc">==</span> <span class="st">&quot;mape&quot;</span>){</span>
<span id="cb242-107"><a href="chm-raster-resolution-testing.html#cb242-107" tabindex="-1"></a>    p <span class="ot">&lt;-</span> p <span class="sc">+</span></span>
<span id="cb242-108"><a href="chm-raster-resolution-testing.html#cb242-108" tabindex="-1"></a>      ggplot2<span class="sc">::</span><span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>percent, <span class="at">breaks =</span> scales<span class="sc">::</span><span class="fu">breaks_extended</span>(<span class="dv">10</span>))</span>
<span id="cb242-109"><a href="chm-raster-resolution-testing.html#cb242-109" tabindex="-1"></a>  }<span class="cf">else</span>{</span>
<span id="cb242-110"><a href="chm-raster-resolution-testing.html#cb242-110" tabindex="-1"></a>    p <span class="ot">&lt;-</span> p <span class="sc">+</span></span>
<span id="cb242-111"><a href="chm-raster-resolution-testing.html#cb242-111" tabindex="-1"></a>      ggplot2<span class="sc">::</span><span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>comma, <span class="at">breaks =</span> scales<span class="sc">::</span><span class="fu">breaks_extended</span>(<span class="dv">10</span>))</span>
<span id="cb242-112"><a href="chm-raster-resolution-testing.html#cb242-112" tabindex="-1"></a>  }</span>
<span id="cb242-113"><a href="chm-raster-resolution-testing.html#cb242-113" tabindex="-1"></a>  <span class="fu">return</span>(p)</span>
<span id="cb242-114"><a href="chm-raster-resolution-testing.html#cb242-114" tabindex="-1"></a>}</span>
<span id="cb242-115"><a href="chm-raster-resolution-testing.html#cb242-115" tabindex="-1"></a><span class="co"># plt_form_quantification_trend(param_combos_gt_agg, quant_metric = &quot;mean&quot;)</span></span>
<span id="cb242-116"><a href="chm-raster-resolution-testing.html#cb242-116" tabindex="-1"></a><span class="co"># plt_form_quantification_trend(param_combos_gt_agg, quant_metric = &quot;mape&quot;)</span></span>
<span id="cb242-117"><a href="chm-raster-resolution-testing.html#cb242-117" tabindex="-1"></a></span>
<span id="cb242-118"><a href="chm-raster-resolution-testing.html#cb242-118" tabindex="-1"></a><span class="co"># this is a lot of work, so we&#39;re going to make it a function</span></span>
<span id="cb242-119"><a href="chm-raster-resolution-testing.html#cb242-119" tabindex="-1"></a>plt_form_quantification_dist2 <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb242-120"><a href="chm-raster-resolution-testing.html#cb242-120" tabindex="-1"></a>  df</span>
<span id="cb242-121"><a href="chm-raster-resolution-testing.html#cb242-121" tabindex="-1"></a>  , <span class="at">my_subtitle =</span> <span class="st">&quot;&quot;</span></span>
<span id="cb242-122"><a href="chm-raster-resolution-testing.html#cb242-122" tabindex="-1"></a>  , <span class="at">show_rug =</span> T</span>
<span id="cb242-123"><a href="chm-raster-resolution-testing.html#cb242-123" tabindex="-1"></a>  , <span class="at">quant_metric =</span> <span class="st">&quot;mape&quot;</span> <span class="co"># rmse, mean, mape</span></span>
<span id="cb242-124"><a href="chm-raster-resolution-testing.html#cb242-124" tabindex="-1"></a>) {</span>
<span id="cb242-125"><a href="chm-raster-resolution-testing.html#cb242-125" tabindex="-1"></a>  <span class="co"># reshape data to go long by evaluation metric</span></span>
<span id="cb242-126"><a href="chm-raster-resolution-testing.html#cb242-126" tabindex="-1"></a>  df_temp <span class="ot">&lt;-</span></span>
<span id="cb242-127"><a href="chm-raster-resolution-testing.html#cb242-127" tabindex="-1"></a>    df <span class="sc">%&gt;%</span> </span>
<span id="cb242-128"><a href="chm-raster-resolution-testing.html#cb242-128" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb242-129"><a href="chm-raster-resolution-testing.html#cb242-129" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb242-130"><a href="chm-raster-resolution-testing.html#cb242-130" tabindex="-1"></a>      max_ht_m,max_area_m2,convexity_pct,circle_fit_iou_pct,chm_res_m_desc,chm_res_m</span>
<span id="cb242-131"><a href="chm-raster-resolution-testing.html#cb242-131" tabindex="-1"></a>      <span class="co"># quantification</span></span>
<span id="cb242-132"><a href="chm-raster-resolution-testing.html#cb242-132" tabindex="-1"></a>      , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_rmse&quot;</span>)</span>
<span id="cb242-133"><a href="chm-raster-resolution-testing.html#cb242-133" tabindex="-1"></a>      , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_rrmse&quot;</span>)</span>
<span id="cb242-134"><a href="chm-raster-resolution-testing.html#cb242-134" tabindex="-1"></a>      , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_mean&quot;</span>)</span>
<span id="cb242-135"><a href="chm-raster-resolution-testing.html#cb242-135" tabindex="-1"></a>      , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_mape&quot;</span>)</span>
<span id="cb242-136"><a href="chm-raster-resolution-testing.html#cb242-136" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb242-137"><a href="chm-raster-resolution-testing.html#cb242-137" tabindex="-1"></a>    tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(</span>
<span id="cb242-138"><a href="chm-raster-resolution-testing.html#cb242-138" tabindex="-1"></a>      <span class="at">cols =</span> <span class="fu">c</span>(</span>
<span id="cb242-139"><a href="chm-raster-resolution-testing.html#cb242-139" tabindex="-1"></a>        tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_rmse&quot;</span>)</span>
<span id="cb242-140"><a href="chm-raster-resolution-testing.html#cb242-140" tabindex="-1"></a>        , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_rrmse&quot;</span>)</span>
<span id="cb242-141"><a href="chm-raster-resolution-testing.html#cb242-141" tabindex="-1"></a>        , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_mean&quot;</span>)</span>
<span id="cb242-142"><a href="chm-raster-resolution-testing.html#cb242-142" tabindex="-1"></a>        , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_mape&quot;</span>)</span>
<span id="cb242-143"><a href="chm-raster-resolution-testing.html#cb242-143" tabindex="-1"></a>      )</span>
<span id="cb242-144"><a href="chm-raster-resolution-testing.html#cb242-144" tabindex="-1"></a>      , <span class="at">names_to =</span> <span class="st">&quot;metric&quot;</span></span>
<span id="cb242-145"><a href="chm-raster-resolution-testing.html#cb242-145" tabindex="-1"></a>      , <span class="at">values_to =</span> <span class="st">&quot;value&quot;</span></span>
<span id="cb242-146"><a href="chm-raster-resolution-testing.html#cb242-146" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb242-147"><a href="chm-raster-resolution-testing.html#cb242-147" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb242-148"><a href="chm-raster-resolution-testing.html#cb242-148" tabindex="-1"></a>      <span class="at">eval_metric =</span> stringr<span class="sc">::</span><span class="fu">str_extract</span>(metric, <span class="st">&quot;(_rmse|_rrmse|_mean|_mape)$&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb242-149"><a href="chm-raster-resolution-testing.html#cb242-149" tabindex="-1"></a>        stringr<span class="sc">::</span><span class="fu">str_remove_all</span>(<span class="st">&quot;_&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb242-150"><a href="chm-raster-resolution-testing.html#cb242-150" tabindex="-1"></a>        stringr<span class="sc">::</span><span class="fu">str_replace_all</span>(<span class="st">&quot;mean&quot;</span>,<span class="st">&quot;me&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb242-151"><a href="chm-raster-resolution-testing.html#cb242-151" tabindex="-1"></a>        <span class="fu">toupper</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb242-152"><a href="chm-raster-resolution-testing.html#cb242-152" tabindex="-1"></a>        <span class="fu">factor</span>(</span>
<span id="cb242-153"><a href="chm-raster-resolution-testing.html#cb242-153" tabindex="-1"></a>          <span class="at">ordered =</span> T</span>
<span id="cb242-154"><a href="chm-raster-resolution-testing.html#cb242-154" tabindex="-1"></a>          , <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;ME&quot;</span>,<span class="st">&quot;RMSE&quot;</span>,<span class="st">&quot;RRMSE&quot;</span>,<span class="st">&quot;MAPE&quot;</span>)</span>
<span id="cb242-155"><a href="chm-raster-resolution-testing.html#cb242-155" tabindex="-1"></a>        )</span>
<span id="cb242-156"><a href="chm-raster-resolution-testing.html#cb242-156" tabindex="-1"></a>      , <span class="at">pile_metric =</span> metric <span class="sc">%&gt;%</span> </span>
<span id="cb242-157"><a href="chm-raster-resolution-testing.html#cb242-157" tabindex="-1"></a>        stringr<span class="sc">::</span><span class="fu">str_remove</span>(<span class="st">&quot;(_rmse|_rrmse|_mean|_mape)$&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb242-158"><a href="chm-raster-resolution-testing.html#cb242-158" tabindex="-1"></a>        stringr<span class="sc">::</span><span class="fu">str_extract</span>(<span class="st">&quot;(paraboloid_volume|volume|area|height|diameter)&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb242-159"><a href="chm-raster-resolution-testing.html#cb242-159" tabindex="-1"></a>        <span class="fu">factor</span>(</span>
<span id="cb242-160"><a href="chm-raster-resolution-testing.html#cb242-160" tabindex="-1"></a>          <span class="at">ordered =</span> T</span>
<span id="cb242-161"><a href="chm-raster-resolution-testing.html#cb242-161" tabindex="-1"></a>          , <span class="at">levels =</span> <span class="fu">c</span>(</span>
<span id="cb242-162"><a href="chm-raster-resolution-testing.html#cb242-162" tabindex="-1"></a>            <span class="st">&quot;volume&quot;</span></span>
<span id="cb242-163"><a href="chm-raster-resolution-testing.html#cb242-163" tabindex="-1"></a>            , <span class="st">&quot;paraboloid_volume&quot;</span></span>
<span id="cb242-164"><a href="chm-raster-resolution-testing.html#cb242-164" tabindex="-1"></a>            , <span class="st">&quot;area&quot;</span></span>
<span id="cb242-165"><a href="chm-raster-resolution-testing.html#cb242-165" tabindex="-1"></a>            , <span class="st">&quot;height&quot;</span></span>
<span id="cb242-166"><a href="chm-raster-resolution-testing.html#cb242-166" tabindex="-1"></a>            , <span class="st">&quot;diameter&quot;</span></span>
<span id="cb242-167"><a href="chm-raster-resolution-testing.html#cb242-167" tabindex="-1"></a>          )</span>
<span id="cb242-168"><a href="chm-raster-resolution-testing.html#cb242-168" tabindex="-1"></a>          , <span class="at">labels =</span> <span class="fu">c</span>(</span>
<span id="cb242-169"><a href="chm-raster-resolution-testing.html#cb242-169" tabindex="-1"></a>            <span class="st">&quot;Volume&quot;</span></span>
<span id="cb242-170"><a href="chm-raster-resolution-testing.html#cb242-170" tabindex="-1"></a>            , <span class="st">&quot;Volume paraboloid&quot;</span></span>
<span id="cb242-171"><a href="chm-raster-resolution-testing.html#cb242-171" tabindex="-1"></a>            , <span class="st">&quot;Area&quot;</span></span>
<span id="cb242-172"><a href="chm-raster-resolution-testing.html#cb242-172" tabindex="-1"></a>            , <span class="st">&quot;Height&quot;</span></span>
<span id="cb242-173"><a href="chm-raster-resolution-testing.html#cb242-173" tabindex="-1"></a>            , <span class="st">&quot;Diameter&quot;</span></span>
<span id="cb242-174"><a href="chm-raster-resolution-testing.html#cb242-174" tabindex="-1"></a>          )</span>
<span id="cb242-175"><a href="chm-raster-resolution-testing.html#cb242-175" tabindex="-1"></a>        )</span>
<span id="cb242-176"><a href="chm-raster-resolution-testing.html#cb242-176" tabindex="-1"></a>    )</span>
<span id="cb242-177"><a href="chm-raster-resolution-testing.html#cb242-177" tabindex="-1"></a>  </span>
<span id="cb242-178"><a href="chm-raster-resolution-testing.html#cb242-178" tabindex="-1"></a>  <span class="co"># plot</span></span>
<span id="cb242-179"><a href="chm-raster-resolution-testing.html#cb242-179" tabindex="-1"></a>  <span class="co"># chm check</span></span>
<span id="cb242-180"><a href="chm-raster-resolution-testing.html#cb242-180" tabindex="-1"></a>  nrow_check <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> </span>
<span id="cb242-181"><a href="chm-raster-resolution-testing.html#cb242-181" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">count</span>(chm_res_m_desc) <span class="sc">%&gt;%</span> </span>
<span id="cb242-182"><a href="chm-raster-resolution-testing.html#cb242-182" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">pull</span>(n) <span class="sc">%&gt;%</span> </span>
<span id="cb242-183"><a href="chm-raster-resolution-testing.html#cb242-183" tabindex="-1"></a>    <span class="fu">max</span>()</span>
<span id="cb242-184"><a href="chm-raster-resolution-testing.html#cb242-184" tabindex="-1"></a>  </span>
<span id="cb242-185"><a href="chm-raster-resolution-testing.html#cb242-185" tabindex="-1"></a>  <span class="co"># plot </span></span>
<span id="cb242-186"><a href="chm-raster-resolution-testing.html#cb242-186" tabindex="-1"></a>  <span class="cf">if</span>(nrow_check<span class="sc">&lt;=</span><span class="dv">15</span>){</span>
<span id="cb242-187"><a href="chm-raster-resolution-testing.html#cb242-187" tabindex="-1"></a>    <span class="co"># round</span></span>
<span id="cb242-188"><a href="chm-raster-resolution-testing.html#cb242-188" tabindex="-1"></a>    df_temp <span class="ot">&lt;-</span> df_temp <span class="sc">%&gt;%</span> </span>
<span id="cb242-189"><a href="chm-raster-resolution-testing.html#cb242-189" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">filter</span>(</span>
<span id="cb242-190"><a href="chm-raster-resolution-testing.html#cb242-190" tabindex="-1"></a>        eval_metric<span class="sc">==</span>dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb242-191"><a href="chm-raster-resolution-testing.html#cb242-191" tabindex="-1"></a>          <span class="fu">tolower</span>(quant_metric) <span class="sc">==</span> <span class="st">&quot;mape&quot;</span> <span class="sc">~</span> <span class="st">&quot;MAPE&quot;</span></span>
<span id="cb242-192"><a href="chm-raster-resolution-testing.html#cb242-192" tabindex="-1"></a>          , <span class="fu">tolower</span>(quant_metric) <span class="sc">==</span> <span class="st">&quot;rmse&quot;</span> <span class="sc">~</span> <span class="st">&quot;RMSE&quot;</span></span>
<span id="cb242-193"><a href="chm-raster-resolution-testing.html#cb242-193" tabindex="-1"></a>          , <span class="fu">tolower</span>(quant_metric) <span class="sc">==</span> <span class="st">&quot;mean&quot;</span> <span class="sc">~</span> <span class="st">&quot;ME&quot;</span></span>
<span id="cb242-194"><a href="chm-raster-resolution-testing.html#cb242-194" tabindex="-1"></a>          , T <span class="sc">~</span> <span class="st">&quot;MAPE&quot;</span></span>
<span id="cb242-195"><a href="chm-raster-resolution-testing.html#cb242-195" tabindex="-1"></a>        )</span>
<span id="cb242-196"><a href="chm-raster-resolution-testing.html#cb242-196" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span> </span>
<span id="cb242-197"><a href="chm-raster-resolution-testing.html#cb242-197" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb242-198"><a href="chm-raster-resolution-testing.html#cb242-198" tabindex="-1"></a>        <span class="at">value =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb242-199"><a href="chm-raster-resolution-testing.html#cb242-199" tabindex="-1"></a>          eval_metric <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;RRMSE&quot;</span>, <span class="st">&quot;MAPE&quot;</span>) <span class="sc">~</span> <span class="fu">round</span>(value,<span class="dv">2</span>)</span>
<span id="cb242-200"><a href="chm-raster-resolution-testing.html#cb242-200" tabindex="-1"></a>          , T <span class="sc">~</span> <span class="fu">round</span>(value,<span class="dv">1</span>)</span>
<span id="cb242-201"><a href="chm-raster-resolution-testing.html#cb242-201" tabindex="-1"></a>        )</span>
<span id="cb242-202"><a href="chm-raster-resolution-testing.html#cb242-202" tabindex="-1"></a>      )</span>
<span id="cb242-203"><a href="chm-raster-resolution-testing.html#cb242-203" tabindex="-1"></a>    <span class="co"># agg for median plotting</span></span>
<span id="cb242-204"><a href="chm-raster-resolution-testing.html#cb242-204" tabindex="-1"></a>    xxxdf_temp <span class="ot">&lt;-</span> df_temp <span class="sc">%&gt;%</span> </span>
<span id="cb242-205"><a href="chm-raster-resolution-testing.html#cb242-205" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">group_by</span>(chm_res_m_desc,pile_metric,eval_metric) <span class="sc">%&gt;%</span> </span>
<span id="cb242-206"><a href="chm-raster-resolution-testing.html#cb242-206" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">summarise</span>(<span class="at">value =</span> <span class="fu">median</span>(value,<span class="at">na.rm=</span>T)) <span class="sc">%&gt;%</span> </span>
<span id="cb242-207"><a href="chm-raster-resolution-testing.html#cb242-207" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb242-208"><a href="chm-raster-resolution-testing.html#cb242-208" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb242-209"><a href="chm-raster-resolution-testing.html#cb242-209" tabindex="-1"></a>        <span class="at">value_lab =</span> <span class="fu">paste0</span>(</span>
<span id="cb242-210"><a href="chm-raster-resolution-testing.html#cb242-210" tabindex="-1"></a>            <span class="st">&quot;median:</span><span class="sc">\n</span><span class="st">&quot;</span></span>
<span id="cb242-211"><a href="chm-raster-resolution-testing.html#cb242-211" tabindex="-1"></a>          , dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb242-212"><a href="chm-raster-resolution-testing.html#cb242-212" tabindex="-1"></a>            eval_metric <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;RRMSE&quot;</span>, <span class="st">&quot;MAPE&quot;</span>) <span class="sc">~</span> scales<span class="sc">::</span><span class="fu">percent</span>(value,<span class="at">accuracy=</span><span class="dv">1</span>)</span>
<span id="cb242-213"><a href="chm-raster-resolution-testing.html#cb242-213" tabindex="-1"></a>            , eval_metric <span class="sc">==</span> <span class="st">&quot;ME&quot;</span> <span class="sc">~</span> scales<span class="sc">::</span><span class="fu">comma</span>(value,<span class="at">accuracy=</span><span class="fl">0.1</span>)</span>
<span id="cb242-214"><a href="chm-raster-resolution-testing.html#cb242-214" tabindex="-1"></a>            , T <span class="sc">~</span> scales<span class="sc">::</span><span class="fu">comma</span>(value,<span class="at">accuracy=</span><span class="fl">0.1</span>)</span>
<span id="cb242-215"><a href="chm-raster-resolution-testing.html#cb242-215" tabindex="-1"></a>          )</span>
<span id="cb242-216"><a href="chm-raster-resolution-testing.html#cb242-216" tabindex="-1"></a>        )</span>
<span id="cb242-217"><a href="chm-raster-resolution-testing.html#cb242-217" tabindex="-1"></a>      )</span>
<span id="cb242-218"><a href="chm-raster-resolution-testing.html#cb242-218" tabindex="-1"></a>    </span>
<span id="cb242-219"><a href="chm-raster-resolution-testing.html#cb242-219" tabindex="-1"></a>    <span class="co"># plot </span></span>
<span id="cb242-220"><a href="chm-raster-resolution-testing.html#cb242-220" tabindex="-1"></a>    p <span class="ot">&lt;-</span> </span>
<span id="cb242-221"><a href="chm-raster-resolution-testing.html#cb242-221" tabindex="-1"></a>      df_temp <span class="sc">%&gt;%</span> </span>
<span id="cb242-222"><a href="chm-raster-resolution-testing.html#cb242-222" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">count</span>(chm_res_m_desc,pile_metric,value) <span class="sc">%&gt;%</span></span>
<span id="cb242-223"><a href="chm-raster-resolution-testing.html#cb242-223" tabindex="-1"></a>        ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x=</span>value,<span class="at">color =</span> pile_metric,<span class="at">fill =</span> pile_metric)) <span class="sc">+</span></span>
<span id="cb242-224"><a href="chm-raster-resolution-testing.html#cb242-224" tabindex="-1"></a>        ggplot2<span class="sc">::</span><span class="fu">geom_vline</span>(</span>
<span id="cb242-225"><a href="chm-raster-resolution-testing.html#cb242-225" tabindex="-1"></a>          <span class="at">data =</span> xxxdf_temp <span class="sc">%&gt;%</span> </span>
<span id="cb242-226"><a href="chm-raster-resolution-testing.html#cb242-226" tabindex="-1"></a>            dplyr<span class="sc">::</span><span class="fu">filter</span>(</span>
<span id="cb242-227"><a href="chm-raster-resolution-testing.html#cb242-227" tabindex="-1"></a>              eval_metric<span class="sc">==</span>dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb242-228"><a href="chm-raster-resolution-testing.html#cb242-228" tabindex="-1"></a>                <span class="fu">tolower</span>(quant_metric) <span class="sc">==</span> <span class="st">&quot;mape&quot;</span> <span class="sc">~</span> <span class="st">&quot;MAPE&quot;</span></span>
<span id="cb242-229"><a href="chm-raster-resolution-testing.html#cb242-229" tabindex="-1"></a>                , <span class="fu">tolower</span>(quant_metric) <span class="sc">==</span> <span class="st">&quot;rmse&quot;</span> <span class="sc">~</span> <span class="st">&quot;RMSE&quot;</span></span>
<span id="cb242-230"><a href="chm-raster-resolution-testing.html#cb242-230" tabindex="-1"></a>                , <span class="fu">tolower</span>(quant_metric) <span class="sc">==</span> <span class="st">&quot;mean&quot;</span> <span class="sc">~</span> <span class="st">&quot;ME&quot;</span></span>
<span id="cb242-231"><a href="chm-raster-resolution-testing.html#cb242-231" tabindex="-1"></a>                , T <span class="sc">~</span> <span class="st">&quot;MAPE&quot;</span></span>
<span id="cb242-232"><a href="chm-raster-resolution-testing.html#cb242-232" tabindex="-1"></a>              )</span>
<span id="cb242-233"><a href="chm-raster-resolution-testing.html#cb242-233" tabindex="-1"></a>            )</span>
<span id="cb242-234"><a href="chm-raster-resolution-testing.html#cb242-234" tabindex="-1"></a>          , <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">xintercept =</span> value)</span>
<span id="cb242-235"><a href="chm-raster-resolution-testing.html#cb242-235" tabindex="-1"></a>          , <span class="at">color =</span> <span class="st">&quot;gray44&quot;</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span></span>
<span id="cb242-236"><a href="chm-raster-resolution-testing.html#cb242-236" tabindex="-1"></a>        ) <span class="sc">+</span></span>
<span id="cb242-237"><a href="chm-raster-resolution-testing.html#cb242-237" tabindex="-1"></a>        ggplot2<span class="sc">::</span><span class="fu">geom_segment</span>(</span>
<span id="cb242-238"><a href="chm-raster-resolution-testing.html#cb242-238" tabindex="-1"></a>          <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">y=</span>n,<span class="at">yend=</span><span class="dv">0</span>)</span>
<span id="cb242-239"><a href="chm-raster-resolution-testing.html#cb242-239" tabindex="-1"></a>          , <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.8</span></span>
<span id="cb242-240"><a href="chm-raster-resolution-testing.html#cb242-240" tabindex="-1"></a>        ) <span class="sc">+</span></span>
<span id="cb242-241"><a href="chm-raster-resolution-testing.html#cb242-241" tabindex="-1"></a>        ggplot2<span class="sc">::</span><span class="fu">geom_point</span>(</span>
<span id="cb242-242"><a href="chm-raster-resolution-testing.html#cb242-242" tabindex="-1"></a>          <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">y=</span>n)</span>
<span id="cb242-243"><a href="chm-raster-resolution-testing.html#cb242-243" tabindex="-1"></a>          , <span class="at">alpha =</span> <span class="dv">1</span></span>
<span id="cb242-244"><a href="chm-raster-resolution-testing.html#cb242-244" tabindex="-1"></a>          , <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">color =</span> <span class="st">&quot;gray44&quot;</span>, <span class="at">size =</span> <span class="dv">5</span></span>
<span id="cb242-245"><a href="chm-raster-resolution-testing.html#cb242-245" tabindex="-1"></a>        ) <span class="sc">+</span></span>
<span id="cb242-246"><a href="chm-raster-resolution-testing.html#cb242-246" tabindex="-1"></a>        ggplot2<span class="sc">::</span><span class="fu">geom_text</span>(</span>
<span id="cb242-247"><a href="chm-raster-resolution-testing.html#cb242-247" tabindex="-1"></a>          <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">y=</span>n,<span class="at">label=</span>n)</span>
<span id="cb242-248"><a href="chm-raster-resolution-testing.html#cb242-248" tabindex="-1"></a>          , <span class="at">size =</span> <span class="fl">2.5</span>, <span class="at">color =</span> <span class="st">&quot;white&quot;</span></span>
<span id="cb242-249"><a href="chm-raster-resolution-testing.html#cb242-249" tabindex="-1"></a>          <span class="co"># , vjust = -0.01</span></span>
<span id="cb242-250"><a href="chm-raster-resolution-testing.html#cb242-250" tabindex="-1"></a>        ) <span class="sc">+</span></span>
<span id="cb242-251"><a href="chm-raster-resolution-testing.html#cb242-251" tabindex="-1"></a>        ggplot2<span class="sc">::</span><span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> ggplot2<span class="sc">::</span><span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="dv">0</span>, .<span class="dv">2</span>))) <span class="sc">+</span></span>
<span id="cb242-252"><a href="chm-raster-resolution-testing.html#cb242-252" tabindex="-1"></a>        harrypotter<span class="sc">::</span><span class="fu">scale_fill_hp_d</span>(<span class="at">option =</span> <span class="st">&quot;hermionegranger&quot;</span>) <span class="sc">+</span></span>
<span id="cb242-253"><a href="chm-raster-resolution-testing.html#cb242-253" tabindex="-1"></a>        harrypotter<span class="sc">::</span><span class="fu">scale_color_hp_d</span>(<span class="at">option =</span> <span class="st">&quot;hermionegranger&quot;</span>) <span class="sc">+</span></span>
<span id="cb242-254"><a href="chm-raster-resolution-testing.html#cb242-254" tabindex="-1"></a>        ggplot2<span class="sc">::</span><span class="fu">geom_text</span>(</span>
<span id="cb242-255"><a href="chm-raster-resolution-testing.html#cb242-255" tabindex="-1"></a>          <span class="at">data =</span> xxxdf_temp <span class="sc">%&gt;%</span> </span>
<span id="cb242-256"><a href="chm-raster-resolution-testing.html#cb242-256" tabindex="-1"></a>            dplyr<span class="sc">::</span><span class="fu">filter</span>(</span>
<span id="cb242-257"><a href="chm-raster-resolution-testing.html#cb242-257" tabindex="-1"></a>              eval_metric<span class="sc">==</span>dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb242-258"><a href="chm-raster-resolution-testing.html#cb242-258" tabindex="-1"></a>                <span class="fu">tolower</span>(quant_metric) <span class="sc">==</span> <span class="st">&quot;mape&quot;</span> <span class="sc">~</span> <span class="st">&quot;MAPE&quot;</span></span>
<span id="cb242-259"><a href="chm-raster-resolution-testing.html#cb242-259" tabindex="-1"></a>                , <span class="fu">tolower</span>(quant_metric) <span class="sc">==</span> <span class="st">&quot;rmse&quot;</span> <span class="sc">~</span> <span class="st">&quot;RMSE&quot;</span></span>
<span id="cb242-260"><a href="chm-raster-resolution-testing.html#cb242-260" tabindex="-1"></a>                , <span class="fu">tolower</span>(quant_metric) <span class="sc">==</span> <span class="st">&quot;mean&quot;</span> <span class="sc">~</span> <span class="st">&quot;ME&quot;</span></span>
<span id="cb242-261"><a href="chm-raster-resolution-testing.html#cb242-261" tabindex="-1"></a>                , T <span class="sc">~</span> <span class="st">&quot;MAPE&quot;</span></span>
<span id="cb242-262"><a href="chm-raster-resolution-testing.html#cb242-262" tabindex="-1"></a>              )</span>
<span id="cb242-263"><a href="chm-raster-resolution-testing.html#cb242-263" tabindex="-1"></a>            )</span>
<span id="cb242-264"><a href="chm-raster-resolution-testing.html#cb242-264" tabindex="-1"></a>          , <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(</span>
<span id="cb242-265"><a href="chm-raster-resolution-testing.html#cb242-265" tabindex="-1"></a>            <span class="at">x =</span> <span class="sc">-</span><span class="cn">Inf</span>, <span class="at">y =</span> <span class="cn">Inf</span> <span class="co"># always in upper left?</span></span>
<span id="cb242-266"><a href="chm-raster-resolution-testing.html#cb242-266" tabindex="-1"></a>            <span class="co"># x = value, y = 0</span></span>
<span id="cb242-267"><a href="chm-raster-resolution-testing.html#cb242-267" tabindex="-1"></a>            , <span class="at">label =</span> value_lab</span>
<span id="cb242-268"><a href="chm-raster-resolution-testing.html#cb242-268" tabindex="-1"></a>          )</span>
<span id="cb242-269"><a href="chm-raster-resolution-testing.html#cb242-269" tabindex="-1"></a>          , <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">0.1</span>, <span class="at">vjust =</span> <span class="dv">1</span> <span class="co"># always in upper left?</span></span>
<span id="cb242-270"><a href="chm-raster-resolution-testing.html#cb242-270" tabindex="-1"></a>          <span class="co"># , hjust = -0.1, vjust = -5</span></span>
<span id="cb242-271"><a href="chm-raster-resolution-testing.html#cb242-271" tabindex="-1"></a>          , <span class="at">size =</span> <span class="fl">2.5</span></span>
<span id="cb242-272"><a href="chm-raster-resolution-testing.html#cb242-272" tabindex="-1"></a>          , <span class="at">color =</span> <span class="st">&quot;black&quot;</span></span>
<span id="cb242-273"><a href="chm-raster-resolution-testing.html#cb242-273" tabindex="-1"></a>        ) <span class="sc">+</span></span>
<span id="cb242-274"><a href="chm-raster-resolution-testing.html#cb242-274" tabindex="-1"></a>        ggplot2<span class="sc">::</span><span class="fu">facet_grid</span>(<span class="at">cols =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(pile_metric), <span class="at">rows =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(chm_res_m_desc), <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>) <span class="sc">+</span></span>
<span id="cb242-275"><a href="chm-raster-resolution-testing.html#cb242-275" tabindex="-1"></a>        ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb242-276"><a href="chm-raster-resolution-testing.html#cb242-276" tabindex="-1"></a>          <span class="at">x =</span> <span class="st">&quot;&quot;</span>, <span class="at">y =</span> <span class="st">&quot;&quot;</span></span>
<span id="cb242-277"><a href="chm-raster-resolution-testing.html#cb242-277" tabindex="-1"></a>          , <span class="at">subtitle =</span> my_subtitle</span>
<span id="cb242-278"><a href="chm-raster-resolution-testing.html#cb242-278" tabindex="-1"></a>          , <span class="at">title =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb242-279"><a href="chm-raster-resolution-testing.html#cb242-279" tabindex="-1"></a>            <span class="fu">tolower</span>(quant_metric) <span class="sc">==</span> <span class="st">&quot;mape&quot;</span> <span class="sc">~</span> <span class="st">&quot;MAPE&quot;</span></span>
<span id="cb242-280"><a href="chm-raster-resolution-testing.html#cb242-280" tabindex="-1"></a>            , <span class="fu">tolower</span>(quant_metric) <span class="sc">==</span> <span class="st">&quot;rmse&quot;</span> <span class="sc">~</span> <span class="st">&quot;RMSE&quot;</span></span>
<span id="cb242-281"><a href="chm-raster-resolution-testing.html#cb242-281" tabindex="-1"></a>            , <span class="fu">tolower</span>(quant_metric) <span class="sc">==</span> <span class="st">&quot;mean&quot;</span> <span class="sc">~</span> <span class="st">&quot;Mean Error&quot;</span></span>
<span id="cb242-282"><a href="chm-raster-resolution-testing.html#cb242-282" tabindex="-1"></a>            , T <span class="sc">~</span> <span class="st">&quot;MAPE&quot;</span></span>
<span id="cb242-283"><a href="chm-raster-resolution-testing.html#cb242-283" tabindex="-1"></a>          )</span>
<span id="cb242-284"><a href="chm-raster-resolution-testing.html#cb242-284" tabindex="-1"></a>        ) <span class="sc">+</span></span>
<span id="cb242-285"><a href="chm-raster-resolution-testing.html#cb242-285" tabindex="-1"></a>        ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb242-286"><a href="chm-raster-resolution-testing.html#cb242-286" tabindex="-1"></a>        ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb242-287"><a href="chm-raster-resolution-testing.html#cb242-287" tabindex="-1"></a>          <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb242-288"><a href="chm-raster-resolution-testing.html#cb242-288" tabindex="-1"></a>          , <span class="at">strip.text.x =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb242-289"><a href="chm-raster-resolution-testing.html#cb242-289" tabindex="-1"></a>          , <span class="at">strip.text.y =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">9</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb242-290"><a href="chm-raster-resolution-testing.html#cb242-290" tabindex="-1"></a>          , <span class="at">axis.text.x =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">7</span>)</span>
<span id="cb242-291"><a href="chm-raster-resolution-testing.html#cb242-291" tabindex="-1"></a>          , <span class="at">axis.text.y =</span> ggplot2<span class="sc">::</span><span class="fu">element_blank</span>()</span>
<span id="cb242-292"><a href="chm-raster-resolution-testing.html#cb242-292" tabindex="-1"></a>          , <span class="at">axis.ticks.y =</span> ggplot2<span class="sc">::</span><span class="fu">element_blank</span>()</span>
<span id="cb242-293"><a href="chm-raster-resolution-testing.html#cb242-293" tabindex="-1"></a>          , <span class="at">panel.grid.major.y =</span> ggplot2<span class="sc">::</span><span class="fu">element_blank</span>()</span>
<span id="cb242-294"><a href="chm-raster-resolution-testing.html#cb242-294" tabindex="-1"></a>          , <span class="at">panel.grid.minor.y =</span> ggplot2<span class="sc">::</span><span class="fu">element_blank</span>()</span>
<span id="cb242-295"><a href="chm-raster-resolution-testing.html#cb242-295" tabindex="-1"></a>          , <span class="at">plot.subtitle =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>)</span>
<span id="cb242-296"><a href="chm-raster-resolution-testing.html#cb242-296" tabindex="-1"></a>        )</span>
<span id="cb242-297"><a href="chm-raster-resolution-testing.html#cb242-297" tabindex="-1"></a>    </span>
<span id="cb242-298"><a href="chm-raster-resolution-testing.html#cb242-298" tabindex="-1"></a>  }<span class="cf">else</span>{</span>
<span id="cb242-299"><a href="chm-raster-resolution-testing.html#cb242-299" tabindex="-1"></a>    <span class="co"># aggregate</span></span>
<span id="cb242-300"><a href="chm-raster-resolution-testing.html#cb242-300" tabindex="-1"></a>    xxxdf_temp <span class="ot">&lt;-</span> df_temp <span class="sc">%&gt;%</span> </span>
<span id="cb242-301"><a href="chm-raster-resolution-testing.html#cb242-301" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">group_by</span>(chm_res_m_desc,pile_metric,eval_metric) <span class="sc">%&gt;%</span> </span>
<span id="cb242-302"><a href="chm-raster-resolution-testing.html#cb242-302" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">summarise</span>(<span class="at">value =</span> <span class="fu">median</span>(value,<span class="at">na.rm=</span>T)) <span class="sc">%&gt;%</span> </span>
<span id="cb242-303"><a href="chm-raster-resolution-testing.html#cb242-303" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb242-304"><a href="chm-raster-resolution-testing.html#cb242-304" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb242-305"><a href="chm-raster-resolution-testing.html#cb242-305" tabindex="-1"></a>        <span class="at">value_lab =</span> <span class="fu">paste0</span>(</span>
<span id="cb242-306"><a href="chm-raster-resolution-testing.html#cb242-306" tabindex="-1"></a>            <span class="st">&quot;median:</span><span class="sc">\n</span><span class="st">&quot;</span></span>
<span id="cb242-307"><a href="chm-raster-resolution-testing.html#cb242-307" tabindex="-1"></a>          , dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb242-308"><a href="chm-raster-resolution-testing.html#cb242-308" tabindex="-1"></a>            eval_metric <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;RRMSE&quot;</span>, <span class="st">&quot;MAPE&quot;</span>) <span class="sc">~</span> scales<span class="sc">::</span><span class="fu">percent</span>(value,<span class="at">accuracy=</span><span class="fl">0.1</span>)</span>
<span id="cb242-309"><a href="chm-raster-resolution-testing.html#cb242-309" tabindex="-1"></a>            , eval_metric <span class="sc">==</span> <span class="st">&quot;ME&quot;</span> <span class="sc">~</span> scales<span class="sc">::</span><span class="fu">comma</span>(value,<span class="at">accuracy=</span><span class="fl">0.01</span>)</span>
<span id="cb242-310"><a href="chm-raster-resolution-testing.html#cb242-310" tabindex="-1"></a>            , T <span class="sc">~</span> scales<span class="sc">::</span><span class="fu">comma</span>(value,<span class="at">accuracy=</span><span class="fl">0.1</span>)</span>
<span id="cb242-311"><a href="chm-raster-resolution-testing.html#cb242-311" tabindex="-1"></a>          )</span>
<span id="cb242-312"><a href="chm-raster-resolution-testing.html#cb242-312" tabindex="-1"></a>        )</span>
<span id="cb242-313"><a href="chm-raster-resolution-testing.html#cb242-313" tabindex="-1"></a>      )</span>
<span id="cb242-314"><a href="chm-raster-resolution-testing.html#cb242-314" tabindex="-1"></a>    </span>
<span id="cb242-315"><a href="chm-raster-resolution-testing.html#cb242-315" tabindex="-1"></a>    p <span class="ot">&lt;-</span> </span>
<span id="cb242-316"><a href="chm-raster-resolution-testing.html#cb242-316" tabindex="-1"></a>      df_temp <span class="sc">%&gt;%</span> </span>
<span id="cb242-317"><a href="chm-raster-resolution-testing.html#cb242-317" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">filter</span>(</span>
<span id="cb242-318"><a href="chm-raster-resolution-testing.html#cb242-318" tabindex="-1"></a>        eval_metric<span class="sc">==</span>dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb242-319"><a href="chm-raster-resolution-testing.html#cb242-319" tabindex="-1"></a>          <span class="fu">tolower</span>(quant_metric) <span class="sc">==</span> <span class="st">&quot;mape&quot;</span> <span class="sc">~</span> <span class="st">&quot;MAPE&quot;</span></span>
<span id="cb242-320"><a href="chm-raster-resolution-testing.html#cb242-320" tabindex="-1"></a>          , <span class="fu">tolower</span>(quant_metric) <span class="sc">==</span> <span class="st">&quot;rmse&quot;</span> <span class="sc">~</span> <span class="st">&quot;RMSE&quot;</span></span>
<span id="cb242-321"><a href="chm-raster-resolution-testing.html#cb242-321" tabindex="-1"></a>          , <span class="fu">tolower</span>(quant_metric) <span class="sc">==</span> <span class="st">&quot;mean&quot;</span> <span class="sc">~</span> <span class="st">&quot;ME&quot;</span></span>
<span id="cb242-322"><a href="chm-raster-resolution-testing.html#cb242-322" tabindex="-1"></a>          , T <span class="sc">~</span> <span class="st">&quot;MAPE&quot;</span></span>
<span id="cb242-323"><a href="chm-raster-resolution-testing.html#cb242-323" tabindex="-1"></a>        )</span>
<span id="cb242-324"><a href="chm-raster-resolution-testing.html#cb242-324" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span> </span>
<span id="cb242-325"><a href="chm-raster-resolution-testing.html#cb242-325" tabindex="-1"></a>          ggplot2<span class="sc">::</span><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb242-326"><a href="chm-raster-resolution-testing.html#cb242-326" tabindex="-1"></a>          <span class="co"># ggplot2::geom_vline(xintercept = 0, color = &quot;gray&quot;) +</span></span>
<span id="cb242-327"><a href="chm-raster-resolution-testing.html#cb242-327" tabindex="-1"></a>          ggplot2<span class="sc">::</span><span class="fu">geom_density</span>(<span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">y =</span> ggplot2<span class="sc">::</span><span class="fu">after_stat</span>(scaled), <span class="at">fill =</span> pile_metric), <span class="at">color =</span> <span class="cn">NA</span>, <span class="at">alpha =</span> <span class="fl">0.9</span>) <span class="sc">+</span></span>
<span id="cb242-328"><a href="chm-raster-resolution-testing.html#cb242-328" tabindex="-1"></a>          harrypotter<span class="sc">::</span><span class="fu">scale_fill_hp_d</span>(<span class="at">option =</span> <span class="st">&quot;hermionegranger&quot;</span>) <span class="sc">+</span></span>
<span id="cb242-329"><a href="chm-raster-resolution-testing.html#cb242-329" tabindex="-1"></a>          harrypotter<span class="sc">::</span><span class="fu">scale_color_hp_d</span>(<span class="at">option =</span> <span class="st">&quot;hermionegranger&quot;</span>) <span class="sc">+</span></span>
<span id="cb242-330"><a href="chm-raster-resolution-testing.html#cb242-330" tabindex="-1"></a>          ggplot2<span class="sc">::</span><span class="fu">geom_vline</span>(</span>
<span id="cb242-331"><a href="chm-raster-resolution-testing.html#cb242-331" tabindex="-1"></a>            <span class="at">data =</span> xxxdf_temp <span class="sc">%&gt;%</span> </span>
<span id="cb242-332"><a href="chm-raster-resolution-testing.html#cb242-332" tabindex="-1"></a>              dplyr<span class="sc">::</span><span class="fu">filter</span>(</span>
<span id="cb242-333"><a href="chm-raster-resolution-testing.html#cb242-333" tabindex="-1"></a>                eval_metric<span class="sc">==</span>dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb242-334"><a href="chm-raster-resolution-testing.html#cb242-334" tabindex="-1"></a>                  <span class="fu">tolower</span>(quant_metric) <span class="sc">==</span> <span class="st">&quot;mape&quot;</span> <span class="sc">~</span> <span class="st">&quot;MAPE&quot;</span></span>
<span id="cb242-335"><a href="chm-raster-resolution-testing.html#cb242-335" tabindex="-1"></a>                  , <span class="fu">tolower</span>(quant_metric) <span class="sc">==</span> <span class="st">&quot;rmse&quot;</span> <span class="sc">~</span> <span class="st">&quot;RMSE&quot;</span></span>
<span id="cb242-336"><a href="chm-raster-resolution-testing.html#cb242-336" tabindex="-1"></a>                  , <span class="fu">tolower</span>(quant_metric) <span class="sc">==</span> <span class="st">&quot;mean&quot;</span> <span class="sc">~</span> <span class="st">&quot;ME&quot;</span></span>
<span id="cb242-337"><a href="chm-raster-resolution-testing.html#cb242-337" tabindex="-1"></a>                  , T <span class="sc">~</span> <span class="st">&quot;MAPE&quot;</span></span>
<span id="cb242-338"><a href="chm-raster-resolution-testing.html#cb242-338" tabindex="-1"></a>                )</span>
<span id="cb242-339"><a href="chm-raster-resolution-testing.html#cb242-339" tabindex="-1"></a>              )</span>
<span id="cb242-340"><a href="chm-raster-resolution-testing.html#cb242-340" tabindex="-1"></a>            , <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">xintercept =</span> value)</span>
<span id="cb242-341"><a href="chm-raster-resolution-testing.html#cb242-341" tabindex="-1"></a>            , <span class="at">color =</span> <span class="st">&quot;gray44&quot;</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span></span>
<span id="cb242-342"><a href="chm-raster-resolution-testing.html#cb242-342" tabindex="-1"></a>          ) <span class="sc">+</span></span>
<span id="cb242-343"><a href="chm-raster-resolution-testing.html#cb242-343" tabindex="-1"></a>          ggplot2<span class="sc">::</span><span class="fu">geom_text</span>(</span>
<span id="cb242-344"><a href="chm-raster-resolution-testing.html#cb242-344" tabindex="-1"></a>            <span class="at">data =</span> xxxdf_temp <span class="sc">%&gt;%</span> </span>
<span id="cb242-345"><a href="chm-raster-resolution-testing.html#cb242-345" tabindex="-1"></a>              dplyr<span class="sc">::</span><span class="fu">filter</span>(</span>
<span id="cb242-346"><a href="chm-raster-resolution-testing.html#cb242-346" tabindex="-1"></a>                eval_metric<span class="sc">==</span>dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb242-347"><a href="chm-raster-resolution-testing.html#cb242-347" tabindex="-1"></a>                  <span class="fu">tolower</span>(quant_metric) <span class="sc">==</span> <span class="st">&quot;mape&quot;</span> <span class="sc">~</span> <span class="st">&quot;MAPE&quot;</span></span>
<span id="cb242-348"><a href="chm-raster-resolution-testing.html#cb242-348" tabindex="-1"></a>                  , <span class="fu">tolower</span>(quant_metric) <span class="sc">==</span> <span class="st">&quot;rmse&quot;</span> <span class="sc">~</span> <span class="st">&quot;RMSE&quot;</span></span>
<span id="cb242-349"><a href="chm-raster-resolution-testing.html#cb242-349" tabindex="-1"></a>                  , <span class="fu">tolower</span>(quant_metric) <span class="sc">==</span> <span class="st">&quot;mean&quot;</span> <span class="sc">~</span> <span class="st">&quot;ME&quot;</span></span>
<span id="cb242-350"><a href="chm-raster-resolution-testing.html#cb242-350" tabindex="-1"></a>                  , T <span class="sc">~</span> <span class="st">&quot;MAPE&quot;</span></span>
<span id="cb242-351"><a href="chm-raster-resolution-testing.html#cb242-351" tabindex="-1"></a>                )</span>
<span id="cb242-352"><a href="chm-raster-resolution-testing.html#cb242-352" tabindex="-1"></a>              )</span>
<span id="cb242-353"><a href="chm-raster-resolution-testing.html#cb242-353" tabindex="-1"></a>            , <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(</span>
<span id="cb242-354"><a href="chm-raster-resolution-testing.html#cb242-354" tabindex="-1"></a>              <span class="at">x =</span> <span class="sc">-</span><span class="cn">Inf</span>, <span class="at">y =</span> <span class="cn">Inf</span> <span class="co"># always in upper left?</span></span>
<span id="cb242-355"><a href="chm-raster-resolution-testing.html#cb242-355" tabindex="-1"></a>              <span class="co"># x = value, y = 0</span></span>
<span id="cb242-356"><a href="chm-raster-resolution-testing.html#cb242-356" tabindex="-1"></a>              , <span class="at">label =</span> value_lab</span>
<span id="cb242-357"><a href="chm-raster-resolution-testing.html#cb242-357" tabindex="-1"></a>            )</span>
<span id="cb242-358"><a href="chm-raster-resolution-testing.html#cb242-358" tabindex="-1"></a>            , <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">0.1</span>, <span class="at">vjust =</span> <span class="dv">1</span> <span class="co"># always in upper left?</span></span>
<span id="cb242-359"><a href="chm-raster-resolution-testing.html#cb242-359" tabindex="-1"></a>            <span class="co"># , hjust = -0.1, vjust = -5</span></span>
<span id="cb242-360"><a href="chm-raster-resolution-testing.html#cb242-360" tabindex="-1"></a>            , <span class="at">size =</span> <span class="fl">2.5</span></span>
<span id="cb242-361"><a href="chm-raster-resolution-testing.html#cb242-361" tabindex="-1"></a>          ) <span class="sc">+</span></span>
<span id="cb242-362"><a href="chm-raster-resolution-testing.html#cb242-362" tabindex="-1"></a>          ggplot2<span class="sc">::</span><span class="fu">facet_grid</span>(<span class="at">cols =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(pile_metric), <span class="at">rows =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(chm_res_m_desc), <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>) <span class="sc">+</span></span>
<span id="cb242-363"><a href="chm-raster-resolution-testing.html#cb242-363" tabindex="-1"></a>          ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb242-364"><a href="chm-raster-resolution-testing.html#cb242-364" tabindex="-1"></a>            <span class="at">x =</span> <span class="st">&quot;&quot;</span>, <span class="at">y =</span> <span class="st">&quot;&quot;</span></span>
<span id="cb242-365"><a href="chm-raster-resolution-testing.html#cb242-365" tabindex="-1"></a>            , <span class="at">subtitle =</span> my_subtitle</span>
<span id="cb242-366"><a href="chm-raster-resolution-testing.html#cb242-366" tabindex="-1"></a>            , <span class="at">title =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb242-367"><a href="chm-raster-resolution-testing.html#cb242-367" tabindex="-1"></a>              <span class="fu">tolower</span>(quant_metric) <span class="sc">==</span> <span class="st">&quot;mape&quot;</span> <span class="sc">~</span> <span class="st">&quot;MAPE&quot;</span></span>
<span id="cb242-368"><a href="chm-raster-resolution-testing.html#cb242-368" tabindex="-1"></a>              , <span class="fu">tolower</span>(quant_metric) <span class="sc">==</span> <span class="st">&quot;rmse&quot;</span> <span class="sc">~</span> <span class="st">&quot;RMSE&quot;</span></span>
<span id="cb242-369"><a href="chm-raster-resolution-testing.html#cb242-369" tabindex="-1"></a>              , <span class="fu">tolower</span>(quant_metric) <span class="sc">==</span> <span class="st">&quot;mean&quot;</span> <span class="sc">~</span> <span class="st">&quot;Mean Error&quot;</span></span>
<span id="cb242-370"><a href="chm-raster-resolution-testing.html#cb242-370" tabindex="-1"></a>              , T <span class="sc">~</span> <span class="st">&quot;MAPE&quot;</span></span>
<span id="cb242-371"><a href="chm-raster-resolution-testing.html#cb242-371" tabindex="-1"></a>            )</span>
<span id="cb242-372"><a href="chm-raster-resolution-testing.html#cb242-372" tabindex="-1"></a>          ) <span class="sc">+</span></span>
<span id="cb242-373"><a href="chm-raster-resolution-testing.html#cb242-373" tabindex="-1"></a>          ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb242-374"><a href="chm-raster-resolution-testing.html#cb242-374" tabindex="-1"></a>          ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb242-375"><a href="chm-raster-resolution-testing.html#cb242-375" tabindex="-1"></a>            <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb242-376"><a href="chm-raster-resolution-testing.html#cb242-376" tabindex="-1"></a>            , <span class="at">strip.text.x =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb242-377"><a href="chm-raster-resolution-testing.html#cb242-377" tabindex="-1"></a>            , <span class="at">strip.text.y =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">9</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb242-378"><a href="chm-raster-resolution-testing.html#cb242-378" tabindex="-1"></a>            , <span class="at">axis.text.x =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">7</span>)</span>
<span id="cb242-379"><a href="chm-raster-resolution-testing.html#cb242-379" tabindex="-1"></a>            , <span class="at">axis.text.y =</span> ggplot2<span class="sc">::</span><span class="fu">element_blank</span>()</span>
<span id="cb242-380"><a href="chm-raster-resolution-testing.html#cb242-380" tabindex="-1"></a>            , <span class="at">axis.ticks.y =</span> ggplot2<span class="sc">::</span><span class="fu">element_blank</span>()</span>
<span id="cb242-381"><a href="chm-raster-resolution-testing.html#cb242-381" tabindex="-1"></a>            , <span class="at">panel.grid.major.y =</span> ggplot2<span class="sc">::</span><span class="fu">element_blank</span>()</span>
<span id="cb242-382"><a href="chm-raster-resolution-testing.html#cb242-382" tabindex="-1"></a>            , <span class="at">panel.grid.minor.y =</span> ggplot2<span class="sc">::</span><span class="fu">element_blank</span>()</span>
<span id="cb242-383"><a href="chm-raster-resolution-testing.html#cb242-383" tabindex="-1"></a>            , <span class="at">plot.subtitle =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>)</span>
<span id="cb242-384"><a href="chm-raster-resolution-testing.html#cb242-384" tabindex="-1"></a>          )</span>
<span id="cb242-385"><a href="chm-raster-resolution-testing.html#cb242-385" tabindex="-1"></a>        </span>
<span id="cb242-386"><a href="chm-raster-resolution-testing.html#cb242-386" tabindex="-1"></a>        <span class="cf">if</span>(show_rug){</span>
<span id="cb242-387"><a href="chm-raster-resolution-testing.html#cb242-387" tabindex="-1"></a>          p <span class="ot">&lt;-</span> p <span class="sc">+</span> ggplot2<span class="sc">::</span><span class="fu">geom_rug</span>(<span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">color =</span> pile_metric))</span>
<span id="cb242-388"><a href="chm-raster-resolution-testing.html#cb242-388" tabindex="-1"></a>        }</span>
<span id="cb242-389"><a href="chm-raster-resolution-testing.html#cb242-389" tabindex="-1"></a>  }</span>
<span id="cb242-390"><a href="chm-raster-resolution-testing.html#cb242-390" tabindex="-1"></a>      </span>
<span id="cb242-391"><a href="chm-raster-resolution-testing.html#cb242-391" tabindex="-1"></a>  <span class="cf">if</span>(</span>
<span id="cb242-392"><a href="chm-raster-resolution-testing.html#cb242-392" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb242-393"><a href="chm-raster-resolution-testing.html#cb242-393" tabindex="-1"></a>      <span class="fu">tolower</span>(quant_metric) <span class="sc">==</span> <span class="st">&quot;mape&quot;</span> <span class="sc">~</span> <span class="st">&quot;MAPE&quot;</span></span>
<span id="cb242-394"><a href="chm-raster-resolution-testing.html#cb242-394" tabindex="-1"></a>      , <span class="fu">tolower</span>(quant_metric) <span class="sc">==</span> <span class="st">&quot;rmse&quot;</span> <span class="sc">~</span> <span class="st">&quot;RMSE&quot;</span></span>
<span id="cb242-395"><a href="chm-raster-resolution-testing.html#cb242-395" tabindex="-1"></a>      , <span class="fu">tolower</span>(quant_metric) <span class="sc">==</span> <span class="st">&quot;mean&quot;</span> <span class="sc">~</span> <span class="st">&quot;ME&quot;</span></span>
<span id="cb242-396"><a href="chm-raster-resolution-testing.html#cb242-396" tabindex="-1"></a>      , T <span class="sc">~</span> <span class="st">&quot;MAPE&quot;</span></span>
<span id="cb242-397"><a href="chm-raster-resolution-testing.html#cb242-397" tabindex="-1"></a>    ) <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;RRMSE&quot;</span>, <span class="st">&quot;MAPE&quot;</span>)</span>
<span id="cb242-398"><a href="chm-raster-resolution-testing.html#cb242-398" tabindex="-1"></a>  ){</span>
<span id="cb242-399"><a href="chm-raster-resolution-testing.html#cb242-399" tabindex="-1"></a>    <span class="fu">return</span>(p<span class="sc">+</span>ggplot2<span class="sc">::</span><span class="fu">scale_x_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">percent_format</span>(<span class="at">accuracy =</span> <span class="dv">1</span>)))</span>
<span id="cb242-400"><a href="chm-raster-resolution-testing.html#cb242-400" tabindex="-1"></a>  }<span class="cf">else</span>{</span>
<span id="cb242-401"><a href="chm-raster-resolution-testing.html#cb242-401" tabindex="-1"></a>    <span class="fu">return</span>(p)</span>
<span id="cb242-402"><a href="chm-raster-resolution-testing.html#cb242-402" tabindex="-1"></a>  }</span>
<span id="cb242-403"><a href="chm-raster-resolution-testing.html#cb242-403" tabindex="-1"></a>    </span>
<span id="cb242-404"><a href="chm-raster-resolution-testing.html#cb242-404" tabindex="-1"></a>}</span></code></pre></div>
<div id="mape_trends" class="section level4 hasAnchor" number="8.5.2.1">
<h4><span class="header-section-number">8.5.2.1</span> MAPE<a href="chm-raster-resolution-testing.html#mape_trends" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><strong>MAPE</strong> represents the typical magnitude of error as a percentage, allowing for scale-independent comparisons</p>
<p>distribution across all parameter combinations tested</p>
<div class="sourceCode" id="cb243"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb243-1"><a href="chm-raster-resolution-testing.html#cb243-1" tabindex="-1"></a><span class="co"># plot it</span></span>
<span id="cb243-2"><a href="chm-raster-resolution-testing.html#cb243-2" tabindex="-1"></a><span class="fu">plt_form_quantification_dist2</span>(</span>
<span id="cb243-3"><a href="chm-raster-resolution-testing.html#cb243-3" tabindex="-1"></a>  <span class="at">df =</span> param_combos_gt_agg</span>
<span id="cb243-4"><a href="chm-raster-resolution-testing.html#cb243-4" tabindex="-1"></a>  , <span class="at">quant_metric =</span> <span class="st">&quot;mape&quot;</span></span>
<span id="cb243-5"><a href="chm-raster-resolution-testing.html#cb243-5" tabindex="-1"></a>  , <span class="fu">paste0</span>(</span>
<span id="cb243-6"><a href="chm-raster-resolution-testing.html#cb243-6" tabindex="-1"></a>     <span class="st">&quot;Structural Data Only&quot;</span></span>
<span id="cb243-7"><a href="chm-raster-resolution-testing.html#cb243-7" tabindex="-1"></a>      , <span class="st">&quot;</span><span class="sc">\n</span><span class="st">distribution of pile form quantification accuracy metrics for all&quot;</span></span>
<span id="cb243-8"><a href="chm-raster-resolution-testing.html#cb243-8" tabindex="-1"></a>     , <span class="st">&quot; (n=&quot;</span></span>
<span id="cb243-9"><a href="chm-raster-resolution-testing.html#cb243-9" tabindex="-1"></a>     , scales<span class="sc">::</span><span class="fu">comma</span>(n_combos_tested_chm, <span class="at">accuracy =</span> <span class="dv">1</span>)</span>
<span id="cb243-10"><a href="chm-raster-resolution-testing.html#cb243-10" tabindex="-1"></a>     , <span class="st">&quot;) &quot;</span></span>
<span id="cb243-11"><a href="chm-raster-resolution-testing.html#cb243-11" tabindex="-1"></a>     , <span class="st">&quot;parameter combinations tested&quot;</span></span>
<span id="cb243-12"><a href="chm-raster-resolution-testing.html#cb243-12" tabindex="-1"></a>  )</span>
<span id="cb243-13"><a href="chm-raster-resolution-testing.html#cb243-13" tabindex="-1"></a>  , <span class="at">show_rug =</span> F</span>
<span id="cb243-14"><a href="chm-raster-resolution-testing.html#cb243-14" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-208-1.png" width="1008" /></p>
<p>let’s average across all other factors to look at the median main effect by parameter and quantification metric</p>
<div class="sourceCode" id="cb244"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb244-1"><a href="chm-raster-resolution-testing.html#cb244-1" tabindex="-1"></a><span class="fu">plt_form_quantification_trend</span>(param_combos_gt_agg, <span class="at">quant_metric =</span> <span class="st">&quot;mape&quot;</span>)</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-209-1.png" width="1008" /></p>
<p><em>WHAT DID WE LEARN FROM THIS</em></p>
</div>
<div id="mean-error-me" class="section level4 hasAnchor" number="8.5.2.2">
<h4><span class="header-section-number">8.5.2.2</span> Mean Error (ME)<a href="chm-raster-resolution-testing.html#mean-error-me" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><strong>Mean Error (ME)</strong> represents the direction of bias (over or under-prediction) in the original units</p>
<p>distribution across all parameter combinations tested</p>
<div class="sourceCode" id="cb245"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb245-1"><a href="chm-raster-resolution-testing.html#cb245-1" tabindex="-1"></a><span class="co"># plot it</span></span>
<span id="cb245-2"><a href="chm-raster-resolution-testing.html#cb245-2" tabindex="-1"></a><span class="fu">plt_form_quantification_dist2</span>(</span>
<span id="cb245-3"><a href="chm-raster-resolution-testing.html#cb245-3" tabindex="-1"></a>  <span class="at">df =</span> param_combos_gt_agg</span>
<span id="cb245-4"><a href="chm-raster-resolution-testing.html#cb245-4" tabindex="-1"></a>  , <span class="at">quant_metric =</span> <span class="st">&quot;mean&quot;</span></span>
<span id="cb245-5"><a href="chm-raster-resolution-testing.html#cb245-5" tabindex="-1"></a>  , <span class="fu">paste0</span>(</span>
<span id="cb245-6"><a href="chm-raster-resolution-testing.html#cb245-6" tabindex="-1"></a>     <span class="st">&quot;Structural Data Only&quot;</span></span>
<span id="cb245-7"><a href="chm-raster-resolution-testing.html#cb245-7" tabindex="-1"></a>      , <span class="st">&quot;</span><span class="sc">\n</span><span class="st">distribution of pile form quantification accuracy metrics for all&quot;</span></span>
<span id="cb245-8"><a href="chm-raster-resolution-testing.html#cb245-8" tabindex="-1"></a>     , <span class="st">&quot; (n=&quot;</span></span>
<span id="cb245-9"><a href="chm-raster-resolution-testing.html#cb245-9" tabindex="-1"></a>     , scales<span class="sc">::</span><span class="fu">comma</span>(n_combos_tested_chm, <span class="at">accuracy =</span> <span class="dv">1</span>)</span>
<span id="cb245-10"><a href="chm-raster-resolution-testing.html#cb245-10" tabindex="-1"></a>     , <span class="st">&quot;) &quot;</span></span>
<span id="cb245-11"><a href="chm-raster-resolution-testing.html#cb245-11" tabindex="-1"></a>     , <span class="st">&quot;parameter combinations tested&quot;</span></span>
<span id="cb245-12"><a href="chm-raster-resolution-testing.html#cb245-12" tabindex="-1"></a>  )</span>
<span id="cb245-13"><a href="chm-raster-resolution-testing.html#cb245-13" tabindex="-1"></a>  , <span class="at">show_rug =</span> F</span>
<span id="cb245-14"><a href="chm-raster-resolution-testing.html#cb245-14" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-210-1.png" width="1008" /></p>
<p>let’s average across all other factors to look at the median main effect by parameter and quantification metric</p>
<div class="sourceCode" id="cb246"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb246-1"><a href="chm-raster-resolution-testing.html#cb246-1" tabindex="-1"></a><span class="fu">plt_form_quantification_trend</span>(param_combos_gt_agg, <span class="at">quant_metric =</span> <span class="st">&quot;mean&quot;</span>)</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-211-1.png" width="1008" /></p>
<p><em>WHAT DID WE LEARN FROM THIS</em></p>
</div>
<div id="rmse" class="section level4 hasAnchor" number="8.5.2.3">
<h4><span class="header-section-number">8.5.2.3</span> RMSE<a href="chm-raster-resolution-testing.html#rmse" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><strong>RMSE</strong> represents the typical magnitude of error in the original units, with a stronger penalty for large errors</p>
<div class="sourceCode" id="cb247"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb247-1"><a href="chm-raster-resolution-testing.html#cb247-1" tabindex="-1"></a><span class="co"># plot it</span></span>
<span id="cb247-2"><a href="chm-raster-resolution-testing.html#cb247-2" tabindex="-1"></a><span class="fu">plt_form_quantification_dist2</span>(</span>
<span id="cb247-3"><a href="chm-raster-resolution-testing.html#cb247-3" tabindex="-1"></a>  <span class="at">df =</span> param_combos_gt_agg</span>
<span id="cb247-4"><a href="chm-raster-resolution-testing.html#cb247-4" tabindex="-1"></a>  , <span class="at">quant_metric =</span> <span class="st">&quot;rmse&quot;</span></span>
<span id="cb247-5"><a href="chm-raster-resolution-testing.html#cb247-5" tabindex="-1"></a>  , <span class="fu">paste0</span>(</span>
<span id="cb247-6"><a href="chm-raster-resolution-testing.html#cb247-6" tabindex="-1"></a>     <span class="st">&quot;Structural Data Only&quot;</span></span>
<span id="cb247-7"><a href="chm-raster-resolution-testing.html#cb247-7" tabindex="-1"></a>      , <span class="st">&quot;</span><span class="sc">\n</span><span class="st">distribution of pile form quantification accuracy metrics for all&quot;</span></span>
<span id="cb247-8"><a href="chm-raster-resolution-testing.html#cb247-8" tabindex="-1"></a>     , <span class="st">&quot; (n=&quot;</span></span>
<span id="cb247-9"><a href="chm-raster-resolution-testing.html#cb247-9" tabindex="-1"></a>     , scales<span class="sc">::</span><span class="fu">comma</span>(n_combos_tested_chm, <span class="at">accuracy =</span> <span class="dv">1</span>)</span>
<span id="cb247-10"><a href="chm-raster-resolution-testing.html#cb247-10" tabindex="-1"></a>     , <span class="st">&quot;) &quot;</span></span>
<span id="cb247-11"><a href="chm-raster-resolution-testing.html#cb247-11" tabindex="-1"></a>     , <span class="st">&quot;parameter combinations tested&quot;</span></span>
<span id="cb247-12"><a href="chm-raster-resolution-testing.html#cb247-12" tabindex="-1"></a>  )</span>
<span id="cb247-13"><a href="chm-raster-resolution-testing.html#cb247-13" tabindex="-1"></a>  , <span class="at">show_rug =</span> F</span>
<span id="cb247-14"><a href="chm-raster-resolution-testing.html#cb247-14" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-212-1.png" width="1008" /></p>
<p>let’s average across all other factors to look at the median main effect by parameter and quantification metric</p>
<div class="sourceCode" id="cb248"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb248-1"><a href="chm-raster-resolution-testing.html#cb248-1" tabindex="-1"></a><span class="fu">plt_form_quantification_trend</span>(param_combos_gt_agg, <span class="at">quant_metric =</span> <span class="st">&quot;rmse&quot;</span>)</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-213-1.png" width="1008" /></p>
<p><em>WHAT DID WE LEARN FROM THIS</em></p>
</div>
</div>
<div id="final-recommended-settings" class="section level3 hasAnchor" number="8.5.3">
<h3><span class="header-section-number">8.5.3</span> Final recommended settings<a href="chm-raster-resolution-testing.html#final-recommended-settings" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>let’s identify the best-performing parameter combinations that not only balance detection and quantification accuracy but also achieve the highest recall rates. we’ll select these by choosing any combination whose recall rate is at least one standard deviation above the average for this top group. if no combinations meet this criterion, we will instead select the top 10 combinations based on their recall rates.</p>
<div id="overall-across-chm-resolution" class="section level4 hasAnchor" number="8.5.3.1">
<h4><span class="header-section-number">8.5.3.1</span> Overall (across CHM resolution)<a href="chm-raster-resolution-testing.html#overall-across-chm-resolution" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>To select the best-performing parameter combinations, we will prioritize those that balance detection and quantification accuracy. From this group, we will then identify the settings that achieve the highest pile detection rates (recall). We emphasize that these recommendations are for users who can generate a CHM from the original point cloud. This is critical because creating a new CHM at the desired resolution is a fundamentally different process than simply disaggregating an existing, coarser raster.</p>
<p>we’ll use the F-Score and the average rank of the MAPE metrics across all form measurements (i.e. height, diameter, area, volume) to determine the best overall list</p>
<div class="sourceCode" id="cb249"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb249-1"><a href="chm-raster-resolution-testing.html#cb249-1" tabindex="-1"></a><span class="do">##################### START USER DEFINED #####################</span></span>
<span id="cb249-2"><a href="chm-raster-resolution-testing.html#cb249-2" tabindex="-1"></a><span class="co"># what percent should we classify as top?</span></span>
<span id="cb249-3"><a href="chm-raster-resolution-testing.html#cb249-3" tabindex="-1"></a>pct_th_top <span class="ot">&lt;-</span> <span class="fl">0.01</span></span>
<span id="cb249-4"><a href="chm-raster-resolution-testing.html#cb249-4" tabindex="-1"></a><span class="co"># of those top, how many should be selected by recall?</span></span>
<span id="cb249-5"><a href="chm-raster-resolution-testing.html#cb249-5" tabindex="-1"></a>n_th_top <span class="ot">&lt;-</span> <span class="dv">12</span></span>
<span id="cb249-6"><a href="chm-raster-resolution-testing.html#cb249-6" tabindex="-1"></a><span class="do">##################### </span><span class="re">END</span><span class="do"> USER DEFINED #####################</span></span>
<span id="cb249-7"><a href="chm-raster-resolution-testing.html#cb249-7" tabindex="-1"></a></span>
<span id="cb249-8"><a href="chm-raster-resolution-testing.html#cb249-8" tabindex="-1"></a><span class="co"># math on user defined to label stuff</span></span>
<span id="cb249-9"><a href="chm-raster-resolution-testing.html#cb249-9" tabindex="-1"></a><span class="co"># structural only</span></span>
<span id="cb249-10"><a href="chm-raster-resolution-testing.html#cb249-10" tabindex="-1"></a>n_combos_top_overall <span class="ot">&lt;-</span> n_combos_tested<span class="sc">*</span>pct_th_top</span>
<span id="cb249-11"><a href="chm-raster-resolution-testing.html#cb249-11" tabindex="-1"></a>n_th_top_chm <span class="ot">&lt;-</span> <span class="fu">round</span>(n_th_top<span class="sc">/</span><span class="dv">2</span>)</span>
<span id="cb249-12"><a href="chm-raster-resolution-testing.html#cb249-12" tabindex="-1"></a>pct_th_top_chm <span class="ot">&lt;-</span> pct_th_top<span class="sc">*</span><span class="dv">2</span></span>
<span id="cb249-13"><a href="chm-raster-resolution-testing.html#cb249-13" tabindex="-1"></a>n_combos_top_chm <span class="ot">&lt;-</span> <span class="fu">floor</span>(n_combos_tested_chm<span class="sc">*</span>pct_th_top_chm) <span class="co"># double it so we look at more than 14??</span></span>
<span id="cb249-14"><a href="chm-raster-resolution-testing.html#cb249-14" tabindex="-1"></a>n_combos_top_spectral_chm <span class="ot">&lt;-</span> <span class="fu">floor</span>(n_combos_tested_spectral_chm<span class="sc">*</span>pct_th_top_chm)</span>
<span id="cb249-15"><a href="chm-raster-resolution-testing.html#cb249-15" tabindex="-1"></a></span>
<span id="cb249-16"><a href="chm-raster-resolution-testing.html#cb249-16" tabindex="-1"></a><span class="co"># param_combos_gt_agg %&gt;% nrow()</span></span>
<span id="cb249-17"><a href="chm-raster-resolution-testing.html#cb249-17" tabindex="-1"></a><span class="co"># param_combos_gt_agg %&gt;% dplyr::select(tidyselect::ends_with(&quot;_mape&quot;)) %&gt;% dplyr::glimpse()</span></span>
<span id="cb249-18"><a href="chm-raster-resolution-testing.html#cb249-18" tabindex="-1"></a>param_combos_ranked <span class="ot">&lt;-</span></span>
<span id="cb249-19"><a href="chm-raster-resolution-testing.html#cb249-19" tabindex="-1"></a>  param_combos_gt_agg <span class="sc">%&gt;%</span></span>
<span id="cb249-20"><a href="chm-raster-resolution-testing.html#cb249-20" tabindex="-1"></a>  <span class="do">##########</span></span>
<span id="cb249-21"><a href="chm-raster-resolution-testing.html#cb249-21" tabindex="-1"></a>  <span class="co"># first. find overall top combinations irrespective of CHM res</span></span>
<span id="cb249-22"><a href="chm-raster-resolution-testing.html#cb249-22" tabindex="-1"></a>  <span class="do">##########</span></span>
<span id="cb249-23"><a href="chm-raster-resolution-testing.html#cb249-23" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb249-24"><a href="chm-raster-resolution-testing.html#cb249-24" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb249-25"><a href="chm-raster-resolution-testing.html#cb249-25" tabindex="-1"></a>    <span class="co"># label combining params</span></span>
<span id="cb249-26"><a href="chm-raster-resolution-testing.html#cb249-26" tabindex="-1"></a>    <span class="at">lab =</span> stringr<span class="sc">::</span><span class="fu">str_c</span>(max_ht_m,max_area_m2,convexity_pct,circle_fit_iou_pct,chm_res_m, <span class="at">sep =</span> <span class="st">&quot;:&quot;</span>)</span>
<span id="cb249-27"><a href="chm-raster-resolution-testing.html#cb249-27" tabindex="-1"></a>    , dplyr<span class="sc">::</span><span class="fu">across</span>(</span>
<span id="cb249-28"><a href="chm-raster-resolution-testing.html#cb249-28" tabindex="-1"></a>      <span class="at">.cols =</span> <span class="fu">c</span>(tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_mape&quot;</span>))</span>
<span id="cb249-29"><a href="chm-raster-resolution-testing.html#cb249-29" tabindex="-1"></a>      , <span class="at">.fn =</span> <span class="sc">~</span>dplyr<span class="sc">::</span><span class="fu">percent_rank</span>(<span class="sc">-</span>.x)</span>
<span id="cb249-30"><a href="chm-raster-resolution-testing.html#cb249-30" tabindex="-1"></a>      , <span class="at">.names =</span> <span class="st">&quot;ovrall_pct_rank_quant_{.col}&quot;</span></span>
<span id="cb249-31"><a href="chm-raster-resolution-testing.html#cb249-31" tabindex="-1"></a>    )</span>
<span id="cb249-32"><a href="chm-raster-resolution-testing.html#cb249-32" tabindex="-1"></a>    , dplyr<span class="sc">::</span><span class="fu">across</span>(</span>
<span id="cb249-33"><a href="chm-raster-resolution-testing.html#cb249-33" tabindex="-1"></a>      <span class="at">.cols =</span> <span class="fu">c</span>(f_score)</span>
<span id="cb249-34"><a href="chm-raster-resolution-testing.html#cb249-34" tabindex="-1"></a>      <span class="co"># .cols = c(f_score,recall)</span></span>
<span id="cb249-35"><a href="chm-raster-resolution-testing.html#cb249-35" tabindex="-1"></a>      , <span class="at">.fn =</span> <span class="sc">~</span>dplyr<span class="sc">::</span><span class="fu">percent_rank</span>(.x)</span>
<span id="cb249-36"><a href="chm-raster-resolution-testing.html#cb249-36" tabindex="-1"></a>      , <span class="at">.names =</span> <span class="st">&quot;ovrall_pct_rank_det_{.col}&quot;</span></span>
<span id="cb249-37"><a href="chm-raster-resolution-testing.html#cb249-37" tabindex="-1"></a>    )</span>
<span id="cb249-38"><a href="chm-raster-resolution-testing.html#cb249-38" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb249-39"><a href="chm-raster-resolution-testing.html#cb249-39" tabindex="-1"></a>  <span class="do">##########</span></span>
<span id="cb249-40"><a href="chm-raster-resolution-testing.html#cb249-40" tabindex="-1"></a>  <span class="co"># second. find top combinations by CHM res</span></span>
<span id="cb249-41"><a href="chm-raster-resolution-testing.html#cb249-41" tabindex="-1"></a>  <span class="do">##########</span></span>
<span id="cb249-42"><a href="chm-raster-resolution-testing.html#cb249-42" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(chm_res_m) <span class="sc">%&gt;%</span> </span>
<span id="cb249-43"><a href="chm-raster-resolution-testing.html#cb249-43" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb249-44"><a href="chm-raster-resolution-testing.html#cb249-44" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">across</span>(</span>
<span id="cb249-45"><a href="chm-raster-resolution-testing.html#cb249-45" tabindex="-1"></a>      <span class="at">.cols =</span> <span class="fu">c</span>(tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_mape&quot;</span>) <span class="sc">&amp;</span> <span class="sc">!</span>tidyselect<span class="sc">::</span><span class="fu">starts_with</span>(<span class="st">&quot;ovrall_pct_rank_&quot;</span>))</span>
<span id="cb249-46"><a href="chm-raster-resolution-testing.html#cb249-46" tabindex="-1"></a>      , <span class="at">.fn =</span> <span class="sc">~</span>dplyr<span class="sc">::</span><span class="fu">percent_rank</span>(<span class="sc">-</span>.x)</span>
<span id="cb249-47"><a href="chm-raster-resolution-testing.html#cb249-47" tabindex="-1"></a>      , <span class="at">.names =</span> <span class="st">&quot;chm_pct_rank_quant_{.col}&quot;</span></span>
<span id="cb249-48"><a href="chm-raster-resolution-testing.html#cb249-48" tabindex="-1"></a>    )</span>
<span id="cb249-49"><a href="chm-raster-resolution-testing.html#cb249-49" tabindex="-1"></a>    , dplyr<span class="sc">::</span><span class="fu">across</span>(</span>
<span id="cb249-50"><a href="chm-raster-resolution-testing.html#cb249-50" tabindex="-1"></a>      <span class="at">.cols =</span> <span class="fu">c</span>(f_score)</span>
<span id="cb249-51"><a href="chm-raster-resolution-testing.html#cb249-51" tabindex="-1"></a>      <span class="co"># .cols = c(f_score,recall)</span></span>
<span id="cb249-52"><a href="chm-raster-resolution-testing.html#cb249-52" tabindex="-1"></a>      , <span class="at">.fn =</span> <span class="sc">~</span>dplyr<span class="sc">::</span><span class="fu">percent_rank</span>(.x)</span>
<span id="cb249-53"><a href="chm-raster-resolution-testing.html#cb249-53" tabindex="-1"></a>      , <span class="at">.names =</span> <span class="st">&quot;chm_pct_rank_det_{.col}&quot;</span></span>
<span id="cb249-54"><a href="chm-raster-resolution-testing.html#cb249-54" tabindex="-1"></a>    )</span>
<span id="cb249-55"><a href="chm-raster-resolution-testing.html#cb249-55" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb249-56"><a href="chm-raster-resolution-testing.html#cb249-56" tabindex="-1"></a>  <span class="co"># now get the max of these pct ranks by row</span></span>
<span id="cb249-57"><a href="chm-raster-resolution-testing.html#cb249-57" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rowwise</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb249-58"><a href="chm-raster-resolution-testing.html#cb249-58" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb249-59"><a href="chm-raster-resolution-testing.html#cb249-59" tabindex="-1"></a>    <span class="at">ovrall_pct_rank_quant_mean =</span> <span class="fu">mean</span>(</span>
<span id="cb249-60"><a href="chm-raster-resolution-testing.html#cb249-60" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">c_across</span>(</span>
<span id="cb249-61"><a href="chm-raster-resolution-testing.html#cb249-61" tabindex="-1"></a>        tidyselect<span class="sc">::</span><span class="fu">starts_with</span>(<span class="st">&quot;ovrall_pct_rank_quant_&quot;</span>)</span>
<span id="cb249-62"><a href="chm-raster-resolution-testing.html#cb249-62" tabindex="-1"></a>      )</span>
<span id="cb249-63"><a href="chm-raster-resolution-testing.html#cb249-63" tabindex="-1"></a>      , <span class="at">na.rm =</span> T</span>
<span id="cb249-64"><a href="chm-raster-resolution-testing.html#cb249-64" tabindex="-1"></a>    )</span>
<span id="cb249-65"><a href="chm-raster-resolution-testing.html#cb249-65" tabindex="-1"></a>    , <span class="at">ovrall_pct_rank_det_mean =</span> <span class="fu">mean</span>(</span>
<span id="cb249-66"><a href="chm-raster-resolution-testing.html#cb249-66" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">c_across</span>(</span>
<span id="cb249-67"><a href="chm-raster-resolution-testing.html#cb249-67" tabindex="-1"></a>        tidyselect<span class="sc">::</span><span class="fu">starts_with</span>(<span class="st">&quot;ovrall_pct_rank_det_&quot;</span>)</span>
<span id="cb249-68"><a href="chm-raster-resolution-testing.html#cb249-68" tabindex="-1"></a>      )</span>
<span id="cb249-69"><a href="chm-raster-resolution-testing.html#cb249-69" tabindex="-1"></a>      , <span class="at">na.rm =</span> T</span>
<span id="cb249-70"><a href="chm-raster-resolution-testing.html#cb249-70" tabindex="-1"></a>    )</span>
<span id="cb249-71"><a href="chm-raster-resolution-testing.html#cb249-71" tabindex="-1"></a>    , <span class="at">chm_pct_rank_quant_mean =</span> <span class="fu">mean</span>(</span>
<span id="cb249-72"><a href="chm-raster-resolution-testing.html#cb249-72" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">c_across</span>(</span>
<span id="cb249-73"><a href="chm-raster-resolution-testing.html#cb249-73" tabindex="-1"></a>        tidyselect<span class="sc">::</span><span class="fu">starts_with</span>(<span class="st">&quot;chm_pct_rank_quant_&quot;</span>)</span>
<span id="cb249-74"><a href="chm-raster-resolution-testing.html#cb249-74" tabindex="-1"></a>      )</span>
<span id="cb249-75"><a href="chm-raster-resolution-testing.html#cb249-75" tabindex="-1"></a>      , <span class="at">na.rm =</span> T</span>
<span id="cb249-76"><a href="chm-raster-resolution-testing.html#cb249-76" tabindex="-1"></a>    )</span>
<span id="cb249-77"><a href="chm-raster-resolution-testing.html#cb249-77" tabindex="-1"></a>    , <span class="at">chm_pct_rank_det_mean =</span> <span class="fu">mean</span>(</span>
<span id="cb249-78"><a href="chm-raster-resolution-testing.html#cb249-78" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">c_across</span>(</span>
<span id="cb249-79"><a href="chm-raster-resolution-testing.html#cb249-79" tabindex="-1"></a>        tidyselect<span class="sc">::</span><span class="fu">starts_with</span>(<span class="st">&quot;chm_pct_rank_det_&quot;</span>)</span>
<span id="cb249-80"><a href="chm-raster-resolution-testing.html#cb249-80" tabindex="-1"></a>      )</span>
<span id="cb249-81"><a href="chm-raster-resolution-testing.html#cb249-81" tabindex="-1"></a>      , <span class="at">na.rm =</span> T</span>
<span id="cb249-82"><a href="chm-raster-resolution-testing.html#cb249-82" tabindex="-1"></a>    )</span>
<span id="cb249-83"><a href="chm-raster-resolution-testing.html#cb249-83" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb249-84"><a href="chm-raster-resolution-testing.html#cb249-84" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb249-85"><a href="chm-raster-resolution-testing.html#cb249-85" tabindex="-1"></a>  <span class="co"># fill na values</span></span>
<span id="cb249-86"><a href="chm-raster-resolution-testing.html#cb249-86" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb249-87"><a href="chm-raster-resolution-testing.html#cb249-87" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">across</span>(</span>
<span id="cb249-88"><a href="chm-raster-resolution-testing.html#cb249-88" tabindex="-1"></a>      <span class="at">.cols =</span> <span class="fu">c</span>(ovrall_pct_rank_det_mean, ovrall_pct_rank_quant_mean, chm_pct_rank_det_mean, chm_pct_rank_quant_mean)</span>
<span id="cb249-89"><a href="chm-raster-resolution-testing.html#cb249-89" tabindex="-1"></a>      , <span class="at">.fn =</span> <span class="sc">~</span><span class="fu">ifelse</span>(<span class="fu">is.na</span>(.x),<span class="dv">0</span>,.x)</span>
<span id="cb249-90"><a href="chm-raster-resolution-testing.html#cb249-90" tabindex="-1"></a>    )</span>
<span id="cb249-91"><a href="chm-raster-resolution-testing.html#cb249-91" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb249-92"><a href="chm-raster-resolution-testing.html#cb249-92" tabindex="-1"></a>  <span class="co"># now make quadrant var</span></span>
<span id="cb249-93"><a href="chm-raster-resolution-testing.html#cb249-93" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb249-94"><a href="chm-raster-resolution-testing.html#cb249-94" tabindex="-1"></a>    <span class="co"># groupings for the quadrant plot</span></span>
<span id="cb249-95"><a href="chm-raster-resolution-testing.html#cb249-95" tabindex="-1"></a>    <span class="at">ovrall_accuracy_grp =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb249-96"><a href="chm-raster-resolution-testing.html#cb249-96" tabindex="-1"></a>        ovrall_pct_rank_det_mean<span class="sc">&gt;=</span><span class="fl">0.95</span> <span class="sc">&amp;</span> ovrall_pct_rank_quant_mean<span class="sc">&gt;=</span><span class="fl">0.95</span> <span class="sc">~</span> <span class="dv">1</span></span>
<span id="cb249-97"><a href="chm-raster-resolution-testing.html#cb249-97" tabindex="-1"></a>        , ovrall_pct_rank_det_mean<span class="sc">&gt;=</span><span class="fl">0.90</span> <span class="sc">&amp;</span> ovrall_pct_rank_quant_mean<span class="sc">&gt;=</span><span class="fl">0.90</span> <span class="sc">~</span> <span class="dv">2</span></span>
<span id="cb249-98"><a href="chm-raster-resolution-testing.html#cb249-98" tabindex="-1"></a>        , ovrall_pct_rank_det_mean<span class="sc">&gt;=</span><span class="fl">0.75</span> <span class="sc">&amp;</span> ovrall_pct_rank_quant_mean<span class="sc">&gt;=</span><span class="fl">0.75</span> <span class="sc">~</span> <span class="dv">3</span></span>
<span id="cb249-99"><a href="chm-raster-resolution-testing.html#cb249-99" tabindex="-1"></a>        , ovrall_pct_rank_det_mean<span class="sc">&gt;=</span><span class="fl">0.50</span> <span class="sc">&amp;</span> ovrall_pct_rank_quant_mean<span class="sc">&gt;=</span><span class="fl">0.50</span> <span class="sc">~</span> <span class="dv">4</span></span>
<span id="cb249-100"><a href="chm-raster-resolution-testing.html#cb249-100" tabindex="-1"></a>        , ovrall_pct_rank_det_mean<span class="sc">&gt;=</span><span class="fl">0.50</span> <span class="sc">&amp;</span> ovrall_pct_rank_quant_mean<span class="sc">&lt;</span><span class="fl">0.50</span> <span class="sc">~</span> <span class="dv">5</span></span>
<span id="cb249-101"><a href="chm-raster-resolution-testing.html#cb249-101" tabindex="-1"></a>        , ovrall_pct_rank_det_mean<span class="sc">&lt;</span><span class="fl">0.50</span> <span class="sc">&amp;</span> ovrall_pct_rank_quant_mean<span class="sc">&gt;=</span><span class="fl">0.50</span> <span class="sc">~</span> <span class="dv">6</span></span>
<span id="cb249-102"><a href="chm-raster-resolution-testing.html#cb249-102" tabindex="-1"></a>        , T <span class="sc">~</span> <span class="dv">7</span></span>
<span id="cb249-103"><a href="chm-raster-resolution-testing.html#cb249-103" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span> </span>
<span id="cb249-104"><a href="chm-raster-resolution-testing.html#cb249-104" tabindex="-1"></a>      <span class="fu">factor</span>(</span>
<span id="cb249-105"><a href="chm-raster-resolution-testing.html#cb249-105" tabindex="-1"></a>        <span class="at">ordered =</span> T</span>
<span id="cb249-106"><a href="chm-raster-resolution-testing.html#cb249-106" tabindex="-1"></a>        , <span class="at">levels =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">7</span></span>
<span id="cb249-107"><a href="chm-raster-resolution-testing.html#cb249-107" tabindex="-1"></a>        , <span class="at">labels =</span> <span class="fu">c</span>(</span>
<span id="cb249-108"><a href="chm-raster-resolution-testing.html#cb249-108" tabindex="-1"></a>          <span class="st">&quot;top 5% detection &amp; quantification&quot;</span> <span class="co"># ovrall_pct_rank_mean&gt;=0.95 &amp; ovrall_pct_rank_f_score&gt;=0.95 ~ 1</span></span>
<span id="cb249-109"><a href="chm-raster-resolution-testing.html#cb249-109" tabindex="-1"></a>          , <span class="st">&quot;top 10% detection &amp; quantification&quot;</span> <span class="co"># ovrall_pct_rank_mean&gt;=0.90 &amp; ovrall_pct_rank_f_score&gt;=0.90 ~ 2</span></span>
<span id="cb249-110"><a href="chm-raster-resolution-testing.html#cb249-110" tabindex="-1"></a>          , <span class="st">&quot;top 25% detection &amp; quantification&quot;</span> <span class="co"># ovrall_pct_rank_mean&gt;=0.75 &amp; ovrall_pct_rank_f_score&gt;=0.75 ~ 3</span></span>
<span id="cb249-111"><a href="chm-raster-resolution-testing.html#cb249-111" tabindex="-1"></a>          , <span class="st">&quot;top 50% detection &amp; quantification&quot;</span> <span class="co"># ovrall_pct_rank_mean&gt;=0.50 &amp; ovrall_pct_rank_f_score&gt;=0.50 ~ 4</span></span>
<span id="cb249-112"><a href="chm-raster-resolution-testing.html#cb249-112" tabindex="-1"></a>          , <span class="st">&quot;top 50% quantification&quot;</span> <span class="co"># ovrall_pct_rank_mean&gt;=0.50 &amp; ovrall_pct_rank_f_score&lt;0.50 ~ 5</span></span>
<span id="cb249-113"><a href="chm-raster-resolution-testing.html#cb249-113" tabindex="-1"></a>          , <span class="st">&quot;top 50% detection&quot;</span> <span class="co"># ovrall_pct_rank_mean&lt;0.50 &amp; ovrall_pct_rank_f_score&gt;=0.50 ~ 6</span></span>
<span id="cb249-114"><a href="chm-raster-resolution-testing.html#cb249-114" tabindex="-1"></a>          , <span class="st">&quot;bottom 50% detection &amp; quantification&quot;</span></span>
<span id="cb249-115"><a href="chm-raster-resolution-testing.html#cb249-115" tabindex="-1"></a>        )</span>
<span id="cb249-116"><a href="chm-raster-resolution-testing.html#cb249-116" tabindex="-1"></a>      )</span>
<span id="cb249-117"><a href="chm-raster-resolution-testing.html#cb249-117" tabindex="-1"></a>    , <span class="at">chm_accuracy_grp =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb249-118"><a href="chm-raster-resolution-testing.html#cb249-118" tabindex="-1"></a>        chm_pct_rank_det_mean<span class="sc">&gt;=</span><span class="fl">0.95</span> <span class="sc">&amp;</span> chm_pct_rank_quant_mean<span class="sc">&gt;=</span><span class="fl">0.95</span> <span class="sc">~</span> <span class="dv">1</span></span>
<span id="cb249-119"><a href="chm-raster-resolution-testing.html#cb249-119" tabindex="-1"></a>        , chm_pct_rank_det_mean<span class="sc">&gt;=</span><span class="fl">0.90</span> <span class="sc">&amp;</span> chm_pct_rank_quant_mean<span class="sc">&gt;=</span><span class="fl">0.90</span> <span class="sc">~</span> <span class="dv">2</span></span>
<span id="cb249-120"><a href="chm-raster-resolution-testing.html#cb249-120" tabindex="-1"></a>        , chm_pct_rank_det_mean<span class="sc">&gt;=</span><span class="fl">0.75</span> <span class="sc">&amp;</span> chm_pct_rank_quant_mean<span class="sc">&gt;=</span><span class="fl">0.75</span> <span class="sc">~</span> <span class="dv">3</span></span>
<span id="cb249-121"><a href="chm-raster-resolution-testing.html#cb249-121" tabindex="-1"></a>        , chm_pct_rank_det_mean<span class="sc">&gt;=</span><span class="fl">0.50</span> <span class="sc">&amp;</span> chm_pct_rank_quant_mean<span class="sc">&gt;=</span><span class="fl">0.50</span> <span class="sc">~</span> <span class="dv">4</span></span>
<span id="cb249-122"><a href="chm-raster-resolution-testing.html#cb249-122" tabindex="-1"></a>        , chm_pct_rank_det_mean<span class="sc">&gt;=</span><span class="fl">0.50</span> <span class="sc">&amp;</span> chm_pct_rank_quant_mean<span class="sc">&lt;</span><span class="fl">0.50</span> <span class="sc">~</span> <span class="dv">5</span></span>
<span id="cb249-123"><a href="chm-raster-resolution-testing.html#cb249-123" tabindex="-1"></a>        , chm_pct_rank_det_mean<span class="sc">&lt;</span><span class="fl">0.50</span> <span class="sc">&amp;</span> chm_pct_rank_quant_mean<span class="sc">&gt;=</span><span class="fl">0.50</span> <span class="sc">~</span> <span class="dv">6</span></span>
<span id="cb249-124"><a href="chm-raster-resolution-testing.html#cb249-124" tabindex="-1"></a>        , T <span class="sc">~</span> <span class="dv">7</span></span>
<span id="cb249-125"><a href="chm-raster-resolution-testing.html#cb249-125" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span> </span>
<span id="cb249-126"><a href="chm-raster-resolution-testing.html#cb249-126" tabindex="-1"></a>      <span class="fu">factor</span>(</span>
<span id="cb249-127"><a href="chm-raster-resolution-testing.html#cb249-127" tabindex="-1"></a>        <span class="at">ordered =</span> T</span>
<span id="cb249-128"><a href="chm-raster-resolution-testing.html#cb249-128" tabindex="-1"></a>        , <span class="at">levels =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">7</span></span>
<span id="cb249-129"><a href="chm-raster-resolution-testing.html#cb249-129" tabindex="-1"></a>        , <span class="at">labels =</span> <span class="fu">c</span>(</span>
<span id="cb249-130"><a href="chm-raster-resolution-testing.html#cb249-130" tabindex="-1"></a>          <span class="st">&quot;top 5% detection &amp; quantification&quot;</span> <span class="co"># chm_pct_rank_mean&gt;=0.95 &amp; chm_pct_rank_f_score&gt;=0.95 ~ 1</span></span>
<span id="cb249-131"><a href="chm-raster-resolution-testing.html#cb249-131" tabindex="-1"></a>          , <span class="st">&quot;top 10% detection &amp; quantification&quot;</span> <span class="co"># chm_pct_rank_mean&gt;=0.90 &amp; chm_pct_rank_f_score&gt;=0.90 ~ 2</span></span>
<span id="cb249-132"><a href="chm-raster-resolution-testing.html#cb249-132" tabindex="-1"></a>          , <span class="st">&quot;top 25% detection &amp; quantification&quot;</span> <span class="co"># chm_pct_rank_mean&gt;=0.75 &amp; chm_pct_rank_f_score&gt;=0.75 ~ 3</span></span>
<span id="cb249-133"><a href="chm-raster-resolution-testing.html#cb249-133" tabindex="-1"></a>          , <span class="st">&quot;top 50% detection &amp; quantification&quot;</span> <span class="co"># chm_pct_rank_mean&gt;=0.50 &amp; chm_pct_rank_f_score&gt;=0.50 ~ 4</span></span>
<span id="cb249-134"><a href="chm-raster-resolution-testing.html#cb249-134" tabindex="-1"></a>          , <span class="st">&quot;top 50% quantification&quot;</span> <span class="co"># chm_pct_rank_mean&gt;=0.50 &amp; chm_pct_rank_f_score&lt;0.50 ~ 5</span></span>
<span id="cb249-135"><a href="chm-raster-resolution-testing.html#cb249-135" tabindex="-1"></a>          , <span class="st">&quot;top 50% detection&quot;</span> <span class="co"># chm_pct_rank_mean&lt;0.50 &amp; chm_pct_rank_f_score&gt;=0.50 ~ 6</span></span>
<span id="cb249-136"><a href="chm-raster-resolution-testing.html#cb249-136" tabindex="-1"></a>          , <span class="st">&quot;bottom 50% detection &amp; quantification&quot;</span></span>
<span id="cb249-137"><a href="chm-raster-resolution-testing.html#cb249-137" tabindex="-1"></a>        )</span>
<span id="cb249-138"><a href="chm-raster-resolution-testing.html#cb249-138" tabindex="-1"></a>      )</span>
<span id="cb249-139"><a href="chm-raster-resolution-testing.html#cb249-139" tabindex="-1"></a>    , </span>
<span id="cb249-140"><a href="chm-raster-resolution-testing.html#cb249-140" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb249-141"><a href="chm-raster-resolution-testing.html#cb249-141" tabindex="-1"></a>  <span class="do">##########</span></span>
<span id="cb249-142"><a href="chm-raster-resolution-testing.html#cb249-142" tabindex="-1"></a>  <span class="co"># first. find overall top combinations irrespective of CHM res</span></span>
<span id="cb249-143"><a href="chm-raster-resolution-testing.html#cb249-143" tabindex="-1"></a>  <span class="do">##########</span></span>
<span id="cb249-144"><a href="chm-raster-resolution-testing.html#cb249-144" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb249-145"><a href="chm-raster-resolution-testing.html#cb249-145" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb249-146"><a href="chm-raster-resolution-testing.html#cb249-146" tabindex="-1"></a>    <span class="at">ovrall_balanced_pct_rank =</span> dplyr<span class="sc">::</span><span class="fu">percent_rank</span>( (ovrall_pct_rank_det_mean<span class="sc">+</span>ovrall_pct_rank_quant_mean)<span class="sc">/</span><span class="dv">2</span> ) <span class="co"># equally weight quant and detection</span></span>
<span id="cb249-147"><a href="chm-raster-resolution-testing.html#cb249-147" tabindex="-1"></a>    , <span class="at">ovrall_lab =</span> forcats<span class="sc">::</span><span class="fu">fct_reorder</span>(lab, ovrall_balanced_pct_rank)</span>
<span id="cb249-148"><a href="chm-raster-resolution-testing.html#cb249-148" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb249-149"><a href="chm-raster-resolution-testing.html#cb249-149" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(<span class="fu">desc</span>(ovrall_balanced_pct_rank),<span class="fu">desc</span>(ovrall_pct_rank_det_mean),<span class="fu">desc</span>(ovrall_pct_rank_quant_mean)) <span class="sc">%&gt;%</span> </span>
<span id="cb249-150"><a href="chm-raster-resolution-testing.html#cb249-150" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb249-151"><a href="chm-raster-resolution-testing.html#cb249-151" tabindex="-1"></a>    <span class="at">ovrall_balanced_rank =</span> dplyr<span class="sc">::</span><span class="fu">row_number</span>()</span>
<span id="cb249-152"><a href="chm-raster-resolution-testing.html#cb249-152" tabindex="-1"></a>    <span class="co"># is_top_overall = using rows in case not all combos resulted in piles and/or </span></span>
<span id="cb249-153"><a href="chm-raster-resolution-testing.html#cb249-153" tabindex="-1"></a>      <span class="co"># there are many ties in the data leading to no records with a percent rank &lt;= pct_th_top (e.g. many tied at 98%)</span></span>
<span id="cb249-154"><a href="chm-raster-resolution-testing.html#cb249-154" tabindex="-1"></a>    , <span class="at">is_top_overall =</span> dplyr<span class="sc">::</span><span class="fu">row_number</span>()<span class="sc">&lt;=</span>(n_combos_top_overall)</span>
<span id="cb249-155"><a href="chm-raster-resolution-testing.html#cb249-155" tabindex="-1"></a>      <span class="co"># ovrall_balanced_pct_rank&gt;=(1-pct_th_top)</span></span>
<span id="cb249-156"><a href="chm-raster-resolution-testing.html#cb249-156" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb249-157"><a href="chm-raster-resolution-testing.html#cb249-157" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(<span class="fu">desc</span>(is_top_overall),<span class="fu">desc</span>(recall),<span class="fu">desc</span>(ovrall_pct_rank_det_mean),<span class="fu">desc</span>(ovrall_pct_rank_quant_mean),ovrall_balanced_rank) <span class="sc">%&gt;%</span> </span>
<span id="cb249-158"><a href="chm-raster-resolution-testing.html#cb249-158" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">is_final_selection =</span> is_top_overall <span class="sc">&amp;</span> dplyr<span class="sc">::</span><span class="fu">row_number</span>()<span class="sc">&lt;=</span>n_th_top) <span class="sc">%&gt;%</span> </span>
<span id="cb249-159"><a href="chm-raster-resolution-testing.html#cb249-159" tabindex="-1"></a>  <span class="do">##########</span></span>
<span id="cb249-160"><a href="chm-raster-resolution-testing.html#cb249-160" tabindex="-1"></a>  <span class="co"># second. find top combinations by CHM res</span></span>
<span id="cb249-161"><a href="chm-raster-resolution-testing.html#cb249-161" tabindex="-1"></a>  <span class="do">##########</span></span>
<span id="cb249-162"><a href="chm-raster-resolution-testing.html#cb249-162" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(chm_res_m) <span class="sc">%&gt;%</span> </span>
<span id="cb249-163"><a href="chm-raster-resolution-testing.html#cb249-163" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb249-164"><a href="chm-raster-resolution-testing.html#cb249-164" tabindex="-1"></a>    <span class="at">chm_balanced_pct_rank =</span> dplyr<span class="sc">::</span><span class="fu">percent_rank</span>( (chm_pct_rank_det_mean<span class="sc">+</span>chm_pct_rank_quant_mean)<span class="sc">/</span><span class="dv">2</span> ) <span class="co"># equally weight quant and detection</span></span>
<span id="cb249-165"><a href="chm-raster-resolution-testing.html#cb249-165" tabindex="-1"></a>    , <span class="at">chm_lab =</span> forcats<span class="sc">::</span><span class="fu">fct_reorder</span>(lab, chm_balanced_pct_rank)</span>
<span id="cb249-166"><a href="chm-raster-resolution-testing.html#cb249-166" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb249-167"><a href="chm-raster-resolution-testing.html#cb249-167" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(chm_res_m,<span class="fu">desc</span>(chm_balanced_pct_rank),<span class="fu">desc</span>(chm_pct_rank_det_mean),<span class="fu">desc</span>(chm_pct_rank_quant_mean),ovrall_balanced_rank) <span class="sc">%&gt;%</span> </span>
<span id="cb249-168"><a href="chm-raster-resolution-testing.html#cb249-168" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb249-169"><a href="chm-raster-resolution-testing.html#cb249-169" tabindex="-1"></a>    <span class="at">chm_balanced_rank =</span> dplyr<span class="sc">::</span><span class="fu">row_number</span>()</span>
<span id="cb249-170"><a href="chm-raster-resolution-testing.html#cb249-170" tabindex="-1"></a>    <span class="co"># is_top_chm = using rows in case not all combos resulted in piles and/or </span></span>
<span id="cb249-171"><a href="chm-raster-resolution-testing.html#cb249-171" tabindex="-1"></a>      <span class="co"># there are many ties in the data leading to no records with a percent rank &lt;= pct_th_top (e.g. many tied at 98%)</span></span>
<span id="cb249-172"><a href="chm-raster-resolution-testing.html#cb249-172" tabindex="-1"></a>    , <span class="at">is_top_chm =</span> dplyr<span class="sc">::</span><span class="fu">row_number</span>()<span class="sc">&lt;=</span>n_combos_top_chm <span class="co"># double it so we look at more than 14??</span></span>
<span id="cb249-173"><a href="chm-raster-resolution-testing.html#cb249-173" tabindex="-1"></a>      <span class="co"># chm_balanced_pct_rank&gt;=(1-pct_th_top)</span></span>
<span id="cb249-174"><a href="chm-raster-resolution-testing.html#cb249-174" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb249-175"><a href="chm-raster-resolution-testing.html#cb249-175" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(chm_res_m,<span class="fu">desc</span>(is_top_chm),<span class="fu">desc</span>(recall),<span class="fu">desc</span>(chm_pct_rank_det_mean),<span class="fu">desc</span>(chm_pct_rank_quant_mean),ovrall_balanced_rank) <span class="sc">%&gt;%</span> </span>
<span id="cb249-176"><a href="chm-raster-resolution-testing.html#cb249-176" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">is_final_selection_chm =</span> is_top_chm <span class="sc">&amp;</span> dplyr<span class="sc">::</span><span class="fu">row_number</span>()<span class="sc">&lt;=</span>n_th_top_chm) <span class="sc">%&gt;%</span> <span class="co"># half it because it&#39;s going to be a lot to show in our facet ggplot</span></span>
<span id="cb249-177"><a href="chm-raster-resolution-testing.html#cb249-177" tabindex="-1"></a>  <span class="do">##### clean up</span></span>
<span id="cb249-178"><a href="chm-raster-resolution-testing.html#cb249-178" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb249-179"><a href="chm-raster-resolution-testing.html#cb249-179" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(</span>
<span id="cb249-180"><a href="chm-raster-resolution-testing.html#cb249-180" tabindex="-1"></a>    <span class="fu">c</span>(tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_mape&quot;</span>) <span class="sc">&amp;</span> tidyselect<span class="sc">::</span><span class="fu">starts_with</span>(<span class="st">&quot;ovrall_pct_rank_&quot;</span>))</span>
<span id="cb249-181"><a href="chm-raster-resolution-testing.html#cb249-181" tabindex="-1"></a>    , <span class="fu">c</span>(tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_mape&quot;</span>) <span class="sc">&amp;</span> tidyselect<span class="sc">::</span><span class="fu">starts_with</span>(<span class="st">&quot;chm_pct_rank_&quot;</span>))</span>
<span id="cb249-182"><a href="chm-raster-resolution-testing.html#cb249-182" tabindex="-1"></a>    , <span class="fu">c</span>(tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_f_score&quot;</span>) <span class="sc">&amp;</span> tidyselect<span class="sc">::</span><span class="fu">starts_with</span>(<span class="st">&quot;ovrall_pct_rank_&quot;</span>))</span>
<span id="cb249-183"><a href="chm-raster-resolution-testing.html#cb249-183" tabindex="-1"></a>    , <span class="fu">c</span>(tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_f_score&quot;</span>) <span class="sc">&amp;</span> tidyselect<span class="sc">::</span><span class="fu">starts_with</span>(<span class="st">&quot;chm_pct_rank_&quot;</span>))</span>
<span id="cb249-184"><a href="chm-raster-resolution-testing.html#cb249-184" tabindex="-1"></a>  ))</span>
<span id="cb249-185"><a href="chm-raster-resolution-testing.html#cb249-185" tabindex="-1"></a><span class="co"># huh?</span></span>
<span id="cb249-186"><a href="chm-raster-resolution-testing.html#cb249-186" tabindex="-1"></a><span class="co"># param_combos_ranked %&gt;% dplyr::glimpse()</span></span>
<span id="cb249-187"><a href="chm-raster-resolution-testing.html#cb249-187" tabindex="-1"></a><span class="co"># param_combos_ranked %&gt;% dplyr::count(is_final_selection)</span></span></code></pre></div>
<p>to determine the combinations that achieved the best balance between both detection and quantification accuracy, we’re selecting the parameter combinations that are in the upper-right of the quadrant plot. That is, the parameter combinations that performed best at both pile detection accuracy and pile form quantification accuracy</p>
<div class="sourceCode" id="cb250"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb250-1"><a href="chm-raster-resolution-testing.html#cb250-1" tabindex="-1"></a><span class="co"># plot</span></span>
<span id="cb250-2"><a href="chm-raster-resolution-testing.html#cb250-2" tabindex="-1"></a>param_combos_ranked <span class="sc">%&gt;%</span>   </span>
<span id="cb250-3"><a href="chm-raster-resolution-testing.html#cb250-3" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(</span>
<span id="cb250-4"><a href="chm-raster-resolution-testing.html#cb250-4" tabindex="-1"></a>    <span class="at">mapping=</span>ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> ovrall_pct_rank_det_mean, <span class="at">y =</span> ovrall_pct_rank_quant_mean, <span class="at">color =</span> ovrall_accuracy_grp)</span>
<span id="cb250-5"><a href="chm-raster-resolution-testing.html#cb250-5" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb250-6"><a href="chm-raster-resolution-testing.html#cb250-6" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fl">0.5</span>, <span class="at">color =</span> <span class="st">&quot;gray22&quot;</span>) <span class="sc">+</span></span>
<span id="cb250-7"><a href="chm-raster-resolution-testing.html#cb250-7" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fl">0.5</span>, <span class="at">color =</span> <span class="st">&quot;gray22&quot;</span>) <span class="sc">+</span></span>
<span id="cb250-8"><a href="chm-raster-resolution-testing.html#cb250-8" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fl">0.75</span>, <span class="at">color =</span> <span class="st">&quot;gray44&quot;</span>) <span class="sc">+</span></span>
<span id="cb250-9"><a href="chm-raster-resolution-testing.html#cb250-9" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fl">0.75</span>, <span class="at">color =</span> <span class="st">&quot;gray44&quot;</span>) <span class="sc">+</span></span>
<span id="cb250-10"><a href="chm-raster-resolution-testing.html#cb250-10" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fl">0.9</span>, <span class="at">color =</span> <span class="st">&quot;gray66&quot;</span>) <span class="sc">+</span></span>
<span id="cb250-11"><a href="chm-raster-resolution-testing.html#cb250-11" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fl">0.9</span>, <span class="at">color =</span> <span class="st">&quot;gray66&quot;</span>) <span class="sc">+</span></span>
<span id="cb250-12"><a href="chm-raster-resolution-testing.html#cb250-12" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb250-13"><a href="chm-raster-resolution-testing.html#cb250-13" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_colour_viridis_d</span>(<span class="at">direction =</span> <span class="sc">-</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb250-14"><a href="chm-raster-resolution-testing.html#cb250-14" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_x_continuous</span>(</span>
<span id="cb250-15"><a href="chm-raster-resolution-testing.html#cb250-15" tabindex="-1"></a>    <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">percent_format</span>(<span class="at">accuracy =</span> <span class="dv">1</span>)</span>
<span id="cb250-16"><a href="chm-raster-resolution-testing.html#cb250-16" tabindex="-1"></a>    , <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)</span>
<span id="cb250-17"><a href="chm-raster-resolution-testing.html#cb250-17" tabindex="-1"></a>  ) <span class="sc">+</span>  </span>
<span id="cb250-18"><a href="chm-raster-resolution-testing.html#cb250-18" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_y_continuous</span>(</span>
<span id="cb250-19"><a href="chm-raster-resolution-testing.html#cb250-19" tabindex="-1"></a>    <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">percent_format</span>(<span class="at">accuracy =</span> <span class="dv">1</span>)</span>
<span id="cb250-20"><a href="chm-raster-resolution-testing.html#cb250-20" tabindex="-1"></a>    , <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)</span>
<span id="cb250-21"><a href="chm-raster-resolution-testing.html#cb250-21" tabindex="-1"></a>  ) <span class="sc">+</span>  </span>
<span id="cb250-22"><a href="chm-raster-resolution-testing.html#cb250-22" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb250-23"><a href="chm-raster-resolution-testing.html#cb250-23" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;Percentile F-Score&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Percentile MAPE (mean)&quot;</span></span>
<span id="cb250-24"><a href="chm-raster-resolution-testing.html#cb250-24" tabindex="-1"></a>    , <span class="at">color =</span> <span class="st">&quot;&quot;</span></span>
<span id="cb250-25"><a href="chm-raster-resolution-testing.html#cb250-25" tabindex="-1"></a>    , <span class="at">subtitle =</span> <span class="st">&quot;Structural Data Only&quot;</span></span>
<span id="cb250-26"><a href="chm-raster-resolution-testing.html#cb250-26" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb250-27"><a href="chm-raster-resolution-testing.html#cb250-27" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb250-28"><a href="chm-raster-resolution-testing.html#cb250-28" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb250-29"><a href="chm-raster-resolution-testing.html#cb250-29" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span></span>
<span id="cb250-30"><a href="chm-raster-resolution-testing.html#cb250-30" tabindex="-1"></a>    , <span class="at">legend.text =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>)</span>
<span id="cb250-31"><a href="chm-raster-resolution-testing.html#cb250-31" tabindex="-1"></a>    , <span class="at">strip.text =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb250-32"><a href="chm-raster-resolution-testing.html#cb250-32" tabindex="-1"></a>    , <span class="at">axis.text =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">7</span>)</span>
<span id="cb250-33"><a href="chm-raster-resolution-testing.html#cb250-33" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb250-34"><a href="chm-raster-resolution-testing.html#cb250-34" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">guides</span>(</span>
<span id="cb250-35"><a href="chm-raster-resolution-testing.html#cb250-35" tabindex="-1"></a>    <span class="at">color =</span> ggplot2<span class="sc">::</span><span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">shape =</span> <span class="dv">15</span>, <span class="at">linetype =</span> <span class="dv">0</span>, <span class="at">size =</span> <span class="dv">5</span>, <span class="at">alpha =</span> <span class="dv">1</span>))</span>
<span id="cb250-36"><a href="chm-raster-resolution-testing.html#cb250-36" tabindex="-1"></a>    , <span class="at">shape =</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb250-37"><a href="chm-raster-resolution-testing.html#cb250-37" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-216-1.png" width="1008" /></p>
<div id="top-1.0" class="section level5 hasAnchor" number="8.5.3.1.1">
<h5><span class="header-section-number">8.5.3.1.1</span> Top 1.0%<a href="chm-raster-resolution-testing.html#top-1.0" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>let’s check out the parameter settings of the top 1.0% (n=59) from all 5,880 combinations tested. these are “votes” for the parameter setting based on the combinations that achieved the best balance between both detection and quantification accuracy.</p>
<div class="sourceCode" id="cb251"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb251-1"><a href="chm-raster-resolution-testing.html#cb251-1" tabindex="-1"></a>pal_param <span class="ot">&lt;-</span> viridis<span class="sc">::</span><span class="fu">cividis</span>(<span class="at">n=</span><span class="dv">6</span>, <span class="at">alpha =</span> <span class="fl">0.9</span>)</span>
<span id="cb251-2"><a href="chm-raster-resolution-testing.html#cb251-2" tabindex="-1"></a>param_combos_ranked <span class="sc">%&gt;%</span></span>
<span id="cb251-3"><a href="chm-raster-resolution-testing.html#cb251-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(is_top_overall) <span class="sc">%&gt;%</span> </span>
<span id="cb251-4"><a href="chm-raster-resolution-testing.html#cb251-4" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;f_score&quot;</span>), max_ht_m,max_area_m2,convexity_pct,circle_fit_iou_pct,chm_res_m) <span class="sc">%&gt;%</span> </span>
<span id="cb251-5"><a href="chm-raster-resolution-testing.html#cb251-5" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(</span>
<span id="cb251-6"><a href="chm-raster-resolution-testing.html#cb251-6" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">c</span>(max_ht_m,max_area_m2,convexity_pct,circle_fit_iou_pct,chm_res_m)</span>
<span id="cb251-7"><a href="chm-raster-resolution-testing.html#cb251-7" tabindex="-1"></a>    , <span class="at">names_to =</span> <span class="st">&quot;metric&quot;</span></span>
<span id="cb251-8"><a href="chm-raster-resolution-testing.html#cb251-8" tabindex="-1"></a>    , <span class="at">values_to =</span> <span class="st">&quot;value&quot;</span></span>
<span id="cb251-9"><a href="chm-raster-resolution-testing.html#cb251-9" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb251-10"><a href="chm-raster-resolution-testing.html#cb251-10" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">count</span>(metric, value) <span class="sc">%&gt;%</span> </span>
<span id="cb251-11"><a href="chm-raster-resolution-testing.html#cb251-11" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(metric) <span class="sc">%&gt;%</span> </span>
<span id="cb251-12"><a href="chm-raster-resolution-testing.html#cb251-12" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb251-13"><a href="chm-raster-resolution-testing.html#cb251-13" tabindex="-1"></a>    <span class="at">pct=</span>n<span class="sc">/</span><span class="fu">sum</span>(n)</span>
<span id="cb251-14"><a href="chm-raster-resolution-testing.html#cb251-14" tabindex="-1"></a>    , <span class="at">lab =</span> <span class="fu">paste0</span>(scales<span class="sc">::</span><span class="fu">percent</span>(pct,<span class="at">accuracy=</span><span class="fl">0.1</span>), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">n=&quot;</span>, scales<span class="sc">::</span><span class="fu">comma</span>(n,<span class="at">accuracy=</span><span class="dv">1</span>))</span>
<span id="cb251-15"><a href="chm-raster-resolution-testing.html#cb251-15" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb251-16"><a href="chm-raster-resolution-testing.html#cb251-16" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(</span>
<span id="cb251-17"><a href="chm-raster-resolution-testing.html#cb251-17" tabindex="-1"></a>    <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">factor</span>(value), <span class="at">y=</span>pct, <span class="at">label=</span>lab, <span class="at">fill =</span> metric)</span>
<span id="cb251-18"><a href="chm-raster-resolution-testing.html#cb251-18" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb251-19"><a href="chm-raster-resolution-testing.html#cb251-19" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_col</span>(<span class="at">width =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb251-20"><a href="chm-raster-resolution-testing.html#cb251-20" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_text</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">size =</span> <span class="fl">2.5</span>, <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb251-21"><a href="chm-raster-resolution-testing.html#cb251-21" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">facet_wrap</span>(<span class="at">facets =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(metric), <span class="at">ncol=</span><span class="dv">2</span>, <span class="at">scales =</span> <span class="st">&quot;free_x&quot;</span>) <span class="sc">+</span></span>
<span id="cb251-22"><a href="chm-raster-resolution-testing.html#cb251-22" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_y_continuous</span>(</span>
<span id="cb251-23"><a href="chm-raster-resolution-testing.html#cb251-23" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="at">by=</span><span class="fl">0.2</span>)</span>
<span id="cb251-24"><a href="chm-raster-resolution-testing.html#cb251-24" tabindex="-1"></a>    , <span class="at">labels =</span> scales<span class="sc">::</span>percent</span>
<span id="cb251-25"><a href="chm-raster-resolution-testing.html#cb251-25" tabindex="-1"></a>    , <span class="at">expand =</span> ggplot2<span class="sc">::</span><span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">0.2</span>))</span>
<span id="cb251-26"><a href="chm-raster-resolution-testing.html#cb251-26" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb251-27"><a href="chm-raster-resolution-testing.html#cb251-27" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_fill_manual</span>(<span class="at">values =</span> pal_param[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>]) <span class="sc">+</span></span>
<span id="cb251-28"><a href="chm-raster-resolution-testing.html#cb251-28" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb251-29"><a href="chm-raster-resolution-testing.html#cb251-29" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;parameter setting&quot;</span>, <span class="at">y =</span> <span class="st">&quot;&quot;</span></span>
<span id="cb251-30"><a href="chm-raster-resolution-testing.html#cb251-30" tabindex="-1"></a>    , <span class="at">fill =</span> <span class="st">&quot;&quot;</span></span>
<span id="cb251-31"><a href="chm-raster-resolution-testing.html#cb251-31" tabindex="-1"></a>    , <span class="at">subtitle =</span> <span class="fu">paste0</span>(</span>
<span id="cb251-32"><a href="chm-raster-resolution-testing.html#cb251-32" tabindex="-1"></a>      <span class="st">&quot;Structural Data Only&quot;</span></span>
<span id="cb251-33"><a href="chm-raster-resolution-testing.html#cb251-33" tabindex="-1"></a>       , <span class="st">&quot;</span><span class="sc">\n</span><span class="st">parameter settings of top &quot;</span></span>
<span id="cb251-34"><a href="chm-raster-resolution-testing.html#cb251-34" tabindex="-1"></a>       , scales<span class="sc">::</span><span class="fu">percent</span>(pct_th_top,<span class="at">accuracy=</span><span class="fl">0.1</span>)</span>
<span id="cb251-35"><a href="chm-raster-resolution-testing.html#cb251-35" tabindex="-1"></a>       , <span class="st">&quot; (n=&quot;</span></span>
<span id="cb251-36"><a href="chm-raster-resolution-testing.html#cb251-36" tabindex="-1"></a>       , scales<span class="sc">::</span><span class="fu">comma</span>(n_combos_top_overall, <span class="at">accuracy =</span> <span class="dv">1</span>)</span>
<span id="cb251-37"><a href="chm-raster-resolution-testing.html#cb251-37" tabindex="-1"></a>       , <span class="st">&quot;) &quot;</span></span>
<span id="cb251-38"><a href="chm-raster-resolution-testing.html#cb251-38" tabindex="-1"></a>       , <span class="st">&quot;overall parameter combinations</span><span class="sc">\n</span><span class="st">based on both detection and quantification accuracy&quot;</span></span>
<span id="cb251-39"><a href="chm-raster-resolution-testing.html#cb251-39" tabindex="-1"></a>    )</span>
<span id="cb251-40"><a href="chm-raster-resolution-testing.html#cb251-40" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb251-41"><a href="chm-raster-resolution-testing.html#cb251-41" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb251-42"><a href="chm-raster-resolution-testing.html#cb251-42" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb251-43"><a href="chm-raster-resolution-testing.html#cb251-43" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb251-44"><a href="chm-raster-resolution-testing.html#cb251-44" tabindex="-1"></a>    , <span class="at">strip.text =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb251-45"><a href="chm-raster-resolution-testing.html#cb251-45" tabindex="-1"></a>    , <span class="at">axis.text.y =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">6</span>)</span>
<span id="cb251-46"><a href="chm-raster-resolution-testing.html#cb251-46" tabindex="-1"></a>    , <span class="at">axis.text.x =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>)</span>
<span id="cb251-47"><a href="chm-raster-resolution-testing.html#cb251-47" tabindex="-1"></a>    , <span class="at">plot.subtitle =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>)</span>
<span id="cb251-48"><a href="chm-raster-resolution-testing.html#cb251-48" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-217-1.png" width="1008" /></p>
<p>what is the expected <em>detection</em> accuracy of the top 1.0% (n=59) combinations tested?</p>
<div class="sourceCode" id="cb252"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb252-1"><a href="chm-raster-resolution-testing.html#cb252-1" tabindex="-1"></a><span class="fu">plt_detection_dist</span>(</span>
<span id="cb252-2"><a href="chm-raster-resolution-testing.html#cb252-2" tabindex="-1"></a>  <span class="at">df =</span> param_combos_ranked <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(is_top_overall) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">!</span>tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;_pct_rank_&quot;</span>))</span>
<span id="cb252-3"><a href="chm-raster-resolution-testing.html#cb252-3" tabindex="-1"></a>  , <span class="fu">paste0</span>(</span>
<span id="cb252-4"><a href="chm-raster-resolution-testing.html#cb252-4" tabindex="-1"></a>    <span class="st">&quot;Structural Data Only&quot;</span></span>
<span id="cb252-5"><a href="chm-raster-resolution-testing.html#cb252-5" tabindex="-1"></a>    , <span class="st">&quot;</span><span class="sc">\n</span><span class="st">distribution of evaluation metrics for top &quot;</span></span>
<span id="cb252-6"><a href="chm-raster-resolution-testing.html#cb252-6" tabindex="-1"></a>    , scales<span class="sc">::</span><span class="fu">percent</span>(pct_th_top,<span class="at">accuracy=</span><span class="fl">0.1</span>)</span>
<span id="cb252-7"><a href="chm-raster-resolution-testing.html#cb252-7" tabindex="-1"></a>    , <span class="st">&quot; (n=&quot;</span></span>
<span id="cb252-8"><a href="chm-raster-resolution-testing.html#cb252-8" tabindex="-1"></a>    , scales<span class="sc">::</span><span class="fu">comma</span>(n_combos_top_overall, <span class="at">accuracy =</span> <span class="dv">1</span>)</span>
<span id="cb252-9"><a href="chm-raster-resolution-testing.html#cb252-9" tabindex="-1"></a>    , <span class="st">&quot;) &quot;</span></span>
<span id="cb252-10"><a href="chm-raster-resolution-testing.html#cb252-10" tabindex="-1"></a>    , <span class="st">&quot;overall parameter combinations</span><span class="sc">\n</span><span class="st">based on both detection and quantification accuracy&quot;</span></span>
<span id="cb252-11"><a href="chm-raster-resolution-testing.html#cb252-11" tabindex="-1"></a>  )</span>
<span id="cb252-12"><a href="chm-raster-resolution-testing.html#cb252-12" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-218-1.png" width="1008" /></p>
<p><em>WHAT DID WE LEARN FROM THIS</em></p>
<p>what is the expected <em>quantification</em> accuracy of the top 1.0% (n=59) combinations tested?</p>
<div class="sourceCode" id="cb253"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb253-1"><a href="chm-raster-resolution-testing.html#cb253-1" tabindex="-1"></a><span class="co"># plot it</span></span>
<span id="cb253-2"><a href="chm-raster-resolution-testing.html#cb253-2" tabindex="-1"></a><span class="fu">plt_form_quantification_dist</span>(</span>
<span id="cb253-3"><a href="chm-raster-resolution-testing.html#cb253-3" tabindex="-1"></a>  <span class="at">df =</span> param_combos_ranked <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(is_top_overall) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">!</span>tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;_pct_rank_&quot;</span>))</span>
<span id="cb253-4"><a href="chm-raster-resolution-testing.html#cb253-4" tabindex="-1"></a>  , <span class="fu">paste0</span>(</span>
<span id="cb253-5"><a href="chm-raster-resolution-testing.html#cb253-5" tabindex="-1"></a>    <span class="st">&quot;Structural Data Only&quot;</span></span>
<span id="cb253-6"><a href="chm-raster-resolution-testing.html#cb253-6" tabindex="-1"></a>    , <span class="st">&quot;</span><span class="sc">\n</span><span class="st">distribution of pile form quantification metrics for the top &quot;</span></span>
<span id="cb253-7"><a href="chm-raster-resolution-testing.html#cb253-7" tabindex="-1"></a>    , scales<span class="sc">::</span><span class="fu">percent</span>(pct_th_top,<span class="at">accuracy=</span><span class="fl">0.1</span>)</span>
<span id="cb253-8"><a href="chm-raster-resolution-testing.html#cb253-8" tabindex="-1"></a>    , <span class="st">&quot; (n=&quot;</span></span>
<span id="cb253-9"><a href="chm-raster-resolution-testing.html#cb253-9" tabindex="-1"></a>    , scales<span class="sc">::</span><span class="fu">comma</span>(n_combos_top_overall, <span class="at">accuracy =</span> <span class="dv">1</span>)</span>
<span id="cb253-10"><a href="chm-raster-resolution-testing.html#cb253-10" tabindex="-1"></a>    , <span class="st">&quot;) &quot;</span></span>
<span id="cb253-11"><a href="chm-raster-resolution-testing.html#cb253-11" tabindex="-1"></a>    , <span class="st">&quot;overall parameter combinations</span><span class="sc">\n</span><span class="st">based on both detection and quantification accuracy&quot;</span></span>
<span id="cb253-12"><a href="chm-raster-resolution-testing.html#cb253-12" tabindex="-1"></a>  )</span>
<span id="cb253-13"><a href="chm-raster-resolution-testing.html#cb253-13" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-219-1.png" width="1008" /></p>
<p><em>WHAT DID WE LEARN FROM THIS</em></p>
</div>
<div id="final-12-recommended-settings" class="section level5 hasAnchor" number="8.5.3.1.2">
<h5><span class="header-section-number">8.5.3.1.2</span> Final 12 recommended settings<a href="chm-raster-resolution-testing.html#final-12-recommended-settings" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<div class="sourceCode" id="cb254"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb254-1"><a href="chm-raster-resolution-testing.html#cb254-1" tabindex="-1"></a><span class="co"># pal_temp %&gt;% scales::show_col()</span></span>
<span id="cb254-2"><a href="chm-raster-resolution-testing.html#cb254-2" tabindex="-1"></a><span class="co"># filter and reshape</span></span>
<span id="cb254-3"><a href="chm-raster-resolution-testing.html#cb254-3" tabindex="-1"></a>param_combos_ranked <span class="sc">%&gt;%</span> </span>
<span id="cb254-4"><a href="chm-raster-resolution-testing.html#cb254-4" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(is_final_selection) <span class="sc">%&gt;%</span> </span>
<span id="cb254-5"><a href="chm-raster-resolution-testing.html#cb254-5" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">!</span>tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;_pct_rank_&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb254-6"><a href="chm-raster-resolution-testing.html#cb254-6" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb254-7"><a href="chm-raster-resolution-testing.html#cb254-7" tabindex="-1"></a>    max_ht_m,max_area_m2,convexity_pct,circle_fit_iou_pct,chm_res_m</span>
<span id="cb254-8"><a href="chm-raster-resolution-testing.html#cb254-8" tabindex="-1"></a>    , ovrall_lab</span>
<span id="cb254-9"><a href="chm-raster-resolution-testing.html#cb254-9" tabindex="-1"></a>    <span class="co"># detection</span></span>
<span id="cb254-10"><a href="chm-raster-resolution-testing.html#cb254-10" tabindex="-1"></a>    , f_score, recall, precision</span>
<span id="cb254-11"><a href="chm-raster-resolution-testing.html#cb254-11" tabindex="-1"></a>    <span class="co"># quantification</span></span>
<span id="cb254-12"><a href="chm-raster-resolution-testing.html#cb254-12" tabindex="-1"></a>    , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_rmse&quot;</span>)</span>
<span id="cb254-13"><a href="chm-raster-resolution-testing.html#cb254-13" tabindex="-1"></a>    , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_rrmse&quot;</span>)</span>
<span id="cb254-14"><a href="chm-raster-resolution-testing.html#cb254-14" tabindex="-1"></a>    , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_mean&quot;</span>)</span>
<span id="cb254-15"><a href="chm-raster-resolution-testing.html#cb254-15" tabindex="-1"></a>    , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_mape&quot;</span>)</span>
<span id="cb254-16"><a href="chm-raster-resolution-testing.html#cb254-16" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb254-17"><a href="chm-raster-resolution-testing.html#cb254-17" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(</span>
<span id="cb254-18"><a href="chm-raster-resolution-testing.html#cb254-18" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">c</span>(</span>
<span id="cb254-19"><a href="chm-raster-resolution-testing.html#cb254-19" tabindex="-1"></a>      f_score, recall, precision</span>
<span id="cb254-20"><a href="chm-raster-resolution-testing.html#cb254-20" tabindex="-1"></a>      , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_rmse&quot;</span>)</span>
<span id="cb254-21"><a href="chm-raster-resolution-testing.html#cb254-21" tabindex="-1"></a>      , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_rrmse&quot;</span>)</span>
<span id="cb254-22"><a href="chm-raster-resolution-testing.html#cb254-22" tabindex="-1"></a>      , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_mean&quot;</span>)</span>
<span id="cb254-23"><a href="chm-raster-resolution-testing.html#cb254-23" tabindex="-1"></a>      , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_mape&quot;</span>)</span>
<span id="cb254-24"><a href="chm-raster-resolution-testing.html#cb254-24" tabindex="-1"></a>    )</span>
<span id="cb254-25"><a href="chm-raster-resolution-testing.html#cb254-25" tabindex="-1"></a>    , <span class="at">names_to =</span> <span class="st">&quot;metric&quot;</span></span>
<span id="cb254-26"><a href="chm-raster-resolution-testing.html#cb254-26" tabindex="-1"></a>    , <span class="at">values_to =</span> <span class="st">&quot;value&quot;</span></span>
<span id="cb254-27"><a href="chm-raster-resolution-testing.html#cb254-27" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb254-28"><a href="chm-raster-resolution-testing.html#cb254-28" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb254-29"><a href="chm-raster-resolution-testing.html#cb254-29" tabindex="-1"></a>    <span class="at">eval_metric =</span> stringr<span class="sc">::</span><span class="fu">str_extract</span>(metric, <span class="st">&quot;(_rmse|_rrmse|_mean|_mape|f_score|recall|precision)$&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb254-30"><a href="chm-raster-resolution-testing.html#cb254-30" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_remove_all</span>(<span class="st">&quot;_&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb254-31"><a href="chm-raster-resolution-testing.html#cb254-31" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_replace_all</span>(<span class="st">&quot;mean&quot;</span>,<span class="st">&quot;me&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb254-32"><a href="chm-raster-resolution-testing.html#cb254-32" tabindex="-1"></a>      <span class="fu">toupper</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb254-33"><a href="chm-raster-resolution-testing.html#cb254-33" tabindex="-1"></a>      <span class="fu">factor</span>(</span>
<span id="cb254-34"><a href="chm-raster-resolution-testing.html#cb254-34" tabindex="-1"></a>        <span class="at">ordered =</span> T</span>
<span id="cb254-35"><a href="chm-raster-resolution-testing.html#cb254-35" tabindex="-1"></a>        , <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;FSCORE&quot;</span>,<span class="st">&quot;RECALL&quot;</span>,<span class="st">&quot;PRECISION&quot;</span>, <span class="st">&quot;ME&quot;</span>,<span class="st">&quot;RMSE&quot;</span>,<span class="st">&quot;RRMSE&quot;</span>,<span class="st">&quot;MAPE&quot;</span>)</span>
<span id="cb254-36"><a href="chm-raster-resolution-testing.html#cb254-36" tabindex="-1"></a>        , <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;F-score&quot;</span>,<span class="st">&quot;Recall&quot;</span>,<span class="st">&quot;Precision&quot;</span>, <span class="st">&quot;ME&quot;</span>,<span class="st">&quot;RMSE&quot;</span>,<span class="st">&quot;RRMSE&quot;</span>,<span class="st">&quot;MAPE&quot;</span>)</span>
<span id="cb254-37"><a href="chm-raster-resolution-testing.html#cb254-37" tabindex="-1"></a>      )</span>
<span id="cb254-38"><a href="chm-raster-resolution-testing.html#cb254-38" tabindex="-1"></a>    , <span class="at">pile_metric =</span> metric <span class="sc">%&gt;%</span> </span>
<span id="cb254-39"><a href="chm-raster-resolution-testing.html#cb254-39" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_remove</span>(<span class="st">&quot;(_rmse|_rrmse|_mean|_mape)$&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb254-40"><a href="chm-raster-resolution-testing.html#cb254-40" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_extract</span>(<span class="st">&quot;(paraboloid_volume|volume|area|height|diameter)&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb254-41"><a href="chm-raster-resolution-testing.html#cb254-41" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">coalesce</span>(<span class="st">&quot;detection&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb254-42"><a href="chm-raster-resolution-testing.html#cb254-42" tabindex="-1"></a>      <span class="fu">factor</span>(</span>
<span id="cb254-43"><a href="chm-raster-resolution-testing.html#cb254-43" tabindex="-1"></a>        <span class="at">ordered =</span> T</span>
<span id="cb254-44"><a href="chm-raster-resolution-testing.html#cb254-44" tabindex="-1"></a>        , <span class="at">levels =</span> <span class="fu">c</span>(</span>
<span id="cb254-45"><a href="chm-raster-resolution-testing.html#cb254-45" tabindex="-1"></a>          <span class="st">&quot;detection&quot;</span></span>
<span id="cb254-46"><a href="chm-raster-resolution-testing.html#cb254-46" tabindex="-1"></a>          , <span class="st">&quot;volume&quot;</span></span>
<span id="cb254-47"><a href="chm-raster-resolution-testing.html#cb254-47" tabindex="-1"></a>          , <span class="st">&quot;paraboloid_volume&quot;</span></span>
<span id="cb254-48"><a href="chm-raster-resolution-testing.html#cb254-48" tabindex="-1"></a>          , <span class="st">&quot;area&quot;</span></span>
<span id="cb254-49"><a href="chm-raster-resolution-testing.html#cb254-49" tabindex="-1"></a>          , <span class="st">&quot;height&quot;</span></span>
<span id="cb254-50"><a href="chm-raster-resolution-testing.html#cb254-50" tabindex="-1"></a>          , <span class="st">&quot;diameter&quot;</span></span>
<span id="cb254-51"><a href="chm-raster-resolution-testing.html#cb254-51" tabindex="-1"></a>        )</span>
<span id="cb254-52"><a href="chm-raster-resolution-testing.html#cb254-52" tabindex="-1"></a>        , <span class="at">labels =</span> <span class="fu">c</span>(</span>
<span id="cb254-53"><a href="chm-raster-resolution-testing.html#cb254-53" tabindex="-1"></a>          <span class="st">&quot;Detection&quot;</span></span>
<span id="cb254-54"><a href="chm-raster-resolution-testing.html#cb254-54" tabindex="-1"></a>          , <span class="st">&quot;Volume&quot;</span></span>
<span id="cb254-55"><a href="chm-raster-resolution-testing.html#cb254-55" tabindex="-1"></a>          , <span class="st">&quot;Volume paraboloid&quot;</span></span>
<span id="cb254-56"><a href="chm-raster-resolution-testing.html#cb254-56" tabindex="-1"></a>          , <span class="st">&quot;Area&quot;</span></span>
<span id="cb254-57"><a href="chm-raster-resolution-testing.html#cb254-57" tabindex="-1"></a>          , <span class="st">&quot;Height&quot;</span></span>
<span id="cb254-58"><a href="chm-raster-resolution-testing.html#cb254-58" tabindex="-1"></a>          , <span class="st">&quot;Diameter&quot;</span></span>
<span id="cb254-59"><a href="chm-raster-resolution-testing.html#cb254-59" tabindex="-1"></a>        )</span>
<span id="cb254-60"><a href="chm-raster-resolution-testing.html#cb254-60" tabindex="-1"></a>      )</span>
<span id="cb254-61"><a href="chm-raster-resolution-testing.html#cb254-61" tabindex="-1"></a>    , <span class="at">value_lab =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb254-62"><a href="chm-raster-resolution-testing.html#cb254-62" tabindex="-1"></a>        eval_metric <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;F-score&quot;</span>,<span class="st">&quot;Recall&quot;</span>,<span class="st">&quot;Precision&quot;</span>, <span class="st">&quot;RRMSE&quot;</span>, <span class="st">&quot;MAPE&quot;</span>) <span class="sc">~</span> scales<span class="sc">::</span><span class="fu">percent</span>(value,<span class="at">accuracy=</span><span class="fl">0.1</span>)</span>
<span id="cb254-63"><a href="chm-raster-resolution-testing.html#cb254-63" tabindex="-1"></a>        , eval_metric <span class="sc">==</span> <span class="st">&quot;ME&quot;</span> <span class="sc">~</span> scales<span class="sc">::</span><span class="fu">comma</span>(value,<span class="at">accuracy=</span><span class="fl">0.01</span>)</span>
<span id="cb254-64"><a href="chm-raster-resolution-testing.html#cb254-64" tabindex="-1"></a>        , T <span class="sc">~</span> scales<span class="sc">::</span><span class="fu">comma</span>(value,<span class="at">accuracy=</span><span class="fl">0.1</span>)</span>
<span id="cb254-65"><a href="chm-raster-resolution-testing.html#cb254-65" tabindex="-1"></a>      )</span>
<span id="cb254-66"><a href="chm-raster-resolution-testing.html#cb254-66" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb254-67"><a href="chm-raster-resolution-testing.html#cb254-67" tabindex="-1"></a>  <span class="co"># make var for color</span></span>
<span id="cb254-68"><a href="chm-raster-resolution-testing.html#cb254-68" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(pile_metric, eval_metric) <span class="sc">%&gt;%</span> </span>
<span id="cb254-69"><a href="chm-raster-resolution-testing.html#cb254-69" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb254-70"><a href="chm-raster-resolution-testing.html#cb254-70" tabindex="-1"></a>    <span class="co"># for ME, color by abs...for f-score,recall,precision color by -value so that higher means better...</span></span>
<span id="cb254-71"><a href="chm-raster-resolution-testing.html#cb254-71" tabindex="-1"></a>      <span class="co"># ...since higher means worse for quantification accuracy metrics</span></span>
<span id="cb254-72"><a href="chm-raster-resolution-testing.html#cb254-72" tabindex="-1"></a>    <span class="at">value_dir =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb254-73"><a href="chm-raster-resolution-testing.html#cb254-73" tabindex="-1"></a>      eval_metric <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;ME&quot;</span>) <span class="sc">~</span> <span class="fu">abs</span>(value)</span>
<span id="cb254-74"><a href="chm-raster-resolution-testing.html#cb254-74" tabindex="-1"></a>      , eval_metric <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;F-score&quot;</span>,<span class="st">&quot;Recall&quot;</span>,<span class="st">&quot;Precision&quot;</span>) <span class="sc">~</span> <span class="sc">-</span>value</span>
<span id="cb254-75"><a href="chm-raster-resolution-testing.html#cb254-75" tabindex="-1"></a>      , T <span class="sc">~</span> value</span>
<span id="cb254-76"><a href="chm-raster-resolution-testing.html#cb254-76" tabindex="-1"></a>    )</span>
<span id="cb254-77"><a href="chm-raster-resolution-testing.html#cb254-77" tabindex="-1"></a>    , <span class="at">value_z =</span> (value_dir<span class="sc">-</span><span class="fu">mean</span>(value_dir,<span class="at">na.rm=</span>T))<span class="sc">/</span><span class="fu">sd</span>(value_dir,<span class="at">na.rm=</span>T) <span class="co"># this is the key to the different colors within facets</span></span>
<span id="cb254-78"><a href="chm-raster-resolution-testing.html#cb254-78" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb254-79"><a href="chm-raster-resolution-testing.html#cb254-79" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb254-80"><a href="chm-raster-resolution-testing.html#cb254-80" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span>eval_metric <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;RRMSE&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb254-81"><a href="chm-raster-resolution-testing.html#cb254-81" tabindex="-1"></a>  <span class="co"># View()</span></span>
<span id="cb254-82"><a href="chm-raster-resolution-testing.html#cb254-82" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> eval_metric, <span class="at">y =</span> ovrall_lab)) <span class="sc">+</span> </span>
<span id="cb254-83"><a href="chm-raster-resolution-testing.html#cb254-83" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_tile</span>(</span>
<span id="cb254-84"><a href="chm-raster-resolution-testing.html#cb254-84" tabindex="-1"></a>    <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">fill =</span> pile_metric, <span class="at">alpha =</span> <span class="sc">-</span>value_z)</span>
<span id="cb254-85"><a href="chm-raster-resolution-testing.html#cb254-85" tabindex="-1"></a>    , <span class="at">color =</span> <span class="st">&quot;gray&quot;</span></span>
<span id="cb254-86"><a href="chm-raster-resolution-testing.html#cb254-86" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb254-87"><a href="chm-raster-resolution-testing.html#cb254-87" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_text</span>(</span>
<span id="cb254-88"><a href="chm-raster-resolution-testing.html#cb254-88" tabindex="-1"></a>    <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">label =</span> value_lab, <span class="at">fontface =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb254-89"><a href="chm-raster-resolution-testing.html#cb254-89" tabindex="-1"></a>    , <span class="at">color =</span> <span class="st">&quot;white&quot;</span></span>
<span id="cb254-90"><a href="chm-raster-resolution-testing.html#cb254-90" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb254-91"><a href="chm-raster-resolution-testing.html#cb254-91" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">facet_grid</span>(<span class="at">cols =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(pile_metric), <span class="at">scales =</span> <span class="st">&quot;free_x&quot;</span>) <span class="sc">+</span> </span>
<span id="cb254-92"><a href="chm-raster-resolution-testing.html#cb254-92" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_x_discrete</span>(<span class="at">position =</span> <span class="st">&quot;top&quot;</span>) <span class="sc">+</span></span>
<span id="cb254-93"><a href="chm-raster-resolution-testing.html#cb254-93" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;gray33&quot;</span>, harrypotter<span class="sc">::</span><span class="fu">hp</span>(<span class="at">n=</span><span class="dv">3</span>,<span class="at">option =</span> <span class="st">&quot;hermionegranger&quot;</span>) )) <span class="sc">+</span></span>
<span id="cb254-94"><a href="chm-raster-resolution-testing.html#cb254-94" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_alpha_binned</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="fl">0.55</span>, <span class="dv">1</span>)) <span class="sc">+</span> <span class="co"># this is the key to the different colors within facets</span></span>
<span id="cb254-95"><a href="chm-raster-resolution-testing.html#cb254-95" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb254-96"><a href="chm-raster-resolution-testing.html#cb254-96" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb254-97"><a href="chm-raster-resolution-testing.html#cb254-97" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;&quot;</span></span>
<span id="cb254-98"><a href="chm-raster-resolution-testing.html#cb254-98" tabindex="-1"></a>    , <span class="at">y =</span> <span class="st">&quot;max_ht_m : max_area_m2 : convexity_pct : circle_fit_iou_pct : chm_res_m&quot;</span></span>
<span id="cb254-99"><a href="chm-raster-resolution-testing.html#cb254-99" tabindex="-1"></a>    , <span class="at">subtitle =</span> <span class="fu">paste0</span>(</span>
<span id="cb254-100"><a href="chm-raster-resolution-testing.html#cb254-100" tabindex="-1"></a>       <span class="st">&quot;Structural Data Only&quot;</span></span>
<span id="cb254-101"><a href="chm-raster-resolution-testing.html#cb254-101" tabindex="-1"></a>       , <span class="st">&quot;</span><span class="sc">\n</span><span class="st">pile detection and form quantification accuracy metrics for the final recommended parameter settings&quot;</span></span>
<span id="cb254-102"><a href="chm-raster-resolution-testing.html#cb254-102" tabindex="-1"></a>       <span class="co"># , scales::percent(1-pct_rank_th_top,accuracy=1)</span></span>
<span id="cb254-103"><a href="chm-raster-resolution-testing.html#cb254-103" tabindex="-1"></a>       , <span class="st">&quot; (n=&quot;</span></span>
<span id="cb254-104"><a href="chm-raster-resolution-testing.html#cb254-104" tabindex="-1"></a>       , scales<span class="sc">::</span><span class="fu">comma</span>(n_th_top,<span class="at">accuracy=</span><span class="dv">1</span>)</span>
<span id="cb254-105"><a href="chm-raster-resolution-testing.html#cb254-105" tabindex="-1"></a>       , <span class="st">&quot;) &quot;</span></span>
<span id="cb254-106"><a href="chm-raster-resolution-testing.html#cb254-106" tabindex="-1"></a>       , <span class="st">&quot;</span><span class="sc">\n</span><span class="st">based on both detection and quantification accuracy&quot;</span></span>
<span id="cb254-107"><a href="chm-raster-resolution-testing.html#cb254-107" tabindex="-1"></a>      )</span>
<span id="cb254-108"><a href="chm-raster-resolution-testing.html#cb254-108" tabindex="-1"></a>    , <span class="at">caption =</span> <span class="st">&quot;*darker colors indicate relatively higher accuracy values&quot;</span></span>
<span id="cb254-109"><a href="chm-raster-resolution-testing.html#cb254-109" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb254-110"><a href="chm-raster-resolution-testing.html#cb254-110" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb254-111"><a href="chm-raster-resolution-testing.html#cb254-111" tabindex="-1"></a>    </span>
<span id="cb254-112"><a href="chm-raster-resolution-testing.html#cb254-112" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb254-113"><a href="chm-raster-resolution-testing.html#cb254-113" tabindex="-1"></a>    , <span class="at">panel.grid =</span> ggplot2<span class="sc">::</span><span class="fu">element_blank</span>()</span>
<span id="cb254-114"><a href="chm-raster-resolution-testing.html#cb254-114" tabindex="-1"></a>    , <span class="at">strip.placement =</span> <span class="st">&quot;outside&quot;</span></span>
<span id="cb254-115"><a href="chm-raster-resolution-testing.html#cb254-115" tabindex="-1"></a>    , <span class="at">strip.text.x =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb254-116"><a href="chm-raster-resolution-testing.html#cb254-116" tabindex="-1"></a>    , <span class="at">axis.text.x =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">7</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb254-117"><a href="chm-raster-resolution-testing.html#cb254-117" tabindex="-1"></a>    , <span class="at">axis.title.x =</span> ggplot2<span class="sc">::</span><span class="fu">element_blank</span>()</span>
<span id="cb254-118"><a href="chm-raster-resolution-testing.html#cb254-118" tabindex="-1"></a>    , <span class="at">plot.subtitle =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>)</span>
<span id="cb254-119"><a href="chm-raster-resolution-testing.html#cb254-119" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-220-1.png" width="1008" /></p>
<p>this plot allows for a simultaneous comparison of all metrics for pile detection and pile form quantification. it includes only the parameter combinations that achieved the best balanced accuracy, helping users identify the optimal settings by evaluating the trade-offs between detection and form quantification.</p>
<p>let’s table this</p>
<div class="sourceCode" id="cb255"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb255-1"><a href="chm-raster-resolution-testing.html#cb255-1" tabindex="-1"></a>param_combos_ranked <span class="sc">%&gt;%</span> </span>
<span id="cb255-2"><a href="chm-raster-resolution-testing.html#cb255-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(is_final_selection) <span class="sc">%&gt;%</span> </span>
<span id="cb255-3"><a href="chm-raster-resolution-testing.html#cb255-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">!</span>tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;_pct_rank_&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb255-4"><a href="chm-raster-resolution-testing.html#cb255-4" tabindex="-1"></a>  <span class="co"># first select to arrange eval_metric</span></span>
<span id="cb255-5"><a href="chm-raster-resolution-testing.html#cb255-5" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb255-6"><a href="chm-raster-resolution-testing.html#cb255-6" tabindex="-1"></a>    ovrall_lab</span>
<span id="cb255-7"><a href="chm-raster-resolution-testing.html#cb255-7" tabindex="-1"></a>    , max_ht_m,max_area_m2,convexity_pct,circle_fit_iou_pct,chm_res_m</span>
<span id="cb255-8"><a href="chm-raster-resolution-testing.html#cb255-8" tabindex="-1"></a>    <span class="co"># detection</span></span>
<span id="cb255-9"><a href="chm-raster-resolution-testing.html#cb255-9" tabindex="-1"></a>    , f_score, recall, precision</span>
<span id="cb255-10"><a href="chm-raster-resolution-testing.html#cb255-10" tabindex="-1"></a>    <span class="co"># quantification</span></span>
<span id="cb255-11"><a href="chm-raster-resolution-testing.html#cb255-11" tabindex="-1"></a>    , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_mean&quot;</span>)</span>
<span id="cb255-12"><a href="chm-raster-resolution-testing.html#cb255-12" tabindex="-1"></a>    , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_rmse&quot;</span>)</span>
<span id="cb255-13"><a href="chm-raster-resolution-testing.html#cb255-13" tabindex="-1"></a>    <span class="co"># , tidyselect::ends_with(&quot;_rrmse&quot;)</span></span>
<span id="cb255-14"><a href="chm-raster-resolution-testing.html#cb255-14" tabindex="-1"></a>    , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_mape&quot;</span>)</span>
<span id="cb255-15"><a href="chm-raster-resolution-testing.html#cb255-15" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb255-16"><a href="chm-raster-resolution-testing.html#cb255-16" tabindex="-1"></a>  <span class="co"># second select to arrange pile_metric</span></span>
<span id="cb255-17"><a href="chm-raster-resolution-testing.html#cb255-17" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb255-18"><a href="chm-raster-resolution-testing.html#cb255-18" tabindex="-1"></a>    ovrall_lab</span>
<span id="cb255-19"><a href="chm-raster-resolution-testing.html#cb255-19" tabindex="-1"></a>    , max_ht_m,max_area_m2,convexity_pct,circle_fit_iou_pct,chm_res_m</span>
<span id="cb255-20"><a href="chm-raster-resolution-testing.html#cb255-20" tabindex="-1"></a>    <span class="co"># detection</span></span>
<span id="cb255-21"><a href="chm-raster-resolution-testing.html#cb255-21" tabindex="-1"></a>    , f_score, recall, precision</span>
<span id="cb255-22"><a href="chm-raster-resolution-testing.html#cb255-22" tabindex="-1"></a>    <span class="co"># quantification</span></span>
<span id="cb255-23"><a href="chm-raster-resolution-testing.html#cb255-23" tabindex="-1"></a>    , <span class="fu">c</span>(tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;volume&quot;</span>) <span class="sc">&amp;</span> <span class="sc">!</span>tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;paraboloid&quot;</span>))</span>
<span id="cb255-24"><a href="chm-raster-resolution-testing.html#cb255-24" tabindex="-1"></a>    , tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;area&quot;</span>)</span>
<span id="cb255-25"><a href="chm-raster-resolution-testing.html#cb255-25" tabindex="-1"></a>    , tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;height&quot;</span>)</span>
<span id="cb255-26"><a href="chm-raster-resolution-testing.html#cb255-26" tabindex="-1"></a>    , tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;diameter&quot;</span>)</span>
<span id="cb255-27"><a href="chm-raster-resolution-testing.html#cb255-27" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb255-28"><a href="chm-raster-resolution-testing.html#cb255-28" tabindex="-1"></a>  <span class="co"># names()</span></span>
<span id="cb255-29"><a href="chm-raster-resolution-testing.html#cb255-29" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb255-30"><a href="chm-raster-resolution-testing.html#cb255-30" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">across</span>(</span>
<span id="cb255-31"><a href="chm-raster-resolution-testing.html#cb255-31" tabindex="-1"></a>      <span class="at">.cols =</span> <span class="fu">c</span>(f_score, recall, precision, tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_mape&quot;</span>))</span>
<span id="cb255-32"><a href="chm-raster-resolution-testing.html#cb255-32" tabindex="-1"></a>      , <span class="at">.fn =</span> <span class="sc">~</span> scales<span class="sc">::</span><span class="fu">percent</span>(.x, <span class="at">accuracy =</span> <span class="dv">1</span>)</span>
<span id="cb255-33"><a href="chm-raster-resolution-testing.html#cb255-33" tabindex="-1"></a>    )</span>
<span id="cb255-34"><a href="chm-raster-resolution-testing.html#cb255-34" tabindex="-1"></a>    , dplyr<span class="sc">::</span><span class="fu">across</span>(</span>
<span id="cb255-35"><a href="chm-raster-resolution-testing.html#cb255-35" tabindex="-1"></a>      <span class="at">.cols =</span> <span class="fu">c</span>(tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_mean&quot;</span>))</span>
<span id="cb255-36"><a href="chm-raster-resolution-testing.html#cb255-36" tabindex="-1"></a>      , <span class="at">.fn =</span> <span class="sc">~</span> scales<span class="sc">::</span><span class="fu">comma</span>(.x, <span class="at">accuracy =</span> <span class="fl">0.01</span>)</span>
<span id="cb255-37"><a href="chm-raster-resolution-testing.html#cb255-37" tabindex="-1"></a>    )</span>
<span id="cb255-38"><a href="chm-raster-resolution-testing.html#cb255-38" tabindex="-1"></a>    , dplyr<span class="sc">::</span><span class="fu">across</span>(</span>
<span id="cb255-39"><a href="chm-raster-resolution-testing.html#cb255-39" tabindex="-1"></a>      <span class="at">.cols =</span> <span class="fu">c</span>(tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_rmse&quot;</span>))</span>
<span id="cb255-40"><a href="chm-raster-resolution-testing.html#cb255-40" tabindex="-1"></a>      , <span class="at">.fn =</span> <span class="sc">~</span> scales<span class="sc">::</span><span class="fu">comma</span>(.x, <span class="at">accuracy =</span> <span class="fl">0.1</span>)</span>
<span id="cb255-41"><a href="chm-raster-resolution-testing.html#cb255-41" tabindex="-1"></a>    )</span>
<span id="cb255-42"><a href="chm-raster-resolution-testing.html#cb255-42" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb255-43"><a href="chm-raster-resolution-testing.html#cb255-43" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">blank=</span> <span class="st">&quot;   &quot;</span> ) <span class="sc">%&gt;%</span> </span>
<span id="cb255-44"><a href="chm-raster-resolution-testing.html#cb255-44" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">relocate</span>(blank, <span class="at">.before =</span> f_score) <span class="sc">%&gt;%</span> </span>
<span id="cb255-45"><a href="chm-raster-resolution-testing.html#cb255-45" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(<span class="fu">desc</span>(ovrall_lab)) <span class="sc">%&gt;%</span> </span>
<span id="cb255-46"><a href="chm-raster-resolution-testing.html#cb255-46" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kbl</span>(</span>
<span id="cb255-47"><a href="chm-raster-resolution-testing.html#cb255-47" tabindex="-1"></a>    <span class="at">caption =</span> </span>
<span id="cb255-48"><a href="chm-raster-resolution-testing.html#cb255-48" tabindex="-1"></a>      <span class="fu">paste0</span>(</span>
<span id="cb255-49"><a href="chm-raster-resolution-testing.html#cb255-49" tabindex="-1"></a>       <span class="st">&quot;Structural Data Only&quot;</span></span>
<span id="cb255-50"><a href="chm-raster-resolution-testing.html#cb255-50" tabindex="-1"></a>       , <span class="st">&quot;&lt;br&gt;pile detection and form quantification accuracy metrics for the final recommended parameter settings&quot;</span></span>
<span id="cb255-51"><a href="chm-raster-resolution-testing.html#cb255-51" tabindex="-1"></a>       <span class="co"># , scales::percent(1-pct_rank_th_top,accuracy=1)</span></span>
<span id="cb255-52"><a href="chm-raster-resolution-testing.html#cb255-52" tabindex="-1"></a>       , <span class="st">&quot; (n=&quot;</span></span>
<span id="cb255-53"><a href="chm-raster-resolution-testing.html#cb255-53" tabindex="-1"></a>       , scales<span class="sc">::</span><span class="fu">comma</span>(n_th_top,<span class="at">accuracy=</span><span class="dv">1</span>)</span>
<span id="cb255-54"><a href="chm-raster-resolution-testing.html#cb255-54" tabindex="-1"></a>       , <span class="st">&quot;) &quot;</span></span>
<span id="cb255-55"><a href="chm-raster-resolution-testing.html#cb255-55" tabindex="-1"></a>       , <span class="st">&quot;&lt;br&gt;based on both detection and quantification accuracy&quot;</span></span>
<span id="cb255-56"><a href="chm-raster-resolution-testing.html#cb255-56" tabindex="-1"></a>      )</span>
<span id="cb255-57"><a href="chm-raster-resolution-testing.html#cb255-57" tabindex="-1"></a>    , <span class="at">col.names =</span> <span class="fu">c</span>(</span>
<span id="cb255-58"><a href="chm-raster-resolution-testing.html#cb255-58" tabindex="-1"></a>      <span class="st">&quot;&quot;</span></span>
<span id="cb255-59"><a href="chm-raster-resolution-testing.html#cb255-59" tabindex="-1"></a>      ,<span class="st">&quot;max_ht_m&quot;</span>,<span class="st">&quot;max_area_m2&quot;</span>,<span class="st">&quot;convexity_pct&quot;</span>,<span class="st">&quot;circle_fit_iou_pct&quot;</span>,<span class="st">&quot;chm_res_m&quot;</span></span>
<span id="cb255-60"><a href="chm-raster-resolution-testing.html#cb255-60" tabindex="-1"></a>      , <span class="st">&quot;   &quot;</span></span>
<span id="cb255-61"><a href="chm-raster-resolution-testing.html#cb255-61" tabindex="-1"></a>      , <span class="st">&quot;F-score&quot;</span>, <span class="st">&quot;Recall&quot;</span>, <span class="st">&quot;Precision&quot;</span></span>
<span id="cb255-62"><a href="chm-raster-resolution-testing.html#cb255-62" tabindex="-1"></a>      , <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;ME&quot;</span>,<span class="st">&quot;RMSE&quot;</span>,<span class="st">&quot;MAPE&quot;</span>), <span class="at">times =</span> <span class="dv">3</span>)</span>
<span id="cb255-63"><a href="chm-raster-resolution-testing.html#cb255-63" tabindex="-1"></a>    )</span>
<span id="cb255-64"><a href="chm-raster-resolution-testing.html#cb255-64" tabindex="-1"></a>    , <span class="at">escape =</span> F</span>
<span id="cb255-65"><a href="chm-raster-resolution-testing.html#cb255-65" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb255-66"><a href="chm-raster-resolution-testing.html#cb255-66" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kable_styling</span>(<span class="at">font_size =</span> <span class="dv">11</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb255-67"><a href="chm-raster-resolution-testing.html#cb255-67" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">add_header_above</span>(<span class="fu">c</span>(</span>
<span id="cb255-68"><a href="chm-raster-resolution-testing.html#cb255-68" tabindex="-1"></a>    <span class="st">&quot; &quot;</span><span class="ot">=</span><span class="dv">7</span></span>
<span id="cb255-69"><a href="chm-raster-resolution-testing.html#cb255-69" tabindex="-1"></a>    , <span class="st">&quot;Detection&quot;</span> <span class="ot">=</span> <span class="dv">3</span></span>
<span id="cb255-70"><a href="chm-raster-resolution-testing.html#cb255-70" tabindex="-1"></a>    , <span class="st">&quot;Area&quot;</span> <span class="ot">=</span> <span class="dv">3</span></span>
<span id="cb255-71"><a href="chm-raster-resolution-testing.html#cb255-71" tabindex="-1"></a>    , <span class="st">&quot;Height&quot;</span> <span class="ot">=</span> <span class="dv">3</span></span>
<span id="cb255-72"><a href="chm-raster-resolution-testing.html#cb255-72" tabindex="-1"></a>    , <span class="st">&quot;Diameter&quot;</span> <span class="ot">=</span> <span class="dv">3</span></span>
<span id="cb255-73"><a href="chm-raster-resolution-testing.html#cb255-73" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb255-74"><a href="chm-raster-resolution-testing.html#cb255-74" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">column_spec</span>(<span class="fu">seq</span>(<span class="dv">7</span>,<span class="dv">19</span>,<span class="at">by=</span><span class="dv">3</span>), <span class="at">border_right =</span> <span class="cn">TRUE</span>, <span class="at">include_thead =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb255-75"><a href="chm-raster-resolution-testing.html#cb255-75" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">column_spec</span>(</span>
<span id="cb255-76"><a href="chm-raster-resolution-testing.html#cb255-76" tabindex="-1"></a>    <span class="at">column =</span> <span class="dv">7</span><span class="sc">:</span><span class="dv">19</span></span>
<span id="cb255-77"><a href="chm-raster-resolution-testing.html#cb255-77" tabindex="-1"></a>    , <span class="at">extra_css =</span> <span class="st">&quot;font-size: 10px;&quot;</span></span>
<span id="cb255-78"><a href="chm-raster-resolution-testing.html#cb255-78" tabindex="-1"></a>    , <span class="at">include_thead =</span> T</span>
<span id="cb255-79"><a href="chm-raster-resolution-testing.html#cb255-79" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb255-80"><a href="chm-raster-resolution-testing.html#cb255-80" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">scroll_box</span>(<span class="at">width =</span> <span class="st">&quot;740px&quot;</span>) </span></code></pre></div>
<div style="border: 1px solid #ddd; padding: 5px; overflow-x: scroll; width:740px; ">
<table class="table" style="font-size: 11px; margin-left: auto; margin-right: auto;">
<caption style="font-size: initial !important;">
<span id="tab:unnamed-chunk-221">Table 8.1: </span>Structural Data Only<br>pile detection and form quantification accuracy metrics for the final recommended parameter settings (n=12) <br>based on both detection and quantification accuracy
</caption>
<thead>
<tr>
<th style="empty-cells: hide;border-bottom:hidden;" colspan="7">
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="3">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Detection
</div>
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="3">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Area
</div>
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="3">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Height
</div>
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="3">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Diameter
</div>
</th>
</tr>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
max_ht_m
</th>
<th style="text-align:right;">
max_area_m2
</th>
<th style="text-align:right;">
convexity_pct
</th>
<th style="text-align:right;">
circle_fit_iou_pct
</th>
<th style="text-align:right;">
chm_res_m
</th>
<th style="text-align:left;border-right:1px solid;font-size: 10px;">
</th>
<th style="text-align:left;font-size: 10px;">
F-score
</th>
<th style="text-align:left;font-size: 10px;">
Recall
</th>
<th style="text-align:left;border-right:1px solid;font-size: 10px;">
Precision
</th>
<th style="text-align:left;font-size: 10px;">
ME
</th>
<th style="text-align:left;font-size: 10px;">
RMSE
</th>
<th style="text-align:left;border-right:1px solid;font-size: 10px;">
MAPE
</th>
<th style="text-align:left;font-size: 10px;">
ME
</th>
<th style="text-align:left;font-size: 10px;">
RMSE
</th>
<th style="text-align:left;border-right:1px solid;font-size: 10px;">
MAPE
</th>
<th style="text-align:left;font-size: 10px;">
ME
</th>
<th style="text-align:left;font-size: 10px;">
RMSE
</th>
<th style="text-align:left;border-right:1px solid;font-size: 10px;">
MAPE
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
2:10:0.8:0.05:0.1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
0.80
</td>
<td style="text-align:right;">
0.05
</td>
<td style="text-align:right;">
0.1
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
79%
</td>
<td style="text-align:left;font-size: 10px;">
78%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
80%
</td>
<td style="text-align:left;font-size: 10px;">
-0.50
</td>
<td style="text-align:left;font-size: 10px;">
1.0
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
11%
</td>
<td style="text-align:left;font-size: 10px;">
-0.20
</td>
<td style="text-align:left;font-size: 10px;">
0.3
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
13%
</td>
<td style="text-align:left;font-size: 10px;">
0.17
</td>
<td style="text-align:left;font-size: 10px;">
0.4
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
10%
</td>
</tr>
<tr>
<td style="text-align:left;">
2:20:0.8:0.05:0.1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
20
</td>
<td style="text-align:right;">
0.80
</td>
<td style="text-align:right;">
0.05
</td>
<td style="text-align:right;">
0.1
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
81%
</td>
<td style="text-align:left;font-size: 10px;">
82%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
80%
</td>
<td style="text-align:left;font-size: 10px;">
-0.60
</td>
<td style="text-align:left;font-size: 10px;">
1.7
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
11%
</td>
<td style="text-align:left;font-size: 10px;">
-0.24
</td>
<td style="text-align:left;font-size: 10px;">
0.4
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
13%
</td>
<td style="text-align:left;font-size: 10px;">
0.18
</td>
<td style="text-align:left;font-size: 10px;">
0.5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
11%
</td>
</tr>
<tr>
<td style="text-align:left;">
2:60:0.8:0.05:0.1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
60
</td>
<td style="text-align:right;">
0.80
</td>
<td style="text-align:right;">
0.05
</td>
<td style="text-align:right;">
0.1
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
81%
</td>
<td style="text-align:left;font-size: 10px;">
83%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
80%
</td>
<td style="text-align:left;font-size: 10px;">
-0.64
</td>
<td style="text-align:left;font-size: 10px;">
1.7
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
11%
</td>
<td style="text-align:left;font-size: 10px;">
-0.27
</td>
<td style="text-align:left;font-size: 10px;">
0.5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
14%
</td>
<td style="text-align:left;font-size: 10px;">
0.18
</td>
<td style="text-align:left;font-size: 10px;">
0.5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
11%
</td>
</tr>
<tr>
<td style="text-align:left;">
2:50:0.8:0.05:0.1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
50
</td>
<td style="text-align:right;">
0.80
</td>
<td style="text-align:right;">
0.05
</td>
<td style="text-align:right;">
0.1
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
81%
</td>
<td style="text-align:left;font-size: 10px;">
83%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
80%
</td>
<td style="text-align:left;font-size: 10px;">
-0.64
</td>
<td style="text-align:left;font-size: 10px;">
1.7
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
11%
</td>
<td style="text-align:left;font-size: 10px;">
-0.27
</td>
<td style="text-align:left;font-size: 10px;">
0.5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
14%
</td>
<td style="text-align:left;font-size: 10px;">
0.18
</td>
<td style="text-align:left;font-size: 10px;">
0.5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
11%
</td>
</tr>
<tr>
<td style="text-align:left;">
2:40:0.8:0.05:0.1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
40
</td>
<td style="text-align:right;">
0.80
</td>
<td style="text-align:right;">
0.05
</td>
<td style="text-align:right;">
0.1
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
81%
</td>
<td style="text-align:left;font-size: 10px;">
83%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
80%
</td>
<td style="text-align:left;font-size: 10px;">
-0.64
</td>
<td style="text-align:left;font-size: 10px;">
1.7
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
11%
</td>
<td style="text-align:left;font-size: 10px;">
-0.27
</td>
<td style="text-align:left;font-size: 10px;">
0.5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
14%
</td>
<td style="text-align:left;font-size: 10px;">
0.18
</td>
<td style="text-align:left;font-size: 10px;">
0.5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
11%
</td>
</tr>
<tr>
<td style="text-align:left;">
2:30:0.8:0.05:0.1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
30
</td>
<td style="text-align:right;">
0.80
</td>
<td style="text-align:right;">
0.05
</td>
<td style="text-align:right;">
0.1
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
81%
</td>
<td style="text-align:left;font-size: 10px;">
83%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
80%
</td>
<td style="text-align:left;font-size: 10px;">
-0.64
</td>
<td style="text-align:left;font-size: 10px;">
1.7
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
11%
</td>
<td style="text-align:left;font-size: 10px;">
-0.27
</td>
<td style="text-align:left;font-size: 10px;">
0.5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
14%
</td>
<td style="text-align:left;font-size: 10px;">
0.18
</td>
<td style="text-align:left;font-size: 10px;">
0.5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
11%
</td>
</tr>
<tr>
<td style="text-align:left;">
2:20:0.8:0.2:0.1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
20
</td>
<td style="text-align:right;">
0.80
</td>
<td style="text-align:right;">
0.20
</td>
<td style="text-align:right;">
0.1
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
80%
</td>
<td style="text-align:left;font-size: 10px;">
79%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
80%
</td>
<td style="text-align:left;font-size: 10px;">
-0.61
</td>
<td style="text-align:left;font-size: 10px;">
1.7
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
11%
</td>
<td style="text-align:left;font-size: 10px;">
-0.25
</td>
<td style="text-align:left;font-size: 10px;">
0.5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
14%
</td>
<td style="text-align:left;font-size: 10px;">
0.18
</td>
<td style="text-align:left;font-size: 10px;">
0.5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
11%
</td>
</tr>
<tr>
<td style="text-align:left;">
2:60:0.8:0.2:0.1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
60
</td>
<td style="text-align:right;">
0.80
</td>
<td style="text-align:right;">
0.20
</td>
<td style="text-align:right;">
0.1
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
80%
</td>
<td style="text-align:left;font-size: 10px;">
81%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
80%
</td>
<td style="text-align:left;font-size: 10px;">
-0.65
</td>
<td style="text-align:left;font-size: 10px;">
1.7
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
11%
</td>
<td style="text-align:left;font-size: 10px;">
-0.27
</td>
<td style="text-align:left;font-size: 10px;">
0.5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
14%
</td>
<td style="text-align:left;font-size: 10px;">
0.19
</td>
<td style="text-align:left;font-size: 10px;">
0.5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
11%
</td>
</tr>
<tr>
<td style="text-align:left;">
2:50:0.8:0.2:0.1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
50
</td>
<td style="text-align:right;">
0.80
</td>
<td style="text-align:right;">
0.20
</td>
<td style="text-align:right;">
0.1
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
80%
</td>
<td style="text-align:left;font-size: 10px;">
81%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
80%
</td>
<td style="text-align:left;font-size: 10px;">
-0.65
</td>
<td style="text-align:left;font-size: 10px;">
1.7
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
11%
</td>
<td style="text-align:left;font-size: 10px;">
-0.27
</td>
<td style="text-align:left;font-size: 10px;">
0.5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
14%
</td>
<td style="text-align:left;font-size: 10px;">
0.19
</td>
<td style="text-align:left;font-size: 10px;">
0.5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
11%
</td>
</tr>
<tr>
<td style="text-align:left;">
2:40:0.8:0.2:0.1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
40
</td>
<td style="text-align:right;">
0.80
</td>
<td style="text-align:right;">
0.20
</td>
<td style="text-align:right;">
0.1
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
80%
</td>
<td style="text-align:left;font-size: 10px;">
81%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
80%
</td>
<td style="text-align:left;font-size: 10px;">
-0.65
</td>
<td style="text-align:left;font-size: 10px;">
1.7
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
11%
</td>
<td style="text-align:left;font-size: 10px;">
-0.27
</td>
<td style="text-align:left;font-size: 10px;">
0.5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
14%
</td>
<td style="text-align:left;font-size: 10px;">
0.19
</td>
<td style="text-align:left;font-size: 10px;">
0.5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
11%
</td>
</tr>
<tr>
<td style="text-align:left;">
2:30:0.8:0.2:0.1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
30
</td>
<td style="text-align:right;">
0.80
</td>
<td style="text-align:right;">
0.20
</td>
<td style="text-align:right;">
0.1
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
80%
</td>
<td style="text-align:left;font-size: 10px;">
81%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
80%
</td>
<td style="text-align:left;font-size: 10px;">
-0.65
</td>
<td style="text-align:left;font-size: 10px;">
1.7
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
11%
</td>
<td style="text-align:left;font-size: 10px;">
-0.27
</td>
<td style="text-align:left;font-size: 10px;">
0.5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
14%
</td>
<td style="text-align:left;font-size: 10px;">
0.19
</td>
<td style="text-align:left;font-size: 10px;">
0.5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
11%
</td>
</tr>
<tr>
<td style="text-align:left;">
2:30:0.65:0.5:0.1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
30
</td>
<td style="text-align:right;">
0.65
</td>
<td style="text-align:right;">
0.50
</td>
<td style="text-align:right;">
0.1
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
75%
</td>
<td style="text-align:left;font-size: 10px;">
78%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
72%
</td>
<td style="text-align:left;font-size: 10px;">
-0.64
</td>
<td style="text-align:left;font-size: 10px;">
1.8
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
11%
</td>
<td style="text-align:left;font-size: 10px;">
-0.25
</td>
<td style="text-align:left;font-size: 10px;">
0.4
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
14%
</td>
<td style="text-align:left;font-size: 10px;">
0.19
</td>
<td style="text-align:left;font-size: 10px;">
0.5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
11%
</td>
</tr>
</tbody>
</table>
</div>
<p>what is the expected <em>detection</em> accuracy of the final 12 recommended settings?</p>
<div class="sourceCode" id="cb256"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb256-1"><a href="chm-raster-resolution-testing.html#cb256-1" tabindex="-1"></a><span class="fu">plt_detection_dist</span>(</span>
<span id="cb256-2"><a href="chm-raster-resolution-testing.html#cb256-2" tabindex="-1"></a>  <span class="at">df =</span> param_combos_ranked <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(is_final_selection) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">!</span>tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;_pct_rank_&quot;</span>))</span>
<span id="cb256-3"><a href="chm-raster-resolution-testing.html#cb256-3" tabindex="-1"></a>  , <span class="fu">paste0</span>(</span>
<span id="cb256-4"><a href="chm-raster-resolution-testing.html#cb256-4" tabindex="-1"></a>    <span class="st">&quot;Structural Data Only&quot;</span></span>
<span id="cb256-5"><a href="chm-raster-resolution-testing.html#cb256-5" tabindex="-1"></a>    , <span class="st">&quot;</span><span class="sc">\n</span><span class="st">distribution of evaluation metrics for the final recommended parameter settings&quot;</span></span>
<span id="cb256-6"><a href="chm-raster-resolution-testing.html#cb256-6" tabindex="-1"></a>    , <span class="st">&quot; (n=&quot;</span></span>
<span id="cb256-7"><a href="chm-raster-resolution-testing.html#cb256-7" tabindex="-1"></a>    , scales<span class="sc">::</span><span class="fu">comma</span>(n_th_top,<span class="at">accuracy=</span><span class="dv">1</span>)</span>
<span id="cb256-8"><a href="chm-raster-resolution-testing.html#cb256-8" tabindex="-1"></a>    , <span class="st">&quot;) &quot;</span></span>
<span id="cb256-9"><a href="chm-raster-resolution-testing.html#cb256-9" tabindex="-1"></a>    , <span class="st">&quot;</span><span class="sc">\n</span><span class="st">based on both detection and quantification accuracy&quot;</span></span>
<span id="cb256-10"><a href="chm-raster-resolution-testing.html#cb256-10" tabindex="-1"></a>  )</span>
<span id="cb256-11"><a href="chm-raster-resolution-testing.html#cb256-11" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-222-1.png" width="1008" /></p>
<p><em>WHAT DID WE LEARN FROM THIS</em></p>
<p>what is the expected <em>quantification</em> accuracy of the final 12 recommended settings?</p>
<div class="sourceCode" id="cb257"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb257-1"><a href="chm-raster-resolution-testing.html#cb257-1" tabindex="-1"></a><span class="co"># plot it</span></span>
<span id="cb257-2"><a href="chm-raster-resolution-testing.html#cb257-2" tabindex="-1"></a><span class="fu">plt_form_quantification_dist</span>(</span>
<span id="cb257-3"><a href="chm-raster-resolution-testing.html#cb257-3" tabindex="-1"></a>  <span class="at">df =</span> param_combos_ranked <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(is_final_selection) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">!</span>tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;_pct_rank_&quot;</span>))</span>
<span id="cb257-4"><a href="chm-raster-resolution-testing.html#cb257-4" tabindex="-1"></a>  , <span class="fu">paste0</span>(</span>
<span id="cb257-5"><a href="chm-raster-resolution-testing.html#cb257-5" tabindex="-1"></a>    <span class="st">&quot;Structural Data Only&quot;</span></span>
<span id="cb257-6"><a href="chm-raster-resolution-testing.html#cb257-6" tabindex="-1"></a>    , <span class="st">&quot;</span><span class="sc">\n</span><span class="st">distribution of pile form quantification metrics for the final recommended parameter settings&quot;</span></span>
<span id="cb257-7"><a href="chm-raster-resolution-testing.html#cb257-7" tabindex="-1"></a>    , <span class="st">&quot; (n=&quot;</span></span>
<span id="cb257-8"><a href="chm-raster-resolution-testing.html#cb257-8" tabindex="-1"></a>    , scales<span class="sc">::</span><span class="fu">comma</span>(n_th_top,<span class="at">accuracy=</span><span class="dv">1</span>)</span>
<span id="cb257-9"><a href="chm-raster-resolution-testing.html#cb257-9" tabindex="-1"></a>    , <span class="st">&quot;) &quot;</span></span>
<span id="cb257-10"><a href="chm-raster-resolution-testing.html#cb257-10" tabindex="-1"></a>    , <span class="st">&quot;</span><span class="sc">\n</span><span class="st">based on both detection and quantification accuracy&quot;</span></span>
<span id="cb257-11"><a href="chm-raster-resolution-testing.html#cb257-11" tabindex="-1"></a>  )</span>
<span id="cb257-12"><a href="chm-raster-resolution-testing.html#cb257-12" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-223-1.png" width="1008" /></p>
<p><em>WHAT DID WE LEARN FROM THIS</em></p>
<p>finally, here are the combinations selected compared against all 5,880 combinations tested.</p>
<div class="sourceCode" id="cb258"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb258-1"><a href="chm-raster-resolution-testing.html#cb258-1" tabindex="-1"></a>param_combos_ranked <span class="sc">%&gt;%</span> </span>
<span id="cb258-2"><a href="chm-raster-resolution-testing.html#cb258-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb258-3"><a href="chm-raster-resolution-testing.html#cb258-3" tabindex="-1"></a>    rn,max_ht_m,max_area_m2,convexity_pct,circle_fit_iou_pct</span>
<span id="cb258-4"><a href="chm-raster-resolution-testing.html#cb258-4" tabindex="-1"></a>    , is_final_selection</span>
<span id="cb258-5"><a href="chm-raster-resolution-testing.html#cb258-5" tabindex="-1"></a>    , f_score, precision, recall</span>
<span id="cb258-6"><a href="chm-raster-resolution-testing.html#cb258-6" tabindex="-1"></a>    <span class="co"># quantification accuracy</span></span>
<span id="cb258-7"><a href="chm-raster-resolution-testing.html#cb258-7" tabindex="-1"></a>    , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_mape&quot;</span>)</span>
<span id="cb258-8"><a href="chm-raster-resolution-testing.html#cb258-8" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb258-9"><a href="chm-raster-resolution-testing.html#cb258-9" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(</span>
<span id="cb258-10"><a href="chm-raster-resolution-testing.html#cb258-10" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">c</span>(</span>
<span id="cb258-11"><a href="chm-raster-resolution-testing.html#cb258-11" tabindex="-1"></a>      tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_mape&quot;</span>)</span>
<span id="cb258-12"><a href="chm-raster-resolution-testing.html#cb258-12" tabindex="-1"></a>      <span class="co"># ,precision,recall</span></span>
<span id="cb258-13"><a href="chm-raster-resolution-testing.html#cb258-13" tabindex="-1"></a>    )</span>
<span id="cb258-14"><a href="chm-raster-resolution-testing.html#cb258-14" tabindex="-1"></a>    , <span class="at">names_to =</span> <span class="st">&quot;metric&quot;</span></span>
<span id="cb258-15"><a href="chm-raster-resolution-testing.html#cb258-15" tabindex="-1"></a>    , <span class="at">values_to =</span> <span class="st">&quot;value&quot;</span></span>
<span id="cb258-16"><a href="chm-raster-resolution-testing.html#cb258-16" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb258-17"><a href="chm-raster-resolution-testing.html#cb258-17" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb258-18"><a href="chm-raster-resolution-testing.html#cb258-18" tabindex="-1"></a>    <span class="at">eval_metric =</span> stringr<span class="sc">::</span><span class="fu">str_extract</span>(metric, <span class="st">&quot;(_rmse|_rrmse|_mean|_mape)$&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb258-19"><a href="chm-raster-resolution-testing.html#cb258-19" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_remove_all</span>(<span class="st">&quot;_&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb258-20"><a href="chm-raster-resolution-testing.html#cb258-20" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_replace_all</span>(<span class="st">&quot;mean&quot;</span>,<span class="st">&quot;me&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb258-21"><a href="chm-raster-resolution-testing.html#cb258-21" tabindex="-1"></a>      <span class="fu">toupper</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb258-22"><a href="chm-raster-resolution-testing.html#cb258-22" tabindex="-1"></a>      <span class="fu">factor</span>(</span>
<span id="cb258-23"><a href="chm-raster-resolution-testing.html#cb258-23" tabindex="-1"></a>        <span class="at">ordered =</span> T</span>
<span id="cb258-24"><a href="chm-raster-resolution-testing.html#cb258-24" tabindex="-1"></a>        , <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;ME&quot;</span>,<span class="st">&quot;RMSE&quot;</span>,<span class="st">&quot;RRMSE&quot;</span>,<span class="st">&quot;MAPE&quot;</span>)</span>
<span id="cb258-25"><a href="chm-raster-resolution-testing.html#cb258-25" tabindex="-1"></a>      )</span>
<span id="cb258-26"><a href="chm-raster-resolution-testing.html#cb258-26" tabindex="-1"></a>    , <span class="at">pile_metric =</span> metric <span class="sc">%&gt;%</span> </span>
<span id="cb258-27"><a href="chm-raster-resolution-testing.html#cb258-27" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_remove</span>(<span class="st">&quot;(_rmse|_rrmse|_mean|_mape)$&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb258-28"><a href="chm-raster-resolution-testing.html#cb258-28" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_extract</span>(<span class="st">&quot;(paraboloid_volume|volume|area|height|diameter|precision|recall)&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb258-29"><a href="chm-raster-resolution-testing.html#cb258-29" tabindex="-1"></a>      <span class="fu">factor</span>(</span>
<span id="cb258-30"><a href="chm-raster-resolution-testing.html#cb258-30" tabindex="-1"></a>        <span class="at">ordered =</span> T</span>
<span id="cb258-31"><a href="chm-raster-resolution-testing.html#cb258-31" tabindex="-1"></a>        , <span class="at">levels =</span> <span class="fu">c</span>(</span>
<span id="cb258-32"><a href="chm-raster-resolution-testing.html#cb258-32" tabindex="-1"></a>          <span class="st">&quot;volume&quot;</span></span>
<span id="cb258-33"><a href="chm-raster-resolution-testing.html#cb258-33" tabindex="-1"></a>          , <span class="st">&quot;paraboloid_volume&quot;</span></span>
<span id="cb258-34"><a href="chm-raster-resolution-testing.html#cb258-34" tabindex="-1"></a>          , <span class="st">&quot;area&quot;</span></span>
<span id="cb258-35"><a href="chm-raster-resolution-testing.html#cb258-35" tabindex="-1"></a>          , <span class="st">&quot;height&quot;</span></span>
<span id="cb258-36"><a href="chm-raster-resolution-testing.html#cb258-36" tabindex="-1"></a>          , <span class="st">&quot;diameter&quot;</span></span>
<span id="cb258-37"><a href="chm-raster-resolution-testing.html#cb258-37" tabindex="-1"></a>          , <span class="st">&quot;recall&quot;</span></span>
<span id="cb258-38"><a href="chm-raster-resolution-testing.html#cb258-38" tabindex="-1"></a>          , <span class="st">&quot;precision&quot;</span></span>
<span id="cb258-39"><a href="chm-raster-resolution-testing.html#cb258-39" tabindex="-1"></a>        )</span>
<span id="cb258-40"><a href="chm-raster-resolution-testing.html#cb258-40" tabindex="-1"></a>        , <span class="at">labels =</span> <span class="fu">c</span>(</span>
<span id="cb258-41"><a href="chm-raster-resolution-testing.html#cb258-41" tabindex="-1"></a>          <span class="st">&quot;Volume&quot;</span></span>
<span id="cb258-42"><a href="chm-raster-resolution-testing.html#cb258-42" tabindex="-1"></a>          , <span class="st">&quot;Volume paraboloid&quot;</span></span>
<span id="cb258-43"><a href="chm-raster-resolution-testing.html#cb258-43" tabindex="-1"></a>          , <span class="st">&quot;Area&quot;</span></span>
<span id="cb258-44"><a href="chm-raster-resolution-testing.html#cb258-44" tabindex="-1"></a>          , <span class="st">&quot;Height&quot;</span></span>
<span id="cb258-45"><a href="chm-raster-resolution-testing.html#cb258-45" tabindex="-1"></a>          , <span class="st">&quot;Diameter&quot;</span></span>
<span id="cb258-46"><a href="chm-raster-resolution-testing.html#cb258-46" tabindex="-1"></a>          , <span class="st">&quot;Recall&quot;</span></span>
<span id="cb258-47"><a href="chm-raster-resolution-testing.html#cb258-47" tabindex="-1"></a>          , <span class="st">&quot;Precision&quot;</span></span>
<span id="cb258-48"><a href="chm-raster-resolution-testing.html#cb258-48" tabindex="-1"></a>        )</span>
<span id="cb258-49"><a href="chm-raster-resolution-testing.html#cb258-49" tabindex="-1"></a>      )</span>
<span id="cb258-50"><a href="chm-raster-resolution-testing.html#cb258-50" tabindex="-1"></a>    , <span class="at">color_metric =</span> <span class="fu">ifelse</span>(is_final_selection, pile_metric, <span class="cn">NA</span>) <span class="sc">%&gt;%</span> <span class="fu">factor</span>()</span>
<span id="cb258-51"><a href="chm-raster-resolution-testing.html#cb258-51" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb258-52"><a href="chm-raster-resolution-testing.html#cb258-52" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(is_final_selection) <span class="sc">%&gt;%</span> </span>
<span id="cb258-53"><a href="chm-raster-resolution-testing.html#cb258-53" tabindex="-1"></a>  <span class="co"># plot</span></span>
<span id="cb258-54"><a href="chm-raster-resolution-testing.html#cb258-54" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> f_score, <span class="at">y =</span> value, <span class="at">color =</span> color_metric)) <span class="sc">+</span></span>
<span id="cb258-55"><a href="chm-raster-resolution-testing.html#cb258-55" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb258-56"><a href="chm-raster-resolution-testing.html#cb258-56" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">facet_wrap</span>(<span class="at">facets =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(pile_metric)) <span class="sc">+</span></span>
<span id="cb258-57"><a href="chm-raster-resolution-testing.html#cb258-57" tabindex="-1"></a>  harrypotter<span class="sc">::</span><span class="fu">scale_color_hp_d</span>(<span class="at">option =</span> <span class="st">&quot;hermionegranger&quot;</span>, <span class="at">na.value =</span> <span class="st">&quot;gray88&quot;</span>) <span class="sc">+</span></span>
<span id="cb258-58"><a href="chm-raster-resolution-testing.html#cb258-58" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_x_continuous</span>(</span>
<span id="cb258-59"><a href="chm-raster-resolution-testing.html#cb258-59" tabindex="-1"></a>    <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">percent_format</span>(<span class="at">accuracy =</span> <span class="dv">1</span>)</span>
<span id="cb258-60"><a href="chm-raster-resolution-testing.html#cb258-60" tabindex="-1"></a>    , <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)</span>
<span id="cb258-61"><a href="chm-raster-resolution-testing.html#cb258-61" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb258-62"><a href="chm-raster-resolution-testing.html#cb258-62" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_y_continuous</span>(</span>
<span id="cb258-63"><a href="chm-raster-resolution-testing.html#cb258-63" tabindex="-1"></a>    <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">percent_format</span>(<span class="at">accuracy =</span> <span class="dv">1</span>)</span>
<span id="cb258-64"><a href="chm-raster-resolution-testing.html#cb258-64" tabindex="-1"></a>    , <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="cn">NA</span>)</span>
<span id="cb258-65"><a href="chm-raster-resolution-testing.html#cb258-65" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb258-66"><a href="chm-raster-resolution-testing.html#cb258-66" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;F-Score&quot;</span>, <span class="at">y =</span> <span class="st">&quot;MAPE&quot;</span>, <span class="at">caption =</span> <span class="st">&quot;*records in gray not selected&quot;</span>) <span class="sc">+</span></span>
<span id="cb258-67"><a href="chm-raster-resolution-testing.html#cb258-67" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb258-68"><a href="chm-raster-resolution-testing.html#cb258-68" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb258-69"><a href="chm-raster-resolution-testing.html#cb258-69" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb258-70"><a href="chm-raster-resolution-testing.html#cb258-70" tabindex="-1"></a>    , <span class="at">strip.text =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb258-71"><a href="chm-raster-resolution-testing.html#cb258-71" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-224-1.png" width="1008" /></p>
<p><em>WHAT DID WE LEARN FROM THIS</em></p>
</div>
</div>
<div id="by-chm-resolution" class="section level4 hasAnchor" number="8.5.3.2">
<h4><span class="header-section-number">8.5.3.2</span> by CHM resolution<a href="chm-raster-resolution-testing.html#by-chm-resolution" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>To select the best-performing parameter combinations, we will prioritize those that balance detection and quantification accuracy. From this group, we will then identify the settings that achieve the highest pile detection rates (recall). These recommendations are for users who are working with a CHM with a resolution in the range of those tested for this analysis or can aggregate (i.e. make more coarse) a CHM to a resolution tested for the purpose of either improving processing performance or enhancing pile detection and/or quantification accuracy based on the results shown here</p>
<p>we already created this data above (<code>param_combos_ranked</code>) using the F-Score and the average rank of the MAPE metrics across all form measurements (i.e. height, diameter, area, volume) to determine the best overall list by CHM resolution</p>
<div id="top-2.0" class="section level5 hasAnchor" number="8.5.3.2.1">
<h5><span class="header-section-number">8.5.3.2.1</span> Top 2.0%<a href="chm-raster-resolution-testing.html#top-2.0" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>let’s check out the parameter settings of the top 2.0% (n=23) from all 1,176 combinations tested by CHM resolution. these are “votes” for the parameter setting based on the combinations that achieved the best balance between both detection and quantification accuracy.</p>
<div class="sourceCode" id="cb259"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb259-1"><a href="chm-raster-resolution-testing.html#cb259-1" tabindex="-1"></a>param_combos_ranked <span class="sc">%&gt;%</span></span>
<span id="cb259-2"><a href="chm-raster-resolution-testing.html#cb259-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(is_top_chm) <span class="sc">%&gt;%</span> </span>
<span id="cb259-3"><a href="chm-raster-resolution-testing.html#cb259-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;f_score&quot;</span>), max_ht_m,max_area_m2,convexity_pct,circle_fit_iou_pct,chm_res_m,chm_res_m_desc) <span class="sc">%&gt;%</span> </span>
<span id="cb259-4"><a href="chm-raster-resolution-testing.html#cb259-4" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(</span>
<span id="cb259-5"><a href="chm-raster-resolution-testing.html#cb259-5" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">c</span>(max_ht_m,max_area_m2,convexity_pct,circle_fit_iou_pct)</span>
<span id="cb259-6"><a href="chm-raster-resolution-testing.html#cb259-6" tabindex="-1"></a>    , <span class="at">names_to =</span> <span class="st">&quot;metric&quot;</span></span>
<span id="cb259-7"><a href="chm-raster-resolution-testing.html#cb259-7" tabindex="-1"></a>    , <span class="at">values_to =</span> <span class="st">&quot;value&quot;</span></span>
<span id="cb259-8"><a href="chm-raster-resolution-testing.html#cb259-8" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb259-9"><a href="chm-raster-resolution-testing.html#cb259-9" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">count</span>(chm_res_m,chm_res_m_desc, metric, value) <span class="sc">%&gt;%</span> </span>
<span id="cb259-10"><a href="chm-raster-resolution-testing.html#cb259-10" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(chm_res_m,chm_res_m_desc, metric) <span class="sc">%&gt;%</span> </span>
<span id="cb259-11"><a href="chm-raster-resolution-testing.html#cb259-11" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb259-12"><a href="chm-raster-resolution-testing.html#cb259-12" tabindex="-1"></a>    <span class="at">pct=</span>n<span class="sc">/</span><span class="fu">sum</span>(n)</span>
<span id="cb259-13"><a href="chm-raster-resolution-testing.html#cb259-13" tabindex="-1"></a>    , <span class="at">lab =</span> <span class="fu">paste0</span>(scales<span class="sc">::</span><span class="fu">percent</span>(pct,<span class="at">accuracy=</span><span class="fl">0.1</span>)) <span class="co">#, &quot;\nn=&quot;, scales::comma(n,accuracy=1))</span></span>
<span id="cb259-14"><a href="chm-raster-resolution-testing.html#cb259-14" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb259-15"><a href="chm-raster-resolution-testing.html#cb259-15" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(</span>
<span id="cb259-16"><a href="chm-raster-resolution-testing.html#cb259-16" tabindex="-1"></a>    <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">factor</span>(value), <span class="at">y=</span>pct, <span class="at">label=</span>lab, <span class="at">fill =</span> metric)</span>
<span id="cb259-17"><a href="chm-raster-resolution-testing.html#cb259-17" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb259-18"><a href="chm-raster-resolution-testing.html#cb259-18" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_col</span>(<span class="at">width =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb259-19"><a href="chm-raster-resolution-testing.html#cb259-19" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_text</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">size =</span> <span class="fl">2.2</span>, <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb259-20"><a href="chm-raster-resolution-testing.html#cb259-20" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">facet_grid</span>(<span class="at">cols =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(metric), <span class="at">rows =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(chm_res_m_desc), <span class="at">scales =</span> <span class="st">&quot;free_x&quot;</span>) <span class="sc">+</span></span>
<span id="cb259-21"><a href="chm-raster-resolution-testing.html#cb259-21" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_y_continuous</span>(</span>
<span id="cb259-22"><a href="chm-raster-resolution-testing.html#cb259-22" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="at">by=</span><span class="fl">0.2</span>)</span>
<span id="cb259-23"><a href="chm-raster-resolution-testing.html#cb259-23" tabindex="-1"></a>    , <span class="at">labels =</span> scales<span class="sc">::</span>percent</span>
<span id="cb259-24"><a href="chm-raster-resolution-testing.html#cb259-24" tabindex="-1"></a>    , <span class="at">expand =</span> ggplot2<span class="sc">::</span><span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">0.2</span>))</span>
<span id="cb259-25"><a href="chm-raster-resolution-testing.html#cb259-25" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb259-26"><a href="chm-raster-resolution-testing.html#cb259-26" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_fill_manual</span>(<span class="at">values =</span> pal_param[<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>]) <span class="sc">+</span></span>
<span id="cb259-27"><a href="chm-raster-resolution-testing.html#cb259-27" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb259-28"><a href="chm-raster-resolution-testing.html#cb259-28" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;parameter setting&quot;</span>, <span class="at">y =</span> <span class="st">&quot;&quot;</span></span>
<span id="cb259-29"><a href="chm-raster-resolution-testing.html#cb259-29" tabindex="-1"></a>    , <span class="at">fill =</span> <span class="st">&quot;&quot;</span></span>
<span id="cb259-30"><a href="chm-raster-resolution-testing.html#cb259-30" tabindex="-1"></a>    , <span class="at">subtitle =</span> <span class="fu">paste0</span>(</span>
<span id="cb259-31"><a href="chm-raster-resolution-testing.html#cb259-31" tabindex="-1"></a>      <span class="st">&quot;Structural Data Only&quot;</span></span>
<span id="cb259-32"><a href="chm-raster-resolution-testing.html#cb259-32" tabindex="-1"></a>       , <span class="st">&quot;</span><span class="sc">\n</span><span class="st">parameter settings of top &quot;</span></span>
<span id="cb259-33"><a href="chm-raster-resolution-testing.html#cb259-33" tabindex="-1"></a>       , scales<span class="sc">::</span><span class="fu">percent</span>(pct_th_top_chm,<span class="at">accuracy=</span><span class="fl">0.1</span>)</span>
<span id="cb259-34"><a href="chm-raster-resolution-testing.html#cb259-34" tabindex="-1"></a>       , <span class="st">&quot; (n=&quot;</span></span>
<span id="cb259-35"><a href="chm-raster-resolution-testing.html#cb259-35" tabindex="-1"></a>       , scales<span class="sc">::</span><span class="fu">comma</span>(n_combos_top_chm , <span class="at">accuracy =</span> <span class="dv">1</span>)</span>
<span id="cb259-36"><a href="chm-raster-resolution-testing.html#cb259-36" tabindex="-1"></a>       , <span class="st">&quot;) &quot;</span></span>
<span id="cb259-37"><a href="chm-raster-resolution-testing.html#cb259-37" tabindex="-1"></a>       , <span class="st">&quot;parameter combinations by CHM resolution</span><span class="sc">\n</span><span class="st">based on both detection and quantification accuracy&quot;</span></span>
<span id="cb259-38"><a href="chm-raster-resolution-testing.html#cb259-38" tabindex="-1"></a>    )</span>
<span id="cb259-39"><a href="chm-raster-resolution-testing.html#cb259-39" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb259-40"><a href="chm-raster-resolution-testing.html#cb259-40" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb259-41"><a href="chm-raster-resolution-testing.html#cb259-41" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb259-42"><a href="chm-raster-resolution-testing.html#cb259-42" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb259-43"><a href="chm-raster-resolution-testing.html#cb259-43" tabindex="-1"></a>    , <span class="at">strip.text.x =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb259-44"><a href="chm-raster-resolution-testing.html#cb259-44" tabindex="-1"></a>    , <span class="at">strip.text.y =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">9</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb259-45"><a href="chm-raster-resolution-testing.html#cb259-45" tabindex="-1"></a>    , <span class="at">axis.text.y =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">6</span>)</span>
<span id="cb259-46"><a href="chm-raster-resolution-testing.html#cb259-46" tabindex="-1"></a>    , <span class="at">axis.text.x =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>)</span>
<span id="cb259-47"><a href="chm-raster-resolution-testing.html#cb259-47" tabindex="-1"></a>    , <span class="at">plot.subtitle =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>)</span>
<span id="cb259-48"><a href="chm-raster-resolution-testing.html#cb259-48" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-226-1.png" width="1008" /></p>
<p>what is the expected <em>detection</em> accuracy of the top 2.0% (n=23) combinations tested by CHM resolution?</p>
<div class="sourceCode" id="cb260"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb260-1"><a href="chm-raster-resolution-testing.html#cb260-1" tabindex="-1"></a><span class="fu">plt_detection_dist2</span>(</span>
<span id="cb260-2"><a href="chm-raster-resolution-testing.html#cb260-2" tabindex="-1"></a>  <span class="at">df =</span> param_combos_ranked <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(is_top_chm) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">!</span>tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;_pct_rank_&quot;</span>))</span>
<span id="cb260-3"><a href="chm-raster-resolution-testing.html#cb260-3" tabindex="-1"></a>  , <span class="fu">paste0</span>(</span>
<span id="cb260-4"><a href="chm-raster-resolution-testing.html#cb260-4" tabindex="-1"></a>    <span class="st">&quot;Structural Data Only&quot;</span></span>
<span id="cb260-5"><a href="chm-raster-resolution-testing.html#cb260-5" tabindex="-1"></a>    , <span class="st">&quot;</span><span class="sc">\n</span><span class="st">distribution of evaluation metrics for top &quot;</span></span>
<span id="cb260-6"><a href="chm-raster-resolution-testing.html#cb260-6" tabindex="-1"></a>    , scales<span class="sc">::</span><span class="fu">percent</span>(pct_th_top_chm,<span class="at">accuracy=</span><span class="fl">0.1</span>)</span>
<span id="cb260-7"><a href="chm-raster-resolution-testing.html#cb260-7" tabindex="-1"></a>    , <span class="st">&quot; (n=&quot;</span></span>
<span id="cb260-8"><a href="chm-raster-resolution-testing.html#cb260-8" tabindex="-1"></a>    , scales<span class="sc">::</span><span class="fu">comma</span>(n_combos_top_chm, <span class="at">accuracy=</span><span class="dv">1</span>)</span>
<span id="cb260-9"><a href="chm-raster-resolution-testing.html#cb260-9" tabindex="-1"></a>    , <span class="st">&quot;) &quot;</span></span>
<span id="cb260-10"><a href="chm-raster-resolution-testing.html#cb260-10" tabindex="-1"></a>    , <span class="st">&quot;parameter combinations by CHM resolution</span><span class="sc">\n</span><span class="st">based on both detection and quantification accuracy&quot;</span></span>
<span id="cb260-11"><a href="chm-raster-resolution-testing.html#cb260-11" tabindex="-1"></a>  )</span>
<span id="cb260-12"><a href="chm-raster-resolution-testing.html#cb260-12" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-227-1.png" width="1008" /></p>
<p><em>WHAT DID WE LEARN FROM THIS</em></p>
<p>what is the expected <em>MAPE</em> of the top 2.0% (n=23) combinations tested by CHM resolution?</p>
<div class="sourceCode" id="cb261"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb261-1"><a href="chm-raster-resolution-testing.html#cb261-1" tabindex="-1"></a><span class="co"># plot it</span></span>
<span id="cb261-2"><a href="chm-raster-resolution-testing.html#cb261-2" tabindex="-1"></a><span class="fu">plt_form_quantification_dist2</span>(</span>
<span id="cb261-3"><a href="chm-raster-resolution-testing.html#cb261-3" tabindex="-1"></a>  <span class="at">df =</span> param_combos_ranked <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(is_top_chm) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">!</span>tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;_pct_rank_&quot;</span>))</span>
<span id="cb261-4"><a href="chm-raster-resolution-testing.html#cb261-4" tabindex="-1"></a>  , <span class="at">quant_metric =</span> <span class="st">&quot;mape&quot;</span></span>
<span id="cb261-5"><a href="chm-raster-resolution-testing.html#cb261-5" tabindex="-1"></a>  , <span class="fu">paste0</span>(</span>
<span id="cb261-6"><a href="chm-raster-resolution-testing.html#cb261-6" tabindex="-1"></a>    <span class="st">&quot;Structural Data Only&quot;</span></span>
<span id="cb261-7"><a href="chm-raster-resolution-testing.html#cb261-7" tabindex="-1"></a>    , <span class="st">&quot;</span><span class="sc">\n</span><span class="st">distribution of pile form quantification metrics for the top &quot;</span></span>
<span id="cb261-8"><a href="chm-raster-resolution-testing.html#cb261-8" tabindex="-1"></a>    , scales<span class="sc">::</span><span class="fu">percent</span>(pct_th_top_chm,<span class="at">accuracy=</span><span class="fl">0.1</span>)</span>
<span id="cb261-9"><a href="chm-raster-resolution-testing.html#cb261-9" tabindex="-1"></a>    , <span class="st">&quot; (n=&quot;</span></span>
<span id="cb261-10"><a href="chm-raster-resolution-testing.html#cb261-10" tabindex="-1"></a>    , scales<span class="sc">::</span><span class="fu">comma</span>(n_combos_top_chm, <span class="at">accuracy=</span><span class="dv">1</span>)</span>
<span id="cb261-11"><a href="chm-raster-resolution-testing.html#cb261-11" tabindex="-1"></a>    , <span class="st">&quot;) &quot;</span></span>
<span id="cb261-12"><a href="chm-raster-resolution-testing.html#cb261-12" tabindex="-1"></a>    , <span class="st">&quot;parameter combinations by CHM resolution</span><span class="sc">\n</span><span class="st">based on both detection and quantification accuracy&quot;</span></span>
<span id="cb261-13"><a href="chm-raster-resolution-testing.html#cb261-13" tabindex="-1"></a>  )</span>
<span id="cb261-14"><a href="chm-raster-resolution-testing.html#cb261-14" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-228-1.png" width="1008" /></p>
<p><em>WHAT DID WE LEARN FROM THIS</em></p>
<p>what is the expected <em>Mean Error (ME)</em> of the top 2.0% (n=23) combinations tested by CHM resolution?</p>
<div class="sourceCode" id="cb262"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb262-1"><a href="chm-raster-resolution-testing.html#cb262-1" tabindex="-1"></a><span class="co"># plot it</span></span>
<span id="cb262-2"><a href="chm-raster-resolution-testing.html#cb262-2" tabindex="-1"></a><span class="fu">plt_form_quantification_dist2</span>(</span>
<span id="cb262-3"><a href="chm-raster-resolution-testing.html#cb262-3" tabindex="-1"></a>  <span class="at">df =</span> param_combos_ranked <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(is_top_chm) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">!</span>tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;_pct_rank_&quot;</span>))</span>
<span id="cb262-4"><a href="chm-raster-resolution-testing.html#cb262-4" tabindex="-1"></a>  , <span class="at">quant_metric =</span> <span class="st">&quot;mean&quot;</span></span>
<span id="cb262-5"><a href="chm-raster-resolution-testing.html#cb262-5" tabindex="-1"></a>  , <span class="fu">paste0</span>(</span>
<span id="cb262-6"><a href="chm-raster-resolution-testing.html#cb262-6" tabindex="-1"></a>    <span class="st">&quot;Structural Data Only&quot;</span></span>
<span id="cb262-7"><a href="chm-raster-resolution-testing.html#cb262-7" tabindex="-1"></a>    , <span class="st">&quot;</span><span class="sc">\n</span><span class="st">distribution of pile form quantification metrics for the top &quot;</span></span>
<span id="cb262-8"><a href="chm-raster-resolution-testing.html#cb262-8" tabindex="-1"></a>    , scales<span class="sc">::</span><span class="fu">percent</span>(pct_th_top_chm,<span class="at">accuracy=</span><span class="fl">0.1</span>)</span>
<span id="cb262-9"><a href="chm-raster-resolution-testing.html#cb262-9" tabindex="-1"></a>    , <span class="st">&quot; (n=&quot;</span></span>
<span id="cb262-10"><a href="chm-raster-resolution-testing.html#cb262-10" tabindex="-1"></a>    , scales<span class="sc">::</span><span class="fu">comma</span>(n_combos_top_chm, <span class="at">accuracy=</span><span class="dv">1</span>)</span>
<span id="cb262-11"><a href="chm-raster-resolution-testing.html#cb262-11" tabindex="-1"></a>    , <span class="st">&quot;) &quot;</span></span>
<span id="cb262-12"><a href="chm-raster-resolution-testing.html#cb262-12" tabindex="-1"></a>    , <span class="st">&quot;parameter combinations by CHM resolution</span><span class="sc">\n</span><span class="st">based on both detection and quantification accuracy&quot;</span></span>
<span id="cb262-13"><a href="chm-raster-resolution-testing.html#cb262-13" tabindex="-1"></a>  )</span>
<span id="cb262-14"><a href="chm-raster-resolution-testing.html#cb262-14" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-229-1.png" width="1008" /></p>
<p><em>WHAT DID WE LEARN FROM THIS</em></p>
<p>what is the expected <em>RMSE</em> of the top 2.0% (n=23) combinations tested by CHM resolution?</p>
<div class="sourceCode" id="cb263"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb263-1"><a href="chm-raster-resolution-testing.html#cb263-1" tabindex="-1"></a><span class="co"># plot it</span></span>
<span id="cb263-2"><a href="chm-raster-resolution-testing.html#cb263-2" tabindex="-1"></a><span class="fu">plt_form_quantification_dist2</span>(</span>
<span id="cb263-3"><a href="chm-raster-resolution-testing.html#cb263-3" tabindex="-1"></a>  <span class="at">df =</span> param_combos_ranked <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(is_top_chm) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">!</span>tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;_pct_rank_&quot;</span>))</span>
<span id="cb263-4"><a href="chm-raster-resolution-testing.html#cb263-4" tabindex="-1"></a>  , <span class="at">quant_metric =</span> <span class="st">&quot;rmse&quot;</span></span>
<span id="cb263-5"><a href="chm-raster-resolution-testing.html#cb263-5" tabindex="-1"></a>  , <span class="fu">paste0</span>(</span>
<span id="cb263-6"><a href="chm-raster-resolution-testing.html#cb263-6" tabindex="-1"></a>    <span class="st">&quot;Structural Data Only&quot;</span></span>
<span id="cb263-7"><a href="chm-raster-resolution-testing.html#cb263-7" tabindex="-1"></a>    , <span class="st">&quot;</span><span class="sc">\n</span><span class="st">distribution of pile form quantification metrics for the top &quot;</span></span>
<span id="cb263-8"><a href="chm-raster-resolution-testing.html#cb263-8" tabindex="-1"></a>    , scales<span class="sc">::</span><span class="fu">percent</span>(pct_th_top_chm,<span class="at">accuracy=</span><span class="fl">0.1</span>)</span>
<span id="cb263-9"><a href="chm-raster-resolution-testing.html#cb263-9" tabindex="-1"></a>    , <span class="st">&quot; (n=&quot;</span></span>
<span id="cb263-10"><a href="chm-raster-resolution-testing.html#cb263-10" tabindex="-1"></a>    , scales<span class="sc">::</span><span class="fu">comma</span>(n_combos_top_chm, <span class="at">accuracy=</span><span class="dv">1</span>)</span>
<span id="cb263-11"><a href="chm-raster-resolution-testing.html#cb263-11" tabindex="-1"></a>    , <span class="st">&quot;) &quot;</span></span>
<span id="cb263-12"><a href="chm-raster-resolution-testing.html#cb263-12" tabindex="-1"></a>    , <span class="st">&quot;parameter combinations by CHM resolution</span><span class="sc">\n</span><span class="st">based on both detection and quantification accuracy&quot;</span></span>
<span id="cb263-13"><a href="chm-raster-resolution-testing.html#cb263-13" tabindex="-1"></a>  )</span>
<span id="cb263-14"><a href="chm-raster-resolution-testing.html#cb263-14" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-230-1.png" width="1008" /></p>
<p><em>WHAT DID WE LEARN FROM THIS</em></p>
</div>
<div id="final-6-recommended-settings" class="section level5 hasAnchor" number="8.5.3.2.2">
<h5><span class="header-section-number">8.5.3.2.2</span> Final 6 recommended settings<a href="chm-raster-resolution-testing.html#final-6-recommended-settings" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<div class="sourceCode" id="cb264"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb264-1"><a href="chm-raster-resolution-testing.html#cb264-1" tabindex="-1"></a><span class="co"># pal_temp %&gt;% scales::show_col()</span></span>
<span id="cb264-2"><a href="chm-raster-resolution-testing.html#cb264-2" tabindex="-1"></a><span class="co"># filter and reshape</span></span>
<span id="cb264-3"><a href="chm-raster-resolution-testing.html#cb264-3" tabindex="-1"></a>param_combos_ranked <span class="sc">%&gt;%</span> </span>
<span id="cb264-4"><a href="chm-raster-resolution-testing.html#cb264-4" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(is_final_selection_chm) <span class="sc">%&gt;%</span> </span>
<span id="cb264-5"><a href="chm-raster-resolution-testing.html#cb264-5" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">!</span>tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;_pct_rank_&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb264-6"><a href="chm-raster-resolution-testing.html#cb264-6" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb264-7"><a href="chm-raster-resolution-testing.html#cb264-7" tabindex="-1"></a>    max_ht_m,max_area_m2,convexity_pct,circle_fit_iou_pct,chm_res_m,chm_res_m_desc</span>
<span id="cb264-8"><a href="chm-raster-resolution-testing.html#cb264-8" tabindex="-1"></a>    , chm_lab</span>
<span id="cb264-9"><a href="chm-raster-resolution-testing.html#cb264-9" tabindex="-1"></a>    <span class="co"># detection</span></span>
<span id="cb264-10"><a href="chm-raster-resolution-testing.html#cb264-10" tabindex="-1"></a>    , f_score, recall, precision</span>
<span id="cb264-11"><a href="chm-raster-resolution-testing.html#cb264-11" tabindex="-1"></a>    <span class="co"># quantification</span></span>
<span id="cb264-12"><a href="chm-raster-resolution-testing.html#cb264-12" tabindex="-1"></a>    , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_rmse&quot;</span>)</span>
<span id="cb264-13"><a href="chm-raster-resolution-testing.html#cb264-13" tabindex="-1"></a>    , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_rrmse&quot;</span>)</span>
<span id="cb264-14"><a href="chm-raster-resolution-testing.html#cb264-14" tabindex="-1"></a>    , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_mean&quot;</span>)</span>
<span id="cb264-15"><a href="chm-raster-resolution-testing.html#cb264-15" tabindex="-1"></a>    , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_mape&quot;</span>)</span>
<span id="cb264-16"><a href="chm-raster-resolution-testing.html#cb264-16" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb264-17"><a href="chm-raster-resolution-testing.html#cb264-17" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(</span>
<span id="cb264-18"><a href="chm-raster-resolution-testing.html#cb264-18" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">c</span>(</span>
<span id="cb264-19"><a href="chm-raster-resolution-testing.html#cb264-19" tabindex="-1"></a>      f_score, recall, precision</span>
<span id="cb264-20"><a href="chm-raster-resolution-testing.html#cb264-20" tabindex="-1"></a>      , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_rmse&quot;</span>)</span>
<span id="cb264-21"><a href="chm-raster-resolution-testing.html#cb264-21" tabindex="-1"></a>      , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_rrmse&quot;</span>)</span>
<span id="cb264-22"><a href="chm-raster-resolution-testing.html#cb264-22" tabindex="-1"></a>      , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_mean&quot;</span>)</span>
<span id="cb264-23"><a href="chm-raster-resolution-testing.html#cb264-23" tabindex="-1"></a>      , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_mape&quot;</span>)</span>
<span id="cb264-24"><a href="chm-raster-resolution-testing.html#cb264-24" tabindex="-1"></a>    )</span>
<span id="cb264-25"><a href="chm-raster-resolution-testing.html#cb264-25" tabindex="-1"></a>    , <span class="at">names_to =</span> <span class="st">&quot;metric&quot;</span></span>
<span id="cb264-26"><a href="chm-raster-resolution-testing.html#cb264-26" tabindex="-1"></a>    , <span class="at">values_to =</span> <span class="st">&quot;value&quot;</span></span>
<span id="cb264-27"><a href="chm-raster-resolution-testing.html#cb264-27" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb264-28"><a href="chm-raster-resolution-testing.html#cb264-28" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb264-29"><a href="chm-raster-resolution-testing.html#cb264-29" tabindex="-1"></a>    <span class="at">eval_metric =</span> stringr<span class="sc">::</span><span class="fu">str_extract</span>(metric, <span class="st">&quot;(_rmse|_rrmse|_mean|_mape|f_score|recall|precision)$&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb264-30"><a href="chm-raster-resolution-testing.html#cb264-30" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_remove_all</span>(<span class="st">&quot;_&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb264-31"><a href="chm-raster-resolution-testing.html#cb264-31" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_replace_all</span>(<span class="st">&quot;mean&quot;</span>,<span class="st">&quot;me&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb264-32"><a href="chm-raster-resolution-testing.html#cb264-32" tabindex="-1"></a>      <span class="fu">toupper</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb264-33"><a href="chm-raster-resolution-testing.html#cb264-33" tabindex="-1"></a>      <span class="fu">factor</span>(</span>
<span id="cb264-34"><a href="chm-raster-resolution-testing.html#cb264-34" tabindex="-1"></a>        <span class="at">ordered =</span> T</span>
<span id="cb264-35"><a href="chm-raster-resolution-testing.html#cb264-35" tabindex="-1"></a>        , <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;FSCORE&quot;</span>,<span class="st">&quot;RECALL&quot;</span>,<span class="st">&quot;PRECISION&quot;</span>, <span class="st">&quot;ME&quot;</span>,<span class="st">&quot;RMSE&quot;</span>,<span class="st">&quot;RRMSE&quot;</span>,<span class="st">&quot;MAPE&quot;</span>)</span>
<span id="cb264-36"><a href="chm-raster-resolution-testing.html#cb264-36" tabindex="-1"></a>        , <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;F-score&quot;</span>,<span class="st">&quot;Recall&quot;</span>,<span class="st">&quot;Precision&quot;</span>, <span class="st">&quot;ME&quot;</span>,<span class="st">&quot;RMSE&quot;</span>,<span class="st">&quot;RRMSE&quot;</span>,<span class="st">&quot;MAPE&quot;</span>)</span>
<span id="cb264-37"><a href="chm-raster-resolution-testing.html#cb264-37" tabindex="-1"></a>      )</span>
<span id="cb264-38"><a href="chm-raster-resolution-testing.html#cb264-38" tabindex="-1"></a>    , <span class="at">pile_metric =</span> metric <span class="sc">%&gt;%</span> </span>
<span id="cb264-39"><a href="chm-raster-resolution-testing.html#cb264-39" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_remove</span>(<span class="st">&quot;(_rmse|_rrmse|_mean|_mape)$&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb264-40"><a href="chm-raster-resolution-testing.html#cb264-40" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_extract</span>(<span class="st">&quot;(paraboloid_volume|volume|area|height|diameter)&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb264-41"><a href="chm-raster-resolution-testing.html#cb264-41" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">coalesce</span>(<span class="st">&quot;detection&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb264-42"><a href="chm-raster-resolution-testing.html#cb264-42" tabindex="-1"></a>      <span class="fu">factor</span>(</span>
<span id="cb264-43"><a href="chm-raster-resolution-testing.html#cb264-43" tabindex="-1"></a>        <span class="at">ordered =</span> T</span>
<span id="cb264-44"><a href="chm-raster-resolution-testing.html#cb264-44" tabindex="-1"></a>        , <span class="at">levels =</span> <span class="fu">c</span>(</span>
<span id="cb264-45"><a href="chm-raster-resolution-testing.html#cb264-45" tabindex="-1"></a>          <span class="st">&quot;detection&quot;</span></span>
<span id="cb264-46"><a href="chm-raster-resolution-testing.html#cb264-46" tabindex="-1"></a>          , <span class="st">&quot;volume&quot;</span></span>
<span id="cb264-47"><a href="chm-raster-resolution-testing.html#cb264-47" tabindex="-1"></a>          , <span class="st">&quot;paraboloid_volume&quot;</span></span>
<span id="cb264-48"><a href="chm-raster-resolution-testing.html#cb264-48" tabindex="-1"></a>          , <span class="st">&quot;area&quot;</span></span>
<span id="cb264-49"><a href="chm-raster-resolution-testing.html#cb264-49" tabindex="-1"></a>          , <span class="st">&quot;height&quot;</span></span>
<span id="cb264-50"><a href="chm-raster-resolution-testing.html#cb264-50" tabindex="-1"></a>          , <span class="st">&quot;diameter&quot;</span></span>
<span id="cb264-51"><a href="chm-raster-resolution-testing.html#cb264-51" tabindex="-1"></a>        )</span>
<span id="cb264-52"><a href="chm-raster-resolution-testing.html#cb264-52" tabindex="-1"></a>        , <span class="at">labels =</span> <span class="fu">c</span>(</span>
<span id="cb264-53"><a href="chm-raster-resolution-testing.html#cb264-53" tabindex="-1"></a>          <span class="st">&quot;Detection&quot;</span></span>
<span id="cb264-54"><a href="chm-raster-resolution-testing.html#cb264-54" tabindex="-1"></a>          , <span class="st">&quot;Volume&quot;</span></span>
<span id="cb264-55"><a href="chm-raster-resolution-testing.html#cb264-55" tabindex="-1"></a>          , <span class="st">&quot;Volume paraboloid&quot;</span></span>
<span id="cb264-56"><a href="chm-raster-resolution-testing.html#cb264-56" tabindex="-1"></a>          , <span class="st">&quot;Area&quot;</span></span>
<span id="cb264-57"><a href="chm-raster-resolution-testing.html#cb264-57" tabindex="-1"></a>          , <span class="st">&quot;Height&quot;</span></span>
<span id="cb264-58"><a href="chm-raster-resolution-testing.html#cb264-58" tabindex="-1"></a>          , <span class="st">&quot;Diameter&quot;</span></span>
<span id="cb264-59"><a href="chm-raster-resolution-testing.html#cb264-59" tabindex="-1"></a>        )</span>
<span id="cb264-60"><a href="chm-raster-resolution-testing.html#cb264-60" tabindex="-1"></a>      )</span>
<span id="cb264-61"><a href="chm-raster-resolution-testing.html#cb264-61" tabindex="-1"></a>    , <span class="at">value_lab =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb264-62"><a href="chm-raster-resolution-testing.html#cb264-62" tabindex="-1"></a>        eval_metric <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;F-score&quot;</span>,<span class="st">&quot;Recall&quot;</span>,<span class="st">&quot;Precision&quot;</span>, <span class="st">&quot;RRMSE&quot;</span>, <span class="st">&quot;MAPE&quot;</span>) <span class="sc">~</span> scales<span class="sc">::</span><span class="fu">percent</span>(value,<span class="at">accuracy=</span><span class="fl">0.1</span>)</span>
<span id="cb264-63"><a href="chm-raster-resolution-testing.html#cb264-63" tabindex="-1"></a>        , eval_metric <span class="sc">==</span> <span class="st">&quot;ME&quot;</span> <span class="sc">~</span> scales<span class="sc">::</span><span class="fu">comma</span>(value,<span class="at">accuracy=</span><span class="fl">0.01</span>)</span>
<span id="cb264-64"><a href="chm-raster-resolution-testing.html#cb264-64" tabindex="-1"></a>        , T <span class="sc">~</span> scales<span class="sc">::</span><span class="fu">comma</span>(value,<span class="at">accuracy=</span><span class="fl">0.1</span>)</span>
<span id="cb264-65"><a href="chm-raster-resolution-testing.html#cb264-65" tabindex="-1"></a>      )</span>
<span id="cb264-66"><a href="chm-raster-resolution-testing.html#cb264-66" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb264-67"><a href="chm-raster-resolution-testing.html#cb264-67" tabindex="-1"></a>  <span class="co"># make var for color</span></span>
<span id="cb264-68"><a href="chm-raster-resolution-testing.html#cb264-68" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(chm_res_m,chm_res_m_desc, pile_metric, eval_metric) <span class="sc">%&gt;%</span> </span>
<span id="cb264-69"><a href="chm-raster-resolution-testing.html#cb264-69" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb264-70"><a href="chm-raster-resolution-testing.html#cb264-70" tabindex="-1"></a>    <span class="co"># for ME, color by abs...for f-score,recall,precision color by -value so that higher means better...</span></span>
<span id="cb264-71"><a href="chm-raster-resolution-testing.html#cb264-71" tabindex="-1"></a>      <span class="co"># ...since higher means worse for quantification accuracy metrics</span></span>
<span id="cb264-72"><a href="chm-raster-resolution-testing.html#cb264-72" tabindex="-1"></a>    <span class="at">value_dir =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb264-73"><a href="chm-raster-resolution-testing.html#cb264-73" tabindex="-1"></a>      eval_metric <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;ME&quot;</span>) <span class="sc">~</span> <span class="fu">abs</span>(value)</span>
<span id="cb264-74"><a href="chm-raster-resolution-testing.html#cb264-74" tabindex="-1"></a>      , eval_metric <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;F-score&quot;</span>,<span class="st">&quot;Recall&quot;</span>,<span class="st">&quot;Precision&quot;</span>) <span class="sc">~</span> <span class="sc">-</span>value</span>
<span id="cb264-75"><a href="chm-raster-resolution-testing.html#cb264-75" tabindex="-1"></a>      , T <span class="sc">~</span> value</span>
<span id="cb264-76"><a href="chm-raster-resolution-testing.html#cb264-76" tabindex="-1"></a>    )</span>
<span id="cb264-77"><a href="chm-raster-resolution-testing.html#cb264-77" tabindex="-1"></a>    , <span class="at">value_z =</span> (value_dir<span class="sc">-</span><span class="fu">mean</span>(value_dir,<span class="at">na.rm=</span>T))<span class="sc">/</span><span class="fu">sd</span>(value_dir,<span class="at">na.rm=</span>T) <span class="co"># this is the key to the different colors within facets</span></span>
<span id="cb264-78"><a href="chm-raster-resolution-testing.html#cb264-78" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb264-79"><a href="chm-raster-resolution-testing.html#cb264-79" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb264-80"><a href="chm-raster-resolution-testing.html#cb264-80" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span>eval_metric <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;RRMSE&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb264-81"><a href="chm-raster-resolution-testing.html#cb264-81" tabindex="-1"></a>  <span class="co"># View()</span></span>
<span id="cb264-82"><a href="chm-raster-resolution-testing.html#cb264-82" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> eval_metric, <span class="at">y =</span> chm_lab)) <span class="sc">+</span> </span>
<span id="cb264-83"><a href="chm-raster-resolution-testing.html#cb264-83" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_tile</span>(</span>
<span id="cb264-84"><a href="chm-raster-resolution-testing.html#cb264-84" tabindex="-1"></a>    <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">fill =</span> pile_metric, <span class="at">alpha =</span> <span class="sc">-</span>value_z)</span>
<span id="cb264-85"><a href="chm-raster-resolution-testing.html#cb264-85" tabindex="-1"></a>    , <span class="at">color =</span> <span class="st">&quot;gray&quot;</span></span>
<span id="cb264-86"><a href="chm-raster-resolution-testing.html#cb264-86" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb264-87"><a href="chm-raster-resolution-testing.html#cb264-87" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_text</span>(</span>
<span id="cb264-88"><a href="chm-raster-resolution-testing.html#cb264-88" tabindex="-1"></a>    <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">label =</span> value_lab, <span class="at">fontface =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb264-89"><a href="chm-raster-resolution-testing.html#cb264-89" tabindex="-1"></a>    , <span class="at">color =</span> <span class="st">&quot;white&quot;</span></span>
<span id="cb264-90"><a href="chm-raster-resolution-testing.html#cb264-90" tabindex="-1"></a>    , <span class="at">size =</span> <span class="dv">3</span></span>
<span id="cb264-91"><a href="chm-raster-resolution-testing.html#cb264-91" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb264-92"><a href="chm-raster-resolution-testing.html#cb264-92" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">facet_grid</span>(<span class="at">cols =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(pile_metric), <span class="at">rows =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(chm_res_m_desc), <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>) <span class="sc">+</span> </span>
<span id="cb264-93"><a href="chm-raster-resolution-testing.html#cb264-93" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_x_discrete</span>(<span class="at">position =</span> <span class="st">&quot;top&quot;</span>) <span class="sc">+</span></span>
<span id="cb264-94"><a href="chm-raster-resolution-testing.html#cb264-94" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;gray33&quot;</span>, harrypotter<span class="sc">::</span><span class="fu">hp</span>(<span class="at">n=</span><span class="dv">3</span>,<span class="at">option =</span> <span class="st">&quot;hermionegranger&quot;</span>) )) <span class="sc">+</span></span>
<span id="cb264-95"><a href="chm-raster-resolution-testing.html#cb264-95" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_alpha_binned</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="fl">0.55</span>, <span class="dv">1</span>)) <span class="sc">+</span> <span class="co"># this is the key to the different colors within facets</span></span>
<span id="cb264-96"><a href="chm-raster-resolution-testing.html#cb264-96" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb264-97"><a href="chm-raster-resolution-testing.html#cb264-97" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb264-98"><a href="chm-raster-resolution-testing.html#cb264-98" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;&quot;</span></span>
<span id="cb264-99"><a href="chm-raster-resolution-testing.html#cb264-99" tabindex="-1"></a>    , <span class="at">y =</span> <span class="st">&quot;max_ht_m : max_area_m2 : convexity_pct : circle_fit_iou_pct : chm_res_m&quot;</span></span>
<span id="cb264-100"><a href="chm-raster-resolution-testing.html#cb264-100" tabindex="-1"></a>    , <span class="at">subtitle =</span> <span class="fu">paste0</span>(</span>
<span id="cb264-101"><a href="chm-raster-resolution-testing.html#cb264-101" tabindex="-1"></a>       <span class="st">&quot;Structural Data Only&quot;</span></span>
<span id="cb264-102"><a href="chm-raster-resolution-testing.html#cb264-102" tabindex="-1"></a>       , <span class="st">&quot;</span><span class="sc">\n</span><span class="st">pile detection and form quantification accuracy metrics for the final recommended parameter settings&quot;</span></span>
<span id="cb264-103"><a href="chm-raster-resolution-testing.html#cb264-103" tabindex="-1"></a>       <span class="co"># , scales::percent(1-pct_rank_th_top,accuracy=1)</span></span>
<span id="cb264-104"><a href="chm-raster-resolution-testing.html#cb264-104" tabindex="-1"></a>       , <span class="st">&quot; (n=&quot;</span></span>
<span id="cb264-105"><a href="chm-raster-resolution-testing.html#cb264-105" tabindex="-1"></a>       , scales<span class="sc">::</span><span class="fu">comma</span>(n_th_top_chm,<span class="at">accuracy=</span><span class="dv">1</span>)</span>
<span id="cb264-106"><a href="chm-raster-resolution-testing.html#cb264-106" tabindex="-1"></a>       , <span class="st">&quot;) by CHM resolution&quot;</span></span>
<span id="cb264-107"><a href="chm-raster-resolution-testing.html#cb264-107" tabindex="-1"></a>       , <span class="st">&quot;</span><span class="sc">\n</span><span class="st">based on both detection and quantification accuracy&quot;</span></span>
<span id="cb264-108"><a href="chm-raster-resolution-testing.html#cb264-108" tabindex="-1"></a>      )</span>
<span id="cb264-109"><a href="chm-raster-resolution-testing.html#cb264-109" tabindex="-1"></a>    , <span class="at">caption =</span> <span class="st">&quot;*darker colors indicate relatively higher accuracy values&quot;</span></span>
<span id="cb264-110"><a href="chm-raster-resolution-testing.html#cb264-110" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb264-111"><a href="chm-raster-resolution-testing.html#cb264-111" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb264-112"><a href="chm-raster-resolution-testing.html#cb264-112" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb264-113"><a href="chm-raster-resolution-testing.html#cb264-113" tabindex="-1"></a>    , <span class="at">panel.grid =</span> ggplot2<span class="sc">::</span><span class="fu">element_blank</span>()</span>
<span id="cb264-114"><a href="chm-raster-resolution-testing.html#cb264-114" tabindex="-1"></a>    , <span class="at">strip.placement =</span> <span class="st">&quot;outside&quot;</span></span>
<span id="cb264-115"><a href="chm-raster-resolution-testing.html#cb264-115" tabindex="-1"></a>    , <span class="at">strip.text.x =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb264-116"><a href="chm-raster-resolution-testing.html#cb264-116" tabindex="-1"></a>    , <span class="at">strip.text.y =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">9</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb264-117"><a href="chm-raster-resolution-testing.html#cb264-117" tabindex="-1"></a>    , <span class="at">axis.text.x =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">7</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb264-118"><a href="chm-raster-resolution-testing.html#cb264-118" tabindex="-1"></a>    , <span class="at">axis.text.y =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">7</span>)</span>
<span id="cb264-119"><a href="chm-raster-resolution-testing.html#cb264-119" tabindex="-1"></a>    , <span class="at">axis.title.x =</span> ggplot2<span class="sc">::</span><span class="fu">element_blank</span>()</span>
<span id="cb264-120"><a href="chm-raster-resolution-testing.html#cb264-120" tabindex="-1"></a>    , <span class="at">plot.subtitle =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>)</span>
<span id="cb264-121"><a href="chm-raster-resolution-testing.html#cb264-121" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-231-1.png" width="1008" /></p>
<p>this plot allows for a simultaneous comparison of all metrics for pile detection and pile form quantification. it includes only the parameter combinations that achieved the best balanced accuracy, helping users identify the optimal settings by evaluating the trade-offs between detection and form quantification.</p>
<p>let’s table this</p>
<div class="sourceCode" id="cb265"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb265-1"><a href="chm-raster-resolution-testing.html#cb265-1" tabindex="-1"></a>param_combos_ranked <span class="sc">%&gt;%</span> </span>
<span id="cb265-2"><a href="chm-raster-resolution-testing.html#cb265-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(is_final_selection_chm) <span class="sc">%&gt;%</span> </span>
<span id="cb265-3"><a href="chm-raster-resolution-testing.html#cb265-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">!</span>tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;_pct_rank_&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb265-4"><a href="chm-raster-resolution-testing.html#cb265-4" tabindex="-1"></a>  <span class="co"># first select to arrange eval_metric</span></span>
<span id="cb265-5"><a href="chm-raster-resolution-testing.html#cb265-5" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb265-6"><a href="chm-raster-resolution-testing.html#cb265-6" tabindex="-1"></a>    chm_lab, chm_res_m_desc</span>
<span id="cb265-7"><a href="chm-raster-resolution-testing.html#cb265-7" tabindex="-1"></a>    , max_ht_m,max_area_m2,convexity_pct,circle_fit_iou_pct,chm_res_m</span>
<span id="cb265-8"><a href="chm-raster-resolution-testing.html#cb265-8" tabindex="-1"></a>    <span class="co"># detection</span></span>
<span id="cb265-9"><a href="chm-raster-resolution-testing.html#cb265-9" tabindex="-1"></a>    , f_score, recall, precision</span>
<span id="cb265-10"><a href="chm-raster-resolution-testing.html#cb265-10" tabindex="-1"></a>    <span class="co"># quantification</span></span>
<span id="cb265-11"><a href="chm-raster-resolution-testing.html#cb265-11" tabindex="-1"></a>    , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_mean&quot;</span>)</span>
<span id="cb265-12"><a href="chm-raster-resolution-testing.html#cb265-12" tabindex="-1"></a>    , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_rmse&quot;</span>)</span>
<span id="cb265-13"><a href="chm-raster-resolution-testing.html#cb265-13" tabindex="-1"></a>    <span class="co"># , tidyselect::ends_with(&quot;_rrmse&quot;)</span></span>
<span id="cb265-14"><a href="chm-raster-resolution-testing.html#cb265-14" tabindex="-1"></a>    , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_mape&quot;</span>)</span>
<span id="cb265-15"><a href="chm-raster-resolution-testing.html#cb265-15" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb265-16"><a href="chm-raster-resolution-testing.html#cb265-16" tabindex="-1"></a>  <span class="co"># second select to arrange pile_metric</span></span>
<span id="cb265-17"><a href="chm-raster-resolution-testing.html#cb265-17" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb265-18"><a href="chm-raster-resolution-testing.html#cb265-18" tabindex="-1"></a>    chm_lab, chm_res_m_desc</span>
<span id="cb265-19"><a href="chm-raster-resolution-testing.html#cb265-19" tabindex="-1"></a>    , max_ht_m,max_area_m2,convexity_pct,circle_fit_iou_pct,chm_res_m</span>
<span id="cb265-20"><a href="chm-raster-resolution-testing.html#cb265-20" tabindex="-1"></a>    <span class="co"># detection</span></span>
<span id="cb265-21"><a href="chm-raster-resolution-testing.html#cb265-21" tabindex="-1"></a>    , f_score, recall, precision</span>
<span id="cb265-22"><a href="chm-raster-resolution-testing.html#cb265-22" tabindex="-1"></a>    <span class="co"># quantification</span></span>
<span id="cb265-23"><a href="chm-raster-resolution-testing.html#cb265-23" tabindex="-1"></a>    , <span class="fu">c</span>(tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;volume&quot;</span>) <span class="sc">&amp;</span> <span class="sc">!</span>tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;paraboloid&quot;</span>))</span>
<span id="cb265-24"><a href="chm-raster-resolution-testing.html#cb265-24" tabindex="-1"></a>    , tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;area&quot;</span>)</span>
<span id="cb265-25"><a href="chm-raster-resolution-testing.html#cb265-25" tabindex="-1"></a>    , tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;height&quot;</span>)</span>
<span id="cb265-26"><a href="chm-raster-resolution-testing.html#cb265-26" tabindex="-1"></a>    , tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;diameter&quot;</span>)</span>
<span id="cb265-27"><a href="chm-raster-resolution-testing.html#cb265-27" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb265-28"><a href="chm-raster-resolution-testing.html#cb265-28" tabindex="-1"></a>  <span class="co"># names()</span></span>
<span id="cb265-29"><a href="chm-raster-resolution-testing.html#cb265-29" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb265-30"><a href="chm-raster-resolution-testing.html#cb265-30" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">across</span>(</span>
<span id="cb265-31"><a href="chm-raster-resolution-testing.html#cb265-31" tabindex="-1"></a>      <span class="at">.cols =</span> <span class="fu">c</span>(f_score, recall, precision, tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_mape&quot;</span>))</span>
<span id="cb265-32"><a href="chm-raster-resolution-testing.html#cb265-32" tabindex="-1"></a>      , <span class="at">.fn =</span> <span class="sc">~</span> scales<span class="sc">::</span><span class="fu">percent</span>(.x, <span class="at">accuracy =</span> <span class="dv">1</span>)</span>
<span id="cb265-33"><a href="chm-raster-resolution-testing.html#cb265-33" tabindex="-1"></a>    )</span>
<span id="cb265-34"><a href="chm-raster-resolution-testing.html#cb265-34" tabindex="-1"></a>    , dplyr<span class="sc">::</span><span class="fu">across</span>(</span>
<span id="cb265-35"><a href="chm-raster-resolution-testing.html#cb265-35" tabindex="-1"></a>      <span class="at">.cols =</span> <span class="fu">c</span>(tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_mean&quot;</span>))</span>
<span id="cb265-36"><a href="chm-raster-resolution-testing.html#cb265-36" tabindex="-1"></a>      , <span class="at">.fn =</span> <span class="sc">~</span> scales<span class="sc">::</span><span class="fu">comma</span>(.x, <span class="at">accuracy =</span> <span class="fl">0.01</span>)</span>
<span id="cb265-37"><a href="chm-raster-resolution-testing.html#cb265-37" tabindex="-1"></a>    )</span>
<span id="cb265-38"><a href="chm-raster-resolution-testing.html#cb265-38" tabindex="-1"></a>    , dplyr<span class="sc">::</span><span class="fu">across</span>(</span>
<span id="cb265-39"><a href="chm-raster-resolution-testing.html#cb265-39" tabindex="-1"></a>      <span class="at">.cols =</span> <span class="fu">c</span>(tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_rmse&quot;</span>))</span>
<span id="cb265-40"><a href="chm-raster-resolution-testing.html#cb265-40" tabindex="-1"></a>      , <span class="at">.fn =</span> <span class="sc">~</span> scales<span class="sc">::</span><span class="fu">comma</span>(.x, <span class="at">accuracy =</span> <span class="fl">0.1</span>)</span>
<span id="cb265-41"><a href="chm-raster-resolution-testing.html#cb265-41" tabindex="-1"></a>    )</span>
<span id="cb265-42"><a href="chm-raster-resolution-testing.html#cb265-42" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb265-43"><a href="chm-raster-resolution-testing.html#cb265-43" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">blank=</span> <span class="st">&quot;   &quot;</span> ) <span class="sc">%&gt;%</span> </span>
<span id="cb265-44"><a href="chm-raster-resolution-testing.html#cb265-44" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">relocate</span>(blank, <span class="at">.before =</span> f_score) <span class="sc">%&gt;%</span> </span>
<span id="cb265-45"><a href="chm-raster-resolution-testing.html#cb265-45" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(chm_res_m, <span class="fu">desc</span>(chm_lab)) <span class="sc">%&gt;%</span> </span>
<span id="cb265-46"><a href="chm-raster-resolution-testing.html#cb265-46" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>chm_res_m) <span class="sc">%&gt;%</span> </span>
<span id="cb265-47"><a href="chm-raster-resolution-testing.html#cb265-47" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">relocate</span>(chm_res_m_desc) <span class="sc">%&gt;%</span> </span>
<span id="cb265-48"><a href="chm-raster-resolution-testing.html#cb265-48" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kbl</span>(</span>
<span id="cb265-49"><a href="chm-raster-resolution-testing.html#cb265-49" tabindex="-1"></a>    <span class="at">caption =</span> </span>
<span id="cb265-50"><a href="chm-raster-resolution-testing.html#cb265-50" tabindex="-1"></a>      <span class="fu">paste0</span>(</span>
<span id="cb265-51"><a href="chm-raster-resolution-testing.html#cb265-51" tabindex="-1"></a>       <span class="st">&quot;Structural Data Only&quot;</span></span>
<span id="cb265-52"><a href="chm-raster-resolution-testing.html#cb265-52" tabindex="-1"></a>       , <span class="st">&quot;&lt;br&gt;pile detection and form quantification accuracy metrics for the final recommended parameter settings&quot;</span></span>
<span id="cb265-53"><a href="chm-raster-resolution-testing.html#cb265-53" tabindex="-1"></a>       <span class="co"># , scales::percent(1-pct_rank_th_top,accuracy=1)</span></span>
<span id="cb265-54"><a href="chm-raster-resolution-testing.html#cb265-54" tabindex="-1"></a>       , <span class="st">&quot; (n=&quot;</span></span>
<span id="cb265-55"><a href="chm-raster-resolution-testing.html#cb265-55" tabindex="-1"></a>       , scales<span class="sc">::</span><span class="fu">comma</span>(n_th_top_chm,<span class="at">accuracy=</span><span class="dv">1</span>)</span>
<span id="cb265-56"><a href="chm-raster-resolution-testing.html#cb265-56" tabindex="-1"></a>       , <span class="st">&quot;) by CHM resolution &quot;</span></span>
<span id="cb265-57"><a href="chm-raster-resolution-testing.html#cb265-57" tabindex="-1"></a>       , <span class="st">&quot;&lt;br&gt;based on both detection and quantification accuracy&quot;</span></span>
<span id="cb265-58"><a href="chm-raster-resolution-testing.html#cb265-58" tabindex="-1"></a>      )</span>
<span id="cb265-59"><a href="chm-raster-resolution-testing.html#cb265-59" tabindex="-1"></a>    , <span class="at">col.names =</span> <span class="fu">c</span>(</span>
<span id="cb265-60"><a href="chm-raster-resolution-testing.html#cb265-60" tabindex="-1"></a>      <span class="st">&quot;.&quot;</span>, <span class="st">&quot;&quot;</span></span>
<span id="cb265-61"><a href="chm-raster-resolution-testing.html#cb265-61" tabindex="-1"></a>      ,<span class="st">&quot;max_ht_m&quot;</span>,<span class="st">&quot;max_area_m2&quot;</span>,<span class="st">&quot;convexity_pct&quot;</span>,<span class="st">&quot;circle_fit_iou_pct&quot;</span></span>
<span id="cb265-62"><a href="chm-raster-resolution-testing.html#cb265-62" tabindex="-1"></a>      , <span class="st">&quot;   &quot;</span></span>
<span id="cb265-63"><a href="chm-raster-resolution-testing.html#cb265-63" tabindex="-1"></a>      , <span class="st">&quot;F-score&quot;</span>, <span class="st">&quot;Recall&quot;</span>, <span class="st">&quot;Precision&quot;</span></span>
<span id="cb265-64"><a href="chm-raster-resolution-testing.html#cb265-64" tabindex="-1"></a>      , <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;ME&quot;</span>,<span class="st">&quot;RMSE&quot;</span>,<span class="st">&quot;MAPE&quot;</span>), <span class="at">times =</span> <span class="dv">3</span>)</span>
<span id="cb265-65"><a href="chm-raster-resolution-testing.html#cb265-65" tabindex="-1"></a>    )</span>
<span id="cb265-66"><a href="chm-raster-resolution-testing.html#cb265-66" tabindex="-1"></a>    , <span class="at">escape =</span> F</span>
<span id="cb265-67"><a href="chm-raster-resolution-testing.html#cb265-67" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb265-68"><a href="chm-raster-resolution-testing.html#cb265-68" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kable_styling</span>(<span class="at">font_size =</span> <span class="dv">11</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb265-69"><a href="chm-raster-resolution-testing.html#cb265-69" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">add_header_above</span>(<span class="fu">c</span>(</span>
<span id="cb265-70"><a href="chm-raster-resolution-testing.html#cb265-70" tabindex="-1"></a>    <span class="st">&quot; &quot;</span><span class="ot">=</span><span class="dv">7</span></span>
<span id="cb265-71"><a href="chm-raster-resolution-testing.html#cb265-71" tabindex="-1"></a>    , <span class="st">&quot;Detection&quot;</span> <span class="ot">=</span> <span class="dv">3</span></span>
<span id="cb265-72"><a href="chm-raster-resolution-testing.html#cb265-72" tabindex="-1"></a>    <span class="co"># , &quot;Volume&quot; = 3</span></span>
<span id="cb265-73"><a href="chm-raster-resolution-testing.html#cb265-73" tabindex="-1"></a>    , <span class="st">&quot;Area&quot;</span> <span class="ot">=</span> <span class="dv">3</span></span>
<span id="cb265-74"><a href="chm-raster-resolution-testing.html#cb265-74" tabindex="-1"></a>    , <span class="st">&quot;Height&quot;</span> <span class="ot">=</span> <span class="dv">3</span></span>
<span id="cb265-75"><a href="chm-raster-resolution-testing.html#cb265-75" tabindex="-1"></a>    , <span class="st">&quot;Diameter&quot;</span> <span class="ot">=</span> <span class="dv">3</span></span>
<span id="cb265-76"><a href="chm-raster-resolution-testing.html#cb265-76" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb265-77"><a href="chm-raster-resolution-testing.html#cb265-77" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">column_spec</span>(<span class="fu">seq</span>(<span class="dv">7</span>,<span class="dv">19</span>,<span class="at">by=</span><span class="dv">3</span>), <span class="at">border_right =</span> <span class="cn">TRUE</span>, <span class="at">include_thead =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb265-78"><a href="chm-raster-resolution-testing.html#cb265-78" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">column_spec</span>(</span>
<span id="cb265-79"><a href="chm-raster-resolution-testing.html#cb265-79" tabindex="-1"></a>    <span class="at">column =</span> <span class="dv">7</span><span class="sc">:</span><span class="dv">19</span></span>
<span id="cb265-80"><a href="chm-raster-resolution-testing.html#cb265-80" tabindex="-1"></a>    , <span class="at">extra_css =</span> <span class="st">&quot;font-size: 10px;&quot;</span></span>
<span id="cb265-81"><a href="chm-raster-resolution-testing.html#cb265-81" tabindex="-1"></a>    , <span class="at">include_thead =</span> T</span>
<span id="cb265-82"><a href="chm-raster-resolution-testing.html#cb265-82" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb265-83"><a href="chm-raster-resolution-testing.html#cb265-83" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">collapse_rows</span>(<span class="at">columns =</span> <span class="dv">1</span>, <span class="at">valign =</span> <span class="st">&quot;top&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb265-84"><a href="chm-raster-resolution-testing.html#cb265-84" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">scroll_box</span>(<span class="at">width =</span> <span class="st">&quot;740px&quot;</span>) </span></code></pre></div>
<div style="border: 1px solid #ddd; padding: 5px; overflow-x: scroll; width:740px; ">
<table class="table" style="font-size: 11px; margin-left: auto; margin-right: auto;">
<caption style="font-size: initial !important;">
<span id="tab:unnamed-chunk-233">Table 8.2: </span>Structural Data Only<br>pile detection and form quantification accuracy metrics for the final recommended parameter settings (n=6) by CHM resolution <br>based on both detection and quantification accuracy
</caption>
<thead>
<tr>
<th style="empty-cells: hide;border-bottom:hidden;" colspan="7">
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="3">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Detection
</div>
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="3">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Area
</div>
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="3">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Height
</div>
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="3">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Diameter
</div>
</th>
</tr>
<tr>
<th style="text-align:left;">
.
</th>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
max_ht_m
</th>
<th style="text-align:right;">
max_area_m2
</th>
<th style="text-align:right;">
convexity_pct
</th>
<th style="text-align:right;">
circle_fit_iou_pct
</th>
<th style="text-align:left;border-right:1px solid;font-size: 10px;">
</th>
<th style="text-align:left;font-size: 10px;">
F-score
</th>
<th style="text-align:left;font-size: 10px;">
Recall
</th>
<th style="text-align:left;border-right:1px solid;font-size: 10px;">
Precision
</th>
<th style="text-align:left;font-size: 10px;">
ME
</th>
<th style="text-align:left;font-size: 10px;">
RMSE
</th>
<th style="text-align:left;border-right:1px solid;font-size: 10px;">
MAPE
</th>
<th style="text-align:left;font-size: 10px;">
ME
</th>
<th style="text-align:left;font-size: 10px;">
RMSE
</th>
<th style="text-align:left;border-right:1px solid;font-size: 10px;">
MAPE
</th>
<th style="text-align:left;font-size: 10px;">
ME
</th>
<th style="text-align:left;font-size: 10px;">
RMSE
</th>
<th style="text-align:left;border-right:1px solid;font-size: 10px;">
MAPE
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="6">
0.1m CHM
</td>
<td style="text-align:left;">
2:10:0.8:0.05:0.1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
0.80
</td>
<td style="text-align:right;">
0.05
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
79%
</td>
<td style="text-align:left;font-size: 10px;">
78%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
80%
</td>
<td style="text-align:left;font-size: 10px;">
-0.50
</td>
<td style="text-align:left;font-size: 10px;">
1.0
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
11%
</td>
<td style="text-align:left;font-size: 10px;">
-0.20
</td>
<td style="text-align:left;font-size: 10px;">
0.3
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
13%
</td>
<td style="text-align:left;font-size: 10px;">
0.17
</td>
<td style="text-align:left;font-size: 10px;">
0.4
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
10%
</td>
</tr>
<tr>
<td style="text-align:left;">
3:10:0.8:0.35:0.1
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
0.80
</td>
<td style="text-align:right;">
0.35
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
77%
</td>
<td style="text-align:left;font-size: 10px;">
79%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
75%
</td>
<td style="text-align:left;font-size: 10px;">
-0.46
</td>
<td style="text-align:left;font-size: 10px;">
0.9
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
11%
</td>
<td style="text-align:left;font-size: 10px;">
-0.02
</td>
<td style="text-align:left;font-size: 10px;">
0.4
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
17%
</td>
<td style="text-align:left;font-size: 10px;">
0.17
</td>
<td style="text-align:left;font-size: 10px;">
0.4
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
10%
</td>
</tr>
<tr>
<td style="text-align:left;">
5:60:0.8:0.65:0.1
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
60
</td>
<td style="text-align:right;">
0.80
</td>
<td style="text-align:right;">
0.65
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
76%
</td>
<td style="text-align:left;font-size: 10px;">
90%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
66%
</td>
<td style="text-align:left;font-size: 10px;">
-0.80
</td>
<td style="text-align:left;font-size: 10px;">
2.1
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
10%
</td>
<td style="text-align:left;font-size: 10px;">
-0.10
</td>
<td style="text-align:left;font-size: 10px;">
0.6
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
18%
</td>
<td style="text-align:left;font-size: 10px;">
0.21
</td>
<td style="text-align:left;font-size: 10px;">
0.5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
10%
</td>
</tr>
<tr>
<td style="text-align:left;">
5:50:0.8:0.65:0.1
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
50
</td>
<td style="text-align:right;">
0.80
</td>
<td style="text-align:right;">
0.65
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
76%
</td>
<td style="text-align:left;font-size: 10px;">
90%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
66%
</td>
<td style="text-align:left;font-size: 10px;">
-0.80
</td>
<td style="text-align:left;font-size: 10px;">
2.1
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
10%
</td>
<td style="text-align:left;font-size: 10px;">
-0.10
</td>
<td style="text-align:left;font-size: 10px;">
0.6
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
18%
</td>
<td style="text-align:left;font-size: 10px;">
0.21
</td>
<td style="text-align:left;font-size: 10px;">
0.5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
10%
</td>
</tr>
<tr>
<td style="text-align:left;">
5:40:0.8:0.65:0.1
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
40
</td>
<td style="text-align:right;">
0.80
</td>
<td style="text-align:right;">
0.65
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
75%
</td>
<td style="text-align:left;font-size: 10px;">
88%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
66%
</td>
<td style="text-align:left;font-size: 10px;">
-0.63
</td>
<td style="text-align:left;font-size: 10px;">
1.7
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
10%
</td>
<td style="text-align:left;font-size: 10px;">
-0.05
</td>
<td style="text-align:left;font-size: 10px;">
0.6
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
18%
</td>
<td style="text-align:left;font-size: 10px;">
0.21
</td>
<td style="text-align:left;font-size: 10px;">
0.5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
10%
</td>
</tr>
<tr>
<td style="text-align:left;">
3:10:0.8:0.5:0.1
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
0.80
</td>
<td style="text-align:right;">
0.50
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
77%
</td>
<td style="text-align:left;font-size: 10px;">
77%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
78%
</td>
<td style="text-align:left;font-size: 10px;">
-0.46
</td>
<td style="text-align:left;font-size: 10px;">
0.9
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
11%
</td>
<td style="text-align:left;font-size: 10px;">
-0.02
</td>
<td style="text-align:left;font-size: 10px;">
0.4
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
17%
</td>
<td style="text-align:left;font-size: 10px;">
0.17
</td>
<td style="text-align:left;font-size: 10px;">
0.4
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
10%
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="6">
0.2m CHM
</td>
<td style="text-align:left;">
2:10:0.8:0.05:0.2
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
0.80
</td>
<td style="text-align:right;">
0.05
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
70%
</td>
<td style="text-align:left;font-size: 10px;">
74%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
66%
</td>
<td style="text-align:left;font-size: 10px;">
0.53
</td>
<td style="text-align:left;font-size: 10px;">
1.0
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
12%
</td>
<td style="text-align:left;font-size: 10px;">
-0.22
</td>
<td style="text-align:left;font-size: 10px;">
0.3
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
13%
</td>
<td style="text-align:left;font-size: 10px;">
0.43
</td>
<td style="text-align:left;font-size: 10px;">
0.6
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
16%
</td>
</tr>
<tr>
<td style="text-align:left;">
2:10:0.8:0.2:0.2
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
0.80
</td>
<td style="text-align:right;">
0.20
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
68%
</td>
<td style="text-align:left;font-size: 10px;">
69%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
67%
</td>
<td style="text-align:left;font-size: 10px;">
0.52
</td>
<td style="text-align:left;font-size: 10px;">
1.0
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
12%
</td>
<td style="text-align:left;font-size: 10px;">
-0.23
</td>
<td style="text-align:left;font-size: 10px;">
0.3
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
14%
</td>
<td style="text-align:left;font-size: 10px;">
0.42
</td>
<td style="text-align:left;font-size: 10px;">
0.6
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
16%
</td>
</tr>
<tr>
<td style="text-align:left;">
3:10:0.8:0.65:0.2
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
0.80
</td>
<td style="text-align:right;">
0.65
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
73%
</td>
<td style="text-align:left;font-size: 10px;">
68%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
80%
</td>
<td style="text-align:left;font-size: 10px;">
0.62
</td>
<td style="text-align:left;font-size: 10px;">
1.0
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
13%
</td>
<td style="text-align:left;font-size: 10px;">
0.00
</td>
<td style="text-align:left;font-size: 10px;">
0.4
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
17%
</td>
<td style="text-align:left;font-size: 10px;">
0.46
</td>
<td style="text-align:left;font-size: 10px;">
0.6
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
17%
</td>
</tr>
<tr>
<td style="text-align:left;">
3:10:0.35:0.65:0.2
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
0.35
</td>
<td style="text-align:right;">
0.65
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
73%
</td>
<td style="text-align:left;font-size: 10px;">
68%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
79%
</td>
<td style="text-align:left;font-size: 10px;">
0.62
</td>
<td style="text-align:left;font-size: 10px;">
1.0
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
13%
</td>
<td style="text-align:left;font-size: 10px;">
0.00
</td>
<td style="text-align:left;font-size: 10px;">
0.4
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
17%
</td>
<td style="text-align:left;font-size: 10px;">
0.46
</td>
<td style="text-align:left;font-size: 10px;">
0.6
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
17%
</td>
</tr>
<tr>
<td style="text-align:left;">
3:10:0.2:0.65:0.2
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
0.20
</td>
<td style="text-align:right;">
0.65
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
73%
</td>
<td style="text-align:left;font-size: 10px;">
68%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
79%
</td>
<td style="text-align:left;font-size: 10px;">
0.62
</td>
<td style="text-align:left;font-size: 10px;">
1.0
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
13%
</td>
<td style="text-align:left;font-size: 10px;">
0.00
</td>
<td style="text-align:left;font-size: 10px;">
0.4
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
17%
</td>
<td style="text-align:left;font-size: 10px;">
0.46
</td>
<td style="text-align:left;font-size: 10px;">
0.6
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
17%
</td>
</tr>
<tr>
<td style="text-align:left;">
3:10:0.05:0.65:0.2
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
0.05
</td>
<td style="text-align:right;">
0.65
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
73%
</td>
<td style="text-align:left;font-size: 10px;">
68%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
79%
</td>
<td style="text-align:left;font-size: 10px;">
0.62
</td>
<td style="text-align:left;font-size: 10px;">
1.0
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
13%
</td>
<td style="text-align:left;font-size: 10px;">
0.00
</td>
<td style="text-align:left;font-size: 10px;">
0.4
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
17%
</td>
<td style="text-align:left;font-size: 10px;">
0.46
</td>
<td style="text-align:left;font-size: 10px;">
0.6
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
17%
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="6">
0.3m CHM
</td>
<td style="text-align:left;">
3:10:0.8:0.65:0.3
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
0.80
</td>
<td style="text-align:right;">
0.65
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
65%
</td>
<td style="text-align:left;font-size: 10px;">
67%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
63%
</td>
<td style="text-align:left;font-size: 10px;">
1.40
</td>
<td style="text-align:left;font-size: 10px;">
1.7
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
23%
</td>
<td style="text-align:left;font-size: 10px;">
-0.02
</td>
<td style="text-align:left;font-size: 10px;">
0.4
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
16%
</td>
<td style="text-align:left;font-size: 10px;">
0.64
</td>
<td style="text-align:left;font-size: 10px;">
0.7
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
23%
</td>
</tr>
<tr>
<td style="text-align:left;">
3:10:0.65:0.65:0.3
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
0.65
</td>
<td style="text-align:right;">
0.65
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
65%
</td>
<td style="text-align:left;font-size: 10px;">
67%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
62%
</td>
<td style="text-align:left;font-size: 10px;">
1.40
</td>
<td style="text-align:left;font-size: 10px;">
1.7
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
23%
</td>
<td style="text-align:left;font-size: 10px;">
-0.02
</td>
<td style="text-align:left;font-size: 10px;">
0.4
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
16%
</td>
<td style="text-align:left;font-size: 10px;">
0.64
</td>
<td style="text-align:left;font-size: 10px;">
0.7
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
23%
</td>
</tr>
<tr>
<td style="text-align:left;">
3:10:0.5:0.65:0.3
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
0.50
</td>
<td style="text-align:right;">
0.65
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
65%
</td>
<td style="text-align:left;font-size: 10px;">
67%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
62%
</td>
<td style="text-align:left;font-size: 10px;">
1.40
</td>
<td style="text-align:left;font-size: 10px;">
1.7
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
23%
</td>
<td style="text-align:left;font-size: 10px;">
-0.02
</td>
<td style="text-align:left;font-size: 10px;">
0.4
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
16%
</td>
<td style="text-align:left;font-size: 10px;">
0.64
</td>
<td style="text-align:left;font-size: 10px;">
0.7
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
23%
</td>
</tr>
<tr>
<td style="text-align:left;">
3:10:0.35:0.65:0.3
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
0.35
</td>
<td style="text-align:right;">
0.65
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
65%
</td>
<td style="text-align:left;font-size: 10px;">
67%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
62%
</td>
<td style="text-align:left;font-size: 10px;">
1.40
</td>
<td style="text-align:left;font-size: 10px;">
1.7
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
23%
</td>
<td style="text-align:left;font-size: 10px;">
-0.02
</td>
<td style="text-align:left;font-size: 10px;">
0.4
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
16%
</td>
<td style="text-align:left;font-size: 10px;">
0.64
</td>
<td style="text-align:left;font-size: 10px;">
0.7
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
23%
</td>
</tr>
<tr>
<td style="text-align:left;">
3:10:0.2:0.65:0.3
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
0.20
</td>
<td style="text-align:right;">
0.65
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
65%
</td>
<td style="text-align:left;font-size: 10px;">
67%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
62%
</td>
<td style="text-align:left;font-size: 10px;">
1.40
</td>
<td style="text-align:left;font-size: 10px;">
1.7
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
23%
</td>
<td style="text-align:left;font-size: 10px;">
-0.02
</td>
<td style="text-align:left;font-size: 10px;">
0.4
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
16%
</td>
<td style="text-align:left;font-size: 10px;">
0.64
</td>
<td style="text-align:left;font-size: 10px;">
0.7
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
23%
</td>
</tr>
<tr>
<td style="text-align:left;">
3:10:0.05:0.65:0.3
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
0.05
</td>
<td style="text-align:right;">
0.65
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
65%
</td>
<td style="text-align:left;font-size: 10px;">
67%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
62%
</td>
<td style="text-align:left;font-size: 10px;">
1.40
</td>
<td style="text-align:left;font-size: 10px;">
1.7
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
23%
</td>
<td style="text-align:left;font-size: 10px;">
-0.02
</td>
<td style="text-align:left;font-size: 10px;">
0.4
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
16%
</td>
<td style="text-align:left;font-size: 10px;">
0.64
</td>
<td style="text-align:left;font-size: 10px;">
0.7
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
23%
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="6">
0.4m CHM
</td>
<td style="text-align:left;">
2:20:0.8:0.05:0.4
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
20
</td>
<td style="text-align:right;">
0.80
</td>
<td style="text-align:right;">
0.05
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
55%
</td>
<td style="text-align:left;font-size: 10px;">
79%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
42%
</td>
<td style="text-align:left;font-size: 10px;">
2.43
</td>
<td style="text-align:left;font-size: 10px;">
3.1
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
37%
</td>
<td style="text-align:left;font-size: 10px;">
-0.24
</td>
<td style="text-align:left;font-size: 10px;">
0.4
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
14%
</td>
<td style="text-align:left;font-size: 10px;">
1.02
</td>
<td style="text-align:left;font-size: 10px;">
1.1
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
34%
</td>
</tr>
<tr>
<td style="text-align:left;">
2:60:0.8:0.05:0.4
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
60
</td>
<td style="text-align:right;">
0.80
</td>
<td style="text-align:right;">
0.05
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
56%
</td>
<td style="text-align:left;font-size: 10px;">
81%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
42%
</td>
<td style="text-align:left;font-size: 10px;">
2.48
</td>
<td style="text-align:left;font-size: 10px;">
3.1
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
37%
</td>
<td style="text-align:left;font-size: 10px;">
-0.29
</td>
<td style="text-align:left;font-size: 10px;">
0.5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
15%
</td>
<td style="text-align:left;font-size: 10px;">
1.01
</td>
<td style="text-align:left;font-size: 10px;">
1.1
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
34%
</td>
</tr>
<tr>
<td style="text-align:left;">
2:50:0.8:0.05:0.4
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
50
</td>
<td style="text-align:right;">
0.80
</td>
<td style="text-align:right;">
0.05
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
56%
</td>
<td style="text-align:left;font-size: 10px;">
81%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
42%
</td>
<td style="text-align:left;font-size: 10px;">
2.48
</td>
<td style="text-align:left;font-size: 10px;">
3.1
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
37%
</td>
<td style="text-align:left;font-size: 10px;">
-0.29
</td>
<td style="text-align:left;font-size: 10px;">
0.5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
15%
</td>
<td style="text-align:left;font-size: 10px;">
1.01
</td>
<td style="text-align:left;font-size: 10px;">
1.1
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
34%
</td>
</tr>
<tr>
<td style="text-align:left;">
2:40:0.8:0.05:0.4
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
40
</td>
<td style="text-align:right;">
0.80
</td>
<td style="text-align:right;">
0.05
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
56%
</td>
<td style="text-align:left;font-size: 10px;">
81%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
42%
</td>
<td style="text-align:left;font-size: 10px;">
2.48
</td>
<td style="text-align:left;font-size: 10px;">
3.1
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
37%
</td>
<td style="text-align:left;font-size: 10px;">
-0.29
</td>
<td style="text-align:left;font-size: 10px;">
0.5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
15%
</td>
<td style="text-align:left;font-size: 10px;">
1.01
</td>
<td style="text-align:left;font-size: 10px;">
1.1
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
34%
</td>
</tr>
<tr>
<td style="text-align:left;">
2:30:0.8:0.05:0.4
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
30
</td>
<td style="text-align:right;">
0.80
</td>
<td style="text-align:right;">
0.05
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
56%
</td>
<td style="text-align:left;font-size: 10px;">
81%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
42%
</td>
<td style="text-align:left;font-size: 10px;">
2.48
</td>
<td style="text-align:left;font-size: 10px;">
3.1
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
37%
</td>
<td style="text-align:left;font-size: 10px;">
-0.29
</td>
<td style="text-align:left;font-size: 10px;">
0.5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
15%
</td>
<td style="text-align:left;font-size: 10px;">
1.01
</td>
<td style="text-align:left;font-size: 10px;">
1.1
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
34%
</td>
</tr>
<tr>
<td style="text-align:left;">
2:30:0.8:0.2:0.4
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
30
</td>
<td style="text-align:right;">
0.80
</td>
<td style="text-align:right;">
0.20
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
54%
</td>
<td style="text-align:left;font-size: 10px;">
75%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
42%
</td>
<td style="text-align:left;font-size: 10px;">
2.50
</td>
<td style="text-align:left;font-size: 10px;">
3.2
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
37%
</td>
<td style="text-align:left;font-size: 10px;">
-0.31
</td>
<td style="text-align:left;font-size: 10px;">
0.5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
15%
</td>
<td style="text-align:left;font-size: 10px;">
1.01
</td>
<td style="text-align:left;font-size: 10px;">
1.1
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
34%
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="6">
0.5m CHM
</td>
<td style="text-align:left;">
2:60:0.8:0.65:0.5
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
60
</td>
<td style="text-align:right;">
0.80
</td>
<td style="text-align:right;">
0.65
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
42%
</td>
<td style="text-align:left;font-size: 10px;">
34%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
54%
</td>
<td style="text-align:left;font-size: 10px;">
3.33
</td>
<td style="text-align:left;font-size: 10px;">
4.0
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
49%
</td>
<td style="text-align:left;font-size: 10px;">
-0.34
</td>
<td style="text-align:left;font-size: 10px;">
0.6
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
17%
</td>
<td style="text-align:left;font-size: 10px;">
1.20
</td>
<td style="text-align:left;font-size: 10px;">
1.3
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
39%
</td>
</tr>
<tr>
<td style="text-align:left;">
2:50:0.8:0.65:0.5
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
50
</td>
<td style="text-align:right;">
0.80
</td>
<td style="text-align:right;">
0.65
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
42%
</td>
<td style="text-align:left;font-size: 10px;">
34%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
54%
</td>
<td style="text-align:left;font-size: 10px;">
3.33
</td>
<td style="text-align:left;font-size: 10px;">
4.0
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
49%
</td>
<td style="text-align:left;font-size: 10px;">
-0.34
</td>
<td style="text-align:left;font-size: 10px;">
0.6
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
17%
</td>
<td style="text-align:left;font-size: 10px;">
1.20
</td>
<td style="text-align:left;font-size: 10px;">
1.3
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
39%
</td>
</tr>
<tr>
<td style="text-align:left;">
2:40:0.8:0.65:0.5
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
40
</td>
<td style="text-align:right;">
0.80
</td>
<td style="text-align:right;">
0.65
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
42%
</td>
<td style="text-align:left;font-size: 10px;">
34%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
54%
</td>
<td style="text-align:left;font-size: 10px;">
3.33
</td>
<td style="text-align:left;font-size: 10px;">
4.0
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
49%
</td>
<td style="text-align:left;font-size: 10px;">
-0.34
</td>
<td style="text-align:left;font-size: 10px;">
0.6
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
17%
</td>
<td style="text-align:left;font-size: 10px;">
1.20
</td>
<td style="text-align:left;font-size: 10px;">
1.3
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
39%
</td>
</tr>
<tr>
<td style="text-align:left;">
2:30:0.8:0.65:0.5
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
30
</td>
<td style="text-align:right;">
0.80
</td>
<td style="text-align:right;">
0.65
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
42%
</td>
<td style="text-align:left;font-size: 10px;">
34%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
54%
</td>
<td style="text-align:left;font-size: 10px;">
3.33
</td>
<td style="text-align:left;font-size: 10px;">
4.0
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
49%
</td>
<td style="text-align:left;font-size: 10px;">
-0.34
</td>
<td style="text-align:left;font-size: 10px;">
0.6
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
17%
</td>
<td style="text-align:left;font-size: 10px;">
1.20
</td>
<td style="text-align:left;font-size: 10px;">
1.3
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
39%
</td>
</tr>
<tr>
<td style="text-align:left;">
2:30:0.2:0.65:0.5
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
30
</td>
<td style="text-align:right;">
0.20
</td>
<td style="text-align:right;">
0.65
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
41%
</td>
<td style="text-align:left;font-size: 10px;">
34%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
53%
</td>
<td style="text-align:left;font-size: 10px;">
3.33
</td>
<td style="text-align:left;font-size: 10px;">
4.0
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
49%
</td>
<td style="text-align:left;font-size: 10px;">
-0.34
</td>
<td style="text-align:left;font-size: 10px;">
0.6
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
17%
</td>
<td style="text-align:left;font-size: 10px;">
1.20
</td>
<td style="text-align:left;font-size: 10px;">
1.3
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
39%
</td>
</tr>
<tr>
<td style="text-align:left;">
2:30:0.05:0.65:0.5
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
30
</td>
<td style="text-align:right;">
0.05
</td>
<td style="text-align:right;">
0.65
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
41%
</td>
<td style="text-align:left;font-size: 10px;">
34%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
53%
</td>
<td style="text-align:left;font-size: 10px;">
3.33
</td>
<td style="text-align:left;font-size: 10px;">
4.0
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
49%
</td>
<td style="text-align:left;font-size: 10px;">
-0.34
</td>
<td style="text-align:left;font-size: 10px;">
0.6
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
17%
</td>
<td style="text-align:left;font-size: 10px;">
1.20
</td>
<td style="text-align:left;font-size: 10px;">
1.3
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
39%
</td>
</tr>
</tbody>
</table>
</div>
<p>what is the expected <em>detection</em> accuracy of the final 6 recommended settings by CHM resolution?</p>
<div class="sourceCode" id="cb266"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb266-1"><a href="chm-raster-resolution-testing.html#cb266-1" tabindex="-1"></a><span class="fu">plt_detection_dist2</span>(</span>
<span id="cb266-2"><a href="chm-raster-resolution-testing.html#cb266-2" tabindex="-1"></a>  <span class="at">df =</span> param_combos_ranked <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(is_final_selection_chm) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">!</span>tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;_pct_rank_&quot;</span>))</span>
<span id="cb266-3"><a href="chm-raster-resolution-testing.html#cb266-3" tabindex="-1"></a>  , <span class="fu">paste0</span>(</span>
<span id="cb266-4"><a href="chm-raster-resolution-testing.html#cb266-4" tabindex="-1"></a>    <span class="st">&quot;Structural Data Only&quot;</span></span>
<span id="cb266-5"><a href="chm-raster-resolution-testing.html#cb266-5" tabindex="-1"></a>    , <span class="st">&quot;</span><span class="sc">\n</span><span class="st">distribution of evaluation metrics for the final recommended parameter settings&quot;</span></span>
<span id="cb266-6"><a href="chm-raster-resolution-testing.html#cb266-6" tabindex="-1"></a>    , <span class="st">&quot; (n=&quot;</span></span>
<span id="cb266-7"><a href="chm-raster-resolution-testing.html#cb266-7" tabindex="-1"></a>    , scales<span class="sc">::</span><span class="fu">comma</span>(n_th_top_chm,<span class="at">accuracy=</span><span class="dv">1</span>)</span>
<span id="cb266-8"><a href="chm-raster-resolution-testing.html#cb266-8" tabindex="-1"></a>    , <span class="st">&quot;) by CHM resolution&quot;</span></span>
<span id="cb266-9"><a href="chm-raster-resolution-testing.html#cb266-9" tabindex="-1"></a>    , <span class="st">&quot;</span><span class="sc">\n</span><span class="st">based on both detection and quantification accuracy&quot;</span></span>
<span id="cb266-10"><a href="chm-raster-resolution-testing.html#cb266-10" tabindex="-1"></a>  )</span>
<span id="cb266-11"><a href="chm-raster-resolution-testing.html#cb266-11" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-234-1.png" width="1008" /></p>
<p><em>WHAT DID WE LEARN FROM THIS</em></p>
<p>what is the expected <em>MAPE</em> of the final 6 recommended settings by CHM resolution?</p>
<div class="sourceCode" id="cb267"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb267-1"><a href="chm-raster-resolution-testing.html#cb267-1" tabindex="-1"></a><span class="co"># plot it</span></span>
<span id="cb267-2"><a href="chm-raster-resolution-testing.html#cb267-2" tabindex="-1"></a><span class="fu">plt_form_quantification_dist2</span>(</span>
<span id="cb267-3"><a href="chm-raster-resolution-testing.html#cb267-3" tabindex="-1"></a>  <span class="at">df =</span> param_combos_ranked <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(is_final_selection_chm) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">!</span>tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;_pct_rank_&quot;</span>))</span>
<span id="cb267-4"><a href="chm-raster-resolution-testing.html#cb267-4" tabindex="-1"></a>  , <span class="at">quant_metric =</span> <span class="st">&quot;mape&quot;</span></span>
<span id="cb267-5"><a href="chm-raster-resolution-testing.html#cb267-5" tabindex="-1"></a>  , <span class="fu">paste0</span>(</span>
<span id="cb267-6"><a href="chm-raster-resolution-testing.html#cb267-6" tabindex="-1"></a>    <span class="st">&quot;Structural Data Only&quot;</span></span>
<span id="cb267-7"><a href="chm-raster-resolution-testing.html#cb267-7" tabindex="-1"></a>    , <span class="st">&quot;</span><span class="sc">\n</span><span class="st">distribution of pile form quantification metrics for the final recommended parameter settings&quot;</span></span>
<span id="cb267-8"><a href="chm-raster-resolution-testing.html#cb267-8" tabindex="-1"></a>    , <span class="st">&quot; (n=&quot;</span></span>
<span id="cb267-9"><a href="chm-raster-resolution-testing.html#cb267-9" tabindex="-1"></a>    , scales<span class="sc">::</span><span class="fu">comma</span>(n_th_top_chm,<span class="at">accuracy=</span><span class="dv">1</span>)</span>
<span id="cb267-10"><a href="chm-raster-resolution-testing.html#cb267-10" tabindex="-1"></a>    , <span class="st">&quot;) by CHM resolution&quot;</span></span>
<span id="cb267-11"><a href="chm-raster-resolution-testing.html#cb267-11" tabindex="-1"></a>    , <span class="st">&quot;</span><span class="sc">\n</span><span class="st">based on both detection and quantification accuracy&quot;</span></span>
<span id="cb267-12"><a href="chm-raster-resolution-testing.html#cb267-12" tabindex="-1"></a>  )</span>
<span id="cb267-13"><a href="chm-raster-resolution-testing.html#cb267-13" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-235-1.png" width="1008" /></p>
<p><em>WHAT DID WE LEARN FROM THIS</em></p>
<p>what is the expected <em>Mean Error (ME)</em> of the final 6 recommended settings by CHM resolution?</p>
<div class="sourceCode" id="cb268"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb268-1"><a href="chm-raster-resolution-testing.html#cb268-1" tabindex="-1"></a><span class="co"># plot it</span></span>
<span id="cb268-2"><a href="chm-raster-resolution-testing.html#cb268-2" tabindex="-1"></a><span class="fu">plt_form_quantification_dist2</span>(</span>
<span id="cb268-3"><a href="chm-raster-resolution-testing.html#cb268-3" tabindex="-1"></a>  <span class="at">df =</span> param_combos_ranked <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(is_final_selection_chm) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">!</span>tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;_pct_rank_&quot;</span>))</span>
<span id="cb268-4"><a href="chm-raster-resolution-testing.html#cb268-4" tabindex="-1"></a>  , <span class="at">quant_metric =</span> <span class="st">&quot;mean&quot;</span></span>
<span id="cb268-5"><a href="chm-raster-resolution-testing.html#cb268-5" tabindex="-1"></a>  , <span class="fu">paste0</span>(</span>
<span id="cb268-6"><a href="chm-raster-resolution-testing.html#cb268-6" tabindex="-1"></a>    <span class="st">&quot;Structural Data Only&quot;</span></span>
<span id="cb268-7"><a href="chm-raster-resolution-testing.html#cb268-7" tabindex="-1"></a>    , <span class="st">&quot;</span><span class="sc">\n</span><span class="st">distribution of pile form quantification metrics for the final recommended parameter settings&quot;</span></span>
<span id="cb268-8"><a href="chm-raster-resolution-testing.html#cb268-8" tabindex="-1"></a>    , <span class="st">&quot; (n=&quot;</span></span>
<span id="cb268-9"><a href="chm-raster-resolution-testing.html#cb268-9" tabindex="-1"></a>    , scales<span class="sc">::</span><span class="fu">comma</span>(n_th_top_chm,<span class="at">accuracy=</span><span class="dv">1</span>)</span>
<span id="cb268-10"><a href="chm-raster-resolution-testing.html#cb268-10" tabindex="-1"></a>    , <span class="st">&quot;) by CHM resolution&quot;</span></span>
<span id="cb268-11"><a href="chm-raster-resolution-testing.html#cb268-11" tabindex="-1"></a>    , <span class="st">&quot;</span><span class="sc">\n</span><span class="st">based on both detection and quantification accuracy&quot;</span></span>
<span id="cb268-12"><a href="chm-raster-resolution-testing.html#cb268-12" tabindex="-1"></a>  )</span>
<span id="cb268-13"><a href="chm-raster-resolution-testing.html#cb268-13" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-236-1.png" width="1008" /></p>
<p><em>WHAT DID WE LEARN FROM THIS</em></p>
<p>what is the expected <em>RMSE</em> of the final 6 recommended settings by CHM resolution?</p>
<div class="sourceCode" id="cb269"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb269-1"><a href="chm-raster-resolution-testing.html#cb269-1" tabindex="-1"></a><span class="co"># plot it</span></span>
<span id="cb269-2"><a href="chm-raster-resolution-testing.html#cb269-2" tabindex="-1"></a><span class="fu">plt_form_quantification_dist2</span>(</span>
<span id="cb269-3"><a href="chm-raster-resolution-testing.html#cb269-3" tabindex="-1"></a>  <span class="at">df =</span> param_combos_ranked <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(is_final_selection_chm) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">!</span>tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;_pct_rank_&quot;</span>))</span>
<span id="cb269-4"><a href="chm-raster-resolution-testing.html#cb269-4" tabindex="-1"></a>  , <span class="at">quant_metric =</span> <span class="st">&quot;rmse&quot;</span></span>
<span id="cb269-5"><a href="chm-raster-resolution-testing.html#cb269-5" tabindex="-1"></a>  , <span class="fu">paste0</span>(</span>
<span id="cb269-6"><a href="chm-raster-resolution-testing.html#cb269-6" tabindex="-1"></a>    <span class="st">&quot;Structural Data Only&quot;</span></span>
<span id="cb269-7"><a href="chm-raster-resolution-testing.html#cb269-7" tabindex="-1"></a>    , <span class="st">&quot;</span><span class="sc">\n</span><span class="st">distribution of pile form quantification metrics for the final recommended parameter settings&quot;</span></span>
<span id="cb269-8"><a href="chm-raster-resolution-testing.html#cb269-8" tabindex="-1"></a>    , <span class="st">&quot; (n=&quot;</span></span>
<span id="cb269-9"><a href="chm-raster-resolution-testing.html#cb269-9" tabindex="-1"></a>    , scales<span class="sc">::</span><span class="fu">comma</span>(n_th_top_chm,<span class="at">accuracy=</span><span class="dv">1</span>)</span>
<span id="cb269-10"><a href="chm-raster-resolution-testing.html#cb269-10" tabindex="-1"></a>    , <span class="st">&quot;) by CHM resolution&quot;</span></span>
<span id="cb269-11"><a href="chm-raster-resolution-testing.html#cb269-11" tabindex="-1"></a>    , <span class="st">&quot;</span><span class="sc">\n</span><span class="st">based on both detection and quantification accuracy&quot;</span></span>
<span id="cb269-12"><a href="chm-raster-resolution-testing.html#cb269-12" tabindex="-1"></a>  )</span>
<span id="cb269-13"><a href="chm-raster-resolution-testing.html#cb269-13" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-237-1.png" width="1008" /></p>
<p><em>WHAT DID WE LEARN FROM THIS</em></p>
</div>
</div>
</div>
</div>
<div id="data-fusion-sensitivity-testing" class="section level2 hasAnchor" number="8.6">
<h2><span class="header-section-number">8.6</span> Data Fusion: Sensitivity Testing<a href="chm-raster-resolution-testing.html#data-fusion-sensitivity-testing" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>let’s look at the sensitivity testing results for the <a href="data_fusion.html#data_fusion">data fusion approach</a> approach that uses both a CHM generated from aerial point cloud data (for structural information) and RGB imagery</p>
<p>we tested a total of 7,056 combinations tested per CHM resolution and an overall total of 35,280 combinations tested</p>
<div id="main-effects-pile-detection" class="section level3 hasAnchor" number="8.6.1">
<h3><span class="header-section-number">8.6.1</span> Main Effects: pile detection<a href="chm-raster-resolution-testing.html#main-effects-pile-detection" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>what is the detection accuracy across all parameter combinations tested for each CHM resolution?</p>
<div class="sourceCode" id="cb270"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb270-1"><a href="chm-raster-resolution-testing.html#cb270-1" tabindex="-1"></a><span class="co"># plot it</span></span>
<span id="cb270-2"><a href="chm-raster-resolution-testing.html#cb270-2" tabindex="-1"></a><span class="fu">plt_detection_dist2</span>(</span>
<span id="cb270-3"><a href="chm-raster-resolution-testing.html#cb270-3" tabindex="-1"></a>  <span class="at">df =</span> param_combos_spectral_gt_agg</span>
<span id="cb270-4"><a href="chm-raster-resolution-testing.html#cb270-4" tabindex="-1"></a>  , <span class="fu">paste0</span>(</span>
<span id="cb270-5"><a href="chm-raster-resolution-testing.html#cb270-5" tabindex="-1"></a>     <span class="st">&quot;Data Fusion&quot;</span></span>
<span id="cb270-6"><a href="chm-raster-resolution-testing.html#cb270-6" tabindex="-1"></a>      , <span class="st">&quot;</span><span class="sc">\n</span><span class="st">distribution of pile detection accuracy metrics for all&quot;</span></span>
<span id="cb270-7"><a href="chm-raster-resolution-testing.html#cb270-7" tabindex="-1"></a>     , <span class="st">&quot; (n=&quot;</span></span>
<span id="cb270-8"><a href="chm-raster-resolution-testing.html#cb270-8" tabindex="-1"></a>     , scales<span class="sc">::</span><span class="fu">comma</span>(n_combos_tested_spectral_chm, <span class="at">accuracy =</span> <span class="dv">1</span>)</span>
<span id="cb270-9"><a href="chm-raster-resolution-testing.html#cb270-9" tabindex="-1"></a>     , <span class="st">&quot;) &quot;</span></span>
<span id="cb270-10"><a href="chm-raster-resolution-testing.html#cb270-10" tabindex="-1"></a>     , <span class="st">&quot;parameter combinations tested by CHM resolution&quot;</span></span>
<span id="cb270-11"><a href="chm-raster-resolution-testing.html#cb270-11" tabindex="-1"></a>    )</span>
<span id="cb270-12"><a href="chm-raster-resolution-testing.html#cb270-12" tabindex="-1"></a>  , <span class="at">show_rug =</span> F</span>
<span id="cb270-13"><a href="chm-raster-resolution-testing.html#cb270-13" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-239-1.png" width="1008" /></p>
<p>collapsing across all other parameters, what is the main effect of each individual parameter, including the <code>spectral_weight</code> parameter from the data fusion approach, or CHM resolution?</p>
<div class="sourceCode" id="cb271"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb271-1"><a href="chm-raster-resolution-testing.html#cb271-1" tabindex="-1"></a>param_combos_spectral_gt_agg <span class="sc">%&gt;%</span> </span>
<span id="cb271-2"><a href="chm-raster-resolution-testing.html#cb271-2" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(</span>
<span id="cb271-3"><a href="chm-raster-resolution-testing.html#cb271-3" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">c</span>(precision,recall,f_score)</span>
<span id="cb271-4"><a href="chm-raster-resolution-testing.html#cb271-4" tabindex="-1"></a>    , <span class="at">names_to =</span> <span class="st">&quot;metric&quot;</span></span>
<span id="cb271-5"><a href="chm-raster-resolution-testing.html#cb271-5" tabindex="-1"></a>    , <span class="at">values_to =</span> <span class="st">&quot;value&quot;</span></span>
<span id="cb271-6"><a href="chm-raster-resolution-testing.html#cb271-6" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb271-7"><a href="chm-raster-resolution-testing.html#cb271-7" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(</span>
<span id="cb271-8"><a href="chm-raster-resolution-testing.html#cb271-8" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">c</span>(max_ht_m,max_area_m2,convexity_pct,circle_fit_iou_pct,chm_res_m,spectral_weight)</span>
<span id="cb271-9"><a href="chm-raster-resolution-testing.html#cb271-9" tabindex="-1"></a>    , <span class="at">names_to =</span> <span class="st">&quot;param&quot;</span></span>
<span id="cb271-10"><a href="chm-raster-resolution-testing.html#cb271-10" tabindex="-1"></a>    , <span class="at">values_to =</span> <span class="st">&quot;param_value&quot;</span></span>
<span id="cb271-11"><a href="chm-raster-resolution-testing.html#cb271-11" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb271-12"><a href="chm-raster-resolution-testing.html#cb271-12" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(param, param_value, metric) <span class="sc">%&gt;%</span></span>
<span id="cb271-13"><a href="chm-raster-resolution-testing.html#cb271-13" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(</span>
<span id="cb271-14"><a href="chm-raster-resolution-testing.html#cb271-14" tabindex="-1"></a>    <span class="at">median =</span> <span class="fu">median</span>(value,<span class="at">na.rm=</span>T)</span>
<span id="cb271-15"><a href="chm-raster-resolution-testing.html#cb271-15" tabindex="-1"></a>    , <span class="at">q25 =</span> stats<span class="sc">::</span><span class="fu">quantile</span>(value,<span class="at">na.rm=</span>T,<span class="at">probs =</span> <span class="fl">0.25</span>)</span>
<span id="cb271-16"><a href="chm-raster-resolution-testing.html#cb271-16" tabindex="-1"></a>    , <span class="at">q75 =</span> stats<span class="sc">::</span><span class="fu">quantile</span>(value,<span class="at">na.rm=</span>T,<span class="at">probs =</span> <span class="fl">0.75</span>)</span>
<span id="cb271-17"><a href="chm-raster-resolution-testing.html#cb271-17" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb271-18"><a href="chm-raster-resolution-testing.html#cb271-18" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb271-19"><a href="chm-raster-resolution-testing.html#cb271-19" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb271-20"><a href="chm-raster-resolution-testing.html#cb271-20" tabindex="-1"></a>    <span class="at">param =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb271-21"><a href="chm-raster-resolution-testing.html#cb271-21" tabindex="-1"></a>        param <span class="sc">==</span> <span class="st">&quot;spectral_weight&quot;</span> <span class="sc">~</span> <span class="dv">1</span></span>
<span id="cb271-22"><a href="chm-raster-resolution-testing.html#cb271-22" tabindex="-1"></a>        , param <span class="sc">==</span> <span class="st">&quot;chm_res_m&quot;</span> <span class="sc">~</span> <span class="dv">2</span></span>
<span id="cb271-23"><a href="chm-raster-resolution-testing.html#cb271-23" tabindex="-1"></a>        , param <span class="sc">==</span> <span class="st">&quot;max_ht_m&quot;</span> <span class="sc">~</span> <span class="dv">3</span></span>
<span id="cb271-24"><a href="chm-raster-resolution-testing.html#cb271-24" tabindex="-1"></a>        , param <span class="sc">==</span> <span class="st">&quot;min_area_m2&quot;</span> <span class="sc">~</span> <span class="dv">4</span></span>
<span id="cb271-25"><a href="chm-raster-resolution-testing.html#cb271-25" tabindex="-1"></a>        , param <span class="sc">==</span> <span class="st">&quot;max_area_m2&quot;</span> <span class="sc">~</span> <span class="dv">5</span></span>
<span id="cb271-26"><a href="chm-raster-resolution-testing.html#cb271-26" tabindex="-1"></a>        , param <span class="sc">==</span> <span class="st">&quot;convexity_pct&quot;</span> <span class="sc">~</span> <span class="dv">6</span></span>
<span id="cb271-27"><a href="chm-raster-resolution-testing.html#cb271-27" tabindex="-1"></a>        , param <span class="sc">==</span> <span class="st">&quot;circle_fit_iou_pct&quot;</span> <span class="sc">~</span> <span class="dv">7</span></span>
<span id="cb271-28"><a href="chm-raster-resolution-testing.html#cb271-28" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span> </span>
<span id="cb271-29"><a href="chm-raster-resolution-testing.html#cb271-29" tabindex="-1"></a>      <span class="fu">factor</span>(</span>
<span id="cb271-30"><a href="chm-raster-resolution-testing.html#cb271-30" tabindex="-1"></a>        <span class="at">ordered =</span> T</span>
<span id="cb271-31"><a href="chm-raster-resolution-testing.html#cb271-31" tabindex="-1"></a>        , <span class="at">levels =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">7</span></span>
<span id="cb271-32"><a href="chm-raster-resolution-testing.html#cb271-32" tabindex="-1"></a>        , <span class="at">labels =</span> <span class="fu">c</span>(</span>
<span id="cb271-33"><a href="chm-raster-resolution-testing.html#cb271-33" tabindex="-1"></a>          <span class="st">&quot;spectral_weight&quot;</span></span>
<span id="cb271-34"><a href="chm-raster-resolution-testing.html#cb271-34" tabindex="-1"></a>          , <span class="st">&quot;CHM resolution (m)&quot;</span></span>
<span id="cb271-35"><a href="chm-raster-resolution-testing.html#cb271-35" tabindex="-1"></a>          , <span class="st">&quot;max_ht_m&quot;</span></span>
<span id="cb271-36"><a href="chm-raster-resolution-testing.html#cb271-36" tabindex="-1"></a>          , <span class="st">&quot;min_area_m2&quot;</span></span>
<span id="cb271-37"><a href="chm-raster-resolution-testing.html#cb271-37" tabindex="-1"></a>          , <span class="st">&quot;max_area_m2&quot;</span></span>
<span id="cb271-38"><a href="chm-raster-resolution-testing.html#cb271-38" tabindex="-1"></a>          , <span class="st">&quot;convexity_pct&quot;</span></span>
<span id="cb271-39"><a href="chm-raster-resolution-testing.html#cb271-39" tabindex="-1"></a>          , <span class="st">&quot;circle_fit_iou_pct&quot;</span></span>
<span id="cb271-40"><a href="chm-raster-resolution-testing.html#cb271-40" tabindex="-1"></a>        )</span>
<span id="cb271-41"><a href="chm-raster-resolution-testing.html#cb271-41" tabindex="-1"></a>      )</span>
<span id="cb271-42"><a href="chm-raster-resolution-testing.html#cb271-42" tabindex="-1"></a>    , <span class="at">metric =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb271-43"><a href="chm-raster-resolution-testing.html#cb271-43" tabindex="-1"></a>        metric <span class="sc">==</span> <span class="st">&quot;f_score&quot;</span> <span class="sc">~</span> <span class="dv">1</span></span>
<span id="cb271-44"><a href="chm-raster-resolution-testing.html#cb271-44" tabindex="-1"></a>        , metric <span class="sc">==</span> <span class="st">&quot;recall&quot;</span> <span class="sc">~</span> <span class="dv">2</span></span>
<span id="cb271-45"><a href="chm-raster-resolution-testing.html#cb271-45" tabindex="-1"></a>        , metric <span class="sc">==</span> <span class="st">&quot;precision&quot;</span> <span class="sc">~</span> <span class="dv">3</span></span>
<span id="cb271-46"><a href="chm-raster-resolution-testing.html#cb271-46" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span> </span>
<span id="cb271-47"><a href="chm-raster-resolution-testing.html#cb271-47" tabindex="-1"></a>      <span class="fu">factor</span>(</span>
<span id="cb271-48"><a href="chm-raster-resolution-testing.html#cb271-48" tabindex="-1"></a>        <span class="at">ordered =</span> T</span>
<span id="cb271-49"><a href="chm-raster-resolution-testing.html#cb271-49" tabindex="-1"></a>        , <span class="at">levels =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span></span>
<span id="cb271-50"><a href="chm-raster-resolution-testing.html#cb271-50" tabindex="-1"></a>        , <span class="at">labels =</span> <span class="fu">c</span>(</span>
<span id="cb271-51"><a href="chm-raster-resolution-testing.html#cb271-51" tabindex="-1"></a>          <span class="st">&quot;F-score&quot;</span></span>
<span id="cb271-52"><a href="chm-raster-resolution-testing.html#cb271-52" tabindex="-1"></a>          , <span class="st">&quot;Recall&quot;</span></span>
<span id="cb271-53"><a href="chm-raster-resolution-testing.html#cb271-53" tabindex="-1"></a>          , <span class="st">&quot;Precision&quot;</span></span>
<span id="cb271-54"><a href="chm-raster-resolution-testing.html#cb271-54" tabindex="-1"></a>        )</span>
<span id="cb271-55"><a href="chm-raster-resolution-testing.html#cb271-55" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span> </span>
<span id="cb271-56"><a href="chm-raster-resolution-testing.html#cb271-56" tabindex="-1"></a>      forcats<span class="sc">::</span><span class="fu">fct_rev</span>()</span>
<span id="cb271-57"><a href="chm-raster-resolution-testing.html#cb271-57" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb271-58"><a href="chm-raster-resolution-testing.html#cb271-58" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(</span>
<span id="cb271-59"><a href="chm-raster-resolution-testing.html#cb271-59" tabindex="-1"></a>    <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">y =</span> median, <span class="at">x =</span> param_value, <span class="at">color =</span> metric, <span class="at">fill =</span> metric, <span class="at">group =</span> metric, <span class="at">shape =</span> metric)</span>
<span id="cb271-60"><a href="chm-raster-resolution-testing.html#cb271-60" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb271-61"><a href="chm-raster-resolution-testing.html#cb271-61" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_ribbon</span>(</span>
<span id="cb271-62"><a href="chm-raster-resolution-testing.html#cb271-62" tabindex="-1"></a>    <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">ymin =</span> q25, <span class="at">ymax =</span> q75)</span>
<span id="cb271-63"><a href="chm-raster-resolution-testing.html#cb271-63" tabindex="-1"></a>    , <span class="at">alpha =</span> <span class="fl">0.2</span>, <span class="at">color =</span> <span class="cn">NA</span></span>
<span id="cb271-64"><a href="chm-raster-resolution-testing.html#cb271-64" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb271-65"><a href="chm-raster-resolution-testing.html#cb271-65" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_line</span>(<span class="at">lwd =</span> <span class="fl">1.5</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb271-66"><a href="chm-raster-resolution-testing.html#cb271-66" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb271-67"><a href="chm-raster-resolution-testing.html#cb271-67" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">facet_wrap</span>(<span class="at">facets =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(param), <span class="at">scales =</span> <span class="st">&quot;free_x&quot;</span>) <span class="sc">+</span></span>
<span id="cb271-68"><a href="chm-raster-resolution-testing.html#cb271-68" tabindex="-1"></a>  <span class="co"># ggplot2::scale_color_viridis_d(begin = 0.2, end = 0.8) +</span></span>
<span id="cb271-69"><a href="chm-raster-resolution-testing.html#cb271-69" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">rev</span>(pal_eval_metric)) <span class="sc">+</span></span>
<span id="cb271-70"><a href="chm-raster-resolution-testing.html#cb271-70" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">rev</span>(pal_eval_metric)) <span class="sc">+</span></span>
<span id="cb271-71"><a href="chm-raster-resolution-testing.html#cb271-71" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">labels =</span> scales<span class="sc">::</span>percent, <span class="at">breaks =</span> scales<span class="sc">::</span><span class="fu">breaks_extended</span>(<span class="dv">10</span>)) <span class="sc">+</span></span>
<span id="cb271-72"><a href="chm-raster-resolution-testing.html#cb271-72" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;&quot;</span>, <span class="at">y =</span> <span class="st">&quot;median value&quot;</span>, <span class="at">color =</span> <span class="st">&quot;&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;&quot;</span>) <span class="sc">+</span></span>
<span id="cb271-73"><a href="chm-raster-resolution-testing.html#cb271-73" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb271-74"><a href="chm-raster-resolution-testing.html#cb271-74" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb271-75"><a href="chm-raster-resolution-testing.html#cb271-75" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;top&quot;</span></span>
<span id="cb271-76"><a href="chm-raster-resolution-testing.html#cb271-76" tabindex="-1"></a>    , <span class="at">strip.text =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb271-77"><a href="chm-raster-resolution-testing.html#cb271-77" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb271-78"><a href="chm-raster-resolution-testing.html#cb271-78" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">guides</span>(</span>
<span id="cb271-79"><a href="chm-raster-resolution-testing.html#cb271-79" tabindex="-1"></a>    <span class="at">color =</span> ggplot2<span class="sc">::</span><span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">shape =</span> <span class="dv">15</span>, <span class="at">linetype =</span> <span class="dv">0</span>, <span class="at">size =</span> <span class="dv">5</span>, <span class="at">alpha =</span> <span class="dv">1</span>))</span>
<span id="cb271-80"><a href="chm-raster-resolution-testing.html#cb271-80" tabindex="-1"></a>    , <span class="at">shape =</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb271-81"><a href="chm-raster-resolution-testing.html#cb271-81" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-240-1.png" width="1008" /></p>
<p>based on these main effect aggregated results, the influence of the parameters specific to the structural detection of slash piles remained the same as when tested without the spectral data. with respect to the <code>spectral_weight</code> parameter included in the data fusion approach:</p>
<ul>
<li>increasing the <code>spectral_weight</code> (where “5” requires all spectral index thresholds to be met) had minimal impact on metrics until a value of “3”, at which point F-score and precision both saw slight improvements. at a <code>spectral_weight</code> of “4”, the F-score significantly improved due to a substantial increase in precision. setting <code>spectral_weight</code> to “5” resulted in a significant drop in recall (detection rate) and a proportionally inverse increase in precision, leading to only a minor overall change in F-score.</li>
</ul>
</div>
<div id="main-effects-form-quantification" class="section level3 hasAnchor" number="8.6.2">
<h3><span class="header-section-number">8.6.2</span> Main Effects: form quantification<a href="chm-raster-resolution-testing.html#main-effects-form-quantification" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>let’s check out the the ability of the method to properly extract the form of the piles by looking at the quantification accuracy metrics where:</p>
<ul>
<li><strong>Mean Error (ME)</strong> represents the direction of bias (over or under-prediction) in the original units</li>
<li><strong>RMSE</strong> represents the typical magnitude of error in the original units, with a stronger penalty for large errors</li>
<li><strong>MAPE</strong> represents the typical magnitude of error as a percentage, allowing for scale-independent comparisons</li>
</ul>
<p>we expect that the spectral data does not alter the quantification of slash pile form. this is because spectral information is used solely to filter candidate piles, meaning it neither reshapes existing ones nor introduces new detections.</p>
<p>let’s average across all other factors to look at the main effect by parameter for the <strong>MAPE</strong> metrics quantifying the pile form accuracy</p>
<div class="sourceCode" id="cb272"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb272-1"><a href="chm-raster-resolution-testing.html#cb272-1" tabindex="-1"></a>param_combos_spectral_gt_agg <span class="sc">%&gt;%</span> </span>
<span id="cb272-2"><a href="chm-raster-resolution-testing.html#cb272-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb272-3"><a href="chm-raster-resolution-testing.html#cb272-3" tabindex="-1"></a>    spectral_weight</span>
<span id="cb272-4"><a href="chm-raster-resolution-testing.html#cb272-4" tabindex="-1"></a>    , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_mape&quot;</span>)</span>
<span id="cb272-5"><a href="chm-raster-resolution-testing.html#cb272-5" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb272-6"><a href="chm-raster-resolution-testing.html#cb272-6" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(</span>
<span id="cb272-7"><a href="chm-raster-resolution-testing.html#cb272-7" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">c</span>(tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_mape&quot;</span>))</span>
<span id="cb272-8"><a href="chm-raster-resolution-testing.html#cb272-8" tabindex="-1"></a>    , <span class="at">names_to =</span> <span class="st">&quot;metric&quot;</span></span>
<span id="cb272-9"><a href="chm-raster-resolution-testing.html#cb272-9" tabindex="-1"></a>    , <span class="at">values_to =</span> <span class="st">&quot;value&quot;</span></span>
<span id="cb272-10"><a href="chm-raster-resolution-testing.html#cb272-10" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb272-11"><a href="chm-raster-resolution-testing.html#cb272-11" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(</span>
<span id="cb272-12"><a href="chm-raster-resolution-testing.html#cb272-12" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">c</span>(spectral_weight)</span>
<span id="cb272-13"><a href="chm-raster-resolution-testing.html#cb272-13" tabindex="-1"></a>    , <span class="at">names_to =</span> <span class="st">&quot;param&quot;</span></span>
<span id="cb272-14"><a href="chm-raster-resolution-testing.html#cb272-14" tabindex="-1"></a>    , <span class="at">values_to =</span> <span class="st">&quot;param_value&quot;</span></span>
<span id="cb272-15"><a href="chm-raster-resolution-testing.html#cb272-15" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb272-16"><a href="chm-raster-resolution-testing.html#cb272-16" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(param, param_value, metric) <span class="sc">%&gt;%</span></span>
<span id="cb272-17"><a href="chm-raster-resolution-testing.html#cb272-17" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(</span>
<span id="cb272-18"><a href="chm-raster-resolution-testing.html#cb272-18" tabindex="-1"></a>    <span class="at">median =</span> <span class="fu">median</span>(value,<span class="at">na.rm=</span>T)</span>
<span id="cb272-19"><a href="chm-raster-resolution-testing.html#cb272-19" tabindex="-1"></a>    , <span class="at">q25 =</span> stats<span class="sc">::</span><span class="fu">quantile</span>(value,<span class="at">na.rm=</span>T,<span class="at">probs =</span> <span class="fl">0.25</span>)</span>
<span id="cb272-20"><a href="chm-raster-resolution-testing.html#cb272-20" tabindex="-1"></a>    , <span class="at">q75 =</span> stats<span class="sc">::</span><span class="fu">quantile</span>(value,<span class="at">na.rm=</span>T,<span class="at">probs =</span> <span class="fl">0.75</span>)</span>
<span id="cb272-21"><a href="chm-raster-resolution-testing.html#cb272-21" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb272-22"><a href="chm-raster-resolution-testing.html#cb272-22" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb272-23"><a href="chm-raster-resolution-testing.html#cb272-23" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb272-24"><a href="chm-raster-resolution-testing.html#cb272-24" tabindex="-1"></a>    <span class="at">metric =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb272-25"><a href="chm-raster-resolution-testing.html#cb272-25" tabindex="-1"></a>        metric <span class="sc">==</span> <span class="st">&quot;f_score&quot;</span> <span class="sc">~</span> <span class="dv">1</span></span>
<span id="cb272-26"><a href="chm-raster-resolution-testing.html#cb272-26" tabindex="-1"></a>        , metric <span class="sc">==</span> <span class="st">&quot;recall&quot;</span> <span class="sc">~</span> <span class="dv">2</span></span>
<span id="cb272-27"><a href="chm-raster-resolution-testing.html#cb272-27" tabindex="-1"></a>        , metric <span class="sc">==</span> <span class="st">&quot;precision&quot;</span> <span class="sc">~</span> <span class="dv">3</span></span>
<span id="cb272-28"><a href="chm-raster-resolution-testing.html#cb272-28" tabindex="-1"></a>        <span class="co"># rmse</span></span>
<span id="cb272-29"><a href="chm-raster-resolution-testing.html#cb272-29" tabindex="-1"></a>        , metric <span class="sc">==</span> <span class="st">&quot;pct_diff_volume_field_mape&quot;</span> <span class="sc">~</span> <span class="dv">4</span></span>
<span id="cb272-30"><a href="chm-raster-resolution-testing.html#cb272-30" tabindex="-1"></a>        , metric <span class="sc">==</span> <span class="st">&quot;pct_diff_paraboloid_volume_field_mape&quot;</span> <span class="sc">~</span> <span class="dv">5</span></span>
<span id="cb272-31"><a href="chm-raster-resolution-testing.html#cb272-31" tabindex="-1"></a>        , metric <span class="sc">==</span> <span class="st">&quot;pct_diff_area_m2_mape&quot;</span> <span class="sc">~</span> <span class="dv">6</span></span>
<span id="cb272-32"><a href="chm-raster-resolution-testing.html#cb272-32" tabindex="-1"></a>        , metric <span class="sc">==</span> <span class="st">&quot;pct_diff_height_m_mape&quot;</span> <span class="sc">~</span> <span class="dv">7</span></span>
<span id="cb272-33"><a href="chm-raster-resolution-testing.html#cb272-33" tabindex="-1"></a>        , metric <span class="sc">==</span> <span class="st">&quot;pct_diff_diameter_m_mape&quot;</span> <span class="sc">~</span> <span class="dv">8</span></span>
<span id="cb272-34"><a href="chm-raster-resolution-testing.html#cb272-34" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span> </span>
<span id="cb272-35"><a href="chm-raster-resolution-testing.html#cb272-35" tabindex="-1"></a>      <span class="fu">factor</span>(</span>
<span id="cb272-36"><a href="chm-raster-resolution-testing.html#cb272-36" tabindex="-1"></a>        <span class="at">ordered =</span> T</span>
<span id="cb272-37"><a href="chm-raster-resolution-testing.html#cb272-37" tabindex="-1"></a>        , <span class="at">levels =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">8</span></span>
<span id="cb272-38"><a href="chm-raster-resolution-testing.html#cb272-38" tabindex="-1"></a>        , <span class="at">labels =</span> <span class="fu">c</span>(</span>
<span id="cb272-39"><a href="chm-raster-resolution-testing.html#cb272-39" tabindex="-1"></a>          <span class="st">&quot;F-score&quot;</span></span>
<span id="cb272-40"><a href="chm-raster-resolution-testing.html#cb272-40" tabindex="-1"></a>          , <span class="st">&quot;Recall&quot;</span></span>
<span id="cb272-41"><a href="chm-raster-resolution-testing.html#cb272-41" tabindex="-1"></a>          , <span class="st">&quot;Precision&quot;</span></span>
<span id="cb272-42"><a href="chm-raster-resolution-testing.html#cb272-42" tabindex="-1"></a>          , <span class="st">&quot;MAPE: Volume irregular (%)&quot;</span></span>
<span id="cb272-43"><a href="chm-raster-resolution-testing.html#cb272-43" tabindex="-1"></a>          , <span class="st">&quot;MAPE: Volume paraboloid (%)&quot;</span></span>
<span id="cb272-44"><a href="chm-raster-resolution-testing.html#cb272-44" tabindex="-1"></a>          , <span class="st">&quot;MAPE: Area (%)&quot;</span></span>
<span id="cb272-45"><a href="chm-raster-resolution-testing.html#cb272-45" tabindex="-1"></a>          , <span class="st">&quot;MAPE: Height (%)&quot;</span></span>
<span id="cb272-46"><a href="chm-raster-resolution-testing.html#cb272-46" tabindex="-1"></a>          , <span class="st">&quot;MAPE: Diameter (%)&quot;</span></span>
<span id="cb272-47"><a href="chm-raster-resolution-testing.html#cb272-47" tabindex="-1"></a>        )</span>
<span id="cb272-48"><a href="chm-raster-resolution-testing.html#cb272-48" tabindex="-1"></a>      )</span>
<span id="cb272-49"><a href="chm-raster-resolution-testing.html#cb272-49" tabindex="-1"></a>    <span class="co"># , param_value = factor(x = param_value, labels = levels(param_combos_spectral_gt$spectral_weight_desc))</span></span>
<span id="cb272-50"><a href="chm-raster-resolution-testing.html#cb272-50" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb272-51"><a href="chm-raster-resolution-testing.html#cb272-51" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(</span>
<span id="cb272-52"><a href="chm-raster-resolution-testing.html#cb272-52" tabindex="-1"></a>    <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">y =</span> median, <span class="at">x =</span> param_value, <span class="at">color =</span> metric, <span class="at">fill =</span> metric, <span class="at">group =</span> metric, <span class="at">shape =</span> metric)</span>
<span id="cb272-53"><a href="chm-raster-resolution-testing.html#cb272-53" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb272-54"><a href="chm-raster-resolution-testing.html#cb272-54" tabindex="-1"></a>  <span class="co"># ggplot2::geom_ribbon(</span></span>
<span id="cb272-55"><a href="chm-raster-resolution-testing.html#cb272-55" tabindex="-1"></a>  <span class="co">#   mapping = ggplot2::aes(ymin = q25, ymax = q75)</span></span>
<span id="cb272-56"><a href="chm-raster-resolution-testing.html#cb272-56" tabindex="-1"></a>  <span class="co">#   , alpha = 0.2, color = NA</span></span>
<span id="cb272-57"><a href="chm-raster-resolution-testing.html#cb272-57" tabindex="-1"></a>  <span class="co"># ) +</span></span>
<span id="cb272-58"><a href="chm-raster-resolution-testing.html#cb272-58" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_line</span>(<span class="at">lwd =</span> <span class="fl">1.5</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb272-59"><a href="chm-raster-resolution-testing.html#cb272-59" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb272-60"><a href="chm-raster-resolution-testing.html#cb272-60" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">facet_wrap</span>(<span class="at">facets =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(param), <span class="at">scales =</span> <span class="st">&quot;free_x&quot;</span>) <span class="sc">+</span></span>
<span id="cb272-61"><a href="chm-raster-resolution-testing.html#cb272-61" tabindex="-1"></a>  harrypotter<span class="sc">::</span><span class="fu">scale_fill_hp_d</span>(<span class="at">option =</span> <span class="st">&quot;hermionegranger&quot;</span>) <span class="sc">+</span></span>
<span id="cb272-62"><a href="chm-raster-resolution-testing.html#cb272-62" tabindex="-1"></a>  harrypotter<span class="sc">::</span><span class="fu">scale_color_hp_d</span>(<span class="at">option =</span> <span class="st">&quot;hermionegranger&quot;</span>) <span class="sc">+</span></span>
<span id="cb272-63"><a href="chm-raster-resolution-testing.html#cb272-63" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_shape_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="dv">15</span>,<span class="dv">16</span>,<span class="dv">17</span>,<span class="dv">18</span>,<span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb272-64"><a href="chm-raster-resolution-testing.html#cb272-64" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">labels =</span> scales<span class="sc">::</span>percent, <span class="at">breaks =</span> scales<span class="sc">::</span><span class="fu">breaks_extended</span>(<span class="dv">10</span>)) <span class="sc">+</span></span>
<span id="cb272-65"><a href="chm-raster-resolution-testing.html#cb272-65" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;&quot;</span>, <span class="at">y =</span> <span class="st">&quot;median value&quot;</span>, <span class="at">color =</span> <span class="st">&quot;&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;&quot;</span>) <span class="sc">+</span></span>
<span id="cb272-66"><a href="chm-raster-resolution-testing.html#cb272-66" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb272-67"><a href="chm-raster-resolution-testing.html#cb272-67" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb272-68"><a href="chm-raster-resolution-testing.html#cb272-68" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;top&quot;</span></span>
<span id="cb272-69"><a href="chm-raster-resolution-testing.html#cb272-69" tabindex="-1"></a>    , <span class="at">strip.text =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb272-70"><a href="chm-raster-resolution-testing.html#cb272-70" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb272-71"><a href="chm-raster-resolution-testing.html#cb272-71" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">guides</span>(</span>
<span id="cb272-72"><a href="chm-raster-resolution-testing.html#cb272-72" tabindex="-1"></a>    <span class="at">color =</span> ggplot2<span class="sc">::</span><span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">shape =</span> <span class="dv">15</span>, <span class="at">linetype =</span> <span class="dv">0</span>, <span class="at">size =</span> <span class="dv">5</span>, <span class="at">alpha =</span> <span class="dv">1</span>))</span>
<span id="cb272-73"><a href="chm-raster-resolution-testing.html#cb272-73" tabindex="-1"></a>    , <span class="at">shape =</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb272-74"><a href="chm-raster-resolution-testing.html#cb272-74" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-241-1.png" width="1008" /></p>
<p><em>WHAT DID WE LEARN FROM THIS</em></p>
</div>
<div id="balanced_acc_assess" class="section level3 hasAnchor" number="8.6.3">
<h3><span class="header-section-number">8.6.3</span> Final recommended settings<a href="chm-raster-resolution-testing.html#balanced_acc_assess" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>let’s identify the best-performing parameter combinations that not only balance detection and quantification accuracy but also achieve the highest recall rates. we’ll select these by choosing any combination whose recall rate is at least one standard deviation above the average for this top group. if no combinations meet this criterion, we will instead select the top 10 combinations based on their recall rates.</p>
<div id="overall-across-chm-resolution-1" class="section level4 hasAnchor" number="8.6.3.1">
<h4><span class="header-section-number">8.6.3.1</span> Overall (across CHM resolution)<a href="chm-raster-resolution-testing.html#overall-across-chm-resolution-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>To select the best-performing parameter combinations, we will prioritize those that balance detection and quantification accuracy. From this group, we will then identify the settings that achieve the highest pile detection rates (recall). We emphasize that these recommendations are for users who can generate a CHM from the original point cloud. This is critical because creating a new CHM at the desired resolution is a fundamentally different process than simply disaggregating an existing, coarser raster.</p>
<p>we’ll use the F-Score and the average rank of the MAPE metrics across all form measurements (i.e. height, diameter, area, volume) to determine the best overall list</p>
<div class="sourceCode" id="cb273"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb273-1"><a href="chm-raster-resolution-testing.html#cb273-1" tabindex="-1"></a><span class="co"># param_combos_spectral_gt_agg %&gt;% nrow()</span></span>
<span id="cb273-2"><a href="chm-raster-resolution-testing.html#cb273-2" tabindex="-1"></a><span class="co"># param_combos_spectral_gt_agg %&gt;% </span></span>
<span id="cb273-3"><a href="chm-raster-resolution-testing.html#cb273-3" tabindex="-1"></a><span class="co">#   dplyr::filter(</span></span>
<span id="cb273-4"><a href="chm-raster-resolution-testing.html#cb273-4" tabindex="-1"></a><span class="co">#     dplyr::if_any(</span></span>
<span id="cb273-5"><a href="chm-raster-resolution-testing.html#cb273-5" tabindex="-1"></a><span class="co">#       tidyselect::ends_with(&quot;_mape&quot;)</span></span>
<span id="cb273-6"><a href="chm-raster-resolution-testing.html#cb273-6" tabindex="-1"></a><span class="co">#       , is.na</span></span>
<span id="cb273-7"><a href="chm-raster-resolution-testing.html#cb273-7" tabindex="-1"></a><span class="co">#     )</span></span>
<span id="cb273-8"><a href="chm-raster-resolution-testing.html#cb273-8" tabindex="-1"></a><span class="co">#   ) %&gt;% </span></span>
<span id="cb273-9"><a href="chm-raster-resolution-testing.html#cb273-9" tabindex="-1"></a><span class="co">#   View()</span></span>
<span id="cb273-10"><a href="chm-raster-resolution-testing.html#cb273-10" tabindex="-1"></a>  </span>
<span id="cb273-11"><a href="chm-raster-resolution-testing.html#cb273-11" tabindex="-1"></a>param_combos_spectral_ranked <span class="ot">&lt;-</span></span>
<span id="cb273-12"><a href="chm-raster-resolution-testing.html#cb273-12" tabindex="-1"></a>  param_combos_spectral_gt_agg <span class="sc">%&gt;%</span></span>
<span id="cb273-13"><a href="chm-raster-resolution-testing.html#cb273-13" tabindex="-1"></a>  <span class="do">##########</span></span>
<span id="cb273-14"><a href="chm-raster-resolution-testing.html#cb273-14" tabindex="-1"></a>  <span class="co"># first. find overall top combinations irrespective of CHM res</span></span>
<span id="cb273-15"><a href="chm-raster-resolution-testing.html#cb273-15" tabindex="-1"></a>  <span class="do">##########</span></span>
<span id="cb273-16"><a href="chm-raster-resolution-testing.html#cb273-16" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb273-17"><a href="chm-raster-resolution-testing.html#cb273-17" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb273-18"><a href="chm-raster-resolution-testing.html#cb273-18" tabindex="-1"></a>    <span class="co"># label combining params</span></span>
<span id="cb273-19"><a href="chm-raster-resolution-testing.html#cb273-19" tabindex="-1"></a>    <span class="at">lab =</span> stringr<span class="sc">::</span><span class="fu">str_c</span>(max_ht_m,max_area_m2,convexity_pct,circle_fit_iou_pct,chm_res_m,spectral_weight, <span class="at">sep =</span> <span class="st">&quot;:&quot;</span>)</span>
<span id="cb273-20"><a href="chm-raster-resolution-testing.html#cb273-20" tabindex="-1"></a>    , dplyr<span class="sc">::</span><span class="fu">across</span>(</span>
<span id="cb273-21"><a href="chm-raster-resolution-testing.html#cb273-21" tabindex="-1"></a>      <span class="at">.cols =</span> <span class="fu">c</span>(tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_mape&quot;</span>))</span>
<span id="cb273-22"><a href="chm-raster-resolution-testing.html#cb273-22" tabindex="-1"></a>      , <span class="at">.fn =</span> <span class="sc">~</span>dplyr<span class="sc">::</span><span class="fu">percent_rank</span>(<span class="sc">-</span>.x)</span>
<span id="cb273-23"><a href="chm-raster-resolution-testing.html#cb273-23" tabindex="-1"></a>      , <span class="at">.names =</span> <span class="st">&quot;ovrall_pct_rank_quant_{.col}&quot;</span></span>
<span id="cb273-24"><a href="chm-raster-resolution-testing.html#cb273-24" tabindex="-1"></a>    )</span>
<span id="cb273-25"><a href="chm-raster-resolution-testing.html#cb273-25" tabindex="-1"></a>    , dplyr<span class="sc">::</span><span class="fu">across</span>(</span>
<span id="cb273-26"><a href="chm-raster-resolution-testing.html#cb273-26" tabindex="-1"></a>      <span class="at">.cols =</span> <span class="fu">c</span>(f_score)</span>
<span id="cb273-27"><a href="chm-raster-resolution-testing.html#cb273-27" tabindex="-1"></a>      <span class="co"># .cols = c(f_score,recall)</span></span>
<span id="cb273-28"><a href="chm-raster-resolution-testing.html#cb273-28" tabindex="-1"></a>      , <span class="at">.fn =</span> <span class="sc">~</span>dplyr<span class="sc">::</span><span class="fu">percent_rank</span>(.x)</span>
<span id="cb273-29"><a href="chm-raster-resolution-testing.html#cb273-29" tabindex="-1"></a>      , <span class="at">.names =</span> <span class="st">&quot;ovrall_pct_rank_det_{.col}&quot;</span></span>
<span id="cb273-30"><a href="chm-raster-resolution-testing.html#cb273-30" tabindex="-1"></a>    )</span>
<span id="cb273-31"><a href="chm-raster-resolution-testing.html#cb273-31" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb273-32"><a href="chm-raster-resolution-testing.html#cb273-32" tabindex="-1"></a>  <span class="do">##########</span></span>
<span id="cb273-33"><a href="chm-raster-resolution-testing.html#cb273-33" tabindex="-1"></a>  <span class="co"># second. find top combinations by CHM res</span></span>
<span id="cb273-34"><a href="chm-raster-resolution-testing.html#cb273-34" tabindex="-1"></a>  <span class="do">##########</span></span>
<span id="cb273-35"><a href="chm-raster-resolution-testing.html#cb273-35" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(chm_res_m) <span class="sc">%&gt;%</span> </span>
<span id="cb273-36"><a href="chm-raster-resolution-testing.html#cb273-36" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb273-37"><a href="chm-raster-resolution-testing.html#cb273-37" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">across</span>(</span>
<span id="cb273-38"><a href="chm-raster-resolution-testing.html#cb273-38" tabindex="-1"></a>      <span class="at">.cols =</span> <span class="fu">c</span>(tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_mape&quot;</span>) <span class="sc">&amp;</span> <span class="sc">!</span>tidyselect<span class="sc">::</span><span class="fu">starts_with</span>(<span class="st">&quot;ovrall_pct_rank_&quot;</span>))</span>
<span id="cb273-39"><a href="chm-raster-resolution-testing.html#cb273-39" tabindex="-1"></a>      , <span class="at">.fn =</span> <span class="sc">~</span>dplyr<span class="sc">::</span><span class="fu">percent_rank</span>(<span class="sc">-</span>.x)</span>
<span id="cb273-40"><a href="chm-raster-resolution-testing.html#cb273-40" tabindex="-1"></a>      , <span class="at">.names =</span> <span class="st">&quot;chm_pct_rank_quant_{.col}&quot;</span></span>
<span id="cb273-41"><a href="chm-raster-resolution-testing.html#cb273-41" tabindex="-1"></a>    )</span>
<span id="cb273-42"><a href="chm-raster-resolution-testing.html#cb273-42" tabindex="-1"></a>    , dplyr<span class="sc">::</span><span class="fu">across</span>(</span>
<span id="cb273-43"><a href="chm-raster-resolution-testing.html#cb273-43" tabindex="-1"></a>      <span class="at">.cols =</span> <span class="fu">c</span>(f_score)</span>
<span id="cb273-44"><a href="chm-raster-resolution-testing.html#cb273-44" tabindex="-1"></a>      <span class="co"># .cols = c(f_score,recall)</span></span>
<span id="cb273-45"><a href="chm-raster-resolution-testing.html#cb273-45" tabindex="-1"></a>      , <span class="at">.fn =</span> <span class="sc">~</span>dplyr<span class="sc">::</span><span class="fu">percent_rank</span>(.x)</span>
<span id="cb273-46"><a href="chm-raster-resolution-testing.html#cb273-46" tabindex="-1"></a>      , <span class="at">.names =</span> <span class="st">&quot;chm_pct_rank_det_{.col}&quot;</span></span>
<span id="cb273-47"><a href="chm-raster-resolution-testing.html#cb273-47" tabindex="-1"></a>    )</span>
<span id="cb273-48"><a href="chm-raster-resolution-testing.html#cb273-48" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb273-49"><a href="chm-raster-resolution-testing.html#cb273-49" tabindex="-1"></a>  <span class="co"># now get the max of these pct ranks by row</span></span>
<span id="cb273-50"><a href="chm-raster-resolution-testing.html#cb273-50" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rowwise</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb273-51"><a href="chm-raster-resolution-testing.html#cb273-51" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb273-52"><a href="chm-raster-resolution-testing.html#cb273-52" tabindex="-1"></a>    <span class="at">ovrall_pct_rank_quant_mean =</span> <span class="fu">mean</span>(</span>
<span id="cb273-53"><a href="chm-raster-resolution-testing.html#cb273-53" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">c_across</span>(</span>
<span id="cb273-54"><a href="chm-raster-resolution-testing.html#cb273-54" tabindex="-1"></a>        tidyselect<span class="sc">::</span><span class="fu">starts_with</span>(<span class="st">&quot;ovrall_pct_rank_quant_&quot;</span>)</span>
<span id="cb273-55"><a href="chm-raster-resolution-testing.html#cb273-55" tabindex="-1"></a>      )</span>
<span id="cb273-56"><a href="chm-raster-resolution-testing.html#cb273-56" tabindex="-1"></a>      , <span class="at">na.rm =</span> T</span>
<span id="cb273-57"><a href="chm-raster-resolution-testing.html#cb273-57" tabindex="-1"></a>    )</span>
<span id="cb273-58"><a href="chm-raster-resolution-testing.html#cb273-58" tabindex="-1"></a>    , <span class="at">ovrall_pct_rank_det_mean =</span> <span class="fu">mean</span>(</span>
<span id="cb273-59"><a href="chm-raster-resolution-testing.html#cb273-59" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">c_across</span>(</span>
<span id="cb273-60"><a href="chm-raster-resolution-testing.html#cb273-60" tabindex="-1"></a>        tidyselect<span class="sc">::</span><span class="fu">starts_with</span>(<span class="st">&quot;ovrall_pct_rank_det_&quot;</span>)</span>
<span id="cb273-61"><a href="chm-raster-resolution-testing.html#cb273-61" tabindex="-1"></a>      )</span>
<span id="cb273-62"><a href="chm-raster-resolution-testing.html#cb273-62" tabindex="-1"></a>      , <span class="at">na.rm =</span> T</span>
<span id="cb273-63"><a href="chm-raster-resolution-testing.html#cb273-63" tabindex="-1"></a>    )</span>
<span id="cb273-64"><a href="chm-raster-resolution-testing.html#cb273-64" tabindex="-1"></a>    , <span class="at">chm_pct_rank_quant_mean =</span> <span class="fu">mean</span>(</span>
<span id="cb273-65"><a href="chm-raster-resolution-testing.html#cb273-65" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">c_across</span>(</span>
<span id="cb273-66"><a href="chm-raster-resolution-testing.html#cb273-66" tabindex="-1"></a>        tidyselect<span class="sc">::</span><span class="fu">starts_with</span>(<span class="st">&quot;chm_pct_rank_quant_&quot;</span>)</span>
<span id="cb273-67"><a href="chm-raster-resolution-testing.html#cb273-67" tabindex="-1"></a>      )</span>
<span id="cb273-68"><a href="chm-raster-resolution-testing.html#cb273-68" tabindex="-1"></a>      , <span class="at">na.rm =</span> T</span>
<span id="cb273-69"><a href="chm-raster-resolution-testing.html#cb273-69" tabindex="-1"></a>    )</span>
<span id="cb273-70"><a href="chm-raster-resolution-testing.html#cb273-70" tabindex="-1"></a>    , <span class="at">chm_pct_rank_det_mean =</span> <span class="fu">mean</span>(</span>
<span id="cb273-71"><a href="chm-raster-resolution-testing.html#cb273-71" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">c_across</span>(</span>
<span id="cb273-72"><a href="chm-raster-resolution-testing.html#cb273-72" tabindex="-1"></a>        tidyselect<span class="sc">::</span><span class="fu">starts_with</span>(<span class="st">&quot;chm_pct_rank_det_&quot;</span>)</span>
<span id="cb273-73"><a href="chm-raster-resolution-testing.html#cb273-73" tabindex="-1"></a>      )</span>
<span id="cb273-74"><a href="chm-raster-resolution-testing.html#cb273-74" tabindex="-1"></a>      , <span class="at">na.rm =</span> T</span>
<span id="cb273-75"><a href="chm-raster-resolution-testing.html#cb273-75" tabindex="-1"></a>    )</span>
<span id="cb273-76"><a href="chm-raster-resolution-testing.html#cb273-76" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb273-77"><a href="chm-raster-resolution-testing.html#cb273-77" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb273-78"><a href="chm-raster-resolution-testing.html#cb273-78" tabindex="-1"></a>  <span class="co"># fill na values</span></span>
<span id="cb273-79"><a href="chm-raster-resolution-testing.html#cb273-79" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb273-80"><a href="chm-raster-resolution-testing.html#cb273-80" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">across</span>(</span>
<span id="cb273-81"><a href="chm-raster-resolution-testing.html#cb273-81" tabindex="-1"></a>      <span class="at">.cols =</span> <span class="fu">c</span>(ovrall_pct_rank_det_mean, ovrall_pct_rank_quant_mean, chm_pct_rank_det_mean, chm_pct_rank_quant_mean)</span>
<span id="cb273-82"><a href="chm-raster-resolution-testing.html#cb273-82" tabindex="-1"></a>      , <span class="at">.fn =</span> <span class="sc">~</span><span class="fu">ifelse</span>(<span class="fu">is.na</span>(.x),<span class="dv">0</span>,.x)</span>
<span id="cb273-83"><a href="chm-raster-resolution-testing.html#cb273-83" tabindex="-1"></a>    )</span>
<span id="cb273-84"><a href="chm-raster-resolution-testing.html#cb273-84" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb273-85"><a href="chm-raster-resolution-testing.html#cb273-85" tabindex="-1"></a>  <span class="co"># dplyr::select(ovrall_pct_rank_det_mean, ovrall_pct_rank_quant_mean) %&gt;% summary()</span></span>
<span id="cb273-86"><a href="chm-raster-resolution-testing.html#cb273-86" tabindex="-1"></a>  <span class="co"># now make quadrant var</span></span>
<span id="cb273-87"><a href="chm-raster-resolution-testing.html#cb273-87" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb273-88"><a href="chm-raster-resolution-testing.html#cb273-88" tabindex="-1"></a>    <span class="co"># groupings for the quadrant plot</span></span>
<span id="cb273-89"><a href="chm-raster-resolution-testing.html#cb273-89" tabindex="-1"></a>    <span class="at">ovrall_accuracy_grp =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb273-90"><a href="chm-raster-resolution-testing.html#cb273-90" tabindex="-1"></a>        ovrall_pct_rank_det_mean<span class="sc">&gt;=</span><span class="fl">0.95</span> <span class="sc">&amp;</span> ovrall_pct_rank_quant_mean<span class="sc">&gt;=</span><span class="fl">0.95</span> <span class="sc">~</span> <span class="dv">1</span></span>
<span id="cb273-91"><a href="chm-raster-resolution-testing.html#cb273-91" tabindex="-1"></a>        , ovrall_pct_rank_det_mean<span class="sc">&gt;=</span><span class="fl">0.90</span> <span class="sc">&amp;</span> ovrall_pct_rank_quant_mean<span class="sc">&gt;=</span><span class="fl">0.90</span> <span class="sc">~</span> <span class="dv">2</span></span>
<span id="cb273-92"><a href="chm-raster-resolution-testing.html#cb273-92" tabindex="-1"></a>        , ovrall_pct_rank_det_mean<span class="sc">&gt;=</span><span class="fl">0.75</span> <span class="sc">&amp;</span> ovrall_pct_rank_quant_mean<span class="sc">&gt;=</span><span class="fl">0.75</span> <span class="sc">~</span> <span class="dv">3</span></span>
<span id="cb273-93"><a href="chm-raster-resolution-testing.html#cb273-93" tabindex="-1"></a>        , ovrall_pct_rank_det_mean<span class="sc">&gt;=</span><span class="fl">0.50</span> <span class="sc">&amp;</span> ovrall_pct_rank_quant_mean<span class="sc">&gt;=</span><span class="fl">0.50</span> <span class="sc">~</span> <span class="dv">4</span></span>
<span id="cb273-94"><a href="chm-raster-resolution-testing.html#cb273-94" tabindex="-1"></a>        , ovrall_pct_rank_det_mean<span class="sc">&gt;=</span><span class="fl">0.50</span> <span class="sc">&amp;</span> ovrall_pct_rank_quant_mean<span class="sc">&lt;</span><span class="fl">0.50</span> <span class="sc">~</span> <span class="dv">5</span></span>
<span id="cb273-95"><a href="chm-raster-resolution-testing.html#cb273-95" tabindex="-1"></a>        , ovrall_pct_rank_det_mean<span class="sc">&lt;</span><span class="fl">0.50</span> <span class="sc">&amp;</span> ovrall_pct_rank_quant_mean<span class="sc">&gt;=</span><span class="fl">0.50</span> <span class="sc">~</span> <span class="dv">6</span></span>
<span id="cb273-96"><a href="chm-raster-resolution-testing.html#cb273-96" tabindex="-1"></a>        , T <span class="sc">~</span> <span class="dv">7</span></span>
<span id="cb273-97"><a href="chm-raster-resolution-testing.html#cb273-97" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span> </span>
<span id="cb273-98"><a href="chm-raster-resolution-testing.html#cb273-98" tabindex="-1"></a>      <span class="fu">factor</span>(</span>
<span id="cb273-99"><a href="chm-raster-resolution-testing.html#cb273-99" tabindex="-1"></a>        <span class="at">ordered =</span> T</span>
<span id="cb273-100"><a href="chm-raster-resolution-testing.html#cb273-100" tabindex="-1"></a>        , <span class="at">levels =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">7</span></span>
<span id="cb273-101"><a href="chm-raster-resolution-testing.html#cb273-101" tabindex="-1"></a>        , <span class="at">labels =</span> <span class="fu">c</span>(</span>
<span id="cb273-102"><a href="chm-raster-resolution-testing.html#cb273-102" tabindex="-1"></a>          <span class="st">&quot;top 5% detection &amp; quantification&quot;</span> <span class="co"># ovrall_pct_rank_mean&gt;=0.95 &amp; ovrall_pct_rank_f_score&gt;=0.95 ~ 1</span></span>
<span id="cb273-103"><a href="chm-raster-resolution-testing.html#cb273-103" tabindex="-1"></a>          , <span class="st">&quot;top 10% detection &amp; quantification&quot;</span> <span class="co"># ovrall_pct_rank_mean&gt;=0.90 &amp; ovrall_pct_rank_f_score&gt;=0.90 ~ 2</span></span>
<span id="cb273-104"><a href="chm-raster-resolution-testing.html#cb273-104" tabindex="-1"></a>          , <span class="st">&quot;top 25% detection &amp; quantification&quot;</span> <span class="co"># ovrall_pct_rank_mean&gt;=0.75 &amp; ovrall_pct_rank_f_score&gt;=0.75 ~ 3</span></span>
<span id="cb273-105"><a href="chm-raster-resolution-testing.html#cb273-105" tabindex="-1"></a>          , <span class="st">&quot;top 50% detection &amp; quantification&quot;</span> <span class="co"># ovrall_pct_rank_mean&gt;=0.50 &amp; ovrall_pct_rank_f_score&gt;=0.50 ~ 4</span></span>
<span id="cb273-106"><a href="chm-raster-resolution-testing.html#cb273-106" tabindex="-1"></a>          , <span class="st">&quot;top 50% quantification&quot;</span> <span class="co"># ovrall_pct_rank_mean&gt;=0.50 &amp; ovrall_pct_rank_f_score&lt;0.50 ~ 5</span></span>
<span id="cb273-107"><a href="chm-raster-resolution-testing.html#cb273-107" tabindex="-1"></a>          , <span class="st">&quot;top 50% detection&quot;</span> <span class="co"># ovrall_pct_rank_mean&lt;0.50 &amp; ovrall_pct_rank_f_score&gt;=0.50 ~ 6</span></span>
<span id="cb273-108"><a href="chm-raster-resolution-testing.html#cb273-108" tabindex="-1"></a>          , <span class="st">&quot;bottom 50% detection &amp; quantification&quot;</span></span>
<span id="cb273-109"><a href="chm-raster-resolution-testing.html#cb273-109" tabindex="-1"></a>        )</span>
<span id="cb273-110"><a href="chm-raster-resolution-testing.html#cb273-110" tabindex="-1"></a>      )</span>
<span id="cb273-111"><a href="chm-raster-resolution-testing.html#cb273-111" tabindex="-1"></a>    , <span class="at">chm_accuracy_grp =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb273-112"><a href="chm-raster-resolution-testing.html#cb273-112" tabindex="-1"></a>        chm_pct_rank_det_mean<span class="sc">&gt;=</span><span class="fl">0.95</span> <span class="sc">&amp;</span> chm_pct_rank_quant_mean<span class="sc">&gt;=</span><span class="fl">0.95</span> <span class="sc">~</span> <span class="dv">1</span></span>
<span id="cb273-113"><a href="chm-raster-resolution-testing.html#cb273-113" tabindex="-1"></a>        , chm_pct_rank_det_mean<span class="sc">&gt;=</span><span class="fl">0.90</span> <span class="sc">&amp;</span> chm_pct_rank_quant_mean<span class="sc">&gt;=</span><span class="fl">0.90</span> <span class="sc">~</span> <span class="dv">2</span></span>
<span id="cb273-114"><a href="chm-raster-resolution-testing.html#cb273-114" tabindex="-1"></a>        , chm_pct_rank_det_mean<span class="sc">&gt;=</span><span class="fl">0.75</span> <span class="sc">&amp;</span> chm_pct_rank_quant_mean<span class="sc">&gt;=</span><span class="fl">0.75</span> <span class="sc">~</span> <span class="dv">3</span></span>
<span id="cb273-115"><a href="chm-raster-resolution-testing.html#cb273-115" tabindex="-1"></a>        , chm_pct_rank_det_mean<span class="sc">&gt;=</span><span class="fl">0.50</span> <span class="sc">&amp;</span> chm_pct_rank_quant_mean<span class="sc">&gt;=</span><span class="fl">0.50</span> <span class="sc">~</span> <span class="dv">4</span></span>
<span id="cb273-116"><a href="chm-raster-resolution-testing.html#cb273-116" tabindex="-1"></a>        , chm_pct_rank_det_mean<span class="sc">&gt;=</span><span class="fl">0.50</span> <span class="sc">&amp;</span> chm_pct_rank_quant_mean<span class="sc">&lt;</span><span class="fl">0.50</span> <span class="sc">~</span> <span class="dv">5</span></span>
<span id="cb273-117"><a href="chm-raster-resolution-testing.html#cb273-117" tabindex="-1"></a>        , chm_pct_rank_det_mean<span class="sc">&lt;</span><span class="fl">0.50</span> <span class="sc">&amp;</span> chm_pct_rank_quant_mean<span class="sc">&gt;=</span><span class="fl">0.50</span> <span class="sc">~</span> <span class="dv">6</span></span>
<span id="cb273-118"><a href="chm-raster-resolution-testing.html#cb273-118" tabindex="-1"></a>        , T <span class="sc">~</span> <span class="dv">7</span></span>
<span id="cb273-119"><a href="chm-raster-resolution-testing.html#cb273-119" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span> </span>
<span id="cb273-120"><a href="chm-raster-resolution-testing.html#cb273-120" tabindex="-1"></a>      <span class="fu">factor</span>(</span>
<span id="cb273-121"><a href="chm-raster-resolution-testing.html#cb273-121" tabindex="-1"></a>        <span class="at">ordered =</span> T</span>
<span id="cb273-122"><a href="chm-raster-resolution-testing.html#cb273-122" tabindex="-1"></a>        , <span class="at">levels =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">7</span></span>
<span id="cb273-123"><a href="chm-raster-resolution-testing.html#cb273-123" tabindex="-1"></a>        , <span class="at">labels =</span> <span class="fu">c</span>(</span>
<span id="cb273-124"><a href="chm-raster-resolution-testing.html#cb273-124" tabindex="-1"></a>          <span class="st">&quot;top 5% detection &amp; quantification&quot;</span> <span class="co"># chm_pct_rank_mean&gt;=0.95 &amp; chm_pct_rank_f_score&gt;=0.95 ~ 1</span></span>
<span id="cb273-125"><a href="chm-raster-resolution-testing.html#cb273-125" tabindex="-1"></a>          , <span class="st">&quot;top 10% detection &amp; quantification&quot;</span> <span class="co"># chm_pct_rank_mean&gt;=0.90 &amp; chm_pct_rank_f_score&gt;=0.90 ~ 2</span></span>
<span id="cb273-126"><a href="chm-raster-resolution-testing.html#cb273-126" tabindex="-1"></a>          , <span class="st">&quot;top 25% detection &amp; quantification&quot;</span> <span class="co"># chm_pct_rank_mean&gt;=0.75 &amp; chm_pct_rank_f_score&gt;=0.75 ~ 3</span></span>
<span id="cb273-127"><a href="chm-raster-resolution-testing.html#cb273-127" tabindex="-1"></a>          , <span class="st">&quot;top 50% detection &amp; quantification&quot;</span> <span class="co"># chm_pct_rank_mean&gt;=0.50 &amp; chm_pct_rank_f_score&gt;=0.50 ~ 4</span></span>
<span id="cb273-128"><a href="chm-raster-resolution-testing.html#cb273-128" tabindex="-1"></a>          , <span class="st">&quot;top 50% quantification&quot;</span> <span class="co"># chm_pct_rank_mean&gt;=0.50 &amp; chm_pct_rank_f_score&lt;0.50 ~ 5</span></span>
<span id="cb273-129"><a href="chm-raster-resolution-testing.html#cb273-129" tabindex="-1"></a>          , <span class="st">&quot;top 50% detection&quot;</span> <span class="co"># chm_pct_rank_mean&lt;0.50 &amp; chm_pct_rank_f_score&gt;=0.50 ~ 6</span></span>
<span id="cb273-130"><a href="chm-raster-resolution-testing.html#cb273-130" tabindex="-1"></a>          , <span class="st">&quot;bottom 50% detection &amp; quantification&quot;</span></span>
<span id="cb273-131"><a href="chm-raster-resolution-testing.html#cb273-131" tabindex="-1"></a>        )</span>
<span id="cb273-132"><a href="chm-raster-resolution-testing.html#cb273-132" tabindex="-1"></a>      )</span>
<span id="cb273-133"><a href="chm-raster-resolution-testing.html#cb273-133" tabindex="-1"></a>    , </span>
<span id="cb273-134"><a href="chm-raster-resolution-testing.html#cb273-134" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb273-135"><a href="chm-raster-resolution-testing.html#cb273-135" tabindex="-1"></a>  <span class="do">##########</span></span>
<span id="cb273-136"><a href="chm-raster-resolution-testing.html#cb273-136" tabindex="-1"></a>  <span class="co"># first. find overall top combinations irrespective of CHM res</span></span>
<span id="cb273-137"><a href="chm-raster-resolution-testing.html#cb273-137" tabindex="-1"></a>  <span class="do">##########</span></span>
<span id="cb273-138"><a href="chm-raster-resolution-testing.html#cb273-138" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb273-139"><a href="chm-raster-resolution-testing.html#cb273-139" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb273-140"><a href="chm-raster-resolution-testing.html#cb273-140" tabindex="-1"></a>    <span class="at">ovrall_balanced_pct_rank =</span> dplyr<span class="sc">::</span><span class="fu">percent_rank</span>( (ovrall_pct_rank_det_mean<span class="sc">+</span>ovrall_pct_rank_quant_mean)<span class="sc">/</span><span class="dv">2</span> ) <span class="co"># equally weight quant and detection</span></span>
<span id="cb273-141"><a href="chm-raster-resolution-testing.html#cb273-141" tabindex="-1"></a>    , <span class="at">ovrall_lab =</span> forcats<span class="sc">::</span><span class="fu">fct_reorder</span>(lab, ovrall_balanced_pct_rank)</span>
<span id="cb273-142"><a href="chm-raster-resolution-testing.html#cb273-142" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb273-143"><a href="chm-raster-resolution-testing.html#cb273-143" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(<span class="fu">desc</span>(ovrall_balanced_pct_rank),<span class="fu">desc</span>(ovrall_pct_rank_det_mean),<span class="fu">desc</span>(ovrall_pct_rank_quant_mean)) <span class="sc">%&gt;%</span> </span>
<span id="cb273-144"><a href="chm-raster-resolution-testing.html#cb273-144" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb273-145"><a href="chm-raster-resolution-testing.html#cb273-145" tabindex="-1"></a>    <span class="at">ovrall_balanced_rank =</span> dplyr<span class="sc">::</span><span class="fu">row_number</span>()</span>
<span id="cb273-146"><a href="chm-raster-resolution-testing.html#cb273-146" tabindex="-1"></a>    <span class="co"># is_top_overall = using rows in case not all combos resulted in piles and/or </span></span>
<span id="cb273-147"><a href="chm-raster-resolution-testing.html#cb273-147" tabindex="-1"></a>      <span class="co"># there are many ties in the data leading to no records with a percent rank &lt;= pct_th_top (e.g. many tied at 98%)</span></span>
<span id="cb273-148"><a href="chm-raster-resolution-testing.html#cb273-148" tabindex="-1"></a>    , <span class="at">is_top_overall =</span> dplyr<span class="sc">::</span><span class="fu">row_number</span>()<span class="sc">&lt;=</span>(n_combos_tested_spectral<span class="sc">*</span>pct_th_top)</span>
<span id="cb273-149"><a href="chm-raster-resolution-testing.html#cb273-149" tabindex="-1"></a>      <span class="co"># ovrall_balanced_pct_rank&gt;=(1-pct_th_top)</span></span>
<span id="cb273-150"><a href="chm-raster-resolution-testing.html#cb273-150" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb273-151"><a href="chm-raster-resolution-testing.html#cb273-151" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(<span class="fu">desc</span>(is_top_overall),<span class="fu">desc</span>(recall),<span class="fu">desc</span>(ovrall_pct_rank_det_mean),<span class="fu">desc</span>(ovrall_pct_rank_quant_mean),ovrall_balanced_rank) <span class="sc">%&gt;%</span> </span>
<span id="cb273-152"><a href="chm-raster-resolution-testing.html#cb273-152" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">is_final_selection =</span> is_top_overall <span class="sc">&amp;</span> dplyr<span class="sc">::</span><span class="fu">row_number</span>()<span class="sc">&lt;=</span>n_th_top) <span class="sc">%&gt;%</span> </span>
<span id="cb273-153"><a href="chm-raster-resolution-testing.html#cb273-153" tabindex="-1"></a>  <span class="do">##########</span></span>
<span id="cb273-154"><a href="chm-raster-resolution-testing.html#cb273-154" tabindex="-1"></a>  <span class="co"># second. find top combinations by CHM res</span></span>
<span id="cb273-155"><a href="chm-raster-resolution-testing.html#cb273-155" tabindex="-1"></a>  <span class="do">##########</span></span>
<span id="cb273-156"><a href="chm-raster-resolution-testing.html#cb273-156" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(chm_res_m) <span class="sc">%&gt;%</span> </span>
<span id="cb273-157"><a href="chm-raster-resolution-testing.html#cb273-157" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb273-158"><a href="chm-raster-resolution-testing.html#cb273-158" tabindex="-1"></a>    <span class="at">chm_balanced_pct_rank =</span> dplyr<span class="sc">::</span><span class="fu">percent_rank</span>( (chm_pct_rank_det_mean<span class="sc">+</span>chm_pct_rank_quant_mean)<span class="sc">/</span><span class="dv">2</span> ) <span class="co"># equally weight quant and detection</span></span>
<span id="cb273-159"><a href="chm-raster-resolution-testing.html#cb273-159" tabindex="-1"></a>    , <span class="at">chm_lab =</span> forcats<span class="sc">::</span><span class="fu">fct_reorder</span>(lab, chm_balanced_pct_rank)</span>
<span id="cb273-160"><a href="chm-raster-resolution-testing.html#cb273-160" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb273-161"><a href="chm-raster-resolution-testing.html#cb273-161" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(chm_res_m,<span class="fu">desc</span>(chm_balanced_pct_rank),<span class="fu">desc</span>(chm_pct_rank_det_mean),<span class="fu">desc</span>(chm_pct_rank_quant_mean),ovrall_balanced_rank) <span class="sc">%&gt;%</span> </span>
<span id="cb273-162"><a href="chm-raster-resolution-testing.html#cb273-162" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb273-163"><a href="chm-raster-resolution-testing.html#cb273-163" tabindex="-1"></a>    <span class="at">chm_balanced_rank =</span> dplyr<span class="sc">::</span><span class="fu">row_number</span>()</span>
<span id="cb273-164"><a href="chm-raster-resolution-testing.html#cb273-164" tabindex="-1"></a>    <span class="co"># is_top_chm = using rows in case not all combos resulted in piles and/or </span></span>
<span id="cb273-165"><a href="chm-raster-resolution-testing.html#cb273-165" tabindex="-1"></a>      <span class="co"># there are many ties in the data leading to no records with a percent rank &lt;= pct_th_top (e.g. many tied at 98%)</span></span>
<span id="cb273-166"><a href="chm-raster-resolution-testing.html#cb273-166" tabindex="-1"></a>    , <span class="at">is_top_chm =</span> dplyr<span class="sc">::</span><span class="fu">row_number</span>()<span class="sc">&lt;=</span>n_combos_top_spectral_chm <span class="co"># double it so we look at more than 14??</span></span>
<span id="cb273-167"><a href="chm-raster-resolution-testing.html#cb273-167" tabindex="-1"></a>      <span class="co"># chm_balanced_pct_rank&gt;=(1-pct_th_top)</span></span>
<span id="cb273-168"><a href="chm-raster-resolution-testing.html#cb273-168" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb273-169"><a href="chm-raster-resolution-testing.html#cb273-169" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(chm_res_m,<span class="fu">desc</span>(is_top_chm),<span class="fu">desc</span>(recall),<span class="fu">desc</span>(chm_pct_rank_det_mean),<span class="fu">desc</span>(chm_pct_rank_quant_mean),ovrall_balanced_rank) <span class="sc">%&gt;%</span> </span>
<span id="cb273-170"><a href="chm-raster-resolution-testing.html#cb273-170" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">is_final_selection_chm =</span> is_top_chm <span class="sc">&amp;</span> dplyr<span class="sc">::</span><span class="fu">row_number</span>()<span class="sc">&lt;=</span>n_th_top_chm) <span class="sc">%&gt;%</span> <span class="co"># half it because it&#39;s going to be a lot to show in our facet ggplot</span></span>
<span id="cb273-171"><a href="chm-raster-resolution-testing.html#cb273-171" tabindex="-1"></a>  <span class="do">##### clean up</span></span>
<span id="cb273-172"><a href="chm-raster-resolution-testing.html#cb273-172" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb273-173"><a href="chm-raster-resolution-testing.html#cb273-173" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(</span>
<span id="cb273-174"><a href="chm-raster-resolution-testing.html#cb273-174" tabindex="-1"></a>    <span class="fu">c</span>(tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_mape&quot;</span>) <span class="sc">&amp;</span> tidyselect<span class="sc">::</span><span class="fu">starts_with</span>(<span class="st">&quot;ovrall_pct_rank_&quot;</span>))</span>
<span id="cb273-175"><a href="chm-raster-resolution-testing.html#cb273-175" tabindex="-1"></a>    , <span class="fu">c</span>(tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_mape&quot;</span>) <span class="sc">&amp;</span> tidyselect<span class="sc">::</span><span class="fu">starts_with</span>(<span class="st">&quot;chm_pct_rank_&quot;</span>))</span>
<span id="cb273-176"><a href="chm-raster-resolution-testing.html#cb273-176" tabindex="-1"></a>    , <span class="fu">c</span>(tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_f_score&quot;</span>) <span class="sc">&amp;</span> tidyselect<span class="sc">::</span><span class="fu">starts_with</span>(<span class="st">&quot;ovrall_pct_rank_&quot;</span>))</span>
<span id="cb273-177"><a href="chm-raster-resolution-testing.html#cb273-177" tabindex="-1"></a>    , <span class="fu">c</span>(tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_f_score&quot;</span>) <span class="sc">&amp;</span> tidyselect<span class="sc">::</span><span class="fu">starts_with</span>(<span class="st">&quot;chm_pct_rank_&quot;</span>))</span>
<span id="cb273-178"><a href="chm-raster-resolution-testing.html#cb273-178" tabindex="-1"></a>  ))</span>
<span id="cb273-179"><a href="chm-raster-resolution-testing.html#cb273-179" tabindex="-1"></a><span class="co"># huh?</span></span>
<span id="cb273-180"><a href="chm-raster-resolution-testing.html#cb273-180" tabindex="-1"></a><span class="co"># param_combos_spectral_ranked %&gt;% dplyr::glimpse()</span></span>
<span id="cb273-181"><a href="chm-raster-resolution-testing.html#cb273-181" tabindex="-1"></a><span class="co"># param_combos_spectral_ranked %&gt;% dplyr::count(is_final_selection)</span></span></code></pre></div>
<p>to determine the combinations that achieved the best balance between both detection and quantification accuracy, we’re selecting the parameter combinations that are in the upper-right of the quadrant plot. That is, the parameter combinations that performed best at both pile detection accuracy and pile form quantification accuracy</p>
<div class="sourceCode" id="cb274"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb274-1"><a href="chm-raster-resolution-testing.html#cb274-1" tabindex="-1"></a><span class="co"># plot</span></span>
<span id="cb274-2"><a href="chm-raster-resolution-testing.html#cb274-2" tabindex="-1"></a>param_combos_spectral_ranked <span class="sc">%&gt;%</span>   </span>
<span id="cb274-3"><a href="chm-raster-resolution-testing.html#cb274-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">slice_sample</span>(<span class="at">prop =</span> (<span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb274-4"><a href="chm-raster-resolution-testing.html#cb274-4" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(</span>
<span id="cb274-5"><a href="chm-raster-resolution-testing.html#cb274-5" tabindex="-1"></a>    <span class="at">mapping=</span>ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> ovrall_pct_rank_det_mean, <span class="at">y =</span> ovrall_pct_rank_quant_mean, <span class="at">color =</span> ovrall_accuracy_grp)</span>
<span id="cb274-6"><a href="chm-raster-resolution-testing.html#cb274-6" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb274-7"><a href="chm-raster-resolution-testing.html#cb274-7" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fl">0.5</span>, <span class="at">color =</span> <span class="st">&quot;gray22&quot;</span>) <span class="sc">+</span></span>
<span id="cb274-8"><a href="chm-raster-resolution-testing.html#cb274-8" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fl">0.5</span>, <span class="at">color =</span> <span class="st">&quot;gray22&quot;</span>) <span class="sc">+</span></span>
<span id="cb274-9"><a href="chm-raster-resolution-testing.html#cb274-9" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fl">0.75</span>, <span class="at">color =</span> <span class="st">&quot;gray44&quot;</span>) <span class="sc">+</span></span>
<span id="cb274-10"><a href="chm-raster-resolution-testing.html#cb274-10" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fl">0.75</span>, <span class="at">color =</span> <span class="st">&quot;gray44&quot;</span>) <span class="sc">+</span></span>
<span id="cb274-11"><a href="chm-raster-resolution-testing.html#cb274-11" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fl">0.9</span>, <span class="at">color =</span> <span class="st">&quot;gray66&quot;</span>) <span class="sc">+</span></span>
<span id="cb274-12"><a href="chm-raster-resolution-testing.html#cb274-12" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fl">0.9</span>, <span class="at">color =</span> <span class="st">&quot;gray66&quot;</span>) <span class="sc">+</span></span>
<span id="cb274-13"><a href="chm-raster-resolution-testing.html#cb274-13" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb274-14"><a href="chm-raster-resolution-testing.html#cb274-14" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_colour_viridis_d</span>(<span class="at">direction =</span> <span class="sc">-</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb274-15"><a href="chm-raster-resolution-testing.html#cb274-15" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_x_continuous</span>(</span>
<span id="cb274-16"><a href="chm-raster-resolution-testing.html#cb274-16" tabindex="-1"></a>    <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">percent_format</span>(<span class="at">accuracy =</span> <span class="dv">1</span>)</span>
<span id="cb274-17"><a href="chm-raster-resolution-testing.html#cb274-17" tabindex="-1"></a>    , <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)</span>
<span id="cb274-18"><a href="chm-raster-resolution-testing.html#cb274-18" tabindex="-1"></a>  ) <span class="sc">+</span>  </span>
<span id="cb274-19"><a href="chm-raster-resolution-testing.html#cb274-19" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_y_continuous</span>(</span>
<span id="cb274-20"><a href="chm-raster-resolution-testing.html#cb274-20" tabindex="-1"></a>    <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">percent_format</span>(<span class="at">accuracy =</span> <span class="dv">1</span>)</span>
<span id="cb274-21"><a href="chm-raster-resolution-testing.html#cb274-21" tabindex="-1"></a>    , <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)</span>
<span id="cb274-22"><a href="chm-raster-resolution-testing.html#cb274-22" tabindex="-1"></a>  ) <span class="sc">+</span>  </span>
<span id="cb274-23"><a href="chm-raster-resolution-testing.html#cb274-23" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb274-24"><a href="chm-raster-resolution-testing.html#cb274-24" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;Percentile F-Score&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Percentile MAPE (mean)&quot;</span></span>
<span id="cb274-25"><a href="chm-raster-resolution-testing.html#cb274-25" tabindex="-1"></a>    , <span class="at">color =</span> <span class="st">&quot;&quot;</span></span>
<span id="cb274-26"><a href="chm-raster-resolution-testing.html#cb274-26" tabindex="-1"></a>    , <span class="at">subtitle =</span> <span class="st">&quot;Data Fusion&quot;</span></span>
<span id="cb274-27"><a href="chm-raster-resolution-testing.html#cb274-27" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb274-28"><a href="chm-raster-resolution-testing.html#cb274-28" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb274-29"><a href="chm-raster-resolution-testing.html#cb274-29" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb274-30"><a href="chm-raster-resolution-testing.html#cb274-30" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span></span>
<span id="cb274-31"><a href="chm-raster-resolution-testing.html#cb274-31" tabindex="-1"></a>    , <span class="at">legend.text =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>)</span>
<span id="cb274-32"><a href="chm-raster-resolution-testing.html#cb274-32" tabindex="-1"></a>    , <span class="at">strip.text =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb274-33"><a href="chm-raster-resolution-testing.html#cb274-33" tabindex="-1"></a>    , <span class="at">axis.text =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">7</span>)</span>
<span id="cb274-34"><a href="chm-raster-resolution-testing.html#cb274-34" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb274-35"><a href="chm-raster-resolution-testing.html#cb274-35" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">guides</span>(</span>
<span id="cb274-36"><a href="chm-raster-resolution-testing.html#cb274-36" tabindex="-1"></a>    <span class="at">color =</span> ggplot2<span class="sc">::</span><span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">shape =</span> <span class="dv">15</span>, <span class="at">linetype =</span> <span class="dv">0</span>, <span class="at">size =</span> <span class="dv">5</span>, <span class="at">alpha =</span> <span class="dv">1</span>))</span>
<span id="cb274-37"><a href="chm-raster-resolution-testing.html#cb274-37" tabindex="-1"></a>    , <span class="at">shape =</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb274-38"><a href="chm-raster-resolution-testing.html#cb274-38" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-244-1.png" width="1008" /></p>
<div id="top-1.0-1" class="section level5 hasAnchor" number="8.6.3.1.1">
<h5><span class="header-section-number">8.6.3.1.1</span> Top 1.0%<a href="chm-raster-resolution-testing.html#top-1.0-1" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>let’s check out the parameter settings of the top 1.0% (n=352) from all 35,280 combinations tested. these are “votes” for the parameter setting based on the combinations that achieved the best balance between both detection and quantification accuracy.</p>
<div class="sourceCode" id="cb275"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb275-1"><a href="chm-raster-resolution-testing.html#cb275-1" tabindex="-1"></a>param_combos_spectral_ranked <span class="sc">%&gt;%</span></span>
<span id="cb275-2"><a href="chm-raster-resolution-testing.html#cb275-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(is_top_overall) <span class="sc">%&gt;%</span> </span>
<span id="cb275-3"><a href="chm-raster-resolution-testing.html#cb275-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;f_score&quot;</span>), max_ht_m,max_area_m2,convexity_pct,circle_fit_iou_pct,chm_res_m,spectral_weight) <span class="sc">%&gt;%</span> </span>
<span id="cb275-4"><a href="chm-raster-resolution-testing.html#cb275-4" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(</span>
<span id="cb275-5"><a href="chm-raster-resolution-testing.html#cb275-5" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">c</span>(max_ht_m,max_area_m2,convexity_pct,circle_fit_iou_pct,chm_res_m,spectral_weight)</span>
<span id="cb275-6"><a href="chm-raster-resolution-testing.html#cb275-6" tabindex="-1"></a>    , <span class="at">names_to =</span> <span class="st">&quot;metric&quot;</span></span>
<span id="cb275-7"><a href="chm-raster-resolution-testing.html#cb275-7" tabindex="-1"></a>    , <span class="at">values_to =</span> <span class="st">&quot;value&quot;</span></span>
<span id="cb275-8"><a href="chm-raster-resolution-testing.html#cb275-8" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb275-9"><a href="chm-raster-resolution-testing.html#cb275-9" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">count</span>(metric, value) <span class="sc">%&gt;%</span> </span>
<span id="cb275-10"><a href="chm-raster-resolution-testing.html#cb275-10" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(metric) <span class="sc">%&gt;%</span> </span>
<span id="cb275-11"><a href="chm-raster-resolution-testing.html#cb275-11" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb275-12"><a href="chm-raster-resolution-testing.html#cb275-12" tabindex="-1"></a>    <span class="at">pct=</span>n<span class="sc">/</span><span class="fu">sum</span>(n)</span>
<span id="cb275-13"><a href="chm-raster-resolution-testing.html#cb275-13" tabindex="-1"></a>    , <span class="at">lab =</span> <span class="fu">paste0</span>(scales<span class="sc">::</span><span class="fu">percent</span>(pct,<span class="at">accuracy=</span><span class="fl">0.1</span>), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">n=&quot;</span>, scales<span class="sc">::</span><span class="fu">comma</span>(n,<span class="at">accuracy=</span><span class="dv">1</span>))</span>
<span id="cb275-14"><a href="chm-raster-resolution-testing.html#cb275-14" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb275-15"><a href="chm-raster-resolution-testing.html#cb275-15" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(</span>
<span id="cb275-16"><a href="chm-raster-resolution-testing.html#cb275-16" tabindex="-1"></a>    <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">factor</span>(value), <span class="at">y=</span>pct, <span class="at">label=</span>lab, <span class="at">fill =</span> metric)</span>
<span id="cb275-17"><a href="chm-raster-resolution-testing.html#cb275-17" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb275-18"><a href="chm-raster-resolution-testing.html#cb275-18" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_col</span>(<span class="at">width =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb275-19"><a href="chm-raster-resolution-testing.html#cb275-19" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_text</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">size =</span> <span class="fl">2.5</span>, <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb275-20"><a href="chm-raster-resolution-testing.html#cb275-20" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">facet_wrap</span>(<span class="at">facets =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(metric), <span class="at">ncol=</span><span class="dv">2</span>, <span class="at">scales =</span> <span class="st">&quot;free_x&quot;</span>) <span class="sc">+</span></span>
<span id="cb275-21"><a href="chm-raster-resolution-testing.html#cb275-21" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_y_continuous</span>(</span>
<span id="cb275-22"><a href="chm-raster-resolution-testing.html#cb275-22" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="at">by=</span><span class="fl">0.2</span>)</span>
<span id="cb275-23"><a href="chm-raster-resolution-testing.html#cb275-23" tabindex="-1"></a>    , <span class="at">labels =</span> scales<span class="sc">::</span>percent</span>
<span id="cb275-24"><a href="chm-raster-resolution-testing.html#cb275-24" tabindex="-1"></a>    , <span class="at">expand =</span> ggplot2<span class="sc">::</span><span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">0.2</span>))</span>
<span id="cb275-25"><a href="chm-raster-resolution-testing.html#cb275-25" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb275-26"><a href="chm-raster-resolution-testing.html#cb275-26" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_fill_manual</span>(<span class="at">values =</span> pal_param[<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>]) <span class="sc">+</span></span>
<span id="cb275-27"><a href="chm-raster-resolution-testing.html#cb275-27" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb275-28"><a href="chm-raster-resolution-testing.html#cb275-28" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;parameter setting&quot;</span>, <span class="at">y =</span> <span class="st">&quot;&quot;</span></span>
<span id="cb275-29"><a href="chm-raster-resolution-testing.html#cb275-29" tabindex="-1"></a>    , <span class="at">fill =</span> <span class="st">&quot;&quot;</span></span>
<span id="cb275-30"><a href="chm-raster-resolution-testing.html#cb275-30" tabindex="-1"></a>    , <span class="at">subtitle =</span> <span class="fu">paste0</span>(</span>
<span id="cb275-31"><a href="chm-raster-resolution-testing.html#cb275-31" tabindex="-1"></a>      <span class="st">&quot;Data Fusion&quot;</span></span>
<span id="cb275-32"><a href="chm-raster-resolution-testing.html#cb275-32" tabindex="-1"></a>       , <span class="st">&quot;</span><span class="sc">\n</span><span class="st">parameter settings of top &quot;</span></span>
<span id="cb275-33"><a href="chm-raster-resolution-testing.html#cb275-33" tabindex="-1"></a>       , scales<span class="sc">::</span><span class="fu">percent</span>(pct_th_top,<span class="at">accuracy=</span><span class="fl">0.1</span>)</span>
<span id="cb275-34"><a href="chm-raster-resolution-testing.html#cb275-34" tabindex="-1"></a>       , <span class="st">&quot; (n=&quot;</span></span>
<span id="cb275-35"><a href="chm-raster-resolution-testing.html#cb275-35" tabindex="-1"></a>       , scales<span class="sc">::</span><span class="fu">comma</span>(<span class="fu">sum</span>(param_combos_spectral_ranked<span class="sc">$</span>is_top_overall), <span class="at">accuracy =</span> <span class="dv">1</span>)</span>
<span id="cb275-36"><a href="chm-raster-resolution-testing.html#cb275-36" tabindex="-1"></a>       , <span class="st">&quot;) &quot;</span></span>
<span id="cb275-37"><a href="chm-raster-resolution-testing.html#cb275-37" tabindex="-1"></a>       , <span class="st">&quot;overall parameter combinations</span><span class="sc">\n</span><span class="st">based on both detection and quantification accuracy&quot;</span></span>
<span id="cb275-38"><a href="chm-raster-resolution-testing.html#cb275-38" tabindex="-1"></a>    )</span>
<span id="cb275-39"><a href="chm-raster-resolution-testing.html#cb275-39" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb275-40"><a href="chm-raster-resolution-testing.html#cb275-40" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb275-41"><a href="chm-raster-resolution-testing.html#cb275-41" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb275-42"><a href="chm-raster-resolution-testing.html#cb275-42" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb275-43"><a href="chm-raster-resolution-testing.html#cb275-43" tabindex="-1"></a>    , <span class="at">strip.text =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb275-44"><a href="chm-raster-resolution-testing.html#cb275-44" tabindex="-1"></a>    , <span class="at">axis.text.y =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">6</span>)</span>
<span id="cb275-45"><a href="chm-raster-resolution-testing.html#cb275-45" tabindex="-1"></a>    , <span class="at">axis.text.x =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>)</span>
<span id="cb275-46"><a href="chm-raster-resolution-testing.html#cb275-46" tabindex="-1"></a>    , <span class="at">plot.subtitle =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>)</span>
<span id="cb275-47"><a href="chm-raster-resolution-testing.html#cb275-47" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-245-1.png" width="1008" /></p>
<p>what is the expected <em>detection</em> accuracy of the top 1.0% (n=352) combinations tested?</p>
<div class="sourceCode" id="cb276"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb276-1"><a href="chm-raster-resolution-testing.html#cb276-1" tabindex="-1"></a><span class="fu">plt_detection_dist</span>(</span>
<span id="cb276-2"><a href="chm-raster-resolution-testing.html#cb276-2" tabindex="-1"></a>  <span class="at">df =</span> param_combos_spectral_ranked <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(is_top_overall) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">!</span>tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;_pct_rank_&quot;</span>))</span>
<span id="cb276-3"><a href="chm-raster-resolution-testing.html#cb276-3" tabindex="-1"></a>  , <span class="fu">paste0</span>(</span>
<span id="cb276-4"><a href="chm-raster-resolution-testing.html#cb276-4" tabindex="-1"></a>    <span class="st">&quot;Data Fusion&quot;</span></span>
<span id="cb276-5"><a href="chm-raster-resolution-testing.html#cb276-5" tabindex="-1"></a>    , <span class="st">&quot;</span><span class="sc">\n</span><span class="st">distribution of evaluation metrics for top &quot;</span></span>
<span id="cb276-6"><a href="chm-raster-resolution-testing.html#cb276-6" tabindex="-1"></a>    , scales<span class="sc">::</span><span class="fu">percent</span>(pct_th_top,<span class="at">accuracy=</span><span class="fl">0.1</span>)</span>
<span id="cb276-7"><a href="chm-raster-resolution-testing.html#cb276-7" tabindex="-1"></a>    , <span class="st">&quot; (n=&quot;</span></span>
<span id="cb276-8"><a href="chm-raster-resolution-testing.html#cb276-8" tabindex="-1"></a>    , scales<span class="sc">::</span><span class="fu">comma</span>(<span class="fu">sum</span>(param_combos_spectral_ranked<span class="sc">$</span>is_top_overall), <span class="at">accuracy =</span> <span class="dv">1</span>)</span>
<span id="cb276-9"><a href="chm-raster-resolution-testing.html#cb276-9" tabindex="-1"></a>    , <span class="st">&quot;) &quot;</span></span>
<span id="cb276-10"><a href="chm-raster-resolution-testing.html#cb276-10" tabindex="-1"></a>    , <span class="st">&quot;overall parameter combinations</span><span class="sc">\n</span><span class="st">based on both detection and quantification accuracy&quot;</span></span>
<span id="cb276-11"><a href="chm-raster-resolution-testing.html#cb276-11" tabindex="-1"></a>  )</span>
<span id="cb276-12"><a href="chm-raster-resolution-testing.html#cb276-12" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-246-1.png" width="1008" /></p>
<p><em>WHAT DID WE LEARN FROM THIS</em></p>
<p>what is the expected <em>quantification</em> accuracy of the top 1.0% (n=352) combinations tested?</p>
<div class="sourceCode" id="cb277"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb277-1"><a href="chm-raster-resolution-testing.html#cb277-1" tabindex="-1"></a><span class="co"># plot it</span></span>
<span id="cb277-2"><a href="chm-raster-resolution-testing.html#cb277-2" tabindex="-1"></a><span class="fu">plt_form_quantification_dist</span>(</span>
<span id="cb277-3"><a href="chm-raster-resolution-testing.html#cb277-3" tabindex="-1"></a>  <span class="at">df =</span> param_combos_spectral_ranked <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(is_top_overall) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">!</span>tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;_pct_rank_&quot;</span>))</span>
<span id="cb277-4"><a href="chm-raster-resolution-testing.html#cb277-4" tabindex="-1"></a>  , <span class="fu">paste0</span>(</span>
<span id="cb277-5"><a href="chm-raster-resolution-testing.html#cb277-5" tabindex="-1"></a>    <span class="st">&quot;Structural Data Only&quot;</span></span>
<span id="cb277-6"><a href="chm-raster-resolution-testing.html#cb277-6" tabindex="-1"></a>    , <span class="st">&quot;</span><span class="sc">\n</span><span class="st">distribution of pile form quantification metrics for the top &quot;</span></span>
<span id="cb277-7"><a href="chm-raster-resolution-testing.html#cb277-7" tabindex="-1"></a>    , scales<span class="sc">::</span><span class="fu">percent</span>(pct_th_top,<span class="at">accuracy=</span><span class="fl">0.1</span>)</span>
<span id="cb277-8"><a href="chm-raster-resolution-testing.html#cb277-8" tabindex="-1"></a>    , <span class="st">&quot; (n=&quot;</span></span>
<span id="cb277-9"><a href="chm-raster-resolution-testing.html#cb277-9" tabindex="-1"></a>    , scales<span class="sc">::</span><span class="fu">comma</span>(<span class="fu">sum</span>(param_combos_spectral_ranked<span class="sc">$</span>is_top_overall), <span class="at">accuracy =</span> <span class="dv">1</span>)</span>
<span id="cb277-10"><a href="chm-raster-resolution-testing.html#cb277-10" tabindex="-1"></a>    , <span class="st">&quot;) &quot;</span></span>
<span id="cb277-11"><a href="chm-raster-resolution-testing.html#cb277-11" tabindex="-1"></a>    , <span class="st">&quot;overall parameter combinations</span><span class="sc">\n</span><span class="st">based on both detection and quantification accuracy&quot;</span></span>
<span id="cb277-12"><a href="chm-raster-resolution-testing.html#cb277-12" tabindex="-1"></a>  )</span>
<span id="cb277-13"><a href="chm-raster-resolution-testing.html#cb277-13" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-247-1.png" width="1008" /></p>
<p><em>WHAT DID WE LEARN FROM THIS</em></p>
</div>
<div id="final-12-recommended-settings-1" class="section level5 hasAnchor" number="8.6.3.1.2">
<h5><span class="header-section-number">8.6.3.1.2</span> Final 12 recommended settings<a href="chm-raster-resolution-testing.html#final-12-recommended-settings-1" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<div class="sourceCode" id="cb278"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb278-1"><a href="chm-raster-resolution-testing.html#cb278-1" tabindex="-1"></a><span class="co"># pal_temp %&gt;% scales::show_col()</span></span>
<span id="cb278-2"><a href="chm-raster-resolution-testing.html#cb278-2" tabindex="-1"></a><span class="co"># filter and reshape</span></span>
<span id="cb278-3"><a href="chm-raster-resolution-testing.html#cb278-3" tabindex="-1"></a>param_combos_spectral_ranked <span class="sc">%&gt;%</span> </span>
<span id="cb278-4"><a href="chm-raster-resolution-testing.html#cb278-4" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(is_final_selection) <span class="sc">%&gt;%</span> </span>
<span id="cb278-5"><a href="chm-raster-resolution-testing.html#cb278-5" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">!</span>tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;_pct_rank_&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb278-6"><a href="chm-raster-resolution-testing.html#cb278-6" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb278-7"><a href="chm-raster-resolution-testing.html#cb278-7" tabindex="-1"></a>    max_ht_m,max_area_m2,convexity_pct,circle_fit_iou_pct,chm_res_m,spectral_weight</span>
<span id="cb278-8"><a href="chm-raster-resolution-testing.html#cb278-8" tabindex="-1"></a>    , ovrall_lab</span>
<span id="cb278-9"><a href="chm-raster-resolution-testing.html#cb278-9" tabindex="-1"></a>    <span class="co"># detection</span></span>
<span id="cb278-10"><a href="chm-raster-resolution-testing.html#cb278-10" tabindex="-1"></a>    , f_score, recall, precision</span>
<span id="cb278-11"><a href="chm-raster-resolution-testing.html#cb278-11" tabindex="-1"></a>    <span class="co"># quantification</span></span>
<span id="cb278-12"><a href="chm-raster-resolution-testing.html#cb278-12" tabindex="-1"></a>    , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_rmse&quot;</span>)</span>
<span id="cb278-13"><a href="chm-raster-resolution-testing.html#cb278-13" tabindex="-1"></a>    , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_rrmse&quot;</span>)</span>
<span id="cb278-14"><a href="chm-raster-resolution-testing.html#cb278-14" tabindex="-1"></a>    , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_mean&quot;</span>)</span>
<span id="cb278-15"><a href="chm-raster-resolution-testing.html#cb278-15" tabindex="-1"></a>    , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_mape&quot;</span>)</span>
<span id="cb278-16"><a href="chm-raster-resolution-testing.html#cb278-16" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb278-17"><a href="chm-raster-resolution-testing.html#cb278-17" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(</span>
<span id="cb278-18"><a href="chm-raster-resolution-testing.html#cb278-18" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">c</span>(</span>
<span id="cb278-19"><a href="chm-raster-resolution-testing.html#cb278-19" tabindex="-1"></a>      f_score, recall, precision</span>
<span id="cb278-20"><a href="chm-raster-resolution-testing.html#cb278-20" tabindex="-1"></a>      , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_rmse&quot;</span>)</span>
<span id="cb278-21"><a href="chm-raster-resolution-testing.html#cb278-21" tabindex="-1"></a>      , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_rrmse&quot;</span>)</span>
<span id="cb278-22"><a href="chm-raster-resolution-testing.html#cb278-22" tabindex="-1"></a>      , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_mean&quot;</span>)</span>
<span id="cb278-23"><a href="chm-raster-resolution-testing.html#cb278-23" tabindex="-1"></a>      , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_mape&quot;</span>)</span>
<span id="cb278-24"><a href="chm-raster-resolution-testing.html#cb278-24" tabindex="-1"></a>    )</span>
<span id="cb278-25"><a href="chm-raster-resolution-testing.html#cb278-25" tabindex="-1"></a>    , <span class="at">names_to =</span> <span class="st">&quot;metric&quot;</span></span>
<span id="cb278-26"><a href="chm-raster-resolution-testing.html#cb278-26" tabindex="-1"></a>    , <span class="at">values_to =</span> <span class="st">&quot;value&quot;</span></span>
<span id="cb278-27"><a href="chm-raster-resolution-testing.html#cb278-27" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb278-28"><a href="chm-raster-resolution-testing.html#cb278-28" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb278-29"><a href="chm-raster-resolution-testing.html#cb278-29" tabindex="-1"></a>    <span class="at">eval_metric =</span> stringr<span class="sc">::</span><span class="fu">str_extract</span>(metric, <span class="st">&quot;(_rmse|_rrmse|_mean|_mape|f_score|recall|precision)$&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb278-30"><a href="chm-raster-resolution-testing.html#cb278-30" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_remove_all</span>(<span class="st">&quot;_&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb278-31"><a href="chm-raster-resolution-testing.html#cb278-31" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_replace_all</span>(<span class="st">&quot;mean&quot;</span>,<span class="st">&quot;me&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb278-32"><a href="chm-raster-resolution-testing.html#cb278-32" tabindex="-1"></a>      <span class="fu">toupper</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb278-33"><a href="chm-raster-resolution-testing.html#cb278-33" tabindex="-1"></a>      <span class="fu">factor</span>(</span>
<span id="cb278-34"><a href="chm-raster-resolution-testing.html#cb278-34" tabindex="-1"></a>        <span class="at">ordered =</span> T</span>
<span id="cb278-35"><a href="chm-raster-resolution-testing.html#cb278-35" tabindex="-1"></a>        , <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;FSCORE&quot;</span>,<span class="st">&quot;RECALL&quot;</span>,<span class="st">&quot;PRECISION&quot;</span>, <span class="st">&quot;ME&quot;</span>,<span class="st">&quot;RMSE&quot;</span>,<span class="st">&quot;RRMSE&quot;</span>,<span class="st">&quot;MAPE&quot;</span>)</span>
<span id="cb278-36"><a href="chm-raster-resolution-testing.html#cb278-36" tabindex="-1"></a>        , <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;F-score&quot;</span>,<span class="st">&quot;Recall&quot;</span>,<span class="st">&quot;Precision&quot;</span>, <span class="st">&quot;ME&quot;</span>,<span class="st">&quot;RMSE&quot;</span>,<span class="st">&quot;RRMSE&quot;</span>,<span class="st">&quot;MAPE&quot;</span>)</span>
<span id="cb278-37"><a href="chm-raster-resolution-testing.html#cb278-37" tabindex="-1"></a>      )</span>
<span id="cb278-38"><a href="chm-raster-resolution-testing.html#cb278-38" tabindex="-1"></a>    , <span class="at">pile_metric =</span> metric <span class="sc">%&gt;%</span> </span>
<span id="cb278-39"><a href="chm-raster-resolution-testing.html#cb278-39" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_remove</span>(<span class="st">&quot;(_rmse|_rrmse|_mean|_mape)$&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb278-40"><a href="chm-raster-resolution-testing.html#cb278-40" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_extract</span>(<span class="st">&quot;(paraboloid_volume|volume|area|height|diameter)&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb278-41"><a href="chm-raster-resolution-testing.html#cb278-41" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">coalesce</span>(<span class="st">&quot;detection&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb278-42"><a href="chm-raster-resolution-testing.html#cb278-42" tabindex="-1"></a>      <span class="fu">factor</span>(</span>
<span id="cb278-43"><a href="chm-raster-resolution-testing.html#cb278-43" tabindex="-1"></a>        <span class="at">ordered =</span> T</span>
<span id="cb278-44"><a href="chm-raster-resolution-testing.html#cb278-44" tabindex="-1"></a>        , <span class="at">levels =</span> <span class="fu">c</span>(</span>
<span id="cb278-45"><a href="chm-raster-resolution-testing.html#cb278-45" tabindex="-1"></a>          <span class="st">&quot;detection&quot;</span></span>
<span id="cb278-46"><a href="chm-raster-resolution-testing.html#cb278-46" tabindex="-1"></a>          , <span class="st">&quot;volume&quot;</span></span>
<span id="cb278-47"><a href="chm-raster-resolution-testing.html#cb278-47" tabindex="-1"></a>          , <span class="st">&quot;paraboloid_volume&quot;</span></span>
<span id="cb278-48"><a href="chm-raster-resolution-testing.html#cb278-48" tabindex="-1"></a>          , <span class="st">&quot;area&quot;</span></span>
<span id="cb278-49"><a href="chm-raster-resolution-testing.html#cb278-49" tabindex="-1"></a>          , <span class="st">&quot;height&quot;</span></span>
<span id="cb278-50"><a href="chm-raster-resolution-testing.html#cb278-50" tabindex="-1"></a>          , <span class="st">&quot;diameter&quot;</span></span>
<span id="cb278-51"><a href="chm-raster-resolution-testing.html#cb278-51" tabindex="-1"></a>        )</span>
<span id="cb278-52"><a href="chm-raster-resolution-testing.html#cb278-52" tabindex="-1"></a>        , <span class="at">labels =</span> <span class="fu">c</span>(</span>
<span id="cb278-53"><a href="chm-raster-resolution-testing.html#cb278-53" tabindex="-1"></a>          <span class="st">&quot;Detection&quot;</span></span>
<span id="cb278-54"><a href="chm-raster-resolution-testing.html#cb278-54" tabindex="-1"></a>          , <span class="st">&quot;Volume&quot;</span></span>
<span id="cb278-55"><a href="chm-raster-resolution-testing.html#cb278-55" tabindex="-1"></a>          , <span class="st">&quot;Volume paraboloid&quot;</span></span>
<span id="cb278-56"><a href="chm-raster-resolution-testing.html#cb278-56" tabindex="-1"></a>          , <span class="st">&quot;Area&quot;</span></span>
<span id="cb278-57"><a href="chm-raster-resolution-testing.html#cb278-57" tabindex="-1"></a>          , <span class="st">&quot;Height&quot;</span></span>
<span id="cb278-58"><a href="chm-raster-resolution-testing.html#cb278-58" tabindex="-1"></a>          , <span class="st">&quot;Diameter&quot;</span></span>
<span id="cb278-59"><a href="chm-raster-resolution-testing.html#cb278-59" tabindex="-1"></a>        )</span>
<span id="cb278-60"><a href="chm-raster-resolution-testing.html#cb278-60" tabindex="-1"></a>      )</span>
<span id="cb278-61"><a href="chm-raster-resolution-testing.html#cb278-61" tabindex="-1"></a>    , <span class="at">value_lab =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb278-62"><a href="chm-raster-resolution-testing.html#cb278-62" tabindex="-1"></a>        eval_metric <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;F-score&quot;</span>,<span class="st">&quot;Recall&quot;</span>,<span class="st">&quot;Precision&quot;</span>, <span class="st">&quot;RRMSE&quot;</span>, <span class="st">&quot;MAPE&quot;</span>) <span class="sc">~</span> scales<span class="sc">::</span><span class="fu">percent</span>(value,<span class="at">accuracy=</span><span class="fl">0.1</span>)</span>
<span id="cb278-63"><a href="chm-raster-resolution-testing.html#cb278-63" tabindex="-1"></a>        , eval_metric <span class="sc">==</span> <span class="st">&quot;ME&quot;</span> <span class="sc">~</span> scales<span class="sc">::</span><span class="fu">comma</span>(value,<span class="at">accuracy=</span><span class="fl">0.01</span>)</span>
<span id="cb278-64"><a href="chm-raster-resolution-testing.html#cb278-64" tabindex="-1"></a>        , T <span class="sc">~</span> scales<span class="sc">::</span><span class="fu">comma</span>(value,<span class="at">accuracy=</span><span class="fl">0.1</span>)</span>
<span id="cb278-65"><a href="chm-raster-resolution-testing.html#cb278-65" tabindex="-1"></a>      )</span>
<span id="cb278-66"><a href="chm-raster-resolution-testing.html#cb278-66" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb278-67"><a href="chm-raster-resolution-testing.html#cb278-67" tabindex="-1"></a>  <span class="co"># make var for color</span></span>
<span id="cb278-68"><a href="chm-raster-resolution-testing.html#cb278-68" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(pile_metric, eval_metric) <span class="sc">%&gt;%</span> </span>
<span id="cb278-69"><a href="chm-raster-resolution-testing.html#cb278-69" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb278-70"><a href="chm-raster-resolution-testing.html#cb278-70" tabindex="-1"></a>    <span class="co"># for ME, color by abs...for f-score,recall,precision color by -value so that higher means better...</span></span>
<span id="cb278-71"><a href="chm-raster-resolution-testing.html#cb278-71" tabindex="-1"></a>      <span class="co"># ...since higher means worse for quantification accuracy metrics</span></span>
<span id="cb278-72"><a href="chm-raster-resolution-testing.html#cb278-72" tabindex="-1"></a>    <span class="at">value_dir =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb278-73"><a href="chm-raster-resolution-testing.html#cb278-73" tabindex="-1"></a>      eval_metric <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;ME&quot;</span>) <span class="sc">~</span> <span class="fu">abs</span>(value)</span>
<span id="cb278-74"><a href="chm-raster-resolution-testing.html#cb278-74" tabindex="-1"></a>      , eval_metric <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;F-score&quot;</span>,<span class="st">&quot;Recall&quot;</span>,<span class="st">&quot;Precision&quot;</span>) <span class="sc">~</span> <span class="sc">-</span>value</span>
<span id="cb278-75"><a href="chm-raster-resolution-testing.html#cb278-75" tabindex="-1"></a>      , T <span class="sc">~</span> value</span>
<span id="cb278-76"><a href="chm-raster-resolution-testing.html#cb278-76" tabindex="-1"></a>    )</span>
<span id="cb278-77"><a href="chm-raster-resolution-testing.html#cb278-77" tabindex="-1"></a>    , <span class="at">value_z =</span> (value_dir<span class="sc">-</span><span class="fu">mean</span>(value_dir,<span class="at">na.rm=</span>T))<span class="sc">/</span><span class="fu">sd</span>(value_dir,<span class="at">na.rm=</span>T) <span class="co"># this is the key to the different colors within facets</span></span>
<span id="cb278-78"><a href="chm-raster-resolution-testing.html#cb278-78" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb278-79"><a href="chm-raster-resolution-testing.html#cb278-79" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb278-80"><a href="chm-raster-resolution-testing.html#cb278-80" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span>eval_metric <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;RRMSE&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb278-81"><a href="chm-raster-resolution-testing.html#cb278-81" tabindex="-1"></a>  <span class="co"># View()</span></span>
<span id="cb278-82"><a href="chm-raster-resolution-testing.html#cb278-82" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> eval_metric, <span class="at">y =</span> ovrall_lab)) <span class="sc">+</span> </span>
<span id="cb278-83"><a href="chm-raster-resolution-testing.html#cb278-83" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_tile</span>(</span>
<span id="cb278-84"><a href="chm-raster-resolution-testing.html#cb278-84" tabindex="-1"></a>    <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">fill =</span> pile_metric, <span class="at">alpha =</span> <span class="sc">-</span>value_z)</span>
<span id="cb278-85"><a href="chm-raster-resolution-testing.html#cb278-85" tabindex="-1"></a>    , <span class="at">color =</span> <span class="st">&quot;gray&quot;</span></span>
<span id="cb278-86"><a href="chm-raster-resolution-testing.html#cb278-86" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb278-87"><a href="chm-raster-resolution-testing.html#cb278-87" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_text</span>(</span>
<span id="cb278-88"><a href="chm-raster-resolution-testing.html#cb278-88" tabindex="-1"></a>    <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">label =</span> value_lab, <span class="at">fontface =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb278-89"><a href="chm-raster-resolution-testing.html#cb278-89" tabindex="-1"></a>    , <span class="at">color =</span> <span class="st">&quot;white&quot;</span></span>
<span id="cb278-90"><a href="chm-raster-resolution-testing.html#cb278-90" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb278-91"><a href="chm-raster-resolution-testing.html#cb278-91" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">facet_grid</span>(<span class="at">cols =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(pile_metric), <span class="at">scales =</span> <span class="st">&quot;free_x&quot;</span>) <span class="sc">+</span> </span>
<span id="cb278-92"><a href="chm-raster-resolution-testing.html#cb278-92" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_x_discrete</span>(<span class="at">position =</span> <span class="st">&quot;top&quot;</span>) <span class="sc">+</span></span>
<span id="cb278-93"><a href="chm-raster-resolution-testing.html#cb278-93" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;gray33&quot;</span>, harrypotter<span class="sc">::</span><span class="fu">hp</span>(<span class="at">n=</span><span class="dv">3</span>,<span class="at">option =</span> <span class="st">&quot;hermionegranger&quot;</span>) )) <span class="sc">+</span></span>
<span id="cb278-94"><a href="chm-raster-resolution-testing.html#cb278-94" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_alpha_binned</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="fl">0.55</span>, <span class="dv">1</span>)) <span class="sc">+</span> <span class="co"># this is the key to the different colors within facets</span></span>
<span id="cb278-95"><a href="chm-raster-resolution-testing.html#cb278-95" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb278-96"><a href="chm-raster-resolution-testing.html#cb278-96" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb278-97"><a href="chm-raster-resolution-testing.html#cb278-97" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;&quot;</span></span>
<span id="cb278-98"><a href="chm-raster-resolution-testing.html#cb278-98" tabindex="-1"></a>    , <span class="at">y =</span> <span class="st">&quot;max_ht_m : max_area_m2 : convexity_pct : circle_fit_iou_pct : chm_res_m : spectral_weight&quot;</span></span>
<span id="cb278-99"><a href="chm-raster-resolution-testing.html#cb278-99" tabindex="-1"></a>    , <span class="at">subtitle =</span> <span class="fu">paste0</span>(</span>
<span id="cb278-100"><a href="chm-raster-resolution-testing.html#cb278-100" tabindex="-1"></a>       <span class="st">&quot;Data Fusion&quot;</span></span>
<span id="cb278-101"><a href="chm-raster-resolution-testing.html#cb278-101" tabindex="-1"></a>       , <span class="st">&quot;</span><span class="sc">\n</span><span class="st">pile detection and form quantification accuracy metrics for the final recommended parameter settings&quot;</span></span>
<span id="cb278-102"><a href="chm-raster-resolution-testing.html#cb278-102" tabindex="-1"></a>       <span class="co"># , scales::percent(1-pct_rank_th_top,accuracy=1)</span></span>
<span id="cb278-103"><a href="chm-raster-resolution-testing.html#cb278-103" tabindex="-1"></a>       , <span class="st">&quot; (n=&quot;</span></span>
<span id="cb278-104"><a href="chm-raster-resolution-testing.html#cb278-104" tabindex="-1"></a>       , scales<span class="sc">::</span><span class="fu">comma</span>(n_th_top,<span class="at">accuracy=</span><span class="dv">1</span>)</span>
<span id="cb278-105"><a href="chm-raster-resolution-testing.html#cb278-105" tabindex="-1"></a>       , <span class="st">&quot;) &quot;</span></span>
<span id="cb278-106"><a href="chm-raster-resolution-testing.html#cb278-106" tabindex="-1"></a>       , <span class="st">&quot;</span><span class="sc">\n</span><span class="st">based on both detection and quantification accuracy&quot;</span></span>
<span id="cb278-107"><a href="chm-raster-resolution-testing.html#cb278-107" tabindex="-1"></a>      )</span>
<span id="cb278-108"><a href="chm-raster-resolution-testing.html#cb278-108" tabindex="-1"></a>    , <span class="at">caption =</span> <span class="st">&quot;*darker colors indicate relatively higher accuracy values&quot;</span></span>
<span id="cb278-109"><a href="chm-raster-resolution-testing.html#cb278-109" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb278-110"><a href="chm-raster-resolution-testing.html#cb278-110" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb278-111"><a href="chm-raster-resolution-testing.html#cb278-111" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb278-112"><a href="chm-raster-resolution-testing.html#cb278-112" tabindex="-1"></a>    , <span class="at">panel.grid =</span> ggplot2<span class="sc">::</span><span class="fu">element_blank</span>()</span>
<span id="cb278-113"><a href="chm-raster-resolution-testing.html#cb278-113" tabindex="-1"></a>    , <span class="at">strip.placement =</span> <span class="st">&quot;outside&quot;</span></span>
<span id="cb278-114"><a href="chm-raster-resolution-testing.html#cb278-114" tabindex="-1"></a>    , <span class="at">strip.text.x =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb278-115"><a href="chm-raster-resolution-testing.html#cb278-115" tabindex="-1"></a>    , <span class="at">axis.text.x =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">7</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb278-116"><a href="chm-raster-resolution-testing.html#cb278-116" tabindex="-1"></a>    , <span class="at">axis.title.x =</span> ggplot2<span class="sc">::</span><span class="fu">element_blank</span>()</span>
<span id="cb278-117"><a href="chm-raster-resolution-testing.html#cb278-117" tabindex="-1"></a>    , <span class="at">plot.subtitle =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>)</span>
<span id="cb278-118"><a href="chm-raster-resolution-testing.html#cb278-118" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-248-1.png" width="1008" /></p>
<p>this plot allows for a simultaneous comparison of all metrics for pile detection and pile form quantification. it includes only the parameter combinations that achieved the best balanced accuracy, helping users identify the optimal settings by evaluating the trade-offs between detection and form quantification.</p>
<p>let’s table this</p>
<div class="sourceCode" id="cb279"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb279-1"><a href="chm-raster-resolution-testing.html#cb279-1" tabindex="-1"></a>param_combos_spectral_ranked <span class="sc">%&gt;%</span> </span>
<span id="cb279-2"><a href="chm-raster-resolution-testing.html#cb279-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(is_final_selection) <span class="sc">%&gt;%</span> </span>
<span id="cb279-3"><a href="chm-raster-resolution-testing.html#cb279-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">!</span>tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;_pct_rank_&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb279-4"><a href="chm-raster-resolution-testing.html#cb279-4" tabindex="-1"></a>  <span class="co"># first select to arrange eval_metric</span></span>
<span id="cb279-5"><a href="chm-raster-resolution-testing.html#cb279-5" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb279-6"><a href="chm-raster-resolution-testing.html#cb279-6" tabindex="-1"></a>    ovrall_lab</span>
<span id="cb279-7"><a href="chm-raster-resolution-testing.html#cb279-7" tabindex="-1"></a>    , max_ht_m,max_area_m2,convexity_pct,circle_fit_iou_pct,chm_res_m,spectral_weight</span>
<span id="cb279-8"><a href="chm-raster-resolution-testing.html#cb279-8" tabindex="-1"></a>    <span class="co"># detection</span></span>
<span id="cb279-9"><a href="chm-raster-resolution-testing.html#cb279-9" tabindex="-1"></a>    , f_score, recall, precision</span>
<span id="cb279-10"><a href="chm-raster-resolution-testing.html#cb279-10" tabindex="-1"></a>    <span class="co"># quantification</span></span>
<span id="cb279-11"><a href="chm-raster-resolution-testing.html#cb279-11" tabindex="-1"></a>    , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_mean&quot;</span>)</span>
<span id="cb279-12"><a href="chm-raster-resolution-testing.html#cb279-12" tabindex="-1"></a>    , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_rmse&quot;</span>)</span>
<span id="cb279-13"><a href="chm-raster-resolution-testing.html#cb279-13" tabindex="-1"></a>    <span class="co"># , tidyselect::ends_with(&quot;_rrmse&quot;)</span></span>
<span id="cb279-14"><a href="chm-raster-resolution-testing.html#cb279-14" tabindex="-1"></a>    , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_mape&quot;</span>)</span>
<span id="cb279-15"><a href="chm-raster-resolution-testing.html#cb279-15" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb279-16"><a href="chm-raster-resolution-testing.html#cb279-16" tabindex="-1"></a>  <span class="co"># second select to arrange pile_metric</span></span>
<span id="cb279-17"><a href="chm-raster-resolution-testing.html#cb279-17" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb279-18"><a href="chm-raster-resolution-testing.html#cb279-18" tabindex="-1"></a>    ovrall_lab</span>
<span id="cb279-19"><a href="chm-raster-resolution-testing.html#cb279-19" tabindex="-1"></a>    , max_ht_m,max_area_m2,convexity_pct,circle_fit_iou_pct,chm_res_m,spectral_weight</span>
<span id="cb279-20"><a href="chm-raster-resolution-testing.html#cb279-20" tabindex="-1"></a>    <span class="co"># detection</span></span>
<span id="cb279-21"><a href="chm-raster-resolution-testing.html#cb279-21" tabindex="-1"></a>    , f_score, recall, precision</span>
<span id="cb279-22"><a href="chm-raster-resolution-testing.html#cb279-22" tabindex="-1"></a>    <span class="co"># quantification</span></span>
<span id="cb279-23"><a href="chm-raster-resolution-testing.html#cb279-23" tabindex="-1"></a>    , <span class="fu">c</span>(tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;volume&quot;</span>) <span class="sc">&amp;</span> <span class="sc">!</span>tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;paraboloid&quot;</span>))</span>
<span id="cb279-24"><a href="chm-raster-resolution-testing.html#cb279-24" tabindex="-1"></a>    , tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;area&quot;</span>)</span>
<span id="cb279-25"><a href="chm-raster-resolution-testing.html#cb279-25" tabindex="-1"></a>    , tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;height&quot;</span>)</span>
<span id="cb279-26"><a href="chm-raster-resolution-testing.html#cb279-26" tabindex="-1"></a>    , tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;diameter&quot;</span>)</span>
<span id="cb279-27"><a href="chm-raster-resolution-testing.html#cb279-27" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb279-28"><a href="chm-raster-resolution-testing.html#cb279-28" tabindex="-1"></a>  <span class="co"># names()</span></span>
<span id="cb279-29"><a href="chm-raster-resolution-testing.html#cb279-29" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb279-30"><a href="chm-raster-resolution-testing.html#cb279-30" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">across</span>(</span>
<span id="cb279-31"><a href="chm-raster-resolution-testing.html#cb279-31" tabindex="-1"></a>      <span class="at">.cols =</span> <span class="fu">c</span>(f_score, recall, precision, tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_mape&quot;</span>))</span>
<span id="cb279-32"><a href="chm-raster-resolution-testing.html#cb279-32" tabindex="-1"></a>      , <span class="at">.fn =</span> <span class="sc">~</span> scales<span class="sc">::</span><span class="fu">percent</span>(.x, <span class="at">accuracy =</span> <span class="dv">1</span>)</span>
<span id="cb279-33"><a href="chm-raster-resolution-testing.html#cb279-33" tabindex="-1"></a>    )</span>
<span id="cb279-34"><a href="chm-raster-resolution-testing.html#cb279-34" tabindex="-1"></a>    , dplyr<span class="sc">::</span><span class="fu">across</span>(</span>
<span id="cb279-35"><a href="chm-raster-resolution-testing.html#cb279-35" tabindex="-1"></a>      <span class="at">.cols =</span> <span class="fu">c</span>(tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_mean&quot;</span>))</span>
<span id="cb279-36"><a href="chm-raster-resolution-testing.html#cb279-36" tabindex="-1"></a>      , <span class="at">.fn =</span> <span class="sc">~</span> scales<span class="sc">::</span><span class="fu">comma</span>(.x, <span class="at">accuracy =</span> <span class="fl">0.01</span>)</span>
<span id="cb279-37"><a href="chm-raster-resolution-testing.html#cb279-37" tabindex="-1"></a>    )</span>
<span id="cb279-38"><a href="chm-raster-resolution-testing.html#cb279-38" tabindex="-1"></a>    , dplyr<span class="sc">::</span><span class="fu">across</span>(</span>
<span id="cb279-39"><a href="chm-raster-resolution-testing.html#cb279-39" tabindex="-1"></a>      <span class="at">.cols =</span> <span class="fu">c</span>(tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_rmse&quot;</span>))</span>
<span id="cb279-40"><a href="chm-raster-resolution-testing.html#cb279-40" tabindex="-1"></a>      , <span class="at">.fn =</span> <span class="sc">~</span> scales<span class="sc">::</span><span class="fu">comma</span>(.x, <span class="at">accuracy =</span> <span class="fl">0.1</span>)</span>
<span id="cb279-41"><a href="chm-raster-resolution-testing.html#cb279-41" tabindex="-1"></a>    )</span>
<span id="cb279-42"><a href="chm-raster-resolution-testing.html#cb279-42" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb279-43"><a href="chm-raster-resolution-testing.html#cb279-43" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">blank=</span> <span class="st">&quot;   &quot;</span> ) <span class="sc">%&gt;%</span> </span>
<span id="cb279-44"><a href="chm-raster-resolution-testing.html#cb279-44" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">relocate</span>(blank, <span class="at">.before =</span> f_score) <span class="sc">%&gt;%</span> </span>
<span id="cb279-45"><a href="chm-raster-resolution-testing.html#cb279-45" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(<span class="fu">desc</span>(ovrall_lab)) <span class="sc">%&gt;%</span> </span>
<span id="cb279-46"><a href="chm-raster-resolution-testing.html#cb279-46" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kbl</span>(</span>
<span id="cb279-47"><a href="chm-raster-resolution-testing.html#cb279-47" tabindex="-1"></a>    <span class="at">caption =</span> </span>
<span id="cb279-48"><a href="chm-raster-resolution-testing.html#cb279-48" tabindex="-1"></a>      <span class="fu">paste0</span>(</span>
<span id="cb279-49"><a href="chm-raster-resolution-testing.html#cb279-49" tabindex="-1"></a>       <span class="st">&quot;Data Fusion&quot;</span></span>
<span id="cb279-50"><a href="chm-raster-resolution-testing.html#cb279-50" tabindex="-1"></a>       , <span class="st">&quot;&lt;br&gt;pile detection and form quantification accuracy metrics for the final recommended parameter settings&quot;</span></span>
<span id="cb279-51"><a href="chm-raster-resolution-testing.html#cb279-51" tabindex="-1"></a>       <span class="co"># , scales::percent(1-pct_rank_th_top,accuracy=1)</span></span>
<span id="cb279-52"><a href="chm-raster-resolution-testing.html#cb279-52" tabindex="-1"></a>       , <span class="st">&quot; (n=&quot;</span></span>
<span id="cb279-53"><a href="chm-raster-resolution-testing.html#cb279-53" tabindex="-1"></a>       , scales<span class="sc">::</span><span class="fu">comma</span>(n_th_top,<span class="at">accuracy=</span><span class="dv">1</span>)</span>
<span id="cb279-54"><a href="chm-raster-resolution-testing.html#cb279-54" tabindex="-1"></a>       , <span class="st">&quot;) &quot;</span></span>
<span id="cb279-55"><a href="chm-raster-resolution-testing.html#cb279-55" tabindex="-1"></a>       , <span class="st">&quot;&lt;br&gt;based on both detection and quantification accuracy&quot;</span></span>
<span id="cb279-56"><a href="chm-raster-resolution-testing.html#cb279-56" tabindex="-1"></a>      )</span>
<span id="cb279-57"><a href="chm-raster-resolution-testing.html#cb279-57" tabindex="-1"></a>    , <span class="at">col.names =</span> <span class="fu">c</span>(</span>
<span id="cb279-58"><a href="chm-raster-resolution-testing.html#cb279-58" tabindex="-1"></a>      <span class="st">&quot;&quot;</span></span>
<span id="cb279-59"><a href="chm-raster-resolution-testing.html#cb279-59" tabindex="-1"></a>      ,<span class="st">&quot;max_ht_m&quot;</span>,<span class="st">&quot;max_area_m2&quot;</span>,<span class="st">&quot;convexity_pct&quot;</span>,<span class="st">&quot;circle_fit_iou_pct&quot;</span>,<span class="st">&quot;chm_res_m&quot;</span>,<span class="st">&quot;spectral_weight&quot;</span></span>
<span id="cb279-60"><a href="chm-raster-resolution-testing.html#cb279-60" tabindex="-1"></a>      , <span class="st">&quot;   &quot;</span></span>
<span id="cb279-61"><a href="chm-raster-resolution-testing.html#cb279-61" tabindex="-1"></a>      , <span class="st">&quot;F-score&quot;</span>, <span class="st">&quot;Recall&quot;</span>, <span class="st">&quot;Precision&quot;</span></span>
<span id="cb279-62"><a href="chm-raster-resolution-testing.html#cb279-62" tabindex="-1"></a>      , <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;ME&quot;</span>,<span class="st">&quot;RMSE&quot;</span>,<span class="st">&quot;MAPE&quot;</span>), <span class="at">times =</span> <span class="dv">3</span>)</span>
<span id="cb279-63"><a href="chm-raster-resolution-testing.html#cb279-63" tabindex="-1"></a>    )</span>
<span id="cb279-64"><a href="chm-raster-resolution-testing.html#cb279-64" tabindex="-1"></a>    , <span class="at">escape =</span> F</span>
<span id="cb279-65"><a href="chm-raster-resolution-testing.html#cb279-65" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb279-66"><a href="chm-raster-resolution-testing.html#cb279-66" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kable_styling</span>(<span class="at">font_size =</span> <span class="dv">11</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb279-67"><a href="chm-raster-resolution-testing.html#cb279-67" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">add_header_above</span>(<span class="fu">c</span>(</span>
<span id="cb279-68"><a href="chm-raster-resolution-testing.html#cb279-68" tabindex="-1"></a>    <span class="st">&quot; &quot;</span><span class="ot">=</span><span class="dv">8</span></span>
<span id="cb279-69"><a href="chm-raster-resolution-testing.html#cb279-69" tabindex="-1"></a>    , <span class="st">&quot;Detection&quot;</span> <span class="ot">=</span> <span class="dv">3</span></span>
<span id="cb279-70"><a href="chm-raster-resolution-testing.html#cb279-70" tabindex="-1"></a>    <span class="co"># , &quot;Volume&quot; = 3</span></span>
<span id="cb279-71"><a href="chm-raster-resolution-testing.html#cb279-71" tabindex="-1"></a>    , <span class="st">&quot;Area&quot;</span> <span class="ot">=</span> <span class="dv">3</span></span>
<span id="cb279-72"><a href="chm-raster-resolution-testing.html#cb279-72" tabindex="-1"></a>    , <span class="st">&quot;Height&quot;</span> <span class="ot">=</span> <span class="dv">3</span></span>
<span id="cb279-73"><a href="chm-raster-resolution-testing.html#cb279-73" tabindex="-1"></a>    , <span class="st">&quot;Diameter&quot;</span> <span class="ot">=</span> <span class="dv">3</span></span>
<span id="cb279-74"><a href="chm-raster-resolution-testing.html#cb279-74" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb279-75"><a href="chm-raster-resolution-testing.html#cb279-75" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">column_spec</span>(<span class="fu">seq</span>(<span class="dv">8</span>,<span class="dv">20</span>,<span class="at">by=</span><span class="dv">3</span>), <span class="at">border_right =</span> <span class="cn">TRUE</span>, <span class="at">include_thead =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb279-76"><a href="chm-raster-resolution-testing.html#cb279-76" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">column_spec</span>(</span>
<span id="cb279-77"><a href="chm-raster-resolution-testing.html#cb279-77" tabindex="-1"></a>    <span class="at">column =</span> <span class="dv">8</span><span class="sc">:</span><span class="dv">20</span></span>
<span id="cb279-78"><a href="chm-raster-resolution-testing.html#cb279-78" tabindex="-1"></a>    , <span class="at">extra_css =</span> <span class="st">&quot;font-size: 10px;&quot;</span></span>
<span id="cb279-79"><a href="chm-raster-resolution-testing.html#cb279-79" tabindex="-1"></a>    , <span class="at">include_thead =</span> T</span>
<span id="cb279-80"><a href="chm-raster-resolution-testing.html#cb279-80" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb279-81"><a href="chm-raster-resolution-testing.html#cb279-81" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">scroll_box</span>(<span class="at">width =</span> <span class="st">&quot;740px&quot;</span>) </span></code></pre></div>
<div style="border: 1px solid #ddd; padding: 5px; overflow-x: scroll; width:740px; ">
<table class="table" style="font-size: 11px; margin-left: auto; margin-right: auto;">
<caption style="font-size: initial !important;">
<span id="tab:unnamed-chunk-249">Table 8.3: </span>Data Fusion<br>pile detection and form quantification accuracy metrics for the final recommended parameter settings (n=12) <br>based on both detection and quantification accuracy
</caption>
<thead>
<tr>
<th style="empty-cells: hide;border-bottom:hidden;" colspan="8">
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="3">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Detection
</div>
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="3">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Area
</div>
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="3">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Height
</div>
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="3">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Diameter
</div>
</th>
</tr>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
max_ht_m
</th>
<th style="text-align:right;">
max_area_m2
</th>
<th style="text-align:right;">
convexity_pct
</th>
<th style="text-align:right;">
circle_fit_iou_pct
</th>
<th style="text-align:right;">
chm_res_m
</th>
<th style="text-align:right;">
spectral_weight
</th>
<th style="text-align:left;border-right:1px solid;font-size: 10px;">
</th>
<th style="text-align:left;font-size: 10px;">
F-score
</th>
<th style="text-align:left;font-size: 10px;">
Recall
</th>
<th style="text-align:left;border-right:1px solid;font-size: 10px;">
Precision
</th>
<th style="text-align:left;font-size: 10px;">
ME
</th>
<th style="text-align:left;font-size: 10px;">
RMSE
</th>
<th style="text-align:left;border-right:1px solid;font-size: 10px;">
MAPE
</th>
<th style="text-align:left;font-size: 10px;">
ME
</th>
<th style="text-align:left;font-size: 10px;">
RMSE
</th>
<th style="text-align:left;border-right:1px solid;font-size: 10px;">
MAPE
</th>
<th style="text-align:left;font-size: 10px;">
ME
</th>
<th style="text-align:left;font-size: 10px;">
RMSE
</th>
<th style="text-align:left;border-right:1px solid;font-size: 10px;">
MAPE
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
5:60:0.8:0.65:0.1:4
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
60
</td>
<td style="text-align:right;">
0.80
</td>
<td style="text-align:right;">
0.65
</td>
<td style="text-align:right;">
0.1
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
89%
</td>
<td style="text-align:left;font-size: 10px;">
90%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
88%
</td>
<td style="text-align:left;font-size: 10px;">
-0.80
</td>
<td style="text-align:left;font-size: 10px;">
2.1
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
10%
</td>
<td style="text-align:left;font-size: 10px;">
-0.10
</td>
<td style="text-align:left;font-size: 10px;">
0.6
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
18%
</td>
<td style="text-align:left;font-size: 10px;">
0.21
</td>
<td style="text-align:left;font-size: 10px;">
0.5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
10%
</td>
</tr>
<tr>
<td style="text-align:left;">
5:50:0.8:0.65:0.1:4
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
50
</td>
<td style="text-align:right;">
0.80
</td>
<td style="text-align:right;">
0.65
</td>
<td style="text-align:right;">
0.1
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
89%
</td>
<td style="text-align:left;font-size: 10px;">
90%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
88%
</td>
<td style="text-align:left;font-size: 10px;">
-0.80
</td>
<td style="text-align:left;font-size: 10px;">
2.1
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
10%
</td>
<td style="text-align:left;font-size: 10px;">
-0.10
</td>
<td style="text-align:left;font-size: 10px;">
0.6
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
18%
</td>
<td style="text-align:left;font-size: 10px;">
0.21
</td>
<td style="text-align:left;font-size: 10px;">
0.5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
10%
</td>
</tr>
<tr>
<td style="text-align:left;">
5:60:0.65:0.65:0.1:4
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
60
</td>
<td style="text-align:right;">
0.65
</td>
<td style="text-align:right;">
0.65
</td>
<td style="text-align:right;">
0.1
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
89%
</td>
<td style="text-align:left;font-size: 10px;">
91%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
87%
</td>
<td style="text-align:left;font-size: 10px;">
-0.81
</td>
<td style="text-align:left;font-size: 10px;">
2.1
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
10%
</td>
<td style="text-align:left;font-size: 10px;">
-0.09
</td>
<td style="text-align:left;font-size: 10px;">
0.6
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
18%
</td>
<td style="text-align:left;font-size: 10px;">
0.21
</td>
<td style="text-align:left;font-size: 10px;">
0.5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
10%
</td>
</tr>
<tr>
<td style="text-align:left;">
5:60:0.5:0.65:0.1:4
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
60
</td>
<td style="text-align:right;">
0.50
</td>
<td style="text-align:right;">
0.65
</td>
<td style="text-align:right;">
0.1
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
89%
</td>
<td style="text-align:left;font-size: 10px;">
91%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
87%
</td>
<td style="text-align:left;font-size: 10px;">
-0.81
</td>
<td style="text-align:left;font-size: 10px;">
2.1
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
10%
</td>
<td style="text-align:left;font-size: 10px;">
-0.09
</td>
<td style="text-align:left;font-size: 10px;">
0.6
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
18%
</td>
<td style="text-align:left;font-size: 10px;">
0.21
</td>
<td style="text-align:left;font-size: 10px;">
0.5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
10%
</td>
</tr>
<tr>
<td style="text-align:left;">
5:60:0.35:0.65:0.1:4
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
60
</td>
<td style="text-align:right;">
0.35
</td>
<td style="text-align:right;">
0.65
</td>
<td style="text-align:right;">
0.1
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
89%
</td>
<td style="text-align:left;font-size: 10px;">
91%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
87%
</td>
<td style="text-align:left;font-size: 10px;">
-0.81
</td>
<td style="text-align:left;font-size: 10px;">
2.1
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
10%
</td>
<td style="text-align:left;font-size: 10px;">
-0.09
</td>
<td style="text-align:left;font-size: 10px;">
0.6
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
18%
</td>
<td style="text-align:left;font-size: 10px;">
0.21
</td>
<td style="text-align:left;font-size: 10px;">
0.5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
10%
</td>
</tr>
<tr>
<td style="text-align:left;">
5:60:0.2:0.65:0.1:4
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
60
</td>
<td style="text-align:right;">
0.20
</td>
<td style="text-align:right;">
0.65
</td>
<td style="text-align:right;">
0.1
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
89%
</td>
<td style="text-align:left;font-size: 10px;">
91%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
87%
</td>
<td style="text-align:left;font-size: 10px;">
-0.81
</td>
<td style="text-align:left;font-size: 10px;">
2.1
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
10%
</td>
<td style="text-align:left;font-size: 10px;">
-0.09
</td>
<td style="text-align:left;font-size: 10px;">
0.6
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
18%
</td>
<td style="text-align:left;font-size: 10px;">
0.21
</td>
<td style="text-align:left;font-size: 10px;">
0.5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
10%
</td>
</tr>
<tr>
<td style="text-align:left;">
5:60:0.05:0.65:0.1:4
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
60
</td>
<td style="text-align:right;">
0.05
</td>
<td style="text-align:right;">
0.65
</td>
<td style="text-align:right;">
0.1
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
89%
</td>
<td style="text-align:left;font-size: 10px;">
91%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
87%
</td>
<td style="text-align:left;font-size: 10px;">
-0.81
</td>
<td style="text-align:left;font-size: 10px;">
2.1
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
10%
</td>
<td style="text-align:left;font-size: 10px;">
-0.09
</td>
<td style="text-align:left;font-size: 10px;">
0.6
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
18%
</td>
<td style="text-align:left;font-size: 10px;">
0.21
</td>
<td style="text-align:left;font-size: 10px;">
0.5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
10%
</td>
</tr>
<tr>
<td style="text-align:left;">
5:50:0.65:0.65:0.1:4
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
50
</td>
<td style="text-align:right;">
0.65
</td>
<td style="text-align:right;">
0.65
</td>
<td style="text-align:right;">
0.1
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
89%
</td>
<td style="text-align:left;font-size: 10px;">
91%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
87%
</td>
<td style="text-align:left;font-size: 10px;">
-0.81
</td>
<td style="text-align:left;font-size: 10px;">
2.1
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
10%
</td>
<td style="text-align:left;font-size: 10px;">
-0.09
</td>
<td style="text-align:left;font-size: 10px;">
0.6
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
18%
</td>
<td style="text-align:left;font-size: 10px;">
0.21
</td>
<td style="text-align:left;font-size: 10px;">
0.5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
10%
</td>
</tr>
<tr>
<td style="text-align:left;">
5:50:0.5:0.65:0.1:4
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
50
</td>
<td style="text-align:right;">
0.50
</td>
<td style="text-align:right;">
0.65
</td>
<td style="text-align:right;">
0.1
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
89%
</td>
<td style="text-align:left;font-size: 10px;">
91%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
87%
</td>
<td style="text-align:left;font-size: 10px;">
-0.81
</td>
<td style="text-align:left;font-size: 10px;">
2.1
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
10%
</td>
<td style="text-align:left;font-size: 10px;">
-0.09
</td>
<td style="text-align:left;font-size: 10px;">
0.6
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
18%
</td>
<td style="text-align:left;font-size: 10px;">
0.21
</td>
<td style="text-align:left;font-size: 10px;">
0.5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
10%
</td>
</tr>
<tr>
<td style="text-align:left;">
5:50:0.35:0.65:0.1:4
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
50
</td>
<td style="text-align:right;">
0.35
</td>
<td style="text-align:right;">
0.65
</td>
<td style="text-align:right;">
0.1
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
89%
</td>
<td style="text-align:left;font-size: 10px;">
91%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
87%
</td>
<td style="text-align:left;font-size: 10px;">
-0.81
</td>
<td style="text-align:left;font-size: 10px;">
2.1
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
10%
</td>
<td style="text-align:left;font-size: 10px;">
-0.09
</td>
<td style="text-align:left;font-size: 10px;">
0.6
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
18%
</td>
<td style="text-align:left;font-size: 10px;">
0.21
</td>
<td style="text-align:left;font-size: 10px;">
0.5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
10%
</td>
</tr>
<tr>
<td style="text-align:left;">
5:50:0.2:0.65:0.1:4
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
50
</td>
<td style="text-align:right;">
0.20
</td>
<td style="text-align:right;">
0.65
</td>
<td style="text-align:right;">
0.1
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
89%
</td>
<td style="text-align:left;font-size: 10px;">
91%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
87%
</td>
<td style="text-align:left;font-size: 10px;">
-0.81
</td>
<td style="text-align:left;font-size: 10px;">
2.1
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
10%
</td>
<td style="text-align:left;font-size: 10px;">
-0.09
</td>
<td style="text-align:left;font-size: 10px;">
0.6
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
18%
</td>
<td style="text-align:left;font-size: 10px;">
0.21
</td>
<td style="text-align:left;font-size: 10px;">
0.5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
10%
</td>
</tr>
<tr>
<td style="text-align:left;">
5:50:0.05:0.65:0.1:4
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
50
</td>
<td style="text-align:right;">
0.05
</td>
<td style="text-align:right;">
0.65
</td>
<td style="text-align:right;">
0.1
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
89%
</td>
<td style="text-align:left;font-size: 10px;">
91%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
87%
</td>
<td style="text-align:left;font-size: 10px;">
-0.81
</td>
<td style="text-align:left;font-size: 10px;">
2.1
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
10%
</td>
<td style="text-align:left;font-size: 10px;">
-0.09
</td>
<td style="text-align:left;font-size: 10px;">
0.6
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
18%
</td>
<td style="text-align:left;font-size: 10px;">
0.21
</td>
<td style="text-align:left;font-size: 10px;">
0.5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
10%
</td>
</tr>
</tbody>
</table>
</div>
<p>what is the expected <em>detection</em> accuracy of the final 12 recommended settings?</p>
<div class="sourceCode" id="cb280"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb280-1"><a href="chm-raster-resolution-testing.html#cb280-1" tabindex="-1"></a><span class="fu">plt_detection_dist</span>(</span>
<span id="cb280-2"><a href="chm-raster-resolution-testing.html#cb280-2" tabindex="-1"></a>  <span class="at">df =</span> param_combos_spectral_ranked <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(is_final_selection) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">!</span>tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;_pct_rank_&quot;</span>))</span>
<span id="cb280-3"><a href="chm-raster-resolution-testing.html#cb280-3" tabindex="-1"></a>  , <span class="fu">paste0</span>(</span>
<span id="cb280-4"><a href="chm-raster-resolution-testing.html#cb280-4" tabindex="-1"></a>    <span class="st">&quot;Data Fusion&quot;</span></span>
<span id="cb280-5"><a href="chm-raster-resolution-testing.html#cb280-5" tabindex="-1"></a>    , <span class="st">&quot;</span><span class="sc">\n</span><span class="st">distribution of evaluation metrics for the final recommended parameter settings&quot;</span></span>
<span id="cb280-6"><a href="chm-raster-resolution-testing.html#cb280-6" tabindex="-1"></a>    , <span class="st">&quot; (n=&quot;</span></span>
<span id="cb280-7"><a href="chm-raster-resolution-testing.html#cb280-7" tabindex="-1"></a>    , scales<span class="sc">::</span><span class="fu">comma</span>(n_th_top,<span class="at">accuracy=</span><span class="dv">1</span>)</span>
<span id="cb280-8"><a href="chm-raster-resolution-testing.html#cb280-8" tabindex="-1"></a>    , <span class="st">&quot;) &quot;</span></span>
<span id="cb280-9"><a href="chm-raster-resolution-testing.html#cb280-9" tabindex="-1"></a>    , <span class="st">&quot;</span><span class="sc">\n</span><span class="st">based on both detection and quantification accuracy&quot;</span></span>
<span id="cb280-10"><a href="chm-raster-resolution-testing.html#cb280-10" tabindex="-1"></a>  )</span>
<span id="cb280-11"><a href="chm-raster-resolution-testing.html#cb280-11" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-250-1.png" width="1008" /></p>
<p><em>WHAT DID WE LEARN FROM THIS</em></p>
<p>what is the expected <em>quantification</em> accuracy of the final 12 recommended settings?</p>
<div class="sourceCode" id="cb281"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb281-1"><a href="chm-raster-resolution-testing.html#cb281-1" tabindex="-1"></a><span class="co"># plot it</span></span>
<span id="cb281-2"><a href="chm-raster-resolution-testing.html#cb281-2" tabindex="-1"></a><span class="fu">plt_form_quantification_dist</span>(</span>
<span id="cb281-3"><a href="chm-raster-resolution-testing.html#cb281-3" tabindex="-1"></a>  <span class="at">df =</span> param_combos_spectral_ranked <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(is_final_selection) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">!</span>tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;_pct_rank_&quot;</span>))</span>
<span id="cb281-4"><a href="chm-raster-resolution-testing.html#cb281-4" tabindex="-1"></a>  , <span class="fu">paste0</span>(</span>
<span id="cb281-5"><a href="chm-raster-resolution-testing.html#cb281-5" tabindex="-1"></a>    <span class="st">&quot;Data Fusion&quot;</span></span>
<span id="cb281-6"><a href="chm-raster-resolution-testing.html#cb281-6" tabindex="-1"></a>    , <span class="st">&quot;</span><span class="sc">\n</span><span class="st">distribution of pile form quantification metrics for the final recommended parameter settings&quot;</span></span>
<span id="cb281-7"><a href="chm-raster-resolution-testing.html#cb281-7" tabindex="-1"></a>    , <span class="st">&quot; (n=&quot;</span></span>
<span id="cb281-8"><a href="chm-raster-resolution-testing.html#cb281-8" tabindex="-1"></a>    , scales<span class="sc">::</span><span class="fu">comma</span>(n_th_top,<span class="at">accuracy=</span><span class="dv">1</span>)</span>
<span id="cb281-9"><a href="chm-raster-resolution-testing.html#cb281-9" tabindex="-1"></a>    , <span class="st">&quot;) &quot;</span></span>
<span id="cb281-10"><a href="chm-raster-resolution-testing.html#cb281-10" tabindex="-1"></a>    , <span class="st">&quot;</span><span class="sc">\n</span><span class="st">based on both detection and quantification accuracy&quot;</span></span>
<span id="cb281-11"><a href="chm-raster-resolution-testing.html#cb281-11" tabindex="-1"></a>  )</span>
<span id="cb281-12"><a href="chm-raster-resolution-testing.html#cb281-12" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-251-1.png" width="1008" /></p>
<p><em>WHAT DID WE LEARN FROM THIS</em></p>
<p>finally, here are the combinations selected compared against all 35,280 combinations tested.</p>
<div class="sourceCode" id="cb282"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb282-1"><a href="chm-raster-resolution-testing.html#cb282-1" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(</span>
<span id="cb282-2"><a href="chm-raster-resolution-testing.html#cb282-2" tabindex="-1"></a>  param_combos_spectral_ranked <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(is_final_selection)</span>
<span id="cb282-3"><a href="chm-raster-resolution-testing.html#cb282-3" tabindex="-1"></a>  , param_combos_spectral_ranked <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span>is_final_selection) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">slice_sample</span>(<span class="at">prop =</span> (<span class="dv">1</span><span class="sc">/</span><span class="dv">6</span>))</span>
<span id="cb282-4"><a href="chm-raster-resolution-testing.html#cb282-4" tabindex="-1"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb282-5"><a href="chm-raster-resolution-testing.html#cb282-5" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb282-6"><a href="chm-raster-resolution-testing.html#cb282-6" tabindex="-1"></a>    rn,max_ht_m,max_area_m2,convexity_pct,circle_fit_iou_pct</span>
<span id="cb282-7"><a href="chm-raster-resolution-testing.html#cb282-7" tabindex="-1"></a>    , is_final_selection</span>
<span id="cb282-8"><a href="chm-raster-resolution-testing.html#cb282-8" tabindex="-1"></a>    , f_score, precision, recall</span>
<span id="cb282-9"><a href="chm-raster-resolution-testing.html#cb282-9" tabindex="-1"></a>    <span class="co"># quantification accuracy</span></span>
<span id="cb282-10"><a href="chm-raster-resolution-testing.html#cb282-10" tabindex="-1"></a>    , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_mape&quot;</span>)</span>
<span id="cb282-11"><a href="chm-raster-resolution-testing.html#cb282-11" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb282-12"><a href="chm-raster-resolution-testing.html#cb282-12" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(</span>
<span id="cb282-13"><a href="chm-raster-resolution-testing.html#cb282-13" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">c</span>(</span>
<span id="cb282-14"><a href="chm-raster-resolution-testing.html#cb282-14" tabindex="-1"></a>      tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_mape&quot;</span>)</span>
<span id="cb282-15"><a href="chm-raster-resolution-testing.html#cb282-15" tabindex="-1"></a>      <span class="co"># ,precision,recall</span></span>
<span id="cb282-16"><a href="chm-raster-resolution-testing.html#cb282-16" tabindex="-1"></a>    )</span>
<span id="cb282-17"><a href="chm-raster-resolution-testing.html#cb282-17" tabindex="-1"></a>    , <span class="at">names_to =</span> <span class="st">&quot;metric&quot;</span></span>
<span id="cb282-18"><a href="chm-raster-resolution-testing.html#cb282-18" tabindex="-1"></a>    , <span class="at">values_to =</span> <span class="st">&quot;value&quot;</span></span>
<span id="cb282-19"><a href="chm-raster-resolution-testing.html#cb282-19" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb282-20"><a href="chm-raster-resolution-testing.html#cb282-20" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb282-21"><a href="chm-raster-resolution-testing.html#cb282-21" tabindex="-1"></a>    <span class="at">eval_metric =</span> stringr<span class="sc">::</span><span class="fu">str_extract</span>(metric, <span class="st">&quot;(_rmse|_rrmse|_mean|_mape)$&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb282-22"><a href="chm-raster-resolution-testing.html#cb282-22" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_remove_all</span>(<span class="st">&quot;_&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb282-23"><a href="chm-raster-resolution-testing.html#cb282-23" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_replace_all</span>(<span class="st">&quot;mean&quot;</span>,<span class="st">&quot;me&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb282-24"><a href="chm-raster-resolution-testing.html#cb282-24" tabindex="-1"></a>      <span class="fu">toupper</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb282-25"><a href="chm-raster-resolution-testing.html#cb282-25" tabindex="-1"></a>      <span class="fu">factor</span>(</span>
<span id="cb282-26"><a href="chm-raster-resolution-testing.html#cb282-26" tabindex="-1"></a>        <span class="at">ordered =</span> T</span>
<span id="cb282-27"><a href="chm-raster-resolution-testing.html#cb282-27" tabindex="-1"></a>        , <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;ME&quot;</span>,<span class="st">&quot;RMSE&quot;</span>,<span class="st">&quot;RRMSE&quot;</span>,<span class="st">&quot;MAPE&quot;</span>)</span>
<span id="cb282-28"><a href="chm-raster-resolution-testing.html#cb282-28" tabindex="-1"></a>      )</span>
<span id="cb282-29"><a href="chm-raster-resolution-testing.html#cb282-29" tabindex="-1"></a>    , <span class="at">pile_metric =</span> metric <span class="sc">%&gt;%</span> </span>
<span id="cb282-30"><a href="chm-raster-resolution-testing.html#cb282-30" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_remove</span>(<span class="st">&quot;(_rmse|_rrmse|_mean|_mape)$&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb282-31"><a href="chm-raster-resolution-testing.html#cb282-31" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_extract</span>(<span class="st">&quot;(paraboloid_volume|volume|area|height|diameter|precision|recall)&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb282-32"><a href="chm-raster-resolution-testing.html#cb282-32" tabindex="-1"></a>      <span class="fu">factor</span>(</span>
<span id="cb282-33"><a href="chm-raster-resolution-testing.html#cb282-33" tabindex="-1"></a>        <span class="at">ordered =</span> T</span>
<span id="cb282-34"><a href="chm-raster-resolution-testing.html#cb282-34" tabindex="-1"></a>        , <span class="at">levels =</span> <span class="fu">c</span>(</span>
<span id="cb282-35"><a href="chm-raster-resolution-testing.html#cb282-35" tabindex="-1"></a>          <span class="st">&quot;volume&quot;</span></span>
<span id="cb282-36"><a href="chm-raster-resolution-testing.html#cb282-36" tabindex="-1"></a>          , <span class="st">&quot;paraboloid_volume&quot;</span></span>
<span id="cb282-37"><a href="chm-raster-resolution-testing.html#cb282-37" tabindex="-1"></a>          , <span class="st">&quot;area&quot;</span></span>
<span id="cb282-38"><a href="chm-raster-resolution-testing.html#cb282-38" tabindex="-1"></a>          , <span class="st">&quot;height&quot;</span></span>
<span id="cb282-39"><a href="chm-raster-resolution-testing.html#cb282-39" tabindex="-1"></a>          , <span class="st">&quot;diameter&quot;</span></span>
<span id="cb282-40"><a href="chm-raster-resolution-testing.html#cb282-40" tabindex="-1"></a>          , <span class="st">&quot;recall&quot;</span></span>
<span id="cb282-41"><a href="chm-raster-resolution-testing.html#cb282-41" tabindex="-1"></a>          , <span class="st">&quot;precision&quot;</span></span>
<span id="cb282-42"><a href="chm-raster-resolution-testing.html#cb282-42" tabindex="-1"></a>        )</span>
<span id="cb282-43"><a href="chm-raster-resolution-testing.html#cb282-43" tabindex="-1"></a>        , <span class="at">labels =</span> <span class="fu">c</span>(</span>
<span id="cb282-44"><a href="chm-raster-resolution-testing.html#cb282-44" tabindex="-1"></a>          <span class="st">&quot;Volume&quot;</span></span>
<span id="cb282-45"><a href="chm-raster-resolution-testing.html#cb282-45" tabindex="-1"></a>          , <span class="st">&quot;Volume paraboloid&quot;</span></span>
<span id="cb282-46"><a href="chm-raster-resolution-testing.html#cb282-46" tabindex="-1"></a>          , <span class="st">&quot;Area&quot;</span></span>
<span id="cb282-47"><a href="chm-raster-resolution-testing.html#cb282-47" tabindex="-1"></a>          , <span class="st">&quot;Height&quot;</span></span>
<span id="cb282-48"><a href="chm-raster-resolution-testing.html#cb282-48" tabindex="-1"></a>          , <span class="st">&quot;Diameter&quot;</span></span>
<span id="cb282-49"><a href="chm-raster-resolution-testing.html#cb282-49" tabindex="-1"></a>          , <span class="st">&quot;Recall&quot;</span></span>
<span id="cb282-50"><a href="chm-raster-resolution-testing.html#cb282-50" tabindex="-1"></a>          , <span class="st">&quot;Precision&quot;</span></span>
<span id="cb282-51"><a href="chm-raster-resolution-testing.html#cb282-51" tabindex="-1"></a>        )</span>
<span id="cb282-52"><a href="chm-raster-resolution-testing.html#cb282-52" tabindex="-1"></a>      )</span>
<span id="cb282-53"><a href="chm-raster-resolution-testing.html#cb282-53" tabindex="-1"></a>    , <span class="at">color_metric =</span> <span class="fu">ifelse</span>(is_final_selection, pile_metric, <span class="cn">NA</span>) <span class="sc">%&gt;%</span> <span class="fu">factor</span>()</span>
<span id="cb282-54"><a href="chm-raster-resolution-testing.html#cb282-54" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb282-55"><a href="chm-raster-resolution-testing.html#cb282-55" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(is_final_selection) <span class="sc">%&gt;%</span> </span>
<span id="cb282-56"><a href="chm-raster-resolution-testing.html#cb282-56" tabindex="-1"></a>  <span class="co"># plot</span></span>
<span id="cb282-57"><a href="chm-raster-resolution-testing.html#cb282-57" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> f_score, <span class="at">y =</span> value, <span class="at">color =</span> color_metric)) <span class="sc">+</span></span>
<span id="cb282-58"><a href="chm-raster-resolution-testing.html#cb282-58" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb282-59"><a href="chm-raster-resolution-testing.html#cb282-59" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">facet_wrap</span>(<span class="at">facets =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(pile_metric)) <span class="sc">+</span></span>
<span id="cb282-60"><a href="chm-raster-resolution-testing.html#cb282-60" tabindex="-1"></a>  harrypotter<span class="sc">::</span><span class="fu">scale_color_hp_d</span>(<span class="at">option =</span> <span class="st">&quot;hermionegranger&quot;</span>, <span class="at">na.value =</span> <span class="st">&quot;gray88&quot;</span>) <span class="sc">+</span></span>
<span id="cb282-61"><a href="chm-raster-resolution-testing.html#cb282-61" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_x_continuous</span>(</span>
<span id="cb282-62"><a href="chm-raster-resolution-testing.html#cb282-62" tabindex="-1"></a>    <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">percent_format</span>(<span class="at">accuracy =</span> <span class="dv">1</span>)</span>
<span id="cb282-63"><a href="chm-raster-resolution-testing.html#cb282-63" tabindex="-1"></a>    , <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)</span>
<span id="cb282-64"><a href="chm-raster-resolution-testing.html#cb282-64" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb282-65"><a href="chm-raster-resolution-testing.html#cb282-65" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_y_continuous</span>(</span>
<span id="cb282-66"><a href="chm-raster-resolution-testing.html#cb282-66" tabindex="-1"></a>    <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">percent_format</span>(<span class="at">accuracy =</span> <span class="dv">1</span>)</span>
<span id="cb282-67"><a href="chm-raster-resolution-testing.html#cb282-67" tabindex="-1"></a>    , <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="cn">NA</span>)</span>
<span id="cb282-68"><a href="chm-raster-resolution-testing.html#cb282-68" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb282-69"><a href="chm-raster-resolution-testing.html#cb282-69" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;F-Score&quot;</span>, <span class="at">y =</span> <span class="st">&quot;MAPE&quot;</span>, <span class="at">caption =</span> <span class="st">&quot;*records in gray not selected&quot;</span>) <span class="sc">+</span></span>
<span id="cb282-70"><a href="chm-raster-resolution-testing.html#cb282-70" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb282-71"><a href="chm-raster-resolution-testing.html#cb282-71" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb282-72"><a href="chm-raster-resolution-testing.html#cb282-72" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb282-73"><a href="chm-raster-resolution-testing.html#cb282-73" tabindex="-1"></a>    , <span class="at">strip.text =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb282-74"><a href="chm-raster-resolution-testing.html#cb282-74" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-252-1.png" width="1008" /></p>
<p><em>WHAT DID WE LEARN FROM THIS</em></p>
</div>
</div>
<div id="by-chm-resolution-1" class="section level4 hasAnchor" number="8.6.3.2">
<h4><span class="header-section-number">8.6.3.2</span> by CHM resolution<a href="chm-raster-resolution-testing.html#by-chm-resolution-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>To select the best-performing parameter combinations, we will prioritize those that balance detection and quantification accuracy. From this group, we will then identify the settings that achieve the highest pile detection rates (recall). These recommendations are for users who are working with a CHM with a resolution in the range of those tested for this analysis or can aggregate (i.e. make more coarse) a CHM to a resolution tested for the purpose of either improving processing performance or enhancing pile detection and/or quantification accuracy based on the results shown here</p>
<p>we already created this data above (<code>param_combos_ranked</code>) using the F-Score and the average rank of the MAPE metrics across all form measurements (i.e. height, diameter, area, volume) to determine the best overall list by CHM resolution</p>
<div id="top-2.0-1" class="section level5 hasAnchor" number="8.6.3.2.1">
<h5><span class="header-section-number">8.6.3.2.1</span> Top 2.0%<a href="chm-raster-resolution-testing.html#top-2.0-1" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>let’s check out the parameter settings of the top 2.0% (n=141) from all 7,056 combinations tested by CHM resolution. these are “votes” for the parameter setting based on the combinations that achieved the best balance between both detection and quantification accuracy.</p>
<div class="sourceCode" id="cb283"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb283-1"><a href="chm-raster-resolution-testing.html#cb283-1" tabindex="-1"></a>param_combos_spectral_ranked <span class="sc">%&gt;%</span></span>
<span id="cb283-2"><a href="chm-raster-resolution-testing.html#cb283-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(is_top_chm) <span class="sc">%&gt;%</span> </span>
<span id="cb283-3"><a href="chm-raster-resolution-testing.html#cb283-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;f_score&quot;</span>), max_ht_m,max_area_m2,convexity_pct,circle_fit_iou_pct,chm_res_m,chm_res_m_desc,spectral_weight) <span class="sc">%&gt;%</span> </span>
<span id="cb283-4"><a href="chm-raster-resolution-testing.html#cb283-4" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(</span>
<span id="cb283-5"><a href="chm-raster-resolution-testing.html#cb283-5" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">c</span>(max_ht_m,max_area_m2,convexity_pct,circle_fit_iou_pct,spectral_weight)</span>
<span id="cb283-6"><a href="chm-raster-resolution-testing.html#cb283-6" tabindex="-1"></a>    , <span class="at">names_to =</span> <span class="st">&quot;metric&quot;</span></span>
<span id="cb283-7"><a href="chm-raster-resolution-testing.html#cb283-7" tabindex="-1"></a>    , <span class="at">values_to =</span> <span class="st">&quot;value&quot;</span></span>
<span id="cb283-8"><a href="chm-raster-resolution-testing.html#cb283-8" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb283-9"><a href="chm-raster-resolution-testing.html#cb283-9" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">count</span>(chm_res_m,chm_res_m_desc, metric, value) <span class="sc">%&gt;%</span> </span>
<span id="cb283-10"><a href="chm-raster-resolution-testing.html#cb283-10" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(chm_res_m,chm_res_m_desc, metric) <span class="sc">%&gt;%</span> </span>
<span id="cb283-11"><a href="chm-raster-resolution-testing.html#cb283-11" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb283-12"><a href="chm-raster-resolution-testing.html#cb283-12" tabindex="-1"></a>    <span class="at">pct=</span>n<span class="sc">/</span><span class="fu">sum</span>(n)</span>
<span id="cb283-13"><a href="chm-raster-resolution-testing.html#cb283-13" tabindex="-1"></a>    , <span class="at">lab =</span> <span class="fu">paste0</span>(scales<span class="sc">::</span><span class="fu">percent</span>(pct,<span class="at">accuracy=</span><span class="fl">0.1</span>)) <span class="co">#, &quot;\nn=&quot;, scales::comma(n,accuracy=1))</span></span>
<span id="cb283-14"><a href="chm-raster-resolution-testing.html#cb283-14" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb283-15"><a href="chm-raster-resolution-testing.html#cb283-15" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(</span>
<span id="cb283-16"><a href="chm-raster-resolution-testing.html#cb283-16" tabindex="-1"></a>    <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">factor</span>(value), <span class="at">y=</span>pct, <span class="at">label=</span>lab, <span class="at">fill =</span> metric)</span>
<span id="cb283-17"><a href="chm-raster-resolution-testing.html#cb283-17" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb283-18"><a href="chm-raster-resolution-testing.html#cb283-18" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_col</span>(<span class="at">width =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb283-19"><a href="chm-raster-resolution-testing.html#cb283-19" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_text</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">size =</span> <span class="fl">2.2</span>, <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb283-20"><a href="chm-raster-resolution-testing.html#cb283-20" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">facet_grid</span>(<span class="at">cols =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(metric), <span class="at">rows =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(chm_res_m_desc), <span class="at">scales =</span> <span class="st">&quot;free_x&quot;</span>) <span class="sc">+</span></span>
<span id="cb283-21"><a href="chm-raster-resolution-testing.html#cb283-21" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_y_continuous</span>(</span>
<span id="cb283-22"><a href="chm-raster-resolution-testing.html#cb283-22" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="at">by=</span><span class="fl">0.2</span>)</span>
<span id="cb283-23"><a href="chm-raster-resolution-testing.html#cb283-23" tabindex="-1"></a>    , <span class="at">labels =</span> scales<span class="sc">::</span>percent</span>
<span id="cb283-24"><a href="chm-raster-resolution-testing.html#cb283-24" tabindex="-1"></a>    , <span class="at">expand =</span> ggplot2<span class="sc">::</span><span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">0.2</span>))</span>
<span id="cb283-25"><a href="chm-raster-resolution-testing.html#cb283-25" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb283-26"><a href="chm-raster-resolution-testing.html#cb283-26" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_fill_manual</span>(<span class="at">values =</span> pal_param[<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>,<span class="dv">6</span>)]) <span class="sc">+</span></span>
<span id="cb283-27"><a href="chm-raster-resolution-testing.html#cb283-27" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb283-28"><a href="chm-raster-resolution-testing.html#cb283-28" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;parameter setting&quot;</span>, <span class="at">y =</span> <span class="st">&quot;&quot;</span></span>
<span id="cb283-29"><a href="chm-raster-resolution-testing.html#cb283-29" tabindex="-1"></a>    , <span class="at">fill =</span> <span class="st">&quot;&quot;</span></span>
<span id="cb283-30"><a href="chm-raster-resolution-testing.html#cb283-30" tabindex="-1"></a>    , <span class="at">subtitle =</span> <span class="fu">paste0</span>(</span>
<span id="cb283-31"><a href="chm-raster-resolution-testing.html#cb283-31" tabindex="-1"></a>      <span class="st">&quot;Data Fusion&quot;</span></span>
<span id="cb283-32"><a href="chm-raster-resolution-testing.html#cb283-32" tabindex="-1"></a>       , <span class="st">&quot;</span><span class="sc">\n</span><span class="st">parameter settings of top &quot;</span></span>
<span id="cb283-33"><a href="chm-raster-resolution-testing.html#cb283-33" tabindex="-1"></a>       , scales<span class="sc">::</span><span class="fu">percent</span>(pct_th_top_chm,<span class="at">accuracy=</span><span class="fl">0.1</span>)</span>
<span id="cb283-34"><a href="chm-raster-resolution-testing.html#cb283-34" tabindex="-1"></a>       , <span class="st">&quot; (n=&quot;</span></span>
<span id="cb283-35"><a href="chm-raster-resolution-testing.html#cb283-35" tabindex="-1"></a>       , scales<span class="sc">::</span><span class="fu">comma</span>(n_combos_top_spectral_chm , <span class="at">accuracy =</span> <span class="dv">1</span>)</span>
<span id="cb283-36"><a href="chm-raster-resolution-testing.html#cb283-36" tabindex="-1"></a>       , <span class="st">&quot;) &quot;</span></span>
<span id="cb283-37"><a href="chm-raster-resolution-testing.html#cb283-37" tabindex="-1"></a>       , <span class="st">&quot;parameter combinations by CHM resolution</span><span class="sc">\n</span><span class="st">based on both detection and quantification accuracy&quot;</span></span>
<span id="cb283-38"><a href="chm-raster-resolution-testing.html#cb283-38" tabindex="-1"></a>    )</span>
<span id="cb283-39"><a href="chm-raster-resolution-testing.html#cb283-39" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb283-40"><a href="chm-raster-resolution-testing.html#cb283-40" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb283-41"><a href="chm-raster-resolution-testing.html#cb283-41" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb283-42"><a href="chm-raster-resolution-testing.html#cb283-42" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb283-43"><a href="chm-raster-resolution-testing.html#cb283-43" tabindex="-1"></a>    , <span class="at">strip.text.x =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb283-44"><a href="chm-raster-resolution-testing.html#cb283-44" tabindex="-1"></a>    , <span class="at">strip.text.y =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">9</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb283-45"><a href="chm-raster-resolution-testing.html#cb283-45" tabindex="-1"></a>    , <span class="at">axis.text.y =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">6</span>)</span>
<span id="cb283-46"><a href="chm-raster-resolution-testing.html#cb283-46" tabindex="-1"></a>    , <span class="at">axis.text.x =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>)</span>
<span id="cb283-47"><a href="chm-raster-resolution-testing.html#cb283-47" tabindex="-1"></a>    , <span class="at">plot.subtitle =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>)</span>
<span id="cb283-48"><a href="chm-raster-resolution-testing.html#cb283-48" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-254-1.png" width="1008" /></p>
<p>what is the expected <em>detection</em> accuracy of the top 2.0% (n=141) combinations tested by CHM resolution?</p>
<div class="sourceCode" id="cb284"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb284-1"><a href="chm-raster-resolution-testing.html#cb284-1" tabindex="-1"></a><span class="fu">plt_detection_dist2</span>(</span>
<span id="cb284-2"><a href="chm-raster-resolution-testing.html#cb284-2" tabindex="-1"></a>  <span class="at">df =</span> param_combos_spectral_ranked <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(is_top_chm) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">!</span>tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;_pct_rank_&quot;</span>))</span>
<span id="cb284-3"><a href="chm-raster-resolution-testing.html#cb284-3" tabindex="-1"></a>  , <span class="fu">paste0</span>(</span>
<span id="cb284-4"><a href="chm-raster-resolution-testing.html#cb284-4" tabindex="-1"></a>    <span class="st">&quot;Data Fusion&quot;</span></span>
<span id="cb284-5"><a href="chm-raster-resolution-testing.html#cb284-5" tabindex="-1"></a>    , <span class="st">&quot;</span><span class="sc">\n</span><span class="st">distribution of evaluation metrics for top &quot;</span></span>
<span id="cb284-6"><a href="chm-raster-resolution-testing.html#cb284-6" tabindex="-1"></a>    , scales<span class="sc">::</span><span class="fu">percent</span>(pct_th_top_chm,<span class="at">accuracy=</span><span class="fl">0.1</span>)</span>
<span id="cb284-7"><a href="chm-raster-resolution-testing.html#cb284-7" tabindex="-1"></a>    , <span class="st">&quot; (n=&quot;</span></span>
<span id="cb284-8"><a href="chm-raster-resolution-testing.html#cb284-8" tabindex="-1"></a>    , scales<span class="sc">::</span><span class="fu">comma</span>(n_combos_top_spectral_chm, <span class="at">accuracy=</span><span class="dv">1</span>)</span>
<span id="cb284-9"><a href="chm-raster-resolution-testing.html#cb284-9" tabindex="-1"></a>    , <span class="st">&quot;) &quot;</span></span>
<span id="cb284-10"><a href="chm-raster-resolution-testing.html#cb284-10" tabindex="-1"></a>    , <span class="st">&quot;parameter combinations by CHM resolution</span><span class="sc">\n</span><span class="st">based on both detection and quantification accuracy&quot;</span></span>
<span id="cb284-11"><a href="chm-raster-resolution-testing.html#cb284-11" tabindex="-1"></a>  )</span>
<span id="cb284-12"><a href="chm-raster-resolution-testing.html#cb284-12" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-255-1.png" width="1008" /></p>
<p><em>WHAT DID WE LEARN FROM THIS</em></p>
<p>what is the expected <em>MAPE</em> of the top 2.0% (n=141) combinations tested by CHM resolution?</p>
<div class="sourceCode" id="cb285"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb285-1"><a href="chm-raster-resolution-testing.html#cb285-1" tabindex="-1"></a><span class="co"># plot it</span></span>
<span id="cb285-2"><a href="chm-raster-resolution-testing.html#cb285-2" tabindex="-1"></a><span class="fu">plt_form_quantification_dist2</span>(</span>
<span id="cb285-3"><a href="chm-raster-resolution-testing.html#cb285-3" tabindex="-1"></a>  <span class="at">df =</span> param_combos_spectral_ranked <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(is_top_chm) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">!</span>tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;_pct_rank_&quot;</span>))</span>
<span id="cb285-4"><a href="chm-raster-resolution-testing.html#cb285-4" tabindex="-1"></a>  , <span class="at">quant_metric =</span> <span class="st">&quot;mape&quot;</span></span>
<span id="cb285-5"><a href="chm-raster-resolution-testing.html#cb285-5" tabindex="-1"></a>  , <span class="fu">paste0</span>(</span>
<span id="cb285-6"><a href="chm-raster-resolution-testing.html#cb285-6" tabindex="-1"></a>    <span class="st">&quot;Data Fusion&quot;</span></span>
<span id="cb285-7"><a href="chm-raster-resolution-testing.html#cb285-7" tabindex="-1"></a>    , <span class="st">&quot;</span><span class="sc">\n</span><span class="st">distribution of pile form quantification metrics for the top &quot;</span></span>
<span id="cb285-8"><a href="chm-raster-resolution-testing.html#cb285-8" tabindex="-1"></a>    , scales<span class="sc">::</span><span class="fu">percent</span>(pct_th_top_chm,<span class="at">accuracy=</span><span class="fl">0.1</span>)</span>
<span id="cb285-9"><a href="chm-raster-resolution-testing.html#cb285-9" tabindex="-1"></a>    , <span class="st">&quot; (n=&quot;</span></span>
<span id="cb285-10"><a href="chm-raster-resolution-testing.html#cb285-10" tabindex="-1"></a>    , scales<span class="sc">::</span><span class="fu">comma</span>(n_combos_top_spectral_chm, <span class="at">accuracy=</span><span class="dv">1</span>)</span>
<span id="cb285-11"><a href="chm-raster-resolution-testing.html#cb285-11" tabindex="-1"></a>    , <span class="st">&quot;) &quot;</span></span>
<span id="cb285-12"><a href="chm-raster-resolution-testing.html#cb285-12" tabindex="-1"></a>    , <span class="st">&quot;parameter combinations by CHM resolution</span><span class="sc">\n</span><span class="st">based on both detection and quantification accuracy&quot;</span></span>
<span id="cb285-13"><a href="chm-raster-resolution-testing.html#cb285-13" tabindex="-1"></a>  )</span>
<span id="cb285-14"><a href="chm-raster-resolution-testing.html#cb285-14" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-256-1.png" width="1008" /></p>
<p><em>WHAT DID WE LEARN FROM THIS</em></p>
<p>what is the expected <em>Mean Error (ME)</em> of the top 2.0% (n=141) combinations tested by CHM resolution?</p>
<div class="sourceCode" id="cb286"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb286-1"><a href="chm-raster-resolution-testing.html#cb286-1" tabindex="-1"></a><span class="co"># plot it</span></span>
<span id="cb286-2"><a href="chm-raster-resolution-testing.html#cb286-2" tabindex="-1"></a><span class="fu">plt_form_quantification_dist2</span>(</span>
<span id="cb286-3"><a href="chm-raster-resolution-testing.html#cb286-3" tabindex="-1"></a>  <span class="at">df =</span> param_combos_spectral_ranked <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(is_top_chm) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">!</span>tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;_pct_rank_&quot;</span>))</span>
<span id="cb286-4"><a href="chm-raster-resolution-testing.html#cb286-4" tabindex="-1"></a>  , <span class="at">quant_metric =</span> <span class="st">&quot;mean&quot;</span></span>
<span id="cb286-5"><a href="chm-raster-resolution-testing.html#cb286-5" tabindex="-1"></a>  , <span class="fu">paste0</span>(</span>
<span id="cb286-6"><a href="chm-raster-resolution-testing.html#cb286-6" tabindex="-1"></a>    <span class="st">&quot;Data Fusion&quot;</span></span>
<span id="cb286-7"><a href="chm-raster-resolution-testing.html#cb286-7" tabindex="-1"></a>    , <span class="st">&quot;</span><span class="sc">\n</span><span class="st">distribution of pile form quantification metrics for the top &quot;</span></span>
<span id="cb286-8"><a href="chm-raster-resolution-testing.html#cb286-8" tabindex="-1"></a>    , scales<span class="sc">::</span><span class="fu">percent</span>(pct_th_top_chm,<span class="at">accuracy=</span><span class="fl">0.1</span>)</span>
<span id="cb286-9"><a href="chm-raster-resolution-testing.html#cb286-9" tabindex="-1"></a>    , <span class="st">&quot; (n=&quot;</span></span>
<span id="cb286-10"><a href="chm-raster-resolution-testing.html#cb286-10" tabindex="-1"></a>    , scales<span class="sc">::</span><span class="fu">comma</span>(n_combos_top_spectral_chm, <span class="at">accuracy=</span><span class="dv">1</span>)</span>
<span id="cb286-11"><a href="chm-raster-resolution-testing.html#cb286-11" tabindex="-1"></a>    , <span class="st">&quot;) &quot;</span></span>
<span id="cb286-12"><a href="chm-raster-resolution-testing.html#cb286-12" tabindex="-1"></a>    , <span class="st">&quot;parameter combinations by CHM resolution</span><span class="sc">\n</span><span class="st">based on both detection and quantification accuracy&quot;</span></span>
<span id="cb286-13"><a href="chm-raster-resolution-testing.html#cb286-13" tabindex="-1"></a>  )</span>
<span id="cb286-14"><a href="chm-raster-resolution-testing.html#cb286-14" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-257-1.png" width="1008" /></p>
<p><em>WHAT DID WE LEARN FROM THIS</em></p>
<p>what is the expected <em>RMSE</em> of the top 2.0% (n=141) combinations tested by CHM resolution?</p>
<div class="sourceCode" id="cb287"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb287-1"><a href="chm-raster-resolution-testing.html#cb287-1" tabindex="-1"></a><span class="co"># plot it</span></span>
<span id="cb287-2"><a href="chm-raster-resolution-testing.html#cb287-2" tabindex="-1"></a><span class="fu">plt_form_quantification_dist2</span>(</span>
<span id="cb287-3"><a href="chm-raster-resolution-testing.html#cb287-3" tabindex="-1"></a>  <span class="at">df =</span> param_combos_spectral_ranked <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(is_top_chm) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">!</span>tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;_pct_rank_&quot;</span>))</span>
<span id="cb287-4"><a href="chm-raster-resolution-testing.html#cb287-4" tabindex="-1"></a>  , <span class="at">quant_metric =</span> <span class="st">&quot;rmse&quot;</span></span>
<span id="cb287-5"><a href="chm-raster-resolution-testing.html#cb287-5" tabindex="-1"></a>  , <span class="fu">paste0</span>(</span>
<span id="cb287-6"><a href="chm-raster-resolution-testing.html#cb287-6" tabindex="-1"></a>    <span class="st">&quot;Data Fusion&quot;</span></span>
<span id="cb287-7"><a href="chm-raster-resolution-testing.html#cb287-7" tabindex="-1"></a>    , <span class="st">&quot;</span><span class="sc">\n</span><span class="st">distribution of pile form quantification metrics for the top &quot;</span></span>
<span id="cb287-8"><a href="chm-raster-resolution-testing.html#cb287-8" tabindex="-1"></a>    , scales<span class="sc">::</span><span class="fu">percent</span>(pct_th_top_chm,<span class="at">accuracy=</span><span class="fl">0.1</span>)</span>
<span id="cb287-9"><a href="chm-raster-resolution-testing.html#cb287-9" tabindex="-1"></a>    , <span class="st">&quot; (n=&quot;</span></span>
<span id="cb287-10"><a href="chm-raster-resolution-testing.html#cb287-10" tabindex="-1"></a>    , scales<span class="sc">::</span><span class="fu">comma</span>(n_combos_top_spectral_chm, <span class="at">accuracy=</span><span class="dv">1</span>)</span>
<span id="cb287-11"><a href="chm-raster-resolution-testing.html#cb287-11" tabindex="-1"></a>    , <span class="st">&quot;) &quot;</span></span>
<span id="cb287-12"><a href="chm-raster-resolution-testing.html#cb287-12" tabindex="-1"></a>    , <span class="st">&quot;parameter combinations by CHM resolution</span><span class="sc">\n</span><span class="st">based on both detection and quantification accuracy&quot;</span></span>
<span id="cb287-13"><a href="chm-raster-resolution-testing.html#cb287-13" tabindex="-1"></a>  )</span>
<span id="cb287-14"><a href="chm-raster-resolution-testing.html#cb287-14" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-258-1.png" width="1008" /></p>
<p><em>WHAT DID WE LEARN FROM THIS</em></p>
</div>
<div id="final-6-recommended-settings-1" class="section level5 hasAnchor" number="8.6.3.2.2">
<h5><span class="header-section-number">8.6.3.2.2</span> Final 6 recommended settings<a href="chm-raster-resolution-testing.html#final-6-recommended-settings-1" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<div class="sourceCode" id="cb288"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb288-1"><a href="chm-raster-resolution-testing.html#cb288-1" tabindex="-1"></a><span class="co"># pal_temp %&gt;% scales::show_col()</span></span>
<span id="cb288-2"><a href="chm-raster-resolution-testing.html#cb288-2" tabindex="-1"></a><span class="co"># filter and reshape</span></span>
<span id="cb288-3"><a href="chm-raster-resolution-testing.html#cb288-3" tabindex="-1"></a>param_combos_spectral_ranked <span class="sc">%&gt;%</span> </span>
<span id="cb288-4"><a href="chm-raster-resolution-testing.html#cb288-4" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(is_final_selection_chm) <span class="sc">%&gt;%</span> </span>
<span id="cb288-5"><a href="chm-raster-resolution-testing.html#cb288-5" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">!</span>tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;_pct_rank_&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb288-6"><a href="chm-raster-resolution-testing.html#cb288-6" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb288-7"><a href="chm-raster-resolution-testing.html#cb288-7" tabindex="-1"></a>    max_ht_m,max_area_m2,convexity_pct,circle_fit_iou_pct,chm_res_m,chm_res_m_desc,spectral_weight</span>
<span id="cb288-8"><a href="chm-raster-resolution-testing.html#cb288-8" tabindex="-1"></a>    , chm_lab</span>
<span id="cb288-9"><a href="chm-raster-resolution-testing.html#cb288-9" tabindex="-1"></a>    <span class="co"># detection</span></span>
<span id="cb288-10"><a href="chm-raster-resolution-testing.html#cb288-10" tabindex="-1"></a>    , f_score, recall, precision</span>
<span id="cb288-11"><a href="chm-raster-resolution-testing.html#cb288-11" tabindex="-1"></a>    <span class="co"># quantification</span></span>
<span id="cb288-12"><a href="chm-raster-resolution-testing.html#cb288-12" tabindex="-1"></a>    , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_rmse&quot;</span>)</span>
<span id="cb288-13"><a href="chm-raster-resolution-testing.html#cb288-13" tabindex="-1"></a>    , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_rrmse&quot;</span>)</span>
<span id="cb288-14"><a href="chm-raster-resolution-testing.html#cb288-14" tabindex="-1"></a>    , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_mean&quot;</span>)</span>
<span id="cb288-15"><a href="chm-raster-resolution-testing.html#cb288-15" tabindex="-1"></a>    , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_mape&quot;</span>)</span>
<span id="cb288-16"><a href="chm-raster-resolution-testing.html#cb288-16" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb288-17"><a href="chm-raster-resolution-testing.html#cb288-17" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(</span>
<span id="cb288-18"><a href="chm-raster-resolution-testing.html#cb288-18" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">c</span>(</span>
<span id="cb288-19"><a href="chm-raster-resolution-testing.html#cb288-19" tabindex="-1"></a>      f_score, recall, precision</span>
<span id="cb288-20"><a href="chm-raster-resolution-testing.html#cb288-20" tabindex="-1"></a>      , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_rmse&quot;</span>)</span>
<span id="cb288-21"><a href="chm-raster-resolution-testing.html#cb288-21" tabindex="-1"></a>      , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_rrmse&quot;</span>)</span>
<span id="cb288-22"><a href="chm-raster-resolution-testing.html#cb288-22" tabindex="-1"></a>      , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_mean&quot;</span>)</span>
<span id="cb288-23"><a href="chm-raster-resolution-testing.html#cb288-23" tabindex="-1"></a>      , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_mape&quot;</span>)</span>
<span id="cb288-24"><a href="chm-raster-resolution-testing.html#cb288-24" tabindex="-1"></a>    )</span>
<span id="cb288-25"><a href="chm-raster-resolution-testing.html#cb288-25" tabindex="-1"></a>    , <span class="at">names_to =</span> <span class="st">&quot;metric&quot;</span></span>
<span id="cb288-26"><a href="chm-raster-resolution-testing.html#cb288-26" tabindex="-1"></a>    , <span class="at">values_to =</span> <span class="st">&quot;value&quot;</span></span>
<span id="cb288-27"><a href="chm-raster-resolution-testing.html#cb288-27" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb288-28"><a href="chm-raster-resolution-testing.html#cb288-28" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb288-29"><a href="chm-raster-resolution-testing.html#cb288-29" tabindex="-1"></a>    <span class="at">eval_metric =</span> stringr<span class="sc">::</span><span class="fu">str_extract</span>(metric, <span class="st">&quot;(_rmse|_rrmse|_mean|_mape|f_score|recall|precision)$&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb288-30"><a href="chm-raster-resolution-testing.html#cb288-30" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_remove_all</span>(<span class="st">&quot;_&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb288-31"><a href="chm-raster-resolution-testing.html#cb288-31" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_replace_all</span>(<span class="st">&quot;mean&quot;</span>,<span class="st">&quot;me&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb288-32"><a href="chm-raster-resolution-testing.html#cb288-32" tabindex="-1"></a>      <span class="fu">toupper</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb288-33"><a href="chm-raster-resolution-testing.html#cb288-33" tabindex="-1"></a>      <span class="fu">factor</span>(</span>
<span id="cb288-34"><a href="chm-raster-resolution-testing.html#cb288-34" tabindex="-1"></a>        <span class="at">ordered =</span> T</span>
<span id="cb288-35"><a href="chm-raster-resolution-testing.html#cb288-35" tabindex="-1"></a>        , <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;FSCORE&quot;</span>,<span class="st">&quot;RECALL&quot;</span>,<span class="st">&quot;PRECISION&quot;</span>, <span class="st">&quot;ME&quot;</span>,<span class="st">&quot;RMSE&quot;</span>,<span class="st">&quot;RRMSE&quot;</span>,<span class="st">&quot;MAPE&quot;</span>)</span>
<span id="cb288-36"><a href="chm-raster-resolution-testing.html#cb288-36" tabindex="-1"></a>        , <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;F-score&quot;</span>,<span class="st">&quot;Recall&quot;</span>,<span class="st">&quot;Precision&quot;</span>, <span class="st">&quot;ME&quot;</span>,<span class="st">&quot;RMSE&quot;</span>,<span class="st">&quot;RRMSE&quot;</span>,<span class="st">&quot;MAPE&quot;</span>)</span>
<span id="cb288-37"><a href="chm-raster-resolution-testing.html#cb288-37" tabindex="-1"></a>      )</span>
<span id="cb288-38"><a href="chm-raster-resolution-testing.html#cb288-38" tabindex="-1"></a>    , <span class="at">pile_metric =</span> metric <span class="sc">%&gt;%</span> </span>
<span id="cb288-39"><a href="chm-raster-resolution-testing.html#cb288-39" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_remove</span>(<span class="st">&quot;(_rmse|_rrmse|_mean|_mape)$&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb288-40"><a href="chm-raster-resolution-testing.html#cb288-40" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_extract</span>(<span class="st">&quot;(paraboloid_volume|volume|area|height|diameter)&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb288-41"><a href="chm-raster-resolution-testing.html#cb288-41" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">coalesce</span>(<span class="st">&quot;detection&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb288-42"><a href="chm-raster-resolution-testing.html#cb288-42" tabindex="-1"></a>      <span class="fu">factor</span>(</span>
<span id="cb288-43"><a href="chm-raster-resolution-testing.html#cb288-43" tabindex="-1"></a>        <span class="at">ordered =</span> T</span>
<span id="cb288-44"><a href="chm-raster-resolution-testing.html#cb288-44" tabindex="-1"></a>        , <span class="at">levels =</span> <span class="fu">c</span>(</span>
<span id="cb288-45"><a href="chm-raster-resolution-testing.html#cb288-45" tabindex="-1"></a>          <span class="st">&quot;detection&quot;</span></span>
<span id="cb288-46"><a href="chm-raster-resolution-testing.html#cb288-46" tabindex="-1"></a>          , <span class="st">&quot;volume&quot;</span></span>
<span id="cb288-47"><a href="chm-raster-resolution-testing.html#cb288-47" tabindex="-1"></a>          , <span class="st">&quot;paraboloid_volume&quot;</span></span>
<span id="cb288-48"><a href="chm-raster-resolution-testing.html#cb288-48" tabindex="-1"></a>          , <span class="st">&quot;area&quot;</span></span>
<span id="cb288-49"><a href="chm-raster-resolution-testing.html#cb288-49" tabindex="-1"></a>          , <span class="st">&quot;height&quot;</span></span>
<span id="cb288-50"><a href="chm-raster-resolution-testing.html#cb288-50" tabindex="-1"></a>          , <span class="st">&quot;diameter&quot;</span></span>
<span id="cb288-51"><a href="chm-raster-resolution-testing.html#cb288-51" tabindex="-1"></a>        )</span>
<span id="cb288-52"><a href="chm-raster-resolution-testing.html#cb288-52" tabindex="-1"></a>        , <span class="at">labels =</span> <span class="fu">c</span>(</span>
<span id="cb288-53"><a href="chm-raster-resolution-testing.html#cb288-53" tabindex="-1"></a>          <span class="st">&quot;Detection&quot;</span></span>
<span id="cb288-54"><a href="chm-raster-resolution-testing.html#cb288-54" tabindex="-1"></a>          , <span class="st">&quot;Volume&quot;</span></span>
<span id="cb288-55"><a href="chm-raster-resolution-testing.html#cb288-55" tabindex="-1"></a>          , <span class="st">&quot;Volume paraboloid&quot;</span></span>
<span id="cb288-56"><a href="chm-raster-resolution-testing.html#cb288-56" tabindex="-1"></a>          , <span class="st">&quot;Area&quot;</span></span>
<span id="cb288-57"><a href="chm-raster-resolution-testing.html#cb288-57" tabindex="-1"></a>          , <span class="st">&quot;Height&quot;</span></span>
<span id="cb288-58"><a href="chm-raster-resolution-testing.html#cb288-58" tabindex="-1"></a>          , <span class="st">&quot;Diameter&quot;</span></span>
<span id="cb288-59"><a href="chm-raster-resolution-testing.html#cb288-59" tabindex="-1"></a>        )</span>
<span id="cb288-60"><a href="chm-raster-resolution-testing.html#cb288-60" tabindex="-1"></a>      )</span>
<span id="cb288-61"><a href="chm-raster-resolution-testing.html#cb288-61" tabindex="-1"></a>    , <span class="at">value_lab =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb288-62"><a href="chm-raster-resolution-testing.html#cb288-62" tabindex="-1"></a>        eval_metric <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;F-score&quot;</span>,<span class="st">&quot;Recall&quot;</span>,<span class="st">&quot;Precision&quot;</span>, <span class="st">&quot;RRMSE&quot;</span>, <span class="st">&quot;MAPE&quot;</span>) <span class="sc">~</span> scales<span class="sc">::</span><span class="fu">percent</span>(value,<span class="at">accuracy=</span><span class="fl">0.1</span>)</span>
<span id="cb288-63"><a href="chm-raster-resolution-testing.html#cb288-63" tabindex="-1"></a>        , eval_metric <span class="sc">==</span> <span class="st">&quot;ME&quot;</span> <span class="sc">~</span> scales<span class="sc">::</span><span class="fu">comma</span>(value,<span class="at">accuracy=</span><span class="fl">0.01</span>)</span>
<span id="cb288-64"><a href="chm-raster-resolution-testing.html#cb288-64" tabindex="-1"></a>        , T <span class="sc">~</span> scales<span class="sc">::</span><span class="fu">comma</span>(value,<span class="at">accuracy=</span><span class="fl">0.1</span>)</span>
<span id="cb288-65"><a href="chm-raster-resolution-testing.html#cb288-65" tabindex="-1"></a>      )</span>
<span id="cb288-66"><a href="chm-raster-resolution-testing.html#cb288-66" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb288-67"><a href="chm-raster-resolution-testing.html#cb288-67" tabindex="-1"></a>  <span class="co"># make var for color</span></span>
<span id="cb288-68"><a href="chm-raster-resolution-testing.html#cb288-68" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(chm_res_m,chm_res_m_desc, pile_metric, eval_metric) <span class="sc">%&gt;%</span> </span>
<span id="cb288-69"><a href="chm-raster-resolution-testing.html#cb288-69" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb288-70"><a href="chm-raster-resolution-testing.html#cb288-70" tabindex="-1"></a>    <span class="co"># for ME, color by abs...for f-score,recall,precision color by -value so that higher means better...</span></span>
<span id="cb288-71"><a href="chm-raster-resolution-testing.html#cb288-71" tabindex="-1"></a>      <span class="co"># ...since higher means worse for quantification accuracy metrics</span></span>
<span id="cb288-72"><a href="chm-raster-resolution-testing.html#cb288-72" tabindex="-1"></a>    <span class="at">value_dir =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb288-73"><a href="chm-raster-resolution-testing.html#cb288-73" tabindex="-1"></a>      eval_metric <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;ME&quot;</span>) <span class="sc">~</span> <span class="fu">abs</span>(value)</span>
<span id="cb288-74"><a href="chm-raster-resolution-testing.html#cb288-74" tabindex="-1"></a>      , eval_metric <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;F-score&quot;</span>,<span class="st">&quot;Recall&quot;</span>,<span class="st">&quot;Precision&quot;</span>) <span class="sc">~</span> <span class="sc">-</span>value</span>
<span id="cb288-75"><a href="chm-raster-resolution-testing.html#cb288-75" tabindex="-1"></a>      , T <span class="sc">~</span> value</span>
<span id="cb288-76"><a href="chm-raster-resolution-testing.html#cb288-76" tabindex="-1"></a>    )</span>
<span id="cb288-77"><a href="chm-raster-resolution-testing.html#cb288-77" tabindex="-1"></a>    , <span class="at">value_z =</span> (value_dir<span class="sc">-</span><span class="fu">mean</span>(value_dir,<span class="at">na.rm=</span>T))<span class="sc">/</span><span class="fu">sd</span>(value_dir,<span class="at">na.rm=</span>T) <span class="co"># this is the key to the different colors within facets</span></span>
<span id="cb288-78"><a href="chm-raster-resolution-testing.html#cb288-78" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb288-79"><a href="chm-raster-resolution-testing.html#cb288-79" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb288-80"><a href="chm-raster-resolution-testing.html#cb288-80" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span>eval_metric <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;RRMSE&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb288-81"><a href="chm-raster-resolution-testing.html#cb288-81" tabindex="-1"></a>  <span class="co"># View()</span></span>
<span id="cb288-82"><a href="chm-raster-resolution-testing.html#cb288-82" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> eval_metric, <span class="at">y =</span> chm_lab)) <span class="sc">+</span> </span>
<span id="cb288-83"><a href="chm-raster-resolution-testing.html#cb288-83" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_tile</span>(</span>
<span id="cb288-84"><a href="chm-raster-resolution-testing.html#cb288-84" tabindex="-1"></a>    <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">fill =</span> pile_metric, <span class="at">alpha =</span> <span class="sc">-</span>value_z)</span>
<span id="cb288-85"><a href="chm-raster-resolution-testing.html#cb288-85" tabindex="-1"></a>    , <span class="at">color =</span> <span class="st">&quot;gray&quot;</span></span>
<span id="cb288-86"><a href="chm-raster-resolution-testing.html#cb288-86" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb288-87"><a href="chm-raster-resolution-testing.html#cb288-87" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_text</span>(</span>
<span id="cb288-88"><a href="chm-raster-resolution-testing.html#cb288-88" tabindex="-1"></a>    <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">label =</span> value_lab, <span class="at">fontface =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb288-89"><a href="chm-raster-resolution-testing.html#cb288-89" tabindex="-1"></a>    , <span class="at">color =</span> <span class="st">&quot;white&quot;</span></span>
<span id="cb288-90"><a href="chm-raster-resolution-testing.html#cb288-90" tabindex="-1"></a>    , <span class="at">size =</span> <span class="dv">3</span></span>
<span id="cb288-91"><a href="chm-raster-resolution-testing.html#cb288-91" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb288-92"><a href="chm-raster-resolution-testing.html#cb288-92" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">facet_grid</span>(<span class="at">cols =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(pile_metric), <span class="at">rows =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(chm_res_m_desc), <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>) <span class="sc">+</span> </span>
<span id="cb288-93"><a href="chm-raster-resolution-testing.html#cb288-93" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_x_discrete</span>(<span class="at">position =</span> <span class="st">&quot;top&quot;</span>) <span class="sc">+</span></span>
<span id="cb288-94"><a href="chm-raster-resolution-testing.html#cb288-94" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;gray33&quot;</span>, harrypotter<span class="sc">::</span><span class="fu">hp</span>(<span class="at">n=</span><span class="dv">3</span>,<span class="at">option =</span> <span class="st">&quot;hermionegranger&quot;</span>) )) <span class="sc">+</span></span>
<span id="cb288-95"><a href="chm-raster-resolution-testing.html#cb288-95" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_alpha_binned</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="fl">0.55</span>, <span class="dv">1</span>)) <span class="sc">+</span> <span class="co"># this is the key to the different colors within facets</span></span>
<span id="cb288-96"><a href="chm-raster-resolution-testing.html#cb288-96" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb288-97"><a href="chm-raster-resolution-testing.html#cb288-97" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb288-98"><a href="chm-raster-resolution-testing.html#cb288-98" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;&quot;</span></span>
<span id="cb288-99"><a href="chm-raster-resolution-testing.html#cb288-99" tabindex="-1"></a>    , <span class="at">y =</span> <span class="st">&quot;max_ht_m : max_area_m2 : convexity_pct : circle_fit_iou_pct : chm_res_m : spectral_weight&quot;</span></span>
<span id="cb288-100"><a href="chm-raster-resolution-testing.html#cb288-100" tabindex="-1"></a>    , <span class="at">subtitle =</span> <span class="fu">paste0</span>(</span>
<span id="cb288-101"><a href="chm-raster-resolution-testing.html#cb288-101" tabindex="-1"></a>       <span class="st">&quot;Data Fusion&quot;</span></span>
<span id="cb288-102"><a href="chm-raster-resolution-testing.html#cb288-102" tabindex="-1"></a>       , <span class="st">&quot;</span><span class="sc">\n</span><span class="st">pile detection and form quantification accuracy metrics for the final recommended parameter settings&quot;</span></span>
<span id="cb288-103"><a href="chm-raster-resolution-testing.html#cb288-103" tabindex="-1"></a>       <span class="co"># , scales::percent(1-pct_rank_th_top,accuracy=1)</span></span>
<span id="cb288-104"><a href="chm-raster-resolution-testing.html#cb288-104" tabindex="-1"></a>       , <span class="st">&quot; (n=&quot;</span></span>
<span id="cb288-105"><a href="chm-raster-resolution-testing.html#cb288-105" tabindex="-1"></a>       , scales<span class="sc">::</span><span class="fu">comma</span>(n_th_top_chm,<span class="at">accuracy=</span><span class="dv">1</span>)</span>
<span id="cb288-106"><a href="chm-raster-resolution-testing.html#cb288-106" tabindex="-1"></a>       , <span class="st">&quot;) by CHM resolution&quot;</span></span>
<span id="cb288-107"><a href="chm-raster-resolution-testing.html#cb288-107" tabindex="-1"></a>       , <span class="st">&quot;</span><span class="sc">\n</span><span class="st">based on both detection and quantification accuracy&quot;</span></span>
<span id="cb288-108"><a href="chm-raster-resolution-testing.html#cb288-108" tabindex="-1"></a>      )</span>
<span id="cb288-109"><a href="chm-raster-resolution-testing.html#cb288-109" tabindex="-1"></a>    , <span class="at">caption =</span> <span class="st">&quot;*darker colors indicate relatively higher accuracy values&quot;</span></span>
<span id="cb288-110"><a href="chm-raster-resolution-testing.html#cb288-110" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb288-111"><a href="chm-raster-resolution-testing.html#cb288-111" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb288-112"><a href="chm-raster-resolution-testing.html#cb288-112" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb288-113"><a href="chm-raster-resolution-testing.html#cb288-113" tabindex="-1"></a>    , <span class="at">panel.grid =</span> ggplot2<span class="sc">::</span><span class="fu">element_blank</span>()</span>
<span id="cb288-114"><a href="chm-raster-resolution-testing.html#cb288-114" tabindex="-1"></a>    , <span class="at">strip.placement =</span> <span class="st">&quot;outside&quot;</span></span>
<span id="cb288-115"><a href="chm-raster-resolution-testing.html#cb288-115" tabindex="-1"></a>    , <span class="at">strip.text.x =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb288-116"><a href="chm-raster-resolution-testing.html#cb288-116" tabindex="-1"></a>    , <span class="at">strip.text.y =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">9</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb288-117"><a href="chm-raster-resolution-testing.html#cb288-117" tabindex="-1"></a>    , <span class="at">axis.text.x =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">7</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb288-118"><a href="chm-raster-resolution-testing.html#cb288-118" tabindex="-1"></a>    , <span class="at">axis.text.y =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">7</span>)</span>
<span id="cb288-119"><a href="chm-raster-resolution-testing.html#cb288-119" tabindex="-1"></a>    , <span class="at">axis.title.x =</span> ggplot2<span class="sc">::</span><span class="fu">element_blank</span>()</span>
<span id="cb288-120"><a href="chm-raster-resolution-testing.html#cb288-120" tabindex="-1"></a>    , <span class="at">plot.subtitle =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>)</span>
<span id="cb288-121"><a href="chm-raster-resolution-testing.html#cb288-121" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-259-1.png" width="1008" /></p>
<p>this plot allows for a simultaneous comparison of all metrics for pile detection and pile form quantification. it includes only the parameter combinations that achieved the best balanced accuracy, helping users identify the optimal settings by evaluating the trade-offs between detection and form quantification.</p>
<p>let’s table this</p>
<div class="sourceCode" id="cb289"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb289-1"><a href="chm-raster-resolution-testing.html#cb289-1" tabindex="-1"></a>param_combos_spectral_ranked <span class="sc">%&gt;%</span> </span>
<span id="cb289-2"><a href="chm-raster-resolution-testing.html#cb289-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(is_final_selection_chm) <span class="sc">%&gt;%</span> </span>
<span id="cb289-3"><a href="chm-raster-resolution-testing.html#cb289-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">!</span>tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;_pct_rank_&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb289-4"><a href="chm-raster-resolution-testing.html#cb289-4" tabindex="-1"></a>  <span class="co"># first select to arrange eval_metric</span></span>
<span id="cb289-5"><a href="chm-raster-resolution-testing.html#cb289-5" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb289-6"><a href="chm-raster-resolution-testing.html#cb289-6" tabindex="-1"></a>    chm_lab, chm_res_m_desc</span>
<span id="cb289-7"><a href="chm-raster-resolution-testing.html#cb289-7" tabindex="-1"></a>    , max_ht_m,max_area_m2,convexity_pct,circle_fit_iou_pct,chm_res_m,spectral_weight</span>
<span id="cb289-8"><a href="chm-raster-resolution-testing.html#cb289-8" tabindex="-1"></a>    <span class="co"># detection</span></span>
<span id="cb289-9"><a href="chm-raster-resolution-testing.html#cb289-9" tabindex="-1"></a>    , f_score, recall, precision</span>
<span id="cb289-10"><a href="chm-raster-resolution-testing.html#cb289-10" tabindex="-1"></a>    <span class="co"># quantification</span></span>
<span id="cb289-11"><a href="chm-raster-resolution-testing.html#cb289-11" tabindex="-1"></a>    , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_mean&quot;</span>)</span>
<span id="cb289-12"><a href="chm-raster-resolution-testing.html#cb289-12" tabindex="-1"></a>    , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_rmse&quot;</span>)</span>
<span id="cb289-13"><a href="chm-raster-resolution-testing.html#cb289-13" tabindex="-1"></a>    <span class="co"># , tidyselect::ends_with(&quot;_rrmse&quot;)</span></span>
<span id="cb289-14"><a href="chm-raster-resolution-testing.html#cb289-14" tabindex="-1"></a>    , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_mape&quot;</span>)</span>
<span id="cb289-15"><a href="chm-raster-resolution-testing.html#cb289-15" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb289-16"><a href="chm-raster-resolution-testing.html#cb289-16" tabindex="-1"></a>  <span class="co"># second select to arrange pile_metric</span></span>
<span id="cb289-17"><a href="chm-raster-resolution-testing.html#cb289-17" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb289-18"><a href="chm-raster-resolution-testing.html#cb289-18" tabindex="-1"></a>    chm_lab, chm_res_m_desc</span>
<span id="cb289-19"><a href="chm-raster-resolution-testing.html#cb289-19" tabindex="-1"></a>    , max_ht_m,max_area_m2,convexity_pct,circle_fit_iou_pct,chm_res_m,spectral_weight</span>
<span id="cb289-20"><a href="chm-raster-resolution-testing.html#cb289-20" tabindex="-1"></a>    <span class="co"># detection</span></span>
<span id="cb289-21"><a href="chm-raster-resolution-testing.html#cb289-21" tabindex="-1"></a>    , f_score, recall, precision</span>
<span id="cb289-22"><a href="chm-raster-resolution-testing.html#cb289-22" tabindex="-1"></a>    <span class="co"># quantification</span></span>
<span id="cb289-23"><a href="chm-raster-resolution-testing.html#cb289-23" tabindex="-1"></a>    , <span class="fu">c</span>(tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;volume&quot;</span>) <span class="sc">&amp;</span> <span class="sc">!</span>tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;paraboloid&quot;</span>))</span>
<span id="cb289-24"><a href="chm-raster-resolution-testing.html#cb289-24" tabindex="-1"></a>    , tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;area&quot;</span>)</span>
<span id="cb289-25"><a href="chm-raster-resolution-testing.html#cb289-25" tabindex="-1"></a>    , tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;height&quot;</span>)</span>
<span id="cb289-26"><a href="chm-raster-resolution-testing.html#cb289-26" tabindex="-1"></a>    , tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;diameter&quot;</span>)</span>
<span id="cb289-27"><a href="chm-raster-resolution-testing.html#cb289-27" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb289-28"><a href="chm-raster-resolution-testing.html#cb289-28" tabindex="-1"></a>  <span class="co"># names()</span></span>
<span id="cb289-29"><a href="chm-raster-resolution-testing.html#cb289-29" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb289-30"><a href="chm-raster-resolution-testing.html#cb289-30" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">across</span>(</span>
<span id="cb289-31"><a href="chm-raster-resolution-testing.html#cb289-31" tabindex="-1"></a>      <span class="at">.cols =</span> <span class="fu">c</span>(f_score, recall, precision, tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_mape&quot;</span>))</span>
<span id="cb289-32"><a href="chm-raster-resolution-testing.html#cb289-32" tabindex="-1"></a>      , <span class="at">.fn =</span> <span class="sc">~</span> scales<span class="sc">::</span><span class="fu">percent</span>(.x, <span class="at">accuracy =</span> <span class="dv">1</span>)</span>
<span id="cb289-33"><a href="chm-raster-resolution-testing.html#cb289-33" tabindex="-1"></a>    )</span>
<span id="cb289-34"><a href="chm-raster-resolution-testing.html#cb289-34" tabindex="-1"></a>    , dplyr<span class="sc">::</span><span class="fu">across</span>(</span>
<span id="cb289-35"><a href="chm-raster-resolution-testing.html#cb289-35" tabindex="-1"></a>      <span class="at">.cols =</span> <span class="fu">c</span>(tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_mean&quot;</span>))</span>
<span id="cb289-36"><a href="chm-raster-resolution-testing.html#cb289-36" tabindex="-1"></a>      , <span class="at">.fn =</span> <span class="sc">~</span> scales<span class="sc">::</span><span class="fu">comma</span>(.x, <span class="at">accuracy =</span> <span class="fl">0.01</span>)</span>
<span id="cb289-37"><a href="chm-raster-resolution-testing.html#cb289-37" tabindex="-1"></a>    )</span>
<span id="cb289-38"><a href="chm-raster-resolution-testing.html#cb289-38" tabindex="-1"></a>    , dplyr<span class="sc">::</span><span class="fu">across</span>(</span>
<span id="cb289-39"><a href="chm-raster-resolution-testing.html#cb289-39" tabindex="-1"></a>      <span class="at">.cols =</span> <span class="fu">c</span>(tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_rmse&quot;</span>))</span>
<span id="cb289-40"><a href="chm-raster-resolution-testing.html#cb289-40" tabindex="-1"></a>      , <span class="at">.fn =</span> <span class="sc">~</span> scales<span class="sc">::</span><span class="fu">comma</span>(.x, <span class="at">accuracy =</span> <span class="fl">0.1</span>)</span>
<span id="cb289-41"><a href="chm-raster-resolution-testing.html#cb289-41" tabindex="-1"></a>    )</span>
<span id="cb289-42"><a href="chm-raster-resolution-testing.html#cb289-42" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb289-43"><a href="chm-raster-resolution-testing.html#cb289-43" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">blank=</span> <span class="st">&quot;   &quot;</span> ) <span class="sc">%&gt;%</span> </span>
<span id="cb289-44"><a href="chm-raster-resolution-testing.html#cb289-44" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">relocate</span>(blank, <span class="at">.before =</span> f_score) <span class="sc">%&gt;%</span> </span>
<span id="cb289-45"><a href="chm-raster-resolution-testing.html#cb289-45" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(chm_res_m, <span class="fu">desc</span>(chm_lab)) <span class="sc">%&gt;%</span> </span>
<span id="cb289-46"><a href="chm-raster-resolution-testing.html#cb289-46" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>chm_res_m) <span class="sc">%&gt;%</span> </span>
<span id="cb289-47"><a href="chm-raster-resolution-testing.html#cb289-47" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">relocate</span>(chm_res_m_desc) <span class="sc">%&gt;%</span> </span>
<span id="cb289-48"><a href="chm-raster-resolution-testing.html#cb289-48" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kbl</span>(</span>
<span id="cb289-49"><a href="chm-raster-resolution-testing.html#cb289-49" tabindex="-1"></a>    <span class="at">caption =</span> </span>
<span id="cb289-50"><a href="chm-raster-resolution-testing.html#cb289-50" tabindex="-1"></a>      <span class="fu">paste0</span>(</span>
<span id="cb289-51"><a href="chm-raster-resolution-testing.html#cb289-51" tabindex="-1"></a>       <span class="st">&quot;Data Fusion&quot;</span></span>
<span id="cb289-52"><a href="chm-raster-resolution-testing.html#cb289-52" tabindex="-1"></a>       , <span class="st">&quot;&lt;br&gt;pile detection and form quantification accuracy metrics for the final recommended parameter settings&quot;</span></span>
<span id="cb289-53"><a href="chm-raster-resolution-testing.html#cb289-53" tabindex="-1"></a>       <span class="co"># , scales::percent(1-pct_rank_th_top,accuracy=1)</span></span>
<span id="cb289-54"><a href="chm-raster-resolution-testing.html#cb289-54" tabindex="-1"></a>       , <span class="st">&quot; (n=&quot;</span></span>
<span id="cb289-55"><a href="chm-raster-resolution-testing.html#cb289-55" tabindex="-1"></a>       , scales<span class="sc">::</span><span class="fu">comma</span>(n_th_top_chm,<span class="at">accuracy=</span><span class="dv">1</span>)</span>
<span id="cb289-56"><a href="chm-raster-resolution-testing.html#cb289-56" tabindex="-1"></a>       , <span class="st">&quot;) by CHM resolution &quot;</span></span>
<span id="cb289-57"><a href="chm-raster-resolution-testing.html#cb289-57" tabindex="-1"></a>       , <span class="st">&quot;&lt;br&gt;based on both detection and quantification accuracy&quot;</span></span>
<span id="cb289-58"><a href="chm-raster-resolution-testing.html#cb289-58" tabindex="-1"></a>      )</span>
<span id="cb289-59"><a href="chm-raster-resolution-testing.html#cb289-59" tabindex="-1"></a>    , <span class="at">col.names =</span> <span class="fu">c</span>(</span>
<span id="cb289-60"><a href="chm-raster-resolution-testing.html#cb289-60" tabindex="-1"></a>      <span class="st">&quot;.&quot;</span>, <span class="st">&quot;&quot;</span></span>
<span id="cb289-61"><a href="chm-raster-resolution-testing.html#cb289-61" tabindex="-1"></a>      ,<span class="st">&quot;max_ht_m&quot;</span>,<span class="st">&quot;max_area_m2&quot;</span>,<span class="st">&quot;convexity_pct&quot;</span>,<span class="st">&quot;circle_fit_iou_pct&quot;</span>,<span class="st">&quot;spectral_weight&quot;</span></span>
<span id="cb289-62"><a href="chm-raster-resolution-testing.html#cb289-62" tabindex="-1"></a>      , <span class="st">&quot;   &quot;</span></span>
<span id="cb289-63"><a href="chm-raster-resolution-testing.html#cb289-63" tabindex="-1"></a>      , <span class="st">&quot;F-score&quot;</span>, <span class="st">&quot;Recall&quot;</span>, <span class="st">&quot;Precision&quot;</span></span>
<span id="cb289-64"><a href="chm-raster-resolution-testing.html#cb289-64" tabindex="-1"></a>      , <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;ME&quot;</span>,<span class="st">&quot;RMSE&quot;</span>,<span class="st">&quot;MAPE&quot;</span>), <span class="at">times =</span> <span class="dv">3</span>)</span>
<span id="cb289-65"><a href="chm-raster-resolution-testing.html#cb289-65" tabindex="-1"></a>    )</span>
<span id="cb289-66"><a href="chm-raster-resolution-testing.html#cb289-66" tabindex="-1"></a>    , <span class="at">escape =</span> F</span>
<span id="cb289-67"><a href="chm-raster-resolution-testing.html#cb289-67" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb289-68"><a href="chm-raster-resolution-testing.html#cb289-68" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kable_styling</span>(<span class="at">font_size =</span> <span class="dv">11</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb289-69"><a href="chm-raster-resolution-testing.html#cb289-69" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">add_header_above</span>(<span class="fu">c</span>(</span>
<span id="cb289-70"><a href="chm-raster-resolution-testing.html#cb289-70" tabindex="-1"></a>    <span class="st">&quot; &quot;</span><span class="ot">=</span><span class="dv">8</span></span>
<span id="cb289-71"><a href="chm-raster-resolution-testing.html#cb289-71" tabindex="-1"></a>    , <span class="st">&quot;Detection&quot;</span> <span class="ot">=</span> <span class="dv">3</span></span>
<span id="cb289-72"><a href="chm-raster-resolution-testing.html#cb289-72" tabindex="-1"></a>    <span class="co"># , &quot;Volume&quot; = 3</span></span>
<span id="cb289-73"><a href="chm-raster-resolution-testing.html#cb289-73" tabindex="-1"></a>    , <span class="st">&quot;Area&quot;</span> <span class="ot">=</span> <span class="dv">3</span></span>
<span id="cb289-74"><a href="chm-raster-resolution-testing.html#cb289-74" tabindex="-1"></a>    , <span class="st">&quot;Height&quot;</span> <span class="ot">=</span> <span class="dv">3</span></span>
<span id="cb289-75"><a href="chm-raster-resolution-testing.html#cb289-75" tabindex="-1"></a>    , <span class="st">&quot;Diameter&quot;</span> <span class="ot">=</span> <span class="dv">3</span></span>
<span id="cb289-76"><a href="chm-raster-resolution-testing.html#cb289-76" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb289-77"><a href="chm-raster-resolution-testing.html#cb289-77" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">column_spec</span>(<span class="fu">seq</span>(<span class="dv">8</span>,<span class="dv">20</span>,<span class="at">by=</span><span class="dv">3</span>), <span class="at">border_right =</span> <span class="cn">TRUE</span>, <span class="at">include_thead =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb289-78"><a href="chm-raster-resolution-testing.html#cb289-78" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">column_spec</span>(</span>
<span id="cb289-79"><a href="chm-raster-resolution-testing.html#cb289-79" tabindex="-1"></a>    <span class="at">column =</span> <span class="dv">8</span><span class="sc">:</span><span class="dv">20</span></span>
<span id="cb289-80"><a href="chm-raster-resolution-testing.html#cb289-80" tabindex="-1"></a>    , <span class="at">extra_css =</span> <span class="st">&quot;font-size: 10px;&quot;</span></span>
<span id="cb289-81"><a href="chm-raster-resolution-testing.html#cb289-81" tabindex="-1"></a>    , <span class="at">include_thead =</span> T</span>
<span id="cb289-82"><a href="chm-raster-resolution-testing.html#cb289-82" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb289-83"><a href="chm-raster-resolution-testing.html#cb289-83" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">collapse_rows</span>(<span class="at">columns =</span> <span class="dv">1</span>, <span class="at">valign =</span> <span class="st">&quot;top&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb289-84"><a href="chm-raster-resolution-testing.html#cb289-84" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">scroll_box</span>(<span class="at">width =</span> <span class="st">&quot;740px&quot;</span>) </span></code></pre></div>
<div style="border: 1px solid #ddd; padding: 5px; overflow-x: scroll; width:740px; ">
<table class="table" style="font-size: 11px; margin-left: auto; margin-right: auto;">
<caption style="font-size: initial !important;">
<span id="tab:unnamed-chunk-261">Table 8.4: </span>Data Fusion<br>pile detection and form quantification accuracy metrics for the final recommended parameter settings (n=6) by CHM resolution <br>based on both detection and quantification accuracy
</caption>
<thead>
<tr>
<th style="empty-cells: hide;border-bottom:hidden;" colspan="8">
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="3">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Detection
</div>
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="3">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Area
</div>
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="3">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Height
</div>
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="3">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Diameter
</div>
</th>
</tr>
<tr>
<th style="text-align:left;">
.
</th>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
max_ht_m
</th>
<th style="text-align:right;">
max_area_m2
</th>
<th style="text-align:right;">
convexity_pct
</th>
<th style="text-align:right;">
circle_fit_iou_pct
</th>
<th style="text-align:right;">
spectral_weight
</th>
<th style="text-align:left;border-right:1px solid;font-size: 10px;">
</th>
<th style="text-align:left;font-size: 10px;">
F-score
</th>
<th style="text-align:left;font-size: 10px;">
Recall
</th>
<th style="text-align:left;border-right:1px solid;font-size: 10px;">
Precision
</th>
<th style="text-align:left;font-size: 10px;">
ME
</th>
<th style="text-align:left;font-size: 10px;">
RMSE
</th>
<th style="text-align:left;border-right:1px solid;font-size: 10px;">
MAPE
</th>
<th style="text-align:left;font-size: 10px;">
ME
</th>
<th style="text-align:left;font-size: 10px;">
RMSE
</th>
<th style="text-align:left;border-right:1px solid;font-size: 10px;">
MAPE
</th>
<th style="text-align:left;font-size: 10px;">
ME
</th>
<th style="text-align:left;font-size: 10px;">
RMSE
</th>
<th style="text-align:left;border-right:1px solid;font-size: 10px;">
MAPE
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="6">
0.1m CHM
</td>
<td style="text-align:left;">
5:50:0.65:0.65:0.1:4
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
50
</td>
<td style="text-align:right;">
0.65
</td>
<td style="text-align:right;">
0.65
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
89%
</td>
<td style="text-align:left;font-size: 10px;">
91%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
87%
</td>
<td style="text-align:left;font-size: 10px;">
-0.81
</td>
<td style="text-align:left;font-size: 10px;">
2.1
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
10%
</td>
<td style="text-align:left;font-size: 10px;">
-0.09
</td>
<td style="text-align:left;font-size: 10px;">
0.6
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
18%
</td>
<td style="text-align:left;font-size: 10px;">
0.21
</td>
<td style="text-align:left;font-size: 10px;">
0.5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
10%
</td>
</tr>
<tr>
<td style="text-align:left;">
5:50:0.5:0.65:0.1:4
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
50
</td>
<td style="text-align:right;">
0.50
</td>
<td style="text-align:right;">
0.65
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
89%
</td>
<td style="text-align:left;font-size: 10px;">
91%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
87%
</td>
<td style="text-align:left;font-size: 10px;">
-0.81
</td>
<td style="text-align:left;font-size: 10px;">
2.1
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
10%
</td>
<td style="text-align:left;font-size: 10px;">
-0.09
</td>
<td style="text-align:left;font-size: 10px;">
0.6
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
18%
</td>
<td style="text-align:left;font-size: 10px;">
0.21
</td>
<td style="text-align:left;font-size: 10px;">
0.5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
10%
</td>
</tr>
<tr>
<td style="text-align:left;">
5:50:0.35:0.65:0.1:4
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
50
</td>
<td style="text-align:right;">
0.35
</td>
<td style="text-align:right;">
0.65
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
89%
</td>
<td style="text-align:left;font-size: 10px;">
91%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
87%
</td>
<td style="text-align:left;font-size: 10px;">
-0.81
</td>
<td style="text-align:left;font-size: 10px;">
2.1
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
10%
</td>
<td style="text-align:left;font-size: 10px;">
-0.09
</td>
<td style="text-align:left;font-size: 10px;">
0.6
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
18%
</td>
<td style="text-align:left;font-size: 10px;">
0.21
</td>
<td style="text-align:left;font-size: 10px;">
0.5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
10%
</td>
</tr>
<tr>
<td style="text-align:left;">
5:50:0.2:0.65:0.1:4
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
50
</td>
<td style="text-align:right;">
0.20
</td>
<td style="text-align:right;">
0.65
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
89%
</td>
<td style="text-align:left;font-size: 10px;">
91%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
87%
</td>
<td style="text-align:left;font-size: 10px;">
-0.81
</td>
<td style="text-align:left;font-size: 10px;">
2.1
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
10%
</td>
<td style="text-align:left;font-size: 10px;">
-0.09
</td>
<td style="text-align:left;font-size: 10px;">
0.6
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
18%
</td>
<td style="text-align:left;font-size: 10px;">
0.21
</td>
<td style="text-align:left;font-size: 10px;">
0.5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
10%
</td>
</tr>
<tr>
<td style="text-align:left;">
5:50:0.05:0.65:0.1:4
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
50
</td>
<td style="text-align:right;">
0.05
</td>
<td style="text-align:right;">
0.65
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
89%
</td>
<td style="text-align:left;font-size: 10px;">
91%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
87%
</td>
<td style="text-align:left;font-size: 10px;">
-0.81
</td>
<td style="text-align:left;font-size: 10px;">
2.1
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
10%
</td>
<td style="text-align:left;font-size: 10px;">
-0.09
</td>
<td style="text-align:left;font-size: 10px;">
0.6
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
18%
</td>
<td style="text-align:left;font-size: 10px;">
0.21
</td>
<td style="text-align:left;font-size: 10px;">
0.5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
10%
</td>
</tr>
<tr>
<td style="text-align:left;">
5:40:0.8:0.5:0.1:4
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
40
</td>
<td style="text-align:right;">
0.80
</td>
<td style="text-align:right;">
0.50
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
87%
</td>
<td style="text-align:left;font-size: 10px;">
92%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
83%
</td>
<td style="text-align:left;font-size: 10px;">
-0.66
</td>
<td style="text-align:left;font-size: 10px;">
1.7
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
11%
</td>
<td style="text-align:left;font-size: 10px;">
-0.06
</td>
<td style="text-align:left;font-size: 10px;">
0.6
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
19%
</td>
<td style="text-align:left;font-size: 10px;">
0.19
</td>
<td style="text-align:left;font-size: 10px;">
0.5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
10%
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="6">
0.2m CHM
</td>
<td style="text-align:left;">
2:60:0.8:0.05:0.2:4
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
60
</td>
<td style="text-align:right;">
0.80
</td>
<td style="text-align:right;">
0.05
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
80%
</td>
<td style="text-align:left;font-size: 10px;">
84%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
76%
</td>
<td style="text-align:left;font-size: 10px;">
0.53
</td>
<td style="text-align:left;font-size: 10px;">
1.7
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
13%
</td>
<td style="text-align:left;font-size: 10px;">
-0.27
</td>
<td style="text-align:left;font-size: 10px;">
0.5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
14%
</td>
<td style="text-align:left;font-size: 10px;">
0.48
</td>
<td style="text-align:left;font-size: 10px;">
0.7
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
18%
</td>
</tr>
<tr>
<td style="text-align:left;">
2:50:0.8:0.05:0.2:4
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
50
</td>
<td style="text-align:right;">
0.80
</td>
<td style="text-align:right;">
0.05
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
80%
</td>
<td style="text-align:left;font-size: 10px;">
84%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
76%
</td>
<td style="text-align:left;font-size: 10px;">
0.53
</td>
<td style="text-align:left;font-size: 10px;">
1.7
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
13%
</td>
<td style="text-align:left;font-size: 10px;">
-0.27
</td>
<td style="text-align:left;font-size: 10px;">
0.5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
14%
</td>
<td style="text-align:left;font-size: 10px;">
0.48
</td>
<td style="text-align:left;font-size: 10px;">
0.7
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
18%
</td>
</tr>
<tr>
<td style="text-align:left;">
2:40:0.8:0.05:0.2:4
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
40
</td>
<td style="text-align:right;">
0.80
</td>
<td style="text-align:right;">
0.05
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
80%
</td>
<td style="text-align:left;font-size: 10px;">
84%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
76%
</td>
<td style="text-align:left;font-size: 10px;">
0.53
</td>
<td style="text-align:left;font-size: 10px;">
1.7
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
13%
</td>
<td style="text-align:left;font-size: 10px;">
-0.27
</td>
<td style="text-align:left;font-size: 10px;">
0.5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
14%
</td>
<td style="text-align:left;font-size: 10px;">
0.48
</td>
<td style="text-align:left;font-size: 10px;">
0.7
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
18%
</td>
</tr>
<tr>
<td style="text-align:left;">
2:30:0.8:0.05:0.2:4
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
30
</td>
<td style="text-align:right;">
0.80
</td>
<td style="text-align:right;">
0.05
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
80%
</td>
<td style="text-align:left;font-size: 10px;">
84%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
76%
</td>
<td style="text-align:left;font-size: 10px;">
0.53
</td>
<td style="text-align:left;font-size: 10px;">
1.7
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
13%
</td>
<td style="text-align:left;font-size: 10px;">
-0.27
</td>
<td style="text-align:left;font-size: 10px;">
0.5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
14%
</td>
<td style="text-align:left;font-size: 10px;">
0.48
</td>
<td style="text-align:left;font-size: 10px;">
0.7
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
18%
</td>
</tr>
<tr>
<td style="text-align:left;">
2:40:0.8:0.05:0.2:3
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
40
</td>
<td style="text-align:right;">
0.80
</td>
<td style="text-align:right;">
0.05
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
76%
</td>
<td style="text-align:left;font-size: 10px;">
84%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
70%
</td>
<td style="text-align:left;font-size: 10px;">
0.53
</td>
<td style="text-align:left;font-size: 10px;">
1.7
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
13%
</td>
<td style="text-align:left;font-size: 10px;">
-0.27
</td>
<td style="text-align:left;font-size: 10px;">
0.5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
14%
</td>
<td style="text-align:left;font-size: 10px;">
0.48
</td>
<td style="text-align:left;font-size: 10px;">
0.7
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
18%
</td>
</tr>
<tr>
<td style="text-align:left;">
2:30:0.8:0.05:0.2:3
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
30
</td>
<td style="text-align:right;">
0.80
</td>
<td style="text-align:right;">
0.05
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
76%
</td>
<td style="text-align:left;font-size: 10px;">
84%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
70%
</td>
<td style="text-align:left;font-size: 10px;">
0.53
</td>
<td style="text-align:left;font-size: 10px;">
1.7
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
13%
</td>
<td style="text-align:left;font-size: 10px;">
-0.27
</td>
<td style="text-align:left;font-size: 10px;">
0.5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
14%
</td>
<td style="text-align:left;font-size: 10px;">
0.48
</td>
<td style="text-align:left;font-size: 10px;">
0.7
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
18%
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="6">
0.3m CHM
</td>
<td style="text-align:left;">
5:60:0.8:0.65:0.3:5
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
60
</td>
<td style="text-align:right;">
0.80
</td>
<td style="text-align:right;">
0.65
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
80%
</td>
<td style="text-align:left;font-size: 10px;">
78%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
82%
</td>
<td style="text-align:left;font-size: 10px;">
1.59
</td>
<td style="text-align:left;font-size: 10px;">
2.2
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
22%
</td>
<td style="text-align:left;font-size: 10px;">
-0.14
</td>
<td style="text-align:left;font-size: 10px;">
0.7
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
18%
</td>
<td style="text-align:left;font-size: 10px;">
0.74
</td>
<td style="text-align:left;font-size: 10px;">
0.8
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
24%
</td>
</tr>
<tr>
<td style="text-align:left;">
5:60:0.65:0.65:0.3:5
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
60
</td>
<td style="text-align:right;">
0.65
</td>
<td style="text-align:right;">
0.65
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
80%
</td>
<td style="text-align:left;font-size: 10px;">
78%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
82%
</td>
<td style="text-align:left;font-size: 10px;">
1.59
</td>
<td style="text-align:left;font-size: 10px;">
2.2
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
22%
</td>
<td style="text-align:left;font-size: 10px;">
-0.14
</td>
<td style="text-align:left;font-size: 10px;">
0.7
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
18%
</td>
<td style="text-align:left;font-size: 10px;">
0.74
</td>
<td style="text-align:left;font-size: 10px;">
0.8
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
24%
</td>
</tr>
<tr>
<td style="text-align:left;">
5:60:0.5:0.65:0.3:5
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
60
</td>
<td style="text-align:right;">
0.50
</td>
<td style="text-align:right;">
0.65
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
80%
</td>
<td style="text-align:left;font-size: 10px;">
78%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
82%
</td>
<td style="text-align:left;font-size: 10px;">
1.59
</td>
<td style="text-align:left;font-size: 10px;">
2.2
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
22%
</td>
<td style="text-align:left;font-size: 10px;">
-0.14
</td>
<td style="text-align:left;font-size: 10px;">
0.7
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
18%
</td>
<td style="text-align:left;font-size: 10px;">
0.74
</td>
<td style="text-align:left;font-size: 10px;">
0.8
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
24%
</td>
</tr>
<tr>
<td style="text-align:left;">
5:60:0.35:0.65:0.3:5
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
60
</td>
<td style="text-align:right;">
0.35
</td>
<td style="text-align:right;">
0.65
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
80%
</td>
<td style="text-align:left;font-size: 10px;">
78%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
82%
</td>
<td style="text-align:left;font-size: 10px;">
1.59
</td>
<td style="text-align:left;font-size: 10px;">
2.2
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
22%
</td>
<td style="text-align:left;font-size: 10px;">
-0.14
</td>
<td style="text-align:left;font-size: 10px;">
0.7
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
18%
</td>
<td style="text-align:left;font-size: 10px;">
0.74
</td>
<td style="text-align:left;font-size: 10px;">
0.8
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
24%
</td>
</tr>
<tr>
<td style="text-align:left;">
5:60:0.2:0.65:0.3:5
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
60
</td>
<td style="text-align:right;">
0.20
</td>
<td style="text-align:right;">
0.65
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
80%
</td>
<td style="text-align:left;font-size: 10px;">
78%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
82%
</td>
<td style="text-align:left;font-size: 10px;">
1.59
</td>
<td style="text-align:left;font-size: 10px;">
2.2
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
22%
</td>
<td style="text-align:left;font-size: 10px;">
-0.14
</td>
<td style="text-align:left;font-size: 10px;">
0.7
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
18%
</td>
<td style="text-align:left;font-size: 10px;">
0.74
</td>
<td style="text-align:left;font-size: 10px;">
0.8
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
24%
</td>
</tr>
<tr>
<td style="text-align:left;">
5:60:0.05:0.65:0.3:5
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
60
</td>
<td style="text-align:right;">
0.05
</td>
<td style="text-align:right;">
0.65
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
80%
</td>
<td style="text-align:left;font-size: 10px;">
78%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
82%
</td>
<td style="text-align:left;font-size: 10px;">
1.59
</td>
<td style="text-align:left;font-size: 10px;">
2.2
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
22%
</td>
<td style="text-align:left;font-size: 10px;">
-0.14
</td>
<td style="text-align:left;font-size: 10px;">
0.7
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
18%
</td>
<td style="text-align:left;font-size: 10px;">
0.74
</td>
<td style="text-align:left;font-size: 10px;">
0.8
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
24%
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="6">
0.4m CHM
</td>
<td style="text-align:left;">
2:40:0.8:0.05:0.4:4
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
40
</td>
<td style="text-align:right;">
0.80
</td>
<td style="text-align:right;">
0.05
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
63%
</td>
<td style="text-align:left;font-size: 10px;">
81%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
52%
</td>
<td style="text-align:left;font-size: 10px;">
2.48
</td>
<td style="text-align:left;font-size: 10px;">
3.1
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
37%
</td>
<td style="text-align:left;font-size: 10px;">
-0.29
</td>
<td style="text-align:left;font-size: 10px;">
0.5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
15%
</td>
<td style="text-align:left;font-size: 10px;">
1.01
</td>
<td style="text-align:left;font-size: 10px;">
1.1
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
34%
</td>
</tr>
<tr>
<td style="text-align:left;">
2:30:0.8:0.05:0.4:4
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
30
</td>
<td style="text-align:right;">
0.80
</td>
<td style="text-align:right;">
0.05
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
63%
</td>
<td style="text-align:left;font-size: 10px;">
81%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
52%
</td>
<td style="text-align:left;font-size: 10px;">
2.48
</td>
<td style="text-align:left;font-size: 10px;">
3.1
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
37%
</td>
<td style="text-align:left;font-size: 10px;">
-0.29
</td>
<td style="text-align:left;font-size: 10px;">
0.5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
15%
</td>
<td style="text-align:left;font-size: 10px;">
1.01
</td>
<td style="text-align:left;font-size: 10px;">
1.1
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
34%
</td>
</tr>
<tr>
<td style="text-align:left;">
2:20:0.5:0.05:0.4:5
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
20
</td>
<td style="text-align:right;">
0.50
</td>
<td style="text-align:right;">
0.05
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
70%
</td>
<td style="text-align:left;font-size: 10px;">
81%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
62%
</td>
<td style="text-align:left;font-size: 10px;">
1.77
</td>
<td style="text-align:left;font-size: 10px;">
5.6
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
38%
</td>
<td style="text-align:left;font-size: 10px;">
-0.30
</td>
<td style="text-align:left;font-size: 10px;">
0.5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
15%
</td>
<td style="text-align:left;font-size: 10px;">
0.96
</td>
<td style="text-align:left;font-size: 10px;">
1.2
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
35%
</td>
</tr>
<tr>
<td style="text-align:left;">
2:20:0.35:0.05:0.4:5
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
20
</td>
<td style="text-align:right;">
0.35
</td>
<td style="text-align:right;">
0.05
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
70%
</td>
<td style="text-align:left;font-size: 10px;">
81%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
62%
</td>
<td style="text-align:left;font-size: 10px;">
1.77
</td>
<td style="text-align:left;font-size: 10px;">
5.6
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
38%
</td>
<td style="text-align:left;font-size: 10px;">
-0.30
</td>
<td style="text-align:left;font-size: 10px;">
0.5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
15%
</td>
<td style="text-align:left;font-size: 10px;">
0.96
</td>
<td style="text-align:left;font-size: 10px;">
1.2
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
35%
</td>
</tr>
<tr>
<td style="text-align:left;">
2:20:0.2:0.05:0.4:5
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
20
</td>
<td style="text-align:right;">
0.20
</td>
<td style="text-align:right;">
0.05
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
70%
</td>
<td style="text-align:left;font-size: 10px;">
81%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
62%
</td>
<td style="text-align:left;font-size: 10px;">
1.77
</td>
<td style="text-align:left;font-size: 10px;">
5.6
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
38%
</td>
<td style="text-align:left;font-size: 10px;">
-0.30
</td>
<td style="text-align:left;font-size: 10px;">
0.5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
15%
</td>
<td style="text-align:left;font-size: 10px;">
0.96
</td>
<td style="text-align:left;font-size: 10px;">
1.2
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
35%
</td>
</tr>
<tr>
<td style="text-align:left;">
2:20:0.05:0.05:0.4:5
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
20
</td>
<td style="text-align:right;">
0.05
</td>
<td style="text-align:right;">
0.05
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
70%
</td>
<td style="text-align:left;font-size: 10px;">
81%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
62%
</td>
<td style="text-align:left;font-size: 10px;">
1.77
</td>
<td style="text-align:left;font-size: 10px;">
5.6
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
38%
</td>
<td style="text-align:left;font-size: 10px;">
-0.30
</td>
<td style="text-align:left;font-size: 10px;">
0.5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
15%
</td>
<td style="text-align:left;font-size: 10px;">
0.96
</td>
<td style="text-align:left;font-size: 10px;">
1.2
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
35%
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="6">
0.5m CHM
</td>
<td style="text-align:left;">
3:60:0.5:0.35:0.5:5
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
60
</td>
<td style="text-align:right;">
0.50
</td>
<td style="text-align:right;">
0.35
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
64%
</td>
<td style="text-align:left;font-size: 10px;">
83%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
51%
</td>
<td style="text-align:left;font-size: 10px;">
3.67
</td>
<td style="text-align:left;font-size: 10px;">
4.4
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
50%
</td>
<td style="text-align:left;font-size: 10px;">
-0.11
</td>
<td style="text-align:left;font-size: 10px;">
0.8
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
21%
</td>
<td style="text-align:left;font-size: 10px;">
1.30
</td>
<td style="text-align:left;font-size: 10px;">
1.4
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
41%
</td>
</tr>
<tr>
<td style="text-align:left;">
3:60:0.35:0.35:0.5:5
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
60
</td>
<td style="text-align:right;">
0.35
</td>
<td style="text-align:right;">
0.35
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
64%
</td>
<td style="text-align:left;font-size: 10px;">
83%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
51%
</td>
<td style="text-align:left;font-size: 10px;">
3.67
</td>
<td style="text-align:left;font-size: 10px;">
4.4
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
50%
</td>
<td style="text-align:left;font-size: 10px;">
-0.11
</td>
<td style="text-align:left;font-size: 10px;">
0.8
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
21%
</td>
<td style="text-align:left;font-size: 10px;">
1.30
</td>
<td style="text-align:left;font-size: 10px;">
1.4
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
41%
</td>
</tr>
<tr>
<td style="text-align:left;">
3:60:0.2:0.35:0.5:5
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
60
</td>
<td style="text-align:right;">
0.20
</td>
<td style="text-align:right;">
0.35
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
64%
</td>
<td style="text-align:left;font-size: 10px;">
83%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
51%
</td>
<td style="text-align:left;font-size: 10px;">
3.67
</td>
<td style="text-align:left;font-size: 10px;">
4.4
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
50%
</td>
<td style="text-align:left;font-size: 10px;">
-0.11
</td>
<td style="text-align:left;font-size: 10px;">
0.8
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
21%
</td>
<td style="text-align:left;font-size: 10px;">
1.30
</td>
<td style="text-align:left;font-size: 10px;">
1.4
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
41%
</td>
</tr>
<tr>
<td style="text-align:left;">
3:60:0.05:0.35:0.5:5
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
60
</td>
<td style="text-align:right;">
0.05
</td>
<td style="text-align:right;">
0.35
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
64%
</td>
<td style="text-align:left;font-size: 10px;">
83%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
51%
</td>
<td style="text-align:left;font-size: 10px;">
3.67
</td>
<td style="text-align:left;font-size: 10px;">
4.4
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
50%
</td>
<td style="text-align:left;font-size: 10px;">
-0.11
</td>
<td style="text-align:left;font-size: 10px;">
0.8
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
21%
</td>
<td style="text-align:left;font-size: 10px;">
1.30
</td>
<td style="text-align:left;font-size: 10px;">
1.4
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
41%
</td>
</tr>
<tr>
<td style="text-align:left;">
3:60:0.65:0.35:0.5:5
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
60
</td>
<td style="text-align:right;">
0.65
</td>
<td style="text-align:right;">
0.35
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
63%
</td>
<td style="text-align:left;font-size: 10px;">
83%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
51%
</td>
<td style="text-align:left;font-size: 10px;">
3.67
</td>
<td style="text-align:left;font-size: 10px;">
4.4
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
50%
</td>
<td style="text-align:left;font-size: 10px;">
-0.11
</td>
<td style="text-align:left;font-size: 10px;">
0.8
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
21%
</td>
<td style="text-align:left;font-size: 10px;">
1.30
</td>
<td style="text-align:left;font-size: 10px;">
1.4
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
41%
</td>
</tr>
<tr>
<td style="text-align:left;">
3:60:0.8:0.05:0.5:5
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
60
</td>
<td style="text-align:right;">
0.80
</td>
<td style="text-align:right;">
0.05
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
64%
</td>
<td style="text-align:left;font-size: 10px;">
87%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
50%
</td>
<td style="text-align:left;font-size: 10px;">
3.78
</td>
<td style="text-align:left;font-size: 10px;">
4.4
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
50%
</td>
<td style="text-align:left;font-size: 10px;">
-0.11
</td>
<td style="text-align:left;font-size: 10px;">
0.7
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
20%
</td>
<td style="text-align:left;font-size: 10px;">
1.33
</td>
<td style="text-align:left;font-size: 10px;">
1.4
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
42%
</td>
</tr>
</tbody>
</table>
</div>
<p>what is the expected <em>detection</em> accuracy of the final 6 recommended settings by CHM resolution?</p>
<div class="sourceCode" id="cb290"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb290-1"><a href="chm-raster-resolution-testing.html#cb290-1" tabindex="-1"></a><span class="fu">plt_detection_dist2</span>(</span>
<span id="cb290-2"><a href="chm-raster-resolution-testing.html#cb290-2" tabindex="-1"></a>  <span class="at">df =</span> param_combos_spectral_ranked <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(is_final_selection_chm) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">!</span>tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;_pct_rank_&quot;</span>))</span>
<span id="cb290-3"><a href="chm-raster-resolution-testing.html#cb290-3" tabindex="-1"></a>  , <span class="fu">paste0</span>(</span>
<span id="cb290-4"><a href="chm-raster-resolution-testing.html#cb290-4" tabindex="-1"></a>    <span class="st">&quot;Data Fusion&quot;</span></span>
<span id="cb290-5"><a href="chm-raster-resolution-testing.html#cb290-5" tabindex="-1"></a>    , <span class="st">&quot;</span><span class="sc">\n</span><span class="st">distribution of evaluation metrics for the final recommended parameter settings&quot;</span></span>
<span id="cb290-6"><a href="chm-raster-resolution-testing.html#cb290-6" tabindex="-1"></a>    , <span class="st">&quot; (n=&quot;</span></span>
<span id="cb290-7"><a href="chm-raster-resolution-testing.html#cb290-7" tabindex="-1"></a>    , scales<span class="sc">::</span><span class="fu">comma</span>(n_th_top_chm,<span class="at">accuracy=</span><span class="dv">1</span>)</span>
<span id="cb290-8"><a href="chm-raster-resolution-testing.html#cb290-8" tabindex="-1"></a>    , <span class="st">&quot;) by CHM resolution&quot;</span></span>
<span id="cb290-9"><a href="chm-raster-resolution-testing.html#cb290-9" tabindex="-1"></a>    , <span class="st">&quot;</span><span class="sc">\n</span><span class="st">based on both detection and quantification accuracy&quot;</span></span>
<span id="cb290-10"><a href="chm-raster-resolution-testing.html#cb290-10" tabindex="-1"></a>  )</span>
<span id="cb290-11"><a href="chm-raster-resolution-testing.html#cb290-11" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-262-1.png" width="1008" /></p>
<p><em>WHAT DID WE LEARN FROM THIS</em></p>
<p>what is the expected <em>MAPE</em> of the final 6 recommended settings by CHM resolution?</p>
<div class="sourceCode" id="cb291"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb291-1"><a href="chm-raster-resolution-testing.html#cb291-1" tabindex="-1"></a><span class="co"># plot it</span></span>
<span id="cb291-2"><a href="chm-raster-resolution-testing.html#cb291-2" tabindex="-1"></a><span class="fu">plt_form_quantification_dist2</span>(</span>
<span id="cb291-3"><a href="chm-raster-resolution-testing.html#cb291-3" tabindex="-1"></a>  <span class="at">df =</span> param_combos_spectral_ranked <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(is_final_selection_chm) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">!</span>tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;_pct_rank_&quot;</span>))</span>
<span id="cb291-4"><a href="chm-raster-resolution-testing.html#cb291-4" tabindex="-1"></a>  , <span class="at">quant_metric =</span> <span class="st">&quot;mape&quot;</span></span>
<span id="cb291-5"><a href="chm-raster-resolution-testing.html#cb291-5" tabindex="-1"></a>  , <span class="fu">paste0</span>(</span>
<span id="cb291-6"><a href="chm-raster-resolution-testing.html#cb291-6" tabindex="-1"></a>    <span class="st">&quot;Data Fusion&quot;</span></span>
<span id="cb291-7"><a href="chm-raster-resolution-testing.html#cb291-7" tabindex="-1"></a>    , <span class="st">&quot;</span><span class="sc">\n</span><span class="st">distribution of pile form quantification metrics for the final recommended parameter settings&quot;</span></span>
<span id="cb291-8"><a href="chm-raster-resolution-testing.html#cb291-8" tabindex="-1"></a>    , <span class="st">&quot; (n=&quot;</span></span>
<span id="cb291-9"><a href="chm-raster-resolution-testing.html#cb291-9" tabindex="-1"></a>    , scales<span class="sc">::</span><span class="fu">comma</span>(n_th_top_chm,<span class="at">accuracy=</span><span class="dv">1</span>)</span>
<span id="cb291-10"><a href="chm-raster-resolution-testing.html#cb291-10" tabindex="-1"></a>    , <span class="st">&quot;) by CHM resolution&quot;</span></span>
<span id="cb291-11"><a href="chm-raster-resolution-testing.html#cb291-11" tabindex="-1"></a>    , <span class="st">&quot;</span><span class="sc">\n</span><span class="st">based on both detection and quantification accuracy&quot;</span></span>
<span id="cb291-12"><a href="chm-raster-resolution-testing.html#cb291-12" tabindex="-1"></a>  )</span>
<span id="cb291-13"><a href="chm-raster-resolution-testing.html#cb291-13" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-263-1.png" width="1008" /></p>
<p><em>WHAT DID WE LEARN FROM THIS</em></p>
<p>what is the expected <em>Mean Error (ME)</em> of the final 6 recommended settings by CHM resolution?</p>
<div class="sourceCode" id="cb292"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb292-1"><a href="chm-raster-resolution-testing.html#cb292-1" tabindex="-1"></a><span class="co"># plot it</span></span>
<span id="cb292-2"><a href="chm-raster-resolution-testing.html#cb292-2" tabindex="-1"></a><span class="fu">plt_form_quantification_dist2</span>(</span>
<span id="cb292-3"><a href="chm-raster-resolution-testing.html#cb292-3" tabindex="-1"></a>  <span class="at">df =</span> param_combos_spectral_ranked <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(is_final_selection_chm) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">!</span>tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;_pct_rank_&quot;</span>))</span>
<span id="cb292-4"><a href="chm-raster-resolution-testing.html#cb292-4" tabindex="-1"></a>  , <span class="at">quant_metric =</span> <span class="st">&quot;mean&quot;</span></span>
<span id="cb292-5"><a href="chm-raster-resolution-testing.html#cb292-5" tabindex="-1"></a>  , <span class="fu">paste0</span>(</span>
<span id="cb292-6"><a href="chm-raster-resolution-testing.html#cb292-6" tabindex="-1"></a>    <span class="st">&quot;Data Fusion&quot;</span></span>
<span id="cb292-7"><a href="chm-raster-resolution-testing.html#cb292-7" tabindex="-1"></a>    , <span class="st">&quot;</span><span class="sc">\n</span><span class="st">distribution of pile form quantification metrics for the final recommended parameter settings&quot;</span></span>
<span id="cb292-8"><a href="chm-raster-resolution-testing.html#cb292-8" tabindex="-1"></a>    , <span class="st">&quot; (n=&quot;</span></span>
<span id="cb292-9"><a href="chm-raster-resolution-testing.html#cb292-9" tabindex="-1"></a>    , scales<span class="sc">::</span><span class="fu">comma</span>(n_th_top_chm,<span class="at">accuracy=</span><span class="dv">1</span>)</span>
<span id="cb292-10"><a href="chm-raster-resolution-testing.html#cb292-10" tabindex="-1"></a>    , <span class="st">&quot;) by CHM resolution&quot;</span></span>
<span id="cb292-11"><a href="chm-raster-resolution-testing.html#cb292-11" tabindex="-1"></a>    , <span class="st">&quot;</span><span class="sc">\n</span><span class="st">based on both detection and quantification accuracy&quot;</span></span>
<span id="cb292-12"><a href="chm-raster-resolution-testing.html#cb292-12" tabindex="-1"></a>  )</span>
<span id="cb292-13"><a href="chm-raster-resolution-testing.html#cb292-13" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-264-1.png" width="1008" /></p>
<p><em>WHAT DID WE LEARN FROM THIS</em></p>
<p>what is the expected <em>RMSE</em> of the final 6 recommended settings by CHM resolution?</p>
<div class="sourceCode" id="cb293"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb293-1"><a href="chm-raster-resolution-testing.html#cb293-1" tabindex="-1"></a><span class="co"># plot it</span></span>
<span id="cb293-2"><a href="chm-raster-resolution-testing.html#cb293-2" tabindex="-1"></a><span class="fu">plt_form_quantification_dist2</span>(</span>
<span id="cb293-3"><a href="chm-raster-resolution-testing.html#cb293-3" tabindex="-1"></a>  <span class="at">df =</span> param_combos_spectral_ranked <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(is_final_selection_chm) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">!</span>tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;_pct_rank_&quot;</span>))</span>
<span id="cb293-4"><a href="chm-raster-resolution-testing.html#cb293-4" tabindex="-1"></a>  , <span class="at">quant_metric =</span> <span class="st">&quot;rmse&quot;</span></span>
<span id="cb293-5"><a href="chm-raster-resolution-testing.html#cb293-5" tabindex="-1"></a>  , <span class="fu">paste0</span>(</span>
<span id="cb293-6"><a href="chm-raster-resolution-testing.html#cb293-6" tabindex="-1"></a>    <span class="st">&quot;Data Fusion&quot;</span></span>
<span id="cb293-7"><a href="chm-raster-resolution-testing.html#cb293-7" tabindex="-1"></a>    , <span class="st">&quot;</span><span class="sc">\n</span><span class="st">distribution of pile form quantification metrics for the final recommended parameter settings&quot;</span></span>
<span id="cb293-8"><a href="chm-raster-resolution-testing.html#cb293-8" tabindex="-1"></a>    , <span class="st">&quot; (n=&quot;</span></span>
<span id="cb293-9"><a href="chm-raster-resolution-testing.html#cb293-9" tabindex="-1"></a>    , scales<span class="sc">::</span><span class="fu">comma</span>(n_th_top_chm,<span class="at">accuracy=</span><span class="dv">1</span>)</span>
<span id="cb293-10"><a href="chm-raster-resolution-testing.html#cb293-10" tabindex="-1"></a>    , <span class="st">&quot;) by CHM resolution&quot;</span></span>
<span id="cb293-11"><a href="chm-raster-resolution-testing.html#cb293-11" tabindex="-1"></a>    , <span class="st">&quot;</span><span class="sc">\n</span><span class="st">based on both detection and quantification accuracy&quot;</span></span>
<span id="cb293-12"><a href="chm-raster-resolution-testing.html#cb293-12" tabindex="-1"></a>  )</span>
<span id="cb293-13"><a href="chm-raster-resolution-testing.html#cb293-13" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-265-1.png" width="1008" /></p>
<p><em>WHAT DID WE LEARN FROM THIS</em></p>
</div>
</div>
</div>
</div>
<div id="save-the-data" class="section level2 hasAnchor" number="8.7">
<h2><span class="header-section-number">8.7</span> save the data<a href="chm-raster-resolution-testing.html#save-the-data" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>let’s save the data for potential future use</p>
<div class="sourceCode" id="cb294"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb294-1"><a href="chm-raster-resolution-testing.html#cb294-1" tabindex="-1"></a>param_combos_ranked <span class="sc">%&gt;%</span> readr<span class="sc">::</span><span class="fu">write_csv</span>(<span class="fu">file.path</span>(<span class="st">&quot;../data&quot;</span>, <span class="st">&quot;param_combos_ranked.csv&quot;</span>), <span class="at">append =</span> F, <span class="at">progress =</span> F)</span>
<span id="cb294-2"><a href="chm-raster-resolution-testing.html#cb294-2" tabindex="-1"></a>param_combos_spectral_ranked <span class="sc">%&gt;%</span> readr<span class="sc">::</span><span class="fu">write_csv</span>(<span class="fu">file.path</span>(<span class="st">&quot;../data&quot;</span>, <span class="st">&quot;param_combos_spectral_ranked.csv&quot;</span>), <span class="at">append =</span> F, <span class="at">progress =</span> F)</span></code></pre></div>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="wshed_params_test.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="stats_method.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
  "sharing": {
    "github": false,
    "facebook": true,
    "twitter": true,
    "linkedin": false,
    "weibo": false,
    "instapaper": false,
    "vk": false,
    "whatsapp": false,
    "all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
  },
  "fontsettings": {
    "theme": "white",
    "family": "sans",
    "size": 2
  },
  "edit": {
    "link": null,
    "text": null
  },
  "history": {
    "link": null,
    "text": null
  },
  "view": {
    "link": null,
    "text": null
  },
  "download": null,
  "search": {
    "engine": "fuse",
    "options": null
  },
  "toc": {
    "collapse": "subsection"
  }
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
