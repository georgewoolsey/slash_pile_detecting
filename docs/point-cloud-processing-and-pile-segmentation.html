<!DOCTYPE html>
<html lang="en-US" xml:lang="en-US">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Section 4 Point Cloud Processing and Pile Segmentation | Aerial Imagery and Point Cloud Data for Slash Pile Quantification</title>
  <meta name="description" content="Using the bookdown package to write a book of data exploration. The output format for this example is bookdown::gitbook." />
  <meta name="generator" content="bookdown 0.34 and GitBook 2.6.7" />

  <meta property="og:title" content="Section 4 Point Cloud Processing and Pile Segmentation | Aerial Imagery and Point Cloud Data for Slash Pile Quantification" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="Using the bookdown package to write a book of data exploration. The output format for this example is bookdown::gitbook." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Section 4 Point Cloud Processing and Pile Segmentation | Aerial Imagery and Point Cloud Data for Slash Pile Quantification" />
  
  <meta name="twitter:description" content="Using the bookdown package to write a book of data exploration. The output format for this example is bookdown::gitbook." />
  

<meta name="author" content="George Woolsey" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="rgb-classification.html"/>
<link rel="next" href="raster_watershed.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<link href="libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet" />
<script src="libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/proj4-2.6.2/proj4.min.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.2.2/leaflet.js"></script>
<script src="libs/leaflet-providers-2.0.0/leaflet-providers_2.0.0.js"></script>
<script src="libs/leaflet-providers-plugin-2.2.2/leaflet-providers-plugin.js"></script>
<script src="libs/clipboard-0.0.1/setClipboardText.js"></script>
<link href="libs/mapviewCSS-0.0.1/mapview-popup.css" rel="stylesheet" />
<link href="libs/mapviewCSS-0.0.1/mapview.css" rel="stylesheet" />
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<link href="libs/bsTable-3.3.7/bootstrapTable.min.css" rel="stylesheet" />
<script src="libs/bsTable-3.3.7/bootstrapTable.js"></script>
<script type="text/javascript">

// toggle visibility of R source blocks in R Markdown output
function toggle_R() {
  var x = document.getElementsByClassName('r');
  if (x.length == 0) return;
  function toggle_vis(o) {
    var d = o.style.display;
    o.style.display = (d == 'block' || d == '') ? 'none':'block';
  }

  for (i = 0; i < x.length; i++) {
    var y = x[i];
    if (y.tagName.toLowerCase() === 'pre') toggle_vis(y);
  }

    var elem = document.getElementById("myButton1");
    if (elem.value === "Hide Code") elem.value = "Show Code";
    else elem.value = "Hide Code";
}

document.write('<input onclick="toggle_R();" type="button" value="Hide Code" id="myButton1" style="position: absolute; top: 10%; right: 2%; z-index: 200"></input>')

</script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#objective"><i class="fa fa-check"></i><b>1.1</b> Objective</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#data_desc"><i class="fa fa-check"></i><b>1.2</b> Data</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="data-processing.html"><a href="data-processing.html"><i class="fa fa-check"></i><b>2</b> Data Processing</a>
<ul>
<li class="chapter" data-level="2.1" data-path="data-processing.html"><a href="data-processing.html#slash-pile-vector-data"><i class="fa fa-check"></i><b>2.1</b> Slash Pile Vector Data</a></li>
<li class="chapter" data-level="2.2" data-path="data-processing.html"><a href="data-processing.html#load-rgb-orthomosaic-rasters"><i class="fa fa-check"></i><b>2.2</b> Load RGB orthomosaic rasters</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="data-processing.html"><a href="data-processing.html#example-ratio-based-index"><i class="fa fa-check"></i><b>2.2.1</b> Example ratio-based index</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="data-processing.html"><a href="data-processing.html#study-area-imagery"><i class="fa fa-check"></i><b>2.3</b> Study area imagery</a></li>
<li class="chapter" data-level="2.4" data-path="data-processing.html"><a href="data-processing.html#point-cloud-data"><i class="fa fa-check"></i><b>2.4</b> Point Cloud Data</a></li>
<li class="chapter" data-level="2.5" data-path="data-processing.html"><a href="data-processing.html#check-out-one-pile"><i class="fa fa-check"></i><b>2.5</b> Check out one pile</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="rgb-classification.html"><a href="rgb-classification.html"><i class="fa fa-check"></i><b>3</b> RGB Classification</a>
<ul>
<li class="chapter" data-level="3.1" data-path="rgb-classification.html"><a href="rgb-classification.html#textural-covariates"><i class="fa fa-check"></i><b>3.1</b> Textural covariates</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="rgb-classification.html"><a href="rgb-classification.html#raster-texture-panchromatic"><i class="fa fa-check"></i><b>3.1.1</b> Raster Texture: Panchromatic</a></li>
<li class="chapter" data-level="3.1.2" data-path="rgb-classification.html"><a href="rgb-classification.html#raster-texture-grvi"><i class="fa fa-check"></i><b>3.1.2</b> Raster Texture: GRVI</a></li>
<li class="chapter" data-level="3.1.3" data-path="rgb-classification.html"><a href="rgb-classification.html#plot-textural-rasters"><i class="fa fa-check"></i><b>3.1.3</b> Plot textural rasters</a></li>
<li class="chapter" data-level="3.1.4" data-path="rgb-classification.html"><a href="rgb-classification.html#features-for-classification"><i class="fa fa-check"></i><b>3.1.4</b> Features for classification</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="rgb-classification.html"><a href="rgb-classification.html#pixel-based-unsupervised-classification"><i class="fa fa-check"></i><b>3.2</b> Pixel-based: unsupervised classification</a></li>
<li class="chapter" data-level="3.3" data-path="rgb-classification.html"><a href="rgb-classification.html#pixel_class"><i class="fa fa-check"></i><b>3.3</b> Pixel-based: supervised classification</a></li>
<li class="chapter" data-level="3.4" data-path="rgb-classification.html"><a href="rgb-classification.html#obia"><i class="fa fa-check"></i><b>3.4</b> Object-based image analysis (OBIA)</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="rgb-classification.html"><a href="rgb-classification.html#training-data"><i class="fa fa-check"></i><b>3.4.1</b> Training data</a></li>
<li class="chapter" data-level="3.4.2" data-path="rgb-classification.html"><a href="rgb-classification.html#slic"><i class="fa fa-check"></i><b>3.4.2</b> <code>OpenImageR</code> package SLIC image segmentation</a></li>
<li class="chapter" data-level="3.4.3" data-path="rgb-classification.html"><a href="rgb-classification.html#superpixelimagesegmentation-package-slicap-clustering"><i class="fa fa-check"></i><b>3.4.3</b> <code>SuperpixelImageSegmentation</code> package SLICAP clustering</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="point-cloud-processing-and-pile-segmentation.html"><a href="point-cloud-processing-and-pile-segmentation.html"><i class="fa fa-check"></i><b>4</b> Point Cloud Processing and Pile Segmentation</a>
<ul>
<li class="chapter" data-level="4.1" data-path="point-cloud-processing-and-pile-segmentation.html"><a href="point-cloud-processing-and-pile-segmentation.html#process-raw-point-cloud"><i class="fa fa-check"></i><b>4.1</b> Process Raw Point Cloud</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="point-cloud-processing-and-pile-segmentation.html"><a href="point-cloud-processing-and-pile-segmentation.html#dtm-and-chm-piles"><i class="fa fa-check"></i><b>4.1.1</b> DTM and CHM + piles</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="raster_watershed.html"><a href="raster_watershed.html"><i class="fa fa-check"></i><b>5</b> Raster-based: Watershed Segmentation</a>
<ul>
<li class="chapter" data-level="5.1" data-path="raster_watershed.html"><a href="raster_watershed.html#method-demonstration"><i class="fa fa-check"></i><b>5.1</b> Method Demonstration</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="raster_watershed.html"><a href="raster_watershed.html#geometric-filtering-irregularity-filtering"><i class="fa fa-check"></i><b>5.1.1</b> Geometric filtering: Irregularity Filtering</a></li>
<li class="chapter" data-level="5.1.2" data-path="raster_watershed.html"><a href="raster_watershed.html#area-filtering"><i class="fa fa-check"></i><b>5.1.2</b> Area Filtering</a></li>
<li class="chapter" data-level="5.1.3" data-path="raster_watershed.html"><a href="raster_watershed.html#geometric-filtering-circularity-filtering"><i class="fa fa-check"></i><b>5.1.3</b> Geometric filtering: Circularity Filtering</a></li>
<li class="chapter" data-level="5.1.4" data-path="raster_watershed.html"><a href="raster_watershed.html#smoothing"><i class="fa fa-check"></i><b>5.1.4</b> Smoothing</a></li>
<li class="chapter" data-level="5.1.5" data-path="raster_watershed.html"><a href="raster_watershed.html#shape-refinement"><i class="fa fa-check"></i><b>5.1.5</b> Shape Refinement</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="raster_watershed.html"><a href="raster_watershed.html#confusion-matrix-evaluation"><i class="fa fa-check"></i><b>5.2</b> Confusion matrix evaluation</a></li>
<li class="chapter" data-level="5.3" data-path="raster_watershed.html"><a href="raster_watershed.html#pile-area-rmse"><i class="fa fa-check"></i><b>5.3</b> Pile area RMSE</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="watershed-segmentation-sensitivity-testing.html"><a href="watershed-segmentation-sensitivity-testing.html"><i class="fa fa-check"></i><b>6</b> Watershed Segmentation: Sensitivity Testing</a>
<ul>
<li class="chapter" data-level="6.1" data-path="watershed-segmentation-sensitivity-testing.html"><a href="watershed-segmentation-sensitivity-testing.html#slash_pile_detect_watershed"><i class="fa fa-check"></i><b>6.1</b> Watershed Pile Detection Function</a></li>
<li class="chapter" data-level="6.2" data-path="watershed-segmentation-sensitivity-testing.html"><a href="watershed-segmentation-sensitivity-testing.html#wshed_params_test"><i class="fa fa-check"></i><b>6.2</b> Parameter sensitivity testing</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="watershed-segmentation-sensitivity-testing.html"><a href="watershed-segmentation-sensitivity-testing.html#workflow-over-parameter-combinations"><i class="fa fa-check"></i><b>6.2.1</b> Workflow over parameter combinations</a></li>
<li class="chapter" data-level="6.2.2" data-path="watershed-segmentation-sensitivity-testing.html"><a href="watershed-segmentation-sensitivity-testing.html#validation-over-parameter-combinations"><i class="fa fa-check"></i><b>6.2.2</b> Validation over parameter combinations</a></li>
<li class="chapter" data-level="6.2.3" data-path="watershed-segmentation-sensitivity-testing.html"><a href="watershed-segmentation-sensitivity-testing.html#aggregate-assessment-metrics"><i class="fa fa-check"></i><b>6.2.3</b> Aggregate assessment metrics</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="watershed-segmentation-sensitivity-testing.html"><a href="watershed-segmentation-sensitivity-testing.html#parameter-sensitivity-test-results"><i class="fa fa-check"></i><b>6.3</b> Parameter Sensitivity Test Results</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="watershed-segmentation-sensitivity-testing.html"><a href="watershed-segmentation-sensitivity-testing.html#overall-pile-detection"><i class="fa fa-check"></i><b>6.3.1</b> Overall: pile detection</a></li>
<li class="chapter" data-level="6.3.2" data-path="watershed-segmentation-sensitivity-testing.html"><a href="watershed-segmentation-sensitivity-testing.html#overall-form-quantification"><i class="fa fa-check"></i><b>6.3.2</b> Overall: form quantification</a></li>
<li class="chapter" data-level="6.3.3" data-path="watershed-segmentation-sensitivity-testing.html"><a href="watershed-segmentation-sensitivity-testing.html#main-effects-pile-detection"><i class="fa fa-check"></i><b>6.3.3</b> Main Effects: pile detection</a></li>
<li class="chapter" data-level="6.3.4" data-path="watershed-segmentation-sensitivity-testing.html"><a href="watershed-segmentation-sensitivity-testing.html#main-effects-form-quantification"><i class="fa fa-check"></i><b>6.3.4</b> Main Effects: form quantification</a></li>
<li class="chapter" data-level="6.3.5" data-path="watershed-segmentation-sensitivity-testing.html"><a href="watershed-segmentation-sensitivity-testing.html#best-results-detection-accuracy"><i class="fa fa-check"></i><b>6.3.5</b> Best results: detection accuracy</a></li>
<li class="chapter" data-level="6.3.6" data-path="watershed-segmentation-sensitivity-testing.html"><a href="watershed-segmentation-sensitivity-testing.html#best-results-quantification-accuracy"><i class="fa fa-check"></i><b>6.3.6</b> Best results: quantification accuracy</a></li>
<li class="chapter" data-level="6.3.7" data-path="watershed-segmentation-sensitivity-testing.html"><a href="watershed-segmentation-sensitivity-testing.html#wshed_best_best"><i class="fa fa-check"></i><b>6.3.7</b> Best results: detection &amp; quantification</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="watershed-segmentation-sensitivity-testing.html"><a href="watershed-segmentation-sensitivity-testing.html#final-recommended-settings"><i class="fa fa-check"></i><b>6.4</b> Final recommended settings</a></li>
<li class="chapter" data-level="6.5" data-path="watershed-segmentation-sensitivity-testing.html"><a href="watershed-segmentation-sensitivity-testing.html#appendix-parameter-combination-drill-downs"><i class="fa fa-check"></i><b>6.5</b> Appendix: Parameter combination drill-downs</a>
<ul>
<li class="chapter" data-level="6.5.1" data-path="watershed-segmentation-sensitivity-testing.html"><a href="watershed-segmentation-sensitivity-testing.html#f-score"><i class="fa fa-check"></i><b>6.5.1</b> F-score</a></li>
<li class="chapter" data-level="6.5.2" data-path="watershed-segmentation-sensitivity-testing.html"><a href="watershed-segmentation-sensitivity-testing.html#recall"><i class="fa fa-check"></i><b>6.5.2</b> Recall</a></li>
<li class="chapter" data-level="6.5.3" data-path="watershed-segmentation-sensitivity-testing.html"><a href="watershed-segmentation-sensitivity-testing.html#precision"><i class="fa fa-check"></i><b>6.5.3</b> Precision</a></li>
<li class="chapter" data-level="6.5.4" data-path="watershed-segmentation-sensitivity-testing.html"><a href="watershed-segmentation-sensitivity-testing.html#mape-volume-irregular"><i class="fa fa-check"></i><b>6.5.4</b> MAPE Volume irregular</a></li>
<li class="chapter" data-level="6.5.5" data-path="watershed-segmentation-sensitivity-testing.html"><a href="watershed-segmentation-sensitivity-testing.html#mape-volume-paraboloid"><i class="fa fa-check"></i><b>6.5.5</b> MAPE Volume paraboloid</a></li>
<li class="chapter" data-level="6.5.6" data-path="watershed-segmentation-sensitivity-testing.html"><a href="watershed-segmentation-sensitivity-testing.html#mape-area"><i class="fa fa-check"></i><b>6.5.6</b> MAPE Area</a></li>
<li class="chapter" data-level="6.5.7" data-path="watershed-segmentation-sensitivity-testing.html"><a href="watershed-segmentation-sensitivity-testing.html#mape-height"><i class="fa fa-check"></i><b>6.5.7</b> MAPE Height</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="data_fusion.html"><a href="data_fusion.html"><i class="fa fa-check"></i><b>7</b> Data Fusion</a>
<ul>
<li class="chapter" data-level="7.1" data-path="data_fusion.html"><a href="data_fusion.html#rgb-indices"><i class="fa fa-check"></i><b>7.1</b> RGB Indices</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="data_fusion.html"><a href="data_fusion.html#spectral-index-functions"><i class="fa fa-check"></i><b>7.1.1</b> Spectral Index Functions</a></li>
<li class="chapter" data-level="7.1.2" data-path="data_fusion.html"><a href="data_fusion.html#spectral-index-of-polygons"><i class="fa fa-check"></i><b>7.1.2</b> Spectral Index of Polygons</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="data_fusion.html"><a href="data_fusion.html#ground-truth-pile-spectral-summary"><i class="fa fa-check"></i><b>7.2</b> Ground Truth Pile Spectral Summary</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="data_fusion.html"><a href="data_fusion.html#voting-system"><i class="fa fa-check"></i><b>7.2.1</b> Voting System</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="data_fusion.html"><a href="data_fusion.html#candidate-polygon-spectral-filtering-function"><i class="fa fa-check"></i><b>7.3</b> Candidate Polygon Spectral Filtering Function</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="fusion_params_test.html"><a href="fusion_params_test.html"><i class="fa fa-check"></i><b>8</b> Data Fusion: Sensitivity Testing</a>
<ul>
<li class="chapter" data-level="8.1" data-path="fusion_params_test.html"><a href="fusion_params_test.html#example-comparison-by-spectral-weighting"><i class="fa fa-check"></i><b>8.1</b> Example comparison by spectral weighting</a></li>
<li class="chapter" data-level="8.2" data-path="fusion_params_test.html"><a href="fusion_params_test.html#aggregate-assessment-metrics-1"><i class="fa fa-check"></i><b>8.2</b> Aggregate assessment metrics</a></li>
<li class="chapter" data-level="8.3" data-path="fusion_params_test.html"><a href="fusion_params_test.html#parameter-sensitivity-test-results-1"><i class="fa fa-check"></i><b>8.3</b> Parameter Sensitivity Test Results</a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="fusion_params_test.html"><a href="fusion_params_test.html#main-effect-of-spectral-data-pile-detection"><i class="fa fa-check"></i><b>8.3.1</b> Main effect of spectral data: pile detection</a></li>
<li class="chapter" data-level="8.3.2" data-path="fusion_params_test.html"><a href="fusion_params_test.html#main-effect-of-spectral-data-form-quantification"><i class="fa fa-check"></i><b>8.3.2</b> Main effect of spectral data: form quantification</a></li>
<li class="chapter" data-level="8.3.3" data-path="fusion_params_test.html"><a href="fusion_params_test.html#overall-pile-detection-1"><i class="fa fa-check"></i><b>8.3.3</b> Overall: pile detection</a></li>
<li class="chapter" data-level="8.3.4" data-path="fusion_params_test.html"><a href="fusion_params_test.html#overall-form-quantification-1"><i class="fa fa-check"></i><b>8.3.4</b> Overall: form quantification</a></li>
<li class="chapter" data-level="8.3.5" data-path="fusion_params_test.html"><a href="fusion_params_test.html#best-results-detection-accuracy-1"><i class="fa fa-check"></i><b>8.3.5</b> Best results: detection accuracy</a></li>
<li class="chapter" data-level="8.3.6" data-path="fusion_params_test.html"><a href="fusion_params_test.html#best-results-quantification-accuracy-1"><i class="fa fa-check"></i><b>8.3.6</b> Best results: quantification accuracy</a></li>
<li class="chapter" data-level="8.3.7" data-path="fusion_params_test.html"><a href="fusion_params_test.html#best-results-detection-quantification"><i class="fa fa-check"></i><b>8.3.7</b> Best results: detection &amp; quantification</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="fusion_params_test.html"><a href="fusion_params_test.html#final-recommended-settings-1"><i class="fa fa-check"></i><b>8.4</b> Final recommended settings</a></li>
<li class="chapter" data-level="8.5" data-path="fusion_params_test.html"><a href="fusion_params_test.html#final-recommended-settings-data-fusion-versus-structural-only"><i class="fa fa-check"></i><b>8.5</b> Final recommended settings: data fusion versus structural only</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Aerial Imagery and Point Cloud Data for Slash Pile Quantification</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="point-cloud-processing-and-pile-segmentation" class="section level1 hasAnchor" number="4">
<h1><span class="header-section-number">Section 4</span> Point Cloud Processing and Pile Segmentation<a href="point-cloud-processing-and-pile-segmentation.html#point-cloud-processing-and-pile-segmentation" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>We’ll use the point cloud data alone (to begin with) to attempt to classify slash piles without additional spectral information.</p>
<p>We’ll use the <code>cloud2trees</code> package to perform all preprocessing of point cloud data which includes:</p>
<ul>
<li>ground classification and noise removal</li>
<li>raster data (DTM and CHM) generation</li>
<li>point cloud height normalization</li>
</ul>
<p>All of this can be accomplished using the <code>cloud2raster()</code> function. After generating these products from the raw point cloud we’ll perform object segmentation to attempt to detect round, conical objects like slash piles from: 1) the normalized point cloud directly; 2) the CHM which we’ll generate by setting the minimum height to zero (essentially a digital surface model [DSM] with the ground removed).</p>
<p>To attempt to identify slash piles from the CHM/DSM, we can use watershed segmentation (potentially without “seed” points) in a bottom-up approach. Insert something from paper about bottom-up approach that uses a CHM “slice” near the ground. For slash piles, which are often irregular and may not have a distinct “treetop” equivalent, CHM-based methods might be less directly applicable unless the piles present a very clear, isolated conical or rounded form. Could use expected morphology of the slash piles (e.g. maximum height) based on prior research.</p>
<p>To attempt to detect slash piles directly from the point cloud we can use a clustering algorithm such as DBSCAN (Density-Based Spatial Clustering of Applications with Noise) which identifies clusters based on point density, making it effective for detecting clusters of arbitrary shapes and sizes. It does not require the number of clusters to be specified beforehand. <a href="https://doi.org/10.3390/f13040566">Fu et al. (2022)</a> outline a method using DBSCAN in semi-automated way to segment individual trees from TLS data. After segmenting the point cloud using DBSCAN, either random forest can be used as a classifier (i.e. classification step) or a rules-based method can filter segments to distinguish slash piles from other objects based on their extracted geometric features. The general workflow is:</p>
<ol style="list-style-type: decimal">
<li>for each point in the normalized non-ground point cloud, compute a suite of relevant geometric features within a defined local neighborhood radius using <code>lidR::point_metrics()</code></li>
<li>calculate features derived from PCA, such as linearity, planarity, sphericity, and surface variation. Also, compute curvature (mean, Gaussian) and roughness</li>
<li>perform object segmentation/clustering to group points belonging to individual objects using DBSCAN which can identify dense clusters without requiring a predefined number of objects
4a) classify the segmented objects (clusters) as “slash pile” or “non-slash pile” based on their extracted features (e.g., sphericity, roughness, height, volume) with a random forest classifier using a manually annotated subset of segmented objects
4b) <em>or</em> used a rules-based approach to filter the segmented objects based on their extracted features (e.g., sphericity, roughness, height, volume) based on expected morphology of the slash piles (e.g. maximum height) using prior research or prescription settings.</li>
<li>merge small, adjacent segments that likely belong to a single slash pile based on proximity and connectivity</li>
<li>perform a confusion matrix-based evaluation on the results</li>
</ol>
<ul>
<li><a href="raster_watershed.html#raster_watershed"><strong>Section 5</strong></a> builds and tests a raster-based watershed segmentation methodology</li>
<li><a href="data_fusion.html#data_fusion"><strong>Section 7</strong></a> combines the raster-based watershed segmentation methodology with spectral information in a data fusion approach</li>
</ul>
<div id="process-raw-point-cloud" class="section level2 hasAnchor" number="4.1">
<h2><span class="header-section-number">4.1</span> Process Raw Point Cloud<a href="point-cloud-processing-and-pile-segmentation.html#process-raw-point-cloud" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We’ll use <code>cloud2trees::cloud2raster()</code> to process the raw point cloud data</p>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb140-1"><a href="point-cloud-processing-and-pile-segmentation.html#cb140-1" tabindex="-1"></a><span class="co"># set chm res</span></span>
<span id="cb140-2"><a href="point-cloud-processing-and-pile-segmentation.html#cb140-2" tabindex="-1"></a>chm_res_m_temp <span class="ot">&lt;-</span> <span class="fl">0.15</span></span>
<span id="cb140-3"><a href="point-cloud-processing-and-pile-segmentation.html#cb140-3" tabindex="-1"></a>dir_temp <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&quot;../data/point_cloud_processing_delivery_chm&quot;</span>,chm_res_m_temp,<span class="st">&quot;m&quot;</span>)</span>
<span id="cb140-4"><a href="point-cloud-processing-and-pile-segmentation.html#cb140-4" tabindex="-1"></a><span class="co"># do it</span></span>
<span id="cb140-5"><a href="point-cloud-processing-and-pile-segmentation.html#cb140-5" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">dir.exists</span>(dir_temp)){</span>
<span id="cb140-6"><a href="point-cloud-processing-and-pile-segmentation.html#cb140-6" tabindex="-1"></a>  <span class="co"># cloud2trees</span></span>
<span id="cb140-7"><a href="point-cloud-processing-and-pile-segmentation.html#cb140-7" tabindex="-1"></a>  cloud2raster_ans <span class="ot">&lt;-</span> cloud2trees<span class="sc">::</span><span class="fu">cloud2raster</span>(</span>
<span id="cb140-8"><a href="point-cloud-processing-and-pile-segmentation.html#cb140-8" tabindex="-1"></a>    <span class="at">output_dir =</span> <span class="st">&quot;../data&quot;</span></span>
<span id="cb140-9"><a href="point-cloud-processing-and-pile-segmentation.html#cb140-9" tabindex="-1"></a>    , <span class="at">input_las_dir =</span> <span class="st">&quot;f:</span><span class="sc">\\</span><span class="st">PFDP_Data</span><span class="sc">\\</span><span class="st">p4pro_images</span><span class="sc">\\</span><span class="st">P4Pro_06_17_2021_half_half_optimal</span><span class="sc">\\</span><span class="st">2_densification</span><span class="sc">\\</span><span class="st">point_cloud&quot;</span></span>
<span id="cb140-10"><a href="point-cloud-processing-and-pile-segmentation.html#cb140-10" tabindex="-1"></a>    , <span class="at">accuracy_level =</span> <span class="dv">2</span></span>
<span id="cb140-11"><a href="point-cloud-processing-and-pile-segmentation.html#cb140-11" tabindex="-1"></a>    , <span class="at">keep_intrmdt =</span> T</span>
<span id="cb140-12"><a href="point-cloud-processing-and-pile-segmentation.html#cb140-12" tabindex="-1"></a>    , <span class="at">dtm_res_m =</span> <span class="fl">0.25</span></span>
<span id="cb140-13"><a href="point-cloud-processing-and-pile-segmentation.html#cb140-13" tabindex="-1"></a>    , <span class="at">chm_res_m =</span> chm_res_m_temp</span>
<span id="cb140-14"><a href="point-cloud-processing-and-pile-segmentation.html#cb140-14" tabindex="-1"></a>    , <span class="at">min_height =</span> <span class="dv">0</span> <span class="co"># effectively generates a DSM based on non-ground points</span></span>
<span id="cb140-15"><a href="point-cloud-processing-and-pile-segmentation.html#cb140-15" tabindex="-1"></a>  )</span>
<span id="cb140-16"><a href="point-cloud-processing-and-pile-segmentation.html#cb140-16" tabindex="-1"></a>  <span class="co"># rename</span></span>
<span id="cb140-17"><a href="point-cloud-processing-and-pile-segmentation.html#cb140-17" tabindex="-1"></a>  <span class="fu">file.rename</span>(<span class="at">from =</span> <span class="st">&quot;../data/point_cloud_processing_delivery&quot;</span>, <span class="at">to =</span> dir_temp)</span>
<span id="cb140-18"><a href="point-cloud-processing-and-pile-segmentation.html#cb140-18" tabindex="-1"></a>}<span class="cf">else</span>{</span>
<span id="cb140-19"><a href="point-cloud-processing-and-pile-segmentation.html#cb140-19" tabindex="-1"></a>  dtm_temp <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rast</span>( <span class="fu">file.path</span>(dir_temp, <span class="st">&quot;dtm_0.25m.tif&quot;</span>) )</span>
<span id="cb140-20"><a href="point-cloud-processing-and-pile-segmentation.html#cb140-20" tabindex="-1"></a>  chm_temp <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rast</span>( <span class="fu">file.path</span>(dir_temp, <span class="fu">paste0</span>(<span class="st">&quot;chm_&quot;</span>, chm_res_m_temp,<span class="st">&quot;m.tif&quot;</span>)) )</span>
<span id="cb140-21"><a href="point-cloud-processing-and-pile-segmentation.html#cb140-21" tabindex="-1"></a>  </span>
<span id="cb140-22"><a href="point-cloud-processing-and-pile-segmentation.html#cb140-22" tabindex="-1"></a>  <span class="co"># dtm_temp &lt;- terra::rast(&quot;../data/point_cloud_processing_delivery_chm0.1m/dtm_0.25m.tif&quot;)</span></span>
<span id="cb140-23"><a href="point-cloud-processing-and-pile-segmentation.html#cb140-23" tabindex="-1"></a>  <span class="co"># chm_temp &lt;- terra::rast(&quot;../data/point_cloud_processing_delivery_chm0.1m/chm_0.1m.tif&quot;)</span></span>
<span id="cb140-24"><a href="point-cloud-processing-and-pile-segmentation.html#cb140-24" tabindex="-1"></a>  </span>
<span id="cb140-25"><a href="point-cloud-processing-and-pile-segmentation.html#cb140-25" tabindex="-1"></a>  <span class="co"># dtm_temp &lt;- terra::rast(&quot;../data/point_cloud_processing_delivery_chm0.2m/dtm_0.5m.tif&quot;)</span></span>
<span id="cb140-26"><a href="point-cloud-processing-and-pile-segmentation.html#cb140-26" tabindex="-1"></a>  <span class="co"># chm_temp &lt;- terra::rast(&quot;../data/point_cloud_processing_delivery_chm0.2m/chm_0.2m.tif&quot;)</span></span>
<span id="cb140-27"><a href="point-cloud-processing-and-pile-segmentation.html#cb140-27" tabindex="-1"></a>  </span>
<span id="cb140-28"><a href="point-cloud-processing-and-pile-segmentation.html#cb140-28" tabindex="-1"></a>  cloud2raster_ans <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb140-29"><a href="point-cloud-processing-and-pile-segmentation.html#cb140-29" tabindex="-1"></a>    <span class="st">&quot;dtm_rast&quot;</span> <span class="ot">=</span> dtm_temp</span>
<span id="cb140-30"><a href="point-cloud-processing-and-pile-segmentation.html#cb140-30" tabindex="-1"></a>    , <span class="st">&quot;chm_rast&quot;</span> <span class="ot">=</span> chm_temp</span>
<span id="cb140-31"><a href="point-cloud-processing-and-pile-segmentation.html#cb140-31" tabindex="-1"></a>  )</span>
<span id="cb140-32"><a href="point-cloud-processing-and-pile-segmentation.html#cb140-32" tabindex="-1"></a>}</span></code></pre></div>
<p>let’s check out the DTM</p>
<div class="sourceCode" id="cb141"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb141-1"><a href="point-cloud-processing-and-pile-segmentation.html#cb141-1" tabindex="-1"></a>cloud2raster_ans<span class="sc">$</span>dtm_rast <span class="sc">%&gt;%</span> </span>
<span id="cb141-2"><a href="point-cloud-processing-and-pile-segmentation.html#cb141-2" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">aggregate</span>(<span class="at">fact =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span>  <span class="co">#, fun = &quot;median&quot;, cores = lasR::half_cores(), na.rm = T) %&gt;% </span></span>
<span id="cb141-3"><a href="point-cloud-processing-and-pile-segmentation.html#cb141-3" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">plot</span>(<span class="at">axes =</span> F)</span></code></pre></div>
<pre><code>## |---------|---------|---------|---------|=========================================                                          </code></pre>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-121-1.png" width="1008" /></p>
<p>and CHM</p>
<div class="sourceCode" id="cb143"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb143-1"><a href="point-cloud-processing-and-pile-segmentation.html#cb143-1" tabindex="-1"></a>cloud2raster_ans<span class="sc">$</span>chm_rast <span class="sc">%&gt;%</span> </span>
<span id="cb143-2"><a href="point-cloud-processing-and-pile-segmentation.html#cb143-2" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">aggregate</span>(<span class="at">fact =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span>  <span class="co">#, fun = &quot;median&quot;, cores = lasR::half_cores(), na.rm = T) %&gt;% </span></span>
<span id="cb143-3"><a href="point-cloud-processing-and-pile-segmentation.html#cb143-3" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">plot</span>(<span class="at">col =</span> viridis<span class="sc">::</span><span class="fu">plasma</span>(<span class="dv">100</span>), <span class="at">axes =</span> F)</span></code></pre></div>
<pre><code>## |---------|---------|---------|---------|=========================================                                          </code></pre>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-123-1.png" width="1008" /></p>
<div id="dtm-and-chm-piles" class="section level3 hasAnchor" number="4.1.1">
<h3><span class="header-section-number">4.1.1</span> DTM and CHM + piles<a href="point-cloud-processing-and-pile-segmentation.html#dtm-and-chm-piles" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>let’s visually inspect the DTM and CHM with the pile outlines overlaid</p>
<div class="sourceCode" id="cb145"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb145-1"><a href="point-cloud-processing-and-pile-segmentation.html#cb145-1" tabindex="-1"></a>p_fn_temp <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb145-2"><a href="point-cloud-processing-and-pile-segmentation.html#cb145-2" tabindex="-1"></a>    rn</span>
<span id="cb145-3"><a href="point-cloud-processing-and-pile-segmentation.html#cb145-3" tabindex="-1"></a>    , <span class="at">df =</span> slash_piles_polys</span>
<span id="cb145-4"><a href="point-cloud-processing-and-pile-segmentation.html#cb145-4" tabindex="-1"></a>    , <span class="at">rast =</span> cloud2raster_ans<span class="sc">$</span>dtm_rast</span>
<span id="cb145-5"><a href="point-cloud-processing-and-pile-segmentation.html#cb145-5" tabindex="-1"></a>    , <span class="at">crs =</span> terra<span class="sc">::</span><span class="fu">crs</span>(cloud2raster_ans<span class="sc">$</span>dtm_rast)</span>
<span id="cb145-6"><a href="point-cloud-processing-and-pile-segmentation.html#cb145-6" tabindex="-1"></a>    , <span class="at">my_title =</span> <span class="st">&quot;&quot;</span></span>
<span id="cb145-7"><a href="point-cloud-processing-and-pile-segmentation.html#cb145-7" tabindex="-1"></a>    , <span class="at">vopt =</span> <span class="st">&quot;viridis&quot;</span></span>
<span id="cb145-8"><a href="point-cloud-processing-and-pile-segmentation.html#cb145-8" tabindex="-1"></a>    , <span class="at">lim =</span> <span class="cn">NULL</span></span>
<span id="cb145-9"><a href="point-cloud-processing-and-pile-segmentation.html#cb145-9" tabindex="-1"></a>) {</span>
<span id="cb145-10"><a href="point-cloud-processing-and-pile-segmentation.html#cb145-10" tabindex="-1"></a>  <span class="co"># scale the buffer based on the largest</span></span>
<span id="cb145-11"><a href="point-cloud-processing-and-pile-segmentation.html#cb145-11" tabindex="-1"></a>    d_temp <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb145-12"><a href="point-cloud-processing-and-pile-segmentation.html#cb145-12" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">arrange</span>(<span class="fu">tolower</span>(comment), <span class="fu">desc</span>(diameter)) <span class="sc">%&gt;%</span> </span>
<span id="cb145-13"><a href="point-cloud-processing-and-pile-segmentation.html#cb145-13" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">slice</span>(rn) <span class="sc">%&gt;%</span> </span>
<span id="cb145-14"><a href="point-cloud-processing-and-pile-segmentation.html#cb145-14" tabindex="-1"></a>      sf<span class="sc">::</span><span class="fu">st_transform</span>(crs)</span>
<span id="cb145-15"><a href="point-cloud-processing-and-pile-segmentation.html#cb145-15" tabindex="-1"></a>    </span>
<span id="cb145-16"><a href="point-cloud-processing-and-pile-segmentation.html#cb145-16" tabindex="-1"></a>    <span class="co"># plt classifier</span></span>
<span id="cb145-17"><a href="point-cloud-processing-and-pile-segmentation.html#cb145-17" tabindex="-1"></a>    <span class="co"># convert to stars</span></span>
<span id="cb145-18"><a href="point-cloud-processing-and-pile-segmentation.html#cb145-18" tabindex="-1"></a>    comp_st <span class="ot">&lt;-</span> rast <span class="sc">%&gt;%</span>  </span>
<span id="cb145-19"><a href="point-cloud-processing-and-pile-segmentation.html#cb145-19" tabindex="-1"></a>      terra<span class="sc">::</span><span class="fu">crop</span>(</span>
<span id="cb145-20"><a href="point-cloud-processing-and-pile-segmentation.html#cb145-20" tabindex="-1"></a>        d_temp <span class="sc">%&gt;%</span> sf<span class="sc">::</span><span class="fu">st_buffer</span>(<span class="dv">20</span>) <span class="sc">%&gt;%</span> terra<span class="sc">::</span><span class="fu">vect</span>()</span>
<span id="cb145-21"><a href="point-cloud-processing-and-pile-segmentation.html#cb145-21" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span> </span>
<span id="cb145-22"><a href="point-cloud-processing-and-pile-segmentation.html#cb145-22" tabindex="-1"></a>      terra<span class="sc">::</span><span class="fu">as.data.frame</span>(<span class="at">xy =</span> T) <span class="sc">%&gt;%</span> </span>
<span id="cb145-23"><a href="point-cloud-processing-and-pile-segmentation.html#cb145-23" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">f=</span><span class="dv">3</span>)</span>
<span id="cb145-24"><a href="point-cloud-processing-and-pile-segmentation.html#cb145-24" tabindex="-1"></a>    </span>
<span id="cb145-25"><a href="point-cloud-processing-and-pile-segmentation.html#cb145-25" tabindex="-1"></a>    <span class="co"># ggplot</span></span>
<span id="cb145-26"><a href="point-cloud-processing-and-pile-segmentation.html#cb145-26" tabindex="-1"></a>    comp_temp <span class="ot">&lt;-</span> ggplot2<span class="sc">::</span><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb145-27"><a href="point-cloud-processing-and-pile-segmentation.html#cb145-27" tabindex="-1"></a>      ggplot2<span class="sc">::</span><span class="fu">geom_tile</span>(<span class="at">data =</span> comp_st, ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x=</span>x,<span class="at">y=</span>y,<span class="at">fill=</span>f)) <span class="sc">+</span></span>
<span id="cb145-28"><a href="point-cloud-processing-and-pile-segmentation.html#cb145-28" tabindex="-1"></a>      ggplot2<span class="sc">::</span><span class="fu">geom_sf</span>(<span class="at">data =</span> d_temp, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">color =</span> <span class="st">&quot;gray33&quot;</span>, <span class="at">lwd =</span> <span class="fl">0.4</span>) <span class="sc">+</span></span>
<span id="cb145-29"><a href="point-cloud-processing-and-pile-segmentation.html#cb145-29" tabindex="-1"></a>      ggplot2<span class="sc">::</span><span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb145-30"><a href="point-cloud-processing-and-pile-segmentation.html#cb145-30" tabindex="-1"></a>      ggplot2<span class="sc">::</span><span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb145-31"><a href="point-cloud-processing-and-pile-segmentation.html#cb145-31" tabindex="-1"></a>      ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb145-32"><a href="point-cloud-processing-and-pile-segmentation.html#cb145-32" tabindex="-1"></a>        <span class="at">x =</span> <span class="st">&quot;&quot;</span></span>
<span id="cb145-33"><a href="point-cloud-processing-and-pile-segmentation.html#cb145-33" tabindex="-1"></a>        , <span class="at">y =</span> <span class="st">&quot;&quot;</span></span>
<span id="cb145-34"><a href="point-cloud-processing-and-pile-segmentation.html#cb145-34" tabindex="-1"></a>        , <span class="at">subtitle =</span> my_title</span>
<span id="cb145-35"><a href="point-cloud-processing-and-pile-segmentation.html#cb145-35" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb145-36"><a href="point-cloud-processing-and-pile-segmentation.html#cb145-36" tabindex="-1"></a>      ggplot2<span class="sc">::</span><span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb145-37"><a href="point-cloud-processing-and-pile-segmentation.html#cb145-37" tabindex="-1"></a>      ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb145-38"><a href="point-cloud-processing-and-pile-segmentation.html#cb145-38" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span> <span class="co"># c(0.5,1)</span></span>
<span id="cb145-39"><a href="point-cloud-processing-and-pile-segmentation.html#cb145-39" tabindex="-1"></a>        , <span class="at">legend.margin =</span> <span class="fu">margin</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>)</span>
<span id="cb145-40"><a href="point-cloud-processing-and-pile-segmentation.html#cb145-40" tabindex="-1"></a>        , <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>)</span>
<span id="cb145-41"><a href="point-cloud-processing-and-pile-segmentation.html#cb145-41" tabindex="-1"></a>        , <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>)</span>
<span id="cb145-42"><a href="point-cloud-processing-and-pile-segmentation.html#cb145-42" tabindex="-1"></a>        , <span class="at">legend.key =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;white&quot;</span>)</span>
<span id="cb145-43"><a href="point-cloud-processing-and-pile-segmentation.html#cb145-43" tabindex="-1"></a>        <span class="co"># , plot.title = ggtext::element_markdown(size = 10, hjust = 0.5)</span></span>
<span id="cb145-44"><a href="point-cloud-processing-and-pile-segmentation.html#cb145-44" tabindex="-1"></a>        , <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb145-45"><a href="point-cloud-processing-and-pile-segmentation.html#cb145-45" tabindex="-1"></a>        , <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">6</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">&quot;italic&quot;</span>)</span>
<span id="cb145-46"><a href="point-cloud-processing-and-pile-segmentation.html#cb145-46" tabindex="-1"></a>      )</span>
<span id="cb145-47"><a href="point-cloud-processing-and-pile-segmentation.html#cb145-47" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.null</span>(lim)){</span>
<span id="cb145-48"><a href="point-cloud-processing-and-pile-segmentation.html#cb145-48" tabindex="-1"></a>    comp_temp <span class="ot">&lt;-</span> comp_temp <span class="sc">+</span> </span>
<span id="cb145-49"><a href="point-cloud-processing-and-pile-segmentation.html#cb145-49" tabindex="-1"></a>      ggplot2<span class="sc">::</span><span class="fu">scale_fill_viridis_c</span>(<span class="at">option =</span> vopt, <span class="at">limits =</span> lim)</span>
<span id="cb145-50"><a href="point-cloud-processing-and-pile-segmentation.html#cb145-50" tabindex="-1"></a>  }<span class="cf">else</span>{</span>
<span id="cb145-51"><a href="point-cloud-processing-and-pile-segmentation.html#cb145-51" tabindex="-1"></a>    comp_temp <span class="ot">&lt;-</span> comp_temp <span class="sc">+</span> </span>
<span id="cb145-52"><a href="point-cloud-processing-and-pile-segmentation.html#cb145-52" tabindex="-1"></a>      ggplot2<span class="sc">::</span><span class="fu">scale_fill_viridis_c</span>(<span class="at">option =</span> vopt)</span>
<span id="cb145-53"><a href="point-cloud-processing-and-pile-segmentation.html#cb145-53" tabindex="-1"></a>  }</span>
<span id="cb145-54"><a href="point-cloud-processing-and-pile-segmentation.html#cb145-54" tabindex="-1"></a>    </span>
<span id="cb145-55"><a href="point-cloud-processing-and-pile-segmentation.html#cb145-55" tabindex="-1"></a>  plt_temp <span class="ot">&lt;-</span> comp_temp</span>
<span id="cb145-56"><a href="point-cloud-processing-and-pile-segmentation.html#cb145-56" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="st">&quot;plt&quot;</span><span class="ot">=</span>plt_temp,<span class="st">&quot;d&quot;</span><span class="ot">=</span>d_temp))</span>
<span id="cb145-57"><a href="point-cloud-processing-and-pile-segmentation.html#cb145-57" tabindex="-1"></a>}</span>
<span id="cb145-58"><a href="point-cloud-processing-and-pile-segmentation.html#cb145-58" tabindex="-1"></a></span>
<span id="cb145-59"><a href="point-cloud-processing-and-pile-segmentation.html#cb145-59" tabindex="-1"></a><span class="co"># p_fn_temp(</span></span>
<span id="cb145-60"><a href="point-cloud-processing-and-pile-segmentation.html#cb145-60" tabindex="-1"></a><span class="co">#   rn = 5</span></span>
<span id="cb145-61"><a href="point-cloud-processing-and-pile-segmentation.html#cb145-61" tabindex="-1"></a><span class="co">#   # , lim = c(floor(terra::minmax(cloud2raster_ans$dtm_rast)[1]*0.98), floor(terra::minmax(cloud2raster_ans$dtm_rast)[2]*1.02))</span></span>
<span id="cb145-62"><a href="point-cloud-processing-and-pile-segmentation.html#cb145-62" tabindex="-1"></a><span class="co"># )</span></span>
<span id="cb145-63"><a href="point-cloud-processing-and-pile-segmentation.html#cb145-63" tabindex="-1"></a><span class="co"># p_fn_temp(</span></span>
<span id="cb145-64"><a href="point-cloud-processing-and-pile-segmentation.html#cb145-64" tabindex="-1"></a><span class="co">#   rn = 11</span></span>
<span id="cb145-65"><a href="point-cloud-processing-and-pile-segmentation.html#cb145-65" tabindex="-1"></a><span class="co">#   , rast = cloud2raster_ans$chm_rast</span></span>
<span id="cb145-66"><a href="point-cloud-processing-and-pile-segmentation.html#cb145-66" tabindex="-1"></a><span class="co">#   , vopt = &quot;plasma&quot;</span></span>
<span id="cb145-67"><a href="point-cloud-processing-and-pile-segmentation.html#cb145-67" tabindex="-1"></a><span class="co"># )</span></span>
<span id="cb145-68"><a href="point-cloud-processing-and-pile-segmentation.html#cb145-68" tabindex="-1"></a><span class="co"># combine 3</span></span>
<span id="cb145-69"><a href="point-cloud-processing-and-pile-segmentation.html#cb145-69" tabindex="-1"></a>plt_combine_temp <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb145-70"><a href="point-cloud-processing-and-pile-segmentation.html#cb145-70" tabindex="-1"></a>    rn</span>
<span id="cb145-71"><a href="point-cloud-processing-and-pile-segmentation.html#cb145-71" tabindex="-1"></a>    , <span class="at">df =</span> slash_piles_polys <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(comment))</span>
<span id="cb145-72"><a href="point-cloud-processing-and-pile-segmentation.html#cb145-72" tabindex="-1"></a>    , <span class="at">rast1 =</span> cloud2raster_ans<span class="sc">$</span>dtm_rast</span>
<span id="cb145-73"><a href="point-cloud-processing-and-pile-segmentation.html#cb145-73" tabindex="-1"></a>    , <span class="at">title1 =</span> <span class="st">&quot;DTM&quot;</span></span>
<span id="cb145-74"><a href="point-cloud-processing-and-pile-segmentation.html#cb145-74" tabindex="-1"></a>    , <span class="at">vopt1 =</span> <span class="st">&quot;viridis&quot;</span></span>
<span id="cb145-75"><a href="point-cloud-processing-and-pile-segmentation.html#cb145-75" tabindex="-1"></a>    , <span class="at">rast2 =</span> cloud2raster_ans<span class="sc">$</span>chm_rast</span>
<span id="cb145-76"><a href="point-cloud-processing-and-pile-segmentation.html#cb145-76" tabindex="-1"></a>    , <span class="at">title2 =</span> <span class="st">&quot;CHM&quot;</span></span>
<span id="cb145-77"><a href="point-cloud-processing-and-pile-segmentation.html#cb145-77" tabindex="-1"></a>    , <span class="at">vopt2 =</span> <span class="st">&quot;plasma&quot;</span></span>
<span id="cb145-78"><a href="point-cloud-processing-and-pile-segmentation.html#cb145-78" tabindex="-1"></a>    , <span class="at">crs =</span> terra<span class="sc">::</span><span class="fu">crs</span>(cloud2raster_ans<span class="sc">$</span>dtm_rast)</span>
<span id="cb145-79"><a href="point-cloud-processing-and-pile-segmentation.html#cb145-79" tabindex="-1"></a>) {</span>
<span id="cb145-80"><a href="point-cloud-processing-and-pile-segmentation.html#cb145-80" tabindex="-1"></a>  <span class="co"># composite 1</span></span>
<span id="cb145-81"><a href="point-cloud-processing-and-pile-segmentation.html#cb145-81" tabindex="-1"></a>  ans1 <span class="ot">&lt;-</span> <span class="fu">p_fn_temp</span>(</span>
<span id="cb145-82"><a href="point-cloud-processing-and-pile-segmentation.html#cb145-82" tabindex="-1"></a>    <span class="at">rn =</span> rn</span>
<span id="cb145-83"><a href="point-cloud-processing-and-pile-segmentation.html#cb145-83" tabindex="-1"></a>    , <span class="at">df =</span> df</span>
<span id="cb145-84"><a href="point-cloud-processing-and-pile-segmentation.html#cb145-84" tabindex="-1"></a>    , <span class="at">rast =</span> rast1</span>
<span id="cb145-85"><a href="point-cloud-processing-and-pile-segmentation.html#cb145-85" tabindex="-1"></a>    , <span class="at">my_title =</span> title1</span>
<span id="cb145-86"><a href="point-cloud-processing-and-pile-segmentation.html#cb145-86" tabindex="-1"></a>    , <span class="at">crs =</span> crs</span>
<span id="cb145-87"><a href="point-cloud-processing-and-pile-segmentation.html#cb145-87" tabindex="-1"></a>    , <span class="at">vopt =</span> vopt1</span>
<span id="cb145-88"><a href="point-cloud-processing-and-pile-segmentation.html#cb145-88" tabindex="-1"></a>  )</span>
<span id="cb145-89"><a href="point-cloud-processing-and-pile-segmentation.html#cb145-89" tabindex="-1"></a>  <span class="co"># composite 2</span></span>
<span id="cb145-90"><a href="point-cloud-processing-and-pile-segmentation.html#cb145-90" tabindex="-1"></a>  ans2 <span class="ot">&lt;-</span> <span class="fu">p_fn_temp</span>(</span>
<span id="cb145-91"><a href="point-cloud-processing-and-pile-segmentation.html#cb145-91" tabindex="-1"></a>    <span class="at">rn =</span> rn</span>
<span id="cb145-92"><a href="point-cloud-processing-and-pile-segmentation.html#cb145-92" tabindex="-1"></a>    , <span class="at">df =</span> df</span>
<span id="cb145-93"><a href="point-cloud-processing-and-pile-segmentation.html#cb145-93" tabindex="-1"></a>    , <span class="at">rast =</span> rast2</span>
<span id="cb145-94"><a href="point-cloud-processing-and-pile-segmentation.html#cb145-94" tabindex="-1"></a>    , <span class="at">my_title =</span> title2</span>
<span id="cb145-95"><a href="point-cloud-processing-and-pile-segmentation.html#cb145-95" tabindex="-1"></a>    , <span class="at">crs =</span> crs</span>
<span id="cb145-96"><a href="point-cloud-processing-and-pile-segmentation.html#cb145-96" tabindex="-1"></a>    , <span class="at">vopt =</span> vopt2</span>
<span id="cb145-97"><a href="point-cloud-processing-and-pile-segmentation.html#cb145-97" tabindex="-1"></a>  )</span>
<span id="cb145-98"><a href="point-cloud-processing-and-pile-segmentation.html#cb145-98" tabindex="-1"></a>  <span class="co"># plt rgb</span></span>
<span id="cb145-99"><a href="point-cloud-processing-and-pile-segmentation.html#cb145-99" tabindex="-1"></a>    rgb_temp <span class="ot">&lt;-</span></span>
<span id="cb145-100"><a href="point-cloud-processing-and-pile-segmentation.html#cb145-100" tabindex="-1"></a>      <span class="fu">ortho_plt_fn</span>(ans1<span class="sc">$</span>d) <span class="sc">+</span> </span>
<span id="cb145-101"><a href="point-cloud-processing-and-pile-segmentation.html#cb145-101" tabindex="-1"></a>      ggplot2<span class="sc">::</span><span class="fu">geom_sf</span>(<span class="at">data =</span> ans1<span class="sc">$</span>d, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">color =</span> <span class="st">&quot;white&quot;</span>, <span class="at">lwd =</span> <span class="fl">0.3</span>)</span>
<span id="cb145-102"><a href="point-cloud-processing-and-pile-segmentation.html#cb145-102" tabindex="-1"></a>  <span class="co"># combine</span></span>
<span id="cb145-103"><a href="point-cloud-processing-and-pile-segmentation.html#cb145-103" tabindex="-1"></a>    r <span class="ot">&lt;-</span> ans1<span class="sc">$</span>plt <span class="sc">+</span> ans2<span class="sc">$</span>plt <span class="sc">+</span> rgb_temp</span>
<span id="cb145-104"><a href="point-cloud-processing-and-pile-segmentation.html#cb145-104" tabindex="-1"></a>    <span class="fu">return</span>(r)</span>
<span id="cb145-105"><a href="point-cloud-processing-and-pile-segmentation.html#cb145-105" tabindex="-1"></a>}</span>
<span id="cb145-106"><a href="point-cloud-processing-and-pile-segmentation.html#cb145-106" tabindex="-1"></a></span>
<span id="cb145-107"><a href="point-cloud-processing-and-pile-segmentation.html#cb145-107" tabindex="-1"></a><span class="co"># plt_combine_temp(2)</span></span>
<span id="cb145-108"><a href="point-cloud-processing-and-pile-segmentation.html#cb145-108" tabindex="-1"></a></span>
<span id="cb145-109"><a href="point-cloud-processing-and-pile-segmentation.html#cb145-109" tabindex="-1"></a><span class="co"># add pile locations</span></span>
<span id="cb145-110"><a href="point-cloud-processing-and-pile-segmentation.html#cb145-110" tabindex="-1"></a>plt_list_rast_comp <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(slash_piles_polys <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(comment))),<span class="dv">10</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb145-111"><a href="point-cloud-processing-and-pile-segmentation.html#cb145-111" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">map</span>(plt_combine_temp)</span>
<span id="cb145-112"><a href="point-cloud-processing-and-pile-segmentation.html#cb145-112" tabindex="-1"></a><span class="co"># plt_list_rast_comp[[2]]</span></span></code></pre></div>
<p>combine the plots for a few piles</p>
<div class="sourceCode" id="cb146"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb146-1"><a href="point-cloud-processing-and-pile-segmentation.html#cb146-1" tabindex="-1"></a>patchwork<span class="sc">::</span><span class="fu">wrap_plots</span>(</span>
<span id="cb146-2"><a href="point-cloud-processing-and-pile-segmentation.html#cb146-2" tabindex="-1"></a>  plt_list_rast_comp</span>
<span id="cb146-3"><a href="point-cloud-processing-and-pile-segmentation.html#cb146-3" tabindex="-1"></a>  , <span class="at">ncol =</span> <span class="dv">2</span></span>
<span id="cb146-4"><a href="point-cloud-processing-and-pile-segmentation.html#cb146-4" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-126-1.png" width="1008" /></p>
<div class="sourceCode" id="cb147"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb147-1"><a href="point-cloud-processing-and-pile-segmentation.html#cb147-1" tabindex="-1"></a>ggplot2<span class="sc">::</span><span class="fu">ggsave</span>(<span class="st">&quot;../data/pile_tiles_rast.jpeg&quot;</span>, <span class="at">height =</span> <span class="fl">8.5</span>, <span class="at">width =</span> <span class="fl">10.5</span>)</span></code></pre></div>
<p>a few things are noteworthy in these examples:</p>
<ul>
<li>Piles are clearly visible in some areas of the DTM but less visible in other areas</li>
<li>Piles are delineated in the CHM but with varying degrees of definition based on surrounding terrain and pile structure</li>
<li>The DTM and CHM were rarely impacted by shadows in the RGB imagery</li>
<li>It is interesting to see coarse woody debris occasionally visible in the CHM</li>
</ul>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="rgb-classification.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="raster_watershed.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
  "sharing": {
    "github": false,
    "facebook": true,
    "twitter": true,
    "linkedin": false,
    "weibo": false,
    "instapaper": false,
    "vk": false,
    "whatsapp": false,
    "all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
  },
  "fontsettings": {
    "theme": "white",
    "family": "sans",
    "size": 2
  },
  "edit": {
    "link": null,
    "text": null
  },
  "history": {
    "link": null,
    "text": null
  },
  "view": {
    "link": null,
    "text": null
  },
  "download": null,
  "search": {
    "engine": "fuse",
    "options": null
  },
  "toc": {
    "collapse": "subsection"
  }
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
