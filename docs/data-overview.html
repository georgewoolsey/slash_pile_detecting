<!DOCTYPE html>
<html lang="en-US" xml:lang="en-US">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Section 2 Data Overview | Aerial Imagery and Point Cloud Data for Slash Pile Quantification</title>
  <meta name="description" content="Using the bookdown package to write a book of data exploration. The output format for this example is bookdown::gitbook." />
  <meta name="generator" content="bookdown 0.34 and GitBook 2.6.7" />

  <meta property="og:title" content="Section 2 Data Overview | Aerial Imagery and Point Cloud Data for Slash Pile Quantification" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="Using the bookdown package to write a book of data exploration. The output format for this example is bookdown::gitbook." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Section 2 Data Overview | Aerial Imagery and Point Cloud Data for Slash Pile Quantification" />
  
  <meta name="twitter:description" content="Using the bookdown package to write a book of data exploration. The output format for this example is bookdown::gitbook." />
  

<meta name="author" content="George Woolsey" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="index.html"/>
<link rel="next" href="ptcld_process.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<link href="libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet" />
<script src="libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/proj4-2.6.2/proj4.min.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.2.2/leaflet.js"></script>
<script src="libs/leaflet-providers-2.0.0/leaflet-providers_2.0.0.js"></script>
<script src="libs/leaflet-providers-plugin-2.2.2/leaflet-providers-plugin.js"></script>
<script src="libs/HomeButton-0.0.1/home-button.js"></script>
<script src="libs/HomeButton-0.0.1/easy-button-src.min.js"></script>
<link href="libs/study sites-CSS-0.0.1/study sites_home-button.css" rel="stylesheet" />
<script src="libs/clipboard-0.0.1/setClipboardText.js"></script>
<link href="libs/mapviewCSS-0.0.1/mapview-popup.css" rel="stylesheet" />
<link href="libs/mapviewCSS-0.0.1/mapview.css" rel="stylesheet" />
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<link href="libs/bsTable-3.3.7/bootstrapTable.min.css" rel="stylesheet" />
<script src="libs/bsTable-3.3.7/bootstrapTable.js"></script>
<script type="text/javascript">

// toggle visibility of R source blocks in R Markdown output
function toggle_R() {
  var x = document.getElementsByClassName('r');
  if (x.length == 0) return;
  function toggle_vis(o) {
    var d = o.style.display;
    o.style.display = (d == 'block' || d == '') ? 'none':'block';
  }

  for (i = 0; i < x.length; i++) {
    var y = x[i];
    if (y.tagName.toLowerCase() === 'pre') toggle_vis(y);
  }

    var elem = document.getElementById("myButton1");
    if (elem.value === "Hide Code") elem.value = "Show Code";
    else elem.value = "Hide Code";
}

document.write('<input onclick="toggle_R();" type="button" value="Hide Code" id="myButton1" style="position: absolute; top: 10%; right: 2%; z-index: 200"></input>')

</script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#objective"><i class="fa fa-check"></i><b>1.1</b> Objective</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#data_desc"><i class="fa fa-check"></i><b>1.2</b> Data</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#analysis-plan"><i class="fa fa-check"></i><b>1.3</b> Analysis Plan</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="data-overview.html"><a href="data-overview.html"><i class="fa fa-check"></i><b>2</b> Data Overview</a>
<ul>
<li class="chapter" data-level="2.1" data-path="data-overview.html"><a href="data-overview.html#study-units-vector-data"><i class="fa fa-check"></i><b>2.1</b> Study Units Vector Data</a></li>
<li class="chapter" data-level="2.2" data-path="data-overview.html"><a href="data-overview.html#slash-pile-vector-data"><i class="fa fa-check"></i><b>2.2</b> Slash Pile Vector Data</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="data-overview.html"><a href="data-overview.html#standardize-pile-data"><i class="fa fa-check"></i><b>2.2.1</b> Standardize Pile Data</a></li>
<li class="chapter" data-level="2.2.2" data-path="data-overview.html"><a href="data-overview.html#pile-form-measurements"><i class="fa fa-check"></i><b>2.2.2</b> Pile Form Measurements</a></li>
<li class="chapter" data-level="2.2.3" data-path="data-overview.html"><a href="data-overview.html#image-annotation-comparison"><i class="fa fa-check"></i><b>2.2.3</b> Image-Annotation Comparison</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="data-overview.html"><a href="data-overview.html#rgb-orthomosaic"><i class="fa fa-check"></i><b>2.3</b> RGB orthomosaic</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="data-overview.html"><a href="data-overview.html#psinf-mixed-conifer-site"><i class="fa fa-check"></i><b>2.3.1</b> PSINF Mixed Conifer Site</a></li>
<li class="chapter" data-level="2.3.2" data-path="data-overview.html"><a href="data-overview.html#trfo-blm-pinyon-juniper-site"><i class="fa fa-check"></i><b>2.3.2</b> TRFO-BLM Pinyon-Juniper Site</a></li>
<li class="chapter" data-level="2.3.3" data-path="data-overview.html"><a href="data-overview.html#bhef-ponderosa-pine-site"><i class="fa fa-check"></i><b>2.3.3</b> BHEF Ponderosa Pine Site</a></li>
<li class="chapter" data-level="2.3.4" data-path="data-overview.html"><a href="data-overview.html#arnf-ponderosa-pine-site"><i class="fa fa-check"></i><b>2.3.4</b> ARNF Ponderosa Pine Site</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="data-overview.html"><a href="data-overview.html#slash-pile-rgb-imagery"><i class="fa fa-check"></i><b>2.4</b> Slash Pile RGB Imagery</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="data-overview.html"><a href="data-overview.html#psinf-mixed-conifer-site-1"><i class="fa fa-check"></i><b>2.4.1</b> PSINF Mixed Conifer Site</a></li>
<li class="chapter" data-level="2.4.2" data-path="data-overview.html"><a href="data-overview.html#trfo-blm-pinyon-juniper-site-1"><i class="fa fa-check"></i><b>2.4.2</b> TRFO-BLM Pinyon-Juniper Site</a></li>
<li class="chapter" data-level="2.4.3" data-path="data-overview.html"><a href="data-overview.html#bhef-ponderosa-pine-site-1"><i class="fa fa-check"></i><b>2.4.3</b> BHEF Ponderosa Pine Site</a></li>
<li class="chapter" data-level="2.4.4" data-path="data-overview.html"><a href="data-overview.html#arnf-ponderosa-pine-site-1"><i class="fa fa-check"></i><b>2.4.4</b> ARNF Ponderosa Pine Site</a></li>
<li class="chapter" data-level="2.4.5" data-path="data-overview.html"><a href="data-overview.html#all"><i class="fa fa-check"></i><b>2.4.5</b> All</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="ptcld_process.html"><a href="ptcld_process.html"><i class="fa fa-check"></i><b>3</b> Point Cloud Processing</a>
<ul>
<li class="chapter" data-level="3.1" data-path="ptcld_process.html"><a href="ptcld_process.html#process-raw-point-cloud"><i class="fa fa-check"></i><b>3.1</b> Process Raw Point Cloud</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="ptcld_process.html"><a href="ptcld_process.html#psinf-mixed-conifer-site-2"><i class="fa fa-check"></i><b>3.1.1</b> PSINF Mixed Conifer Site</a></li>
<li class="chapter" data-level="3.1.2" data-path="ptcld_process.html"><a href="ptcld_process.html#trfo-blm-pinyon-juniper-site-2"><i class="fa fa-check"></i><b>3.1.2</b> TRFO-BLM Pinyon-Juniper Site</a></li>
<li class="chapter" data-level="3.1.3" data-path="ptcld_process.html"><a href="ptcld_process.html#bhef-ponderosa-pine-site-2"><i class="fa fa-check"></i><b>3.1.3</b> BHEF Ponderosa Pine Site</a></li>
<li class="chapter" data-level="3.1.4" data-path="ptcld_process.html"><a href="ptcld_process.html#arnf-ponderosa-pine-site-2"><i class="fa fa-check"></i><b>3.1.4</b> ARNF Ponderosa Pine Site</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="ptcld_process.html"><a href="ptcld_process.html#clean-up"><i class="fa fa-check"></i><b>3.2</b> Clean Up</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="raster_watershed.html"><a href="raster_watershed.html"><i class="fa fa-check"></i><b>4</b> Geometry-based Slash Pile Detection</a>
<ul>
<li class="chapter" data-level="4.1" data-path="raster_watershed.html"><a href="raster_watershed.html#demonstration-area"><i class="fa fa-check"></i><b>4.1</b> Demonstration Area</a></li>
<li class="chapter" data-level="4.2" data-path="raster_watershed.html"><a href="raster_watershed.html#segmentation-methods"><i class="fa fa-check"></i><b>4.2</b> Segmentation Methods</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="raster_watershed.html"><a href="raster_watershed.html#overview-of-methods"><i class="fa fa-check"></i><b>4.2.1</b> Overview of Methods</a></li>
<li class="chapter" data-level="4.2.2" data-path="raster_watershed.html"><a href="raster_watershed.html#watershed-segmentation-demonstration"><i class="fa fa-check"></i><b>4.2.2</b> Watershed Segmentation Demonstration</a></li>
<li class="chapter" data-level="4.2.3" data-path="raster_watershed.html"><a href="raster_watershed.html#dbscan-segmentation-demonstration"><i class="fa fa-check"></i><b>4.2.3</b> DBSCAN Segmentation Demonstration</a></li>
<li class="chapter" data-level="4.2.4" data-path="raster_watershed.html"><a href="raster_watershed.html#comparison-of-candidate-segments"><i class="fa fa-check"></i><b>4.2.4</b> Comparison of Candidate Segments</a></li>
<li class="chapter" data-level="4.2.5" data-path="raster_watershed.html"><a href="raster_watershed.html#segmentation-function"><i class="fa fa-check"></i><b>4.2.5</b> Segmentation Function</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="raster_watershed.html"><a href="raster_watershed.html#candidate-shape-refinement-and-area-filtering"><i class="fa fa-check"></i><b>4.3</b> Candidate Shape Refinement and Area filtering</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="raster_watershed.html"><a href="raster_watershed.html#watershed-segmentation"><i class="fa fa-check"></i><b>4.3.1</b> Watershed Segmentation</a></li>
<li class="chapter" data-level="4.3.2" data-path="raster_watershed.html"><a href="raster_watershed.html#dbscan-segmentation"><i class="fa fa-check"></i><b>4.3.2</b> DBSCAN Segmentation</a></li>
<li class="chapter" data-level="4.3.3" data-path="raster_watershed.html"><a href="raster_watershed.html#quick-methods-comparison"><i class="fa fa-check"></i><b>4.3.3</b> Quick methods comparison</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="raster_watershed.html"><a href="raster_watershed.html#candidate-geometric-filtering"><i class="fa fa-check"></i><b>4.4</b> Candidate Geometric filtering</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="raster_watershed.html"><a href="raster_watershed.html#shape-irregularity-convexity"><i class="fa fa-check"></i><b>4.4.1</b> Shape Irregularity: Convexity</a></li>
<li class="chapter" data-level="4.4.2" data-path="raster_watershed.html"><a href="raster_watershed.html#shape-irregularity-circularity"><i class="fa fa-check"></i><b>4.4.2</b> Shape Irregularity: Circularity</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="raster_watershed.html"><a href="raster_watershed.html#structural-metrics-from-chm"><i class="fa fa-check"></i><b>4.5</b> Structural Metrics from CHM</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="raster_watershed.html"><a href="raster_watershed.html#structural-rasters"><i class="fa fa-check"></i><b>4.5.1</b> Structural Rasters</a></li>
<li class="chapter" data-level="4.5.2" data-path="raster_watershed.html"><a href="raster_watershed.html#demonstration-candidate-segment-metrics"><i class="fa fa-check"></i><b>4.5.2</b> Demonstration Candidate Segment Metrics</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="raster_watershed.html"><a href="raster_watershed.html#final-shape-refinement"><i class="fa fa-check"></i><b>4.6</b> Final Shape Refinement</a>
<ul>
<li class="chapter" data-level="4.6.1" data-path="raster_watershed.html"><a href="raster_watershed.html#watershed-segmentation-3"><i class="fa fa-check"></i><b>4.6.1</b> Watershed Segmentation</a></li>
<li class="chapter" data-level="4.6.2" data-path="raster_watershed.html"><a href="raster_watershed.html#dbscan-segmentation-3"><i class="fa fa-check"></i><b>4.6.2</b> DBSCAN Segmentation</a></li>
<li class="chapter" data-level="4.6.3" data-path="raster_watershed.html"><a href="raster_watershed.html#quick-methods-comparison-2"><i class="fa fa-check"></i><b>4.6.3</b> Quick methods comparison</a></li>
</ul></li>
<li class="chapter" data-level="4.7" data-path="raster_watershed.html"><a href="raster_watershed.html#slash_pile_detect_watershed"><i class="fa fa-check"></i><b>4.7</b> Pile Detection Function</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Aerial Imagery and Point Cloud Data for Slash Pile Quantification</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="data-overview" class="section level1 hasAnchor" number="2">
<h1><span class="header-section-number">Section 2</span> Data Overview<a href="data-overview.html#data-overview" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>We will detail the study sites and summarize the number of piles and the pile size based on available measurements.</p>
<table>
<colgroup>
<col width="20%" />
<col width="20%" />
<col width="20%" />
<col width="20%" />
<col width="20%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Site Name</th>
<th align="left">Pile Type</th>
<th align="left">Validation Data Type</th>
<th align="left">Unique Features &amp; Ecology</th>
<th align="left">Data Collection (UAS Platform &amp; Parameters)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><strong>PSINF Mixed Conifer Site</strong></td>
<td align="left">Hand Piles and smaller machine piles</td>
<td align="left">Image-annotated footprints and field-measured height and diameter</td>
<td align="left">Located in the Pike and San Isabel National Forest (PSINF) in CO, US. Mixed conifer stand with variable ground cover and canopy density.</td>
<td align="left">Switchblade-Elite (Vision Aerial) with 24.2 MP RGB sensor (16 mm lens). Altitude xx m, 90% forward and 85% side overlap, 4 m/s speed.</td>
</tr>
<tr class="even">
<td align="left"><strong>TRFO-BLM Pinyon-Juniper Site</strong></td>
<td align="left">Hand Piles</td>
<td align="left">Image-annotated footprints based on field collected point locations</td>
<td align="left">Located on BLM land in CO, US. Arid environment with dry vegetation including standing dead pinyon-juniper. Piles are smaller, simpler, and hand-stacked.</td>
<td align="left">Freefly Astro with Sony ILX-LR1 (35mm lens). Altitude 243.84 m (terrain following), 85% forward and 80% side overlap.</td>
</tr>
<tr class="odd">
<td align="left"><strong>BHEF Ponderosa Pine Site</strong></td>
<td align="left">Machine Piles</td>
<td align="left">Image-annotated footprints</td>
<td align="left">Located in the Black Hills Experimental Forest (BHEF) in SD, US. Piles are massive, mechanically built, and irregularly shaped (e.g. not necessarily circular). Tree regeneration is expected.</td>
<td align="left">DJI Phantom 4 Pro with 20 MP RGB sensor (8.8 mm lens). Altitude 80 m, 90% forward and 85% side overlap, 4 m/s speed.</td>
</tr>
<tr class="even">
<td align="left"><strong>ARNF Ponderosa Pine Site</strong></td>
<td align="left">Machine Piles</td>
<td align="left">Image-annotated footprints</td>
<td align="left">Located in the Arapahoe and Roosevelt National Forest (ARNF) in CO, US. Ponderosa pine forest with a climate similar to PSINF. Machine piles are massive but more circular and regular. Less regeneration is expected.</td>
<td align="left">Switchblade-Elite (Vision Aerial) with 24.2 MP RGB sensor (16 mm lens). Altitude xx m, 90% forward and 85% side overlap, 4 m/s speed.</td>
</tr>
</tbody>
</table>
<p>Load the standard libraries we use to do work</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="data-overview.html#cb1-1" tabindex="-1"></a><span class="co"># bread-and-butter</span></span>
<span id="cb1-2"><a href="data-overview.html#cb1-2" tabindex="-1"></a><span class="fu">library</span>(tidyverse) <span class="co"># the tidyverse</span></span>
<span id="cb1-3"><a href="data-overview.html#cb1-3" tabindex="-1"></a><span class="fu">library</span>(viridis) <span class="co"># viridis colors</span></span>
<span id="cb1-4"><a href="data-overview.html#cb1-4" tabindex="-1"></a><span class="fu">library</span>(harrypotter) <span class="co"># hp colors</span></span>
<span id="cb1-5"><a href="data-overview.html#cb1-5" tabindex="-1"></a><span class="fu">library</span>(RColorBrewer) <span class="co"># brewer colors</span></span>
<span id="cb1-6"><a href="data-overview.html#cb1-6" tabindex="-1"></a><span class="fu">library</span>(scales) <span class="co"># work with number and plot scales</span></span>
<span id="cb1-7"><a href="data-overview.html#cb1-7" tabindex="-1"></a><span class="fu">library</span>(latex2exp)</span>
<span id="cb1-8"><a href="data-overview.html#cb1-8" tabindex="-1"></a></span>
<span id="cb1-9"><a href="data-overview.html#cb1-9" tabindex="-1"></a><span class="co"># visualization</span></span>
<span id="cb1-10"><a href="data-overview.html#cb1-10" tabindex="-1"></a><span class="fu">library</span>(mapview) <span class="co"># interactive html maps</span></span>
<span id="cb1-11"><a href="data-overview.html#cb1-11" tabindex="-1"></a><span class="fu">library</span>(kableExtra) <span class="co"># tables</span></span>
<span id="cb1-12"><a href="data-overview.html#cb1-12" tabindex="-1"></a><span class="fu">library</span>(patchwork) <span class="co"># combine plots</span></span>
<span id="cb1-13"><a href="data-overview.html#cb1-13" tabindex="-1"></a><span class="fu">library</span>(corrplot) <span class="co"># correlation plots</span></span>
<span id="cb1-14"><a href="data-overview.html#cb1-14" tabindex="-1"></a><span class="fu">library</span>(ggnewscale) <span class="co"># new scale</span></span>
<span id="cb1-15"><a href="data-overview.html#cb1-15" tabindex="-1"></a><span class="fu">library</span>(grDevices) <span class="co"># default graphics</span></span>
<span id="cb1-16"><a href="data-overview.html#cb1-16" tabindex="-1"></a></span>
<span id="cb1-17"><a href="data-overview.html#cb1-17" tabindex="-1"></a><span class="co"># spatial analysis</span></span>
<span id="cb1-18"><a href="data-overview.html#cb1-18" tabindex="-1"></a><span class="fu">library</span>(terra) <span class="co"># raster</span></span>
<span id="cb1-19"><a href="data-overview.html#cb1-19" tabindex="-1"></a><span class="fu">library</span>(sf) <span class="co"># simple features</span></span>
<span id="cb1-20"><a href="data-overview.html#cb1-20" tabindex="-1"></a><span class="fu">library</span>(lwgeom) <span class="co"># advanced functions for spatial operations</span></span>
<span id="cb1-21"><a href="data-overview.html#cb1-21" tabindex="-1"></a><span class="fu">library</span>(lidR) <span class="co"># lidar data</span></span>
<span id="cb1-22"><a href="data-overview.html#cb1-22" tabindex="-1"></a><span class="fu">library</span>(rgl) <span class="co"># 3d plots</span></span>
<span id="cb1-23"><a href="data-overview.html#cb1-23" tabindex="-1"></a><span class="fu">library</span>(cloud2trees) <span class="co"># the cloud2trees</span></span></code></pre></div>
<div id="study-units-vector-data" class="section level2 hasAnchor" number="2.1">
<h2><span class="header-section-number">2.1</span> Study Units Vector Data<a href="data-overview.html#study-units-vector-data" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>let’s load in all the vector data containing the study units</p>
<p>we’ll combine the study unit boundaries for all sites to create a spatial data set that contains all units for plotting in a single map</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="data-overview.html#cb2-1" tabindex="-1"></a><span class="co"># read the data</span></span>
<span id="cb2-2"><a href="data-overview.html#cb2-2" tabindex="-1"></a><span class="co"># stand boundary</span></span>
<span id="cb2-3"><a href="data-overview.html#cb2-3" tabindex="-1"></a>all_stand_boundary <span class="ot">&lt;-</span></span>
<span id="cb2-4"><a href="data-overview.html#cb2-4" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(</span>
<span id="cb2-5"><a href="data-overview.html#cb2-5" tabindex="-1"></a>    psinf_stand_boundary <span class="sc">%&gt;%</span> </span>
<span id="cb2-6"><a href="data-overview.html#cb2-6" tabindex="-1"></a>      sf<span class="sc">::</span><span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="dv">5070</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb2-7"><a href="data-overview.html#cb2-7" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">select</span>(site) <span class="sc">%&gt;%</span> </span>
<span id="cb2-8"><a href="data-overview.html#cb2-8" tabindex="-1"></a>      sf<span class="sc">::</span><span class="fu">st_set_geometry</span>(<span class="st">&quot;geometry&quot;</span>)</span>
<span id="cb2-9"><a href="data-overview.html#cb2-9" tabindex="-1"></a>    , pj_stand_boundary <span class="sc">%&gt;%</span> </span>
<span id="cb2-10"><a href="data-overview.html#cb2-10" tabindex="-1"></a>      sf<span class="sc">::</span><span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="dv">5070</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb2-11"><a href="data-overview.html#cb2-11" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">select</span>(site) <span class="sc">%&gt;%</span> </span>
<span id="cb2-12"><a href="data-overview.html#cb2-12" tabindex="-1"></a>      sf<span class="sc">::</span><span class="fu">st_set_geometry</span>(<span class="st">&quot;geometry&quot;</span>)</span>
<span id="cb2-13"><a href="data-overview.html#cb2-13" tabindex="-1"></a>    , bhef_stand_boundary <span class="sc">%&gt;%</span> </span>
<span id="cb2-14"><a href="data-overview.html#cb2-14" tabindex="-1"></a>      sf<span class="sc">::</span><span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="dv">5070</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb2-15"><a href="data-overview.html#cb2-15" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">select</span>(site) <span class="sc">%&gt;%</span> </span>
<span id="cb2-16"><a href="data-overview.html#cb2-16" tabindex="-1"></a>      sf<span class="sc">::</span><span class="fu">st_set_geometry</span>(<span class="st">&quot;geometry&quot;</span>)</span>
<span id="cb2-17"><a href="data-overview.html#cb2-17" tabindex="-1"></a>    , arnf_stand_boundary <span class="sc">%&gt;%</span> </span>
<span id="cb2-18"><a href="data-overview.html#cb2-18" tabindex="-1"></a>      sf<span class="sc">::</span><span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="dv">5070</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb2-19"><a href="data-overview.html#cb2-19" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">select</span>(site) <span class="sc">%&gt;%</span> </span>
<span id="cb2-20"><a href="data-overview.html#cb2-20" tabindex="-1"></a>      sf<span class="sc">::</span><span class="fu">st_set_geometry</span>(<span class="st">&quot;geometry&quot;</span>)</span>
<span id="cb2-21"><a href="data-overview.html#cb2-21" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb2-22"><a href="data-overview.html#cb2-22" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(site) <span class="sc">%&gt;%</span> </span>
<span id="cb2-23"><a href="data-overview.html#cb2-23" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(</span>
<span id="cb2-24"><a href="data-overview.html#cb2-24" tabindex="-1"></a>    <span class="at">geometry =</span> sf<span class="sc">::</span><span class="fu">st_union</span>(geometry)</span>
<span id="cb2-25"><a href="data-overview.html#cb2-25" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb2-26"><a href="data-overview.html#cb2-26" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb2-27"><a href="data-overview.html#cb2-27" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_set_geometry</span>(<span class="st">&quot;geometry&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb2-28"><a href="data-overview.html#cb2-28" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb2-29"><a href="data-overview.html#cb2-29" tabindex="-1"></a>    <span class="at">site_area_m2 =</span> sf<span class="sc">::</span><span class="fu">st_area</span>(geometry) <span class="sc">%&gt;%</span> <span class="fu">as.numeric</span>()</span>
<span id="cb2-30"><a href="data-overview.html#cb2-30" tabindex="-1"></a>    , <span class="at">site_area_ha =</span> site_area_m2<span class="sc">/</span><span class="dv">10000</span></span>
<span id="cb2-31"><a href="data-overview.html#cb2-31" tabindex="-1"></a>  )</span>
<span id="cb2-32"><a href="data-overview.html#cb2-32" tabindex="-1"></a>  <span class="co"># sf::st_centroid() %&gt;% </span></span>
<span id="cb2-33"><a href="data-overview.html#cb2-33" tabindex="-1"></a>  <span class="co"># sf::st_sf() %&gt;% </span></span></code></pre></div>
<p>Let’s map the study sites on a single map</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="data-overview.html#cb3-1" tabindex="-1"></a>sites_pal <span class="ot">&lt;-</span> RColorBrewer<span class="sc">::</span><span class="fu">brewer.pal</span>(<span class="at">n =</span> <span class="fu">nrow</span>(all_stand_boundary), <span class="at">name =</span> <span class="st">&quot;Dark2&quot;</span>)</span>
<span id="cb3-2"><a href="data-overview.html#cb3-2" tabindex="-1"></a><span class="co"># option to put satellite imagery as base layer of mapview maps</span></span>
<span id="cb3-3"><a href="data-overview.html#cb3-3" tabindex="-1"></a>mapview<span class="sc">::</span><span class="fu">mapviewOptions</span>(</span>
<span id="cb3-4"><a href="data-overview.html#cb3-4" tabindex="-1"></a>  <span class="at">homebutton =</span> T</span>
<span id="cb3-5"><a href="data-overview.html#cb3-5" tabindex="-1"></a>  <span class="co"># , basemaps = c(&quot;Esri.WorldImagery&quot;,&quot;OpenStreetMap&quot;)</span></span>
<span id="cb3-6"><a href="data-overview.html#cb3-6" tabindex="-1"></a>  , <span class="at">basemaps =</span> <span class="fu">c</span>(<span class="st">&quot;OpenStreetMap&quot;</span>, <span class="st">&quot;Esri.WorldImagery&quot;</span>)</span>
<span id="cb3-7"><a href="data-overview.html#cb3-7" tabindex="-1"></a>)</span>
<span id="cb3-8"><a href="data-overview.html#cb3-8" tabindex="-1"></a><span class="co"># map it</span></span>
<span id="cb3-9"><a href="data-overview.html#cb3-9" tabindex="-1"></a>mapview<span class="sc">::</span><span class="fu">mapview</span>(</span>
<span id="cb3-10"><a href="data-overview.html#cb3-10" tabindex="-1"></a>  all_stand_boundary <span class="sc">%&gt;%</span> </span>
<span id="cb3-11"><a href="data-overview.html#cb3-11" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">group_by</span>(site) <span class="sc">%&gt;%</span> </span>
<span id="cb3-12"><a href="data-overview.html#cb3-12" tabindex="-1"></a>    sf<span class="sc">::</span><span class="fu">st_centroid</span>()</span>
<span id="cb3-13"><a href="data-overview.html#cb3-13" tabindex="-1"></a>  , <span class="at">zcol=</span><span class="st">&quot;site&quot;</span></span>
<span id="cb3-14"><a href="data-overview.html#cb3-14" tabindex="-1"></a>  , <span class="at">col.regions =</span> sites_pal</span>
<span id="cb3-15"><a href="data-overview.html#cb3-15" tabindex="-1"></a>  , <span class="at">cex =</span> <span class="dv">8</span></span>
<span id="cb3-16"><a href="data-overview.html#cb3-16" tabindex="-1"></a>  , <span class="at">layer.name =</span> <span class="st">&quot;study sites&quot;</span></span>
<span id="cb3-17"><a href="data-overview.html#cb3-17" tabindex="-1"></a>)</span></code></pre></div>
<div class="leaflet html-widget html-fill-item" id="htmlwidget-6f4ce306809624373a60" style="width:1008px;height:672px;"></div>
<script type="application/json" data-for="htmlwidget-6f4ce306809624373a60">{"x":{"options":{"minZoom":1,"maxZoom":52,"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}},"preferCanvas":false,"bounceAtZoomLimits":false,"maxBounds":[[[-90,-370]],[[90,370]]]},"calls":[{"method":"addProviderTiles","args":["OpenStreetMap","OpenStreetMap","OpenStreetMap",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["Esri.WorldImagery","Esri.WorldImagery","Esri.WorldImagery",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"createMapPane","args":["point",440]},{"method":"addCircleMarkers","args":[[40.96975654873339,44.14386900731998,39.00984467296456,37.86458213566355],[-105.525266647088,-103.6350979696801,-105.004467190648,-108.6340981871092],8,null,"study sites",{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}},"pane":"point","stroke":true,"color":"#333333","weight":1,"opacity":[0.9,0.9,0.9,0.9],"fill":true,"fillColor":["#1B9E77","#D95F02","#7570B3","#E7298A"],"fillOpacity":[0.6,0.6,0.6,0.6]},null,null,["<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>1&emsp;<\/td><\/tr><tr><td>1<\/td><th>site&emsp;<\/th><td>ARNF Ponderosa Pine Site&emsp;<\/td><\/tr><tr><td>2<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><tr><td>3<\/td><th>site_area_m2&emsp;<\/th><td> 736062.04&emsp;<\/td><\/tr><tr><td>4<\/td><th>site_area_ha&emsp;<\/th><td> 73.606204&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>2&emsp;<\/td><\/tr><tr><td>1<\/td><th>site&emsp;<\/th><td>BHEF Ponderosa Pine Site&emsp;<\/td><\/tr><tr><td>2<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><tr><td>3<\/td><th>site_area_m2&emsp;<\/th><td>1031024.64&emsp;<\/td><\/tr><tr><td>4<\/td><th>site_area_ha&emsp;<\/th><td>103.102464&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>3&emsp;<\/td><\/tr><tr><td>1<\/td><th>site&emsp;<\/th><td>PSINF Mixed Conifer Site&emsp;<\/td><\/tr><tr><td>2<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><tr><td>3<\/td><th>site_area_m2&emsp;<\/th><td> 174975.91&emsp;<\/td><\/tr><tr><td>4<\/td><th>site_area_ha&emsp;<\/th><td> 17.497591&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>4&emsp;<\/td><\/tr><tr><td>1<\/td><th>site&emsp;<\/th><td>TRFO-BLM Pinyon-Juniper Site&emsp;<\/td><\/tr><tr><td>2<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><tr><td>3<\/td><th>site_area_m2&emsp;<\/th><td>  51736.28&emsp;<\/td><\/tr><tr><td>4<\/td><th>site_area_ha&emsp;<\/th><td>  5.173628&emsp;<\/td><\/tr><\/table><\/div>"],{"maxWidth":800,"minWidth":50,"autoPan":true,"keepInView":false,"closeButton":true,"closeOnClick":true,"className":""},["ARNF Ponderosa Pine Site","BHEF Ponderosa Pine Site","PSINF Mixed Conifer Site","TRFO-BLM Pinyon-Juniper Site"],{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addScaleBar","args":[{"maxWidth":100,"metric":true,"imperial":true,"updateWhenIdle":true,"position":"bottomleft"}]},{"method":"addHomeButton","args":[-108.6340981871092,37.86458213566355,-103.6350979696801,44.14386900731998,true,"study sites","Zoom to study sites","<strong> study sites <\/strong>","bottomright"]},{"method":"addLayersControl","args":[["OpenStreetMap","Esri.WorldImagery"],"study sites",{"collapsed":true,"autoZIndex":true,"position":"topleft"}]},{"method":"addLegend","args":[{"colors":["#1B9E77","#D95F02","#7570B3","#E7298A"],"labels":["ARNF Ponderosa Pine Site","BHEF Ponderosa Pine Site","PSINF Mixed Conifer Site","TRFO-BLM Pinyon-Juniper Site"],"na_color":null,"na_label":"NA","opacity":1,"position":"topright","type":"factor","title":"study sites","extra":null,"layerId":null,"className":"info legend","group":"study sites"}]}],"limits":{"lat":[37.86458213566355,44.14386900731998],"lng":[-108.6340981871092,-103.6350979696801]},"fitBounds":[37.86458213566355,-108.6340981871092,44.14386900731998,-103.6350979696801,[]]},"evals":[],"jsHooks":{"render":[{"code":"function(el, x, data) {\n  return (\n      function(el, x, data) {\n      // get the leaflet map\n      var map = this; //HTMLWidgets.find('#' + el.id);\n      // we need a new div element because we have to handle\n      // the mouseover output separately\n      // debugger;\n      function addElement () {\n      // generate new div Element\n      var newDiv = $(document.createElement('div'));\n      // append at end of leaflet htmlwidget container\n      $(el).append(newDiv);\n      //provide ID and style\n      newDiv.addClass('lnlt');\n      newDiv.css({\"position\":\"relative\",\"bottomleft\":\"0px\",\"background-color\":\"rgba(255, 255, 255, 0.7)\",\"box-shadow\":\"0 0 2px #bbb\",\"background-clip\":\"padding-box\",\"margin\":\"0\",\"padding-left\":\"5px\",\"padding-right\":\"5px\",\"color\":\"#333\",\"font-size\":\"9px\",\"font-family\":\"\\\"Helvetica Neue\\\", Arial, Helvetica, sans-serif\",\"text-align\":\"left\",\"z-index\":\"700\"});\n      return newDiv;\n      }\n\n\n      // check for already existing lnlt class to not duplicate\n      var lnlt = $(el).find('.lnlt');\n\n      if(!lnlt.length) {\n      lnlt = addElement();\n\n      // grab the special div we generated in the beginning\n      // and put the mousmove output there\n\n      map.on('mousemove', function (e) {\n      if (e.originalEvent.ctrlKey) {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                           ' lon: ' + (e.latlng.lng).toFixed(5) +\n                           ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                           ' | zoom: ' + map.getZoom() +\n                           ' | x: ' + L.CRS.EPSG3857.project(e.latlng).x.toFixed(0) +\n                           ' | y: ' + L.CRS.EPSG3857.project(e.latlng).y.toFixed(0) +\n                           ' | epsg: 3857 ' +\n                           ' | proj4: +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs ');\n      } else {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                      ' lon: ' + (e.latlng.lng).toFixed(5) +\n                      ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                      ' | zoom: ' + map.getZoom() + ' ');\n      }\n      });\n\n      // remove the lnlt div when mouse leaves map\n      map.on('mouseout', function (e) {\n      var strip = document.querySelector('.lnlt');\n      if( strip !==null) strip.remove();\n      });\n\n      };\n\n      //$(el).keypress(67, function(e) {\n      map.on('preclick', function(e) {\n      if (e.originalEvent.ctrlKey) {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                      ' lon: ' + (e.latlng.lng).toFixed(5) +\n                      ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                      ' | zoom: ' + map.getZoom() + ' ');\n      var txt = document.querySelector('.lnlt').textContent;\n      console.log(txt);\n      //txt.innerText.focus();\n      //txt.select();\n      setClipboardText('\"' + txt + '\"');\n      }\n      });\n\n      }\n      ).call(this.getMap(), el, x, data);\n}","data":null},{"code":"function(el, x, data) {\n  return (function(el,x,data){\n           var map = this;\n\n           map.on('keypress', function(e) {\n               console.log(e.originalEvent.code);\n               var key = e.originalEvent.code;\n               if (key === 'KeyE') {\n                   var bb = this.getBounds();\n                   var txt = JSON.stringify(bb);\n                   console.log(txt);\n\n                   setClipboardText('\\'' + txt + '\\'');\n               }\n           })\n        }).call(this.getMap(), el, x, data);\n}","data":null}]}}</script>
<p>static map for printing</p>
<p>let’s make a pretty image for use in the journal article. we’ll use the <code>ggmap</code> package to get a nice background map and do some transformation to actually work with the map. We’ll add a map scale using <code>ggspatial</code></p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="data-overview.html#cb4-1" tabindex="-1"></a><span class="fu">library</span>(ggmap)</span>
<span id="cb4-2"><a href="data-overview.html#cb4-2" tabindex="-1"></a><span class="fu">library</span>(ggspatial)</span>
<span id="cb4-3"><a href="data-overview.html#cb4-3" tabindex="-1"></a><span class="do">#########################################################################</span></span>
<span id="cb4-4"><a href="data-overview.html#cb4-4" tabindex="-1"></a><span class="do">#########################################################################</span></span>
<span id="cb4-5"><a href="data-overview.html#cb4-5" tabindex="-1"></a><span class="co"># Make each plot individually by landscape as solution to small multiples</span></span>
<span id="cb4-6"><a href="data-overview.html#cb4-6" tabindex="-1"></a><span class="co"># this block defines function</span></span>
<span id="cb4-7"><a href="data-overview.html#cb4-7" tabindex="-1"></a><span class="do">#########################################################################</span></span>
<span id="cb4-8"><a href="data-overview.html#cb4-8" tabindex="-1"></a><span class="do">##################hack to align plots for ggmap</span></span>
<span id="cb4-9"><a href="data-overview.html#cb4-9" tabindex="-1"></a>ggmap_bbox_fn <span class="ot">&lt;-</span> <span class="cf">function</span>(map, <span class="at">my_crs=</span><span class="dv">3857</span>) {</span>
<span id="cb4-10"><a href="data-overview.html#cb4-10" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">inherits</span>(map, <span class="st">&quot;ggmap&quot;</span>)) <span class="fu">stop</span>(<span class="st">&quot;map must be a ggmap object&quot;</span>)</span>
<span id="cb4-11"><a href="data-overview.html#cb4-11" tabindex="-1"></a>    <span class="co"># Extract the bounding box (in lat/lon) from the ggmap to a numeric vector, </span></span>
<span id="cb4-12"><a href="data-overview.html#cb4-12" tabindex="-1"></a>    <span class="co"># and set the names to what sf::st_bbox expects:</span></span>
<span id="cb4-13"><a href="data-overview.html#cb4-13" tabindex="-1"></a>    map_bbox <span class="ot">&lt;-</span> <span class="fu">setNames</span>(<span class="fu">unlist</span>(<span class="fu">attr</span>(map, <span class="st">&quot;bb&quot;</span>)), <span class="fu">c</span>(<span class="st">&quot;ymin&quot;</span>, <span class="st">&quot;xmin&quot;</span>, <span class="st">&quot;ymax&quot;</span>, <span class="st">&quot;xmax&quot;</span>))</span>
<span id="cb4-14"><a href="data-overview.html#cb4-14" tabindex="-1"></a>    <span class="co"># Convert the bbox to an sf polygon, transform it to 3857, </span></span>
<span id="cb4-15"><a href="data-overview.html#cb4-15" tabindex="-1"></a>    <span class="co"># and convert back to a bbox (convoluted, but it works)</span></span>
<span id="cb4-16"><a href="data-overview.html#cb4-16" tabindex="-1"></a>    bbox_3857 <span class="ot">&lt;-</span> <span class="fu">st_bbox</span>(<span class="fu">st_transform</span>(<span class="fu">st_as_sfc</span>(<span class="fu">st_bbox</span>(map_bbox, <span class="at">crs =</span> <span class="dv">4326</span>)), my_crs))</span>
<span id="cb4-17"><a href="data-overview.html#cb4-17" tabindex="-1"></a>    <span class="co"># Overwrite the bbox of the ggmap object with the transformed coordinates </span></span>
<span id="cb4-18"><a href="data-overview.html#cb4-18" tabindex="-1"></a>    <span class="fu">attr</span>(map, <span class="st">&quot;bb&quot;</span>)<span class="sc">$</span>ll.lat <span class="ot">&lt;-</span> bbox_3857[<span class="st">&quot;ymin&quot;</span>]</span>
<span id="cb4-19"><a href="data-overview.html#cb4-19" tabindex="-1"></a>    <span class="fu">attr</span>(map, <span class="st">&quot;bb&quot;</span>)<span class="sc">$</span>ll.lon <span class="ot">&lt;-</span> bbox_3857[<span class="st">&quot;xmin&quot;</span>]</span>
<span id="cb4-20"><a href="data-overview.html#cb4-20" tabindex="-1"></a>    <span class="fu">attr</span>(map, <span class="st">&quot;bb&quot;</span>)<span class="sc">$</span>ur.lat <span class="ot">&lt;-</span> bbox_3857[<span class="st">&quot;ymax&quot;</span>]</span>
<span id="cb4-21"><a href="data-overview.html#cb4-21" tabindex="-1"></a>    <span class="fu">attr</span>(map, <span class="st">&quot;bb&quot;</span>)<span class="sc">$</span>ur.lon <span class="ot">&lt;-</span> bbox_3857[<span class="st">&quot;xmax&quot;</span>]</span>
<span id="cb4-22"><a href="data-overview.html#cb4-22" tabindex="-1"></a>    map</span>
<span id="cb4-23"><a href="data-overview.html#cb4-23" tabindex="-1"></a>}</span>
<span id="cb4-24"><a href="data-overview.html#cb4-24" tabindex="-1"></a>plt_crs <span class="ot">&lt;-</span> <span class="dv">3857</span></span>
<span id="cb4-25"><a href="data-overview.html#cb4-25" tabindex="-1"></a><span class="do">#########################################################################</span></span>
<span id="cb4-26"><a href="data-overview.html#cb4-26" tabindex="-1"></a><span class="do">#########################################################################</span></span>
<span id="cb4-27"><a href="data-overview.html#cb4-27" tabindex="-1"></a><span class="do">#########################################################################</span></span>
<span id="cb4-28"><a href="data-overview.html#cb4-28" tabindex="-1"></a>my_ggmap_basemap <span class="ot">&lt;-</span> <span class="cf">function</span>(sf_data, <span class="at">zoom_level =</span> <span class="dv">14</span>, <span class="at">buffer_box =</span> <span class="dv">2600</span>, <span class="at">my_crs =</span> plt_crs, <span class="at">scale_location =</span> <span class="st">&quot;bl&quot;</span>, <span class="at">my_maptype =</span> <span class="st">&quot;stamen_terrain&quot;</span>) {</span>
<span id="cb4-29"><a href="data-overview.html#cb4-29" tabindex="-1"></a>  </span>
<span id="cb4-30"><a href="data-overview.html#cb4-30" tabindex="-1"></a>  <span class="co"># # should zoom in?</span></span>
<span id="cb4-31"><a href="data-overview.html#cb4-31" tabindex="-1"></a>  <span class="co"># zoom_level &lt;- 14 # 11</span></span>
<span id="cb4-32"><a href="data-overview.html#cb4-32" tabindex="-1"></a>  <span class="co"># # should buffer extend?</span></span>
<span id="cb4-33"><a href="data-overview.html#cb4-33" tabindex="-1"></a>  <span class="co"># buffer_box &lt;- 2600 # 20000</span></span>
<span id="cb4-34"><a href="data-overview.html#cb4-34" tabindex="-1"></a>  <span class="co"># bounding box</span></span>
<span id="cb4-35"><a href="data-overview.html#cb4-35" tabindex="-1"></a>  bb_temp <span class="ot">&lt;-</span></span>
<span id="cb4-36"><a href="data-overview.html#cb4-36" tabindex="-1"></a>    sf_data <span class="sc">%&gt;%</span> </span>
<span id="cb4-37"><a href="data-overview.html#cb4-37" tabindex="-1"></a>    sf<span class="sc">::</span><span class="fu">st_bbox</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb4-38"><a href="data-overview.html#cb4-38" tabindex="-1"></a>    sf<span class="sc">::</span><span class="fu">st_as_sfc</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb4-39"><a href="data-overview.html#cb4-39" tabindex="-1"></a>    sf<span class="sc">::</span><span class="fu">st_transform</span>(<span class="at">crs=</span><span class="dv">5070</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb4-40"><a href="data-overview.html#cb4-40" tabindex="-1"></a>    sf<span class="sc">::</span><span class="fu">st_buffer</span>(<span class="fu">as.numeric</span>(buffer_box)) <span class="sc">%&gt;%</span> </span>
<span id="cb4-41"><a href="data-overview.html#cb4-41" tabindex="-1"></a>    sf<span class="sc">::</span><span class="fu">st_transform</span>(<span class="at">crs=</span><span class="dv">4326</span>) <span class="sc">%&gt;%</span> <span class="co"># same as get_map return</span></span>
<span id="cb4-42"><a href="data-overview.html#cb4-42" tabindex="-1"></a>    sf<span class="sc">::</span><span class="fu">st_bbox</span>()</span>
<span id="cb4-43"><a href="data-overview.html#cb4-43" tabindex="-1"></a>  <span class="co"># set bbox for get call</span></span>
<span id="cb4-44"><a href="data-overview.html#cb4-44" tabindex="-1"></a>  bbox_temp <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb4-45"><a href="data-overview.html#cb4-45" tabindex="-1"></a>    <span class="at">bottom =</span> bb_temp[[<span class="dv">2</span>]]</span>
<span id="cb4-46"><a href="data-overview.html#cb4-46" tabindex="-1"></a>    , <span class="at">top =</span> bb_temp[[<span class="dv">4</span>]]</span>
<span id="cb4-47"><a href="data-overview.html#cb4-47" tabindex="-1"></a>    , <span class="at">right =</span> bb_temp[[<span class="dv">3</span>]]</span>
<span id="cb4-48"><a href="data-overview.html#cb4-48" tabindex="-1"></a>    , <span class="at">left =</span> bb_temp[[<span class="dv">1</span>]]</span>
<span id="cb4-49"><a href="data-overview.html#cb4-49" tabindex="-1"></a>  )</span>
<span id="cb4-50"><a href="data-overview.html#cb4-50" tabindex="-1"></a>  hey_ggmap <span class="ot">&lt;-</span> ggmap<span class="sc">::</span><span class="fu">get_stadiamap</span>(</span>
<span id="cb4-51"><a href="data-overview.html#cb4-51" tabindex="-1"></a>    <span class="at">bbox =</span> bbox_temp</span>
<span id="cb4-52"><a href="data-overview.html#cb4-52" tabindex="-1"></a>    , <span class="at">zoom =</span> zoom_level</span>
<span id="cb4-53"><a href="data-overview.html#cb4-53" tabindex="-1"></a>    , <span class="at">maptype =</span> my_maptype <span class="co">#&quot;stamen_terrain&quot; #&quot;stamen_toner_lite&quot;</span></span>
<span id="cb4-54"><a href="data-overview.html#cb4-54" tabindex="-1"></a>    , <span class="at">crop =</span> T</span>
<span id="cb4-55"><a href="data-overview.html#cb4-55" tabindex="-1"></a>  )</span>
<span id="cb4-56"><a href="data-overview.html#cb4-56" tabindex="-1"></a></span>
<span id="cb4-57"><a href="data-overview.html#cb4-57" tabindex="-1"></a>  <span class="co"># ggmap::ggmap(hey_ggmap)</span></span>
<span id="cb4-58"><a href="data-overview.html#cb4-58" tabindex="-1"></a>  <span class="co"># apply align function</span></span>
<span id="cb4-59"><a href="data-overview.html#cb4-59" tabindex="-1"></a>  hey_ggmap_aligned <span class="ot">&lt;-</span> <span class="fu">ggmap_bbox_fn</span>(hey_ggmap, my_crs) <span class="co"># Use the function</span></span>
<span id="cb4-60"><a href="data-overview.html#cb4-60" tabindex="-1"></a>  <span class="co"># plot</span></span>
<span id="cb4-61"><a href="data-overview.html#cb4-61" tabindex="-1"></a>  plt_basemap <span class="ot">&lt;-</span></span>
<span id="cb4-62"><a href="data-overview.html#cb4-62" tabindex="-1"></a>    ggmap<span class="sc">::</span><span class="fu">ggmap</span>(hey_ggmap_aligned) <span class="sc">+</span> </span>
<span id="cb4-63"><a href="data-overview.html#cb4-63" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">coord_sf</span>(</span>
<span id="cb4-64"><a href="data-overview.html#cb4-64" tabindex="-1"></a>      <span class="at">expand =</span> <span class="cn">FALSE</span></span>
<span id="cb4-65"><a href="data-overview.html#cb4-65" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb4-66"><a href="data-overview.html#cb4-66" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb4-67"><a href="data-overview.html#cb4-67" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb4-68"><a href="data-overview.html#cb4-68" tabindex="-1"></a>      <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb4-69"><a href="data-overview.html#cb4-69" tabindex="-1"></a>      , <span class="at">plot.title =</span> ggplot2<span class="sc">::</span><span class="fu">element_blank</span>()</span>
<span id="cb4-70"><a href="data-overview.html#cb4-70" tabindex="-1"></a>      , <span class="at">strip.text =</span> ggplot2<span class="sc">::</span><span class="fu">element_blank</span>()</span>
<span id="cb4-71"><a href="data-overview.html#cb4-71" tabindex="-1"></a>      , <span class="at">axis.title =</span> ggplot2<span class="sc">::</span><span class="fu">element_blank</span>()</span>
<span id="cb4-72"><a href="data-overview.html#cb4-72" tabindex="-1"></a>      , <span class="at">axis.text =</span> ggplot2<span class="sc">::</span><span class="fu">element_blank</span>()</span>
<span id="cb4-73"><a href="data-overview.html#cb4-73" tabindex="-1"></a>      , <span class="at">axis.ticks =</span> ggplot2<span class="sc">::</span><span class="fu">element_blank</span>()</span>
<span id="cb4-74"><a href="data-overview.html#cb4-74" tabindex="-1"></a>      , <span class="at">panel.grid =</span> ggplot2<span class="sc">::</span><span class="fu">element_blank</span>()</span>
<span id="cb4-75"><a href="data-overview.html#cb4-75" tabindex="-1"></a>      , <span class="at">plot.margin =</span> ggplot2<span class="sc">::</span><span class="fu">margin</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="st">&quot;cm&quot;</span>)</span>
<span id="cb4-76"><a href="data-overview.html#cb4-76" tabindex="-1"></a>    )</span>
<span id="cb4-77"><a href="data-overview.html#cb4-77" tabindex="-1"></a>  <span class="cf">if</span>(scale_location <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;bl&quot;</span>, <span class="st">&quot;br&quot;</span>, <span class="st">&quot;tr&quot;</span>, <span class="st">&quot;tl&quot;</span>)){</span>
<span id="cb4-78"><a href="data-overview.html#cb4-78" tabindex="-1"></a>    plt_basemap <span class="ot">&lt;-</span> plt_basemap <span class="sc">+</span> </span>
<span id="cb4-79"><a href="data-overview.html#cb4-79" tabindex="-1"></a>      ggspatial<span class="sc">::</span><span class="fu">annotation_scale</span>(</span>
<span id="cb4-80"><a href="data-overview.html#cb4-80" tabindex="-1"></a>        <span class="at">location =</span> scale_location</span>
<span id="cb4-81"><a href="data-overview.html#cb4-81" tabindex="-1"></a>        , <span class="at">style =</span> <span class="st">&quot;ticks&quot;</span></span>
<span id="cb4-82"><a href="data-overview.html#cb4-82" tabindex="-1"></a>        , <span class="at">pad_x =</span> <span class="fu">unit</span>(<span class="fl">0.1</span>, <span class="st">&quot;cm&quot;</span>)</span>
<span id="cb4-83"><a href="data-overview.html#cb4-83" tabindex="-1"></a>        , <span class="at">pad_y =</span> <span class="fu">unit</span>(<span class="fl">0.1</span>, <span class="st">&quot;cm&quot;</span>)</span>
<span id="cb4-84"><a href="data-overview.html#cb4-84" tabindex="-1"></a>      )</span>
<span id="cb4-85"><a href="data-overview.html#cb4-85" tabindex="-1"></a>  }</span>
<span id="cb4-86"><a href="data-overview.html#cb4-86" tabindex="-1"></a>  <span class="fu">return</span>(plt_basemap)</span>
<span id="cb4-87"><a href="data-overview.html#cb4-87" tabindex="-1"></a>}</span></code></pre></div>
<p>plot the fancy basemap with the points</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="data-overview.html#cb5-1" tabindex="-1"></a><span class="co"># get the basemap with our my_ggmap_basemap()</span></span>
<span id="cb5-2"><a href="data-overview.html#cb5-2" tabindex="-1"></a>plt_basemap <span class="ot">&lt;-</span> <span class="fu">my_ggmap_basemap</span>(</span>
<span id="cb5-3"><a href="data-overview.html#cb5-3" tabindex="-1"></a>  <span class="at">sf_data =</span> all_stand_boundary <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">group_by</span>(site) <span class="sc">%&gt;%</span> sf<span class="sc">::</span><span class="fu">st_point_on_surface</span>()</span>
<span id="cb5-4"><a href="data-overview.html#cb5-4" tabindex="-1"></a>  , <span class="at">buffer_box =</span> <span class="dv">190000</span></span>
<span id="cb5-5"><a href="data-overview.html#cb5-5" tabindex="-1"></a>  , <span class="at">zoom_level =</span> <span class="dv">7</span></span>
<span id="cb5-6"><a href="data-overview.html#cb5-6" tabindex="-1"></a>  , <span class="at">my_maptype =</span> <span class="st">&quot;stamen_terrain&quot;</span></span>
<span id="cb5-7"><a href="data-overview.html#cb5-7" tabindex="-1"></a>)</span>
<span id="cb5-8"><a href="data-overview.html#cb5-8" tabindex="-1"></a><span class="co"># plt_basemap</span></span>
<span id="cb5-9"><a href="data-overview.html#cb5-9" tabindex="-1"></a><span class="co"># plot</span></span>
<span id="cb5-10"><a href="data-overview.html#cb5-10" tabindex="-1"></a>plt2_temp <span class="ot">&lt;-</span> </span>
<span id="cb5-11"><a href="data-overview.html#cb5-11" tabindex="-1"></a>  plt_basemap <span class="sc">+</span> </span>
<span id="cb5-12"><a href="data-overview.html#cb5-12" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">geom_sf</span>(</span>
<span id="cb5-13"><a href="data-overview.html#cb5-13" tabindex="-1"></a>      <span class="at">data =</span> all_stand_boundary <span class="sc">%&gt;%</span> </span>
<span id="cb5-14"><a href="data-overview.html#cb5-14" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">group_by</span>(site) <span class="sc">%&gt;%</span> </span>
<span id="cb5-15"><a href="data-overview.html#cb5-15" tabindex="-1"></a>        sf<span class="sc">::</span><span class="fu">st_point_on_surface</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb5-16"><a href="data-overview.html#cb5-16" tabindex="-1"></a>        sf<span class="sc">::</span><span class="fu">st_transform</span>(<span class="at">crs=</span>plt_crs)</span>
<span id="cb5-17"><a href="data-overview.html#cb5-17" tabindex="-1"></a>      , <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">fill =</span> site)</span>
<span id="cb5-18"><a href="data-overview.html#cb5-18" tabindex="-1"></a>      , <span class="at">size =</span> <span class="fl">4.5</span></span>
<span id="cb5-19"><a href="data-overview.html#cb5-19" tabindex="-1"></a>      , <span class="at">inherit.aes =</span> F</span>
<span id="cb5-20"><a href="data-overview.html#cb5-20" tabindex="-1"></a>      , <span class="at">shape =</span> <span class="dv">21</span></span>
<span id="cb5-21"><a href="data-overview.html#cb5-21" tabindex="-1"></a>      , <span class="at">color =</span> <span class="st">&quot;gray88&quot;</span></span>
<span id="cb5-22"><a href="data-overview.html#cb5-22" tabindex="-1"></a>      , <span class="at">fill =</span> <span class="st">&quot;blue2&quot;</span></span>
<span id="cb5-23"><a href="data-overview.html#cb5-23" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb5-24"><a href="data-overview.html#cb5-24" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">geom_sf_label</span>(</span>
<span id="cb5-25"><a href="data-overview.html#cb5-25" tabindex="-1"></a>      <span class="at">data =</span> all_stand_boundary <span class="sc">%&gt;%</span> </span>
<span id="cb5-26"><a href="data-overview.html#cb5-26" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">group_by</span>(site) <span class="sc">%&gt;%</span> </span>
<span id="cb5-27"><a href="data-overview.html#cb5-27" tabindex="-1"></a>        sf<span class="sc">::</span><span class="fu">st_point_on_surface</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb5-28"><a href="data-overview.html#cb5-28" tabindex="-1"></a>        sf<span class="sc">::</span><span class="fu">st_transform</span>(<span class="at">crs=</span>plt_crs)</span>
<span id="cb5-29"><a href="data-overview.html#cb5-29" tabindex="-1"></a>      , <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">label =</span> stringr<span class="sc">::</span><span class="fu">str_wrap</span>(site, <span class="at">width =</span> <span class="dv">40</span>))</span>
<span id="cb5-30"><a href="data-overview.html#cb5-30" tabindex="-1"></a>      , <span class="at">size =</span> <span class="fl">2.5</span></span>
<span id="cb5-31"><a href="data-overview.html#cb5-31" tabindex="-1"></a>      , <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">0.055</span></span>
<span id="cb5-32"><a href="data-overview.html#cb5-32" tabindex="-1"></a>      , <span class="at">vjust =</span> <span class="fl">0.4</span></span>
<span id="cb5-33"><a href="data-overview.html#cb5-33" tabindex="-1"></a>      , <span class="at">inherit.aes =</span> F</span>
<span id="cb5-34"><a href="data-overview.html#cb5-34" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb5-35"><a href="data-overview.html#cb5-35" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">scale_fill_manual</span>(<span class="at">values =</span> sites_pal)</span>
<span id="cb5-36"><a href="data-overview.html#cb5-36" tabindex="-1"></a>plt2_temp</span></code></pre></div>
<p><img src="slash_pile_detecting_files/figure-html/unnamed-chunk-8-1.png" width="720" /></p>
<p>what is the area of the treatment unit boundaries we are looking over?</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="data-overview.html#cb6-1" tabindex="-1"></a>all_stand_boundary <span class="sc">%&gt;%</span> </span>
<span id="cb6-2"><a href="data-overview.html#cb6-2" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb6-3"><a href="data-overview.html#cb6-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(site, site_area_ha) <span class="sc">%&gt;%</span> </span>
<span id="cb6-4"><a href="data-overview.html#cb6-4" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb6-5"><a href="data-overview.html#cb6-5" tabindex="-1"></a>    <span class="at">site_area_ha =</span> scales<span class="sc">::</span><span class="fu">comma</span>(site_area_ha, <span class="at">suffix =</span> <span class="st">&quot; ha&quot;</span>, <span class="at">accuracy =</span> <span class="fl">0.1</span>)</span>
<span id="cb6-6"><a href="data-overview.html#cb6-6" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb6-7"><a href="data-overview.html#cb6-7" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kbl</span>(</span>
<span id="cb6-8"><a href="data-overview.html#cb6-8" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">&quot;Study site area&quot;</span></span>
<span id="cb6-9"><a href="data-overview.html#cb6-9" tabindex="-1"></a>    , <span class="at">col.names =</span> <span class="fu">c</span>(</span>
<span id="cb6-10"><a href="data-overview.html#cb6-10" tabindex="-1"></a>      <span class="st">&quot;site&quot;</span>, <span class="st">&quot;hectares&quot;</span></span>
<span id="cb6-11"><a href="data-overview.html#cb6-11" tabindex="-1"></a>    )</span>
<span id="cb6-12"><a href="data-overview.html#cb6-12" tabindex="-1"></a>    , <span class="at">escape =</span> F</span>
<span id="cb6-13"><a href="data-overview.html#cb6-13" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb6-14"><a href="data-overview.html#cb6-14" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kable_styling</span>()</span></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-10">Table 2.1: </span>Study site area
</caption>
<thead>
<tr>
<th style="text-align:left;">
site
</th>
<th style="text-align:left;">
hectares
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
ARNF Ponderosa Pine Site
</td>
<td style="text-align:left;">
73.6 ha
</td>
</tr>
<tr>
<td style="text-align:left;">
BHEF Ponderosa Pine Site
</td>
<td style="text-align:left;">
103.1 ha
</td>
</tr>
<tr>
<td style="text-align:left;">
PSINF Mixed Conifer Site
</td>
<td style="text-align:left;">
17.5 ha
</td>
</tr>
<tr>
<td style="text-align:left;">
TRFO-BLM Pinyon-Juniper Site
</td>
<td style="text-align:left;">
5.2 ha
</td>
</tr>
</tbody>
</table>
</div>
<div id="slash-pile-vector-data" class="section level2 hasAnchor" number="2.2">
<h2><span class="header-section-number">2.2</span> Slash Pile Vector Data<a href="data-overview.html#slash-pile-vector-data" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Image-annotated pile footprints at each study site were created in a GIS by outlining pile boundaries on the RGB orthomosaic and confirming the vertical structure using fine-resolution CHM data (e.g., 0.15m resolution). Field-collected points were used to ensure pile census completeness at the hand-pile study sites (PSINF Mixed Conifer Site and TRFO-BLM Pinyon-Juniper Site) to pinpoint piles that were otherwise challenging to delineate from the aerial imagery and CHM data alone. Across all sites, machine piles were easily distinguishable using the RGB and CHM data.</p>
<p>Let’s load in those image-annotated pile polygons now for each study site.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="data-overview.html#cb7-1" tabindex="-1"></a><span class="do">#######################################</span></span>
<span id="cb7-2"><a href="data-overview.html#cb7-2" tabindex="-1"></a><span class="co"># polygons annotated using RGB and field-collected points</span></span>
<span id="cb7-3"><a href="data-overview.html#cb7-3" tabindex="-1"></a><span class="do">#######################################</span></span>
<span id="cb7-4"><a href="data-overview.html#cb7-4" tabindex="-1"></a><span class="do">###########################</span></span>
<span id="cb7-5"><a href="data-overview.html#cb7-5" tabindex="-1"></a><span class="co"># PSINF Mixed Conifer Site</span></span>
<span id="cb7-6"><a href="data-overview.html#cb7-6" tabindex="-1"></a><span class="do">###########################</span></span>
<span id="cb7-7"><a href="data-overview.html#cb7-7" tabindex="-1"></a>  psinf_slash_piles_polys <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_read</span>(</span>
<span id="cb7-8"><a href="data-overview.html#cb7-8" tabindex="-1"></a>      <span class="st">&quot;../data/PFDP_Data/PFDP_SlashPiles/manitou_pile_polys.shp&quot;</span></span>
<span id="cb7-9"><a href="data-overview.html#cb7-9" tabindex="-1"></a>      , <span class="at">quiet =</span> T</span>
<span id="cb7-10"><a href="data-overview.html#cb7-10" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb7-11"><a href="data-overview.html#cb7-11" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">rename_with</span>(tolower) <span class="sc">%&gt;%</span> </span>
<span id="cb7-12"><a href="data-overview.html#cb7-12" tabindex="-1"></a>    sf<span class="sc">::</span><span class="fu">st_make_valid</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb7-13"><a href="data-overview.html#cb7-13" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(sf<span class="sc">::</span><span class="fu">st_is_valid</span>(.)) <span class="sc">%&gt;%</span> </span>
<span id="cb7-14"><a href="data-overview.html#cb7-14" tabindex="-1"></a>    <span class="co"># fix multipolygons</span></span>
<span id="cb7-15"><a href="data-overview.html#cb7-15" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb7-16"><a href="data-overview.html#cb7-16" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">treeID =</span> dplyr<span class="sc">::</span><span class="fu">row_number</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb7-17"><a href="data-overview.html#cb7-17" tabindex="-1"></a>    cloud2trees<span class="sc">::</span><span class="fu">simplify_multipolygon_crowns</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb7-18"><a href="data-overview.html#cb7-18" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(treeID, shape_leng, shape_area)) <span class="sc">%&gt;%</span> </span>
<span id="cb7-19"><a href="data-overview.html#cb7-19" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">site =</span> <span class="st">&quot;PSINF Mixed Conifer Site&quot;</span>)</span>
<span id="cb7-20"><a href="data-overview.html#cb7-20" tabindex="-1"></a>  </span>
<span id="cb7-21"><a href="data-overview.html#cb7-21" tabindex="-1"></a>  <span class="co"># points recorded in field</span></span>
<span id="cb7-22"><a href="data-overview.html#cb7-22" tabindex="-1"></a>  psinf_slash_piles_points <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_read</span>(</span>
<span id="cb7-23"><a href="data-overview.html#cb7-23" tabindex="-1"></a>      <span class="st">&quot;../data/PFDP_Data/PFDP_SlashPiles/SlashPiles.shp&quot;</span></span>
<span id="cb7-24"><a href="data-overview.html#cb7-24" tabindex="-1"></a>      , <span class="at">quiet =</span> T</span>
<span id="cb7-25"><a href="data-overview.html#cb7-25" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb7-26"><a href="data-overview.html#cb7-26" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">rename_with</span>(tolower) <span class="sc">%&gt;%</span> </span>
<span id="cb7-27"><a href="data-overview.html#cb7-27" tabindex="-1"></a>    sf<span class="sc">::</span><span class="fu">st_zm</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb7-28"><a href="data-overview.html#cb7-28" tabindex="-1"></a>    sf<span class="sc">::</span><span class="fu">st_transform</span>(sf<span class="sc">::</span><span class="fu">st_crs</span>(psinf_slash_piles_polys)) <span class="sc">%&gt;%</span> </span>
<span id="cb7-29"><a href="data-overview.html#cb7-29" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>( <span class="sc">!</span>(objectid <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">43</span>)) ) <span class="sc">%&gt;%</span> <span class="co"># duplicate field points</span></span>
<span id="cb7-30"><a href="data-overview.html#cb7-30" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">row_number =</span> dplyr<span class="sc">::</span><span class="fu">row_number</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb7-31"><a href="data-overview.html#cb7-31" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(objectid)) <span class="sc">%&gt;%</span> </span>
<span id="cb7-32"><a href="data-overview.html#cb7-32" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">rename</span>(</span>
<span id="cb7-33"><a href="data-overview.html#cb7-33" tabindex="-1"></a>      <span class="at">height_ft =</span> height</span>
<span id="cb7-34"><a href="data-overview.html#cb7-34" tabindex="-1"></a>      , <span class="at">diameter_ft =</span> diameter</span>
<span id="cb7-35"><a href="data-overview.html#cb7-35" tabindex="-1"></a>    )</span>
<span id="cb7-36"><a href="data-overview.html#cb7-36" tabindex="-1"></a>  <span class="co"># update unit boundary to pile proj</span></span>
<span id="cb7-37"><a href="data-overview.html#cb7-37" tabindex="-1"></a>  psinf_stand_boundary <span class="ot">&lt;-</span> psinf_stand_boundary <span class="sc">%&gt;%</span> sf<span class="sc">::</span><span class="fu">st_transform</span>(sf<span class="sc">::</span><span class="fu">st_crs</span>(psinf_slash_piles_polys))</span>
<span id="cb7-38"><a href="data-overview.html#cb7-38" tabindex="-1"></a>  </span>
<span id="cb7-39"><a href="data-overview.html#cb7-39" tabindex="-1"></a>  <span class="co"># attach flag for spatial overlap with unit boundary</span></span>
<span id="cb7-40"><a href="data-overview.html#cb7-40" tabindex="-1"></a>  psinf_slash_piles_polys <span class="ot">&lt;-</span> psinf_slash_piles_polys <span class="sc">%&gt;%</span></span>
<span id="cb7-41"><a href="data-overview.html#cb7-41" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">left_join</span>(</span>
<span id="cb7-42"><a href="data-overview.html#cb7-42" tabindex="-1"></a>      psinf_slash_piles_polys <span class="sc">%&gt;%</span> </span>
<span id="cb7-43"><a href="data-overview.html#cb7-43" tabindex="-1"></a>        sf<span class="sc">::</span><span class="fu">st_intersection</span>(psinf_stand_boundary) <span class="sc">%&gt;%</span> </span>
<span id="cb7-44"><a href="data-overview.html#cb7-44" tabindex="-1"></a>        sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb7-45"><a href="data-overview.html#cb7-45" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">select</span>(pile_id) <span class="sc">%&gt;%</span> </span>
<span id="cb7-46"><a href="data-overview.html#cb7-46" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">is_in_stand =</span> T)</span>
<span id="cb7-47"><a href="data-overview.html#cb7-47" tabindex="-1"></a>      , <span class="at">by =</span> <span class="st">&quot;pile_id&quot;</span></span>
<span id="cb7-48"><a href="data-overview.html#cb7-48" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb7-49"><a href="data-overview.html#cb7-49" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb7-50"><a href="data-overview.html#cb7-50" tabindex="-1"></a>      <span class="at">is_in_stand =</span> dplyr<span class="sc">::</span><span class="fu">coalesce</span>(is_in_stand, F)</span>
<span id="cb7-51"><a href="data-overview.html#cb7-51" tabindex="-1"></a>    )</span>
<span id="cb7-52"><a href="data-overview.html#cb7-52" tabindex="-1"></a><span class="do">###########################</span></span>
<span id="cb7-53"><a href="data-overview.html#cb7-53" tabindex="-1"></a><span class="co"># TRFO-BLM Pinyon-Juniper Site</span></span>
<span id="cb7-54"><a href="data-overview.html#cb7-54" tabindex="-1"></a><span class="do">###########################</span></span>
<span id="cb7-55"><a href="data-overview.html#cb7-55" tabindex="-1"></a>  pj_slash_piles_polys <span class="ot">&lt;-</span> </span>
<span id="cb7-56"><a href="data-overview.html#cb7-56" tabindex="-1"></a>    sf<span class="sc">::</span><span class="fu">st_read</span>(<span class="st">&quot;../data/Dawson_Data/piles/pj_pile_polys.shp&quot;</span>, <span class="at">quiet=</span>T) <span class="sc">%&gt;%</span> </span>
<span id="cb7-57"><a href="data-overview.html#cb7-57" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">rename_with</span>(tolower) <span class="sc">%&gt;%</span> </span>
<span id="cb7-58"><a href="data-overview.html#cb7-58" tabindex="-1"></a>    sf<span class="sc">::</span><span class="fu">st_make_valid</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb7-59"><a href="data-overview.html#cb7-59" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(sf<span class="sc">::</span><span class="fu">st_is_valid</span>(.)) <span class="sc">%&gt;%</span> </span>
<span id="cb7-60"><a href="data-overview.html#cb7-60" tabindex="-1"></a>    <span class="co"># fix multipolygons</span></span>
<span id="cb7-61"><a href="data-overview.html#cb7-61" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb7-62"><a href="data-overview.html#cb7-62" tabindex="-1"></a>      <span class="at">pile_id =</span> dplyr<span class="sc">::</span><span class="fu">row_number</span>()</span>
<span id="cb7-63"><a href="data-overview.html#cb7-63" tabindex="-1"></a>      , <span class="at">treeID =</span> dplyr<span class="sc">::</span><span class="fu">row_number</span>()</span>
<span id="cb7-64"><a href="data-overview.html#cb7-64" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb7-65"><a href="data-overview.html#cb7-65" tabindex="-1"></a>    cloud2trees<span class="sc">::</span><span class="fu">simplify_multipolygon_crowns</span>() <span class="sc">%&gt;%</span></span>
<span id="cb7-66"><a href="data-overview.html#cb7-66" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(treeID,id)) <span class="sc">%&gt;%</span> </span>
<span id="cb7-67"><a href="data-overview.html#cb7-67" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(pile_id<span class="sc">!=</span><span class="dv">62</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb7-68"><a href="data-overview.html#cb7-68" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">site =</span> <span class="st">&quot;TRFO-BLM Pinyon-Juniper Site&quot;</span>)</span>
<span id="cb7-69"><a href="data-overview.html#cb7-69" tabindex="-1"></a>  </span>
<span id="cb7-70"><a href="data-overview.html#cb7-70" tabindex="-1"></a>  <span class="co"># points recorded in field</span></span>
<span id="cb7-71"><a href="data-overview.html#cb7-71" tabindex="-1"></a>  <span class="co"># these piles were collected twice in the same location and have different measurements :\</span></span>
<span id="cb7-72"><a href="data-overview.html#cb7-72" tabindex="-1"></a>  bad_pile_ids_temp <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb7-73"><a href="data-overview.html#cb7-73" tabindex="-1"></a>    <span class="dv">142</span></span>
<span id="cb7-74"><a href="data-overview.html#cb7-74" tabindex="-1"></a>    , <span class="dv">146</span></span>
<span id="cb7-75"><a href="data-overview.html#cb7-75" tabindex="-1"></a>    , <span class="dv">99</span></span>
<span id="cb7-76"><a href="data-overview.html#cb7-76" tabindex="-1"></a>    , <span class="dv">96</span></span>
<span id="cb7-77"><a href="data-overview.html#cb7-77" tabindex="-1"></a>    , <span class="dv">50</span></span>
<span id="cb7-78"><a href="data-overview.html#cb7-78" tabindex="-1"></a>  )</span>
<span id="cb7-79"><a href="data-overview.html#cb7-79" tabindex="-1"></a>  pj_slash_piles_points <span class="ot">&lt;-</span> </span>
<span id="cb7-80"><a href="data-overview.html#cb7-80" tabindex="-1"></a>    readr<span class="sc">::</span><span class="fu">read_csv</span>(<span class="st">&quot;../data/Dawson_data/PJ_Piles_Unit_10.csv&quot;</span>, <span class="at">progress =</span> T, <span class="at">show_col_types =</span> F) <span class="sc">%&gt;%</span> </span>
<span id="cb7-81"><a href="data-overview.html#cb7-81" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">rename_with</span>(tolower) <span class="sc">%&gt;%</span> </span>
<span id="cb7-82"><a href="data-overview.html#cb7-82" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">rename_with</span>(stringr<span class="sc">::</span>str_squish) <span class="sc">%&gt;%</span> </span>
<span id="cb7-83"><a href="data-overview.html#cb7-83" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">rename_with</span>(make.names) <span class="sc">%&gt;%</span> </span>
<span id="cb7-84"><a href="data-overview.html#cb7-84" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">rename_with</span>(<span class="sc">~</span>stringr<span class="sc">::</span><span class="fu">str_replace_all</span>(.x, <span class="st">&quot;</span><span class="sc">\\</span><span class="st">.{2,}&quot;</span>, <span class="st">&quot;.&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb7-85"><a href="data-overview.html#cb7-85" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">rename_with</span>(<span class="sc">~</span>stringr<span class="sc">::</span><span class="fu">str_remove</span>(.x, <span class="st">&quot;</span><span class="sc">\\</span><span class="st">.$&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb7-86"><a href="data-overview.html#cb7-86" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">rename_with</span>(<span class="sc">~</span>stringr<span class="sc">::</span><span class="fu">str_replace_all</span>(.x, <span class="st">&quot;</span><span class="sc">\\</span><span class="st">.&quot;</span>, <span class="st">&quot;_&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb7-87"><a href="data-overview.html#cb7-87" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb7-88"><a href="data-overview.html#cb7-88" tabindex="-1"></a>      <span class="at">orig_pile_id =</span> readr<span class="sc">::</span><span class="fu">parse_number</span>(name)</span>
<span id="cb7-89"><a href="data-overview.html#cb7-89" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb7-90"><a href="data-overview.html#cb7-90" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(</span>
<span id="cb7-91"><a href="data-overview.html#cb7-91" tabindex="-1"></a>      <span class="sc">!</span>(orig_pile_id <span class="sc">%in%</span> bad_pile_ids_temp)</span>
<span id="cb7-92"><a href="data-overview.html#cb7-92" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb7-93"><a href="data-overview.html#cb7-93" tabindex="-1"></a>    sf<span class="sc">::</span><span class="fu">st_as_sf</span>(<span class="at">coords =</span> <span class="fu">c</span>(<span class="st">&quot;easting&quot;</span>,<span class="st">&quot;northing&quot;</span>), <span class="at">crs =</span> <span class="dv">6342</span>, <span class="at">remove =</span> F) <span class="sc">%&gt;%</span> </span>
<span id="cb7-94"><a href="data-overview.html#cb7-94" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(orig_pile_id,name,height_m,width_m,easting,northing,latitude,longitude,code,description,elevation) <span class="sc">%&gt;%</span> </span>
<span id="cb7-95"><a href="data-overview.html#cb7-95" tabindex="-1"></a>    sf<span class="sc">::</span><span class="fu">st_make_valid</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb7-96"><a href="data-overview.html#cb7-96" tabindex="-1"></a>    sf<span class="sc">::</span><span class="fu">st_transform</span>(sf<span class="sc">::</span><span class="fu">st_crs</span>(pj_slash_piles_polys))</span></code></pre></div>
<pre><code>## indexing PJ_Piles_Unit_10.csv [=============================] 1.21GB/s, eta:  0s                                                                                </code></pre>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="data-overview.html#cb9-1" tabindex="-1"></a>  <span class="co"># update unit boundary to pile proj</span></span>
<span id="cb9-2"><a href="data-overview.html#cb9-2" tabindex="-1"></a>  pj_stand_boundary <span class="ot">&lt;-</span> pj_stand_boundary <span class="sc">%&gt;%</span> sf<span class="sc">::</span><span class="fu">st_transform</span>(sf<span class="sc">::</span><span class="fu">st_crs</span>(pj_slash_piles_polys))</span>
<span id="cb9-3"><a href="data-overview.html#cb9-3" tabindex="-1"></a>  </span>
<span id="cb9-4"><a href="data-overview.html#cb9-4" tabindex="-1"></a>  <span class="co"># attach flag for spatial overlap with unit boundary</span></span>
<span id="cb9-5"><a href="data-overview.html#cb9-5" tabindex="-1"></a>  pj_slash_piles_polys <span class="ot">&lt;-</span> pj_slash_piles_polys <span class="sc">%&gt;%</span></span>
<span id="cb9-6"><a href="data-overview.html#cb9-6" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">left_join</span>(</span>
<span id="cb9-7"><a href="data-overview.html#cb9-7" tabindex="-1"></a>      pj_slash_piles_polys <span class="sc">%&gt;%</span> </span>
<span id="cb9-8"><a href="data-overview.html#cb9-8" tabindex="-1"></a>        sf<span class="sc">::</span><span class="fu">st_intersection</span>(pj_stand_boundary) <span class="sc">%&gt;%</span> </span>
<span id="cb9-9"><a href="data-overview.html#cb9-9" tabindex="-1"></a>        sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb9-10"><a href="data-overview.html#cb9-10" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">select</span>(pile_id) <span class="sc">%&gt;%</span> </span>
<span id="cb9-11"><a href="data-overview.html#cb9-11" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">is_in_stand =</span> T)</span>
<span id="cb9-12"><a href="data-overview.html#cb9-12" tabindex="-1"></a>      , <span class="at">by =</span> <span class="st">&quot;pile_id&quot;</span></span>
<span id="cb9-13"><a href="data-overview.html#cb9-13" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb9-14"><a href="data-overview.html#cb9-14" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb9-15"><a href="data-overview.html#cb9-15" tabindex="-1"></a>      <span class="at">is_in_stand =</span> dplyr<span class="sc">::</span><span class="fu">coalesce</span>(is_in_stand, F)</span>
<span id="cb9-16"><a href="data-overview.html#cb9-16" tabindex="-1"></a>    )</span>
<span id="cb9-17"><a href="data-overview.html#cb9-17" tabindex="-1"></a><span class="do">###########################  </span></span>
<span id="cb9-18"><a href="data-overview.html#cb9-18" tabindex="-1"></a><span class="co"># BHEF Ponderosa Pine Site</span></span>
<span id="cb9-19"><a href="data-overview.html#cb9-19" tabindex="-1"></a><span class="do">###########################  </span></span>
<span id="cb9-20"><a href="data-overview.html#cb9-20" tabindex="-1"></a>  bhef_slash_piles_polys <span class="ot">&lt;-</span> </span>
<span id="cb9-21"><a href="data-overview.html#cb9-21" tabindex="-1"></a>    sf<span class="sc">::</span><span class="fu">st_read</span>(<span class="st">&quot;../data/BHEF_202306/piles/bhef_pile_polys.shp&quot;</span>, <span class="at">quiet=</span>T) <span class="sc">%&gt;%</span> </span>
<span id="cb9-22"><a href="data-overview.html#cb9-22" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">rename_with</span>(tolower) <span class="sc">%&gt;%</span> </span>
<span id="cb9-23"><a href="data-overview.html#cb9-23" tabindex="-1"></a>    sf<span class="sc">::</span><span class="fu">st_make_valid</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb9-24"><a href="data-overview.html#cb9-24" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(sf<span class="sc">::</span><span class="fu">st_is_valid</span>(.)) <span class="sc">%&gt;%</span> </span>
<span id="cb9-25"><a href="data-overview.html#cb9-25" tabindex="-1"></a>    <span class="co"># fix multipolygons</span></span>
<span id="cb9-26"><a href="data-overview.html#cb9-26" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb9-27"><a href="data-overview.html#cb9-27" tabindex="-1"></a>      <span class="at">pile_id =</span> dplyr<span class="sc">::</span><span class="fu">row_number</span>()</span>
<span id="cb9-28"><a href="data-overview.html#cb9-28" tabindex="-1"></a>      , <span class="at">treeID =</span> dplyr<span class="sc">::</span><span class="fu">row_number</span>()</span>
<span id="cb9-29"><a href="data-overview.html#cb9-29" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb9-30"><a href="data-overview.html#cb9-30" tabindex="-1"></a>    cloud2trees<span class="sc">::</span><span class="fu">simplify_multipolygon_crowns</span>() <span class="sc">%&gt;%</span></span>
<span id="cb9-31"><a href="data-overview.html#cb9-31" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(treeID)) <span class="sc">%&gt;%</span> </span>
<span id="cb9-32"><a href="data-overview.html#cb9-32" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">site =</span> <span class="st">&quot;BHEF Ponderosa Pine Site&quot;</span>)</span>
<span id="cb9-33"><a href="data-overview.html#cb9-33" tabindex="-1"></a>  </span>
<span id="cb9-34"><a href="data-overview.html#cb9-34" tabindex="-1"></a>  <span class="co"># update unit boundary to pile proj</span></span>
<span id="cb9-35"><a href="data-overview.html#cb9-35" tabindex="-1"></a>  bhef_stand_boundary <span class="ot">&lt;-</span> bhef_stand_boundary <span class="sc">%&gt;%</span> sf<span class="sc">::</span><span class="fu">st_transform</span>(sf<span class="sc">::</span><span class="fu">st_crs</span>(bhef_slash_piles_polys))</span>
<span id="cb9-36"><a href="data-overview.html#cb9-36" tabindex="-1"></a>  </span>
<span id="cb9-37"><a href="data-overview.html#cb9-37" tabindex="-1"></a>  <span class="co"># attach flag for spatial overlap with unit boundary</span></span>
<span id="cb9-38"><a href="data-overview.html#cb9-38" tabindex="-1"></a>  bhef_slash_piles_polys <span class="ot">&lt;-</span> bhef_slash_piles_polys <span class="sc">%&gt;%</span></span>
<span id="cb9-39"><a href="data-overview.html#cb9-39" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">left_join</span>(</span>
<span id="cb9-40"><a href="data-overview.html#cb9-40" tabindex="-1"></a>      bhef_slash_piles_polys <span class="sc">%&gt;%</span> </span>
<span id="cb9-41"><a href="data-overview.html#cb9-41" tabindex="-1"></a>        sf<span class="sc">::</span><span class="fu">st_intersection</span>(bhef_stand_boundary) <span class="sc">%&gt;%</span> </span>
<span id="cb9-42"><a href="data-overview.html#cb9-42" tabindex="-1"></a>        sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb9-43"><a href="data-overview.html#cb9-43" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">select</span>(pile_id) <span class="sc">%&gt;%</span> </span>
<span id="cb9-44"><a href="data-overview.html#cb9-44" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">is_in_stand =</span> T)</span>
<span id="cb9-45"><a href="data-overview.html#cb9-45" tabindex="-1"></a>      , <span class="at">by =</span> <span class="st">&quot;pile_id&quot;</span></span>
<span id="cb9-46"><a href="data-overview.html#cb9-46" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb9-47"><a href="data-overview.html#cb9-47" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb9-48"><a href="data-overview.html#cb9-48" tabindex="-1"></a>      <span class="at">is_in_stand =</span> dplyr<span class="sc">::</span><span class="fu">coalesce</span>(is_in_stand, F)</span>
<span id="cb9-49"><a href="data-overview.html#cb9-49" tabindex="-1"></a>    )</span>
<span id="cb9-50"><a href="data-overview.html#cb9-50" tabindex="-1"></a><span class="do">###########################  </span></span>
<span id="cb9-51"><a href="data-overview.html#cb9-51" tabindex="-1"></a><span class="co"># ARNF Ponderosa Pine Site</span></span>
<span id="cb9-52"><a href="data-overview.html#cb9-52" tabindex="-1"></a><span class="do">###########################  </span></span>
<span id="cb9-53"><a href="data-overview.html#cb9-53" tabindex="-1"></a>  arnf_slash_piles_polys <span class="ot">&lt;-</span> </span>
<span id="cb9-54"><a href="data-overview.html#cb9-54" tabindex="-1"></a>    sf<span class="sc">::</span><span class="fu">st_read</span>(<span class="st">&quot;../data/ARNF_DiamondView_202510/arnf_diamond_view_pile_polys.shp&quot;</span>, <span class="at">quiet=</span>T) <span class="sc">%&gt;%</span> </span>
<span id="cb9-55"><a href="data-overview.html#cb9-55" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">rename_with</span>(tolower) <span class="sc">%&gt;%</span> </span>
<span id="cb9-56"><a href="data-overview.html#cb9-56" tabindex="-1"></a>    sf<span class="sc">::</span><span class="fu">st_make_valid</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb9-57"><a href="data-overview.html#cb9-57" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(sf<span class="sc">::</span><span class="fu">st_is_valid</span>(.)) <span class="sc">%&gt;%</span> </span>
<span id="cb9-58"><a href="data-overview.html#cb9-58" tabindex="-1"></a>    <span class="co"># fix multipolygons</span></span>
<span id="cb9-59"><a href="data-overview.html#cb9-59" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb9-60"><a href="data-overview.html#cb9-60" tabindex="-1"></a>      <span class="at">pile_id =</span> dplyr<span class="sc">::</span><span class="fu">row_number</span>()</span>
<span id="cb9-61"><a href="data-overview.html#cb9-61" tabindex="-1"></a>      , <span class="at">treeID =</span> dplyr<span class="sc">::</span><span class="fu">row_number</span>()</span>
<span id="cb9-62"><a href="data-overview.html#cb9-62" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb9-63"><a href="data-overview.html#cb9-63" tabindex="-1"></a>    cloud2trees<span class="sc">::</span><span class="fu">simplify_multipolygon_crowns</span>() <span class="sc">%&gt;%</span></span>
<span id="cb9-64"><a href="data-overview.html#cb9-64" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(treeID)) <span class="sc">%&gt;%</span> </span>
<span id="cb9-65"><a href="data-overview.html#cb9-65" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">site =</span> <span class="st">&quot;ARNF Ponderosa Pine Site&quot;</span>)</span>
<span id="cb9-66"><a href="data-overview.html#cb9-66" tabindex="-1"></a>  </span>
<span id="cb9-67"><a href="data-overview.html#cb9-67" tabindex="-1"></a>  <span class="co"># update unit boundary to pile proj</span></span>
<span id="cb9-68"><a href="data-overview.html#cb9-68" tabindex="-1"></a>  arnf_stand_boundary <span class="ot">&lt;-</span> arnf_stand_boundary <span class="sc">%&gt;%</span> sf<span class="sc">::</span><span class="fu">st_transform</span>(sf<span class="sc">::</span><span class="fu">st_crs</span>(arnf_slash_piles_polys))</span>
<span id="cb9-69"><a href="data-overview.html#cb9-69" tabindex="-1"></a>  </span>
<span id="cb9-70"><a href="data-overview.html#cb9-70" tabindex="-1"></a>  <span class="co"># attach flag for spatial overlap with unit boundary</span></span>
<span id="cb9-71"><a href="data-overview.html#cb9-71" tabindex="-1"></a>  arnf_slash_piles_polys <span class="ot">&lt;-</span> arnf_slash_piles_polys <span class="sc">%&gt;%</span></span>
<span id="cb9-72"><a href="data-overview.html#cb9-72" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">left_join</span>(</span>
<span id="cb9-73"><a href="data-overview.html#cb9-73" tabindex="-1"></a>      arnf_slash_piles_polys <span class="sc">%&gt;%</span> </span>
<span id="cb9-74"><a href="data-overview.html#cb9-74" tabindex="-1"></a>        sf<span class="sc">::</span><span class="fu">st_intersection</span>(arnf_stand_boundary) <span class="sc">%&gt;%</span> </span>
<span id="cb9-75"><a href="data-overview.html#cb9-75" tabindex="-1"></a>        sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb9-76"><a href="data-overview.html#cb9-76" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">select</span>(pile_id) <span class="sc">%&gt;%</span> </span>
<span id="cb9-77"><a href="data-overview.html#cb9-77" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">is_in_stand =</span> T)</span>
<span id="cb9-78"><a href="data-overview.html#cb9-78" tabindex="-1"></a>      , <span class="at">by =</span> <span class="st">&quot;pile_id&quot;</span></span>
<span id="cb9-79"><a href="data-overview.html#cb9-79" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb9-80"><a href="data-overview.html#cb9-80" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb9-81"><a href="data-overview.html#cb9-81" tabindex="-1"></a>      <span class="at">is_in_stand =</span> dplyr<span class="sc">::</span><span class="fu">coalesce</span>(is_in_stand, F)</span>
<span id="cb9-82"><a href="data-overview.html#cb9-82" tabindex="-1"></a>    )</span></code></pre></div>
<div id="standardize-pile-data" class="section level3 hasAnchor" number="2.2.1">
<h3><span class="header-section-number">2.2.1</span> Standardize Pile Data<a href="data-overview.html#standardize-pile-data" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>For the sites with field-collected point data, each point may not necessarily fall within the polygon boundary (e.g. due to misalignment between the imagery and point locations or slight inaccuracies in either the point or pile boundaries). So, we need to perform a matching process to tie the points to the polygons so that we get the height and diameter measured during the point collection attached to the polygons. to do this, we’ll use a two-stage process that first attaches the points data frame to polygons where points fall within, using a spatial intersection. It then finds and assigns the remaining, unjoined points to their nearest polygon. The final output includes all polygons from the original data, ensuring that every polygon is represented even if no points were matched.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="data-overview.html#cb10-1" tabindex="-1"></a><span class="co"># function to perform a two-step spatial join</span></span>
<span id="cb10-2"><a href="data-overview.html#cb10-2" tabindex="-1"></a>  <span class="co"># first matching points that fall inside polygons and </span></span>
<span id="cb10-3"><a href="data-overview.html#cb10-3" tabindex="-1"></a>  <span class="co"># then assigning the remaining points to the nearest polygon</span></span>
<span id="cb10-4"><a href="data-overview.html#cb10-4" tabindex="-1"></a>  <span class="co"># all original polygons are returned in the final output</span></span>
<span id="cb10-5"><a href="data-overview.html#cb10-5" tabindex="-1"></a>match_points_to_polygons <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb10-6"><a href="data-overview.html#cb10-6" tabindex="-1"></a>    points_sf</span>
<span id="cb10-7"><a href="data-overview.html#cb10-7" tabindex="-1"></a>    , polygons_sf</span>
<span id="cb10-8"><a href="data-overview.html#cb10-8" tabindex="-1"></a>    , point_id</span>
<span id="cb10-9"><a href="data-overview.html#cb10-9" tabindex="-1"></a>    , polygon_id</span>
<span id="cb10-10"><a href="data-overview.html#cb10-10" tabindex="-1"></a>) {</span>
<span id="cb10-11"><a href="data-overview.html#cb10-11" tabindex="-1"></a>  </span>
<span id="cb10-12"><a href="data-overview.html#cb10-12" tabindex="-1"></a>  <span class="co"># check if point_id column exists in points_sf</span></span>
<span id="cb10-13"><a href="data-overview.html#cb10-13" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span>point_id <span class="sc">%in%</span> <span class="fu">names</span>(points_sf)) {</span>
<span id="cb10-14"><a href="data-overview.html#cb10-14" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="fu">paste0</span>(<span class="st">&quot;column &#39;&quot;</span>, point_id, <span class="st">&quot;&#39; not found in points_sf.&quot;</span>))</span>
<span id="cb10-15"><a href="data-overview.html#cb10-15" tabindex="-1"></a>  }</span>
<span id="cb10-16"><a href="data-overview.html#cb10-16" tabindex="-1"></a>  </span>
<span id="cb10-17"><a href="data-overview.html#cb10-17" tabindex="-1"></a>  <span class="co"># check if polygon_id column exists in polygons_sf</span></span>
<span id="cb10-18"><a href="data-overview.html#cb10-18" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span>polygon_id <span class="sc">%in%</span> <span class="fu">names</span>(polygons_sf)) {</span>
<span id="cb10-19"><a href="data-overview.html#cb10-19" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="fu">paste0</span>(<span class="st">&quot;column &#39;&quot;</span>, polygon_id, <span class="st">&quot;&#39; not found in polygons_sf.&quot;</span>))</span>
<span id="cb10-20"><a href="data-overview.html#cb10-20" tabindex="-1"></a>  }</span>
<span id="cb10-21"><a href="data-overview.html#cb10-21" tabindex="-1"></a>  </span>
<span id="cb10-22"><a href="data-overview.html#cb10-22" tabindex="-1"></a>  <span class="co"># 1. ensure the crs are the same.</span></span>
<span id="cb10-23"><a href="data-overview.html#cb10-23" tabindex="-1"></a>  <span class="cf">if</span> (sf<span class="sc">::</span><span class="fu">st_crs</span>(points_sf) <span class="sc">!=</span> sf<span class="sc">::</span><span class="fu">st_crs</span>(polygons_sf)) {</span>
<span id="cb10-24"><a href="data-overview.html#cb10-24" tabindex="-1"></a>    points_sf <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_transform</span>(points_sf, sf<span class="sc">::</span><span class="fu">st_crs</span>(polygons_sf))</span>
<span id="cb10-25"><a href="data-overview.html#cb10-25" tabindex="-1"></a>  }</span>
<span id="cb10-26"><a href="data-overview.html#cb10-26" tabindex="-1"></a>  </span>
<span id="cb10-27"><a href="data-overview.html#cb10-27" tabindex="-1"></a>  <span class="co"># 2. Perform a standard spatial join for points within polygons.</span></span>
<span id="cb10-28"><a href="data-overview.html#cb10-28" tabindex="-1"></a>  <span class="co"># Use an inner join (`left = FALSE`) to get only points that fall inside.</span></span>
<span id="cb10-29"><a href="data-overview.html#cb10-29" tabindex="-1"></a>  points_within <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_join</span>(</span>
<span id="cb10-30"><a href="data-overview.html#cb10-30" tabindex="-1"></a>    <span class="at">x =</span> points_sf</span>
<span id="cb10-31"><a href="data-overview.html#cb10-31" tabindex="-1"></a>    , <span class="at">y =</span> polygons_sf</span>
<span id="cb10-32"><a href="data-overview.html#cb10-32" tabindex="-1"></a>    , <span class="at">join =</span> sf<span class="sc">::</span>st_intersects</span>
<span id="cb10-33"><a href="data-overview.html#cb10-33" tabindex="-1"></a>    , <span class="at">left =</span> <span class="cn">FALSE</span></span>
<span id="cb10-34"><a href="data-overview.html#cb10-34" tabindex="-1"></a>  )</span>
<span id="cb10-35"><a href="data-overview.html#cb10-35" tabindex="-1"></a>  </span>
<span id="cb10-36"><a href="data-overview.html#cb10-36" tabindex="-1"></a>  <span class="co"># 3. Identify points that were not matched in the first step.</span></span>
<span id="cb10-37"><a href="data-overview.html#cb10-37" tabindex="-1"></a>  matched_points_ids <span class="ot">&lt;-</span> points_within[[point_id]]</span>
<span id="cb10-38"><a href="data-overview.html#cb10-38" tabindex="-1"></a>  unmatched_points <span class="ot">&lt;-</span> points_sf[<span class="sc">!</span>points_sf[[point_id]] <span class="sc">%in%</span> matched_points_ids, ]</span>
<span id="cb10-39"><a href="data-overview.html#cb10-39" tabindex="-1"></a>  </span>
<span id="cb10-40"><a href="data-overview.html#cb10-40" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">nrow</span>(unmatched_points) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb10-41"><a href="data-overview.html#cb10-41" tabindex="-1"></a>    <span class="co"># 4. For the remaining points, find the index of the nearest polygon.</span></span>
<span id="cb10-42"><a href="data-overview.html#cb10-42" tabindex="-1"></a>    nearest_polygon_index <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_nearest_feature</span>(unmatched_points, polygons_sf)</span>
<span id="cb10-43"><a href="data-overview.html#cb10-43" tabindex="-1"></a>    </span>
<span id="cb10-44"><a href="data-overview.html#cb10-44" tabindex="-1"></a>    <span class="co"># 5. Extract the nearest polygons and join their attributes to the unmatched points.</span></span>
<span id="cb10-45"><a href="data-overview.html#cb10-45" tabindex="-1"></a>    nearest_polygons <span class="ot">&lt;-</span> polygons_sf[nearest_polygon_index, ]</span>
<span id="cb10-46"><a href="data-overview.html#cb10-46" tabindex="-1"></a>    points_nearest <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(unmatched_points, sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>(nearest_polygons))</span>
<span id="cb10-47"><a href="data-overview.html#cb10-47" tabindex="-1"></a>    </span>
<span id="cb10-48"><a href="data-overview.html#cb10-48" tabindex="-1"></a>    <span class="co"># Preserve the geometry from the original unmatched points for the nearest matches.</span></span>
<span id="cb10-49"><a href="data-overview.html#cb10-49" tabindex="-1"></a>    points_nearest <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_set_geometry</span>(points_nearest, sf<span class="sc">::</span><span class="fu">st_geometry</span>(unmatched_points))</span>
<span id="cb10-50"><a href="data-overview.html#cb10-50" tabindex="-1"></a>    </span>
<span id="cb10-51"><a href="data-overview.html#cb10-51" tabindex="-1"></a>    <span class="co"># 6. Combine the results from the &quot;points_within&quot; and &quot;points_nearest&quot; joins.</span></span>
<span id="cb10-52"><a href="data-overview.html#cb10-52" tabindex="-1"></a>    combined_points <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(points_within, points_nearest)</span>
<span id="cb10-53"><a href="data-overview.html#cb10-53" tabindex="-1"></a>    </span>
<span id="cb10-54"><a href="data-overview.html#cb10-54" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb10-55"><a href="data-overview.html#cb10-55" tabindex="-1"></a>    <span class="co"># If all points were matched in step 2.</span></span>
<span id="cb10-56"><a href="data-overview.html#cb10-56" tabindex="-1"></a>    combined_points <span class="ot">&lt;-</span> points_within</span>
<span id="cb10-57"><a href="data-overview.html#cb10-57" tabindex="-1"></a>  }</span>
<span id="cb10-58"><a href="data-overview.html#cb10-58" tabindex="-1"></a>  </span>
<span id="cb10-59"><a href="data-overview.html#cb10-59" tabindex="-1"></a>  <span class="co"># names diff</span></span>
<span id="cb10-60"><a href="data-overview.html#cb10-60" tabindex="-1"></a>  cols_add <span class="ot">&lt;-</span></span>
<span id="cb10-61"><a href="data-overview.html#cb10-61" tabindex="-1"></a>    <span class="fu">c</span>(</span>
<span id="cb10-62"><a href="data-overview.html#cb10-62" tabindex="-1"></a>      base<span class="sc">::</span><span class="fu">setdiff</span>(</span>
<span id="cb10-63"><a href="data-overview.html#cb10-63" tabindex="-1"></a>        <span class="fu">names</span>(combined_points)</span>
<span id="cb10-64"><a href="data-overview.html#cb10-64" tabindex="-1"></a>        , <span class="fu">names</span>(polygons_sf)</span>
<span id="cb10-65"><a href="data-overview.html#cb10-65" tabindex="-1"></a>      )</span>
<span id="cb10-66"><a href="data-overview.html#cb10-66" tabindex="-1"></a>      , polygon_id</span>
<span id="cb10-67"><a href="data-overview.html#cb10-67" tabindex="-1"></a>    )</span>
<span id="cb10-68"><a href="data-overview.html#cb10-68" tabindex="-1"></a>  </span>
<span id="cb10-69"><a href="data-overview.html#cb10-69" tabindex="-1"></a>  <span class="co"># 7. Perform a left join to ensure all original polygons are included in the final output.</span></span>
<span id="cb10-70"><a href="data-overview.html#cb10-70" tabindex="-1"></a>  <span class="co"># Polygons without any matched points will have `NA` values for the point attributes.</span></span>
<span id="cb10-71"><a href="data-overview.html#cb10-71" tabindex="-1"></a>  final_result <span class="ot">&lt;-</span> polygons_sf <span class="sc">%&gt;%</span> </span>
<span id="cb10-72"><a href="data-overview.html#cb10-72" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">left_join</span>(</span>
<span id="cb10-73"><a href="data-overview.html#cb10-73" tabindex="-1"></a>      combined_points <span class="sc">%&gt;%</span> </span>
<span id="cb10-74"><a href="data-overview.html#cb10-74" tabindex="-1"></a>      sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb10-75"><a href="data-overview.html#cb10-75" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">select</span>(dplyr<span class="sc">::</span><span class="fu">all_of</span>(cols_add))</span>
<span id="cb10-76"><a href="data-overview.html#cb10-76" tabindex="-1"></a>      , <span class="at">by =</span> polygon_id</span>
<span id="cb10-77"><a href="data-overview.html#cb10-77" tabindex="-1"></a>    )</span>
<span id="cb10-78"><a href="data-overview.html#cb10-78" tabindex="-1"></a>  </span>
<span id="cb10-79"><a href="data-overview.html#cb10-79" tabindex="-1"></a>  <span class="fu">return</span>(final_result)</span>
<span id="cb10-80"><a href="data-overview.html#cb10-80" tabindex="-1"></a>}</span></code></pre></div>
<p>we’ll also define a function to get the diameter of the polygon which we will use to extract diameter from our predicted segments to compare with the field-measured diameter values. we can also compare the field-measured diameter to the image-annotated diameter as a sanity check.</p>
<p>let’s define a function to get polygon diameter that accurately reflects the measurement for potentially irregular shapes. we’ll calculate the diameter by finding the maximum distance across the footprint of the entire polygon</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="data-overview.html#cb11-1" tabindex="-1"></a><span class="do">###___________________________________________###</span></span>
<span id="cb11-2"><a href="data-overview.html#cb11-2" tabindex="-1"></a><span class="co"># calculate diameter of single polygon</span></span>
<span id="cb11-3"><a href="data-overview.html#cb11-3" tabindex="-1"></a><span class="do">###___________________________________________###</span></span>
<span id="cb11-4"><a href="data-overview.html#cb11-4" tabindex="-1"></a><span class="co"># function to calculate the diamater of an sf polygon that is potentially irregularly shaped</span></span>
<span id="cb11-5"><a href="data-overview.html#cb11-5" tabindex="-1"></a><span class="co"># using the distance between the farthest points</span></span>
<span id="cb11-6"><a href="data-overview.html#cb11-6" tabindex="-1"></a>st_calculate_diameter_polygon <span class="ot">&lt;-</span> <span class="cf">function</span>(polygon) {</span>
<span id="cb11-7"><a href="data-overview.html#cb11-7" tabindex="-1"></a>  <span class="co"># get the convex hull</span></span>
<span id="cb11-8"><a href="data-overview.html#cb11-8" tabindex="-1"></a>  ch <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_convex_hull</span>(polygon)</span>
<span id="cb11-9"><a href="data-overview.html#cb11-9" tabindex="-1"></a></span>
<span id="cb11-10"><a href="data-overview.html#cb11-10" tabindex="-1"></a>  <span class="co"># cast to multipoint then point to get individual vertices</span></span>
<span id="cb11-11"><a href="data-overview.html#cb11-11" tabindex="-1"></a>  ch_points <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_cast</span>(ch, <span class="st">&#39;MULTIPOINT&#39;</span>) <span class="sc">%&gt;%</span> sf<span class="sc">::</span><span class="fu">st_cast</span>(<span class="st">&#39;POINT&#39;</span>)</span>
<span id="cb11-12"><a href="data-overview.html#cb11-12" tabindex="-1"></a></span>
<span id="cb11-13"><a href="data-overview.html#cb11-13" tabindex="-1"></a>  <span class="co"># calculate the distances between all pairs of points</span></span>
<span id="cb11-14"><a href="data-overview.html#cb11-14" tabindex="-1"></a>  distances <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_distance</span>(ch_points)</span>
<span id="cb11-15"><a href="data-overview.html#cb11-15" tabindex="-1"></a></span>
<span id="cb11-16"><a href="data-overview.html#cb11-16" tabindex="-1"></a>  <span class="co"># find the maximum distance, which is the diameter</span></span>
<span id="cb11-17"><a href="data-overview.html#cb11-17" tabindex="-1"></a>  diameter <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">max</span>(distances,<span class="at">na.rm=</span>T))</span>
<span id="cb11-18"><a href="data-overview.html#cb11-18" tabindex="-1"></a>  <span class="fu">return</span>(diameter)</span>
<span id="cb11-19"><a href="data-overview.html#cb11-19" tabindex="-1"></a>}</span>
<span id="cb11-20"><a href="data-overview.html#cb11-20" tabindex="-1"></a><span class="co"># apply st to sf data</span></span>
<span id="cb11-21"><a href="data-overview.html#cb11-21" tabindex="-1"></a>st_calculate_diameter <span class="ot">&lt;-</span> <span class="cf">function</span>(sf_data) {</span>
<span id="cb11-22"><a href="data-overview.html#cb11-22" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span><span class="fu">inherits</span>(sf_data,<span class="st">&quot;sf&quot;</span>)){<span class="fu">stop</span>(<span class="st">&quot;st_calculate_diameter() requires polygon sf data&quot;</span>)}</span>
<span id="cb11-23"><a href="data-overview.html#cb11-23" tabindex="-1"></a>  <span class="cf">if</span>(</span>
<span id="cb11-24"><a href="data-overview.html#cb11-24" tabindex="-1"></a>    <span class="sc">!</span><span class="fu">all</span>( sf<span class="sc">::</span><span class="fu">st_is</span>(sf_data, <span class="fu">c</span>(<span class="st">&quot;POLYGON&quot;</span>,<span class="st">&quot;MULTIPOLYGON&quot;</span>)) )</span>
<span id="cb11-25"><a href="data-overview.html#cb11-25" tabindex="-1"></a>  ){</span>
<span id="cb11-26"><a href="data-overview.html#cb11-26" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">&quot;st_calculate_diameter() requires polygon sf data&quot;</span>)</span>
<span id="cb11-27"><a href="data-overview.html#cb11-27" tabindex="-1"></a>  }</span>
<span id="cb11-28"><a href="data-overview.html#cb11-28" tabindex="-1"></a></span>
<span id="cb11-29"><a href="data-overview.html#cb11-29" tabindex="-1"></a>  <span class="co"># get the geometry column name</span></span>
<span id="cb11-30"><a href="data-overview.html#cb11-30" tabindex="-1"></a>  geom_col_name <span class="ot">&lt;-</span> <span class="fu">attr</span>(sf_data, <span class="st">&quot;sf_column&quot;</span>)</span>
<span id="cb11-31"><a href="data-overview.html#cb11-31" tabindex="-1"></a></span>
<span id="cb11-32"><a href="data-overview.html#cb11-32" tabindex="-1"></a>  <span class="co"># calculate diameter</span></span>
<span id="cb11-33"><a href="data-overview.html#cb11-33" tabindex="-1"></a>  <span class="co"># !!rlang::sym() unquotes the geometry column</span></span>
<span id="cb11-34"><a href="data-overview.html#cb11-34" tabindex="-1"></a>  return_dta <span class="ot">&lt;-</span> sf_data <span class="sc">%&gt;%</span> </span>
<span id="cb11-35"><a href="data-overview.html#cb11-35" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb11-36"><a href="data-overview.html#cb11-36" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">rowwise</span>() <span class="sc">%&gt;%</span></span>
<span id="cb11-37"><a href="data-overview.html#cb11-37" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">diameter_m =</span> <span class="fu">st_calculate_diameter_polygon</span>( <span class="sc">!!</span>rlang<span class="sc">::</span><span class="fu">sym</span>(geom_col_name) )) <span class="sc">%&gt;%</span></span>
<span id="cb11-38"><a href="data-overview.html#cb11-38" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">ungroup</span>()</span>
<span id="cb11-39"><a href="data-overview.html#cb11-39" tabindex="-1"></a>  <span class="fu">return</span>(return_dta)</span>
<span id="cb11-40"><a href="data-overview.html#cb11-40" tabindex="-1"></a>}</span></code></pre></div>
<p>let’s apply our <code>match_points_to_polygons()</code> and <code>st_calculate_diameter()</code> functions</p>
<p>For only the PSINF mixed conifer site, slash pile field measurements were taken by measuring the height and diameter (longest side of pile) using a laser hypsometer</p>
<p>For volume estimation, we’ll model the ground truth slash piles as a paraboloid, specifically a parabolic dome, assuming a perfectly circular base and sides curved smoothly to a peak. Assuming a paraboloid shape is common for quantifying slash pile volume (<a href="https://permanent.fdlp.gov/gpo45282/index.htm">Hardy 1996</a>; <a href="https://doi.org/10.5849/forsci.13-501">Long &amp; Boston 2014</a>) and may better represent the diverse shapes of real-world slash piles than assuming a conical or half-sphere form. A paraboloid can represent a variety of shapes including those that are taller and more conical, or flatter and more spread out, because it allows the measured height and width to influence the volume calculation independently. This makes the paraboloid potentially more robust for estimating volumes of piles with varying aspect ratios.</p>
<p>the volume formula for a paraboloid is:</p>
<p><span class="math display">\[
V = \frac{1}{8}\pi \cdot width^2 \cdot height
\]</span></p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="data-overview.html#cb12-1" tabindex="-1"></a><span class="co"># PSINF Mixed Conifer Site</span></span>
<span id="cb12-2"><a href="data-overview.html#cb12-2" tabindex="-1"></a>psinf_slash_piles_polys <span class="ot">&lt;-</span></span>
<span id="cb12-3"><a href="data-overview.html#cb12-3" tabindex="-1"></a>  <span class="fu">match_points_to_polygons</span>(</span>
<span id="cb12-4"><a href="data-overview.html#cb12-4" tabindex="-1"></a>    <span class="at">points_sf =</span> psinf_slash_piles_points </span>
<span id="cb12-5"><a href="data-overview.html#cb12-5" tabindex="-1"></a>    , <span class="at">polygons_sf =</span> psinf_slash_piles_polys</span>
<span id="cb12-6"><a href="data-overview.html#cb12-6" tabindex="-1"></a>    , <span class="at">point_id =</span> <span class="st">&quot;row_number&quot;</span></span>
<span id="cb12-7"><a href="data-overview.html#cb12-7" tabindex="-1"></a>    , <span class="at">polygon_id =</span> <span class="st">&quot;pile_id&quot;</span></span>
<span id="cb12-8"><a href="data-overview.html#cb12-8" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb12-9"><a href="data-overview.html#cb12-9" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb12-10"><a href="data-overview.html#cb12-10" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_make_valid</span>() <span class="sc">%&gt;%</span></span>
<span id="cb12-11"><a href="data-overview.html#cb12-11" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(sf<span class="sc">::</span><span class="fu">st_is_valid</span>(.)) <span class="sc">%&gt;%</span> </span>
<span id="cb12-12"><a href="data-overview.html#cb12-12" tabindex="-1"></a>  <span class="fu">st_calculate_diameter</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb12-13"><a href="data-overview.html#cb12-13" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">image_gt_diameter_m =</span> diameter_m) <span class="sc">%&gt;%</span> </span>
<span id="cb12-14"><a href="data-overview.html#cb12-14" tabindex="-1"></a>  <span class="co"># calculate area and volume</span></span>
<span id="cb12-15"><a href="data-overview.html#cb12-15" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb12-16"><a href="data-overview.html#cb12-16" tabindex="-1"></a>    <span class="co"># height </span></span>
<span id="cb12-17"><a href="data-overview.html#cb12-17" tabindex="-1"></a>    <span class="at">field_height_m =</span> height_ft<span class="sc">*</span><span class="fl">0.3048</span></span>
<span id="cb12-18"><a href="data-overview.html#cb12-18" tabindex="-1"></a>    , <span class="at">field_diameter_m =</span> diameter_ft<span class="sc">*</span><span class="fl">0.3048</span> <span class="co"># *0.3048 or /3.281 to convert to m</span></span>
<span id="cb12-19"><a href="data-overview.html#cb12-19" tabindex="-1"></a>    , <span class="at">field_radius_m =</span> (field_diameter_m<span class="sc">/</span><span class="dv">2</span>)</span>
<span id="cb12-20"><a href="data-overview.html#cb12-20" tabindex="-1"></a>    , <span class="at">image_gt_area_m2 =</span> sf<span class="sc">::</span><span class="fu">st_area</span>(.) <span class="sc">%&gt;%</span> <span class="fu">as.numeric</span>()</span>
<span id="cb12-21"><a href="data-overview.html#cb12-21" tabindex="-1"></a>    , <span class="at">field_gt_area_m2 =</span> pi<span class="sc">*</span>field_radius_m<span class="sc">^</span><span class="dv">2</span> </span>
<span id="cb12-22"><a href="data-overview.html#cb12-22" tabindex="-1"></a>    <span class="co"># volume ASSUMING PERFECT GEOMETRIC SHAPE :/</span></span>
<span id="cb12-23"><a href="data-overview.html#cb12-23" tabindex="-1"></a>    , <span class="at">image_gt_volume_m3 =</span> (<span class="dv">1</span><span class="sc">/</span><span class="dv">8</span>) <span class="sc">*</span> pi <span class="sc">*</span> (image_gt_diameter_m<span class="sc">^</span><span class="dv">2</span>) <span class="sc">*</span> field_height_m</span>
<span id="cb12-24"><a href="data-overview.html#cb12-24" tabindex="-1"></a>    , <span class="at">field_gt_volume_m3 =</span> (<span class="dv">1</span><span class="sc">/</span><span class="dv">8</span>) <span class="sc">*</span> pi <span class="sc">*</span> (field_diameter_m<span class="sc">^</span><span class="dv">2</span>) <span class="sc">*</span> field_height_m</span>
<span id="cb12-25"><a href="data-overview.html#cb12-25" tabindex="-1"></a>  )</span>
<span id="cb12-26"><a href="data-overview.html#cb12-26" tabindex="-1"></a><span class="co"># TRFO-BLM Pinyon-Juniper Site</span></span>
<span id="cb12-27"><a href="data-overview.html#cb12-27" tabindex="-1"></a>pj_slash_piles_polys <span class="ot">&lt;-</span></span>
<span id="cb12-28"><a href="data-overview.html#cb12-28" tabindex="-1"></a>  <span class="fu">match_points_to_polygons</span>(</span>
<span id="cb12-29"><a href="data-overview.html#cb12-29" tabindex="-1"></a>    <span class="at">points_sf =</span> pj_slash_piles_points </span>
<span id="cb12-30"><a href="data-overview.html#cb12-30" tabindex="-1"></a>    , <span class="at">polygons_sf =</span> pj_slash_piles_polys</span>
<span id="cb12-31"><a href="data-overview.html#cb12-31" tabindex="-1"></a>    , <span class="at">point_id =</span> <span class="st">&quot;orig_pile_id&quot;</span></span>
<span id="cb12-32"><a href="data-overview.html#cb12-32" tabindex="-1"></a>    , <span class="at">polygon_id =</span> <span class="st">&quot;pile_id&quot;</span></span>
<span id="cb12-33"><a href="data-overview.html#cb12-33" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb12-34"><a href="data-overview.html#cb12-34" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb12-35"><a href="data-overview.html#cb12-35" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_make_valid</span>() <span class="sc">%&gt;%</span></span>
<span id="cb12-36"><a href="data-overview.html#cb12-36" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(sf<span class="sc">::</span><span class="fu">st_is_valid</span>(.)) <span class="sc">%&gt;%</span> </span>
<span id="cb12-37"><a href="data-overview.html#cb12-37" tabindex="-1"></a>  <span class="fu">st_calculate_diameter</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb12-38"><a href="data-overview.html#cb12-38" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(</span>
<span id="cb12-39"><a href="data-overview.html#cb12-39" tabindex="-1"></a>    <span class="at">image_gt_diameter_m =</span> diameter_m</span>
<span id="cb12-40"><a href="data-overview.html#cb12-40" tabindex="-1"></a>    , <span class="at">field_height_m =</span> height_m</span>
<span id="cb12-41"><a href="data-overview.html#cb12-41" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb12-42"><a href="data-overview.html#cb12-42" tabindex="-1"></a>  <span class="co"># calculate area and volume</span></span>
<span id="cb12-43"><a href="data-overview.html#cb12-43" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb12-44"><a href="data-overview.html#cb12-44" tabindex="-1"></a>    <span class="co"># height </span></span>
<span id="cb12-45"><a href="data-overview.html#cb12-45" tabindex="-1"></a>    <span class="at">field_diameter_m =</span> width_m</span>
<span id="cb12-46"><a href="data-overview.html#cb12-46" tabindex="-1"></a>    , <span class="at">field_radius_m =</span> (field_diameter_m<span class="sc">/</span><span class="dv">2</span>)</span>
<span id="cb12-47"><a href="data-overview.html#cb12-47" tabindex="-1"></a>    , <span class="at">image_gt_area_m2 =</span> sf<span class="sc">::</span><span class="fu">st_area</span>(.) <span class="sc">%&gt;%</span> <span class="fu">as.numeric</span>()</span>
<span id="cb12-48"><a href="data-overview.html#cb12-48" tabindex="-1"></a>    , <span class="at">field_gt_area_m2 =</span> pi<span class="sc">*</span>field_radius_m<span class="sc">^</span><span class="dv">2</span> </span>
<span id="cb12-49"><a href="data-overview.html#cb12-49" tabindex="-1"></a>    <span class="co"># volume ASSUMING PERFECT GEOMETRIC SHAPE :/</span></span>
<span id="cb12-50"><a href="data-overview.html#cb12-50" tabindex="-1"></a>    , <span class="at">image_gt_volume_m3 =</span> (<span class="dv">1</span><span class="sc">/</span><span class="dv">8</span>) <span class="sc">*</span> pi <span class="sc">*</span> (image_gt_diameter_m<span class="sc">^</span><span class="dv">2</span>) <span class="sc">*</span> field_height_m</span>
<span id="cb12-51"><a href="data-overview.html#cb12-51" tabindex="-1"></a>    , <span class="at">field_gt_volume_m3 =</span> (<span class="dv">1</span><span class="sc">/</span><span class="dv">8</span>) <span class="sc">*</span> pi <span class="sc">*</span> (field_diameter_m<span class="sc">^</span><span class="dv">2</span>) <span class="sc">*</span> field_height_m</span>
<span id="cb12-52"><a href="data-overview.html#cb12-52" tabindex="-1"></a>  )</span>
<span id="cb12-53"><a href="data-overview.html#cb12-53" tabindex="-1"></a><span class="co"># BHEF Ponderosa Pine Site</span></span>
<span id="cb12-54"><a href="data-overview.html#cb12-54" tabindex="-1"></a>bhef_slash_piles_polys <span class="ot">&lt;-</span></span>
<span id="cb12-55"><a href="data-overview.html#cb12-55" tabindex="-1"></a>  bhef_slash_piles_polys <span class="sc">%&gt;%</span> </span>
<span id="cb12-56"><a href="data-overview.html#cb12-56" tabindex="-1"></a>  <span class="fu">st_calculate_diameter</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb12-57"><a href="data-overview.html#cb12-57" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">image_gt_diameter_m =</span> diameter_m) <span class="sc">%&gt;%</span> </span>
<span id="cb12-58"><a href="data-overview.html#cb12-58" tabindex="-1"></a>  <span class="co"># calculate area and volume</span></span>
<span id="cb12-59"><a href="data-overview.html#cb12-59" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb12-60"><a href="data-overview.html#cb12-60" tabindex="-1"></a>    <span class="at">image_gt_area_m2 =</span> sf<span class="sc">::</span><span class="fu">st_area</span>(.) <span class="sc">%&gt;%</span> <span class="fu">as.numeric</span>()</span>
<span id="cb12-61"><a href="data-overview.html#cb12-61" tabindex="-1"></a>  )</span>
<span id="cb12-62"><a href="data-overview.html#cb12-62" tabindex="-1"></a><span class="co"># ARNF Ponderosa Pine Site</span></span>
<span id="cb12-63"><a href="data-overview.html#cb12-63" tabindex="-1"></a>arnf_slash_piles_polys <span class="ot">&lt;-</span></span>
<span id="cb12-64"><a href="data-overview.html#cb12-64" tabindex="-1"></a>  arnf_slash_piles_polys <span class="sc">%&gt;%</span> </span>
<span id="cb12-65"><a href="data-overview.html#cb12-65" tabindex="-1"></a>  <span class="fu">st_calculate_diameter</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb12-66"><a href="data-overview.html#cb12-66" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">image_gt_diameter_m =</span> diameter_m) <span class="sc">%&gt;%</span> </span>
<span id="cb12-67"><a href="data-overview.html#cb12-67" tabindex="-1"></a>  <span class="co"># calculate area and volume</span></span>
<span id="cb12-68"><a href="data-overview.html#cb12-68" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb12-69"><a href="data-overview.html#cb12-69" tabindex="-1"></a>    <span class="at">image_gt_area_m2 =</span> sf<span class="sc">::</span><span class="fu">st_area</span>(.) <span class="sc">%&gt;%</span> <span class="fu">as.numeric</span>()</span>
<span id="cb12-70"><a href="data-overview.html#cb12-70" tabindex="-1"></a>  )</span></code></pre></div>
</div>
<div id="pile-form-measurements" class="section level3 hasAnchor" number="2.2.2">
<h3><span class="header-section-number">2.2.2</span> Pile Form Measurements<a href="data-overview.html#pile-form-measurements" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>let’s make some reusable functions to make the same tables throughout the analysis</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="data-overview.html#cb13-1" tabindex="-1"></a><span class="co"># aggregate</span></span>
<span id="cb13-2"><a href="data-overview.html#cb13-2" tabindex="-1"></a>agg_piles_temp <span class="ot">&lt;-</span> <span class="cf">function</span>(df) {</span>
<span id="cb13-3"><a href="data-overview.html#cb13-3" tabindex="-1"></a>  df <span class="sc">%&gt;%</span> </span>
<span id="cb13-4"><a href="data-overview.html#cb13-4" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(is_in_stand) <span class="sc">%&gt;%</span> </span>
<span id="cb13-5"><a href="data-overview.html#cb13-5" tabindex="-1"></a>    <span class="co"># dplyr::ungroup() %&gt;% </span></span>
<span id="cb13-6"><a href="data-overview.html#cb13-6" tabindex="-1"></a>    sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb13-7"><a href="data-overview.html#cb13-7" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb13-8"><a href="data-overview.html#cb13-8" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">any_of</span>(<span class="fu">c</span>(<span class="st">&quot;site&quot;</span>, <span class="st">&quot;pile_type&quot;</span>))</span>
<span id="cb13-9"><a href="data-overview.html#cb13-9" tabindex="-1"></a>      , tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;area_m2&quot;</span>)</span>
<span id="cb13-10"><a href="data-overview.html#cb13-10" tabindex="-1"></a>        <span class="sc">|</span> tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;diameter_m&quot;</span>)</span>
<span id="cb13-11"><a href="data-overview.html#cb13-11" tabindex="-1"></a>        <span class="sc">|</span> tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;height_m&quot;</span>)</span>
<span id="cb13-12"><a href="data-overview.html#cb13-12" tabindex="-1"></a>        <span class="co"># | tidyselect::contains(&quot;volume_m3&quot;)</span></span>
<span id="cb13-13"><a href="data-overview.html#cb13-13" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb13-14"><a href="data-overview.html#cb13-14" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">summarise</span>(</span>
<span id="cb13-15"><a href="data-overview.html#cb13-15" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">across</span>(</span>
<span id="cb13-16"><a href="data-overview.html#cb13-16" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">where</span>(<span class="sc">~</span> <span class="fu">is.character</span>(.x) <span class="sc">|</span> <span class="fu">is.factor</span>(.x))</span>
<span id="cb13-17"><a href="data-overview.html#cb13-17" tabindex="-1"></a>        , <span class="at">.fns =</span> dplyr<span class="sc">::</span>first</span>
<span id="cb13-18"><a href="data-overview.html#cb13-18" tabindex="-1"></a>      )</span>
<span id="cb13-19"><a href="data-overview.html#cb13-19" tabindex="-1"></a>      , dplyr<span class="sc">::</span><span class="fu">across</span>(</span>
<span id="cb13-20"><a href="data-overview.html#cb13-20" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">where</span>(is.numeric)</span>
<span id="cb13-21"><a href="data-overview.html#cb13-21" tabindex="-1"></a>        , <span class="at">.fns =</span> <span class="fu">list</span>(</span>
<span id="cb13-22"><a href="data-overview.html#cb13-22" tabindex="-1"></a>          <span class="at">mean =</span> <span class="sc">~</span><span class="fu">mean</span>(.x,<span class="at">na.rm=</span>T)</span>
<span id="cb13-23"><a href="data-overview.html#cb13-23" tabindex="-1"></a>          , <span class="at">sd =</span> <span class="sc">~</span><span class="fu">sd</span>(.x,<span class="at">na.rm=</span>T)</span>
<span id="cb13-24"><a href="data-overview.html#cb13-24" tabindex="-1"></a>          <span class="co"># , q10 = ~quantile(.x,na.rm=T,probs=0.1)</span></span>
<span id="cb13-25"><a href="data-overview.html#cb13-25" tabindex="-1"></a>          <span class="co"># , q50 = ~quantile(.x,na.rm=T,probs=0.5)</span></span>
<span id="cb13-26"><a href="data-overview.html#cb13-26" tabindex="-1"></a>          <span class="co"># , q90 = ~quantile(.x,na.rm=T,probs=0.9)</span></span>
<span id="cb13-27"><a href="data-overview.html#cb13-27" tabindex="-1"></a>          <span class="co"># , min = ~min(.x,na.rm=T)</span></span>
<span id="cb13-28"><a href="data-overview.html#cb13-28" tabindex="-1"></a>          <span class="co"># , max = ~max(.x,na.rm=T)</span></span>
<span id="cb13-29"><a href="data-overview.html#cb13-29" tabindex="-1"></a>          , <span class="at">range =</span> <span class="sc">~</span><span class="fu">paste0</span>(</span>
<span id="cb13-30"><a href="data-overview.html#cb13-30" tabindex="-1"></a>            scales<span class="sc">::</span><span class="fu">comma</span>(<span class="fu">min</span>(.x,<span class="at">na.rm=</span>T), <span class="at">accuracy =</span> <span class="fl">0.1</span>)</span>
<span id="cb13-31"><a href="data-overview.html#cb13-31" tabindex="-1"></a>            ,<span class="st">&quot;-&quot;</span></span>
<span id="cb13-32"><a href="data-overview.html#cb13-32" tabindex="-1"></a>            , scales<span class="sc">::</span><span class="fu">comma</span>(<span class="fu">max</span>(.x,<span class="at">na.rm=</span>T), <span class="at">accuracy =</span> <span class="fl">0.1</span>)</span>
<span id="cb13-33"><a href="data-overview.html#cb13-33" tabindex="-1"></a>          )</span>
<span id="cb13-34"><a href="data-overview.html#cb13-34" tabindex="-1"></a>        )</span>
<span id="cb13-35"><a href="data-overview.html#cb13-35" tabindex="-1"></a>      )</span>
<span id="cb13-36"><a href="data-overview.html#cb13-36" tabindex="-1"></a>      , <span class="at">n =</span> dplyr<span class="sc">::</span><span class="fu">n</span>()</span>
<span id="cb13-37"><a href="data-overview.html#cb13-37" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb13-38"><a href="data-overview.html#cb13-38" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">ungroup</span>()</span>
<span id="cb13-39"><a href="data-overview.html#cb13-39" tabindex="-1"></a>}</span>
<span id="cb13-40"><a href="data-overview.html#cb13-40" tabindex="-1"></a><span class="co"># function to kableExtra</span></span>
<span id="cb13-41"><a href="data-overview.html#cb13-41" tabindex="-1"></a>kbl_form_sum_stats_wide <span class="ot">&lt;-</span> <span class="cf">function</span>(df, <span class="at">by_lab =</span> <span class="st">&quot;&quot;</span>) {</span>
<span id="cb13-42"><a href="data-overview.html#cb13-42" tabindex="-1"></a>  df <span class="sc">%&gt;%</span> </span>
<span id="cb13-43"><a href="data-overview.html#cb13-43" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb13-44"><a href="data-overview.html#cb13-44" tabindex="-1"></a>    <span class="at">n =</span> scales<span class="sc">::</span><span class="fu">comma</span>(n,<span class="at">accuracy=</span><span class="dv">1</span>)</span>
<span id="cb13-45"><a href="data-overview.html#cb13-45" tabindex="-1"></a>    , dplyr<span class="sc">::</span><span class="fu">across</span>(</span>
<span id="cb13-46"><a href="data-overview.html#cb13-46" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">where</span>(is.numeric)</span>
<span id="cb13-47"><a href="data-overview.html#cb13-47" tabindex="-1"></a>      , <span class="sc">~</span>scales<span class="sc">::</span><span class="fu">comma</span>(.x,<span class="at">accuracy=</span><span class="fl">0.1</span>)</span>
<span id="cb13-48"><a href="data-overview.html#cb13-48" tabindex="-1"></a>    )</span>
<span id="cb13-49"><a href="data-overview.html#cb13-49" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb13-50"><a href="data-overview.html#cb13-50" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kbl</span>(</span>
<span id="cb13-51"><a href="data-overview.html#cb13-51" tabindex="-1"></a>    <span class="at">caption =</span> <span class="fu">paste0</span>(</span>
<span id="cb13-52"><a href="data-overview.html#cb13-52" tabindex="-1"></a>      <span class="st">&quot;Slash pile image-annotated and field-collected form measurements&quot;</span></span>
<span id="cb13-53"><a href="data-overview.html#cb13-53" tabindex="-1"></a>      ,<span class="st">&quot;&lt;br&gt;&quot;</span></span>
<span id="cb13-54"><a href="data-overview.html#cb13-54" tabindex="-1"></a>      , by_lab</span>
<span id="cb13-55"><a href="data-overview.html#cb13-55" tabindex="-1"></a>    )</span>
<span id="cb13-56"><a href="data-overview.html#cb13-56" tabindex="-1"></a>    , <span class="at">col.names =</span> <span class="fu">c</span>(</span>
<span id="cb13-57"><a href="data-overview.html#cb13-57" tabindex="-1"></a>      <span class="st">&quot; &quot;</span>, <span class="st">&quot;Piles&quot;</span></span>
<span id="cb13-58"><a href="data-overview.html#cb13-58" tabindex="-1"></a>      , <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;Mean&quot;</span>,<span class="st">&quot;Std Dev&quot;</span>,<span class="st">&quot;Range&quot;</span>), <span class="at">times =</span> <span class="dv">4</span>)</span>
<span id="cb13-59"><a href="data-overview.html#cb13-59" tabindex="-1"></a>    )</span>
<span id="cb13-60"><a href="data-overview.html#cb13-60" tabindex="-1"></a>    , <span class="at">escape =</span> F</span>
<span id="cb13-61"><a href="data-overview.html#cb13-61" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb13-62"><a href="data-overview.html#cb13-62" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kable_styling</span>(<span class="at">font_size =</span> <span class="fl">11.5</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb13-63"><a href="data-overview.html#cb13-63" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">add_header_above</span>(</span>
<span id="cb13-64"><a href="data-overview.html#cb13-64" tabindex="-1"></a>    <span class="fu">c</span>(</span>
<span id="cb13-65"><a href="data-overview.html#cb13-65" tabindex="-1"></a>      <span class="st">&quot; &quot;</span><span class="ot">=</span><span class="dv">2</span></span>
<span id="cb13-66"><a href="data-overview.html#cb13-66" tabindex="-1"></a>      , <span class="st">&quot;Image-Ann. Area (m&lt;sup&gt;2&lt;/sup&gt;)&quot;</span> <span class="ot">=</span> <span class="dv">3</span></span>
<span id="cb13-67"><a href="data-overview.html#cb13-67" tabindex="-1"></a>      , <span class="st">&quot;Image-Ann. Diam (m)&quot;</span> <span class="ot">=</span> <span class="dv">3</span></span>
<span id="cb13-68"><a href="data-overview.html#cb13-68" tabindex="-1"></a>      , <span class="st">&quot;Field-Meas. Diam (m)&quot;</span> <span class="ot">=</span> <span class="dv">3</span></span>
<span id="cb13-69"><a href="data-overview.html#cb13-69" tabindex="-1"></a>      , <span class="st">&quot;Field-Meas. Height (m)&quot;</span> <span class="ot">=</span> <span class="dv">3</span></span>
<span id="cb13-70"><a href="data-overview.html#cb13-70" tabindex="-1"></a>    )</span>
<span id="cb13-71"><a href="data-overview.html#cb13-71" tabindex="-1"></a>    , <span class="at">escape =</span> F</span>
<span id="cb13-72"><a href="data-overview.html#cb13-72" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb13-73"><a href="data-overview.html#cb13-73" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">column_spec</span>(<span class="fu">seq</span>(<span class="dv">2</span>,<span class="dv">14</span>,<span class="at">by=</span><span class="dv">3</span>), <span class="at">border_right =</span> <span class="cn">TRUE</span>, <span class="at">include_thead =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb13-74"><a href="data-overview.html#cb13-74" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">column_spec</span>(</span>
<span id="cb13-75"><a href="data-overview.html#cb13-75" tabindex="-1"></a>    <span class="at">column =</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">14</span></span>
<span id="cb13-76"><a href="data-overview.html#cb13-76" tabindex="-1"></a>    , <span class="at">extra_css =</span> <span class="st">&quot;font-size: 11px;&quot;</span></span>
<span id="cb13-77"><a href="data-overview.html#cb13-77" tabindex="-1"></a>    , <span class="at">include_thead =</span> T</span>
<span id="cb13-78"><a href="data-overview.html#cb13-78" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb13-79"><a href="data-overview.html#cb13-79" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">scroll_box</span>(<span class="at">width =</span> <span class="st">&quot;740px&quot;</span>)</span>
<span id="cb13-80"><a href="data-overview.html#cb13-80" tabindex="-1"></a>}</span>
<span id="cb13-81"><a href="data-overview.html#cb13-81" tabindex="-1"></a><span class="do">## for a single site</span></span>
<span id="cb13-82"><a href="data-overview.html#cb13-82" tabindex="-1"></a>kbl_form_sum_stats_long <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb13-83"><a href="data-overview.html#cb13-83" tabindex="-1"></a>  pile_df</span>
<span id="cb13-84"><a href="data-overview.html#cb13-84" tabindex="-1"></a>  , <span class="at">caption =</span> <span class="st">&quot;Ground Truth Piles: summary statistics for form measurements&quot;</span></span>
<span id="cb13-85"><a href="data-overview.html#cb13-85" tabindex="-1"></a>) {</span>
<span id="cb13-86"><a href="data-overview.html#cb13-86" tabindex="-1"></a>pile_df <span class="sc">%&gt;%</span> </span>
<span id="cb13-87"><a href="data-overview.html#cb13-87" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb13-88"><a href="data-overview.html#cb13-88" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb13-89"><a href="data-overview.html#cb13-89" tabindex="-1"></a>    tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;area_m2&quot;</span>)</span>
<span id="cb13-90"><a href="data-overview.html#cb13-90" tabindex="-1"></a>    <span class="sc">|</span> tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;diameter_m&quot;</span>)</span>
<span id="cb13-91"><a href="data-overview.html#cb13-91" tabindex="-1"></a>    <span class="sc">|</span> tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;height_m&quot;</span>)</span>
<span id="cb13-92"><a href="data-overview.html#cb13-92" tabindex="-1"></a>    <span class="sc">|</span> tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;volume_m3&quot;</span>)</span>
<span id="cb13-93"><a href="data-overview.html#cb13-93" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb13-94"><a href="data-overview.html#cb13-94" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(</span>
<span id="cb13-95"><a href="data-overview.html#cb13-95" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">across</span>(</span>
<span id="cb13-96"><a href="data-overview.html#cb13-96" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">everything</span>()</span>
<span id="cb13-97"><a href="data-overview.html#cb13-97" tabindex="-1"></a>      , <span class="at">.fns =</span> <span class="fu">list</span>(</span>
<span id="cb13-98"><a href="data-overview.html#cb13-98" tabindex="-1"></a>        <span class="at">mean =</span> <span class="sc">~</span><span class="fu">mean</span>(.x,<span class="at">na.rm=</span>T)</span>
<span id="cb13-99"><a href="data-overview.html#cb13-99" tabindex="-1"></a>        , <span class="at">sd =</span> <span class="sc">~</span><span class="fu">sd</span>(.x,<span class="at">na.rm=</span>T)</span>
<span id="cb13-100"><a href="data-overview.html#cb13-100" tabindex="-1"></a>        , <span class="at">q10 =</span> <span class="sc">~</span><span class="fu">quantile</span>(.x,<span class="at">na.rm=</span>T,<span class="at">probs=</span><span class="fl">0.1</span>)</span>
<span id="cb13-101"><a href="data-overview.html#cb13-101" tabindex="-1"></a>        , <span class="at">q50 =</span> <span class="sc">~</span><span class="fu">quantile</span>(.x,<span class="at">na.rm=</span>T,<span class="at">probs=</span><span class="fl">0.5</span>)</span>
<span id="cb13-102"><a href="data-overview.html#cb13-102" tabindex="-1"></a>        , <span class="at">q90 =</span> <span class="sc">~</span><span class="fu">quantile</span>(.x,<span class="at">na.rm=</span>T,<span class="at">probs=</span><span class="fl">0.9</span>)</span>
<span id="cb13-103"><a href="data-overview.html#cb13-103" tabindex="-1"></a>        , <span class="at">min =</span> <span class="sc">~</span><span class="fu">min</span>(.x,<span class="at">na.rm=</span>T)</span>
<span id="cb13-104"><a href="data-overview.html#cb13-104" tabindex="-1"></a>        , <span class="at">max =</span> <span class="sc">~</span><span class="fu">max</span>(.x,<span class="at">na.rm=</span>T)</span>
<span id="cb13-105"><a href="data-overview.html#cb13-105" tabindex="-1"></a>      )</span>
<span id="cb13-106"><a href="data-overview.html#cb13-106" tabindex="-1"></a>    )</span>
<span id="cb13-107"><a href="data-overview.html#cb13-107" tabindex="-1"></a>    , <span class="at">n =</span> dplyr<span class="sc">::</span><span class="fu">n</span>()</span>
<span id="cb13-108"><a href="data-overview.html#cb13-108" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb13-109"><a href="data-overview.html#cb13-109" tabindex="-1"></a>  <span class="co"># dplyr::ungroup() %&gt;% </span></span>
<span id="cb13-110"><a href="data-overview.html#cb13-110" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span><span class="fu">c</span>(n)) <span class="sc">%&gt;%</span> </span>
<span id="cb13-111"><a href="data-overview.html#cb13-111" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb13-112"><a href="data-overview.html#cb13-112" tabindex="-1"></a>    <span class="at">agg =</span> stringr<span class="sc">::</span><span class="fu">word</span>(name,<span class="sc">-</span><span class="dv">1</span>,<span class="at">sep =</span> <span class="st">&quot;_&quot;</span>)</span>
<span id="cb13-113"><a href="data-overview.html#cb13-113" tabindex="-1"></a>    , <span class="at">metric =</span> stringr<span class="sc">::</span><span class="fu">str_remove_all</span>(name, <span class="fu">paste0</span>(<span class="st">&quot;_&quot;</span>,agg)) <span class="sc">%&gt;%</span> </span>
<span id="cb13-114"><a href="data-overview.html#cb13-114" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_extract</span>(<span class="st">&quot;(paraboloid_volume|volume|area|height|diameter)&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb13-115"><a href="data-overview.html#cb13-115" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">coalesce</span>(<span class="st">&quot;detection&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb13-116"><a href="data-overview.html#cb13-116" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_c</span>(</span>
<span id="cb13-117"><a href="data-overview.html#cb13-117" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb13-118"><a href="data-overview.html#cb13-118" tabindex="-1"></a>          stringr<span class="sc">::</span><span class="fu">str_detect</span>(name,<span class="st">&quot;(field|image)&quot;</span>) <span class="sc">~</span> <span class="fu">paste0</span>(<span class="st">&quot; (&quot;</span>, stringr<span class="sc">::</span><span class="fu">str_extract</span>(name,<span class="st">&quot;(field|image)&quot;</span>), <span class="st">&quot;)&quot;</span>)</span>
<span id="cb13-119"><a href="data-overview.html#cb13-119" tabindex="-1"></a>          , T <span class="sc">~</span> <span class="st">&quot;&quot;</span></span>
<span id="cb13-120"><a href="data-overview.html#cb13-120" tabindex="-1"></a>        )</span>
<span id="cb13-121"><a href="data-overview.html#cb13-121" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span> </span>
<span id="cb13-122"><a href="data-overview.html#cb13-122" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_replace</span>(<span class="st">&quot;area&quot;</span>, <span class="st">&quot;area m&lt;sup&gt;2&lt;/sup&gt;&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb13-123"><a href="data-overview.html#cb13-123" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_replace</span>(<span class="st">&quot;volume&quot;</span>, <span class="st">&quot;volume m&lt;sup&gt;3&lt;/sup&gt;&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb13-124"><a href="data-overview.html#cb13-124" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_replace</span>(<span class="st">&quot;diameter&quot;</span>, <span class="st">&quot;diameter m&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb13-125"><a href="data-overview.html#cb13-125" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_replace</span>(<span class="st">&quot;height&quot;</span>, <span class="st">&quot;height m&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb13-126"><a href="data-overview.html#cb13-126" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_to_sentence</span>()</span>
<span id="cb13-127"><a href="data-overview.html#cb13-127" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb13-128"><a href="data-overview.html#cb13-128" tabindex="-1"></a>  <span class="co"># dplyr::count(metric)</span></span>
<span id="cb13-129"><a href="data-overview.html#cb13-129" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>name) <span class="sc">%&gt;%</span> </span>
<span id="cb13-130"><a href="data-overview.html#cb13-130" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb13-131"><a href="data-overview.html#cb13-131" tabindex="-1"></a>    <span class="at">value =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb13-132"><a href="data-overview.html#cb13-132" tabindex="-1"></a>      <span class="co"># metric == &quot;gt_height_m&quot; ~ scales::comma(value,accuracy=0.1)</span></span>
<span id="cb13-133"><a href="data-overview.html#cb13-133" tabindex="-1"></a>      T <span class="sc">~</span> scales<span class="sc">::</span><span class="fu">comma</span>(value,<span class="at">accuracy=</span><span class="fl">0.1</span>)</span>
<span id="cb13-134"><a href="data-overview.html#cb13-134" tabindex="-1"></a>    )</span>
<span id="cb13-135"><a href="data-overview.html#cb13-135" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb13-136"><a href="data-overview.html#cb13-136" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_wider</span>(<span class="at">names_from =</span> agg, <span class="at">values_from =</span> value) <span class="sc">%&gt;%</span> </span>
<span id="cb13-137"><a href="data-overview.html#cb13-137" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb13-138"><a href="data-overview.html#cb13-138" tabindex="-1"></a>    <span class="at">range =</span> <span class="fu">paste0</span>(min, <span class="st">&quot;—&quot;</span>, max)</span>
<span id="cb13-139"><a href="data-overview.html#cb13-139" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb13-140"><a href="data-overview.html#cb13-140" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(<span class="fu">desc</span>(n)) <span class="sc">%&gt;%</span> </span>
<span id="cb13-141"><a href="data-overview.html#cb13-141" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(min,max)) <span class="sc">%&gt;%</span> </span>
<span id="cb13-142"><a href="data-overview.html#cb13-142" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kbl</span>(</span>
<span id="cb13-143"><a href="data-overview.html#cb13-143" tabindex="-1"></a>    <span class="at">caption =</span> caption</span>
<span id="cb13-144"><a href="data-overview.html#cb13-144" tabindex="-1"></a>    , <span class="at">col.names =</span> <span class="fu">c</span>(</span>
<span id="cb13-145"><a href="data-overview.html#cb13-145" tabindex="-1"></a>      <span class="st">&quot;# piles&quot;</span>, <span class="st">&quot;Metric&quot;</span></span>
<span id="cb13-146"><a href="data-overview.html#cb13-146" tabindex="-1"></a>      , <span class="st">&quot;Mean&quot;</span></span>
<span id="cb13-147"><a href="data-overview.html#cb13-147" tabindex="-1"></a>      , <span class="st">&quot;Std Dev&quot;</span></span>
<span id="cb13-148"><a href="data-overview.html#cb13-148" tabindex="-1"></a>      , <span class="st">&quot;q 10%&quot;</span>, <span class="st">&quot;Median&quot;</span>, <span class="st">&quot;q 90%&quot;</span></span>
<span id="cb13-149"><a href="data-overview.html#cb13-149" tabindex="-1"></a>      , <span class="st">&quot;Range&quot;</span></span>
<span id="cb13-150"><a href="data-overview.html#cb13-150" tabindex="-1"></a>    )</span>
<span id="cb13-151"><a href="data-overview.html#cb13-151" tabindex="-1"></a>    , <span class="at">escape =</span> F</span>
<span id="cb13-152"><a href="data-overview.html#cb13-152" tabindex="-1"></a>    <span class="co"># , digits = 2</span></span>
<span id="cb13-153"><a href="data-overview.html#cb13-153" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb13-154"><a href="data-overview.html#cb13-154" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kable_styling</span>(<span class="at">font_size =</span> <span class="dv">13</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb13-155"><a href="data-overview.html#cb13-155" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">collapse_rows</span>(<span class="at">columns =</span> <span class="dv">1</span>, <span class="at">valign =</span> <span class="st">&quot;top&quot;</span>)</span>
<span id="cb13-156"><a href="data-overview.html#cb13-156" tabindex="-1"></a>}</span></code></pre></div>
<p>summary statistics for the form measurements for all study sites</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="data-overview.html#cb14-1" tabindex="-1"></a><span class="fu">agg_piles_temp</span>(</span>
<span id="cb14-2"><a href="data-overview.html#cb14-2" tabindex="-1"></a>  psinf_slash_piles_polys <span class="sc">%&gt;%</span> </span>
<span id="cb14-3"><a href="data-overview.html#cb14-3" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>tidyselect<span class="sc">::</span><span class="fu">starts_with</span>(<span class="st">&quot;field_gt_area&quot;</span>))</span>
<span id="cb14-4"><a href="data-overview.html#cb14-4" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb14-5"><a href="data-overview.html#cb14-5" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(</span>
<span id="cb14-6"><a href="data-overview.html#cb14-6" tabindex="-1"></a>    <span class="fu">agg_piles_temp</span>(</span>
<span id="cb14-7"><a href="data-overview.html#cb14-7" tabindex="-1"></a>      pj_slash_piles_polys <span class="sc">%&gt;%</span> </span>
<span id="cb14-8"><a href="data-overview.html#cb14-8" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb14-9"><a href="data-overview.html#cb14-9" tabindex="-1"></a>          <span class="sc">-</span>tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;field&quot;</span>)</span>
<span id="cb14-10"><a href="data-overview.html#cb14-10" tabindex="-1"></a>          , <span class="sc">-</span>tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;height&quot;</span>)</span>
<span id="cb14-11"><a href="data-overview.html#cb14-11" tabindex="-1"></a>        )</span>
<span id="cb14-12"><a href="data-overview.html#cb14-12" tabindex="-1"></a>    )</span>
<span id="cb14-13"><a href="data-overview.html#cb14-13" tabindex="-1"></a>    , <span class="fu">agg_piles_temp</span>(bhef_slash_piles_polys)</span>
<span id="cb14-14"><a href="data-overview.html#cb14-14" tabindex="-1"></a>    , <span class="fu">agg_piles_temp</span>(arnf_slash_piles_polys)</span>
<span id="cb14-15"><a href="data-overview.html#cb14-15" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb14-16"><a href="data-overview.html#cb14-16" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb14-17"><a href="data-overview.html#cb14-17" tabindex="-1"></a>    site, n</span>
<span id="cb14-18"><a href="data-overview.html#cb14-18" tabindex="-1"></a>    , tidyselect<span class="sc">::</span><span class="fu">starts_with</span>(<span class="st">&quot;image_&quot;</span>)</span>
<span id="cb14-19"><a href="data-overview.html#cb14-19" tabindex="-1"></a>    , tidyselect<span class="sc">::</span><span class="fu">starts_with</span>(<span class="st">&quot;field_&quot;</span>)</span>
<span id="cb14-20"><a href="data-overview.html#cb14-20" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb14-21"><a href="data-overview.html#cb14-21" tabindex="-1"></a>  <span class="fu">kbl_form_sum_stats_wide</span>(<span class="at">by_lab =</span> <span class="st">&quot;by study site&quot;</span>)  </span></code></pre></div>
<div style="border: 1px solid #ddd; padding: 5px; overflow-x: scroll; width:740px; ">
<table class="table" style="font-size: 11.5px; margin-left: auto; margin-right: auto;">
<caption style="font-size: initial !important;">
<span id="tab:unnamed-chunk-17">Table 2.2: </span>Slash pile image-annotated and field-collected form measurements<br>by study site
</caption>
<thead>
<tr>
<th style="empty-cells: hide;border-bottom:hidden;" colspan="2">
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="3">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Image-Ann. Area (m<sup>2</sup>)
</div>
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="3">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Image-Ann. Diam (m)
</div>
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="3">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Field-Meas. Diam (m)
</div>
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="3">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Field-Meas. Height (m)
</div>
</th>
</tr>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:left;border-right:1px solid;font-size: 11px;">
Piles
</th>
<th style="text-align:left;font-size: 11px;">
Mean
</th>
<th style="text-align:left;font-size: 11px;">
Std Dev
</th>
<th style="text-align:left;border-right:1px solid;font-size: 11px;">
Range
</th>
<th style="text-align:left;font-size: 11px;">
Mean
</th>
<th style="text-align:left;font-size: 11px;">
Std Dev
</th>
<th style="text-align:left;border-right:1px solid;font-size: 11px;">
Range
</th>
<th style="text-align:left;font-size: 11px;">
Mean
</th>
<th style="text-align:left;font-size: 11px;">
Std Dev
</th>
<th style="text-align:left;border-right:1px solid;font-size: 11px;">
Range
</th>
<th style="text-align:left;font-size: 11px;">
Mean
</th>
<th style="text-align:left;font-size: 11px;">
Std Dev
</th>
<th style="text-align:left;border-right:1px solid;font-size: 11px;">
Range
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
PSINF Mixed Conifer Site
</td>
<td style="text-align:left;border-right:1px solid;font-size: 11px;">
121
</td>
<td style="text-align:left;font-size: 11px;">
9.8
</td>
<td style="text-align:left;font-size: 11px;">
9.4
</td>
<td style="text-align:left;border-right:1px solid;font-size: 11px;">
3.9-59.3
</td>
<td style="text-align:left;font-size: 11px;">
3.8
</td>
<td style="text-align:left;font-size: 11px;">
1.3
</td>
<td style="text-align:left;border-right:1px solid;font-size: 11px;">
2.6-10.2
</td>
<td style="text-align:left;font-size: 11px;">
3.4
</td>
<td style="text-align:left;font-size: 11px;">
1.2
</td>
<td style="text-align:left;border-right:1px solid;font-size: 11px;">
2.4-9.0
</td>
<td style="text-align:left;font-size: 11px;">
2.2
</td>
<td style="text-align:left;font-size: 11px;">
0.8
</td>
<td style="text-align:left;border-right:1px solid;font-size: 11px;">
1.5-6.4
</td>
</tr>
<tr>
<td style="text-align:left;">
TRFO-BLM Pinyon-Juniper Site
</td>
<td style="text-align:left;border-right:1px solid;font-size: 11px;">
277
</td>
<td style="text-align:left;font-size: 11px;">
10.6
</td>
<td style="text-align:left;font-size: 11px;">
3.2
</td>
<td style="text-align:left;border-right:1px solid;font-size: 11px;">
4.1-25.3
</td>
<td style="text-align:left;font-size: 11px;">
4.2
</td>
<td style="text-align:left;font-size: 11px;">
0.6
</td>
<td style="text-align:left;border-right:1px solid;font-size: 11px;">
2.6-6.4
</td>
<td style="text-align:left;font-size: 11px;">
NA
</td>
<td style="text-align:left;font-size: 11px;">
NA
</td>
<td style="text-align:left;border-right:1px solid;font-size: 11px;">
NA
</td>
<td style="text-align:left;font-size: 11px;">
NA
</td>
<td style="text-align:left;font-size: 11px;">
NA
</td>
<td style="text-align:left;border-right:1px solid;font-size: 11px;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
BHEF Ponderosa Pine Site
</td>
<td style="text-align:left;border-right:1px solid;font-size: 11px;">
26
</td>
<td style="text-align:left;font-size: 11px;">
199.9
</td>
<td style="text-align:left;font-size: 11px;">
85.8
</td>
<td style="text-align:left;border-right:1px solid;font-size: 11px;">
76.0-408.7
</td>
<td style="text-align:left;font-size: 11px;">
21.0
</td>
<td style="text-align:left;font-size: 11px;">
6.5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 11px;">
13.3-38.0
</td>
<td style="text-align:left;font-size: 11px;">
NA
</td>
<td style="text-align:left;font-size: 11px;">
NA
</td>
<td style="text-align:left;border-right:1px solid;font-size: 11px;">
NA
</td>
<td style="text-align:left;font-size: 11px;">
NA
</td>
<td style="text-align:left;font-size: 11px;">
NA
</td>
<td style="text-align:left;border-right:1px solid;font-size: 11px;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
ARNF Ponderosa Pine Site
</td>
<td style="text-align:left;border-right:1px solid;font-size: 11px;">
19
</td>
<td style="text-align:left;font-size: 11px;">
409.0
</td>
<td style="text-align:left;font-size: 11px;">
97.1
</td>
<td style="text-align:left;border-right:1px solid;font-size: 11px;">
221.5-593.1
</td>
<td style="text-align:left;font-size: 11px;">
25.9
</td>
<td style="text-align:left;font-size: 11px;">
3.6
</td>
<td style="text-align:left;border-right:1px solid;font-size: 11px;">
18.4-32.9
</td>
<td style="text-align:left;font-size: 11px;">
NA
</td>
<td style="text-align:left;font-size: 11px;">
NA
</td>
<td style="text-align:left;border-right:1px solid;font-size: 11px;">
NA
</td>
<td style="text-align:left;font-size: 11px;">
NA
</td>
<td style="text-align:left;font-size: 11px;">
NA
</td>
<td style="text-align:left;border-right:1px solid;font-size: 11px;">
NA
</td>
</tr>
</tbody>
</table>
</div>
<p>All sites except PSINF have only mechanical or only hand piles whereas PSINF has both hand piles and mechanical piles. Let’s look at the summary statistics for the form measurements for only PSINF based on pile construction type</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="data-overview.html#cb15-1" tabindex="-1"></a>psinf_slash_piles_polys <span class="sc">%&gt;%</span> </span>
<span id="cb15-2"><a href="data-overview.html#cb15-2" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb15-3"><a href="data-overview.html#cb15-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(is_in_stand) <span class="sc">%&gt;%</span> </span>
<span id="cb15-4"><a href="data-overview.html#cb15-4" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb15-5"><a href="data-overview.html#cb15-5" tabindex="-1"></a>    <span class="sc">-</span>tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;volume_m3&quot;</span>)</span>
<span id="cb15-6"><a href="data-overview.html#cb15-6" tabindex="-1"></a>    , <span class="sc">-</span>tidyselect<span class="sc">::</span><span class="fu">starts_with</span>(<span class="st">&quot;field_gt_area&quot;</span>)</span>
<span id="cb15-7"><a href="data-overview.html#cb15-7" tabindex="-1"></a>    , <span class="sc">-</span><span class="fu">c</span>(site)</span>
<span id="cb15-8"><a href="data-overview.html#cb15-8" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb15-9"><a href="data-overview.html#cb15-9" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">pile_type =</span> comment) <span class="sc">%&gt;%</span> </span>
<span id="cb15-10"><a href="data-overview.html#cb15-10" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(pile_type) <span class="sc">%&gt;%</span> </span>
<span id="cb15-11"><a href="data-overview.html#cb15-11" tabindex="-1"></a>  <span class="fu">agg_piles_temp</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb15-12"><a href="data-overview.html#cb15-12" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb15-13"><a href="data-overview.html#cb15-13" tabindex="-1"></a>    pile_type, n</span>
<span id="cb15-14"><a href="data-overview.html#cb15-14" tabindex="-1"></a>    , tidyselect<span class="sc">::</span><span class="fu">starts_with</span>(<span class="st">&quot;image_&quot;</span>)</span>
<span id="cb15-15"><a href="data-overview.html#cb15-15" tabindex="-1"></a>    , tidyselect<span class="sc">::</span><span class="fu">starts_with</span>(<span class="st">&quot;field_&quot;</span>)</span>
<span id="cb15-16"><a href="data-overview.html#cb15-16" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb15-17"><a href="data-overview.html#cb15-17" tabindex="-1"></a>  <span class="fu">kbl_form_sum_stats_wide</span>(<span class="at">by_lab =</span> <span class="st">&quot;PSINF Mixed Conifer Site by pile type&quot;</span>)  </span></code></pre></div>
<div style="border: 1px solid #ddd; padding: 5px; overflow-x: scroll; width:740px; ">
<table class="table" style="font-size: 11.5px; margin-left: auto; margin-right: auto;">
<caption style="font-size: initial !important;">
<span id="tab:unnamed-chunk-18">Table 2.3: </span>Slash pile image-annotated and field-collected form measurements<br>PSINF Mixed Conifer Site by pile type
</caption>
<thead>
<tr>
<th style="empty-cells: hide;border-bottom:hidden;" colspan="2">
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="3">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Image-Ann. Area (m<sup>2</sup>)
</div>
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="3">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Image-Ann. Diam (m)
</div>
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="3">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Field-Meas. Diam (m)
</div>
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="3">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Field-Meas. Height (m)
</div>
</th>
</tr>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:left;border-right:1px solid;font-size: 11px;">
Piles
</th>
<th style="text-align:left;font-size: 11px;">
Mean
</th>
<th style="text-align:left;font-size: 11px;">
Std Dev
</th>
<th style="text-align:left;border-right:1px solid;font-size: 11px;">
Range
</th>
<th style="text-align:left;font-size: 11px;">
Mean
</th>
<th style="text-align:left;font-size: 11px;">
Std Dev
</th>
<th style="text-align:left;border-right:1px solid;font-size: 11px;">
Range
</th>
<th style="text-align:left;font-size: 11px;">
Mean
</th>
<th style="text-align:left;font-size: 11px;">
Std Dev
</th>
<th style="text-align:left;border-right:1px solid;font-size: 11px;">
Range
</th>
<th style="text-align:left;font-size: 11px;">
Mean
</th>
<th style="text-align:left;font-size: 11px;">
Std Dev
</th>
<th style="text-align:left;border-right:1px solid;font-size: 11px;">
Range
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Hand Pile
</td>
<td style="text-align:left;border-right:1px solid;font-size: 11px;">
111
</td>
<td style="text-align:left;font-size: 11px;">
7.2
</td>
<td style="text-align:left;font-size: 11px;">
1.7
</td>
<td style="text-align:left;border-right:1px solid;font-size: 11px;">
3.9-14.3
</td>
<td style="text-align:left;font-size: 11px;">
3.5
</td>
<td style="text-align:left;font-size: 11px;">
0.4
</td>
<td style="text-align:left;border-right:1px solid;font-size: 11px;">
2.6-5.0
</td>
<td style="text-align:left;font-size: 11px;">
3.1
</td>
<td style="text-align:left;font-size: 11px;">
0.3
</td>
<td style="text-align:left;border-right:1px solid;font-size: 11px;">
2.4-4.3
</td>
<td style="text-align:left;font-size: 11px;">
2.0
</td>
<td style="text-align:left;font-size: 11px;">
0.2
</td>
<td style="text-align:left;border-right:1px solid;font-size: 11px;">
1.5-2.4
</td>
</tr>
<tr>
<td style="text-align:left;">
Mechanical Pile
</td>
<td style="text-align:left;border-right:1px solid;font-size: 11px;">
10
</td>
<td style="text-align:left;font-size: 11px;">
38.3
</td>
<td style="text-align:left;font-size: 11px;">
12.7
</td>
<td style="text-align:left;border-right:1px solid;font-size: 11px;">
21.3-59.3
</td>
<td style="text-align:left;font-size: 11px;">
8.0
</td>
<td style="text-align:left;font-size: 11px;">
1.3
</td>
<td style="text-align:left;border-right:1px solid;font-size: 11px;">
5.9-10.2
</td>
<td style="text-align:left;font-size: 11px;">
7.2
</td>
<td style="text-align:left;font-size: 11px;">
1.1
</td>
<td style="text-align:left;border-right:1px solid;font-size: 11px;">
5.5-9.0
</td>
<td style="text-align:left;font-size: 11px;">
4.4
</td>
<td style="text-align:left;font-size: 11px;">
1.2
</td>
<td style="text-align:left;border-right:1px solid;font-size: 11px;">
2.4-6.4
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="image-annotation-comparison" class="section level3 hasAnchor" number="2.2.3">
<h3><span class="header-section-number">2.2.3</span> Image-Annotation Comparison<a href="data-overview.html#image-annotation-comparison" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>For only the PSINF site, let’s check the field-collected and image-annotated measurements of diameter which will serve as a good sanity check for our image-annotation process (assuming diameter was accurately measured in the field…might be a perilous assumption)</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="data-overview.html#cb16-1" tabindex="-1"></a>psinf_slash_piles_polys <span class="sc">%&gt;%</span> </span>
<span id="cb16-2"><a href="data-overview.html#cb16-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">diff_diameter_m =</span> image_gt_diameter_m <span class="sc">-</span> field_diameter_m) <span class="sc">%&gt;%</span> </span>
<span id="cb16-3"><a href="data-overview.html#cb16-3" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> image_gt_diameter_m, <span class="at">y =</span> field_diameter_m)) <span class="sc">+</span></span>
<span id="cb16-4"><a href="data-overview.html#cb16-4" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_abline</span>(<span class="at">lwd =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb16-5"><a href="data-overview.html#cb16-5" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_point</span>(ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">color =</span> diff_diameter_m)) <span class="sc">+</span></span>
<span id="cb16-6"><a href="data-overview.html#cb16-6" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="at">se=</span>F, <span class="at">color =</span> <span class="st">&quot;tomato&quot;</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb16-7"><a href="data-overview.html#cb16-7" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_color_viridis_c</span>(<span class="at">option =</span> <span class="st">&quot;mako&quot;</span>, <span class="at">direction =</span> <span class="sc">-</span><span class="dv">1</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb16-8"><a href="data-overview.html#cb16-8" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">max</span>( <span class="fu">max</span>(psinf_slash_piles_polys<span class="sc">$</span>field_diameter_m,<span class="at">na.rm=</span>T), <span class="fu">max</span>(psinf_slash_piles_polys<span class="sc">$</span>image_gt_diameter_m,<span class="at">na.rm=</span>T) ) )) <span class="sc">+</span></span>
<span id="cb16-9"><a href="data-overview.html#cb16-9" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">max</span>( <span class="fu">max</span>(psinf_slash_piles_polys<span class="sc">$</span>field_diameter_m,<span class="at">na.rm=</span>T), <span class="fu">max</span>(psinf_slash_piles_polys<span class="sc">$</span>image_gt_diameter_m,<span class="at">na.rm=</span>T) ) )) <span class="sc">+</span></span>
<span id="cb16-10"><a href="data-overview.html#cb16-10" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb16-11"><a href="data-overview.html#cb16-11" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;image-annotated diameter (m)&quot;</span>, <span class="at">y =</span> <span class="st">&quot;field-collected diameter (m)&quot;</span></span>
<span id="cb16-12"><a href="data-overview.html#cb16-12" tabindex="-1"></a>    , <span class="at">color =</span> <span class="st">&quot;image-field</span><span class="sc">\n</span><span class="st">diameter diff.&quot;</span></span>
<span id="cb16-13"><a href="data-overview.html#cb16-13" tabindex="-1"></a>    , <span class="at">subtitle =</span> <span class="st">&quot;diameter (m) comparison&quot;</span></span>
<span id="cb16-14"><a href="data-overview.html#cb16-14" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb16-15"><a href="data-overview.html#cb16-15" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_light</span>()</span></code></pre></div>
<p><img src="slash_pile_detecting_files/figure-html/unnamed-chunk-19-1.png" width="1008" /></p>
<p>the plot makes these values look very similar with the image-annotated diameter generally larger than the field-collected value. let’s check these using <code>lm()</code></p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="data-overview.html#cb17-1" tabindex="-1"></a>lm_temp <span class="ot">&lt;-</span> <span class="fu">lm</span>(field_diameter_m <span class="sc">~</span> image_gt_diameter_m, <span class="at">data =</span> psinf_slash_piles_polys)</span>
<span id="cb17-2"><a href="data-overview.html#cb17-2" tabindex="-1"></a><span class="fu">summary</span>(lm_temp)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = field_diameter_m ~ image_gt_diameter_m, data = psinf_slash_piles_polys)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -1.18985 -0.16525  0.01416  0.16807  1.76883 
## 
## Coefficients:
##                     Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)          0.13522    0.09891   1.367    0.174    
## image_gt_diameter_m  0.86403    0.02436  35.471   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.3593 on 119 degrees of freedom
##   (66 observations deleted due to missingness)
## Multiple R-squared:  0.9136, Adjusted R-squared:  0.9129 
## F-statistic:  1258 on 1 and 119 DF,  p-value: &lt; 2.2e-16</code></pre>
<p>Our slope of 0.86 is close to 1 and, along with our high R-squared value of 91%, indicate our image- and field-measured diameters are well-calibrated</p>
<p>let’s use a paired t-test to determine if the mean difference (MD) between the field-measured diameter and the image-annotated diameter is statistically significant (i.e. significantly different from zero)</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="data-overview.html#cb19-1" tabindex="-1"></a><span class="co"># is the mean difference between the two diameters significantly different from zero</span></span>
<span id="cb19-2"><a href="data-overview.html#cb19-2" tabindex="-1"></a>ttest_temp <span class="ot">&lt;-</span> <span class="fu">t.test</span>(</span>
<span id="cb19-3"><a href="data-overview.html#cb19-3" tabindex="-1"></a>  psinf_slash_piles_polys <span class="sc">%&gt;%</span> </span>
<span id="cb19-4"><a href="data-overview.html#cb19-4" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(field_diameter_m), <span class="sc">!</span><span class="fu">is.na</span>(image_gt_diameter_m)) <span class="sc">%&gt;%</span> </span>
<span id="cb19-5"><a href="data-overview.html#cb19-5" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">pull</span>(field_diameter_m)</span>
<span id="cb19-6"><a href="data-overview.html#cb19-6" tabindex="-1"></a>  , psinf_slash_piles_polys <span class="sc">%&gt;%</span> </span>
<span id="cb19-7"><a href="data-overview.html#cb19-7" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(field_diameter_m), <span class="sc">!</span><span class="fu">is.na</span>(image_gt_diameter_m)) <span class="sc">%&gt;%</span> </span>
<span id="cb19-8"><a href="data-overview.html#cb19-8" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">pull</span>(image_gt_diameter_m)</span>
<span id="cb19-9"><a href="data-overview.html#cb19-9" tabindex="-1"></a>  , <span class="at">paired =</span> <span class="cn">TRUE</span></span>
<span id="cb19-10"><a href="data-overview.html#cb19-10" tabindex="-1"></a>)</span>
<span id="cb19-11"><a href="data-overview.html#cb19-11" tabindex="-1"></a>ttest_temp</span></code></pre></div>
<pre><code>## 
##  Paired t-test
## 
## data:  psinf_slash_piles_polys %&gt;% dplyr::filter(!is.na(field_diameter_m), !is.na(image_gt_diameter_m)) %&gt;% dplyr::pull(field_diameter_m) and psinf_slash_piles_polys %&gt;% dplyr::filter(!is.na(field_diameter_m), !is.na(image_gt_diameter_m)) %&gt;% dplyr::pull(image_gt_diameter_m)
## t = -10.563, df = 120, p-value &lt; 2.2e-16
## alternative hypothesis: true mean difference is not equal to 0
## 95 percent confidence interval:
##  -0.4583169 -0.3136208
## sample estimates:
## mean difference 
##      -0.3859688</code></pre>
<p>the mean difference (MD) is -0.39 m (field-measured minus image-annotated value). also, the p-value of 0.00001 is less than 0.05, meaning we should reject the null hypothesis that the true mean difference is zero. this confirms that the systematic difference (or bias) we observed where image-annotated diameter is larger than the field-measured diameter is statistically significant and not due to random chance</p>
</div>
</div>
<div id="rgb-orthomosaic" class="section level2 hasAnchor" number="2.3">
<h2><span class="header-section-number">2.3</span> RGB orthomosaic<a href="data-overview.html#rgb-orthomosaic" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Orthomosaic <code>tif</code> files from UAS flight imagery were created in the photogrammetry software (e.g. <a href="https://www.agisoft.com/">Agisoft Metashape</a>). Each of our study sites have RGB data available covering the study area extent.</p>
<p>We’re going to standardize the raster resolution of these RGB data across study sites. The RGB orthomosaics created from UAS photogrammetry processing generally have very fine resolutions of 4 cm or finer and we will standardize the data to make it slightly more coarse (6 cm) to reduce the computational processing burden.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="data-overview.html#cb21-1" tabindex="-1"></a>my_rgb_res_m <span class="ot">&lt;-</span> <span class="fl">0.06</span></span></code></pre></div>
<div id="psinf-mixed-conifer-site" class="section level3 hasAnchor" number="2.3.1">
<h3><span class="header-section-number">2.3.1</span> PSINF Mixed Conifer Site<a href="data-overview.html#psinf-mixed-conifer-site" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>load the original data</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="data-overview.html#cb22-1" tabindex="-1"></a><span class="do">#### read RGB data keep only RGB</span></span>
<span id="cb22-2"><a href="data-overview.html#cb22-2" tabindex="-1"></a>psinf_rgb_rast <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rast</span>(</span>
<span id="cb22-3"><a href="data-overview.html#cb22-3" tabindex="-1"></a>    <span class="fu">file.path</span>(</span>
<span id="cb22-4"><a href="data-overview.html#cb22-4" tabindex="-1"></a>      <span class="st">&quot;f:</span><span class="sc">\\</span><span class="st">PFDP_Data</span><span class="sc">\\</span><span class="st">p4pro_images</span><span class="sc">\\</span><span class="st">P4Pro_06_17_2021_half_half_optimal</span><span class="sc">\\</span><span class="st">3_dsm_ortho</span><span class="sc">\\</span><span class="st">2_mosaic&quot;</span></span>
<span id="cb22-5"><a href="data-overview.html#cb22-5" tabindex="-1"></a>      , <span class="st">&quot;P4Pro_06_17_2021_half_half_optimal_transparent_mosaic_group1.tif&quot;</span></span>
<span id="cb22-6"><a href="data-overview.html#cb22-6" tabindex="-1"></a>    )</span>
<span id="cb22-7"><a href="data-overview.html#cb22-7" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb22-8"><a href="data-overview.html#cb22-8" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">subset</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>))</span>
<span id="cb22-9"><a href="data-overview.html#cb22-9" tabindex="-1"></a><span class="co"># rename bands</span></span>
<span id="cb22-10"><a href="data-overview.html#cb22-10" tabindex="-1"></a><span class="fu">names</span>(psinf_rgb_rast) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;red&quot;</span>,<span class="st">&quot;green&quot;</span>,<span class="st">&quot;blue&quot;</span>)</span></code></pre></div>
<p>what is the resolution of the original RGB data?</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="data-overview.html#cb23-1" tabindex="-1"></a>terra<span class="sc">::</span><span class="fu">res</span>(psinf_rgb_rast)</span></code></pre></div>
<pre><code>## [1] 0.02632 0.02632</code></pre>
<p>let’s reduce the resolution (i.e. increase the raster cell size; make more coarse)</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="data-overview.html#cb25-1" tabindex="-1"></a><span class="do">## function to change the resolution of RGB </span></span>
<span id="cb25-2"><a href="data-overview.html#cb25-2" tabindex="-1"></a>change_res_fn <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb25-3"><a href="data-overview.html#cb25-3" tabindex="-1"></a>  r</span>
<span id="cb25-4"><a href="data-overview.html#cb25-4" tabindex="-1"></a>  , <span class="at">my_res=</span><span class="dv">1</span></span>
<span id="cb25-5"><a href="data-overview.html#cb25-5" tabindex="-1"></a>  , <span class="at">m =</span> <span class="st">&quot;bilinear&quot;</span></span>
<span id="cb25-6"><a href="data-overview.html#cb25-6" tabindex="-1"></a>  <span class="co"># , ofile = tempfile(fileext = &quot;.tif&quot;)</span></span>
<span id="cb25-7"><a href="data-overview.html#cb25-7" tabindex="-1"></a>  , <span class="at">ofile =</span> <span class="cn">NULL</span></span>
<span id="cb25-8"><a href="data-overview.html#cb25-8" tabindex="-1"></a>){</span>
<span id="cb25-9"><a href="data-overview.html#cb25-9" tabindex="-1"></a>  <span class="cf">if</span>(terra<span class="sc">::</span><span class="fu">res</span>(r)[<span class="dv">1</span>] <span class="sc">==</span> my_res){</span>
<span id="cb25-10"><a href="data-overview.html#cb25-10" tabindex="-1"></a>    <span class="fu">return</span>(r)</span>
<span id="cb25-11"><a href="data-overview.html#cb25-11" tabindex="-1"></a>  }<span class="cf">else</span>{</span>
<span id="cb25-12"><a href="data-overview.html#cb25-12" tabindex="-1"></a>    r2 <span class="ot">&lt;-</span> r</span>
<span id="cb25-13"><a href="data-overview.html#cb25-13" tabindex="-1"></a>    terra<span class="sc">::</span><span class="fu">res</span>(r2) <span class="ot">&lt;-</span> my_res</span>
<span id="cb25-14"><a href="data-overview.html#cb25-14" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span><span class="fu">inherits</span>(ofile,<span class="st">&quot;character&quot;</span>)){</span>
<span id="cb25-15"><a href="data-overview.html#cb25-15" tabindex="-1"></a>      r2 <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">resample</span>(r, r2, <span class="at">method =</span> m) </span>
<span id="cb25-16"><a href="data-overview.html#cb25-16" tabindex="-1"></a>    }<span class="cf">else</span>{</span>
<span id="cb25-17"><a href="data-overview.html#cb25-17" tabindex="-1"></a>      r2 <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">resample</span>(r, r2, <span class="at">method =</span> m, <span class="at">filename=</span>ofile, <span class="at">overwrite =</span> T) </span>
<span id="cb25-18"><a href="data-overview.html#cb25-18" tabindex="-1"></a>    }</span>
<span id="cb25-19"><a href="data-overview.html#cb25-19" tabindex="-1"></a>    <span class="fu">return</span>(r2) </span>
<span id="cb25-20"><a href="data-overview.html#cb25-20" tabindex="-1"></a>  }</span>
<span id="cb25-21"><a href="data-overview.html#cb25-21" tabindex="-1"></a>}</span>
<span id="cb25-22"><a href="data-overview.html#cb25-22" tabindex="-1"></a><span class="do">###############################################################</span></span>
<span id="cb25-23"><a href="data-overview.html#cb25-23" tabindex="-1"></a><span class="co"># clip to boundary and resample to change resolution</span></span>
<span id="cb25-24"><a href="data-overview.html#cb25-24" tabindex="-1"></a><span class="do">###############################################################</span></span>
<span id="cb25-25"><a href="data-overview.html#cb25-25" tabindex="-1"></a>dir_temp <span class="ot">&lt;-</span> <span class="st">&quot;../data/PFDP_Data/&quot;</span></span>
<span id="cb25-26"><a href="data-overview.html#cb25-26" tabindex="-1"></a>rgb_fnm_temp <span class="ot">&lt;-</span> <span class="fu">file.path</span>(dir_temp,<span class="st">&quot;psinf_rgb_rast.tif&quot;</span>) <span class="co"># what should the compiled rgb be called?</span></span>
<span id="cb25-27"><a href="data-overview.html#cb25-27" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">dir.exists</span>(dir_temp)){<span class="fu">dir.create</span>(dir_temp, <span class="at">showWarnings =</span> F)}</span>
<span id="cb25-28"><a href="data-overview.html#cb25-28" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(rgb_fnm_temp)){</span>
<span id="cb25-29"><a href="data-overview.html#cb25-29" tabindex="-1"></a>  <span class="co"># Crop the raster to the rectangular extent of the polygon</span></span>
<span id="cb25-30"><a href="data-overview.html#cb25-30" tabindex="-1"></a>  <span class="co"># Specify a filename to ensure the result is written to disk</span></span>
<span id="cb25-31"><a href="data-overview.html#cb25-31" tabindex="-1"></a>  crop_rgb_rast_temp <span class="ot">&lt;-</span> psinf_rgb_rast <span class="sc">%&gt;%</span> </span>
<span id="cb25-32"><a href="data-overview.html#cb25-32" tabindex="-1"></a>    terra<span class="sc">::</span><span class="fu">crop</span>(</span>
<span id="cb25-33"><a href="data-overview.html#cb25-33" tabindex="-1"></a>      psinf_stand_boundary <span class="sc">%&gt;%</span> </span>
<span id="cb25-34"><a href="data-overview.html#cb25-34" tabindex="-1"></a>        sf<span class="sc">::</span><span class="fu">st_union</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb25-35"><a href="data-overview.html#cb25-35" tabindex="-1"></a>        sf<span class="sc">::</span><span class="fu">st_buffer</span>(<span class="dv">10</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb25-36"><a href="data-overview.html#cb25-36" tabindex="-1"></a>        terra<span class="sc">::</span><span class="fu">vect</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb25-37"><a href="data-overview.html#cb25-37" tabindex="-1"></a>        terra<span class="sc">::</span><span class="fu">project</span>(terra<span class="sc">::</span><span class="fu">crs</span>(psinf_rgb_rast))</span>
<span id="cb25-38"><a href="data-overview.html#cb25-38" tabindex="-1"></a>      , <span class="at">filename =</span>  <span class="fu">tempfile</span>(<span class="at">fileext =</span> <span class="st">&quot;.tif&quot;</span>)</span>
<span id="cb25-39"><a href="data-overview.html#cb25-39" tabindex="-1"></a>      , <span class="at">overwrite =</span> <span class="cn">TRUE</span></span>
<span id="cb25-40"><a href="data-overview.html#cb25-40" tabindex="-1"></a>    ) </span>
<span id="cb25-41"><a href="data-overview.html#cb25-41" tabindex="-1"></a>  <span class="co"># Mask the cropped raster to the precise shape of the polygon</span></span>
<span id="cb25-42"><a href="data-overview.html#cb25-42" tabindex="-1"></a>  <span class="co"># This function will also be processed on disk due to the file size</span></span>
<span id="cb25-43"><a href="data-overview.html#cb25-43" tabindex="-1"></a>  psinf_rgb_rast <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">mask</span>(</span>
<span id="cb25-44"><a href="data-overview.html#cb25-44" tabindex="-1"></a>    crop_rgb_rast_temp</span>
<span id="cb25-45"><a href="data-overview.html#cb25-45" tabindex="-1"></a>    , psinf_stand_boundary <span class="sc">%&gt;%</span> </span>
<span id="cb25-46"><a href="data-overview.html#cb25-46" tabindex="-1"></a>      sf<span class="sc">::</span><span class="fu">st_union</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb25-47"><a href="data-overview.html#cb25-47" tabindex="-1"></a>      sf<span class="sc">::</span><span class="fu">st_buffer</span>(<span class="dv">10</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb25-48"><a href="data-overview.html#cb25-48" tabindex="-1"></a>      terra<span class="sc">::</span><span class="fu">vect</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb25-49"><a href="data-overview.html#cb25-49" tabindex="-1"></a>      terra<span class="sc">::</span><span class="fu">project</span>(terra<span class="sc">::</span><span class="fu">crs</span>(psinf_rgb_rast))</span>
<span id="cb25-50"><a href="data-overview.html#cb25-50" tabindex="-1"></a>    , <span class="at">filename =</span> <span class="fu">tempfile</span>(<span class="at">fileext =</span> <span class="st">&quot;.tif&quot;</span>)</span>
<span id="cb25-51"><a href="data-overview.html#cb25-51" tabindex="-1"></a>    , <span class="at">overwrite =</span> <span class="cn">TRUE</span></span>
<span id="cb25-52"><a href="data-overview.html#cb25-52" tabindex="-1"></a>  )</span>
<span id="cb25-53"><a href="data-overview.html#cb25-53" tabindex="-1"></a>  </span>
<span id="cb25-54"><a href="data-overview.html#cb25-54" tabindex="-1"></a>  <span class="do">## apply the change_res_fn for our analysis we don&#39;t need such finery</span></span>
<span id="cb25-55"><a href="data-overview.html#cb25-55" tabindex="-1"></a>  <span class="co"># this takes too long...</span></span>
<span id="cb25-56"><a href="data-overview.html#cb25-56" tabindex="-1"></a>  psinf_rgb_rast <span class="ot">&lt;-</span> <span class="fu">change_res_fn</span>(psinf_rgb_rast, <span class="at">my_res=</span>my_rgb_res_m, <span class="at">ofile =</span> rgb_fnm_temp)</span>
<span id="cb25-57"><a href="data-overview.html#cb25-57" tabindex="-1"></a>}<span class="cf">else</span>{</span>
<span id="cb25-58"><a href="data-overview.html#cb25-58" tabindex="-1"></a>  psinf_rgb_rast <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rast</span>(rgb_fnm_temp)</span>
<span id="cb25-59"><a href="data-overview.html#cb25-59" tabindex="-1"></a>}</span>
<span id="cb25-60"><a href="data-overview.html#cb25-60" tabindex="-1"></a><span class="co"># terra::res(psinf_rgb_rast)</span></span>
<span id="cb25-61"><a href="data-overview.html#cb25-61" tabindex="-1"></a><span class="co"># terra::plotRGB(bhef_rgb_rast, stretch = &quot;lin&quot;)</span></span></code></pre></div>
<p>make a function to plot the RGB imagery as a background for <code>ggplot2</code> plots. <code>ggplot2</code> offers capabilities to build multi-layered, publication-quality figures by stacking multiple vector overlays on an RGB background. however, it can be computationally expensive since it requires the conversion to a data frame first.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="data-overview.html#cb26-1" tabindex="-1"></a><span class="co"># make a function to plot these detected crowns with rgb data</span></span>
<span id="cb26-2"><a href="data-overview.html#cb26-2" tabindex="-1"></a>ortho_plt_fn <span class="ot">&lt;-</span> <span class="cf">function</span>(rgb_rast, stand, <span class="at">add_stand =</span> F, <span class="at">buffer =</span> <span class="dv">10</span>, <span class="at">plt_lwd =</span> <span class="dv">1</span>, <span class="at">plt_line_col =</span> <span class="st">&quot;black&quot;</span>){</span>
<span id="cb26-3"><a href="data-overview.html#cb26-3" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span><span class="fu">inherits</span>(rgb_rast,<span class="st">&quot;SpatRaster&quot;</span>)){<span class="fu">stop</span>(<span class="st">&quot;rgb_rast must be terra SpatRaster data&quot;</span>)}</span>
<span id="cb26-4"><a href="data-overview.html#cb26-4" tabindex="-1"></a>  <span class="cf">if</span>(terra<span class="sc">::</span><span class="fu">nlyr</span>(rgb_rast)<span class="sc">&lt;</span><span class="dv">3</span>){<span class="fu">stop</span>(<span class="st">&quot;rgb_rast must have 3 layers with RGB data&quot;</span>)}</span>
<span id="cb26-5"><a href="data-overview.html#cb26-5" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span><span class="fu">inherits</span>(stand,<span class="st">&quot;sf&quot;</span>) <span class="sc">&amp;&amp;</span> <span class="sc">!</span><span class="fu">inherits</span>(stand,<span class="st">&quot;sfc&quot;</span>)){<span class="fu">stop</span>(<span class="st">&quot;stand must be sf data&quot;</span>)}</span>
<span id="cb26-6"><a href="data-overview.html#cb26-6" tabindex="-1"></a>  <span class="co"># crop</span></span>
<span id="cb26-7"><a href="data-overview.html#cb26-7" tabindex="-1"></a>  crp_rgb_rast_temp <span class="ot">&lt;-</span> rgb_rast <span class="sc">%&gt;%</span> </span>
<span id="cb26-8"><a href="data-overview.html#cb26-8" tabindex="-1"></a>    terra<span class="sc">::</span><span class="fu">crop</span>(</span>
<span id="cb26-9"><a href="data-overview.html#cb26-9" tabindex="-1"></a>      stand <span class="sc">%&gt;%</span> </span>
<span id="cb26-10"><a href="data-overview.html#cb26-10" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb26-11"><a href="data-overview.html#cb26-11" tabindex="-1"></a>        sf<span class="sc">::</span><span class="fu">st_union</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb26-12"><a href="data-overview.html#cb26-12" tabindex="-1"></a>        sf<span class="sc">::</span><span class="fu">st_bbox</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb26-13"><a href="data-overview.html#cb26-13" tabindex="-1"></a>        sf<span class="sc">::</span><span class="fu">st_as_sfc</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb26-14"><a href="data-overview.html#cb26-14" tabindex="-1"></a>        sf<span class="sc">::</span><span class="fu">st_buffer</span>(buffer) <span class="sc">%&gt;%</span> </span>
<span id="cb26-15"><a href="data-overview.html#cb26-15" tabindex="-1"></a>        sf<span class="sc">::</span><span class="fu">st_transform</span>(terra<span class="sc">::</span><span class="fu">crs</span>(rgb_rast)) <span class="sc">%&gt;%</span> </span>
<span id="cb26-16"><a href="data-overview.html#cb26-16" tabindex="-1"></a>        terra<span class="sc">::</span><span class="fu">vect</span>()</span>
<span id="cb26-17"><a href="data-overview.html#cb26-17" tabindex="-1"></a>    )</span>
<span id="cb26-18"><a href="data-overview.html#cb26-18" tabindex="-1"></a>  <span class="co"># convert raster to a data frame and create hex colors</span></span>
<span id="cb26-19"><a href="data-overview.html#cb26-19" tabindex="-1"></a>  <span class="co"># ?grDevices::rgb</span></span>
<span id="cb26-20"><a href="data-overview.html#cb26-20" tabindex="-1"></a>  rgb_df_temp <span class="ot">&lt;-</span></span>
<span id="cb26-21"><a href="data-overview.html#cb26-21" tabindex="-1"></a>    crp_rgb_rast_temp <span class="sc">%&gt;%</span> </span>
<span id="cb26-22"><a href="data-overview.html#cb26-22" tabindex="-1"></a>    terra<span class="sc">::</span><span class="fu">as.data.frame</span>(<span class="at">xy =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb26-23"><a href="data-overview.html#cb26-23" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">rename</span>(</span>
<span id="cb26-24"><a href="data-overview.html#cb26-24" tabindex="-1"></a>      <span class="at">red =</span> <span class="dv">3</span>, <span class="at">green =</span> <span class="dv">4</span>, <span class="at">blue =</span> <span class="dv">5</span></span>
<span id="cb26-25"><a href="data-overview.html#cb26-25" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb26-26"><a href="data-overview.html#cb26-26" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb26-27"><a href="data-overview.html#cb26-27" tabindex="-1"></a>      <span class="co"># rows that have missing color data</span></span>
<span id="cb26-28"><a href="data-overview.html#cb26-28" tabindex="-1"></a>      <span class="at">is_missing =</span> <span class="fu">is.na</span>(red) <span class="sc">|</span> <span class="fu">is.na</span>(green) <span class="sc">|</span> <span class="fu">is.na</span>(blue)</span>
<span id="cb26-29"><a href="data-overview.html#cb26-29" tabindex="-1"></a>      <span class="co"># hex using 0s for NAs to avoid grDevices::rgb error</span></span>
<span id="cb26-30"><a href="data-overview.html#cb26-30" tabindex="-1"></a>      , <span class="at">hex_col =</span> grDevices<span class="sc">::</span><span class="fu">rgb</span>(</span>
<span id="cb26-31"><a href="data-overview.html#cb26-31" tabindex="-1"></a>        <span class="fu">ifelse</span>(is_missing, <span class="dv">0</span>, red)</span>
<span id="cb26-32"><a href="data-overview.html#cb26-32" tabindex="-1"></a>        , <span class="fu">ifelse</span>(is_missing, <span class="dv">0</span>, green)</span>
<span id="cb26-33"><a href="data-overview.html#cb26-33" tabindex="-1"></a>        , <span class="fu">ifelse</span>(is_missing, <span class="dv">0</span>, blue)</span>
<span id="cb26-34"><a href="data-overview.html#cb26-34" tabindex="-1"></a>        , <span class="at">maxColorValue =</span> <span class="dv">255</span></span>
<span id="cb26-35"><a href="data-overview.html#cb26-35" tabindex="-1"></a>      )</span>
<span id="cb26-36"><a href="data-overview.html#cb26-36" tabindex="-1"></a>      <span class="co"># back to NA</span></span>
<span id="cb26-37"><a href="data-overview.html#cb26-37" tabindex="-1"></a>      , <span class="at">hex_col =</span> <span class="fu">ifelse</span>(is_missing, <span class="fu">as.character</span>(<span class="cn">NA</span>), hex_col)</span>
<span id="cb26-38"><a href="data-overview.html#cb26-38" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb26-39"><a href="data-overview.html#cb26-39" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(is_missing))</span>
<span id="cb26-40"><a href="data-overview.html#cb26-40" tabindex="-1"></a>  </span>
<span id="cb26-41"><a href="data-overview.html#cb26-41" tabindex="-1"></a>  <span class="co"># plt</span></span>
<span id="cb26-42"><a href="data-overview.html#cb26-42" tabindex="-1"></a>  plt <span class="ot">&lt;-</span> ggplot2<span class="sc">::</span><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb26-43"><a href="data-overview.html#cb26-43" tabindex="-1"></a>    <span class="co"># add rgb base map</span></span>
<span id="cb26-44"><a href="data-overview.html#cb26-44" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">geom_tile</span>(<span class="at">data =</span> rgb_df_temp, <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">fill =</span> hex_col), <span class="at">color =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb26-45"><a href="data-overview.html#cb26-45" tabindex="-1"></a>    <span class="co"># use identity scale so the hex codes are used directly</span></span>
<span id="cb26-46"><a href="data-overview.html#cb26-46" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">scale_fill_identity</span>(<span class="at">na.value =</span> <span class="st">&quot;transparent&quot;</span>) <span class="sc">+</span> <span class="co"># !!! don&#39;t take this out or RGB plot will kill your computer</span></span>
<span id="cb26-47"><a href="data-overview.html#cb26-47" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb26-48"><a href="data-overview.html#cb26-48" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb26-49"><a href="data-overview.html#cb26-49" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">coord_sf</span>(<span class="at">expand =</span> F) <span class="sc">+</span></span>
<span id="cb26-50"><a href="data-overview.html#cb26-50" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb26-51"><a href="data-overview.html#cb26-51" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb26-52"><a href="data-overview.html#cb26-52" tabindex="-1"></a>      <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb26-53"><a href="data-overview.html#cb26-53" tabindex="-1"></a>    )</span>
<span id="cb26-54"><a href="data-overview.html#cb26-54" tabindex="-1"></a>  <span class="co"># add stand</span></span>
<span id="cb26-55"><a href="data-overview.html#cb26-55" tabindex="-1"></a>  <span class="cf">if</span>(add_stand){</span>
<span id="cb26-56"><a href="data-overview.html#cb26-56" tabindex="-1"></a>    <span class="co"># overlay polygons</span></span>
<span id="cb26-57"><a href="data-overview.html#cb26-57" tabindex="-1"></a>    plt <span class="ot">&lt;-</span> plt <span class="sc">+</span></span>
<span id="cb26-58"><a href="data-overview.html#cb26-58" tabindex="-1"></a>      <span class="co"># ggplot2::geom_sf(data = polys, fill = NA, color = &quot;red&quot;, linewidth = 0.5) +</span></span>
<span id="cb26-59"><a href="data-overview.html#cb26-59" tabindex="-1"></a>      ggplot2<span class="sc">::</span><span class="fu">geom_sf</span>(</span>
<span id="cb26-60"><a href="data-overview.html#cb26-60" tabindex="-1"></a>        <span class="at">data =</span> stand <span class="sc">%&gt;%</span> </span>
<span id="cb26-61"><a href="data-overview.html#cb26-61" tabindex="-1"></a>          sf<span class="sc">::</span><span class="fu">st_make_valid</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb26-62"><a href="data-overview.html#cb26-62" tabindex="-1"></a>          dplyr<span class="sc">::</span><span class="fu">filter</span>(sf<span class="sc">::</span><span class="fu">st_is_valid</span>(.)) <span class="sc">%&gt;%</span> </span>
<span id="cb26-63"><a href="data-overview.html#cb26-63" tabindex="-1"></a>          sf<span class="sc">::</span><span class="fu">st_transform</span>(terra<span class="sc">::</span><span class="fu">crs</span>(rgb_rast))</span>
<span id="cb26-64"><a href="data-overview.html#cb26-64" tabindex="-1"></a>        , <span class="at">fill =</span> <span class="cn">NA</span></span>
<span id="cb26-65"><a href="data-overview.html#cb26-65" tabindex="-1"></a>        , <span class="at">color =</span> plt_line_col</span>
<span id="cb26-66"><a href="data-overview.html#cb26-66" tabindex="-1"></a>        , <span class="at">lwd =</span> plt_lwd</span>
<span id="cb26-67"><a href="data-overview.html#cb26-67" tabindex="-1"></a>        , <span class="at">inherit.aes =</span> F</span>
<span id="cb26-68"><a href="data-overview.html#cb26-68" tabindex="-1"></a>      )</span>
<span id="cb26-69"><a href="data-overview.html#cb26-69" tabindex="-1"></a>  }</span>
<span id="cb26-70"><a href="data-overview.html#cb26-70" tabindex="-1"></a>  <span class="fu">return</span>(plt)</span>
<span id="cb26-71"><a href="data-overview.html#cb26-71" tabindex="-1"></a>}</span></code></pre></div>
<p>test our plotting function on a zoomed-in portion of the study area</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="data-overview.html#cb27-1" tabindex="-1"></a><span class="fu">ortho_plt_fn</span>(</span>
<span id="cb27-2"><a href="data-overview.html#cb27-2" tabindex="-1"></a>  psinf_rgb_rast</span>
<span id="cb27-3"><a href="data-overview.html#cb27-3" tabindex="-1"></a>  , psinf_stand_boundary <span class="sc">%&gt;%</span> </span>
<span id="cb27-4"><a href="data-overview.html#cb27-4" tabindex="-1"></a>    sf<span class="sc">::</span><span class="fu">st_centroid</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb27-5"><a href="data-overview.html#cb27-5" tabindex="-1"></a>    sf<span class="sc">::</span><span class="fu">st_buffer</span>(<span class="dv">11</span>)</span>
<span id="cb27-6"><a href="data-overview.html#cb27-6" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="slash_pile_detecting_files/figure-html/unnamed-chunk-28-1.png" width="1008" /></p>
<p>for the entire study area, plotting with <code>terra</code> is much more computationally efficient. let’s plot the RGB data with the stand boundary (black) and image annotated pile footprints (blue)</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="data-overview.html#cb28-1" tabindex="-1"></a>terra<span class="sc">::</span><span class="fu">plotRGB</span>(psinf_rgb_rast, <span class="at">stretch=</span><span class="st">&quot;lin&quot;</span>)</span>
<span id="cb28-2"><a href="data-overview.html#cb28-2" tabindex="-1"></a><span class="co"># add stand boundary</span></span>
<span id="cb28-3"><a href="data-overview.html#cb28-3" tabindex="-1"></a>terra<span class="sc">::</span><span class="fu">plot</span>(</span>
<span id="cb28-4"><a href="data-overview.html#cb28-4" tabindex="-1"></a>  psinf_stand_boundary <span class="sc">%&gt;%</span> </span>
<span id="cb28-5"><a href="data-overview.html#cb28-5" tabindex="-1"></a>    terra<span class="sc">::</span><span class="fu">vect</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb28-6"><a href="data-overview.html#cb28-6" tabindex="-1"></a>    terra<span class="sc">::</span><span class="fu">project</span>(terra<span class="sc">::</span><span class="fu">crs</span>(psinf_rgb_rast))</span>
<span id="cb28-7"><a href="data-overview.html#cb28-7" tabindex="-1"></a>  , <span class="at">add =</span> T, <span class="at">border =</span> <span class="st">&quot;black&quot;</span>, <span class="at">col =</span> <span class="cn">NA</span>, <span class="at">lwd =</span> <span class="fl">1.2</span></span>
<span id="cb28-8"><a href="data-overview.html#cb28-8" tabindex="-1"></a>)</span>
<span id="cb28-9"><a href="data-overview.html#cb28-9" tabindex="-1"></a><span class="co"># add pile boundaries</span></span>
<span id="cb28-10"><a href="data-overview.html#cb28-10" tabindex="-1"></a>terra<span class="sc">::</span><span class="fu">plot</span>(</span>
<span id="cb28-11"><a href="data-overview.html#cb28-11" tabindex="-1"></a>  psinf_slash_piles_polys <span class="sc">%&gt;%</span> </span>
<span id="cb28-12"><a href="data-overview.html#cb28-12" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(is_in_stand) <span class="sc">%&gt;%</span> </span>
<span id="cb28-13"><a href="data-overview.html#cb28-13" tabindex="-1"></a>    terra<span class="sc">::</span><span class="fu">vect</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb28-14"><a href="data-overview.html#cb28-14" tabindex="-1"></a>    terra<span class="sc">::</span><span class="fu">project</span>(terra<span class="sc">::</span><span class="fu">crs</span>(psinf_rgb_rast))</span>
<span id="cb28-15"><a href="data-overview.html#cb28-15" tabindex="-1"></a>  , <span class="at">add =</span> T, <span class="at">border =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">col =</span> <span class="cn">NA</span>, <span class="at">lwd =</span> <span class="fl">1.2</span></span>
<span id="cb28-16"><a href="data-overview.html#cb28-16" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="slash_pile_detecting_files/figure-html/unnamed-chunk-29-1.png" width="1008" /></p>
</div>
<div id="trfo-blm-pinyon-juniper-site" class="section level3 hasAnchor" number="2.3.2">
<h3><span class="header-section-number">2.3.2</span> TRFO-BLM Pinyon-Juniper Site<a href="data-overview.html#trfo-blm-pinyon-juniper-site" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>load the original data</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="data-overview.html#cb29-1" tabindex="-1"></a><span class="do">#### read RGB data keep only RGB</span></span>
<span id="cb29-2"><a href="data-overview.html#cb29-2" tabindex="-1"></a>pj_rgb_rast <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rast</span>(</span>
<span id="cb29-3"><a href="data-overview.html#cb29-3" tabindex="-1"></a>    <span class="co"># &quot;d:/BLM_CO_SWDF_DawsonFuelsTreatment/Final/Ortho/BLM_CO_SWDF_DawsonFuelsTreatment_Ortho_202504.tif&quot;</span></span>
<span id="cb29-4"><a href="data-overview.html#cb29-4" tabindex="-1"></a>    <span class="st">&quot;../data/dawson_data/dawson_rgb.tif&quot;</span></span>
<span id="cb29-5"><a href="data-overview.html#cb29-5" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb29-6"><a href="data-overview.html#cb29-6" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">subset</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>))</span>
<span id="cb29-7"><a href="data-overview.html#cb29-7" tabindex="-1"></a><span class="co"># rename bands</span></span>
<span id="cb29-8"><a href="data-overview.html#cb29-8" tabindex="-1"></a><span class="fu">names</span>(pj_rgb_rast) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;red&quot;</span>,<span class="st">&quot;green&quot;</span>,<span class="st">&quot;blue&quot;</span>)</span></code></pre></div>
<p>what is the resolution of the original RGB data?</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="data-overview.html#cb30-1" tabindex="-1"></a>terra<span class="sc">::</span><span class="fu">res</span>(pj_rgb_rast)</span></code></pre></div>
<pre><code>## [1] 0.025883 0.025883</code></pre>
<p>let’s reduce the resolution (i.e. increase the raster cell size; make more coarse)</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="data-overview.html#cb32-1" tabindex="-1"></a><span class="do">###############################################################</span></span>
<span id="cb32-2"><a href="data-overview.html#cb32-2" tabindex="-1"></a><span class="co"># clip to boundary and resample to change resolution</span></span>
<span id="cb32-3"><a href="data-overview.html#cb32-3" tabindex="-1"></a><span class="do">###############################################################</span></span>
<span id="cb32-4"><a href="data-overview.html#cb32-4" tabindex="-1"></a>dir_temp <span class="ot">&lt;-</span> <span class="st">&quot;../data/dawson_data/&quot;</span></span>
<span id="cb32-5"><a href="data-overview.html#cb32-5" tabindex="-1"></a>rgb_fnm_temp <span class="ot">&lt;-</span> <span class="fu">file.path</span>(dir_temp,<span class="st">&quot;pj_rgb_rast.tif&quot;</span>) <span class="co"># what should the compiled rgb be called?</span></span>
<span id="cb32-6"><a href="data-overview.html#cb32-6" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">dir.exists</span>(dir_temp)){<span class="fu">dir.create</span>(dir_temp, <span class="at">showWarnings =</span> F)}</span>
<span id="cb32-7"><a href="data-overview.html#cb32-7" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(rgb_fnm_temp)){</span>
<span id="cb32-8"><a href="data-overview.html#cb32-8" tabindex="-1"></a>  <span class="co"># Crop the raster to the rectangular extent of the polygon</span></span>
<span id="cb32-9"><a href="data-overview.html#cb32-9" tabindex="-1"></a>  <span class="co"># Specify a filename to ensure the result is written to disk</span></span>
<span id="cb32-10"><a href="data-overview.html#cb32-10" tabindex="-1"></a>  crop_rgb_rast_temp <span class="ot">&lt;-</span> pj_rgb_rast <span class="sc">%&gt;%</span> </span>
<span id="cb32-11"><a href="data-overview.html#cb32-11" tabindex="-1"></a>    terra<span class="sc">::</span><span class="fu">crop</span>(</span>
<span id="cb32-12"><a href="data-overview.html#cb32-12" tabindex="-1"></a>      pj_stand_boundary <span class="sc">%&gt;%</span> </span>
<span id="cb32-13"><a href="data-overview.html#cb32-13" tabindex="-1"></a>        sf<span class="sc">::</span><span class="fu">st_union</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb32-14"><a href="data-overview.html#cb32-14" tabindex="-1"></a>        sf<span class="sc">::</span><span class="fu">st_buffer</span>(<span class="dv">10</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb32-15"><a href="data-overview.html#cb32-15" tabindex="-1"></a>        terra<span class="sc">::</span><span class="fu">vect</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb32-16"><a href="data-overview.html#cb32-16" tabindex="-1"></a>        terra<span class="sc">::</span><span class="fu">project</span>(terra<span class="sc">::</span><span class="fu">crs</span>(pj_rgb_rast))</span>
<span id="cb32-17"><a href="data-overview.html#cb32-17" tabindex="-1"></a>      , <span class="at">filename =</span>  <span class="fu">tempfile</span>(<span class="at">fileext =</span> <span class="st">&quot;.tif&quot;</span>)</span>
<span id="cb32-18"><a href="data-overview.html#cb32-18" tabindex="-1"></a>      , <span class="at">overwrite =</span> <span class="cn">TRUE</span></span>
<span id="cb32-19"><a href="data-overview.html#cb32-19" tabindex="-1"></a>    ) </span>
<span id="cb32-20"><a href="data-overview.html#cb32-20" tabindex="-1"></a>  <span class="co"># Mask the cropped raster to the precise shape of the polygon</span></span>
<span id="cb32-21"><a href="data-overview.html#cb32-21" tabindex="-1"></a>  <span class="co"># This function will also be processed on disk due to the file size</span></span>
<span id="cb32-22"><a href="data-overview.html#cb32-22" tabindex="-1"></a>  pj_rgb_rast <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">mask</span>(</span>
<span id="cb32-23"><a href="data-overview.html#cb32-23" tabindex="-1"></a>    crop_rgb_rast_temp</span>
<span id="cb32-24"><a href="data-overview.html#cb32-24" tabindex="-1"></a>    , pj_stand_boundary <span class="sc">%&gt;%</span> </span>
<span id="cb32-25"><a href="data-overview.html#cb32-25" tabindex="-1"></a>      sf<span class="sc">::</span><span class="fu">st_union</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb32-26"><a href="data-overview.html#cb32-26" tabindex="-1"></a>      sf<span class="sc">::</span><span class="fu">st_buffer</span>(<span class="dv">10</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb32-27"><a href="data-overview.html#cb32-27" tabindex="-1"></a>      terra<span class="sc">::</span><span class="fu">vect</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb32-28"><a href="data-overview.html#cb32-28" tabindex="-1"></a>      terra<span class="sc">::</span><span class="fu">project</span>(terra<span class="sc">::</span><span class="fu">crs</span>(pj_rgb_rast))</span>
<span id="cb32-29"><a href="data-overview.html#cb32-29" tabindex="-1"></a>    , <span class="at">filename =</span> <span class="fu">tempfile</span>(<span class="at">fileext =</span> <span class="st">&quot;.tif&quot;</span>)</span>
<span id="cb32-30"><a href="data-overview.html#cb32-30" tabindex="-1"></a>    , <span class="at">overwrite =</span> <span class="cn">TRUE</span></span>
<span id="cb32-31"><a href="data-overview.html#cb32-31" tabindex="-1"></a>  )</span>
<span id="cb32-32"><a href="data-overview.html#cb32-32" tabindex="-1"></a>  </span>
<span id="cb32-33"><a href="data-overview.html#cb32-33" tabindex="-1"></a>  <span class="do">## apply the change_res_fn for our analysis we don&#39;t need such finery</span></span>
<span id="cb32-34"><a href="data-overview.html#cb32-34" tabindex="-1"></a>  <span class="co"># this takes too long...</span></span>
<span id="cb32-35"><a href="data-overview.html#cb32-35" tabindex="-1"></a>  pj_rgb_rast <span class="ot">&lt;-</span> <span class="fu">change_res_fn</span>(pj_rgb_rast, <span class="at">my_res=</span>my_rgb_res_m, <span class="at">ofile =</span> rgb_fnm_temp)</span>
<span id="cb32-36"><a href="data-overview.html#cb32-36" tabindex="-1"></a>}<span class="cf">else</span>{</span>
<span id="cb32-37"><a href="data-overview.html#cb32-37" tabindex="-1"></a>  pj_rgb_rast <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rast</span>(rgb_fnm_temp)</span>
<span id="cb32-38"><a href="data-overview.html#cb32-38" tabindex="-1"></a>}</span></code></pre></div>
<p>test our <code>ggplot2</code> plotting function on a zoomed-in portion of the study area</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="data-overview.html#cb33-1" tabindex="-1"></a><span class="fu">ortho_plt_fn</span>(</span>
<span id="cb33-2"><a href="data-overview.html#cb33-2" tabindex="-1"></a>  pj_rgb_rast</span>
<span id="cb33-3"><a href="data-overview.html#cb33-3" tabindex="-1"></a>  , pj_stand_boundary <span class="sc">%&gt;%</span> </span>
<span id="cb33-4"><a href="data-overview.html#cb33-4" tabindex="-1"></a>    sf<span class="sc">::</span><span class="fu">st_centroid</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb33-5"><a href="data-overview.html#cb33-5" tabindex="-1"></a>    sf<span class="sc">::</span><span class="fu">st_buffer</span>(<span class="dv">11</span>)</span>
<span id="cb33-6"><a href="data-overview.html#cb33-6" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="slash_pile_detecting_files/figure-html/unnamed-chunk-34-1.png" width="1008" /></p>
<p>for the entire study area, plotting with <code>terra</code> is much more computationally efficient. let’s plot the RGB data with the stand boundary (black) and image annotated pile footprints (blue)</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="data-overview.html#cb34-1" tabindex="-1"></a>terra<span class="sc">::</span><span class="fu">plotRGB</span>(pj_rgb_rast, <span class="at">stretch=</span><span class="st">&quot;lin&quot;</span>)</span>
<span id="cb34-2"><a href="data-overview.html#cb34-2" tabindex="-1"></a><span class="co"># add stand boundary</span></span>
<span id="cb34-3"><a href="data-overview.html#cb34-3" tabindex="-1"></a>terra<span class="sc">::</span><span class="fu">plot</span>(</span>
<span id="cb34-4"><a href="data-overview.html#cb34-4" tabindex="-1"></a>  pj_stand_boundary <span class="sc">%&gt;%</span> </span>
<span id="cb34-5"><a href="data-overview.html#cb34-5" tabindex="-1"></a>    terra<span class="sc">::</span><span class="fu">vect</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb34-6"><a href="data-overview.html#cb34-6" tabindex="-1"></a>    terra<span class="sc">::</span><span class="fu">project</span>(terra<span class="sc">::</span><span class="fu">crs</span>(pj_rgb_rast))</span>
<span id="cb34-7"><a href="data-overview.html#cb34-7" tabindex="-1"></a>  , <span class="at">add =</span> T, <span class="at">border =</span> <span class="st">&quot;black&quot;</span>, <span class="at">col =</span> <span class="cn">NA</span>, <span class="at">lwd =</span> <span class="fl">1.2</span></span>
<span id="cb34-8"><a href="data-overview.html#cb34-8" tabindex="-1"></a>)</span>
<span id="cb34-9"><a href="data-overview.html#cb34-9" tabindex="-1"></a><span class="co"># add pile boundaries</span></span>
<span id="cb34-10"><a href="data-overview.html#cb34-10" tabindex="-1"></a>terra<span class="sc">::</span><span class="fu">plot</span>(</span>
<span id="cb34-11"><a href="data-overview.html#cb34-11" tabindex="-1"></a>  pj_slash_piles_polys <span class="sc">%&gt;%</span> </span>
<span id="cb34-12"><a href="data-overview.html#cb34-12" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(is_in_stand) <span class="sc">%&gt;%</span> </span>
<span id="cb34-13"><a href="data-overview.html#cb34-13" tabindex="-1"></a>    terra<span class="sc">::</span><span class="fu">vect</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb34-14"><a href="data-overview.html#cb34-14" tabindex="-1"></a>    terra<span class="sc">::</span><span class="fu">project</span>(terra<span class="sc">::</span><span class="fu">crs</span>(pj_rgb_rast))</span>
<span id="cb34-15"><a href="data-overview.html#cb34-15" tabindex="-1"></a>  , <span class="at">add =</span> T, <span class="at">border =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">col =</span> <span class="cn">NA</span>, <span class="at">lwd =</span> <span class="fl">1.2</span></span>
<span id="cb34-16"><a href="data-overview.html#cb34-16" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="slash_pile_detecting_files/figure-html/unnamed-chunk-35-1.png" width="1008" /></p>
</div>
<div id="bhef-ponderosa-pine-site" class="section level3 hasAnchor" number="2.3.3">
<h3><span class="header-section-number">2.3.3</span> BHEF Ponderosa Pine Site<a href="data-overview.html#bhef-ponderosa-pine-site" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>load the original data. for this site, the orthomosaics are split across multiple files. we’ll read in each, align the resolutions, and use <code>terra::moasaic()</code> to combine</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="data-overview.html#cb35-1" tabindex="-1"></a><span class="do">###############################################################</span></span>
<span id="cb35-2"><a href="data-overview.html#cb35-2" tabindex="-1"></a><span class="co"># compile RGB raster</span></span>
<span id="cb35-3"><a href="data-overview.html#cb35-3" tabindex="-1"></a><span class="do">###############################################################</span></span>
<span id="cb35-4"><a href="data-overview.html#cb35-4" tabindex="-1"></a>rgb_dir_temp <span class="ot">&lt;-</span> <span class="st">&quot;F:/UAS_Collections/BHEF_202306&quot;</span> <span class="co"># where is the raw las and rgb data?</span></span>
<span id="cb35-5"><a href="data-overview.html#cb35-5" tabindex="-1"></a>dir_temp <span class="ot">&lt;-</span> <span class="st">&quot;../data/BHEF_202306/&quot;</span> <span class="co"># where do you want to save processed data to?</span></span>
<span id="cb35-6"><a href="data-overview.html#cb35-6" tabindex="-1"></a>rgb_fnm_temp <span class="ot">&lt;-</span> <span class="fu">file.path</span>(dir_temp,<span class="st">&quot;bhef_rgb.tif&quot;</span>) <span class="co"># what should the compiled rgb be called?</span></span>
<span id="cb35-7"><a href="data-overview.html#cb35-7" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">dir.exists</span>(dir_temp)){<span class="fu">dir.create</span>(dir_temp, <span class="at">showWarnings =</span> F)}</span>
<span id="cb35-8"><a href="data-overview.html#cb35-8" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(rgb_fnm_temp)){</span>
<span id="cb35-9"><a href="data-overview.html#cb35-9" tabindex="-1"></a>  <span class="co"># read list of orthos</span></span>
<span id="cb35-10"><a href="data-overview.html#cb35-10" tabindex="-1"></a>    ortho_list_temp <span class="ot">&lt;-</span> <span class="fu">list.files</span>(</span>
<span id="cb35-11"><a href="data-overview.html#cb35-11" tabindex="-1"></a>        rgb_dir_temp</span>
<span id="cb35-12"><a href="data-overview.html#cb35-12" tabindex="-1"></a>        , <span class="at">pattern =</span> <span class="st">&quot;.*(_RGB|_RBG)</span><span class="sc">\\</span><span class="st">.(tif|tiff)$&quot;</span></span>
<span id="cb35-13"><a href="data-overview.html#cb35-13" tabindex="-1"></a>        , <span class="at">full.names =</span> T, <span class="at">recursive =</span> T</span>
<span id="cb35-14"><a href="data-overview.html#cb35-14" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span> </span>
<span id="cb35-15"><a href="data-overview.html#cb35-15" tabindex="-1"></a>      purrr<span class="sc">::</span><span class="fu">map</span>(<span class="cf">function</span>(x){terra<span class="sc">::</span><span class="fu">rast</span>(x)})</span>
<span id="cb35-16"><a href="data-overview.html#cb35-16" tabindex="-1"></a>    <span class="do">## apply the change_res_fn</span></span>
<span id="cb35-17"><a href="data-overview.html#cb35-17" tabindex="-1"></a>    ortho_list_temp <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(ortho_list_temp) <span class="sc">%&gt;%</span> </span>
<span id="cb35-18"><a href="data-overview.html#cb35-18" tabindex="-1"></a>      purrr<span class="sc">::</span><span class="fu">map</span>(<span class="cf">function</span>(x){<span class="fu">change_res_fn</span>(ortho_list_temp[[x]], <span class="at">my_res=</span><span class="fl">0.04</span>)})</span>
<span id="cb35-19"><a href="data-overview.html#cb35-19" tabindex="-1"></a>    <span class="do">######## mosaic the raster list </span></span>
<span id="cb35-20"><a href="data-overview.html#cb35-20" tabindex="-1"></a>    bhef_rgb_rast <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">mosaic</span>(</span>
<span id="cb35-21"><a href="data-overview.html#cb35-21" tabindex="-1"></a>      terra<span class="sc">::</span><span class="fu">sprc</span>(ortho_list_temp)</span>
<span id="cb35-22"><a href="data-overview.html#cb35-22" tabindex="-1"></a>      , <span class="at">fun =</span> <span class="st">&quot;min&quot;</span> <span class="co"># min only thing that works</span></span>
<span id="cb35-23"><a href="data-overview.html#cb35-23" tabindex="-1"></a>      , <span class="at">filename =</span> rgb_fnm_temp</span>
<span id="cb35-24"><a href="data-overview.html#cb35-24" tabindex="-1"></a>      , <span class="at">overwrite =</span> T</span>
<span id="cb35-25"><a href="data-overview.html#cb35-25" tabindex="-1"></a>    )</span>
<span id="cb35-26"><a href="data-overview.html#cb35-26" tabindex="-1"></a>}<span class="cf">else</span>{</span>
<span id="cb35-27"><a href="data-overview.html#cb35-27" tabindex="-1"></a>  bhef_rgb_rast <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rast</span>(rgb_fnm_temp) <span class="sc">%&gt;%</span> </span>
<span id="cb35-28"><a href="data-overview.html#cb35-28" tabindex="-1"></a>    terra<span class="sc">::</span><span class="fu">subset</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>))</span>
<span id="cb35-29"><a href="data-overview.html#cb35-29" tabindex="-1"></a>}</span>
<span id="cb35-30"><a href="data-overview.html#cb35-30" tabindex="-1"></a><span class="co"># rename bands</span></span>
<span id="cb35-31"><a href="data-overview.html#cb35-31" tabindex="-1"></a><span class="fu">names</span>(bhef_rgb_rast) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;red&quot;</span>,<span class="st">&quot;green&quot;</span>,<span class="st">&quot;blue&quot;</span>)</span></code></pre></div>
<p>what is the resolution of the original RGB data?</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="data-overview.html#cb36-1" tabindex="-1"></a>terra<span class="sc">::</span><span class="fu">res</span>(bhef_rgb_rast)</span></code></pre></div>
<pre><code>## [1] 0.04 0.04</code></pre>
<p>let’s reduce the resolution (i.e. increase the raster cell size; make more coarse)</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="data-overview.html#cb38-1" tabindex="-1"></a><span class="do">###############################################################</span></span>
<span id="cb38-2"><a href="data-overview.html#cb38-2" tabindex="-1"></a><span class="co"># clip to boundary and resample to change resolution</span></span>
<span id="cb38-3"><a href="data-overview.html#cb38-3" tabindex="-1"></a><span class="do">###############################################################</span></span>
<span id="cb38-4"><a href="data-overview.html#cb38-4" tabindex="-1"></a>dir_temp <span class="ot">&lt;-</span> <span class="st">&quot;../data/BHEF_202306/&quot;</span></span>
<span id="cb38-5"><a href="data-overview.html#cb38-5" tabindex="-1"></a>rgb_fnm_temp <span class="ot">&lt;-</span> <span class="fu">file.path</span>(dir_temp,<span class="st">&quot;bhef_rgb_rast.tif&quot;</span>) <span class="co"># what should the compiled rgb be called?</span></span>
<span id="cb38-6"><a href="data-overview.html#cb38-6" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">dir.exists</span>(dir_temp)){<span class="fu">dir.create</span>(dir_temp, <span class="at">showWarnings =</span> F)}</span>
<span id="cb38-7"><a href="data-overview.html#cb38-7" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(rgb_fnm_temp)){</span>
<span id="cb38-8"><a href="data-overview.html#cb38-8" tabindex="-1"></a>  <span class="co"># Crop the raster to the rectangular extent of the polygon</span></span>
<span id="cb38-9"><a href="data-overview.html#cb38-9" tabindex="-1"></a>  <span class="co"># Specify a filename to ensure the result is written to disk</span></span>
<span id="cb38-10"><a href="data-overview.html#cb38-10" tabindex="-1"></a>  crop_rgb_rast_temp <span class="ot">&lt;-</span> bhef_rgb_rast <span class="sc">%&gt;%</span> </span>
<span id="cb38-11"><a href="data-overview.html#cb38-11" tabindex="-1"></a>    terra<span class="sc">::</span><span class="fu">crop</span>(</span>
<span id="cb38-12"><a href="data-overview.html#cb38-12" tabindex="-1"></a>      bhef_stand_boundary <span class="sc">%&gt;%</span> </span>
<span id="cb38-13"><a href="data-overview.html#cb38-13" tabindex="-1"></a>        sf<span class="sc">::</span><span class="fu">st_union</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb38-14"><a href="data-overview.html#cb38-14" tabindex="-1"></a>        sf<span class="sc">::</span><span class="fu">st_buffer</span>(<span class="dv">10</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb38-15"><a href="data-overview.html#cb38-15" tabindex="-1"></a>        terra<span class="sc">::</span><span class="fu">vect</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb38-16"><a href="data-overview.html#cb38-16" tabindex="-1"></a>        terra<span class="sc">::</span><span class="fu">project</span>(terra<span class="sc">::</span><span class="fu">crs</span>(bhef_rgb_rast))</span>
<span id="cb38-17"><a href="data-overview.html#cb38-17" tabindex="-1"></a>      , <span class="at">filename =</span>  <span class="fu">tempfile</span>(<span class="at">fileext =</span> <span class="st">&quot;.tif&quot;</span>)</span>
<span id="cb38-18"><a href="data-overview.html#cb38-18" tabindex="-1"></a>      , <span class="at">overwrite =</span> <span class="cn">TRUE</span></span>
<span id="cb38-19"><a href="data-overview.html#cb38-19" tabindex="-1"></a>    ) </span>
<span id="cb38-20"><a href="data-overview.html#cb38-20" tabindex="-1"></a>  <span class="co"># Mask the cropped raster to the precise shape of the polygon</span></span>
<span id="cb38-21"><a href="data-overview.html#cb38-21" tabindex="-1"></a>  <span class="co"># This function will also be processed on disk due to the file size</span></span>
<span id="cb38-22"><a href="data-overview.html#cb38-22" tabindex="-1"></a>  bhef_rgb_rast <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">mask</span>(</span>
<span id="cb38-23"><a href="data-overview.html#cb38-23" tabindex="-1"></a>    crop_rgb_rast_temp</span>
<span id="cb38-24"><a href="data-overview.html#cb38-24" tabindex="-1"></a>    , bhef_stand_boundary <span class="sc">%&gt;%</span> </span>
<span id="cb38-25"><a href="data-overview.html#cb38-25" tabindex="-1"></a>      sf<span class="sc">::</span><span class="fu">st_union</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb38-26"><a href="data-overview.html#cb38-26" tabindex="-1"></a>      sf<span class="sc">::</span><span class="fu">st_buffer</span>(<span class="dv">10</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb38-27"><a href="data-overview.html#cb38-27" tabindex="-1"></a>      terra<span class="sc">::</span><span class="fu">vect</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb38-28"><a href="data-overview.html#cb38-28" tabindex="-1"></a>      terra<span class="sc">::</span><span class="fu">project</span>(terra<span class="sc">::</span><span class="fu">crs</span>(bhef_rgb_rast))</span>
<span id="cb38-29"><a href="data-overview.html#cb38-29" tabindex="-1"></a>    , <span class="at">filename =</span> <span class="fu">tempfile</span>(<span class="at">fileext =</span> <span class="st">&quot;.tif&quot;</span>)</span>
<span id="cb38-30"><a href="data-overview.html#cb38-30" tabindex="-1"></a>    , <span class="at">overwrite =</span> <span class="cn">TRUE</span></span>
<span id="cb38-31"><a href="data-overview.html#cb38-31" tabindex="-1"></a>  )</span>
<span id="cb38-32"><a href="data-overview.html#cb38-32" tabindex="-1"></a>  </span>
<span id="cb38-33"><a href="data-overview.html#cb38-33" tabindex="-1"></a>  <span class="do">## apply the change_res_fn for our analysis we don&#39;t need such finery</span></span>
<span id="cb38-34"><a href="data-overview.html#cb38-34" tabindex="-1"></a>  <span class="co"># this takes too long...</span></span>
<span id="cb38-35"><a href="data-overview.html#cb38-35" tabindex="-1"></a>  bhef_rgb_rast <span class="ot">&lt;-</span> <span class="fu">change_res_fn</span>(bhef_rgb_rast, <span class="at">my_res=</span>my_rgb_res_m, <span class="at">ofile =</span> rgb_fnm_temp)</span>
<span id="cb38-36"><a href="data-overview.html#cb38-36" tabindex="-1"></a>}<span class="cf">else</span>{</span>
<span id="cb38-37"><a href="data-overview.html#cb38-37" tabindex="-1"></a>  bhef_rgb_rast <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rast</span>(rgb_fnm_temp)</span>
<span id="cb38-38"><a href="data-overview.html#cb38-38" tabindex="-1"></a>}</span></code></pre></div>
<p>for the entire study area, plotting with <code>terra</code> is much more computationally efficient. let’s plot the RGB data with the stand boundary (black) and image annotated pile footprints (blue)</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="data-overview.html#cb39-1" tabindex="-1"></a>terra<span class="sc">::</span><span class="fu">plotRGB</span>(bhef_rgb_rast, <span class="at">stretch=</span><span class="st">&quot;lin&quot;</span>)</span>
<span id="cb39-2"><a href="data-overview.html#cb39-2" tabindex="-1"></a><span class="co"># add stand boundary</span></span>
<span id="cb39-3"><a href="data-overview.html#cb39-3" tabindex="-1"></a>terra<span class="sc">::</span><span class="fu">plot</span>(</span>
<span id="cb39-4"><a href="data-overview.html#cb39-4" tabindex="-1"></a>  bhef_stand_boundary <span class="sc">%&gt;%</span> </span>
<span id="cb39-5"><a href="data-overview.html#cb39-5" tabindex="-1"></a>    terra<span class="sc">::</span><span class="fu">vect</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb39-6"><a href="data-overview.html#cb39-6" tabindex="-1"></a>    terra<span class="sc">::</span><span class="fu">project</span>(terra<span class="sc">::</span><span class="fu">crs</span>(bhef_rgb_rast))</span>
<span id="cb39-7"><a href="data-overview.html#cb39-7" tabindex="-1"></a>  , <span class="at">add =</span> T, <span class="at">border =</span> <span class="st">&quot;black&quot;</span>, <span class="at">col =</span> <span class="cn">NA</span>, <span class="at">lwd =</span> <span class="fl">1.2</span></span>
<span id="cb39-8"><a href="data-overview.html#cb39-8" tabindex="-1"></a>)</span>
<span id="cb39-9"><a href="data-overview.html#cb39-9" tabindex="-1"></a><span class="co"># add pile boundaries</span></span>
<span id="cb39-10"><a href="data-overview.html#cb39-10" tabindex="-1"></a>terra<span class="sc">::</span><span class="fu">plot</span>(</span>
<span id="cb39-11"><a href="data-overview.html#cb39-11" tabindex="-1"></a>  bhef_slash_piles_polys <span class="sc">%&gt;%</span> </span>
<span id="cb39-12"><a href="data-overview.html#cb39-12" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(is_in_stand) <span class="sc">%&gt;%</span> </span>
<span id="cb39-13"><a href="data-overview.html#cb39-13" tabindex="-1"></a>    terra<span class="sc">::</span><span class="fu">vect</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb39-14"><a href="data-overview.html#cb39-14" tabindex="-1"></a>    terra<span class="sc">::</span><span class="fu">project</span>(terra<span class="sc">::</span><span class="fu">crs</span>(bhef_rgb_rast))</span>
<span id="cb39-15"><a href="data-overview.html#cb39-15" tabindex="-1"></a>  , <span class="at">add =</span> T, <span class="at">border =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">col =</span> <span class="cn">NA</span>, <span class="at">lwd =</span> <span class="fl">1.2</span></span>
<span id="cb39-16"><a href="data-overview.html#cb39-16" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="slash_pile_detecting_files/figure-html/unnamed-chunk-40-1.png" width="1008" /></p>
</div>
<div id="arnf-ponderosa-pine-site" class="section level3 hasAnchor" number="2.3.4">
<h3><span class="header-section-number">2.3.4</span> ARNF Ponderosa Pine Site<a href="data-overview.html#arnf-ponderosa-pine-site" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>load the original data</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="data-overview.html#cb40-1" tabindex="-1"></a><span class="do">#### read RGB data keep only RGB</span></span>
<span id="cb40-2"><a href="data-overview.html#cb40-2" tabindex="-1"></a>arnf_rgb_rast <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rast</span>(</span>
<span id="cb40-3"><a href="data-overview.html#cb40-3" tabindex="-1"></a>    <span class="st">&quot;f:/UAS_Collections/ARNF_DiamondView_202510/DiamondPeak_Switchblade_transparent_mosaic_group1.tif&quot;</span></span>
<span id="cb40-4"><a href="data-overview.html#cb40-4" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb40-5"><a href="data-overview.html#cb40-5" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">subset</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>))</span>
<span id="cb40-6"><a href="data-overview.html#cb40-6" tabindex="-1"></a><span class="co"># rename bands</span></span>
<span id="cb40-7"><a href="data-overview.html#cb40-7" tabindex="-1"></a><span class="fu">names</span>(arnf_rgb_rast) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;red&quot;</span>,<span class="st">&quot;green&quot;</span>,<span class="st">&quot;blue&quot;</span>)</span></code></pre></div>
<p>what is the resolution of the original RGB data?</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="data-overview.html#cb41-1" tabindex="-1"></a>terra<span class="sc">::</span><span class="fu">res</span>(arnf_rgb_rast)</span></code></pre></div>
<pre><code>## [1] 0.02101 0.02101</code></pre>
<p>let’s reduce the resolution (i.e. increase the raster cell size; make more coarse)</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="data-overview.html#cb43-1" tabindex="-1"></a><span class="do">###############################################################</span></span>
<span id="cb43-2"><a href="data-overview.html#cb43-2" tabindex="-1"></a><span class="co"># clip to boundary and resample to change resolution</span></span>
<span id="cb43-3"><a href="data-overview.html#cb43-3" tabindex="-1"></a><span class="do">###############################################################</span></span>
<span id="cb43-4"><a href="data-overview.html#cb43-4" tabindex="-1"></a>dir_temp <span class="ot">&lt;-</span> <span class="st">&quot;../data/ARNF_DiamondView_202510/&quot;</span></span>
<span id="cb43-5"><a href="data-overview.html#cb43-5" tabindex="-1"></a>rgb_fnm_temp <span class="ot">&lt;-</span> <span class="fu">file.path</span>(dir_temp,<span class="st">&quot;arnf_rgb_rast.tif&quot;</span>) <span class="co"># what should the compiled rgb be called?</span></span>
<span id="cb43-6"><a href="data-overview.html#cb43-6" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">dir.exists</span>(dir_temp)){<span class="fu">dir.create</span>(dir_temp, <span class="at">showWarnings =</span> F)}</span>
<span id="cb43-7"><a href="data-overview.html#cb43-7" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(rgb_fnm_temp)){</span>
<span id="cb43-8"><a href="data-overview.html#cb43-8" tabindex="-1"></a>  <span class="co"># Crop the raster to the rectangular extent of the polygon</span></span>
<span id="cb43-9"><a href="data-overview.html#cb43-9" tabindex="-1"></a>  <span class="co"># Specify a filename to ensure the result is written to disk</span></span>
<span id="cb43-10"><a href="data-overview.html#cb43-10" tabindex="-1"></a>  crop_rgb_rast_temp <span class="ot">&lt;-</span> arnf_rgb_rast <span class="sc">%&gt;%</span> </span>
<span id="cb43-11"><a href="data-overview.html#cb43-11" tabindex="-1"></a>    terra<span class="sc">::</span><span class="fu">crop</span>(</span>
<span id="cb43-12"><a href="data-overview.html#cb43-12" tabindex="-1"></a>      arnf_stand_boundary <span class="sc">%&gt;%</span> </span>
<span id="cb43-13"><a href="data-overview.html#cb43-13" tabindex="-1"></a>        sf<span class="sc">::</span><span class="fu">st_union</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb43-14"><a href="data-overview.html#cb43-14" tabindex="-1"></a>        sf<span class="sc">::</span><span class="fu">st_buffer</span>(<span class="dv">10</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb43-15"><a href="data-overview.html#cb43-15" tabindex="-1"></a>        terra<span class="sc">::</span><span class="fu">vect</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb43-16"><a href="data-overview.html#cb43-16" tabindex="-1"></a>        terra<span class="sc">::</span><span class="fu">project</span>(terra<span class="sc">::</span><span class="fu">crs</span>(arnf_rgb_rast))</span>
<span id="cb43-17"><a href="data-overview.html#cb43-17" tabindex="-1"></a>      , <span class="at">filename =</span>  <span class="fu">tempfile</span>(<span class="at">fileext =</span> <span class="st">&quot;.tif&quot;</span>)</span>
<span id="cb43-18"><a href="data-overview.html#cb43-18" tabindex="-1"></a>      , <span class="at">overwrite =</span> <span class="cn">TRUE</span></span>
<span id="cb43-19"><a href="data-overview.html#cb43-19" tabindex="-1"></a>    ) </span>
<span id="cb43-20"><a href="data-overview.html#cb43-20" tabindex="-1"></a>  <span class="co"># Mask the cropped raster to the precise shape of the polygon</span></span>
<span id="cb43-21"><a href="data-overview.html#cb43-21" tabindex="-1"></a>  <span class="co"># This function will also be processed on disk due to the file size</span></span>
<span id="cb43-22"><a href="data-overview.html#cb43-22" tabindex="-1"></a>  arnf_rgb_rast <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">mask</span>(</span>
<span id="cb43-23"><a href="data-overview.html#cb43-23" tabindex="-1"></a>    crop_rgb_rast_temp</span>
<span id="cb43-24"><a href="data-overview.html#cb43-24" tabindex="-1"></a>    , arnf_stand_boundary <span class="sc">%&gt;%</span> </span>
<span id="cb43-25"><a href="data-overview.html#cb43-25" tabindex="-1"></a>      sf<span class="sc">::</span><span class="fu">st_union</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb43-26"><a href="data-overview.html#cb43-26" tabindex="-1"></a>      sf<span class="sc">::</span><span class="fu">st_buffer</span>(<span class="dv">10</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb43-27"><a href="data-overview.html#cb43-27" tabindex="-1"></a>      terra<span class="sc">::</span><span class="fu">vect</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb43-28"><a href="data-overview.html#cb43-28" tabindex="-1"></a>      terra<span class="sc">::</span><span class="fu">project</span>(terra<span class="sc">::</span><span class="fu">crs</span>(arnf_rgb_rast))</span>
<span id="cb43-29"><a href="data-overview.html#cb43-29" tabindex="-1"></a>    , <span class="at">filename =</span> <span class="fu">tempfile</span>(<span class="at">fileext =</span> <span class="st">&quot;.tif&quot;</span>)</span>
<span id="cb43-30"><a href="data-overview.html#cb43-30" tabindex="-1"></a>    , <span class="at">overwrite =</span> <span class="cn">TRUE</span></span>
<span id="cb43-31"><a href="data-overview.html#cb43-31" tabindex="-1"></a>  )</span>
<span id="cb43-32"><a href="data-overview.html#cb43-32" tabindex="-1"></a>  </span>
<span id="cb43-33"><a href="data-overview.html#cb43-33" tabindex="-1"></a>  <span class="do">## apply the change_res_fn for our analysis we don&#39;t need such finery</span></span>
<span id="cb43-34"><a href="data-overview.html#cb43-34" tabindex="-1"></a>  <span class="co"># this takes too long...</span></span>
<span id="cb43-35"><a href="data-overview.html#cb43-35" tabindex="-1"></a>  arnf_rgb_rast <span class="ot">&lt;-</span> <span class="fu">change_res_fn</span>(arnf_rgb_rast, <span class="at">my_res=</span>my_rgb_res_m, <span class="at">ofile =</span> rgb_fnm_temp)</span>
<span id="cb43-36"><a href="data-overview.html#cb43-36" tabindex="-1"></a>}<span class="cf">else</span>{</span>
<span id="cb43-37"><a href="data-overview.html#cb43-37" tabindex="-1"></a>  arnf_rgb_rast <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rast</span>(rgb_fnm_temp)</span>
<span id="cb43-38"><a href="data-overview.html#cb43-38" tabindex="-1"></a>}</span></code></pre></div>
<p>test our <code>ggplot2</code> plotting function on a zoomed-in portion of the study area</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="data-overview.html#cb44-1" tabindex="-1"></a><span class="fu">ortho_plt_fn</span>(</span>
<span id="cb44-2"><a href="data-overview.html#cb44-2" tabindex="-1"></a>  arnf_rgb_rast</span>
<span id="cb44-3"><a href="data-overview.html#cb44-3" tabindex="-1"></a>  , arnf_stand_boundary <span class="sc">%&gt;%</span> </span>
<span id="cb44-4"><a href="data-overview.html#cb44-4" tabindex="-1"></a>    sf<span class="sc">::</span><span class="fu">st_centroid</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb44-5"><a href="data-overview.html#cb44-5" tabindex="-1"></a>    sf<span class="sc">::</span><span class="fu">st_buffer</span>(<span class="dv">11</span>)</span>
<span id="cb44-6"><a href="data-overview.html#cb44-6" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="slash_pile_detecting_files/figure-html/unnamed-chunk-45-1.png" width="1008" /></p>
<p>for the entire study area, plotting with <code>terra</code> is much more computationally efficient. let’s plot the RGB data with the stand boundary (black) and image annotated pile footprints (blue)</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="data-overview.html#cb45-1" tabindex="-1"></a>terra<span class="sc">::</span><span class="fu">plotRGB</span>(arnf_rgb_rast, <span class="at">stretch=</span><span class="st">&quot;lin&quot;</span>)</span>
<span id="cb45-2"><a href="data-overview.html#cb45-2" tabindex="-1"></a><span class="co"># add stand boundary</span></span>
<span id="cb45-3"><a href="data-overview.html#cb45-3" tabindex="-1"></a>terra<span class="sc">::</span><span class="fu">plot</span>(</span>
<span id="cb45-4"><a href="data-overview.html#cb45-4" tabindex="-1"></a>  arnf_stand_boundary <span class="sc">%&gt;%</span> </span>
<span id="cb45-5"><a href="data-overview.html#cb45-5" tabindex="-1"></a>    terra<span class="sc">::</span><span class="fu">vect</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb45-6"><a href="data-overview.html#cb45-6" tabindex="-1"></a>    terra<span class="sc">::</span><span class="fu">project</span>(terra<span class="sc">::</span><span class="fu">crs</span>(arnf_rgb_rast))</span>
<span id="cb45-7"><a href="data-overview.html#cb45-7" tabindex="-1"></a>  , <span class="at">add =</span> T, <span class="at">border =</span> <span class="st">&quot;black&quot;</span>, <span class="at">col =</span> <span class="cn">NA</span>, <span class="at">lwd =</span> <span class="fl">1.2</span></span>
<span id="cb45-8"><a href="data-overview.html#cb45-8" tabindex="-1"></a>)</span>
<span id="cb45-9"><a href="data-overview.html#cb45-9" tabindex="-1"></a><span class="co"># add pile boundaries</span></span>
<span id="cb45-10"><a href="data-overview.html#cb45-10" tabindex="-1"></a>terra<span class="sc">::</span><span class="fu">plot</span>(</span>
<span id="cb45-11"><a href="data-overview.html#cb45-11" tabindex="-1"></a>  arnf_slash_piles_polys <span class="sc">%&gt;%</span> </span>
<span id="cb45-12"><a href="data-overview.html#cb45-12" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(is_in_stand) <span class="sc">%&gt;%</span> </span>
<span id="cb45-13"><a href="data-overview.html#cb45-13" tabindex="-1"></a>    terra<span class="sc">::</span><span class="fu">vect</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb45-14"><a href="data-overview.html#cb45-14" tabindex="-1"></a>    terra<span class="sc">::</span><span class="fu">project</span>(terra<span class="sc">::</span><span class="fu">crs</span>(arnf_rgb_rast))</span>
<span id="cb45-15"><a href="data-overview.html#cb45-15" tabindex="-1"></a>  , <span class="at">add =</span> T, <span class="at">border =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">col =</span> <span class="cn">NA</span>, <span class="at">lwd =</span> <span class="fl">1.2</span></span>
<span id="cb45-16"><a href="data-overview.html#cb45-16" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="slash_pile_detecting_files/figure-html/unnamed-chunk-46-1.png" width="1008" /></p>
</div>
</div>
<div id="slash-pile-rgb-imagery" class="section level2 hasAnchor" number="2.4">
<h2><span class="header-section-number">2.4</span> Slash Pile RGB Imagery<a href="data-overview.html#slash-pile-rgb-imagery" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>let’s look at the RGB imagery and pile locations. we’ll make a panel of plots for each pile at each study site and place a one square meter box in the middle of each pile to distinguish size</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="data-overview.html#cb46-1" tabindex="-1"></a>plt_fn_temp <span class="ot">&lt;-</span> <span class="cf">function</span>(vect, rgb){</span>
<span id="cb46-2"><a href="data-overview.html#cb46-2" tabindex="-1"></a>  <span class="co"># get vector</span></span>
<span id="cb46-3"><a href="data-overview.html#cb46-3" tabindex="-1"></a>  d <span class="ot">&lt;-</span> vect <span class="sc">%&gt;%</span> </span>
<span id="cb46-4"><a href="data-overview.html#cb46-4" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">slice</span>(<span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb46-5"><a href="data-overview.html#cb46-5" tabindex="-1"></a>    sf<span class="sc">::</span><span class="fu">st_transform</span>(terra<span class="sc">::</span><span class="fu">crs</span>(rgb))</span>
<span id="cb46-6"><a href="data-overview.html#cb46-6" tabindex="-1"></a>  <span class="co"># make a box</span></span>
<span id="cb46-7"><a href="data-overview.html#cb46-7" tabindex="-1"></a>  sqm <span class="ot">&lt;-</span> d <span class="sc">%&gt;%</span> </span>
<span id="cb46-8"><a href="data-overview.html#cb46-8" tabindex="-1"></a>    sf<span class="sc">::</span><span class="fu">st_centroid</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb46-9"><a href="data-overview.html#cb46-9" tabindex="-1"></a>    sf<span class="sc">::</span><span class="fu">st_buffer</span>(</span>
<span id="cb46-10"><a href="data-overview.html#cb46-10" tabindex="-1"></a>      <span class="fu">sqrt</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>) <span class="do">## numerator = desired plot size in m2</span></span>
<span id="cb46-11"><a href="data-overview.html#cb46-11" tabindex="-1"></a>      , <span class="at">endCapStyle =</span> <span class="st">&quot;SQUARE&quot;</span></span>
<span id="cb46-12"><a href="data-overview.html#cb46-12" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb46-13"><a href="data-overview.html#cb46-13" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">dummy=</span><span class="dv">1</span>)</span>
<span id="cb46-14"><a href="data-overview.html#cb46-14" tabindex="-1"></a>  <span class="co"># buff</span></span>
<span id="cb46-15"><a href="data-overview.html#cb46-15" tabindex="-1"></a>  buff <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb46-16"><a href="data-overview.html#cb46-16" tabindex="-1"></a>    d<span class="sc">$</span>image_gt_diameter_m <span class="sc">&lt;</span> <span class="dv">4</span> <span class="sc">~</span> <span class="dv">4</span></span>
<span id="cb46-17"><a href="data-overview.html#cb46-17" tabindex="-1"></a>    , d<span class="sc">$</span>image_gt_diameter_m <span class="sc">&gt;</span> <span class="dv">10</span> <span class="sc">~</span> <span class="fl">2.5</span></span>
<span id="cb46-18"><a href="data-overview.html#cb46-18" tabindex="-1"></a>    , T <span class="sc">~</span> d<span class="sc">$</span>image_gt_diameter_m<span class="sc">*</span>(<span class="dv">2</span><span class="sc">/</span><span class="dv">3</span>)</span>
<span id="cb46-19"><a href="data-overview.html#cb46-19" tabindex="-1"></a>  )</span>
<span id="cb46-20"><a href="data-overview.html#cb46-20" tabindex="-1"></a>  <span class="co"># plt</span></span>
<span id="cb46-21"><a href="data-overview.html#cb46-21" tabindex="-1"></a>  <span class="fu">ortho_plt_fn</span>(</span>
<span id="cb46-22"><a href="data-overview.html#cb46-22" tabindex="-1"></a>    <span class="at">rgb_rast =</span> rgb</span>
<span id="cb46-23"><a href="data-overview.html#cb46-23" tabindex="-1"></a>    , <span class="at">stand =</span> sf<span class="sc">::</span><span class="fu">st_union</span>(d, sqm)</span>
<span id="cb46-24"><a href="data-overview.html#cb46-24" tabindex="-1"></a>    , <span class="at">buffer =</span> buff</span>
<span id="cb46-25"><a href="data-overview.html#cb46-25" tabindex="-1"></a>    , <span class="at">add_stand =</span> F</span>
<span id="cb46-26"><a href="data-overview.html#cb46-26" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb46-27"><a href="data-overview.html#cb46-27" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_sf</span>(<span class="at">data =</span> sqm, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">color =</span> <span class="st">&quot;white&quot;</span>, <span class="at">inherit.aes =</span> F) <span class="sc">+</span></span>
<span id="cb46-28"><a href="data-overview.html#cb46-28" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_sf</span>(<span class="at">data =</span> d, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">lwd =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">inherit.aes =</span> F) <span class="sc">+</span></span>
<span id="cb46-29"><a href="data-overview.html#cb46-29" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb46-30"><a href="data-overview.html#cb46-30" tabindex="-1"></a>    <span class="at">subtitle =</span> base<span class="sc">::</span><span class="fu">bquote</span>(</span>
<span id="cb46-31"><a href="data-overview.html#cb46-31" tabindex="-1"></a>      <span class="st">&quot;pile area: &quot;</span> <span class="sc">~</span></span>
<span id="cb46-32"><a href="data-overview.html#cb46-32" tabindex="-1"></a>      .(scales<span class="sc">::</span><span class="fu">comma</span>(d<span class="sc">$</span>image_gt_area_m2, <span class="at">accuracy =</span> <span class="fl">0.1</span>)) <span class="sc">~</span> </span>
<span id="cb46-33"><a href="data-overview.html#cb46-33" tabindex="-1"></a>      m<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb46-34"><a href="data-overview.html#cb46-34" tabindex="-1"></a>    )</span>
<span id="cb46-35"><a href="data-overview.html#cb46-35" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb46-36"><a href="data-overview.html#cb46-36" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb46-37"><a href="data-overview.html#cb46-37" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">7</span>)</span>
<span id="cb46-38"><a href="data-overview.html#cb46-38" tabindex="-1"></a>    , <span class="at">plot.title =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">8</span>)</span>
<span id="cb46-39"><a href="data-overview.html#cb46-39" tabindex="-1"></a>  )</span>
<span id="cb46-40"><a href="data-overview.html#cb46-40" tabindex="-1"></a>}</span>
<span id="cb46-41"><a href="data-overview.html#cb46-41" tabindex="-1"></a><span class="co"># plot largest, smallest, and median</span></span>
<span id="cb46-42"><a href="data-overview.html#cb46-42" tabindex="-1"></a>samp_plt_fn_temp <span class="ot">&lt;-</span> <span class="cf">function</span>(piles, ortho) {</span>
<span id="cb46-43"><a href="data-overview.html#cb46-43" tabindex="-1"></a>  min_temp <span class="ot">&lt;-</span></span>
<span id="cb46-44"><a href="data-overview.html#cb46-44" tabindex="-1"></a>    <span class="fu">plt_fn_temp</span>(</span>
<span id="cb46-45"><a href="data-overview.html#cb46-45" tabindex="-1"></a>      <span class="at">vect =</span> piles <span class="sc">%&gt;%</span> </span>
<span id="cb46-46"><a href="data-overview.html#cb46-46" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">filter</span>(is_in_stand) <span class="sc">%&gt;%</span> </span>
<span id="cb46-47"><a href="data-overview.html#cb46-47" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb46-48"><a href="data-overview.html#cb46-48" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">slice_min</span>(<span class="at">n =</span> <span class="dv">1</span>, <span class="at">order_by =</span> image_gt_area_m2, <span class="at">na_rm =</span> T, <span class="at">with_ties =</span> F)</span>
<span id="cb46-49"><a href="data-overview.html#cb46-49" tabindex="-1"></a>      , <span class="at">rgb =</span> ortho</span>
<span id="cb46-50"><a href="data-overview.html#cb46-50" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb46-51"><a href="data-overview.html#cb46-51" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;smallest&quot;</span>)</span>
<span id="cb46-52"><a href="data-overview.html#cb46-52" tabindex="-1"></a>  med_temp <span class="ot">&lt;-</span></span>
<span id="cb46-53"><a href="data-overview.html#cb46-53" tabindex="-1"></a>    <span class="fu">plt_fn_temp</span>(</span>
<span id="cb46-54"><a href="data-overview.html#cb46-54" tabindex="-1"></a>      <span class="at">vect =</span> piles <span class="sc">%&gt;%</span> </span>
<span id="cb46-55"><a href="data-overview.html#cb46-55" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">filter</span>(is_in_stand) <span class="sc">%&gt;%</span> </span>
<span id="cb46-56"><a href="data-overview.html#cb46-56" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb46-57"><a href="data-overview.html#cb46-57" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">slice_min</span>(</span>
<span id="cb46-58"><a href="data-overview.html#cb46-58" tabindex="-1"></a>          <span class="at">n =</span> <span class="dv">1</span></span>
<span id="cb46-59"><a href="data-overview.html#cb46-59" tabindex="-1"></a>          , <span class="at">order_by =</span> <span class="fu">abs</span>(image_gt_area_m2 <span class="sc">-</span> <span class="fu">median</span>(image_gt_area_m2, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb46-60"><a href="data-overview.html#cb46-60" tabindex="-1"></a>          , <span class="at">na_rm =</span> T, <span class="at">with_ties =</span> F</span>
<span id="cb46-61"><a href="data-overview.html#cb46-61" tabindex="-1"></a>        )</span>
<span id="cb46-62"><a href="data-overview.html#cb46-62" tabindex="-1"></a>      , <span class="at">rgb =</span> ortho</span>
<span id="cb46-63"><a href="data-overview.html#cb46-63" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb46-64"><a href="data-overview.html#cb46-64" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;median&quot;</span>)</span>
<span id="cb46-65"><a href="data-overview.html#cb46-65" tabindex="-1"></a>  max_temp <span class="ot">&lt;-</span></span>
<span id="cb46-66"><a href="data-overview.html#cb46-66" tabindex="-1"></a>    <span class="fu">plt_fn_temp</span>(</span>
<span id="cb46-67"><a href="data-overview.html#cb46-67" tabindex="-1"></a>      <span class="at">vect =</span> piles <span class="sc">%&gt;%</span> </span>
<span id="cb46-68"><a href="data-overview.html#cb46-68" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">filter</span>(is_in_stand) <span class="sc">%&gt;%</span> </span>
<span id="cb46-69"><a href="data-overview.html#cb46-69" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb46-70"><a href="data-overview.html#cb46-70" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">slice_max</span>(<span class="at">n =</span> <span class="dv">1</span>, <span class="at">order_by =</span> image_gt_area_m2, <span class="at">na_rm =</span> T, <span class="at">with_ties =</span> F)</span>
<span id="cb46-71"><a href="data-overview.html#cb46-71" tabindex="-1"></a>      , <span class="at">rgb =</span> ortho</span>
<span id="cb46-72"><a href="data-overview.html#cb46-72" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb46-73"><a href="data-overview.html#cb46-73" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;largest&quot;</span>)</span>
<span id="cb46-74"><a href="data-overview.html#cb46-74" tabindex="-1"></a>  <span class="co"># combine</span></span>
<span id="cb46-75"><a href="data-overview.html#cb46-75" tabindex="-1"></a>  patchwork<span class="sc">::</span><span class="fu">wrap_plots</span>(</span>
<span id="cb46-76"><a href="data-overview.html#cb46-76" tabindex="-1"></a>    <span class="fu">list</span>(min_temp, med_temp, max_temp)</span>
<span id="cb46-77"><a href="data-overview.html#cb46-77" tabindex="-1"></a>    , <span class="at">ncol =</span> <span class="dv">3</span></span>
<span id="cb46-78"><a href="data-overview.html#cb46-78" tabindex="-1"></a>  )</span>
<span id="cb46-79"><a href="data-overview.html#cb46-79" tabindex="-1"></a>}</span></code></pre></div>
<div id="psinf-mixed-conifer-site-1" class="section level3 hasAnchor" number="2.4.1">
<h3><span class="header-section-number">2.4.1</span> PSINF Mixed Conifer Site<a href="data-overview.html#psinf-mixed-conifer-site-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>example smallest, median, and largest slash pile (red) with a one square meter box for size reference</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="data-overview.html#cb47-1" tabindex="-1"></a>psinf_samp_plt_fn_temp <span class="ot">&lt;-</span> <span class="fu">samp_plt_fn_temp</span>(<span class="at">piles =</span> psinf_slash_piles_polys, <span class="at">ortho =</span> psinf_rgb_rast)</span></code></pre></div>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="data-overview.html#cb48-1" tabindex="-1"></a>psinf_samp_plt_fn_temp</span></code></pre></div>
<p><img src="slash_pile_detecting_files/figure-html/unnamed-chunk-50-1.png" width="1008" /></p>
</div>
<div id="trfo-blm-pinyon-juniper-site-1" class="section level3 hasAnchor" number="2.4.2">
<h3><span class="header-section-number">2.4.2</span> TRFO-BLM Pinyon-Juniper Site<a href="data-overview.html#trfo-blm-pinyon-juniper-site-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>example smallest, median, and largest slash pile (red) with a one square meter box for size reference</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="data-overview.html#cb49-1" tabindex="-1"></a>pj_samp_plt_fn_temp <span class="ot">&lt;-</span> <span class="fu">samp_plt_fn_temp</span>(<span class="at">piles =</span> pj_slash_piles_polys, <span class="at">ortho =</span> pj_rgb_rast)</span></code></pre></div>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="data-overview.html#cb50-1" tabindex="-1"></a>pj_samp_plt_fn_temp</span></code></pre></div>
<p><img src="slash_pile_detecting_files/figure-html/unnamed-chunk-53-1.png" width="1008" /></p>
</div>
<div id="bhef-ponderosa-pine-site-1" class="section level3 hasAnchor" number="2.4.3">
<h3><span class="header-section-number">2.4.3</span> BHEF Ponderosa Pine Site<a href="data-overview.html#bhef-ponderosa-pine-site-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>example smallest, median, and largest slash pile (red) with a one square meter box for size reference</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="data-overview.html#cb51-1" tabindex="-1"></a>bhef_samp_plt_fn_temp <span class="ot">&lt;-</span> <span class="fu">samp_plt_fn_temp</span>(<span class="at">piles =</span> bhef_slash_piles_polys, <span class="at">ortho =</span> bhef_rgb_rast)</span></code></pre></div>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="data-overview.html#cb52-1" tabindex="-1"></a>bhef_samp_plt_fn_temp</span></code></pre></div>
<p><img src="slash_pile_detecting_files/figure-html/unnamed-chunk-55-1.png" width="1008" /></p>
</div>
<div id="arnf-ponderosa-pine-site-1" class="section level3 hasAnchor" number="2.4.4">
<h3><span class="header-section-number">2.4.4</span> ARNF Ponderosa Pine Site<a href="data-overview.html#arnf-ponderosa-pine-site-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>example smallest, median, and largest slash pile (red) with a one square meter box for size reference</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="data-overview.html#cb53-1" tabindex="-1"></a>arnf_samp_plt_fn_temp <span class="ot">&lt;-</span> <span class="fu">samp_plt_fn_temp</span>(<span class="at">piles =</span> arnf_slash_piles_polys, <span class="at">ortho =</span> arnf_rgb_rast)</span></code></pre></div>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="data-overview.html#cb54-1" tabindex="-1"></a>arnf_samp_plt_fn_temp</span></code></pre></div>
<p><img src="slash_pile_detecting_files/figure-html/unnamed-chunk-57-1.png" width="1008" /></p>
</div>
<div id="all" class="section level3 hasAnchor" number="2.4.5">
<h3><span class="header-section-number">2.4.5</span> All<a href="data-overview.html#all" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="data-overview.html#cb55-1" tabindex="-1"></a>patchwork<span class="sc">::</span><span class="fu">wrap_plots</span>(</span>
<span id="cb55-2"><a href="data-overview.html#cb55-2" tabindex="-1"></a>  patchwork<span class="sc">::</span><span class="fu">wrap_elements</span>( </span>
<span id="cb55-3"><a href="data-overview.html#cb55-3" tabindex="-1"></a>    psinf_samp_plt_fn_temp <span class="sc">+</span> </span>
<span id="cb55-4"><a href="data-overview.html#cb55-4" tabindex="-1"></a>      patchwork<span class="sc">::</span><span class="fu">plot_annotation</span>(</span>
<span id="cb55-5"><a href="data-overview.html#cb55-5" tabindex="-1"></a>        <span class="at">title =</span> <span class="st">&quot;PSINF Mixed Conifer Site&quot;</span></span>
<span id="cb55-6"><a href="data-overview.html#cb55-6" tabindex="-1"></a>        , <span class="at">theme =</span> ggplot2<span class="sc">::</span><span class="fu">theme</span>(<span class="at">plot.title =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>))</span>
<span id="cb55-7"><a href="data-overview.html#cb55-7" tabindex="-1"></a>      ) </span>
<span id="cb55-8"><a href="data-overview.html#cb55-8" tabindex="-1"></a>    )</span>
<span id="cb55-9"><a href="data-overview.html#cb55-9" tabindex="-1"></a>  , patchwork<span class="sc">::</span><span class="fu">wrap_elements</span>( </span>
<span id="cb55-10"><a href="data-overview.html#cb55-10" tabindex="-1"></a>    pj_samp_plt_fn_temp <span class="sc">+</span> </span>
<span id="cb55-11"><a href="data-overview.html#cb55-11" tabindex="-1"></a>      patchwork<span class="sc">::</span><span class="fu">plot_annotation</span>(</span>
<span id="cb55-12"><a href="data-overview.html#cb55-12" tabindex="-1"></a>        <span class="at">title =</span> <span class="st">&quot;TRFO-BLM Pinyon-Juniper Site&quot;</span></span>
<span id="cb55-13"><a href="data-overview.html#cb55-13" tabindex="-1"></a>        , <span class="at">theme =</span> ggplot2<span class="sc">::</span><span class="fu">theme</span>(<span class="at">plot.title =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>))</span>
<span id="cb55-14"><a href="data-overview.html#cb55-14" tabindex="-1"></a>      ) </span>
<span id="cb55-15"><a href="data-overview.html#cb55-15" tabindex="-1"></a>    )</span>
<span id="cb55-16"><a href="data-overview.html#cb55-16" tabindex="-1"></a>  , patchwork<span class="sc">::</span><span class="fu">wrap_elements</span>( </span>
<span id="cb55-17"><a href="data-overview.html#cb55-17" tabindex="-1"></a>    bhef_samp_plt_fn_temp <span class="sc">+</span> </span>
<span id="cb55-18"><a href="data-overview.html#cb55-18" tabindex="-1"></a>      patchwork<span class="sc">::</span><span class="fu">plot_annotation</span>(</span>
<span id="cb55-19"><a href="data-overview.html#cb55-19" tabindex="-1"></a>        <span class="at">title =</span> <span class="st">&quot;BHEF Ponderosa Pine Site&quot;</span></span>
<span id="cb55-20"><a href="data-overview.html#cb55-20" tabindex="-1"></a>        , <span class="at">theme =</span> ggplot2<span class="sc">::</span><span class="fu">theme</span>(<span class="at">plot.title =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>))</span>
<span id="cb55-21"><a href="data-overview.html#cb55-21" tabindex="-1"></a>      ) </span>
<span id="cb55-22"><a href="data-overview.html#cb55-22" tabindex="-1"></a>    )</span>
<span id="cb55-23"><a href="data-overview.html#cb55-23" tabindex="-1"></a>  , patchwork<span class="sc">::</span><span class="fu">wrap_elements</span>( </span>
<span id="cb55-24"><a href="data-overview.html#cb55-24" tabindex="-1"></a>    arnf_samp_plt_fn_temp <span class="sc">+</span> </span>
<span id="cb55-25"><a href="data-overview.html#cb55-25" tabindex="-1"></a>      patchwork<span class="sc">::</span><span class="fu">plot_annotation</span>(</span>
<span id="cb55-26"><a href="data-overview.html#cb55-26" tabindex="-1"></a>        <span class="at">title =</span> <span class="st">&quot;ARNF Ponderosa Pine Site&quot;</span></span>
<span id="cb55-27"><a href="data-overview.html#cb55-27" tabindex="-1"></a>        , <span class="at">theme =</span> ggplot2<span class="sc">::</span><span class="fu">theme</span>(<span class="at">plot.title =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>))</span>
<span id="cb55-28"><a href="data-overview.html#cb55-28" tabindex="-1"></a>      ) </span>
<span id="cb55-29"><a href="data-overview.html#cb55-29" tabindex="-1"></a>    )</span>
<span id="cb55-30"><a href="data-overview.html#cb55-30" tabindex="-1"></a>  , <span class="at">ncol =</span> <span class="dv">1</span></span>
<span id="cb55-31"><a href="data-overview.html#cb55-31" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="slash_pile_detecting_files/figure-html/unnamed-chunk-58-1.png" width="480" /></p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="ptcld_process.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
  "sharing": {
    "github": false,
    "facebook": true,
    "twitter": true,
    "linkedin": false,
    "weibo": false,
    "instapaper": false,
    "vk": false,
    "whatsapp": false,
    "all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
  },
  "fontsettings": {
    "theme": "white",
    "family": "sans",
    "size": 2
  },
  "edit": {
    "link": null,
    "text": null
  },
  "history": {
    "link": null,
    "text": null
  },
  "view": {
    "link": null,
    "text": null
  },
  "download": null,
  "search": {
    "engine": "fuse",
    "options": null
  },
  "toc": {
    "collapse": "subsection"
  }
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
