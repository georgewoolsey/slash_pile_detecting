<!DOCTYPE html>
<html lang="en-US" xml:lang="en-US">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Section 6 Method Evaluation | Aerial Imagery and Point Cloud Data for Slash Pile Quantification</title>
  <meta name="description" content="Using the bookdown package to write a book of data exploration. The output format for this example is bookdown::gitbook." />
  <meta name="generator" content="bookdown 0.34 and GitBook 2.6.7" />

  <meta property="og:title" content="Section 6 Method Evaluation | Aerial Imagery and Point Cloud Data for Slash Pile Quantification" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="Using the bookdown package to write a book of data exploration. The output format for this example is bookdown::gitbook." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Section 6 Method Evaluation | Aerial Imagery and Point Cloud Data for Slash Pile Quantification" />
  
  <meta name="twitter:description" content="Using the bookdown package to write a book of data exploration. The output format for this example is bookdown::gitbook." />
  

<meta name="author" content="George Woolsey" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="data_fusion.html"/>
<link rel="next" href="meth_preds.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<link href="libs/htmltools-fill-0.5.9/fill.css" rel="stylesheet" />
<script src="libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/proj4-2.6.2/proj4.min.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.2.2/leaflet.js"></script>
<script src="libs/leaflet-providers-2.0.0/leaflet-providers_2.0.0.js"></script>
<script src="libs/leaflet-providers-plugin-2.2.2/leaflet-providers-plugin.js"></script>
<script src="libs/HomeButton-0.0.1/home-button.js"></script>
<script src="libs/HomeButton-0.0.1/easy-button-src.min.js"></script>
<link href="libs/study sites-CSS-0.0.1/study sites_home-button.css" rel="stylesheet" />
<script src="libs/clipboard-0.0.1/setClipboardText.js"></script>
<link href="libs/mapviewCSS-0.0.1/mapview-popup.css" rel="stylesheet" />
<link href="libs/mapviewCSS-0.0.1/mapview.css" rel="stylesheet" />
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<link href="libs/bsTable-3.3.7/bootstrapTable.min.css" rel="stylesheet" />
<script src="libs/bsTable-3.3.7/bootstrapTable.js"></script>
<script type="text/javascript">

// toggle visibility of R source blocks in R Markdown output
function toggle_R() {
  var x = document.getElementsByClassName('r');
  if (x.length == 0) return;
  function toggle_vis(o) {
    var d = o.style.display;
    o.style.display = (d == 'block' || d == '') ? 'none':'block';
  }

  for (i = 0; i < x.length; i++) {
    var y = x[i];
    if (y.tagName.toLowerCase() === 'pre') toggle_vis(y);
  }

    var elem = document.getElementById("myButton1");
    if (elem.value === "Hide Code") elem.value = "Show Code";
    else elem.value = "Hide Code";
}

document.write('<input onclick="toggle_R();" type="button" value="Hide Code" id="myButton1" style="position: absolute; top: 10%; right: 2%; z-index: 200"></input>')

</script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#objective"><i class="fa fa-check"></i><b>1.1</b> Objective</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#data_desc"><i class="fa fa-check"></i><b>1.2</b> Data and Site Descriptions</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="index.html"><a href="index.html#silvicultural-prescriptions"><i class="fa fa-check"></i><b>1.2.1</b> Silvicultural Prescriptions</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#analysis-plan"><i class="fa fa-check"></i><b>1.3</b> Analysis Plan</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="data_load.html"><a href="data_load.html"><i class="fa fa-check"></i><b>2</b> Data Overview</a>
<ul>
<li class="chapter" data-level="2.1" data-path="data_load.html"><a href="data_load.html#study-units-vector-data"><i class="fa fa-check"></i><b>2.1</b> Study Units Vector Data</a></li>
<li class="chapter" data-level="2.2" data-path="data_load.html"><a href="data_load.html#slash-pile-vector-data"><i class="fa fa-check"></i><b>2.2</b> Slash Pile Vector Data</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="data_load.html"><a href="data_load.html#standardize-pile-data"><i class="fa fa-check"></i><b>2.2.1</b> Standardize Pile Data</a></li>
<li class="chapter" data-level="2.2.2" data-path="data_load.html"><a href="data_load.html#pile-form-measurements"><i class="fa fa-check"></i><b>2.2.2</b> Pile Form Measurements</a></li>
<li class="chapter" data-level="2.2.3" data-path="data_load.html"><a href="data_load.html#image-annotation-comparison"><i class="fa fa-check"></i><b>2.2.3</b> Image-Annotation Comparison</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="data_load.html"><a href="data_load.html#rgb-orthomosaic"><i class="fa fa-check"></i><b>2.3</b> RGB orthomosaic</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="data_load.html"><a href="data_load.html#psinf-mixed-conifer-site-1"><i class="fa fa-check"></i><b>2.3.1</b> PSINF Mixed Conifer Site</a></li>
<li class="chapter" data-level="2.3.2" data-path="data_load.html"><a href="data_load.html#trfo-blm-pinyon-juniper-site-1"><i class="fa fa-check"></i><b>2.3.2</b> TRFO-BLM Pinyon-Juniper Site</a></li>
<li class="chapter" data-level="2.3.3" data-path="data_load.html"><a href="data_load.html#bhef-ponderosa-pine-site-1"><i class="fa fa-check"></i><b>2.3.3</b> BHEF Ponderosa Pine Site</a></li>
<li class="chapter" data-level="2.3.4" data-path="data_load.html"><a href="data_load.html#arnf-ponderosa-pine-site-1"><i class="fa fa-check"></i><b>2.3.4</b> ARNF Ponderosa Pine Site</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="data_load.html"><a href="data_load.html#slash-pile-rgb-imagery"><i class="fa fa-check"></i><b>2.4</b> Slash Pile RGB Imagery</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="data_load.html"><a href="data_load.html#psinf-mixed-conifer-site-2"><i class="fa fa-check"></i><b>2.4.1</b> PSINF Mixed Conifer Site</a></li>
<li class="chapter" data-level="2.4.2" data-path="data_load.html"><a href="data_load.html#trfo-blm-pinyon-juniper-site-2"><i class="fa fa-check"></i><b>2.4.2</b> TRFO-BLM Pinyon-Juniper Site</a></li>
<li class="chapter" data-level="2.4.3" data-path="data_load.html"><a href="data_load.html#bhef-ponderosa-pine-site-2"><i class="fa fa-check"></i><b>2.4.3</b> BHEF Ponderosa Pine Site</a></li>
<li class="chapter" data-level="2.4.4" data-path="data_load.html"><a href="data_load.html#arnf-ponderosa-pine-site-2"><i class="fa fa-check"></i><b>2.4.4</b> ARNF Ponderosa Pine Site</a></li>
<li class="chapter" data-level="2.4.5" data-path="data_load.html"><a href="data_load.html#all"><i class="fa fa-check"></i><b>2.4.5</b> All</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="ptcld_process.html"><a href="ptcld_process.html"><i class="fa fa-check"></i><b>3</b> Point Cloud Processing</a>
<ul>
<li class="chapter" data-level="3.1" data-path="ptcld_process.html"><a href="ptcld_process.html#process-raw-point-cloud"><i class="fa fa-check"></i><b>3.1</b> Process Raw Point Cloud</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="ptcld_process.html"><a href="ptcld_process.html#ptcld_process_psinf"><i class="fa fa-check"></i><b>3.1.1</b> PSINF Mixed Conifer Site</a></li>
<li class="chapter" data-level="3.1.2" data-path="ptcld_process.html"><a href="ptcld_process.html#trfo-blm-pinyon-juniper-site-3"><i class="fa fa-check"></i><b>3.1.2</b> TRFO-BLM Pinyon-Juniper Site</a></li>
<li class="chapter" data-level="3.1.3" data-path="ptcld_process.html"><a href="ptcld_process.html#bhef-ponderosa-pine-site-3"><i class="fa fa-check"></i><b>3.1.3</b> BHEF Ponderosa Pine Site</a></li>
<li class="chapter" data-level="3.1.4" data-path="ptcld_process.html"><a href="ptcld_process.html#arnf-ponderosa-pine-site-3"><i class="fa fa-check"></i><b>3.1.4</b> ARNF Ponderosa Pine Site</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="ptcld_process.html"><a href="ptcld_process.html#clean-up"><i class="fa fa-check"></i><b>3.2</b> Clean Up</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="geom_detect.html"><a href="geom_detect.html"><i class="fa fa-check"></i><b>4</b> Geometry-based Slash Pile Detection</a>
<ul>
<li class="chapter" data-level="4.1" data-path="geom_detect.html"><a href="geom_detect.html#d_area"><i class="fa fa-check"></i><b>4.1</b> Demonstration Area</a></li>
<li class="chapter" data-level="4.2" data-path="geom_detect.html"><a href="geom_detect.html#segmentation-methods"><i class="fa fa-check"></i><b>4.2</b> Segmentation Methods</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="geom_detect.html"><a href="geom_detect.html#seg_methods"><i class="fa fa-check"></i><b>4.2.1</b> Overview of Methods</a></li>
<li class="chapter" data-level="4.2.2" data-path="geom_detect.html"><a href="geom_detect.html#watershed-segmentation-demonstration"><i class="fa fa-check"></i><b>4.2.2</b> Watershed Segmentation Demonstration</a></li>
<li class="chapter" data-level="4.2.3" data-path="geom_detect.html"><a href="geom_detect.html#dbscan-segmentation-demonstration"><i class="fa fa-check"></i><b>4.2.3</b> DBSCAN Segmentation Demonstration</a></li>
<li class="chapter" data-level="4.2.4" data-path="geom_detect.html"><a href="geom_detect.html#comparison-of-candidate-segments"><i class="fa fa-check"></i><b>4.2.4</b> Comparison of Candidate Segments</a></li>
<li class="chapter" data-level="4.2.5" data-path="geom_detect.html"><a href="geom_detect.html#segmentation-function"><i class="fa fa-check"></i><b>4.2.5</b> Segmentation Function</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="geom_detect.html"><a href="geom_detect.html#candidate-shape-refinement-and-area-filtering"><i class="fa fa-check"></i><b>4.3</b> Candidate Shape Refinement and Area filtering</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="geom_detect.html"><a href="geom_detect.html#watershed-segmentation"><i class="fa fa-check"></i><b>4.3.1</b> Watershed Segmentation</a></li>
<li class="chapter" data-level="4.3.2" data-path="geom_detect.html"><a href="geom_detect.html#dbscan-segmentation"><i class="fa fa-check"></i><b>4.3.2</b> DBSCAN Segmentation</a></li>
<li class="chapter" data-level="4.3.3" data-path="geom_detect.html"><a href="geom_detect.html#quick-methods-comparison"><i class="fa fa-check"></i><b>4.3.3</b> Quick methods comparison</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="geom_detect.html"><a href="geom_detect.html#candidate-geometric-filtering"><i class="fa fa-check"></i><b>4.4</b> Candidate Geometric filtering</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="geom_detect.html"><a href="geom_detect.html#shape-irregularity-convexity"><i class="fa fa-check"></i><b>4.4.1</b> Shape Irregularity: Convexity</a></li>
<li class="chapter" data-level="4.4.2" data-path="geom_detect.html"><a href="geom_detect.html#shape-irregularity-circularity"><i class="fa fa-check"></i><b>4.4.2</b> Shape Irregularity: Circularity</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="geom_detect.html"><a href="geom_detect.html#structural-metrics-from-chm"><i class="fa fa-check"></i><b>4.5</b> Structural Metrics from CHM</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="geom_detect.html"><a href="geom_detect.html#structural-rasters"><i class="fa fa-check"></i><b>4.5.1</b> Structural Rasters</a></li>
<li class="chapter" data-level="4.5.2" data-path="geom_detect.html"><a href="geom_detect.html#demonstration-candidate-segment-metrics"><i class="fa fa-check"></i><b>4.5.2</b> Demonstration Candidate Segment Metrics</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="geom_detect.html"><a href="geom_detect.html#final-shape-refinement"><i class="fa fa-check"></i><b>4.6</b> Final Shape Refinement</a>
<ul>
<li class="chapter" data-level="4.6.1" data-path="geom_detect.html"><a href="geom_detect.html#watershed-segmentation-3"><i class="fa fa-check"></i><b>4.6.1</b> Watershed Segmentation</a></li>
<li class="chapter" data-level="4.6.2" data-path="geom_detect.html"><a href="geom_detect.html#dbscan-segmentation-3"><i class="fa fa-check"></i><b>4.6.2</b> DBSCAN Segmentation</a></li>
<li class="chapter" data-level="4.6.3" data-path="geom_detect.html"><a href="geom_detect.html#quick-methods-comparison-2"><i class="fa fa-check"></i><b>4.6.3</b> Quick methods comparison</a></li>
</ul></li>
<li class="chapter" data-level="4.7" data-path="geom_detect.html"><a href="geom_detect.html#slash_pile_detect_fn"><i class="fa fa-check"></i><b>4.7</b> Pile Detection Function</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="data_fusion.html"><a href="data_fusion.html"><i class="fa fa-check"></i><b>5</b> Data Fusion</a>
<ul>
<li class="chapter" data-level="5.1" data-path="data_fusion.html"><a href="data_fusion.html#rgb-indices"><i class="fa fa-check"></i><b>5.1</b> RGB Indices</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="data_fusion.html"><a href="data_fusion.html#spectral-index-functions"><i class="fa fa-check"></i><b>5.1.1</b> Spectral Index Functions</a></li>
<li class="chapter" data-level="5.1.2" data-path="data_fusion.html"><a href="data_fusion.html#spectral-index-of-polygons"><i class="fa fa-check"></i><b>5.1.2</b> Spectral Index of Polygons</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="data_fusion.html"><a href="data_fusion.html#demonstration-pile-spectral-summary"><i class="fa fa-check"></i><b>5.2</b> Demonstration Pile Spectral Summary</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="data_fusion.html"><a href="data_fusion.html#voting-system"><i class="fa fa-check"></i><b>5.2.1</b> Voting System</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="data_fusion.html"><a href="data_fusion.html#polygon_spectral_filtering"><i class="fa fa-check"></i><b>5.3</b> Candidate Polygon Spectral Filtering Function</a></li>
<li class="chapter" data-level="5.4" data-path="data_fusion.html"><a href="data_fusion.html#data-fusion-method-demonstration"><i class="fa fa-check"></i><b>5.4</b> Data Fusion Method Demonstration</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="meth_eval.html"><a href="meth_eval.html"><i class="fa fa-check"></i><b>6</b> Method Evaluation</a>
<ul>
<li class="chapter" data-level="6.1" data-path="meth_eval.html"><a href="meth_eval.html#iou_match"><i class="fa fa-check"></i><b>6.1</b> Instance Matching</a></li>
<li class="chapter" data-level="6.2" data-path="meth_eval.html"><a href="meth_eval.html#detect_metrics_form"><i class="fa fa-check"></i><b>6.2</b> Detection Accuracy Metrics</a></li>
<li class="chapter" data-level="6.3" data-path="meth_eval.html"><a href="meth_eval.html#quant_metrics_form"><i class="fa fa-check"></i><b>6.3</b> Quantification Accuracy Metrics</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="meth_preds.html"><a href="meth_preds.html"><i class="fa fa-check"></i><b>7</b> Method Predictions</a>
<ul>
<li class="chapter" data-level="7.1" data-path="meth_preds.html"><a href="meth_preds.html#size-and-geometric-parameter-settings"><i class="fa fa-check"></i><b>7.1</b> Size and Geometric Parameter Settings</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="meth_preds.html"><a href="meth_preds.html#psinf-mixed-conifer-site-3"><i class="fa fa-check"></i><b>7.1.1</b> PSINF Mixed Conifer Site</a></li>
<li class="chapter" data-level="7.1.2" data-path="meth_preds.html"><a href="meth_preds.html#trfo-blm-pinyon-juniper-site-4"><i class="fa fa-check"></i><b>7.1.2</b> TRFO-BLM Pinyon-Juniper Site</a></li>
<li class="chapter" data-level="7.1.3" data-path="meth_preds.html"><a href="meth_preds.html#bhef-ponderosa-pine-site-4"><i class="fa fa-check"></i><b>7.1.3</b> BHEF Ponderosa Pine Site</a></li>
<li class="chapter" data-level="7.1.4" data-path="meth_preds.html"><a href="meth_preds.html#arnf-ponderosa-pine-site-4"><i class="fa fa-check"></i><b>7.1.4</b> ARNF Ponderosa Pine Site</a></li>
<li class="chapter" data-level="7.1.5" data-path="meth_preds.html"><a href="meth_preds.html#study-paremeter-settings"><i class="fa fa-check"></i><b>7.1.5</b> Study Paremeter Settings</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="meth_preds.html"><a href="meth_preds.html#chm-based-slash-pile-candidates"><i class="fa fa-check"></i><b>7.2</b> CHM-based Slash Pile Candidates</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="meth_preds.html"><a href="meth_preds.html#dbscan-candidates"><i class="fa fa-check"></i><b>7.2.1</b> DBSCAN Candidates</a></li>
<li class="chapter" data-level="7.2.2" data-path="meth_preds.html"><a href="meth_preds.html#watershed-candidates"><i class="fa fa-check"></i><b>7.2.2</b> Watershed Candidates</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="meth_preds.html"><a href="meth_preds.html#spectral-filter-slash-pile-candidates"><i class="fa fa-check"></i><b>7.3</b> Spectral Filter Slash Pile Candidates</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="meth_preds.html"><a href="meth_preds.html#dbscan-predictions"><i class="fa fa-check"></i><b>7.3.1</b> DBSCAN Predictions</a></li>
<li class="chapter" data-level="7.3.2" data-path="meth_preds.html"><a href="meth_preds.html#watershed-predictions"><i class="fa fa-check"></i><b>7.3.2</b> Watershed Predictions</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="preds_detect.html"><a href="preds_detect.html"><i class="fa fa-check"></i><b>8</b> Detection Accuracy</a>
<ul>
<li class="chapter" data-level="8.1" data-path="preds_detect.html"><a href="preds_detect.html#instance-matching"><i class="fa fa-check"></i><b>8.1</b> Instance Matching</a></li>
<li class="chapter" data-level="8.2" data-path="preds_detect.html"><a href="preds_detect.html#detection-accuracy-metrics"><i class="fa fa-check"></i><b>8.2</b> Detection Accuracy Metrics</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="preds_detect.html"><a href="preds_detect.html#agg_inst_match"><i class="fa fa-check"></i><b>8.2.1</b> Aggregate Instance Match Results</a></li>
<li class="chapter" data-level="8.2.2" data-path="preds_detect.html"><a href="preds_detect.html#detection-accuracy-results"><i class="fa fa-check"></i><b>8.2.2</b> Detection Accuracy Results</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="preds_detect.html"><a href="preds_detect.html#segmentation-method-accuracy-comparison"><i class="fa fa-check"></i><b>8.3</b> Segmentation Method Accuracy Comparison</a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="preds_detect.html"><a href="preds_detect.html#paired-t-test"><i class="fa fa-check"></i><b>8.3.1</b> Paired T-Test</a></li>
<li class="chapter" data-level="8.3.2" data-path="preds_detect.html"><a href="preds_detect.html#bayesian-approach"><i class="fa fa-check"></i><b>8.3.2</b> Bayesian Approach</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="preds_detect.html"><a href="preds_detect.html#individual-pile-evaluation"><i class="fa fa-check"></i><b>8.4</b> Individual Pile Evaluation</a>
<ul>
<li class="chapter" data-level="8.4.1" data-path="preds_detect.html"><a href="preds_detect.html#true-positives"><i class="fa fa-check"></i><b>8.4.1</b> True Positives</a></li>
<li class="chapter" data-level="8.4.2" data-path="preds_detect.html"><a href="preds_detect.html#omissions-false-negatives"><i class="fa fa-check"></i><b>8.4.2</b> Omissions (False Negatives)</a></li>
<li class="chapter" data-level="8.4.3" data-path="preds_detect.html"><a href="preds_detect.html#commissions-false-positives"><i class="fa fa-check"></i><b>8.4.3</b> commissions (False Positives)</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="preds_quantit.html"><a href="preds_quantit.html"><i class="fa fa-check"></i><b>9</b> Quantification Accuracy</a>
<ul>
<li class="chapter" data-level="9.1" data-path="preds_quantit.html"><a href="preds_quantit.html#height-and-diameter-accuracy"><i class="fa fa-check"></i><b>9.1</b> Height and Diameter Accuracy</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="preds_quantit.html"><a href="preds_quantit.html#stand-level-aggregation"><i class="fa fa-check"></i><b>9.1.1</b> Stand-level Aggregation</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="preds_quantit.html"><a href="preds_quantit.html#area-accuracy"><i class="fa fa-check"></i><b>9.2</b> Area Accuracy</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="preds_quantit.html"><a href="preds_quantit.html#stand-level-aggregation-1"><i class="fa fa-check"></i><b>9.2.1</b> Stand-level Aggregation</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="preds_quantit.html"><a href="preds_quantit.html#vol_comp"><i class="fa fa-check"></i><b>9.3</b> Volume Comparison</a>
<ul>
<li class="chapter" data-level="9.3.1" data-path="preds_quantit.html"><a href="preds_quantit.html#extreme-volume-disagreements"><i class="fa fa-check"></i><b>9.3.1</b> Extreme Volume Disagreements</a></li>
<li class="chapter" data-level="9.3.2" data-path="preds_quantit.html"><a href="preds_quantit.html#allometric-volume-comparison"><i class="fa fa-check"></i><b>9.3.2</b> Allometric Volume Comparison</a></li>
<li class="chapter" data-level="9.3.3" data-path="preds_quantit.html"><a href="preds_quantit.html#stand-level-aggregation-2"><i class="fa fa-check"></i><b>9.3.3</b> Stand-level Aggregation</a></li>
</ul></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Aerial Imagery and Point Cloud Data for Slash Pile Quantification</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="meth_eval" class="section level1 hasAnchor" number="6">
<h1><span class="header-section-number">Section 6</span> Method Evaluation<a href="meth_eval.html#meth_eval" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>This section is entirely devoted to detailing the methods and defining analysis functions for instance matching and the calculation of overall prediction performance assessment metrics. Image-annotated slash pile footprints, which are <a href="index.html#data_desc">available across all study sites</a>, will be used as the ground truth data to perform a confusion matrix-based validation accuracy assessment of the methods.</p>
<p><a href="meth_eval.html#iou_match">Instance matching</a> compares predicted pile segments to the ground truth data to establish True Positives (TP), False Positives (FP, commissions), and False Negatives (FN, omissions). Aggregation of the instance matching results allows us to calculate performance assessment metrics to determine overall detection accuracy and form quantification accuracy.</p>
<ul>
<li><a href="meth_eval.html#detect_metrics_form">detection accuracy metrics</a>: including Recall, Precision, and F-score, are calculated directly by aggregating these raw TP, FP, and FN counts and quantifies the method’s ability to find the piles</li>
<li><a href="meth_eval.html#quant_metrics_form">quantification accuracy metrics</a>: such as RMSE, MAPE, and Mean Error of pile form measurements (e.g. height, diameter) are calculated by aggregating the differences between the estimated pile attributes and the ground truth values for instances classified as True Positives. These metrics tell us about the method’s ability to accurately quantify the form of the piles it successfully identified</li>
</ul>
<div id="iou_match" class="section level2 hasAnchor" number="6.1">
<h2><span class="header-section-number">6.1</span> Instance Matching<a href="meth_eval.html#iou_match" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Puliti et al. <a href="https://doi.org/10.48550/arXiv.2309.01279">(2023, p. 14)</a> provide guidance on performing “instance segmentation evaluation” to assess the ability of a method to correctly identify and delineate individual tree crown instances compared ground truth data. We’ll use this same methodology to test our slash pile identification approach.</p>
<blockquote>
<p>The first step in performing any instance segmentation evaluation is to match the point cloud reference and predicted instance IDs. To do this, it is necessary to define whether a prediction is correct. Here we adopt a method Wielgosz et al. (2023) proposed for matching tree instance IDs from two point clouds with reference and predicted instance IDs, respectively. Given a reference and a predicted point cloud with two separate sets of instances, the tree instances are iteratively matched in descending order from the tallest to the shortest trees by using the following algorithm:</p>
</blockquote>
<ol style="list-style-type: lower-alpha">
<li>Find the tallest tree in the reference data;</li>
<li>Find the tree in the predicted instances that have the largest intersection over union (IoU) with the tree selected in the previous step;</li>
<li>if the IoU is &lt;0.5: the predicted tree is considered an error, and thus no reference instance ID is available;</li>
<li>if the IoU is ≥0.5: the tree is considered a correct match, and assign reference instance ID label to the predicted tree;</li>
<li>Add to collection (dictionary) of predicted tree instances with IDs matching the reference instance IDs.</li>
</ol>
<p>Following the initial matching of reference and predicted instance IDs, the evaluation can be done on the tree level to evaluate detection, omission, and commission rates (which can be used to calculate precision, recall, and the F-score metric)</p>
<div class="sourceCode" id="cb243"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb243-1"><a href="meth_eval.html#cb243-1" tabindex="-1"></a><span class="co"># check the data</span></span>
<span id="cb243-2"><a href="meth_eval.html#cb243-2" tabindex="-1"></a>check_gt_str <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb243-3"><a href="meth_eval.html#cb243-3" tabindex="-1"></a>  gt_inst</span>
<span id="cb243-4"><a href="meth_eval.html#cb243-4" tabindex="-1"></a>  , <span class="at">gt_id =</span> <span class="st">&quot;pile_id&quot;</span></span>
<span id="cb243-5"><a href="meth_eval.html#cb243-5" tabindex="-1"></a>  , predictions</span>
<span id="cb243-6"><a href="meth_eval.html#cb243-6" tabindex="-1"></a>  , <span class="at">pred_id =</span> <span class="st">&quot;pred_pile_id&quot;</span>  </span>
<span id="cb243-7"><a href="meth_eval.html#cb243-7" tabindex="-1"></a>) {</span>
<span id="cb243-8"><a href="meth_eval.html#cb243-8" tabindex="-1"></a>  <span class="cf">if</span>( <span class="sc">!</span><span class="fu">inherits</span>(gt_inst,<span class="st">&quot;sf&quot;</span>)){<span class="fu">stop</span>(<span class="st">&quot;ground truth must be spatial `sf` data with a single record&quot;</span>)}</span>
<span id="cb243-9"><a href="meth_eval.html#cb243-9" tabindex="-1"></a>  <span class="cf">if</span>( <span class="sc">!</span><span class="fu">inherits</span>(predictions,<span class="st">&quot;sf&quot;</span>) ){<span class="fu">stop</span>(<span class="st">&quot;predictions must be spatial `sf` data&quot;</span>)}</span>
<span id="cb243-10"><a href="meth_eval.html#cb243-10" tabindex="-1"></a>  <span class="cf">if</span>( <span class="sc">!</span><span class="fu">identical</span>(sf<span class="sc">::</span><span class="fu">st_crs</span>(gt_inst),sf<span class="sc">::</span><span class="fu">st_crs</span>(predictions)) ){<span class="fu">stop</span>(<span class="st">&quot;`sf` data should have same crs projection&quot;</span>)}</span>
<span id="cb243-11"><a href="meth_eval.html#cb243-11" tabindex="-1"></a>  <span class="cf">if</span>( <span class="fu">is.null</span>(gt_id) <span class="sc">||</span> <span class="fu">is.na</span>(gt_id) <span class="sc">||</span> </span>
<span id="cb243-12"><a href="meth_eval.html#cb243-12" tabindex="-1"></a>      <span class="sc">!</span><span class="fu">inherits</span>(gt_id, <span class="st">&quot;character&quot;</span>) <span class="sc">||</span></span>
<span id="cb243-13"><a href="meth_eval.html#cb243-13" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_trim</span>(gt_id) <span class="sc">==</span> <span class="st">&quot;&quot;</span> </span>
<span id="cb243-14"><a href="meth_eval.html#cb243-14" tabindex="-1"></a>  ){</span>
<span id="cb243-15"><a href="meth_eval.html#cb243-15" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">&quot;ground truth data must contain `gt_id` column&quot;</span>)</span>
<span id="cb243-16"><a href="meth_eval.html#cb243-16" tabindex="-1"></a>  }</span>
<span id="cb243-17"><a href="meth_eval.html#cb243-17" tabindex="-1"></a>  <span class="cf">if</span>( <span class="fu">is.null</span>(pred_id) <span class="sc">||</span> <span class="fu">is.na</span>(pred_id) <span class="sc">||</span> </span>
<span id="cb243-18"><a href="meth_eval.html#cb243-18" tabindex="-1"></a>      <span class="sc">!</span><span class="fu">inherits</span>(pred_id, <span class="st">&quot;character&quot;</span>) <span class="sc">||</span></span>
<span id="cb243-19"><a href="meth_eval.html#cb243-19" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_trim</span>(pred_id) <span class="sc">==</span> <span class="st">&quot;&quot;</span> </span>
<span id="cb243-20"><a href="meth_eval.html#cb243-20" tabindex="-1"></a>  ){</span>
<span id="cb243-21"><a href="meth_eval.html#cb243-21" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">&quot;ground truth  data must contain `pred_id` column&quot;</span>)</span>
<span id="cb243-22"><a href="meth_eval.html#cb243-22" tabindex="-1"></a>  }</span>
<span id="cb243-23"><a href="meth_eval.html#cb243-23" tabindex="-1"></a>  <span class="cf">if</span>( <span class="sc">!</span>(<span class="fu">names</span>(gt_inst) <span class="sc">%&gt;%</span> stringr<span class="sc">::</span><span class="fu">str_equal</span>(gt_id) <span class="sc">%&gt;%</span> <span class="fu">any</span>()) ){<span class="fu">stop</span>(<span class="st">&quot;ground truth  data must contain `gt_id` column&quot;</span>)}</span>
<span id="cb243-24"><a href="meth_eval.html#cb243-24" tabindex="-1"></a>  <span class="co"># get rid of gt_id if it exists in the predictions and is not the key</span></span>
<span id="cb243-25"><a href="meth_eval.html#cb243-25" tabindex="-1"></a>  <span class="cf">if</span>( </span>
<span id="cb243-26"><a href="meth_eval.html#cb243-26" tabindex="-1"></a>    (<span class="fu">names</span>(predictions) <span class="sc">%&gt;%</span> stringr<span class="sc">::</span><span class="fu">str_equal</span>(gt_id) <span class="sc">%&gt;%</span> <span class="fu">any</span>() )</span>
<span id="cb243-27"><a href="meth_eval.html#cb243-27" tabindex="-1"></a>    <span class="sc">&amp;&amp;</span> (gt_id<span class="sc">!=</span>pred_id)</span>
<span id="cb243-28"><a href="meth_eval.html#cb243-28" tabindex="-1"></a>  ){</span>
<span id="cb243-29"><a href="meth_eval.html#cb243-29" tabindex="-1"></a>    predictions <span class="ot">&lt;-</span> predictions <span class="sc">%&gt;%</span> </span>
<span id="cb243-30"><a href="meth_eval.html#cb243-30" tabindex="-1"></a>      <span class="co"># throw in hey_xxxxxxxxxx to test it works if we include non-existant columns</span></span>
<span id="cb243-31"><a href="meth_eval.html#cb243-31" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">select</span>( <span class="sc">-</span>dplyr<span class="sc">::</span><span class="fu">any_of</span>(<span class="fu">c</span>(</span>
<span id="cb243-32"><a href="meth_eval.html#cb243-32" tabindex="-1"></a>        <span class="st">&quot;hey_xxxxxxxxxx&quot;</span></span>
<span id="cb243-33"><a href="meth_eval.html#cb243-33" tabindex="-1"></a>        , gt_id</span>
<span id="cb243-34"><a href="meth_eval.html#cb243-34" tabindex="-1"></a>      )))</span>
<span id="cb243-35"><a href="meth_eval.html#cb243-35" tabindex="-1"></a>  }</span>
<span id="cb243-36"><a href="meth_eval.html#cb243-36" tabindex="-1"></a>  <span class="co"># rename it if gt_id==pred_id</span></span>
<span id="cb243-37"><a href="meth_eval.html#cb243-37" tabindex="-1"></a>  <span class="cf">if</span>( </span>
<span id="cb243-38"><a href="meth_eval.html#cb243-38" tabindex="-1"></a>    (<span class="fu">names</span>(predictions) <span class="sc">%&gt;%</span> stringr<span class="sc">::</span><span class="fu">str_equal</span>(gt_id) <span class="sc">%&gt;%</span> <span class="fu">any</span>() )</span>
<span id="cb243-39"><a href="meth_eval.html#cb243-39" tabindex="-1"></a>    <span class="sc">&amp;&amp;</span> (gt_id<span class="sc">==</span>pred_id)</span>
<span id="cb243-40"><a href="meth_eval.html#cb243-40" tabindex="-1"></a>  ){</span>
<span id="cb243-41"><a href="meth_eval.html#cb243-41" tabindex="-1"></a>    predictions <span class="ot">&lt;-</span> predictions <span class="sc">%&gt;%</span> </span>
<span id="cb243-42"><a href="meth_eval.html#cb243-42" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">rename_with</span>(</span>
<span id="cb243-43"><a href="meth_eval.html#cb243-43" tabindex="-1"></a>        <span class="at">.cols =</span> dplyr<span class="sc">::</span><span class="fu">all_of</span>(gt_id)</span>
<span id="cb243-44"><a href="meth_eval.html#cb243-44" tabindex="-1"></a>        , <span class="at">.fn =</span> <span class="cf">function</span>(x){<span class="st">&quot;prediction_idxxx&quot;</span>}</span>
<span id="cb243-45"><a href="meth_eval.html#cb243-45" tabindex="-1"></a>      )</span>
<span id="cb243-46"><a href="meth_eval.html#cb243-46" tabindex="-1"></a>    pred_id <span class="ot">&lt;-</span> <span class="st">&quot;prediction_idxxx&quot;</span></span>
<span id="cb243-47"><a href="meth_eval.html#cb243-47" tabindex="-1"></a>  }<span class="cf">else</span> <span class="cf">if</span>( <span class="sc">!</span>(<span class="fu">names</span>(predictions) <span class="sc">%&gt;%</span> stringr<span class="sc">::</span><span class="fu">str_equal</span>(pred_id) <span class="sc">%&gt;%</span> <span class="fu">any</span>()) ){</span>
<span id="cb243-48"><a href="meth_eval.html#cb243-48" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">&quot;predictions  data must contain `pred_id` column&quot;</span>)</span>
<span id="cb243-49"><a href="meth_eval.html#cb243-49" tabindex="-1"></a>  }</span>
<span id="cb243-50"><a href="meth_eval.html#cb243-50" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(</span>
<span id="cb243-51"><a href="meth_eval.html#cb243-51" tabindex="-1"></a>    <span class="at">predictions =</span> predictions</span>
<span id="cb243-52"><a href="meth_eval.html#cb243-52" tabindex="-1"></a>    , <span class="at">pred_id =</span> pred_id</span>
<span id="cb243-53"><a href="meth_eval.html#cb243-53" tabindex="-1"></a>  ))</span>
<span id="cb243-54"><a href="meth_eval.html#cb243-54" tabindex="-1"></a>}</span>
<span id="cb243-55"><a href="meth_eval.html#cb243-55" tabindex="-1"></a><span class="co"># match the instance</span></span>
<span id="cb243-56"><a href="meth_eval.html#cb243-56" tabindex="-1"></a>ground_truth_single_match <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb243-57"><a href="meth_eval.html#cb243-57" tabindex="-1"></a>  gt_inst</span>
<span id="cb243-58"><a href="meth_eval.html#cb243-58" tabindex="-1"></a>  , <span class="at">gt_id =</span> <span class="st">&quot;pile_id&quot;</span></span>
<span id="cb243-59"><a href="meth_eval.html#cb243-59" tabindex="-1"></a>  , predictions</span>
<span id="cb243-60"><a href="meth_eval.html#cb243-60" tabindex="-1"></a>  , <span class="at">pred_id =</span> <span class="st">&quot;pred_pile_id&quot;</span></span>
<span id="cb243-61"><a href="meth_eval.html#cb243-61" tabindex="-1"></a>  , <span class="at">min_iou_pct =</span> <span class="fl">0.5</span></span>
<span id="cb243-62"><a href="meth_eval.html#cb243-62" tabindex="-1"></a>) {</span>
<span id="cb243-63"><a href="meth_eval.html#cb243-63" tabindex="-1"></a>  <span class="co"># check it</span></span>
<span id="cb243-64"><a href="meth_eval.html#cb243-64" tabindex="-1"></a>  check_ans <span class="ot">&lt;-</span> <span class="fu">check_gt_str</span>(</span>
<span id="cb243-65"><a href="meth_eval.html#cb243-65" tabindex="-1"></a>    <span class="at">gt_inst =</span> gt_inst</span>
<span id="cb243-66"><a href="meth_eval.html#cb243-66" tabindex="-1"></a>    , <span class="at">gt_id =</span> gt_id</span>
<span id="cb243-67"><a href="meth_eval.html#cb243-67" tabindex="-1"></a>    , <span class="at">predictions =</span> predictions</span>
<span id="cb243-68"><a href="meth_eval.html#cb243-68" tabindex="-1"></a>    , <span class="at">pred_id =</span> pred_id</span>
<span id="cb243-69"><a href="meth_eval.html#cb243-69" tabindex="-1"></a>  )</span>
<span id="cb243-70"><a href="meth_eval.html#cb243-70" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">nrow</span>(gt_inst)<span class="sc">!=</span><span class="dv">1</span> ){<span class="fu">stop</span>(<span class="st">&quot;ground truth must be spatial `sf` data with a single record&quot;</span>)}</span>
<span id="cb243-71"><a href="meth_eval.html#cb243-71" tabindex="-1"></a>  predictions <span class="ot">&lt;-</span> check_ans<span class="sc">$</span>predictions</span>
<span id="cb243-72"><a href="meth_eval.html#cb243-72" tabindex="-1"></a>  pred_id <span class="ot">&lt;-</span> check_ans<span class="sc">$</span>pred_id</span>
<span id="cb243-73"><a href="meth_eval.html#cb243-73" tabindex="-1"></a>  <span class="co"># intersection</span></span>
<span id="cb243-74"><a href="meth_eval.html#cb243-74" tabindex="-1"></a>    i_temp <span class="ot">&lt;-</span></span>
<span id="cb243-75"><a href="meth_eval.html#cb243-75" tabindex="-1"></a>      sf<span class="sc">::</span><span class="fu">st_intersection</span>(predictions,gt_inst) <span class="sc">%&gt;%</span> </span>
<span id="cb243-76"><a href="meth_eval.html#cb243-76" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">i_area =</span> sf<span class="sc">::</span><span class="fu">st_area</span>(.) <span class="sc">%&gt;%</span> <span class="fu">as.numeric</span>())</span>
<span id="cb243-77"><a href="meth_eval.html#cb243-77" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">nrow</span>(i_temp)<span class="sc">==</span><span class="dv">0</span>){<span class="fu">return</span>(<span class="cn">NULL</span>)}</span>
<span id="cb243-78"><a href="meth_eval.html#cb243-78" tabindex="-1"></a>    </span>
<span id="cb243-79"><a href="meth_eval.html#cb243-79" tabindex="-1"></a>  <span class="co"># union</span></span>
<span id="cb243-80"><a href="meth_eval.html#cb243-80" tabindex="-1"></a>    u_temp <span class="ot">&lt;-</span></span>
<span id="cb243-81"><a href="meth_eval.html#cb243-81" tabindex="-1"></a>      i_temp <span class="sc">%&gt;%</span> </span>
<span id="cb243-82"><a href="meth_eval.html#cb243-82" tabindex="-1"></a>      sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb243-83"><a href="meth_eval.html#cb243-83" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">inner_join</span>(predictions <span class="sc">%&gt;%</span> sf<span class="sc">::</span><span class="fu">st_set_geometry</span>(<span class="st">&quot;geom1&quot;</span>), <span class="at">by =</span> pred_id) <span class="sc">%&gt;%</span> </span>
<span id="cb243-84"><a href="meth_eval.html#cb243-84" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">inner_join</span>(gt_inst <span class="sc">%&gt;%</span> sf<span class="sc">::</span><span class="fu">st_set_geometry</span>(<span class="st">&quot;geom2&quot;</span>) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(dplyr<span class="sc">::</span><span class="fu">all_of</span>(gt_id)), <span class="at">by =</span> gt_id) <span class="sc">%&gt;%</span> </span>
<span id="cb243-85"><a href="meth_eval.html#cb243-85" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">rowwise</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb243-86"><a href="meth_eval.html#cb243-86" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb243-87"><a href="meth_eval.html#cb243-87" tabindex="-1"></a>        <span class="at">u_area =</span> sf<span class="sc">::</span><span class="fu">st_union</span>(geom1, geom2) <span class="sc">%&gt;%</span> sf<span class="sc">::</span><span class="fu">st_area</span>() <span class="sc">%&gt;%</span> <span class="fu">as.numeric</span>()</span>
<span id="cb243-88"><a href="meth_eval.html#cb243-88" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span> </span>
<span id="cb243-89"><a href="meth_eval.html#cb243-89" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb243-90"><a href="meth_eval.html#cb243-90" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(geom1,geom2)) <span class="sc">%&gt;%</span> </span>
<span id="cb243-91"><a href="meth_eval.html#cb243-91" tabindex="-1"></a>      sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb243-92"><a href="meth_eval.html#cb243-92" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb243-93"><a href="meth_eval.html#cb243-93" tabindex="-1"></a>        <span class="at">iou =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb243-94"><a href="meth_eval.html#cb243-94" tabindex="-1"></a>          <span class="fu">is.na</span>(u_area) <span class="sc">|</span> <span class="fu">is.nan</span>(u_area) <span class="sc">~</span> <span class="cn">NA</span></span>
<span id="cb243-95"><a href="meth_eval.html#cb243-95" tabindex="-1"></a>          , T <span class="sc">~</span> dplyr<span class="sc">::</span><span class="fu">coalesce</span>(i_area,<span class="dv">0</span>)<span class="sc">/</span>u_area</span>
<span id="cb243-96"><a href="meth_eval.html#cb243-96" tabindex="-1"></a>        )</span>
<span id="cb243-97"><a href="meth_eval.html#cb243-97" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span> </span>
<span id="cb243-98"><a href="meth_eval.html#cb243-98" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(iou) <span class="sc">&amp;</span> iou<span class="sc">&gt;=</span>min_iou_pct)</span>
<span id="cb243-99"><a href="meth_eval.html#cb243-99" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">nrow</span>(u_temp)<span class="sc">==</span><span class="dv">0</span>){<span class="fu">return</span>(<span class="cn">NULL</span>)}</span>
<span id="cb243-100"><a href="meth_eval.html#cb243-100" tabindex="-1"></a>    </span>
<span id="cb243-101"><a href="meth_eval.html#cb243-101" tabindex="-1"></a>  <span class="co"># return</span></span>
<span id="cb243-102"><a href="meth_eval.html#cb243-102" tabindex="-1"></a>  <span class="fu">return</span>(</span>
<span id="cb243-103"><a href="meth_eval.html#cb243-103" tabindex="-1"></a>    u_temp <span class="sc">%&gt;%</span> </span>
<span id="cb243-104"><a href="meth_eval.html#cb243-104" tabindex="-1"></a>      <span class="co"># pick the highest iou</span></span>
<span id="cb243-105"><a href="meth_eval.html#cb243-105" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">arrange</span>(<span class="fu">desc</span>(iou)) <span class="sc">%&gt;%</span> </span>
<span id="cb243-106"><a href="meth_eval.html#cb243-106" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">slice</span>(<span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb243-107"><a href="meth_eval.html#cb243-107" tabindex="-1"></a>      <span class="co"># column clean</span></span>
<span id="cb243-108"><a href="meth_eval.html#cb243-108" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">select</span>(dplyr<span class="sc">::</span><span class="fu">all_of</span>(</span>
<span id="cb243-109"><a href="meth_eval.html#cb243-109" tabindex="-1"></a>        <span class="fu">c</span>(</span>
<span id="cb243-110"><a href="meth_eval.html#cb243-110" tabindex="-1"></a>          gt_id, <span class="st">&quot;i_area&quot;</span>, <span class="st">&quot;u_area&quot;</span>, <span class="st">&quot;iou&quot;</span></span>
<span id="cb243-111"><a href="meth_eval.html#cb243-111" tabindex="-1"></a>          , base<span class="sc">::</span><span class="fu">setdiff</span>(</span>
<span id="cb243-112"><a href="meth_eval.html#cb243-112" tabindex="-1"></a>            <span class="fu">names</span>(predictions)</span>
<span id="cb243-113"><a href="meth_eval.html#cb243-113" tabindex="-1"></a>            , <span class="fu">c</span>(<span class="st">&quot;geometry&quot;</span>, <span class="st">&quot;geom&quot;</span>, gt_id, <span class="st">&quot;i_area&quot;</span>, <span class="st">&quot;u_area&quot;</span>, <span class="st">&quot;iou&quot;</span>) </span>
<span id="cb243-114"><a href="meth_eval.html#cb243-114" tabindex="-1"></a>          )</span>
<span id="cb243-115"><a href="meth_eval.html#cb243-115" tabindex="-1"></a>        )</span>
<span id="cb243-116"><a href="meth_eval.html#cb243-116" tabindex="-1"></a>      ))</span>
<span id="cb243-117"><a href="meth_eval.html#cb243-117" tabindex="-1"></a>  )</span>
<span id="cb243-118"><a href="meth_eval.html#cb243-118" tabindex="-1"></a>}</span></code></pre></div>
<p>we’ll continue using the same <a href="geom_detect.html#d_area">demonstration area</a> which is outside of the study area at PSINF for this walkthrough</p>
<p>we’ll generate some fake predictions over the demonstration area so that we purposefully get a good mix of FP, TP, and FN “predictions”</p>
<div class="sourceCode" id="cb244"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb244-1"><a href="meth_eval.html#cb244-1" tabindex="-1"></a>predictions_temp <span class="ot">&lt;-</span> </span>
<span id="cb244-2"><a href="meth_eval.html#cb244-2" tabindex="-1"></a>  aoi_slash_piles_polys <span class="sc">%&gt;%</span> </span>
<span id="cb244-3"><a href="meth_eval.html#cb244-3" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">slice_sample</span>(<span class="at">prop =</span> <span class="fl">0.7</span>) <span class="sc">%&gt;%</span></span>
<span id="cb244-4"><a href="meth_eval.html#cb244-4" tabindex="-1"></a>    sf<span class="sc">::</span><span class="fu">st_centroid</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb244-5"><a href="meth_eval.html#cb244-5" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">rand=</span><span class="fu">as.integer</span>(<span class="fu">runif</span>(<span class="at">n=</span>dplyr<span class="sc">::</span><span class="fu">n</span>(), <span class="at">min =</span> <span class="dv">1</span>, <span class="at">max =</span> <span class="dv">3</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb244-6"><a href="meth_eval.html#cb244-6" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(rand,pile_id) <span class="sc">%&gt;%</span> </span>
<span id="cb244-7"><a href="meth_eval.html#cb244-7" tabindex="-1"></a>    sf<span class="sc">::</span><span class="fu">st_set_geometry</span>(<span class="st">&quot;geometry&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb244-8"><a href="meth_eval.html#cb244-8" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb244-9"><a href="meth_eval.html#cb244-9" tabindex="-1"></a>      <span class="at">geometry =</span> sf<span class="sc">::</span><span class="fu">st_buffer</span>(geometry, rand)</span>
<span id="cb244-10"><a href="meth_eval.html#cb244-10" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb244-11"><a href="meth_eval.html#cb244-11" tabindex="-1"></a>    sf<span class="sc">::</span><span class="fu">st_set_geometry</span>(<span class="st">&quot;geometry&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb244-12"><a href="meth_eval.html#cb244-12" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(</span>
<span id="cb244-13"><a href="meth_eval.html#cb244-13" tabindex="-1"></a>      sf<span class="sc">::</span><span class="fu">st_sample</span>(</span>
<span id="cb244-14"><a href="meth_eval.html#cb244-14" tabindex="-1"></a>        sf<span class="sc">::</span><span class="fu">st_difference</span>(</span>
<span id="cb244-15"><a href="meth_eval.html#cb244-15" tabindex="-1"></a>          aoi_boundary</span>
<span id="cb244-16"><a href="meth_eval.html#cb244-16" tabindex="-1"></a>          , sf<span class="sc">::</span><span class="fu">st_union</span>(aoi_slash_piles_polys)</span>
<span id="cb244-17"><a href="meth_eval.html#cb244-17" tabindex="-1"></a>        )</span>
<span id="cb244-18"><a href="meth_eval.html#cb244-18" tabindex="-1"></a>        , <span class="at">size =</span> <span class="dv">33</span></span>
<span id="cb244-19"><a href="meth_eval.html#cb244-19" tabindex="-1"></a>        , <span class="at">type =</span> <span class="st">&quot;random&quot;</span></span>
<span id="cb244-20"><a href="meth_eval.html#cb244-20" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span></span>
<span id="cb244-21"><a href="meth_eval.html#cb244-21" tabindex="-1"></a>      sf<span class="sc">::</span><span class="fu">st_as_sf</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb244-22"><a href="meth_eval.html#cb244-22" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">rand=</span><span class="fu">as.integer</span>(<span class="fu">runif</span>(<span class="at">n=</span>dplyr<span class="sc">::</span><span class="fu">n</span>(), <span class="at">min =</span> <span class="dv">1</span>, <span class="at">max =</span> <span class="dv">3</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb244-23"><a href="meth_eval.html#cb244-23" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">select</span>(rand) <span class="sc">%&gt;%</span> </span>
<span id="cb244-24"><a href="meth_eval.html#cb244-24" tabindex="-1"></a>      sf<span class="sc">::</span><span class="fu">st_set_geometry</span>(<span class="st">&quot;geometry&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb244-25"><a href="meth_eval.html#cb244-25" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb244-26"><a href="meth_eval.html#cb244-26" tabindex="-1"></a>        <span class="at">geometry =</span> sf<span class="sc">::</span><span class="fu">st_buffer</span>(geometry, rand)</span>
<span id="cb244-27"><a href="meth_eval.html#cb244-27" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span> </span>
<span id="cb244-28"><a href="meth_eval.html#cb244-28" tabindex="-1"></a>      sf<span class="sc">::</span><span class="fu">st_set_geometry</span>(<span class="st">&quot;geometry&quot;</span>)</span>
<span id="cb244-29"><a href="meth_eval.html#cb244-29" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb244-30"><a href="meth_eval.html#cb244-30" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">pred_id =</span> dplyr<span class="sc">::</span><span class="fu">row_number</span>() <span class="sc">%&gt;%</span> <span class="fu">as.character</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb244-31"><a href="meth_eval.html#cb244-31" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(pred_id,pile_id) <span class="co"># storing the pile_id so we know which ones might be matches</span></span></code></pre></div>
<p>check out the fake predictions compared to the ground truth pile footprints</p>
<div class="sourceCode" id="cb245"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb245-1"><a href="meth_eval.html#cb245-1" tabindex="-1"></a>ggplot2<span class="sc">::</span><span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb245-2"><a href="meth_eval.html#cb245-2" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_sf</span>(<span class="at">data =</span> aoi_boundary, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">fill =</span> <span class="cn">NA</span>) <span class="sc">+</span> </span>
<span id="cb245-3"><a href="meth_eval.html#cb245-3" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_sf</span>(<span class="at">data =</span> aoi_slash_piles_polys, <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">color =</span> <span class="st">&quot;ground truth&quot;</span>), <span class="at">fill =</span> <span class="cn">NA</span>) <span class="sc">+</span> </span>
<span id="cb245-4"><a href="meth_eval.html#cb245-4" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_sf</span>(<span class="at">data =</span> predictions_temp, <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">color =</span> <span class="st">&quot;fake predictions&quot;</span>), <span class="at">fill =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb245-5"><a href="meth_eval.html#cb245-5" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_color_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="st">&quot;magenta&quot;</span>,<span class="st">&quot;cyan&quot;</span>)) <span class="sc">+</span></span>
<span id="cb245-6"><a href="meth_eval.html#cb245-6" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">color=</span><span class="st">&quot;&quot;</span>) <span class="sc">+</span></span>
<span id="cb245-7"><a href="meth_eval.html#cb245-7" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_void</span>()</span></code></pre></div>
<p><img src="slash_pile_detecting_files/figure-html/unnamed-chunk-290-1.png" alt="" width="1008" /></p>
<p>test for a single ground truth instance</p>
<div class="sourceCode" id="cb246"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb246-1"><a href="meth_eval.html#cb246-1" tabindex="-1"></a><span class="fu">ground_truth_single_match</span>(</span>
<span id="cb246-2"><a href="meth_eval.html#cb246-2" tabindex="-1"></a>  <span class="at">gt_inst =</span> aoi_slash_piles_polys <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(pile_id<span class="sc">==</span>purrr<span class="sc">::</span><span class="fu">discard</span>(predictions_temp<span class="sc">$</span>pile_id, is.na)[<span class="dv">1</span>])</span>
<span id="cb246-3"><a href="meth_eval.html#cb246-3" tabindex="-1"></a>  , <span class="at">gt_id =</span> <span class="st">&quot;pile_id&quot;</span></span>
<span id="cb246-4"><a href="meth_eval.html#cb246-4" tabindex="-1"></a>  , <span class="at">predictions =</span> predictions_temp</span>
<span id="cb246-5"><a href="meth_eval.html#cb246-5" tabindex="-1"></a>  , <span class="at">pred_id =</span> <span class="st">&quot;pred_id&quot;</span></span>
<span id="cb246-6"><a href="meth_eval.html#cb246-6" tabindex="-1"></a>  , <span class="at">min_iou_pct =</span> <span class="fl">0.01</span></span>
<span id="cb246-7"><a href="meth_eval.html#cb246-7" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## # A tibble: 1 × 5
##   pile_id i_area u_area   iou pred_id
##     &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;  
## 1      11   3.14   20.2 0.156 1</code></pre>
<p>now we need to make a function that matches the instances iteratively allowing for only a single match from the predictions (i.e. one prediction can only go to one ground truth instance), and returns all instances labeled as true positive (correctly matched with a prediction), commission (predictions which do not match a ground truth instance; false positive), or omission (ground truth instances for which no predictions match; false negative)</p>
<div class="sourceCode" id="cb248"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb248-1"><a href="meth_eval.html#cb248-1" tabindex="-1"></a>ground_truth_prediction_match <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb248-2"><a href="meth_eval.html#cb248-2" tabindex="-1"></a>  <span class="co"># ground_truth should be sorted already</span></span>
<span id="cb248-3"><a href="meth_eval.html#cb248-3" tabindex="-1"></a>  ground_truth</span>
<span id="cb248-4"><a href="meth_eval.html#cb248-4" tabindex="-1"></a>  , <span class="at">gt_id =</span> <span class="st">&quot;pile_id&quot;</span></span>
<span id="cb248-5"><a href="meth_eval.html#cb248-5" tabindex="-1"></a>  <span class="co"># predictions just needs treeID</span></span>
<span id="cb248-6"><a href="meth_eval.html#cb248-6" tabindex="-1"></a>  , predictions</span>
<span id="cb248-7"><a href="meth_eval.html#cb248-7" tabindex="-1"></a>  , <span class="at">pred_id =</span> <span class="st">&quot;pred_pile_id&quot;</span></span>
<span id="cb248-8"><a href="meth_eval.html#cb248-8" tabindex="-1"></a>  , <span class="at">min_iou_pct =</span> <span class="fl">0.5</span></span>
<span id="cb248-9"><a href="meth_eval.html#cb248-9" tabindex="-1"></a>) {</span>
<span id="cb248-10"><a href="meth_eval.html#cb248-10" tabindex="-1"></a>  <span class="co"># check it</span></span>
<span id="cb248-11"><a href="meth_eval.html#cb248-11" tabindex="-1"></a>  check_ans <span class="ot">&lt;-</span> <span class="fu">check_gt_str</span>(</span>
<span id="cb248-12"><a href="meth_eval.html#cb248-12" tabindex="-1"></a>    <span class="at">gt_inst =</span> ground_truth</span>
<span id="cb248-13"><a href="meth_eval.html#cb248-13" tabindex="-1"></a>    , <span class="at">gt_id =</span> gt_id</span>
<span id="cb248-14"><a href="meth_eval.html#cb248-14" tabindex="-1"></a>    , <span class="at">predictions =</span> predictions</span>
<span id="cb248-15"><a href="meth_eval.html#cb248-15" tabindex="-1"></a>    , <span class="at">pred_id =</span> pred_id</span>
<span id="cb248-16"><a href="meth_eval.html#cb248-16" tabindex="-1"></a>  )</span>
<span id="cb248-17"><a href="meth_eval.html#cb248-17" tabindex="-1"></a>  predictions <span class="ot">&lt;-</span> check_ans<span class="sc">$</span>predictions</span>
<span id="cb248-18"><a href="meth_eval.html#cb248-18" tabindex="-1"></a>  pred_id <span class="ot">&lt;-</span> check_ans<span class="sc">$</span>pred_id</span>
<span id="cb248-19"><a href="meth_eval.html#cb248-19" tabindex="-1"></a>  <span class="co"># set up a blank data frame</span></span>
<span id="cb248-20"><a href="meth_eval.html#cb248-20" tabindex="-1"></a>  return_df <span class="ot">&lt;-</span></span>
<span id="cb248-21"><a href="meth_eval.html#cb248-21" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">tibble</span>(</span>
<span id="cb248-22"><a href="meth_eval.html#cb248-22" tabindex="-1"></a>      <span class="at">i_area =</span> <span class="fu">as.numeric</span>(<span class="cn">NA</span>)</span>
<span id="cb248-23"><a href="meth_eval.html#cb248-23" tabindex="-1"></a>      , <span class="at">u_area =</span> <span class="fu">as.numeric</span>(<span class="cn">NA</span>)</span>
<span id="cb248-24"><a href="meth_eval.html#cb248-24" tabindex="-1"></a>      , <span class="at">iou =</span> <span class="fu">as.numeric</span>(<span class="cn">NA</span>)</span>
<span id="cb248-25"><a href="meth_eval.html#cb248-25" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb248-26"><a href="meth_eval.html#cb248-26" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">bind_cols</span>(</span>
<span id="cb248-27"><a href="meth_eval.html#cb248-27" tabindex="-1"></a>      ground_truth <span class="sc">%&gt;%</span> </span>
<span id="cb248-28"><a href="meth_eval.html#cb248-28" tabindex="-1"></a>        sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb248-29"><a href="meth_eval.html#cb248-29" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">select</span>(dplyr<span class="sc">::</span><span class="fu">all_of</span>(gt_id)) <span class="sc">%&gt;%</span> </span>
<span id="cb248-30"><a href="meth_eval.html#cb248-30" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">slice</span>(<span class="dv">0</span>)</span>
<span id="cb248-31"><a href="meth_eval.html#cb248-31" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb248-32"><a href="meth_eval.html#cb248-32" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">bind_cols</span>(</span>
<span id="cb248-33"><a href="meth_eval.html#cb248-33" tabindex="-1"></a>      predictions <span class="sc">%&gt;%</span> </span>
<span id="cb248-34"><a href="meth_eval.html#cb248-34" tabindex="-1"></a>        sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb248-35"><a href="meth_eval.html#cb248-35" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">select</span>(dplyr<span class="sc">::</span><span class="fu">all_of</span>(pred_id)) <span class="sc">%&gt;%</span> </span>
<span id="cb248-36"><a href="meth_eval.html#cb248-36" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">slice</span>(<span class="dv">0</span>)</span>
<span id="cb248-37"><a href="meth_eval.html#cb248-37" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb248-38"><a href="meth_eval.html#cb248-38" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">relocate</span>(tidyselect<span class="sc">::</span><span class="fu">starts_with</span>(gt_id))</span>
<span id="cb248-39"><a href="meth_eval.html#cb248-39" tabindex="-1"></a>  </span>
<span id="cb248-40"><a href="meth_eval.html#cb248-40" tabindex="-1"></a>  <span class="co"># save names to select</span></span>
<span id="cb248-41"><a href="meth_eval.html#cb248-41" tabindex="-1"></a>  nms_temp <span class="ot">&lt;-</span> <span class="fu">names</span>(return_df)</span>
<span id="cb248-42"><a href="meth_eval.html#cb248-42" tabindex="-1"></a>  </span>
<span id="cb248-43"><a href="meth_eval.html#cb248-43" tabindex="-1"></a>  <span class="co"># start with tallest tree and match to get true positives</span></span>
<span id="cb248-44"><a href="meth_eval.html#cb248-44" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(ground_truth)) {</span>
<span id="cb248-45"><a href="meth_eval.html#cb248-45" tabindex="-1"></a>      match_temp <span class="ot">&lt;-</span> <span class="fu">ground_truth_single_match</span>(</span>
<span id="cb248-46"><a href="meth_eval.html#cb248-46" tabindex="-1"></a>        <span class="at">gt_inst =</span> ground_truth <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">slice</span>(i)</span>
<span id="cb248-47"><a href="meth_eval.html#cb248-47" tabindex="-1"></a>        , <span class="at">gt_id =</span> gt_id</span>
<span id="cb248-48"><a href="meth_eval.html#cb248-48" tabindex="-1"></a>        , <span class="at">predictions =</span> predictions <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(dplyr<span class="sc">::</span><span class="fu">all_of</span>(pred_id)) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">anti_join</span>(return_df,<span class="at">by=</span>pred_id)</span>
<span id="cb248-49"><a href="meth_eval.html#cb248-49" tabindex="-1"></a>        , <span class="at">pred_id =</span> pred_id</span>
<span id="cb248-50"><a href="meth_eval.html#cb248-50" tabindex="-1"></a>        , <span class="at">min_iou_pct =</span> min_iou_pct</span>
<span id="cb248-51"><a href="meth_eval.html#cb248-51" tabindex="-1"></a>      )</span>
<span id="cb248-52"><a href="meth_eval.html#cb248-52" tabindex="-1"></a>      <span class="co"># add to return</span></span>
<span id="cb248-53"><a href="meth_eval.html#cb248-53" tabindex="-1"></a>      <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.null</span>(match_temp)){</span>
<span id="cb248-54"><a href="meth_eval.html#cb248-54" tabindex="-1"></a>        return_df <span class="ot">&lt;-</span> return_df <span class="sc">%&gt;%</span> </span>
<span id="cb248-55"><a href="meth_eval.html#cb248-55" tabindex="-1"></a>          dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(match_temp <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(nms_temp))</span>
<span id="cb248-56"><a href="meth_eval.html#cb248-56" tabindex="-1"></a>      }</span>
<span id="cb248-57"><a href="meth_eval.html#cb248-57" tabindex="-1"></a>      match_temp <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb248-58"><a href="meth_eval.html#cb248-58" tabindex="-1"></a>    }</span>
<span id="cb248-59"><a href="meth_eval.html#cb248-59" tabindex="-1"></a>  <span class="co"># label tps</span></span>
<span id="cb248-60"><a href="meth_eval.html#cb248-60" tabindex="-1"></a>  return_df <span class="ot">&lt;-</span> return_df <span class="sc">%&gt;%</span> </span>
<span id="cb248-61"><a href="meth_eval.html#cb248-61" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">match_grp =</span> <span class="st">&quot;true positive&quot;</span>)</span>
<span id="cb248-62"><a href="meth_eval.html#cb248-62" tabindex="-1"></a>  <span class="co"># add omissions</span></span>
<span id="cb248-63"><a href="meth_eval.html#cb248-63" tabindex="-1"></a>  return_df <span class="ot">&lt;-</span></span>
<span id="cb248-64"><a href="meth_eval.html#cb248-64" tabindex="-1"></a>    return_df <span class="sc">%&gt;%</span> </span>
<span id="cb248-65"><a href="meth_eval.html#cb248-65" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(</span>
<span id="cb248-66"><a href="meth_eval.html#cb248-66" tabindex="-1"></a>      ground_truth <span class="sc">%&gt;%</span> </span>
<span id="cb248-67"><a href="meth_eval.html#cb248-67" tabindex="-1"></a>        sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb248-68"><a href="meth_eval.html#cb248-68" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">anti_join</span>(return_df,<span class="at">by=</span>gt_id) <span class="sc">%&gt;%</span> </span>
<span id="cb248-69"><a href="meth_eval.html#cb248-69" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">select</span>(dplyr<span class="sc">::</span><span class="fu">all_of</span>(gt_id)) <span class="sc">%&gt;%</span> </span>
<span id="cb248-70"><a href="meth_eval.html#cb248-70" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">match_grp =</span> <span class="st">&quot;omission&quot;</span>)</span>
<span id="cb248-71"><a href="meth_eval.html#cb248-71" tabindex="-1"></a>    )</span>
<span id="cb248-72"><a href="meth_eval.html#cb248-72" tabindex="-1"></a>  <span class="co"># add commissions</span></span>
<span id="cb248-73"><a href="meth_eval.html#cb248-73" tabindex="-1"></a>  return_df <span class="ot">&lt;-</span></span>
<span id="cb248-74"><a href="meth_eval.html#cb248-74" tabindex="-1"></a>    return_df <span class="sc">%&gt;%</span> </span>
<span id="cb248-75"><a href="meth_eval.html#cb248-75" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(</span>
<span id="cb248-76"><a href="meth_eval.html#cb248-76" tabindex="-1"></a>      predictions <span class="sc">%&gt;%</span> </span>
<span id="cb248-77"><a href="meth_eval.html#cb248-77" tabindex="-1"></a>        sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb248-78"><a href="meth_eval.html#cb248-78" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">anti_join</span>(return_df,<span class="at">by=</span>pred_id) <span class="sc">%&gt;%</span> </span>
<span id="cb248-79"><a href="meth_eval.html#cb248-79" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">select</span>(dplyr<span class="sc">::</span><span class="fu">all_of</span>(pred_id)) <span class="sc">%&gt;%</span> </span>
<span id="cb248-80"><a href="meth_eval.html#cb248-80" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">match_grp =</span> <span class="st">&quot;commission&quot;</span>)</span>
<span id="cb248-81"><a href="meth_eval.html#cb248-81" tabindex="-1"></a>    )</span>
<span id="cb248-82"><a href="meth_eval.html#cb248-82" tabindex="-1"></a>  <span class="co"># make match_grp factor</span></span>
<span id="cb248-83"><a href="meth_eval.html#cb248-83" tabindex="-1"></a>  return_df <span class="ot">&lt;-</span> return_df <span class="sc">%&gt;%</span> </span>
<span id="cb248-84"><a href="meth_eval.html#cb248-84" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb248-85"><a href="meth_eval.html#cb248-85" tabindex="-1"></a>      <span class="at">match_grp =</span> <span class="fu">factor</span>(</span>
<span id="cb248-86"><a href="meth_eval.html#cb248-86" tabindex="-1"></a>        match_grp</span>
<span id="cb248-87"><a href="meth_eval.html#cb248-87" tabindex="-1"></a>        , <span class="at">ordered =</span> T</span>
<span id="cb248-88"><a href="meth_eval.html#cb248-88" tabindex="-1"></a>        , <span class="at">levels =</span> <span class="fu">c</span>(</span>
<span id="cb248-89"><a href="meth_eval.html#cb248-89" tabindex="-1"></a>          <span class="st">&quot;true positive&quot;</span></span>
<span id="cb248-90"><a href="meth_eval.html#cb248-90" tabindex="-1"></a>          , <span class="st">&quot;commission&quot;</span></span>
<span id="cb248-91"><a href="meth_eval.html#cb248-91" tabindex="-1"></a>          , <span class="st">&quot;omission&quot;</span></span>
<span id="cb248-92"><a href="meth_eval.html#cb248-92" tabindex="-1"></a>        )</span>
<span id="cb248-93"><a href="meth_eval.html#cb248-93" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span> forcats<span class="sc">::</span><span class="fu">fct_rev</span>()</span>
<span id="cb248-94"><a href="meth_eval.html#cb248-94" tabindex="-1"></a>    )</span>
<span id="cb248-95"><a href="meth_eval.html#cb248-95" tabindex="-1"></a>  </span>
<span id="cb248-96"><a href="meth_eval.html#cb248-96" tabindex="-1"></a>  <span class="co"># return</span></span>
<span id="cb248-97"><a href="meth_eval.html#cb248-97" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">nrow</span>(return_df)<span class="sc">==</span><span class="dv">0</span>){</span>
<span id="cb248-98"><a href="meth_eval.html#cb248-98" tabindex="-1"></a>    <span class="fu">warning</span>(<span class="st">&quot;no records found for ground truth to predition matching&quot;</span>)</span>
<span id="cb248-99"><a href="meth_eval.html#cb248-99" tabindex="-1"></a>    <span class="fu">return</span>(<span class="cn">NULL</span>)</span>
<span id="cb248-100"><a href="meth_eval.html#cb248-100" tabindex="-1"></a>  }<span class="cf">else</span>{</span>
<span id="cb248-101"><a href="meth_eval.html#cb248-101" tabindex="-1"></a>    <span class="fu">return</span>(return_df)</span>
<span id="cb248-102"><a href="meth_eval.html#cb248-102" tabindex="-1"></a>  }</span>
<span id="cb248-103"><a href="meth_eval.html#cb248-103" tabindex="-1"></a>  </span>
<span id="cb248-104"><a href="meth_eval.html#cb248-104" tabindex="-1"></a>}</span></code></pre></div>
<p>let’s see how we did given the full list of fake predictions and ground truth data using an IoU proportion of 30%</p>
<div class="sourceCode" id="cb249"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb249-1"><a href="meth_eval.html#cb249-1" tabindex="-1"></a>ground_truth_prediction_match_ans <span class="ot">&lt;-</span> <span class="fu">ground_truth_prediction_match</span>(</span>
<span id="cb249-2"><a href="meth_eval.html#cb249-2" tabindex="-1"></a>  <span class="at">ground_truth =</span> aoi_slash_piles_polys <span class="sc">%&gt;%</span> </span>
<span id="cb249-3"><a href="meth_eval.html#cb249-3" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">arrange</span>(<span class="fu">desc</span>(field_diameter_m)) <span class="co"># this is so the algorithm starts with the largest</span></span>
<span id="cb249-4"><a href="meth_eval.html#cb249-4" tabindex="-1"></a>  , <span class="at">gt_id =</span> <span class="st">&quot;pile_id&quot;</span></span>
<span id="cb249-5"><a href="meth_eval.html#cb249-5" tabindex="-1"></a>  , <span class="at">predictions =</span> predictions_temp</span>
<span id="cb249-6"><a href="meth_eval.html#cb249-6" tabindex="-1"></a>  , <span class="at">pred_id =</span> <span class="st">&quot;pred_id&quot;</span></span>
<span id="cb249-7"><a href="meth_eval.html#cb249-7" tabindex="-1"></a>  , <span class="at">min_iou_pct =</span> <span class="fl">0.3</span></span>
<span id="cb249-8"><a href="meth_eval.html#cb249-8" tabindex="-1"></a>)</span>
<span id="cb249-9"><a href="meth_eval.html#cb249-9" tabindex="-1"></a><span class="co"># huh?</span></span>
<span id="cb249-10"><a href="meth_eval.html#cb249-10" tabindex="-1"></a>ground_truth_prediction_match_ans <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">glimpse</span>()</span></code></pre></div>
<pre><code>## Rows: 53
## Columns: 6
## $ pile_id   &lt;dbl&gt; 5, 13, 17, 19, 21, 22, 23, 24, 29, 53, 3, 4, 6, 11, 20, 56, …
## $ i_area    &lt;dbl&gt; 12.560629, 3.140157, 6.149464, 3.140157, 3.140157, 5.215906,…
## $ u_area    &lt;dbl&gt; 22.928349, 5.968836, 12.560629, 5.942413, 6.758426, 12.56062…
## $ iou       &lt;dbl&gt; 0.5478209, 0.5260920, 0.4895825, 0.5284313, 0.4646285, 0.415…
## $ pred_id   &lt;chr&gt; &quot;5&quot;, &quot;2&quot;, &quot;4&quot;, &quot;11&quot;, &quot;12&quot;, &quot;6&quot;, &quot;8&quot;, &quot;10&quot;, &quot;9&quot;, &quot;3&quot;, NA, NA,…
## $ match_grp &lt;ord&gt; true positive, true positive, true positive, true positive, …</code></pre>
<p>how did our predictions do for this test example?</p>
<div class="sourceCode" id="cb251"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb251-1"><a href="meth_eval.html#cb251-1" tabindex="-1"></a><span class="co"># what did we get?</span></span>
<span id="cb251-2"><a href="meth_eval.html#cb251-2" tabindex="-1"></a>ground_truth_prediction_match_ans <span class="sc">%&gt;%</span> </span>
<span id="cb251-3"><a href="meth_eval.html#cb251-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">count</span>(match_grp) <span class="sc">%&gt;%</span> </span>
<span id="cb251-4"><a href="meth_eval.html#cb251-4" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">pct =</span> (n<span class="sc">/</span><span class="fu">sum</span>(n)) <span class="sc">%&gt;%</span> scales<span class="sc">::</span><span class="fu">percent</span>(<span class="at">accuracy=</span><span class="fl">0.1</span>))</span></code></pre></div>
<pre><code>## # A tibble: 3 × 3
##   match_grp         n pct  
##   &lt;ord&gt;         &lt;int&gt; &lt;chr&gt;
## 1 omission          8 15.1%
## 2 commission       35 66.0%
## 3 true positive    10 18.9%</code></pre>
<p>let’s quickly look at the IoU values on the true positives</p>
<div class="sourceCode" id="cb253"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb253-1"><a href="meth_eval.html#cb253-1" tabindex="-1"></a>ground_truth_prediction_match_ans <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(iou) <span class="sc">%&gt;%</span> <span class="fu">summary</span>()</span></code></pre></div>
<pre><code>##       iou        
##  Min.   :0.4153  
##  1st Qu.:0.4588  
##  Median :0.4936  
##  Mean   :0.5021  
##  3rd Qu.:0.5279  
##  Max.   :0.6619  
##  NA&#39;s   :43</code></pre>
<p>here is the distribution of IoU for the TP matches</p>
<div class="sourceCode" id="cb255"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb255-1"><a href="meth_eval.html#cb255-1" tabindex="-1"></a><span class="co"># palette</span></span>
<span id="cb255-2"><a href="meth_eval.html#cb255-2" tabindex="-1"></a>pal_match_grp <span class="ot">=</span> <span class="fu">c</span>(</span>
<span id="cb255-3"><a href="meth_eval.html#cb255-3" tabindex="-1"></a>  <span class="st">&quot;omission&quot;</span><span class="ot">=</span>viridis<span class="sc">::</span><span class="fu">cividis</span>(<span class="dv">3</span>)[<span class="dv">1</span>]</span>
<span id="cb255-4"><a href="meth_eval.html#cb255-4" tabindex="-1"></a>  , <span class="st">&quot;commission&quot;</span><span class="ot">=</span> viridis<span class="sc">::</span><span class="fu">cividis</span>(<span class="dv">3</span>)[<span class="dv">2</span>]</span>
<span id="cb255-5"><a href="meth_eval.html#cb255-5" tabindex="-1"></a>  , <span class="st">&quot;true positive&quot;</span><span class="ot">=</span>viridis<span class="sc">::</span><span class="fu">cividis</span>(<span class="dv">3</span>)[<span class="dv">3</span>]</span>
<span id="cb255-6"><a href="meth_eval.html#cb255-6" tabindex="-1"></a>)</span>
<span id="cb255-7"><a href="meth_eval.html#cb255-7" tabindex="-1"></a><span class="co"># plot</span></span>
<span id="cb255-8"><a href="meth_eval.html#cb255-8" tabindex="-1"></a>ground_truth_prediction_match_ans <span class="sc">%&gt;%</span> </span>
<span id="cb255-9"><a href="meth_eval.html#cb255-9" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(match_grp<span class="sc">==</span><span class="st">&quot;true positive&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb255-10"><a href="meth_eval.html#cb255-10" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> iou, <span class="at">color =</span> match_grp, <span class="at">fill =</span> match_grp)) <span class="sc">+</span></span>
<span id="cb255-11"><a href="meth_eval.html#cb255-11" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_density</span>(<span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">y=</span>ggplot2<span class="sc">::</span><span class="fu">after_stat</span>(scaled)), <span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb255-12"><a href="meth_eval.html#cb255-12" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_color_manual</span>(<span class="at">values=</span>pal_match_grp) <span class="sc">+</span></span>
<span id="cb255-13"><a href="meth_eval.html#cb255-13" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_fill_manual</span>(<span class="at">values=</span>pal_match_grp) <span class="sc">+</span></span>
<span id="cb255-14"><a href="meth_eval.html#cb255-14" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>,<span class="at">breaks=</span><span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb255-15"><a href="meth_eval.html#cb255-15" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_x_continuous</span>(<span class="at">labels=</span>scales<span class="sc">::</span>percent) <span class="sc">+</span></span>
<span id="cb255-16"><a href="meth_eval.html#cb255-16" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb255-17"><a href="meth_eval.html#cb255-17" tabindex="-1"></a>    <span class="at">color=</span><span class="st">&quot;&quot;</span>,<span class="at">fill=</span><span class="st">&quot;&quot;</span>,<span class="at">x=</span><span class="st">&quot;IoU of correct precitions&quot;</span></span>
<span id="cb255-18"><a href="meth_eval.html#cb255-18" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb255-19"><a href="meth_eval.html#cb255-19" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb255-20"><a href="meth_eval.html#cb255-20" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb255-21"><a href="meth_eval.html#cb255-21" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb255-22"><a href="meth_eval.html#cb255-22" tabindex="-1"></a>    , <span class="at">strip.text =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">9</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>)</span>
<span id="cb255-23"><a href="meth_eval.html#cb255-23" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="slash_pile_detecting_files/figure-html/unnamed-chunk-296-1.png" alt="" width="1008" /></p>
<p>let’s look at the results spatially noting that just because a prediction overlaps with a ground truth pile does not mean that it meets the IoU threshold for determining a positive match. in these cases where the IoU was insufficient, a commission (FP) will overlap with an omission (FN).</p>
<div class="sourceCode" id="cb256"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb256-1"><a href="meth_eval.html#cb256-1" tabindex="-1"></a><span class="co"># plot it</span></span>
<span id="cb256-2"><a href="meth_eval.html#cb256-2" tabindex="-1"></a>ggplot2<span class="sc">::</span><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb256-3"><a href="meth_eval.html#cb256-3" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_sf</span>(<span class="at">data =</span> aoi_boundary, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">fill =</span> <span class="cn">NA</span>) <span class="sc">+</span> </span>
<span id="cb256-4"><a href="meth_eval.html#cb256-4" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_sf</span>(</span>
<span id="cb256-5"><a href="meth_eval.html#cb256-5" tabindex="-1"></a>    <span class="at">data =</span> </span>
<span id="cb256-6"><a href="meth_eval.html#cb256-6" tabindex="-1"></a>      aoi_slash_piles_polys <span class="sc">%&gt;%</span> </span>
<span id="cb256-7"><a href="meth_eval.html#cb256-7" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">left_join</span>(</span>
<span id="cb256-8"><a href="meth_eval.html#cb256-8" tabindex="-1"></a>          ground_truth_prediction_match_ans <span class="sc">%&gt;%</span> </span>
<span id="cb256-9"><a href="meth_eval.html#cb256-9" tabindex="-1"></a>            dplyr<span class="sc">::</span><span class="fu">select</span>(pile_id,match_grp)</span>
<span id="cb256-10"><a href="meth_eval.html#cb256-10" tabindex="-1"></a>          , <span class="at">by =</span> <span class="st">&quot;pile_id&quot;</span></span>
<span id="cb256-11"><a href="meth_eval.html#cb256-11" tabindex="-1"></a>        )</span>
<span id="cb256-12"><a href="meth_eval.html#cb256-12" tabindex="-1"></a>    , <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">fill =</span> match_grp)</span>
<span id="cb256-13"><a href="meth_eval.html#cb256-13" tabindex="-1"></a>    , <span class="at">color =</span> <span class="cn">NA</span> ,<span class="at">alpha=</span><span class="fl">0.7</span></span>
<span id="cb256-14"><a href="meth_eval.html#cb256-14" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb256-15"><a href="meth_eval.html#cb256-15" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_sf</span>(</span>
<span id="cb256-16"><a href="meth_eval.html#cb256-16" tabindex="-1"></a>    <span class="at">data =</span></span>
<span id="cb256-17"><a href="meth_eval.html#cb256-17" tabindex="-1"></a>      predictions_temp <span class="sc">%&gt;%</span></span>
<span id="cb256-18"><a href="meth_eval.html#cb256-18" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">left_join</span>(</span>
<span id="cb256-19"><a href="meth_eval.html#cb256-19" tabindex="-1"></a>          ground_truth_prediction_match_ans <span class="sc">%&gt;%</span></span>
<span id="cb256-20"><a href="meth_eval.html#cb256-20" tabindex="-1"></a>            dplyr<span class="sc">::</span><span class="fu">select</span>(pred_id,match_grp)</span>
<span id="cb256-21"><a href="meth_eval.html#cb256-21" tabindex="-1"></a>          , <span class="at">by =</span> <span class="st">&quot;pred_id&quot;</span></span>
<span id="cb256-22"><a href="meth_eval.html#cb256-22" tabindex="-1"></a>        )</span>
<span id="cb256-23"><a href="meth_eval.html#cb256-23" tabindex="-1"></a>    , <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">fill =</span> match_grp, <span class="at">color =</span> match_grp)</span>
<span id="cb256-24"><a href="meth_eval.html#cb256-24" tabindex="-1"></a>    , <span class="at">alpha =</span> <span class="dv">0</span></span>
<span id="cb256-25"><a href="meth_eval.html#cb256-25" tabindex="-1"></a>    , <span class="at">lwd =</span> <span class="fl">1.1</span></span>
<span id="cb256-26"><a href="meth_eval.html#cb256-26" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb256-27"><a href="meth_eval.html#cb256-27" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_fill_manual</span>(<span class="at">values =</span> pal_match_grp, <span class="at">name =</span> <span class="st">&quot;&quot;</span>) <span class="sc">+</span></span>
<span id="cb256-28"><a href="meth_eval.html#cb256-28" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_color_manual</span>(<span class="at">values =</span> pal_match_grp, <span class="at">name =</span> <span class="st">&quot;&quot;</span>) <span class="sc">+</span></span>
<span id="cb256-29"><a href="meth_eval.html#cb256-29" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb256-30"><a href="meth_eval.html#cb256-30" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">guides</span>(</span>
<span id="cb256-31"><a href="meth_eval.html#cb256-31" tabindex="-1"></a>    <span class="at">fill =</span> ggplot2<span class="sc">::</span><span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">color =</span> <span class="fu">c</span>(<span class="cn">NA</span>,<span class="cn">NA</span>,pal_match_grp[<span class="st">&quot;commission&quot;</span>])))</span>
<span id="cb256-32"><a href="meth_eval.html#cb256-32" tabindex="-1"></a>    , <span class="at">color =</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb256-33"><a href="meth_eval.html#cb256-33" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="slash_pile_detecting_files/figure-html/unnamed-chunk-297-1.png" alt="" width="1008" /></p>
</div>
<div id="detect_metrics_form" class="section level2 hasAnchor" number="6.2">
<h2><span class="header-section-number">6.2</span> Detection Accuracy Metrics<a href="meth_eval.html#detect_metrics_form" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Detection accuracy metrics are calculated by aggregating raw TP, FP, and FN counts to quantify the method’s ability to find the piles. Aggregation of the instance matching allows us to evaluate omission rate (false negative rate or miss rate), commission rate (false positive rate), precision, recall (detection rate), and the F-score metric. As a reminder, true positive (TP) instances correctly match ground truth instances with a prediction, commission predictions do not match a ground truth instance (false positive; FP), and omissions are ground truth instances for which no predictions match (false negative; FN)</p>
<p><span class="math display">\[\textrm{omission rate} = \frac{FN}{TP+FN}\]</span></p>
<p><span class="math display">\[\textrm{commission rate} = \frac{FP}{TP+FP}\]</span></p>
<p><span class="math display">\[\textrm{precision} = \frac{TP}{TP+FP}\]</span></p>
<p><span class="math display">\[\textrm{recall} = \frac{TP}{TP+FN}\]</span></p>
<p><span class="math display">\[
\textrm{F-score} = 2 \times \frac{\bigl(precision \times recall \bigr)}{\bigl(precision + recall \bigr)}
\]</span></p>
<p>let’s make a function to calculate these detection accuracy metrics based on aggregated TP, FP, and FN counts</p>
<div class="sourceCode" id="cb257"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb257-1"><a href="meth_eval.html#cb257-1" tabindex="-1"></a><span class="co"># first function takes df with cols tp_n, fp_n, and fn_n to calculate rates</span></span>
<span id="cb257-2"><a href="meth_eval.html#cb257-2" tabindex="-1"></a>confusion_matrix_scores_fn <span class="ot">&lt;-</span> <span class="cf">function</span>(df) {</span>
<span id="cb257-3"><a href="meth_eval.html#cb257-3" tabindex="-1"></a>  df <span class="sc">%&gt;%</span> </span>
<span id="cb257-4"><a href="meth_eval.html#cb257-4" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb257-5"><a href="meth_eval.html#cb257-5" tabindex="-1"></a>    <span class="at">omission_rate =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb257-6"><a href="meth_eval.html#cb257-6" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">coalesce</span>(tp_n,<span class="dv">0</span>) <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> dplyr<span class="sc">::</span><span class="fu">coalesce</span>(fn_n,<span class="dv">0</span>) <span class="sc">==</span> <span class="dv">0</span> <span class="sc">~</span> <span class="dv">0</span> <span class="co"># if there are no actual piles, there is nothing to miss</span></span>
<span id="cb257-7"><a href="meth_eval.html#cb257-7" tabindex="-1"></a>      , dplyr<span class="sc">::</span><span class="fu">coalesce</span>(tp_n,<span class="dv">0</span>) <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> dplyr<span class="sc">::</span><span class="fu">coalesce</span>(fn_n,<span class="dv">0</span>) <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="dv">1</span> <span class="co"># every single actual pile was missed</span></span>
<span id="cb257-8"><a href="meth_eval.html#cb257-8" tabindex="-1"></a>      , dplyr<span class="sc">::</span><span class="fu">coalesce</span>(fn_n,<span class="dv">0</span>) <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> dplyr<span class="sc">::</span><span class="fu">coalesce</span>(tp_n,<span class="dv">0</span>) <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="dv">0</span></span>
<span id="cb257-9"><a href="meth_eval.html#cb257-9" tabindex="-1"></a>      , T <span class="sc">~</span> fn_n<span class="sc">/</span>(tp_n<span class="sc">+</span>fn_n)</span>
<span id="cb257-10"><a href="meth_eval.html#cb257-10" tabindex="-1"></a>    ) <span class="co"># False Negative Rate or Miss Rate</span></span>
<span id="cb257-11"><a href="meth_eval.html#cb257-11" tabindex="-1"></a>    , <span class="at">commission_rate =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb257-12"><a href="meth_eval.html#cb257-12" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">coalesce</span>(tp_n,<span class="dv">0</span>) <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> dplyr<span class="sc">::</span><span class="fu">coalesce</span>(fp_n,<span class="dv">0</span>) <span class="sc">==</span> <span class="dv">0</span> <span class="sc">~</span> <span class="dv">0</span> <span class="co"># if no predictions are made, the model could not have made any commission errors</span></span>
<span id="cb257-13"><a href="meth_eval.html#cb257-13" tabindex="-1"></a>      , dplyr<span class="sc">::</span><span class="fu">coalesce</span>(fp_n,<span class="dv">0</span>) <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> dplyr<span class="sc">::</span><span class="fu">coalesce</span>(tp_n,<span class="dv">0</span>) <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="dv">0</span></span>
<span id="cb257-14"><a href="meth_eval.html#cb257-14" tabindex="-1"></a>      , T <span class="sc">~</span> fp_n<span class="sc">/</span>(tp_n<span class="sc">+</span>fp_n)</span>
<span id="cb257-15"><a href="meth_eval.html#cb257-15" tabindex="-1"></a>    ) <span class="co"># False Positive Rate</span></span>
<span id="cb257-16"><a href="meth_eval.html#cb257-16" tabindex="-1"></a>    , <span class="at">precision =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb257-17"><a href="meth_eval.html#cb257-17" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">coalesce</span>(tp_n,<span class="dv">0</span>) <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> dplyr<span class="sc">::</span><span class="fu">coalesce</span>(fp_n,<span class="dv">0</span>) <span class="sc">==</span> <span class="dv">0</span> <span class="sc">~</span> <span class="dv">1</span> <span class="co"># if no predictions are made, the model made zero incorrect positive claims</span></span>
<span id="cb257-18"><a href="meth_eval.html#cb257-18" tabindex="-1"></a>      , dplyr<span class="sc">::</span><span class="fu">coalesce</span>(tp_n,<span class="dv">0</span>) <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> dplyr<span class="sc">::</span><span class="fu">coalesce</span>(fp_n,<span class="dv">0</span>) <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="dv">0</span></span>
<span id="cb257-19"><a href="meth_eval.html#cb257-19" tabindex="-1"></a>      , T <span class="sc">~</span> tp_n<span class="sc">/</span>(tp_n<span class="sc">+</span>fp_n)</span>
<span id="cb257-20"><a href="meth_eval.html#cb257-20" tabindex="-1"></a>    )</span>
<span id="cb257-21"><a href="meth_eval.html#cb257-21" tabindex="-1"></a>    , <span class="at">recall =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb257-22"><a href="meth_eval.html#cb257-22" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">coalesce</span>(tp_n,<span class="dv">0</span>) <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> dplyr<span class="sc">::</span><span class="fu">coalesce</span>(fn_n,<span class="dv">0</span>) <span class="sc">==</span> <span class="dv">0</span> <span class="sc">~</span> <span class="dv">1</span> <span class="co"># if there are no actual piles, there is nothing to miss</span></span>
<span id="cb257-23"><a href="meth_eval.html#cb257-23" tabindex="-1"></a>      , dplyr<span class="sc">::</span><span class="fu">coalesce</span>(tp_n,<span class="dv">0</span>) <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> dplyr<span class="sc">::</span><span class="fu">coalesce</span>(fn_n,<span class="dv">0</span>) <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="dv">0</span> <span class="co"># every single actual pile was missed</span></span>
<span id="cb257-24"><a href="meth_eval.html#cb257-24" tabindex="-1"></a>      , T <span class="sc">~</span> tp_n<span class="sc">/</span>(tp_n<span class="sc">+</span>fn_n)</span>
<span id="cb257-25"><a href="meth_eval.html#cb257-25" tabindex="-1"></a>    )</span>
<span id="cb257-26"><a href="meth_eval.html#cb257-26" tabindex="-1"></a>    , <span class="at">f_score =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb257-27"><a href="meth_eval.html#cb257-27" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">coalesce</span>(precision,<span class="dv">0</span>) <span class="sc">==</span> <span class="dv">0</span> <span class="sc">|</span> dplyr<span class="sc">::</span><span class="fu">coalesce</span>(recall,<span class="dv">0</span>) <span class="sc">==</span> <span class="dv">0</span> <span class="sc">~</span> <span class="dv">0</span></span>
<span id="cb257-28"><a href="meth_eval.html#cb257-28" tabindex="-1"></a>      , T <span class="sc">~</span> <span class="dv">2</span> <span class="sc">*</span> ( (precision<span class="sc">*</span>recall)<span class="sc">/</span>(precision<span class="sc">+</span>recall) )</span>
<span id="cb257-29"><a href="meth_eval.html#cb257-29" tabindex="-1"></a>    )    </span>
<span id="cb257-30"><a href="meth_eval.html#cb257-30" tabindex="-1"></a>  ) </span>
<span id="cb257-31"><a href="meth_eval.html#cb257-31" tabindex="-1"></a>}</span></code></pre></div>
<p>test it using our fake predictions</p>
<div class="sourceCode" id="cb258"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb258-1"><a href="meth_eval.html#cb258-1" tabindex="-1"></a>ground_truth_prediction_match_ans <span class="sc">%&gt;%</span> </span>
<span id="cb258-2"><a href="meth_eval.html#cb258-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb258-3"><a href="meth_eval.html#cb258-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">count</span>(match_grp) <span class="sc">%&gt;%</span> </span>
<span id="cb258-4"><a href="meth_eval.html#cb258-4" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb258-5"><a href="meth_eval.html#cb258-5" tabindex="-1"></a>    <span class="at">match_grp =</span> dplyr<span class="sc">::</span><span class="fu">case_match</span>(</span>
<span id="cb258-6"><a href="meth_eval.html#cb258-6" tabindex="-1"></a>      match_grp</span>
<span id="cb258-7"><a href="meth_eval.html#cb258-7" tabindex="-1"></a>      , <span class="st">&quot;true positive&quot;</span><span class="sc">~</span><span class="st">&quot;tp&quot;</span></span>
<span id="cb258-8"><a href="meth_eval.html#cb258-8" tabindex="-1"></a>      , <span class="st">&quot;commission&quot;</span><span class="sc">~</span><span class="st">&quot;fp&quot;</span></span>
<span id="cb258-9"><a href="meth_eval.html#cb258-9" tabindex="-1"></a>      , <span class="st">&quot;omission&quot;</span><span class="sc">~</span><span class="st">&quot;fn&quot;</span></span>
<span id="cb258-10"><a href="meth_eval.html#cb258-10" tabindex="-1"></a>    )</span>
<span id="cb258-11"><a href="meth_eval.html#cb258-11" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb258-12"><a href="meth_eval.html#cb258-12" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_wider</span>(</span>
<span id="cb258-13"><a href="meth_eval.html#cb258-13" tabindex="-1"></a>    <span class="at">names_from =</span> match_grp</span>
<span id="cb258-14"><a href="meth_eval.html#cb258-14" tabindex="-1"></a>    , <span class="at">values_from =</span> <span class="fu">c</span>(n)</span>
<span id="cb258-15"><a href="meth_eval.html#cb258-15" tabindex="-1"></a>    , <span class="at">names_glue =</span> <span class="st">&quot;{match_grp}_{.value}&quot;</span></span>
<span id="cb258-16"><a href="meth_eval.html#cb258-16" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb258-17"><a href="meth_eval.html#cb258-17" tabindex="-1"></a>  <span class="fu">confusion_matrix_scores_fn</span>()  </span></code></pre></div>
<pre><code>## # A tibble: 1 × 8
##    fn_n  fp_n  tp_n omission_rate commission_rate precision recall f_score
##   &lt;int&gt; &lt;int&gt; &lt;int&gt;         &lt;dbl&gt;           &lt;dbl&gt;     &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;
## 1     8    35    10         0.444           0.778     0.222  0.556   0.317</code></pre>
</div>
<div id="quant_metrics_form" class="section level2 hasAnchor" number="6.3">
<h2><span class="header-section-number">6.3</span> Quantification Accuracy Metrics<a href="meth_eval.html#quant_metrics_form" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Quantification accuracy metrics such as RMSE, MAPE, and Mean Error of pile form measurements (e.g. height, diameter) are calculated by aggregating the differences between the estimated pile attributes and the ground truth values for instances classified as True Positives. These metrics tell us about the method’s ability to accurately quantify the form of the piles it successfully identified.</p>
<p>We only have field-collected slash pile height and diameter measurements from a single study site, the PSINF Mixed Conifer Site. Data from this one study site will be used to test the slash pile quantification accuracies acheived by the proposed methodology, while data from all study sites will be used to validate the slash pile detection methodology.</p>
<p>to prepare our results for analysis, we will develop a function that aggregates the pile-level data into a single record for each metric-error measurement combination. this function will calculate detection performance metrics such as F-score, precision, and recall (using the <code>confusion_matrix_scores_fn()</code> we defined above), as well as quantification accuracy metrics including Root Mean Squared Error (RMSE), Mean Error (ME), and Mean Absolute Percentage Error (MAPE) to assess the accuracy of our pile form measurements. this could be a valuable function for any future analysis comparing predictions to ground truth data.</p>
<p>here are the quantification accuracy metric formulas:</p>
<p><span class="math display">\[
\textrm{RMSE} = \sqrt{ \frac{  \sum_{i=1}^{N} (y_{i} - \hat{y_{i}})^{2}}{N}}
\]</span></p>
<p><span class="math display">\[
\textrm{ME} = \frac{  \sum_{i=1}^{N} (\hat{y_{i}} - y_{i})}{N}
\]</span></p>
<p><span class="math display">\[
\textrm{MAPE} = \frac{1}{N} \sum_{i=1}^{N} \left| \frac{y_{i} - \hat{y_{i}}}{y_{i}} \right|
\]</span></p>
<p>Where <span class="math inline">\(N\)</span> is equal to the total number of correctly matched piles, <span class="math inline">\(y_i\)</span> is the ground truth measured value and <span class="math inline">\(\hat{y_i}\)</span> is the predicted value of <span class="math inline">\(i\)</span></p>
<p>we could also calculate Relative RMSE (RRMSE)</p>
<p><span class="math display">\[
\textrm{RRMSE} = \frac{\text{RMSE}}{\bar{y}} \times 100\%
\]</span></p>
<p>where, <span class="math inline">\(\bar{y}\)</span> represents the mean of the ground truth values. the interpretations of RMSE and RRMSE are:</p>
<ul>
<li>RMSE: Measures the average magnitude of the differences between predicted and the actual observed values, expressed in the same units as the metric.</li>
<li>RRMSE: Expresses RMSE as a percentage of the mean of the observed values, providing a scale-independent measure to compare model accuracy across different datasets or models.</li>
</ul>
<p>for this analysis, we’ll show how to calculate RRMSE but we’ll only investigate MAPE</p>
<ul>
<li>Use MAPE when: You need an easily understandable metric for comparing prediction accuracy across different series or models with varying scales, particularly when zeros or near-zero actual values are not present in your data.</li>
<li>Use RRMSE when: You need a metric that is more robust to small or zero actual values and you want to penalize larger errors more heavily due to the squaring of errors in its calculation.</li>
</ul>
<div class="sourceCode" id="cb260"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb260-1"><a href="meth_eval.html#cb260-1" tabindex="-1"></a><span class="co"># aggregate results from ground_truth_prediction_match()</span></span>
<span id="cb260-2"><a href="meth_eval.html#cb260-2" tabindex="-1"></a>agg_ground_truth_match <span class="ot">&lt;-</span> <span class="cf">function</span>(ground_truth_prediction_match_ans) {</span>
<span id="cb260-3"><a href="meth_eval.html#cb260-3" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">nrow</span>(ground_truth_prediction_match_ans)<span class="sc">==</span><span class="dv">0</span>){<span class="fu">return</span>(<span class="cn">NULL</span>)}</span>
<span id="cb260-4"><a href="meth_eval.html#cb260-4" tabindex="-1"></a>  <span class="cf">if</span>( <span class="sc">!</span>(<span class="fu">names</span>(ground_truth_prediction_match_ans) <span class="sc">%&gt;%</span> stringr<span class="sc">::</span><span class="fu">str_equal</span>(<span class="st">&quot;match_grp&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">any</span>()) ){<span class="fu">stop</span>(<span class="st">&quot;ground_truth_prediction_match_ans must contain `match_grp` column&quot;</span>)}</span>
<span id="cb260-5"><a href="meth_eval.html#cb260-5" tabindex="-1"></a>  </span>
<span id="cb260-6"><a href="meth_eval.html#cb260-6" tabindex="-1"></a>  <span class="co"># check for difference columns (contains &quot;_diff&quot;) and calc rmse for only those to return a single line df with colums for each diff_rmse</span></span>
<span id="cb260-7"><a href="meth_eval.html#cb260-7" tabindex="-1"></a>    <span class="cf">if</span>(</span>
<span id="cb260-8"><a href="meth_eval.html#cb260-8" tabindex="-1"></a>      (ground_truth_prediction_match_ans <span class="sc">%&gt;%</span> </span>
<span id="cb260-9"><a href="meth_eval.html#cb260-9" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">select</span>(tidyselect<span class="sc">::</span><span class="fu">starts_with</span>(<span class="st">&quot;diff_&quot;</span>) <span class="sc">|</span> tidyselect<span class="sc">::</span><span class="fu">starts_with</span>(<span class="st">&quot;pct_diff_&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb260-10"><a href="meth_eval.html#cb260-10" tabindex="-1"></a>        <span class="fu">ncol</span>() )<span class="sc">&gt;</span><span class="dv">0</span></span>
<span id="cb260-11"><a href="meth_eval.html#cb260-11" tabindex="-1"></a>    ){</span>
<span id="cb260-12"><a href="meth_eval.html#cb260-12" tabindex="-1"></a>      <span class="co"># get rmse and mean difference/error for all columns with &quot;_diff&quot; but not &quot;pct_diff&quot;</span></span>
<span id="cb260-13"><a href="meth_eval.html#cb260-13" tabindex="-1"></a>      <span class="co"># get mape for all columns with &quot;pct_diff&quot; but not &quot;diff_&quot;</span></span>
<span id="cb260-14"><a href="meth_eval.html#cb260-14" tabindex="-1"></a>      rmse_df <span class="ot">&lt;-</span> ground_truth_prediction_match_ans <span class="sc">%&gt;%</span> </span>
<span id="cb260-15"><a href="meth_eval.html#cb260-15" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb260-16"><a href="meth_eval.html#cb260-16" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb260-17"><a href="meth_eval.html#cb260-17" tabindex="-1"></a>          tidyselect<span class="sc">::</span><span class="fu">starts_with</span>(<span class="st">&quot;diff_&quot;</span>)</span>
<span id="cb260-18"><a href="meth_eval.html#cb260-18" tabindex="-1"></a>          <span class="sc">|</span> tidyselect<span class="sc">::</span><span class="fu">starts_with</span>(<span class="st">&quot;pct_diff_&quot;</span>)</span>
<span id="cb260-19"><a href="meth_eval.html#cb260-19" tabindex="-1"></a>        ) <span class="sc">%&gt;%</span></span>
<span id="cb260-20"><a href="meth_eval.html#cb260-20" tabindex="-1"></a>        tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(dplyr<span class="sc">::</span><span class="fu">everything</span>(), <span class="at">values_drop_na =</span> T) <span class="sc">%&gt;%</span> </span>
<span id="cb260-21"><a href="meth_eval.html#cb260-21" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">group_by</span>(name) <span class="sc">%&gt;%</span> </span>
<span id="cb260-22"><a href="meth_eval.html#cb260-22" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">summarise</span>(</span>
<span id="cb260-23"><a href="meth_eval.html#cb260-23" tabindex="-1"></a>          <span class="at">sq =</span> <span class="fu">sum</span>(value<span class="sc">^</span><span class="dv">2</span>, <span class="at">na.rm =</span> T)</span>
<span id="cb260-24"><a href="meth_eval.html#cb260-24" tabindex="-1"></a>          , <span class="at">mean =</span> <span class="fu">mean</span>(value, <span class="at">na.rm =</span> T)</span>
<span id="cb260-25"><a href="meth_eval.html#cb260-25" tabindex="-1"></a>          , <span class="at">sumabs =</span> <span class="fu">sum</span>(<span class="fu">abs</span>(value), <span class="at">na.rm =</span> T)</span>
<span id="cb260-26"><a href="meth_eval.html#cb260-26" tabindex="-1"></a>          , <span class="at">nomiss =</span> <span class="fu">sum</span>(<span class="sc">!</span><span class="fu">is.na</span>(value))</span>
<span id="cb260-27"><a href="meth_eval.html#cb260-27" tabindex="-1"></a>        ) <span class="sc">%&gt;%</span> </span>
<span id="cb260-28"><a href="meth_eval.html#cb260-28" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb260-29"><a href="meth_eval.html#cb260-29" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb260-30"><a href="meth_eval.html#cb260-30" tabindex="-1"></a>          <span class="at">rmse =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb260-31"><a href="meth_eval.html#cb260-31" tabindex="-1"></a>            dplyr<span class="sc">::</span><span class="fu">coalesce</span>(nomiss,<span class="dv">0</span>)<span class="sc">==</span><span class="dv">0</span> <span class="sc">~</span> <span class="fu">as.numeric</span>(<span class="cn">NA</span>)</span>
<span id="cb260-32"><a href="meth_eval.html#cb260-32" tabindex="-1"></a>            , T <span class="sc">~</span> <span class="fu">sqrt</span>(sq<span class="sc">/</span>nomiss)</span>
<span id="cb260-33"><a href="meth_eval.html#cb260-33" tabindex="-1"></a>          )</span>
<span id="cb260-34"><a href="meth_eval.html#cb260-34" tabindex="-1"></a>          , <span class="at">mape =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb260-35"><a href="meth_eval.html#cb260-35" tabindex="-1"></a>            dplyr<span class="sc">::</span><span class="fu">coalesce</span>(nomiss,<span class="dv">0</span>)<span class="sc">==</span><span class="dv">0</span> <span class="sc">~</span> <span class="fu">as.numeric</span>(<span class="cn">NA</span>)</span>
<span id="cb260-36"><a href="meth_eval.html#cb260-36" tabindex="-1"></a>            , T <span class="sc">~</span> sumabs<span class="sc">/</span>nomiss</span>
<span id="cb260-37"><a href="meth_eval.html#cb260-37" tabindex="-1"></a>          )</span>
<span id="cb260-38"><a href="meth_eval.html#cb260-38" tabindex="-1"></a>        ) <span class="sc">%&gt;%</span> </span>
<span id="cb260-39"><a href="meth_eval.html#cb260-39" tabindex="-1"></a>        <span class="co"># NA nonsense values</span></span>
<span id="cb260-40"><a href="meth_eval.html#cb260-40" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb260-41"><a href="meth_eval.html#cb260-41" tabindex="-1"></a>          <span class="at">mape =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb260-42"><a href="meth_eval.html#cb260-42" tabindex="-1"></a>            stringr<span class="sc">::</span><span class="fu">str_starts</span>(name, <span class="st">&quot;pct_diff_&quot;</span>) <span class="sc">~</span> mape</span>
<span id="cb260-43"><a href="meth_eval.html#cb260-43" tabindex="-1"></a>            , T <span class="sc">~</span> <span class="fu">as.numeric</span>(<span class="cn">NA</span>)</span>
<span id="cb260-44"><a href="meth_eval.html#cb260-44" tabindex="-1"></a>          )</span>
<span id="cb260-45"><a href="meth_eval.html#cb260-45" tabindex="-1"></a>          , <span class="at">rmse =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb260-46"><a href="meth_eval.html#cb260-46" tabindex="-1"></a>            stringr<span class="sc">::</span><span class="fu">str_starts</span>(name, <span class="st">&quot;pct_diff_&quot;</span>) <span class="sc">~</span> <span class="fu">as.numeric</span>(<span class="cn">NA</span>)</span>
<span id="cb260-47"><a href="meth_eval.html#cb260-47" tabindex="-1"></a>            , T <span class="sc">~</span> rmse</span>
<span id="cb260-48"><a href="meth_eval.html#cb260-48" tabindex="-1"></a>          )</span>
<span id="cb260-49"><a href="meth_eval.html#cb260-49" tabindex="-1"></a>          , <span class="at">mean =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb260-50"><a href="meth_eval.html#cb260-50" tabindex="-1"></a>            stringr<span class="sc">::</span><span class="fu">str_starts</span>(name, <span class="st">&quot;pct_diff_&quot;</span>) <span class="sc">~</span> <span class="fu">as.numeric</span>(<span class="cn">NA</span>)</span>
<span id="cb260-51"><a href="meth_eval.html#cb260-51" tabindex="-1"></a>            , T <span class="sc">~</span> mean</span>
<span id="cb260-52"><a href="meth_eval.html#cb260-52" tabindex="-1"></a>          )</span>
<span id="cb260-53"><a href="meth_eval.html#cb260-53" tabindex="-1"></a>        ) <span class="sc">%&gt;%</span> </span>
<span id="cb260-54"><a href="meth_eval.html#cb260-54" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">select</span>(name,rmse,mean,mape) <span class="sc">%&gt;%</span> </span>
<span id="cb260-55"><a href="meth_eval.html#cb260-55" tabindex="-1"></a>        tidyr<span class="sc">::</span><span class="fu">pivot_wider</span>(</span>
<span id="cb260-56"><a href="meth_eval.html#cb260-56" tabindex="-1"></a>          <span class="at">names_from =</span> name</span>
<span id="cb260-57"><a href="meth_eval.html#cb260-57" tabindex="-1"></a>          , <span class="at">values_from =</span> <span class="fu">c</span>(rmse,mean,mape)</span>
<span id="cb260-58"><a href="meth_eval.html#cb260-58" tabindex="-1"></a>          , <span class="at">names_glue =</span> <span class="st">&quot;{name}_{.value}&quot;</span></span>
<span id="cb260-59"><a href="meth_eval.html#cb260-59" tabindex="-1"></a>        ) <span class="sc">%&gt;%</span> </span>
<span id="cb260-60"><a href="meth_eval.html#cb260-60" tabindex="-1"></a>        <span class="co"># remove columns with NA in all rows</span></span>
<span id="cb260-61"><a href="meth_eval.html#cb260-61" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">select</span>( dplyr<span class="sc">::</span><span class="fu">where</span>( <span class="sc">~!</span><span class="fu">all</span>(<span class="fu">is.na</span>(.x)) ) )</span>
<span id="cb260-62"><a href="meth_eval.html#cb260-62" tabindex="-1"></a>      </span>
<span id="cb260-63"><a href="meth_eval.html#cb260-63" tabindex="-1"></a>      <span class="cf">if</span>(</span>
<span id="cb260-64"><a href="meth_eval.html#cb260-64" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">coalesce</span>(<span class="fu">nrow</span>(rmse_df),<span class="dv">0</span>)<span class="sc">==</span><span class="dv">0</span></span>
<span id="cb260-65"><a href="meth_eval.html#cb260-65" tabindex="-1"></a>        <span class="sc">||</span> dplyr<span class="sc">::</span><span class="fu">coalesce</span>(<span class="fu">ncol</span>(rmse_df),<span class="dv">0</span>)<span class="sc">==</span><span class="dv">0</span></span>
<span id="cb260-66"><a href="meth_eval.html#cb260-66" tabindex="-1"></a>      ){</span>
<span id="cb260-67"><a href="meth_eval.html#cb260-67" tabindex="-1"></a>        <span class="co"># empty df</span></span>
<span id="cb260-68"><a href="meth_eval.html#cb260-68" tabindex="-1"></a>        rmse_df <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">tibble</span>()</span>
<span id="cb260-69"><a href="meth_eval.html#cb260-69" tabindex="-1"></a>      }</span>
<span id="cb260-70"><a href="meth_eval.html#cb260-70" tabindex="-1"></a>    }<span class="cf">else</span>{</span>
<span id="cb260-71"><a href="meth_eval.html#cb260-71" tabindex="-1"></a>      <span class="co"># empty df</span></span>
<span id="cb260-72"><a href="meth_eval.html#cb260-72" tabindex="-1"></a>      rmse_df <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">tibble</span>()</span>
<span id="cb260-73"><a href="meth_eval.html#cb260-73" tabindex="-1"></a>    }</span>
<span id="cb260-74"><a href="meth_eval.html#cb260-74" tabindex="-1"></a>  </span>
<span id="cb260-75"><a href="meth_eval.html#cb260-75" tabindex="-1"></a>  <span class="co"># count by match group</span></span>
<span id="cb260-76"><a href="meth_eval.html#cb260-76" tabindex="-1"></a>    agg <span class="ot">&lt;-</span></span>
<span id="cb260-77"><a href="meth_eval.html#cb260-77" tabindex="-1"></a>      ground_truth_prediction_match_ans <span class="sc">%&gt;%</span> </span>
<span id="cb260-78"><a href="meth_eval.html#cb260-78" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb260-79"><a href="meth_eval.html#cb260-79" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">count</span>(match_grp) <span class="sc">%&gt;%</span> </span>
<span id="cb260-80"><a href="meth_eval.html#cb260-80" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb260-81"><a href="meth_eval.html#cb260-81" tabindex="-1"></a>        <span class="at">match_grp =</span> dplyr<span class="sc">::</span><span class="fu">case_match</span>(</span>
<span id="cb260-82"><a href="meth_eval.html#cb260-82" tabindex="-1"></a>          match_grp</span>
<span id="cb260-83"><a href="meth_eval.html#cb260-83" tabindex="-1"></a>          , <span class="st">&quot;true positive&quot;</span><span class="sc">~</span><span class="st">&quot;tp&quot;</span></span>
<span id="cb260-84"><a href="meth_eval.html#cb260-84" tabindex="-1"></a>          , <span class="st">&quot;commission&quot;</span><span class="sc">~</span><span class="st">&quot;fp&quot;</span></span>
<span id="cb260-85"><a href="meth_eval.html#cb260-85" tabindex="-1"></a>          , <span class="st">&quot;omission&quot;</span><span class="sc">~</span><span class="st">&quot;fn&quot;</span></span>
<span id="cb260-86"><a href="meth_eval.html#cb260-86" tabindex="-1"></a>        )</span>
<span id="cb260-87"><a href="meth_eval.html#cb260-87" tabindex="-1"></a>      )</span>
<span id="cb260-88"><a href="meth_eval.html#cb260-88" tabindex="-1"></a>    <span class="co"># true positive, false positive, false negative rates</span></span>
<span id="cb260-89"><a href="meth_eval.html#cb260-89" tabindex="-1"></a>    return_df <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">tibble</span>(<span class="at">match_grp =</span> <span class="fu">c</span>(<span class="st">&quot;tp&quot;</span>,<span class="st">&quot;fp&quot;</span>,<span class="st">&quot;fn&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb260-90"><a href="meth_eval.html#cb260-90" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">left_join</span>(agg, <span class="at">by =</span> <span class="st">&quot;match_grp&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb260-91"><a href="meth_eval.html#cb260-91" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">mutate</span>(dplyr<span class="sc">::</span><span class="fu">across</span>(<span class="at">.cols =</span> <span class="fu">c</span>(n), <span class="at">.fn =</span> <span class="sc">~</span>dplyr<span class="sc">::</span><span class="fu">coalesce</span>(.x,<span class="dv">0</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb260-92"><a href="meth_eval.html#cb260-92" tabindex="-1"></a>      tidyr<span class="sc">::</span><span class="fu">pivot_wider</span>(</span>
<span id="cb260-93"><a href="meth_eval.html#cb260-93" tabindex="-1"></a>        <span class="at">names_from =</span> match_grp</span>
<span id="cb260-94"><a href="meth_eval.html#cb260-94" tabindex="-1"></a>        , <span class="at">values_from =</span> <span class="fu">c</span>(n)</span>
<span id="cb260-95"><a href="meth_eval.html#cb260-95" tabindex="-1"></a>        , <span class="at">names_glue =</span> <span class="st">&quot;{match_grp}_{.value}&quot;</span></span>
<span id="cb260-96"><a href="meth_eval.html#cb260-96" tabindex="-1"></a>      )</span>
<span id="cb260-97"><a href="meth_eval.html#cb260-97" tabindex="-1"></a>    <span class="co"># rates, precision, recall, f-score</span></span>
<span id="cb260-98"><a href="meth_eval.html#cb260-98" tabindex="-1"></a>    return_df <span class="ot">&lt;-</span> <span class="fu">confusion_matrix_scores_fn</span>(return_df)</span>
<span id="cb260-99"><a href="meth_eval.html#cb260-99" tabindex="-1"></a>    <span class="co"># add rmse</span></span>
<span id="cb260-100"><a href="meth_eval.html#cb260-100" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">nrow</span>(rmse_df)<span class="sc">&gt;</span><span class="dv">0</span>){</span>
<span id="cb260-101"><a href="meth_eval.html#cb260-101" tabindex="-1"></a>      return_df <span class="ot">&lt;-</span> return_df <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">bind_cols</span>(rmse_df)</span>
<span id="cb260-102"><a href="meth_eval.html#cb260-102" tabindex="-1"></a>    }</span>
<span id="cb260-103"><a href="meth_eval.html#cb260-103" tabindex="-1"></a>  <span class="co"># return</span></span>
<span id="cb260-104"><a href="meth_eval.html#cb260-104" tabindex="-1"></a>  <span class="fu">return</span>(return_df)</span>
<span id="cb260-105"><a href="meth_eval.html#cb260-105" tabindex="-1"></a>}</span></code></pre></div>
<p>There is a lot going on in our <code>agg_ground_truth_match()</code> function but it’s application is straightforward enough:</p>
<ul>
<li>The minimum required input is a data frame of the raw instance matches with a column named <code>match_grp</code> which is string/factor with the levels “true positive”, “commission”, and “omission” as returned by the <code>ground_truth_prediction_match()</code> function</li>
<li>Optionally, if the data contain columns with the prefix “diff_” the mean error (ME) is calculated for those columns with the return having the suffix “_mean” and the RMSE is calculated for those columns with the return having the suffix “_rmse”
<ul>
<li>interpretation of the ME is enhanced if these “diff_” columns are calculated as the predicted value minus the actual value (e.g. <code>pred_diameter_m - gt_diameter_m</code>)</li>
</ul></li>
<li>Optionally, if the data contain columns with the prefix “pct_diff_” the mean absolute percent error (MAPE) is calculated for those columns with the return having the suffix “_mape”
<ul>
<li>these “pct_diff_” columns are calculated as the actual value minus the predicted value divided by the actual value (e.g. <code>(gt_diameter_m - pred_diameter_m)/gt_diameter_m</code>)</li>
</ul></li>
</ul>
<p>first, let’s look at the <code>agg_ground_truth_match()</code> return using an example minimum required input data frame of the raw instance matches with a column named <code>match_grp</code> which is string/factor with the levels “true positive”, “commission”, and “omission”</p>
<div class="sourceCode" id="cb261"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb261-1"><a href="meth_eval.html#cb261-1" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">tibble</span>(</span>
<span id="cb261-2"><a href="meth_eval.html#cb261-2" tabindex="-1"></a>  <span class="at">match_grp =</span> <span class="fu">c</span>(</span>
<span id="cb261-3"><a href="meth_eval.html#cb261-3" tabindex="-1"></a>    <span class="fu">rep</span>(<span class="st">&quot;true positive&quot;</span>, <span class="at">times =</span> <span class="dv">9</span>)</span>
<span id="cb261-4"><a href="meth_eval.html#cb261-4" tabindex="-1"></a>    , <span class="fu">rep</span>(<span class="st">&quot;commission&quot;</span>, <span class="at">times =</span> <span class="dv">2</span>)</span>
<span id="cb261-5"><a href="meth_eval.html#cb261-5" tabindex="-1"></a>    , <span class="fu">rep</span>(<span class="st">&quot;omission&quot;</span>, <span class="at">times =</span> <span class="dv">4</span>)</span>
<span id="cb261-6"><a href="meth_eval.html#cb261-6" tabindex="-1"></a>  )</span>
<span id="cb261-7"><a href="meth_eval.html#cb261-7" tabindex="-1"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb261-8"><a href="meth_eval.html#cb261-8" tabindex="-1"></a><span class="fu">agg_ground_truth_match</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb261-9"><a href="meth_eval.html#cb261-9" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">glimpse</span>()</span></code></pre></div>
<pre><code>## Rows: 1
## Columns: 8
## $ tp_n            &lt;dbl&gt; 9
## $ fp_n            &lt;dbl&gt; 2
## $ fn_n            &lt;dbl&gt; 4
## $ omission_rate   &lt;dbl&gt; 0.3076923
## $ commission_rate &lt;dbl&gt; 0.1818182
## $ precision       &lt;dbl&gt; 0.8181818
## $ recall          &lt;dbl&gt; 0.6923077
## $ f_score         &lt;dbl&gt; 0.75</code></pre>
<p>now, let’s look at the <code>agg_ground_truth_match()</code> output using our fake pile prediction instance match example made by our <code>ground_truth_prediction_match()</code> function as input.</p>
<p>Before <code>agg_ground_truth_match()</code>, we’ll add area of the fake predicted piles and area of the ground truth piles (based on image-annotated boundaries) to ensure we get RMSE, MAPE, and ME quantification accuracy metrics in the result</p>
<div class="sourceCode" id="cb263"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb263-1"><a href="meth_eval.html#cb263-1" tabindex="-1"></a><span class="co"># first, we&#39;ll add pile area from the respective spatial data</span></span>
<span id="cb263-2"><a href="meth_eval.html#cb263-2" tabindex="-1"></a>ground_truth_prediction_match_ans <span class="ot">&lt;-</span> ground_truth_prediction_match_ans <span class="sc">%&gt;%</span> </span>
<span id="cb263-3"><a href="meth_eval.html#cb263-3" tabindex="-1"></a>  <span class="co"># join on gt area data</span></span>
<span id="cb263-4"><a href="meth_eval.html#cb263-4" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(</span>
<span id="cb263-5"><a href="meth_eval.html#cb263-5" tabindex="-1"></a>    aoi_slash_piles_polys <span class="sc">%&gt;%</span> </span>
<span id="cb263-6"><a href="meth_eval.html#cb263-6" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">select</span>(pile_id) <span class="sc">%&gt;%</span> </span>
<span id="cb263-7"><a href="meth_eval.html#cb263-7" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">gt_area_m2 =</span> sf<span class="sc">::</span><span class="fu">st_area</span>(.) <span class="sc">%&gt;%</span> <span class="fu">as.numeric</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb263-8"><a href="meth_eval.html#cb263-8" tabindex="-1"></a>      sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>()</span>
<span id="cb263-9"><a href="meth_eval.html#cb263-9" tabindex="-1"></a>    , <span class="at">by =</span> <span class="st">&quot;pile_id&quot;</span></span>
<span id="cb263-10"><a href="meth_eval.html#cb263-10" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb263-11"><a href="meth_eval.html#cb263-11" tabindex="-1"></a>  <span class="co"># join on pred area data</span></span>
<span id="cb263-12"><a href="meth_eval.html#cb263-12" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(</span>
<span id="cb263-13"><a href="meth_eval.html#cb263-13" tabindex="-1"></a>    predictions_temp <span class="sc">%&gt;%</span> </span>
<span id="cb263-14"><a href="meth_eval.html#cb263-14" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">select</span>(pred_id) <span class="sc">%&gt;%</span> </span>
<span id="cb263-15"><a href="meth_eval.html#cb263-15" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">pred_area_m2 =</span> sf<span class="sc">::</span><span class="fu">st_area</span>(.) <span class="sc">%&gt;%</span> <span class="fu">as.numeric</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb263-16"><a href="meth_eval.html#cb263-16" tabindex="-1"></a>      sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>()</span>
<span id="cb263-17"><a href="meth_eval.html#cb263-17" tabindex="-1"></a>    , <span class="at">by =</span> <span class="st">&quot;pred_id&quot;</span></span>
<span id="cb263-18"><a href="meth_eval.html#cb263-18" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb263-19"><a href="meth_eval.html#cb263-19" tabindex="-1"></a>  <span class="co"># calculate difference columns</span></span>
<span id="cb263-20"><a href="meth_eval.html#cb263-20" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb263-21"><a href="meth_eval.html#cb263-21" tabindex="-1"></a>    <span class="at">diff_area_m2 =</span> pred_area_m2<span class="sc">-</span>gt_area_m2</span>
<span id="cb263-22"><a href="meth_eval.html#cb263-22" tabindex="-1"></a>    , <span class="at">pct_diff_area_m2 =</span> (gt_area_m2<span class="sc">-</span>pred_area_m2)<span class="sc">/</span>gt_area_m2</span>
<span id="cb263-23"><a href="meth_eval.html#cb263-23" tabindex="-1"></a>  )</span>
<span id="cb263-24"><a href="meth_eval.html#cb263-24" tabindex="-1"></a><span class="co"># agg_ground_truth_match()</span></span>
<span id="cb263-25"><a href="meth_eval.html#cb263-25" tabindex="-1"></a><span class="fu">agg_ground_truth_match</span>(ground_truth_prediction_match_ans) <span class="sc">%&gt;%</span> </span>
<span id="cb263-26"><a href="meth_eval.html#cb263-26" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">glimpse</span>()</span></code></pre></div>
<pre><code>## Rows: 1
## Columns: 11
## $ tp_n                  &lt;dbl&gt; 10
## $ fp_n                  &lt;dbl&gt; 35
## $ fn_n                  &lt;dbl&gt; 8
## $ omission_rate         &lt;dbl&gt; 0.4444444
## $ commission_rate       &lt;dbl&gt; 0.7777778
## $ precision             &lt;dbl&gt; 0.2222222
## $ recall                &lt;dbl&gt; 0.5555556
## $ f_score               &lt;dbl&gt; 0.3174603
## $ diff_area_m2_rmse     &lt;dbl&gt; 5.389461
## $ diff_area_m2_mean     &lt;dbl&gt; -1.263415
## $ pct_diff_area_m2_mape &lt;dbl&gt; 0.6507452</code></pre>
<p>the <code>agg_ground_truth_match()</code> allows for multiple “diff_” and “pct_diff_” columns to aggregate quantification accuracy metrics for different measurements</p>
<div class="sourceCode" id="cb265"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb265-1"><a href="meth_eval.html#cb265-1" tabindex="-1"></a>ground_truth_prediction_match_ans <span class="sc">%&gt;%</span> </span>
<span id="cb265-2"><a href="meth_eval.html#cb265-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb265-3"><a href="meth_eval.html#cb265-3" tabindex="-1"></a>    <span class="co"># fake one</span></span>
<span id="cb265-4"><a href="meth_eval.html#cb265-4" tabindex="-1"></a>    <span class="at">pred_other_measurement =</span> <span class="fu">runif</span>(<span class="at">n=</span>dplyr<span class="sc">::</span><span class="fu">n</span>(),<span class="at">min =</span> <span class="dv">1</span>, <span class="at">max =</span> <span class="dv">11</span>)</span>
<span id="cb265-5"><a href="meth_eval.html#cb265-5" tabindex="-1"></a>    , <span class="at">pred_other_measurement =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(pred_id),<span class="cn">NA</span>,pred_other_measurement)</span>
<span id="cb265-6"><a href="meth_eval.html#cb265-6" tabindex="-1"></a>    <span class="co"># fake one</span></span>
<span id="cb265-7"><a href="meth_eval.html#cb265-7" tabindex="-1"></a>    , <span class="at">gt_other_measurement =</span> <span class="fu">runif</span>(<span class="at">n=</span>dplyr<span class="sc">::</span><span class="fu">n</span>(),<span class="at">min =</span> <span class="dv">3</span>, <span class="at">max =</span> <span class="dv">13</span>)</span>
<span id="cb265-8"><a href="meth_eval.html#cb265-8" tabindex="-1"></a>    , <span class="at">gt_other_measurement =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(pile_id),<span class="cn">NA</span>,gt_other_measurement)</span>
<span id="cb265-9"><a href="meth_eval.html#cb265-9" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb265-10"><a href="meth_eval.html#cb265-10" tabindex="-1"></a>  <span class="co"># calculate difference columns</span></span>
<span id="cb265-11"><a href="meth_eval.html#cb265-11" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb265-12"><a href="meth_eval.html#cb265-12" tabindex="-1"></a>    <span class="at">diff_other_measurement =</span> pred_other_measurement<span class="sc">-</span>gt_other_measurement</span>
<span id="cb265-13"><a href="meth_eval.html#cb265-13" tabindex="-1"></a>    , <span class="at">pct_diff_other_measurement =</span> (gt_other_measurement<span class="sc">-</span>pred_other_measurement)<span class="sc">/</span>gt_other_measurement</span>
<span id="cb265-14"><a href="meth_eval.html#cb265-14" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb265-15"><a href="meth_eval.html#cb265-15" tabindex="-1"></a>  <span class="fu">agg_ground_truth_match</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb265-16"><a href="meth_eval.html#cb265-16" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">glimpse</span>()</span></code></pre></div>
<pre><code>## Rows: 1
## Columns: 14
## $ tp_n                            &lt;dbl&gt; 10
## $ fp_n                            &lt;dbl&gt; 35
## $ fn_n                            &lt;dbl&gt; 8
## $ omission_rate                   &lt;dbl&gt; 0.4444444
## $ commission_rate                 &lt;dbl&gt; 0.7777778
## $ precision                       &lt;dbl&gt; 0.2222222
## $ recall                          &lt;dbl&gt; 0.5555556
## $ f_score                         &lt;dbl&gt; 0.3174603
## $ diff_area_m2_rmse               &lt;dbl&gt; 5.389461
## $ diff_other_measurement_rmse     &lt;dbl&gt; 2.842555
## $ diff_area_m2_mean               &lt;dbl&gt; -1.263415
## $ diff_other_measurement_mean     &lt;dbl&gt; -0.3700619
## $ pct_diff_area_m2_mape           &lt;dbl&gt; 0.6507452
## $ pct_diff_other_measurement_mape &lt;dbl&gt; 0.3802022</code></pre>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="data_fusion.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="meth_preds.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
  "sharing": {
    "github": false,
    "facebook": true,
    "twitter": true,
    "linkedin": false,
    "weibo": false,
    "instapaper": false,
    "vk": false,
    "whatsapp": false,
    "all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
  },
  "fontsettings": {
    "theme": "white",
    "family": "sans",
    "size": 2
  },
  "edit": {
    "link": null,
    "text": null
  },
  "history": {
    "link": null,
    "text": null
  },
  "view": {
    "link": null,
    "text": null
  },
  "download": null,
  "search": {
    "engine": "fuse",
    "options": null
  },
  "toc": {
    "collapse": "subsection"
  }
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
