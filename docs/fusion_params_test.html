<!DOCTYPE html>
<html lang="en-US" xml:lang="en-US">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Section 8 Data Fusion: Sensitivity Testing | Aerial Imagery and Point Cloud Data for Slash Pile Quantification</title>
  <meta name="description" content="Using the bookdown package to write a book of data exploration. The output format for this example is bookdown::gitbook." />
  <meta name="generator" content="bookdown 0.34 and GitBook 2.6.7" />

  <meta property="og:title" content="Section 8 Data Fusion: Sensitivity Testing | Aerial Imagery and Point Cloud Data for Slash Pile Quantification" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="Using the bookdown package to write a book of data exploration. The output format for this example is bookdown::gitbook." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Section 8 Data Fusion: Sensitivity Testing | Aerial Imagery and Point Cloud Data for Slash Pile Quantification" />
  
  <meta name="twitter:description" content="Using the bookdown package to write a book of data exploration. The output format for this example is bookdown::gitbook." />
  

<meta name="author" content="George Woolsey" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="data_fusion.html"/>
<link rel="next" href="chm-raster-resolution-testing.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<link href="libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet" />
<script src="libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/proj4-2.6.2/proj4.min.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.2.2/leaflet.js"></script>
<script src="libs/leaflet-providers-2.0.0/leaflet-providers_2.0.0.js"></script>
<script src="libs/leaflet-providers-plugin-2.2.2/leaflet-providers-plugin.js"></script>
<script src="libs/clipboard-0.0.1/setClipboardText.js"></script>
<link href="libs/mapviewCSS-0.0.1/mapview-popup.css" rel="stylesheet" />
<link href="libs/mapviewCSS-0.0.1/mapview.css" rel="stylesheet" />
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<link href="libs/bsTable-3.3.7/bootstrapTable.min.css" rel="stylesheet" />
<script src="libs/bsTable-3.3.7/bootstrapTable.js"></script>
<script type="text/javascript">

// toggle visibility of R source blocks in R Markdown output
function toggle_R() {
  var x = document.getElementsByClassName('r');
  if (x.length == 0) return;
  function toggle_vis(o) {
    var d = o.style.display;
    o.style.display = (d == 'block' || d == '') ? 'none':'block';
  }

  for (i = 0; i < x.length; i++) {
    var y = x[i];
    if (y.tagName.toLowerCase() === 'pre') toggle_vis(y);
  }

    var elem = document.getElementById("myButton1");
    if (elem.value === "Hide Code") elem.value = "Show Code";
    else elem.value = "Hide Code";
}

document.write('<input onclick="toggle_R();" type="button" value="Hide Code" id="myButton1" style="position: absolute; top: 10%; right: 2%; z-index: 200"></input>')

</script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#objective"><i class="fa fa-check"></i><b>1.1</b> Objective</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#data_desc"><i class="fa fa-check"></i><b>1.2</b> Data</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="data-processing.html"><a href="data-processing.html"><i class="fa fa-check"></i><b>2</b> Data Processing</a>
<ul>
<li class="chapter" data-level="2.1" data-path="data-processing.html"><a href="data-processing.html#slash-pile-vector-data"><i class="fa fa-check"></i><b>2.1</b> Slash Pile Vector Data</a></li>
<li class="chapter" data-level="2.2" data-path="data-processing.html"><a href="data-processing.html#load-rgb-orthomosaic-rasters"><i class="fa fa-check"></i><b>2.2</b> Load RGB orthomosaic rasters</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="data-processing.html"><a href="data-processing.html#example-ratio-based-index"><i class="fa fa-check"></i><b>2.2.1</b> Example ratio-based index</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="data-processing.html"><a href="data-processing.html#study-area-imagery"><i class="fa fa-check"></i><b>2.3</b> Study area imagery</a></li>
<li class="chapter" data-level="2.4" data-path="data-processing.html"><a href="data-processing.html#point-cloud-data"><i class="fa fa-check"></i><b>2.4</b> Point Cloud Data</a></li>
<li class="chapter" data-level="2.5" data-path="data-processing.html"><a href="data-processing.html#check-out-one-pile"><i class="fa fa-check"></i><b>2.5</b> Check out one pile</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="rgb-classification.html"><a href="rgb-classification.html"><i class="fa fa-check"></i><b>3</b> RGB Classification</a>
<ul>
<li class="chapter" data-level="3.1" data-path="rgb-classification.html"><a href="rgb-classification.html#textural-covariates"><i class="fa fa-check"></i><b>3.1</b> Textural covariates</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="rgb-classification.html"><a href="rgb-classification.html#raster-texture-panchromatic"><i class="fa fa-check"></i><b>3.1.1</b> Raster Texture: Panchromatic</a></li>
<li class="chapter" data-level="3.1.2" data-path="rgb-classification.html"><a href="rgb-classification.html#raster-texture-grvi"><i class="fa fa-check"></i><b>3.1.2</b> Raster Texture: GRVI</a></li>
<li class="chapter" data-level="3.1.3" data-path="rgb-classification.html"><a href="rgb-classification.html#plot-textural-rasters"><i class="fa fa-check"></i><b>3.1.3</b> Plot textural rasters</a></li>
<li class="chapter" data-level="3.1.4" data-path="rgb-classification.html"><a href="rgb-classification.html#features-for-classification"><i class="fa fa-check"></i><b>3.1.4</b> Features for classification</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="rgb-classification.html"><a href="rgb-classification.html#pixel-based-unsupervised-classification"><i class="fa fa-check"></i><b>3.2</b> Pixel-based: unsupervised classification</a></li>
<li class="chapter" data-level="3.3" data-path="rgb-classification.html"><a href="rgb-classification.html#pixel_class"><i class="fa fa-check"></i><b>3.3</b> Pixel-based: supervised classification</a></li>
<li class="chapter" data-level="3.4" data-path="rgb-classification.html"><a href="rgb-classification.html#obia"><i class="fa fa-check"></i><b>3.4</b> Object-based image analysis (OBIA)</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="rgb-classification.html"><a href="rgb-classification.html#training-data"><i class="fa fa-check"></i><b>3.4.1</b> Training data</a></li>
<li class="chapter" data-level="3.4.2" data-path="rgb-classification.html"><a href="rgb-classification.html#slic"><i class="fa fa-check"></i><b>3.4.2</b> <code>OpenImageR</code> package SLIC image segmentation</a></li>
<li class="chapter" data-level="3.4.3" data-path="rgb-classification.html"><a href="rgb-classification.html#superpixelimagesegmentation-package-slicap-clustering"><i class="fa fa-check"></i><b>3.4.3</b> <code>SuperpixelImageSegmentation</code> package SLICAP clustering</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="ptcld_process.html"><a href="ptcld_process.html"><i class="fa fa-check"></i><b>4</b> Point Cloud Processing and Pile Segmentation</a>
<ul>
<li class="chapter" data-level="4.1" data-path="ptcld_process.html"><a href="ptcld_process.html#process-raw-point-cloud"><i class="fa fa-check"></i><b>4.1</b> Process Raw Point Cloud</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="ptcld_process.html"><a href="ptcld_process.html#dtm-and-chm-piles"><i class="fa fa-check"></i><b>4.1.1</b> DTM and CHM + piles</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="raster_watershed.html"><a href="raster_watershed.html"><i class="fa fa-check"></i><b>5</b> Raster-based: Watershed Segmentation</a>
<ul>
<li class="chapter" data-level="5.1" data-path="raster_watershed.html"><a href="raster_watershed.html#method-demonstration"><i class="fa fa-check"></i><b>5.1</b> Method Demonstration</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="raster_watershed.html"><a href="raster_watershed.html#geometric-filtering-irregularity-filtering"><i class="fa fa-check"></i><b>5.1.1</b> Geometric filtering: Irregularity Filtering</a></li>
<li class="chapter" data-level="5.1.2" data-path="raster_watershed.html"><a href="raster_watershed.html#area-filtering"><i class="fa fa-check"></i><b>5.1.2</b> Area Filtering</a></li>
<li class="chapter" data-level="5.1.3" data-path="raster_watershed.html"><a href="raster_watershed.html#geometric-filtering-circularity-filtering"><i class="fa fa-check"></i><b>5.1.3</b> Geometric filtering: Circularity Filtering</a></li>
<li class="chapter" data-level="5.1.4" data-path="raster_watershed.html"><a href="raster_watershed.html#smoothing"><i class="fa fa-check"></i><b>5.1.4</b> Smoothing</a></li>
<li class="chapter" data-level="5.1.5" data-path="raster_watershed.html"><a href="raster_watershed.html#shape-refinement"><i class="fa fa-check"></i><b>5.1.5</b> Shape Refinement</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="raster_watershed.html"><a href="raster_watershed.html#confusion-matrix-evaluation"><i class="fa fa-check"></i><b>5.2</b> Confusion matrix evaluation</a></li>
<li class="chapter" data-level="5.3" data-path="raster_watershed.html"><a href="raster_watershed.html#pile-area-rmse"><i class="fa fa-check"></i><b>5.3</b> Pile area RMSE</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="watershed-segmentation-sensitivity-testing.html"><a href="watershed-segmentation-sensitivity-testing.html"><i class="fa fa-check"></i><b>6</b> Watershed Segmentation: Sensitivity Testing</a>
<ul>
<li class="chapter" data-level="6.1" data-path="watershed-segmentation-sensitivity-testing.html"><a href="watershed-segmentation-sensitivity-testing.html#slash_pile_detect_watershed"><i class="fa fa-check"></i><b>6.1</b> Watershed Pile Detection Function</a></li>
<li class="chapter" data-level="6.2" data-path="watershed-segmentation-sensitivity-testing.html"><a href="watershed-segmentation-sensitivity-testing.html#wshed_params_test"><i class="fa fa-check"></i><b>6.2</b> Parameter sensitivity testing</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="watershed-segmentation-sensitivity-testing.html"><a href="watershed-segmentation-sensitivity-testing.html#all_the_combos"><i class="fa fa-check"></i><b>6.2.1</b> Workflow over parameter combinations</a></li>
<li class="chapter" data-level="6.2.2" data-path="watershed-segmentation-sensitivity-testing.html"><a href="watershed-segmentation-sensitivity-testing.html#validation-over-parameter-combinations"><i class="fa fa-check"></i><b>6.2.2</b> Validation over parameter combinations</a></li>
<li class="chapter" data-level="6.2.3" data-path="watershed-segmentation-sensitivity-testing.html"><a href="watershed-segmentation-sensitivity-testing.html#aggregate-assessment-metrics"><i class="fa fa-check"></i><b>6.2.3</b> Aggregate assessment metrics</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="watershed-segmentation-sensitivity-testing.html"><a href="watershed-segmentation-sensitivity-testing.html#parameter-sensitivity-test-results"><i class="fa fa-check"></i><b>6.3</b> Parameter Sensitivity Test Results</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="watershed-segmentation-sensitivity-testing.html"><a href="watershed-segmentation-sensitivity-testing.html#overall-pile-detection"><i class="fa fa-check"></i><b>6.3.1</b> Overall: pile detection</a></li>
<li class="chapter" data-level="6.3.2" data-path="watershed-segmentation-sensitivity-testing.html"><a href="watershed-segmentation-sensitivity-testing.html#overall-form-quantification"><i class="fa fa-check"></i><b>6.3.2</b> Overall: form quantification</a></li>
<li class="chapter" data-level="6.3.3" data-path="watershed-segmentation-sensitivity-testing.html"><a href="watershed-segmentation-sensitivity-testing.html#main-effects-pile-detection"><i class="fa fa-check"></i><b>6.3.3</b> Main Effects: pile detection</a></li>
<li class="chapter" data-level="6.3.4" data-path="watershed-segmentation-sensitivity-testing.html"><a href="watershed-segmentation-sensitivity-testing.html#main-effects-form-quantification"><i class="fa fa-check"></i><b>6.3.4</b> Main Effects: form quantification</a></li>
<li class="chapter" data-level="6.3.5" data-path="watershed-segmentation-sensitivity-testing.html"><a href="watershed-segmentation-sensitivity-testing.html#best-results-detection-accuracy"><i class="fa fa-check"></i><b>6.3.5</b> Best results: detection accuracy</a></li>
<li class="chapter" data-level="6.3.6" data-path="watershed-segmentation-sensitivity-testing.html"><a href="watershed-segmentation-sensitivity-testing.html#best-results-quantification-accuracy"><i class="fa fa-check"></i><b>6.3.6</b> Best results: quantification accuracy</a></li>
<li class="chapter" data-level="6.3.7" data-path="watershed-segmentation-sensitivity-testing.html"><a href="watershed-segmentation-sensitivity-testing.html#wshed_best_best"><i class="fa fa-check"></i><b>6.3.7</b> Best results: detection &amp; quantification</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="watershed-segmentation-sensitivity-testing.html"><a href="watershed-segmentation-sensitivity-testing.html#final-recommended-settings"><i class="fa fa-check"></i><b>6.4</b> Final recommended settings</a></li>
<li class="chapter" data-level="6.5" data-path="watershed-segmentation-sensitivity-testing.html"><a href="watershed-segmentation-sensitivity-testing.html#appendix-parameter-combination-drill-downs"><i class="fa fa-check"></i><b>6.5</b> Appendix: Parameter combination drill-downs</a>
<ul>
<li class="chapter" data-level="6.5.1" data-path="watershed-segmentation-sensitivity-testing.html"><a href="watershed-segmentation-sensitivity-testing.html#f-score"><i class="fa fa-check"></i><b>6.5.1</b> F-score</a></li>
<li class="chapter" data-level="6.5.2" data-path="watershed-segmentation-sensitivity-testing.html"><a href="watershed-segmentation-sensitivity-testing.html#recall"><i class="fa fa-check"></i><b>6.5.2</b> Recall</a></li>
<li class="chapter" data-level="6.5.3" data-path="watershed-segmentation-sensitivity-testing.html"><a href="watershed-segmentation-sensitivity-testing.html#precision"><i class="fa fa-check"></i><b>6.5.3</b> Precision</a></li>
<li class="chapter" data-level="6.5.4" data-path="watershed-segmentation-sensitivity-testing.html"><a href="watershed-segmentation-sensitivity-testing.html#mape-volume-irregular"><i class="fa fa-check"></i><b>6.5.4</b> MAPE Volume irregular</a></li>
<li class="chapter" data-level="6.5.5" data-path="watershed-segmentation-sensitivity-testing.html"><a href="watershed-segmentation-sensitivity-testing.html#mape-diameter"><i class="fa fa-check"></i><b>6.5.5</b> MAPE Diameter</a></li>
<li class="chapter" data-level="6.5.6" data-path="watershed-segmentation-sensitivity-testing.html"><a href="watershed-segmentation-sensitivity-testing.html#mape-area"><i class="fa fa-check"></i><b>6.5.6</b> MAPE Area</a></li>
<li class="chapter" data-level="6.5.7" data-path="watershed-segmentation-sensitivity-testing.html"><a href="watershed-segmentation-sensitivity-testing.html#mape-height"><i class="fa fa-check"></i><b>6.5.7</b> MAPE Height</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="data_fusion.html"><a href="data_fusion.html"><i class="fa fa-check"></i><b>7</b> Data Fusion</a>
<ul>
<li class="chapter" data-level="7.1" data-path="data_fusion.html"><a href="data_fusion.html#rgb-indices"><i class="fa fa-check"></i><b>7.1</b> RGB Indices</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="data_fusion.html"><a href="data_fusion.html#spectral-index-functions"><i class="fa fa-check"></i><b>7.1.1</b> Spectral Index Functions</a></li>
<li class="chapter" data-level="7.1.2" data-path="data_fusion.html"><a href="data_fusion.html#spectral-index-of-polygons"><i class="fa fa-check"></i><b>7.1.2</b> Spectral Index of Polygons</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="data_fusion.html"><a href="data_fusion.html#ground-truth-pile-spectral-summary"><i class="fa fa-check"></i><b>7.2</b> Ground Truth Pile Spectral Summary</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="data_fusion.html"><a href="data_fusion.html#voting-system"><i class="fa fa-check"></i><b>7.2.1</b> Voting System</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="data_fusion.html"><a href="data_fusion.html#polygon_spectral_filtering"><i class="fa fa-check"></i><b>7.3</b> Candidate Polygon Spectral Filtering Function</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="fusion_params_test.html"><a href="fusion_params_test.html"><i class="fa fa-check"></i><b>8</b> Data Fusion: Sensitivity Testing</a>
<ul>
<li class="chapter" data-level="8.1" data-path="fusion_params_test.html"><a href="fusion_params_test.html#example-comparison-by-spectral-weighting"><i class="fa fa-check"></i><b>8.1</b> Example comparison by spectral weighting</a></li>
<li class="chapter" data-level="8.2" data-path="fusion_params_test.html"><a href="fusion_params_test.html#aggregate-assessment-metrics-1"><i class="fa fa-check"></i><b>8.2</b> Aggregate assessment metrics</a></li>
<li class="chapter" data-level="8.3" data-path="fusion_params_test.html"><a href="fusion_params_test.html#parameter-sensitivity-test-results-1"><i class="fa fa-check"></i><b>8.3</b> Parameter Sensitivity Test Results</a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="fusion_params_test.html"><a href="fusion_params_test.html#main-effect-of-spectral-data-pile-detection"><i class="fa fa-check"></i><b>8.3.1</b> Main effect of spectral data: pile detection</a></li>
<li class="chapter" data-level="8.3.2" data-path="fusion_params_test.html"><a href="fusion_params_test.html#main-effect-of-spectral-data-form-quantification"><i class="fa fa-check"></i><b>8.3.2</b> Main effect of spectral data: form quantification</a></li>
<li class="chapter" data-level="8.3.3" data-path="fusion_params_test.html"><a href="fusion_params_test.html#overall-pile-detection-1"><i class="fa fa-check"></i><b>8.3.3</b> Overall: pile detection</a></li>
<li class="chapter" data-level="8.3.4" data-path="fusion_params_test.html"><a href="fusion_params_test.html#overall-form-quantification-1"><i class="fa fa-check"></i><b>8.3.4</b> Overall: form quantification</a></li>
<li class="chapter" data-level="8.3.5" data-path="fusion_params_test.html"><a href="fusion_params_test.html#best-results-detection-accuracy-1"><i class="fa fa-check"></i><b>8.3.5</b> Best results: detection accuracy</a></li>
<li class="chapter" data-level="8.3.6" data-path="fusion_params_test.html"><a href="fusion_params_test.html#best-results-quantification-accuracy-1"><i class="fa fa-check"></i><b>8.3.6</b> Best results: quantification accuracy</a></li>
<li class="chapter" data-level="8.3.7" data-path="fusion_params_test.html"><a href="fusion_params_test.html#best-results-detection-quantification"><i class="fa fa-check"></i><b>8.3.7</b> Best results: detection &amp; quantification</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="fusion_params_test.html"><a href="fusion_params_test.html#final-recommended-settings-1"><i class="fa fa-check"></i><b>8.4</b> Final recommended settings</a></li>
<li class="chapter" data-level="8.5" data-path="fusion_params_test.html"><a href="fusion_params_test.html#final-recommended-settings-data-fusion-versus-structural-only"><i class="fa fa-check"></i><b>8.5</b> Final recommended settings: data fusion versus structural only</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="chm-raster-resolution-testing.html"><a href="chm-raster-resolution-testing.html"><i class="fa fa-check"></i><b>9</b> CHM Raster Resolution Testing</a>
<ul>
<li class="chapter" data-level="9.1" data-path="chm-raster-resolution-testing.html"><a href="chm-raster-resolution-testing.html#process-raw-point-cloud-1"><i class="fa fa-check"></i><b>9.1</b> Process Raw Point Cloud</a></li>
<li class="chapter" data-level="9.2" data-path="chm-raster-resolution-testing.html"><a href="chm-raster-resolution-testing.html#structural-only-parameter-testing"><i class="fa fa-check"></i><b>9.2</b> Structural Only: Parameter Testing</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="chm-raster-resolution-testing.html"><a href="chm-raster-resolution-testing.html#validation-over-parameter-combinations-1"><i class="fa fa-check"></i><b>9.2.1</b> Validation over parameter combinations</a></li>
<li class="chapter" data-level="9.2.2" data-path="chm-raster-resolution-testing.html"><a href="chm-raster-resolution-testing.html#aggregate-validation-metrics-to-parameter-combination"><i class="fa fa-check"></i><b>9.2.2</b> Aggregate Validation Metrics to Parameter Combination</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="chm-raster-resolution-testing.html"><a href="chm-raster-resolution-testing.html#data-fusion-parameter-testing"><i class="fa fa-check"></i><b>9.3</b> Data Fusion: Parameter Testing</a>
<ul>
<li class="chapter" data-level="9.3.1" data-path="chm-raster-resolution-testing.html"><a href="chm-raster-resolution-testing.html#aggregate-validation-metrics-to-parameter-combination-1"><i class="fa fa-check"></i><b>9.3.1</b> Aggregate Validation Metrics to Parameter Combination</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="chm-raster-resolution-testing.html"><a href="chm-raster-resolution-testing.html#read-data-for-analysis"><i class="fa fa-check"></i><b>9.4</b> Read Data for Analysis</a>
<ul>
<li class="chapter" data-level="9.4.1" data-path="chm-raster-resolution-testing.html"><a href="chm-raster-resolution-testing.html#structural-only"><i class="fa fa-check"></i><b>9.4.1</b> Structural Only</a></li>
<li class="chapter" data-level="9.4.2" data-path="chm-raster-resolution-testing.html"><a href="chm-raster-resolution-testing.html#data-fusion"><i class="fa fa-check"></i><b>9.4.2</b> Data Fusion</a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="chm-raster-resolution-testing.html"><a href="chm-raster-resolution-testing.html#allthetests"><i class="fa fa-check"></i><b>9.5</b> Structural Only: Sensitivity Testing</a>
<ul>
<li class="chapter" data-level="9.5.1" data-path="chm-raster-resolution-testing.html"><a href="chm-raster-resolution-testing.html#detect_trends"><i class="fa fa-check"></i><b>9.5.1</b> Main Effects: pile detection</a></li>
<li class="chapter" data-level="9.5.2" data-path="chm-raster-resolution-testing.html"><a href="chm-raster-resolution-testing.html#main-effects-form-quantification-1"><i class="fa fa-check"></i><b>9.5.2</b> Main Effects: form quantification</a></li>
<li class="chapter" data-level="9.5.3" data-path="chm-raster-resolution-testing.html"><a href="chm-raster-resolution-testing.html#final-recommended-settings-2"><i class="fa fa-check"></i><b>9.5.3</b> Final recommended settings</a></li>
</ul></li>
<li class="chapter" data-level="9.6" data-path="chm-raster-resolution-testing.html"><a href="chm-raster-resolution-testing.html#data-fusion-sensitivity-testing"><i class="fa fa-check"></i><b>9.6</b> Data Fusion: Sensitivity Testing</a>
<ul>
<li class="chapter" data-level="9.6.1" data-path="chm-raster-resolution-testing.html"><a href="chm-raster-resolution-testing.html#main-effects-pile-detection-1"><i class="fa fa-check"></i><b>9.6.1</b> Main Effects: pile detection</a></li>
<li class="chapter" data-level="9.6.2" data-path="chm-raster-resolution-testing.html"><a href="chm-raster-resolution-testing.html#main-effects-form-quantification-2"><i class="fa fa-check"></i><b>9.6.2</b> Main Effects: form quantification</a></li>
<li class="chapter" data-level="9.6.3" data-path="chm-raster-resolution-testing.html"><a href="chm-raster-resolution-testing.html#balanced_acc_assess"><i class="fa fa-check"></i><b>9.6.3</b> Final recommended settings</a></li>
</ul></li>
<li class="chapter" data-level="9.7" data-path="chm-raster-resolution-testing.html"><a href="chm-raster-resolution-testing.html#save-the-data"><i class="fa fa-check"></i><b>9.7</b> save the data</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="stats_method.html"><a href="stats_method.html"><i class="fa fa-check"></i><b>10</b> Statistical Testing of Method Settings</a>
<ul>
<li class="chapter" data-level="10.1" data-path="stats_method.html"><a href="stats_method.html#bayesian-generalized-linear-model---f-score"><i class="fa fa-check"></i><b>10.1</b> Bayesian generalized linear model - F-score</a>
<ul>
<li class="chapter" data-level="10.1.1" data-path="stats_method.html"><a href="stats_method.html#model-selection"><i class="fa fa-check"></i><b>10.1.1</b> Model selection</a></li>
<li class="chapter" data-level="10.1.2" data-path="stats_method.html"><a href="stats_method.html#modeling"><i class="fa fa-check"></i><b>10.1.2</b> Modeling</a></li>
<li class="chapter" data-level="10.1.3" data-path="stats_method.html"><a href="stats_method.html#posterior-predictive-checks"><i class="fa fa-check"></i><b>10.1.3</b> Posterior Predictive Checks</a></li>
<li class="chapter" data-level="10.1.4" data-path="stats_method.html"><a href="stats_method.html#conditional-effects"><i class="fa fa-check"></i><b>10.1.4</b> Conditional Effects</a></li>
<li class="chapter" data-level="10.1.5" data-path="stats_method.html"><a href="stats_method.html#posterior-predictive-expectation"><i class="fa fa-check"></i><b>10.1.5</b> Posterior Predictive Expectation</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="stats_method.html"><a href="stats_method.html#mod_diam_mape"><i class="fa fa-check"></i><b>10.2</b> Bayesian generalized linear model - Diameter MAPE</a>
<ul>
<li class="chapter" data-level="10.2.1" data-path="stats_method.html"><a href="stats_method.html#model-selection-1"><i class="fa fa-check"></i><b>10.2.1</b> Model selection</a></li>
<li class="chapter" data-level="10.2.2" data-path="stats_method.html"><a href="stats_method.html#modeling-1"><i class="fa fa-check"></i><b>10.2.2</b> Modeling</a></li>
<li class="chapter" data-level="10.2.3" data-path="stats_method.html"><a href="stats_method.html#posterior-predictive-checks-1"><i class="fa fa-check"></i><b>10.2.3</b> Posterior Predictive Checks</a></li>
<li class="chapter" data-level="10.2.4" data-path="stats_method.html"><a href="stats_method.html#conditional-effects-1"><i class="fa fa-check"></i><b>10.2.4</b> Conditional Effects</a></li>
<li class="chapter" data-level="10.2.5" data-path="stats_method.html"><a href="stats_method.html#posterior-predictive-expectation-1"><i class="fa fa-check"></i><b>10.2.5</b> Posterior Predictive Expectation</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="stats_method.html"><a href="stats_method.html#bayesian-generalized-linear-model---height-mape"><i class="fa fa-check"></i><b>10.3</b> Bayesian generalized linear model - Height MAPE</a>
<ul>
<li class="chapter" data-level="10.3.1" data-path="stats_method.html"><a href="stats_method.html#model-selection-2"><i class="fa fa-check"></i><b>10.3.1</b> Model selection</a></li>
<li class="chapter" data-level="10.3.2" data-path="stats_method.html"><a href="stats_method.html#modeling-2"><i class="fa fa-check"></i><b>10.3.2</b> Modeling</a></li>
<li class="chapter" data-level="10.3.3" data-path="stats_method.html"><a href="stats_method.html#posterior-predictive-checks-2"><i class="fa fa-check"></i><b>10.3.3</b> Posterior Predictive Checks</a></li>
<li class="chapter" data-level="10.3.4" data-path="stats_method.html"><a href="stats_method.html#conditional-effects-2"><i class="fa fa-check"></i><b>10.3.4</b> Conditional Effects</a></li>
<li class="chapter" data-level="10.3.5" data-path="stats_method.html"><a href="stats_method.html#posterior-predictive-expectation-2"><i class="fa fa-check"></i><b>10.3.5</b> Posterior Predictive Expectation</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11" data-path="method-validation.html"><a href="method-validation.html"><i class="fa fa-check"></i><b>11</b> Method Validation</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Aerial Imagery and Point Cloud Data for Slash Pile Quantification</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="fusion_params_test" class="section level1 hasAnchor" number="8">
<h1><span class="header-section-number">Section 8</span> Data Fusion: Sensitivity Testing<a href="fusion_params_test.html#fusion_params_test" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>Now we’ll perform sensitivity testing of our <a href="data_fusion.html#data_fusion">data fusion slash pile detection methodology</a>.</p>
<p>We already tested the sensitivity of the parameter settings for our structural, raster-based slash pile detection methodology (see <a href="watershed-segmentation-sensitivity-testing.html#wshed_params_test">here</a>). Now, we’ll use the set of predicted piles based on the combinations of the different parameter settings in the raster-based method to test the sensitivity of our spectral based method. In short, we’re going to use the RGB imagery to filter these candidates spectrally using different weighting (voting system) settings for the spectral data. We’ll test the <code>spectral_weight</code> parameter from the lowest weighting of the spectral data of “1” (only one spectral index threshold must be met) to the highest weighting of spectral data “5” (all spectral index thresholds must be met).</p>
<p>For evaluating our structural and spectral data fusion approach, the RGB imagery will simply serve to spectrally filter candidate slash piles initially identified by our structural, raster-based <a href="watershed-segmentation-sensitivity-testing.html#slash_pile_detect_watershed">watershed segmentation approach</a>. This means we don’t need to re-evaluate these initial candidates against ground truth to classify predictions as true positive, commission (false positive), or omission (false negative). Instead, we will determine which candidates to retain or remove from the structural list based on their spectral properties. If a structurally detected true positive is filtered out by spectral data, it will be reclassified as an omission. Additionally, any commission (false positive) from the structural detection that is filtered out spectrally will be removed from consideration since the data fusion approach successfully eliminated these incorrect predictions. No other shifts within the confusion matrix are possible, since incorporating the spectral data under this approach does not introduce any new candidate piles for evaluation against the ground truth data. Importantly, incorporating the spectral data does not alter the predicted pile form. As such, limited (no?) change is expected in the quantification accuracy metrics. The only way these could change after incorporating the spectral data is if the spectral data incorrectly removes true positive matches which are used to assess pile form quantification accuracy.</p>
<div class="sourceCode" id="cb287"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb287-1"><a href="fusion_params_test.html#cb287-1" tabindex="-1"></a><span class="cf">if</span>( <span class="fu">length</span>(<span class="fu">ls</span>()[<span class="fu">grep</span>(<span class="st">&quot;param_combos_piles&quot;</span>,<span class="fu">ls</span>())])<span class="sc">!=</span><span class="dv">1</span> ){</span>
<span id="cb287-2"><a href="fusion_params_test.html#cb287-2" tabindex="-1"></a>  param_combos_piles <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_read</span>(<span class="st">&quot;../data/param_combos_piles.gpkg&quot;</span>, <span class="at">quiet =</span> T)</span>
<span id="cb287-3"><a href="fusion_params_test.html#cb287-3" tabindex="-1"></a>  <span class="co"># let&#39;s attach a flag to only work with piles that intersect with the stand boundary</span></span>
<span id="cb287-4"><a href="fusion_params_test.html#cb287-4" tabindex="-1"></a>  <span class="co"># and caclulate the &quot;diameter&quot; of the piles</span></span>
<span id="cb287-5"><a href="fusion_params_test.html#cb287-5" tabindex="-1"></a>  <span class="co"># add in/out to piles data</span></span>
<span id="cb287-6"><a href="fusion_params_test.html#cb287-6" tabindex="-1"></a>  param_combos_piles <span class="ot">&lt;-</span> param_combos_piles <span class="sc">%&gt;%</span> </span>
<span id="cb287-7"><a href="fusion_params_test.html#cb287-7" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">left_join</span>(</span>
<span id="cb287-8"><a href="fusion_params_test.html#cb287-8" tabindex="-1"></a>      param_combos_piles <span class="sc">%&gt;%</span> </span>
<span id="cb287-9"><a href="fusion_params_test.html#cb287-9" tabindex="-1"></a>        sf<span class="sc">::</span><span class="fu">st_intersection</span>(</span>
<span id="cb287-10"><a href="fusion_params_test.html#cb287-10" tabindex="-1"></a>          stand_boundary <span class="sc">%&gt;%</span> </span>
<span id="cb287-11"><a href="fusion_params_test.html#cb287-11" tabindex="-1"></a>            sf<span class="sc">::</span><span class="fu">st_transform</span>(sf<span class="sc">::</span><span class="fu">st_crs</span>(param_combos_piles))</span>
<span id="cb287-12"><a href="fusion_params_test.html#cb287-12" tabindex="-1"></a>        ) <span class="sc">%&gt;%</span> </span>
<span id="cb287-13"><a href="fusion_params_test.html#cb287-13" tabindex="-1"></a>        sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb287-14"><a href="fusion_params_test.html#cb287-14" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">select</span>(rn,pred_id) <span class="sc">%&gt;%</span> </span>
<span id="cb287-15"><a href="fusion_params_test.html#cb287-15" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">is_in_stand =</span> T)</span>
<span id="cb287-16"><a href="fusion_params_test.html#cb287-16" tabindex="-1"></a>      , <span class="at">by =</span> dplyr<span class="sc">::</span><span class="fu">join_by</span>(rn,pred_id)</span>
<span id="cb287-17"><a href="fusion_params_test.html#cb287-17" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb287-18"><a href="fusion_params_test.html#cb287-18" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb287-19"><a href="fusion_params_test.html#cb287-19" tabindex="-1"></a>      <span class="at">is_in_stand =</span> dplyr<span class="sc">::</span><span class="fu">coalesce</span>(is_in_stand,F)</span>
<span id="cb287-20"><a href="fusion_params_test.html#cb287-20" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb287-21"><a href="fusion_params_test.html#cb287-21" tabindex="-1"></a>    <span class="co"># get the length (diameter) and width of the polygon</span></span>
<span id="cb287-22"><a href="fusion_params_test.html#cb287-22" tabindex="-1"></a>    <span class="fu">st_bbox_by_row</span>(<span class="at">dimensions =</span> T) <span class="sc">%&gt;%</span> <span class="co"># gets shape_length, where shape_length=length of longest bbox side</span></span>
<span id="cb287-23"><a href="fusion_params_test.html#cb287-23" tabindex="-1"></a>    <span class="co"># and paraboloid volume</span></span>
<span id="cb287-24"><a href="fusion_params_test.html#cb287-24" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb287-25"><a href="fusion_params_test.html#cb287-25" tabindex="-1"></a>      <span class="co"># paraboloid_volume_m3 = (1/8) * pi * (shape_length^2) * max_height_m</span></span>
<span id="cb287-26"><a href="fusion_params_test.html#cb287-26" tabindex="-1"></a>      <span class="at">paraboloid_volume_m3 =</span> (<span class="dv">1</span><span class="sc">/</span><span class="dv">8</span>) <span class="sc">*</span> pi <span class="sc">*</span> (diameter_m<span class="sc">^</span><span class="dv">2</span>) <span class="sc">*</span> max_height_m</span>
<span id="cb287-27"><a href="fusion_params_test.html#cb287-27" tabindex="-1"></a>    )</span>
<span id="cb287-28"><a href="fusion_params_test.html#cb287-28" tabindex="-1"></a>}</span>
<span id="cb287-29"><a href="fusion_params_test.html#cb287-29" tabindex="-1"></a><span class="cf">if</span>( <span class="fu">length</span>(<span class="fu">ls</span>()[<span class="fu">grep</span>(<span class="st">&quot;param_combos_gt&quot;</span>,<span class="fu">ls</span>())])<span class="sc">!=</span><span class="dv">1</span> ){</span>
<span id="cb287-30"><a href="fusion_params_test.html#cb287-30" tabindex="-1"></a>  param_combos_gt <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(<span class="st">&quot;../data/param_combos_gt.csv&quot;</span>, <span class="at">progress =</span> F, <span class="at">show_col_types =</span> F)</span>
<span id="cb287-31"><a href="fusion_params_test.html#cb287-31" tabindex="-1"></a>}</span>
<span id="cb287-32"><a href="fusion_params_test.html#cb287-32" tabindex="-1"></a><span class="co"># param_combos_piles %&gt;% dplyr::glimpse()</span></span>
<span id="cb287-33"><a href="fusion_params_test.html#cb287-33" tabindex="-1"></a><span class="co"># param_combos_gt %&gt;% dplyr::glimpse()</span></span>
<span id="cb287-34"><a href="fusion_params_test.html#cb287-34" tabindex="-1"></a><span class="co"># param_combos_piles %&gt;% sf::st_drop_geometry() %&gt;% dplyr::count(max_ht_m)</span></span>
<span id="cb287-35"><a href="fusion_params_test.html#cb287-35" tabindex="-1"></a><span class="co"># param_combos_gt %&gt;%</span></span>
<span id="cb287-36"><a href="fusion_params_test.html#cb287-36" tabindex="-1"></a><span class="co">#   sf::st_drop_geometry() %&gt;%</span></span>
<span id="cb287-37"><a href="fusion_params_test.html#cb287-37" tabindex="-1"></a><span class="co">#   dplyr::inner_join(param_combos_df, by = &quot;rn&quot;) %&gt;%</span></span>
<span id="cb287-38"><a href="fusion_params_test.html#cb287-38" tabindex="-1"></a><span class="co">#   dplyr::distinct(rn,max_ht_m,min_area_m2,max_area_m2,convexity_pct,circle_fit_iou_pct) %&gt;% </span></span>
<span id="cb287-39"><a href="fusion_params_test.html#cb287-39" tabindex="-1"></a><span class="co">#   dplyr::count(max_ht_m)</span></span>
<span id="cb287-40"><a href="fusion_params_test.html#cb287-40" tabindex="-1"></a></span>
<span id="cb287-41"><a href="fusion_params_test.html#cb287-41" tabindex="-1"></a><span class="co"># map over our polygon_spectral_filtering and save the result</span></span>
<span id="cb287-42"><a href="fusion_params_test.html#cb287-42" tabindex="-1"></a>f_temp <span class="ot">&lt;-</span> <span class="st">&quot;../data/param_combos_spectral_gt.csv&quot;</span></span>
<span id="cb287-43"><a href="fusion_params_test.html#cb287-43" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(f_temp)){</span>
<span id="cb287-44"><a href="fusion_params_test.html#cb287-44" tabindex="-1"></a>  param_combos_spectral_gt <span class="ot">&lt;-</span> </span>
<span id="cb287-45"><a href="fusion_params_test.html#cb287-45" tabindex="-1"></a>    <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>) <span class="sc">%&gt;%</span></span>
<span id="cb287-46"><a href="fusion_params_test.html#cb287-46" tabindex="-1"></a>    purrr<span class="sc">::</span><span class="fu">map</span>(<span class="cf">function</span>(sw){</span>
<span id="cb287-47"><a href="fusion_params_test.html#cb287-47" tabindex="-1"></a>      <span class="co"># polygon_spectral_filtering</span></span>
<span id="cb287-48"><a href="fusion_params_test.html#cb287-48" tabindex="-1"></a>      param_combos_piles_filtered <span class="ot">&lt;-</span> <span class="fu">polygon_spectral_filtering</span>(</span>
<span id="cb287-49"><a href="fusion_params_test.html#cb287-49" tabindex="-1"></a>          <span class="at">sf_data =</span> param_combos_piles</span>
<span id="cb287-50"><a href="fusion_params_test.html#cb287-50" tabindex="-1"></a>          , <span class="at">rgb_rast =</span> ortho_rast</span>
<span id="cb287-51"><a href="fusion_params_test.html#cb287-51" tabindex="-1"></a>          , <span class="at">red_band_idx =</span> <span class="dv">1</span></span>
<span id="cb287-52"><a href="fusion_params_test.html#cb287-52" tabindex="-1"></a>          , <span class="at">green_band_idx =</span> <span class="dv">2</span></span>
<span id="cb287-53"><a href="fusion_params_test.html#cb287-53" tabindex="-1"></a>          , <span class="at">blue_band_idx =</span> <span class="dv">3</span></span>
<span id="cb287-54"><a href="fusion_params_test.html#cb287-54" tabindex="-1"></a>          , <span class="at">spectral_weight =</span> sw</span>
<span id="cb287-55"><a href="fusion_params_test.html#cb287-55" tabindex="-1"></a>        ) <span class="sc">%&gt;%</span></span>
<span id="cb287-56"><a href="fusion_params_test.html#cb287-56" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">spectral_weight=</span>sw)</span>
<span id="cb287-57"><a href="fusion_params_test.html#cb287-57" tabindex="-1"></a>      </span>
<span id="cb287-58"><a href="fusion_params_test.html#cb287-58" tabindex="-1"></a>      <span class="co"># dplyr::glimpse(param_combos_piles_filtered)</span></span>
<span id="cb287-59"><a href="fusion_params_test.html#cb287-59" tabindex="-1"></a>      <span class="co"># param_combos_piles_filtered %&gt;% sf::st_drop_geometry() %&gt;% dplyr::count(rn) %&gt;%  </span></span>
<span id="cb287-60"><a href="fusion_params_test.html#cb287-60" tabindex="-1"></a>      <span class="co">#   dplyr::inner_join(</span></span>
<span id="cb287-61"><a href="fusion_params_test.html#cb287-61" tabindex="-1"></a>      <span class="co">#     param_combos_piles %&gt;% sf::st_drop_geometry() %&gt;% dplyr::count(rn) %&gt;% dplyr::rename(orig_n=n)</span></span>
<span id="cb287-62"><a href="fusion_params_test.html#cb287-62" tabindex="-1"></a>      <span class="co">#   ) %&gt;% </span></span>
<span id="cb287-63"><a href="fusion_params_test.html#cb287-63" tabindex="-1"></a>      <span class="co">#   dplyr::arrange(desc(orig_n-n))</span></span>
<span id="cb287-64"><a href="fusion_params_test.html#cb287-64" tabindex="-1"></a>      </span>
<span id="cb287-65"><a href="fusion_params_test.html#cb287-65" tabindex="-1"></a>      <span class="co"># now we need to reclassify the combinations against the ground truth data</span></span>
<span id="cb287-66"><a href="fusion_params_test.html#cb287-66" tabindex="-1"></a>      gt_reclassify <span class="ot">&lt;-</span></span>
<span id="cb287-67"><a href="fusion_params_test.html#cb287-67" tabindex="-1"></a>        param_combos_gt <span class="sc">%&gt;%</span> </span>
<span id="cb287-68"><a href="fusion_params_test.html#cb287-68" tabindex="-1"></a>          <span class="co"># add info from predictions</span></span>
<span id="cb287-69"><a href="fusion_params_test.html#cb287-69" tabindex="-1"></a>          dplyr<span class="sc">::</span><span class="fu">left_join</span>(</span>
<span id="cb287-70"><a href="fusion_params_test.html#cb287-70" tabindex="-1"></a>            param_combos_piles_filtered <span class="sc">%&gt;%</span></span>
<span id="cb287-71"><a href="fusion_params_test.html#cb287-71" tabindex="-1"></a>              sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span></span>
<span id="cb287-72"><a href="fusion_params_test.html#cb287-72" tabindex="-1"></a>              dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb287-73"><a href="fusion_params_test.html#cb287-73" tabindex="-1"></a>                rn,pred_id,spectral_weight</span>
<span id="cb287-74"><a href="fusion_params_test.html#cb287-74" tabindex="-1"></a>              )</span>
<span id="cb287-75"><a href="fusion_params_test.html#cb287-75" tabindex="-1"></a>            , <span class="at">by =</span> dplyr<span class="sc">::</span><span class="fu">join_by</span>(rn,pred_id)</span>
<span id="cb287-76"><a href="fusion_params_test.html#cb287-76" tabindex="-1"></a>          ) <span class="sc">%&gt;%</span></span>
<span id="cb287-77"><a href="fusion_params_test.html#cb287-77" tabindex="-1"></a>          <span class="co"># dplyr::count(match_grp)</span></span>
<span id="cb287-78"><a href="fusion_params_test.html#cb287-78" tabindex="-1"></a>          <span class="co"># reclassify</span></span>
<span id="cb287-79"><a href="fusion_params_test.html#cb287-79" tabindex="-1"></a>          dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb287-80"><a href="fusion_params_test.html#cb287-80" tabindex="-1"></a>            <span class="co"># reclassify match_grp</span></span>
<span id="cb287-81"><a href="fusion_params_test.html#cb287-81" tabindex="-1"></a>            <span class="at">match_grp =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb287-82"><a href="fusion_params_test.html#cb287-82" tabindex="-1"></a>              match_grp <span class="sc">==</span> <span class="st">&quot;true positive&quot;</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(spectral_weight) <span class="sc">~</span> <span class="st">&quot;omission&quot;</span> <span class="co"># is.na(spectral_weight) =&gt; removed by spectral filtering</span></span>
<span id="cb287-83"><a href="fusion_params_test.html#cb287-83" tabindex="-1"></a>              , match_grp <span class="sc">==</span> <span class="st">&quot;commission&quot;</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(spectral_weight) <span class="sc">~</span> <span class="st">&quot;remove&quot;</span> <span class="co"># is.na(spectral_weight) =&gt; removed by spectral filtering</span></span>
<span id="cb287-84"><a href="fusion_params_test.html#cb287-84" tabindex="-1"></a>              , T <span class="sc">~</span> match_grp</span>
<span id="cb287-85"><a href="fusion_params_test.html#cb287-85" tabindex="-1"></a>            )</span>
<span id="cb287-86"><a href="fusion_params_test.html#cb287-86" tabindex="-1"></a>            <span class="co"># update pred_id</span></span>
<span id="cb287-87"><a href="fusion_params_test.html#cb287-87" tabindex="-1"></a>            , <span class="at">pred_id =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb287-88"><a href="fusion_params_test.html#cb287-88" tabindex="-1"></a>              match_grp <span class="sc">==</span> <span class="st">&quot;omission&quot;</span> <span class="sc">~</span> <span class="cn">NA</span></span>
<span id="cb287-89"><a href="fusion_params_test.html#cb287-89" tabindex="-1"></a>              , T <span class="sc">~</span> pred_id</span>
<span id="cb287-90"><a href="fusion_params_test.html#cb287-90" tabindex="-1"></a>            )</span>
<span id="cb287-91"><a href="fusion_params_test.html#cb287-91" tabindex="-1"></a>            <span class="co"># update spectral_weight (just adds it to this iteration&#39;s omissions)</span></span>
<span id="cb287-92"><a href="fusion_params_test.html#cb287-92" tabindex="-1"></a>            , <span class="at">spectral_weight =</span> sw</span>
<span id="cb287-93"><a href="fusion_params_test.html#cb287-93" tabindex="-1"></a>          ) <span class="sc">%&gt;%</span> </span>
<span id="cb287-94"><a href="fusion_params_test.html#cb287-94" tabindex="-1"></a>          <span class="co"># remove old commissions</span></span>
<span id="cb287-95"><a href="fusion_params_test.html#cb287-95" tabindex="-1"></a>          <span class="co"># dplyr::count(match_grp)</span></span>
<span id="cb287-96"><a href="fusion_params_test.html#cb287-96" tabindex="-1"></a>          dplyr<span class="sc">::</span><span class="fu">filter</span>(match_grp<span class="sc">!=</span><span class="st">&quot;remove&quot;</span>)</span>
<span id="cb287-97"><a href="fusion_params_test.html#cb287-97" tabindex="-1"></a>      <span class="co"># return</span></span>
<span id="cb287-98"><a href="fusion_params_test.html#cb287-98" tabindex="-1"></a>      <span class="fu">return</span>(gt_reclassify)</span>
<span id="cb287-99"><a href="fusion_params_test.html#cb287-99" tabindex="-1"></a>    }) <span class="sc">%&gt;%</span> </span>
<span id="cb287-100"><a href="fusion_params_test.html#cb287-100" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">bind_rows</span>()</span>
<span id="cb287-101"><a href="fusion_params_test.html#cb287-101" tabindex="-1"></a>  </span>
<span id="cb287-102"><a href="fusion_params_test.html#cb287-102" tabindex="-1"></a>    <span class="co"># save</span></span>
<span id="cb287-103"><a href="fusion_params_test.html#cb287-103" tabindex="-1"></a>    param_combos_spectral_gt <span class="sc">%&gt;%</span> readr<span class="sc">::</span><span class="fu">write_csv</span>(f_temp, <span class="at">append =</span> F, <span class="at">progress =</span> F)</span>
<span id="cb287-104"><a href="fusion_params_test.html#cb287-104" tabindex="-1"></a>}<span class="cf">else</span>{</span>
<span id="cb287-105"><a href="fusion_params_test.html#cb287-105" tabindex="-1"></a>  param_combos_spectral_gt <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(f_temp, <span class="at">progress =</span> F, <span class="at">show_col_types =</span> F)</span>
<span id="cb287-106"><a href="fusion_params_test.html#cb287-106" tabindex="-1"></a>}</span>
<span id="cb287-107"><a href="fusion_params_test.html#cb287-107" tabindex="-1"></a><span class="co"># what?</span></span>
<span id="cb287-108"><a href="fusion_params_test.html#cb287-108" tabindex="-1"></a>param_combos_spectral_gt <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">glimpse</span>()</span></code></pre></div>
<pre><code>## Rows: 1,177,690
## Columns: 8
## $ pile_id         &lt;dbl&gt; 102, 106, 116, 119, 135, 150, 8, 115, 108, 70, 85, 93,…
## $ i_area          &lt;dbl&gt; 9.271736, 9.578496, 8.940000, 9.053927, 9.700000, 9.10…
## $ u_area          &lt;dbl&gt; 17.557536, 16.071629, 17.305324, 14.441571, 15.479138,…
## $ iou             &lt;dbl&gt; 0.5280773, 0.5959878, 0.5166040, 0.6269351, 0.6266499,…
## $ pred_id         &lt;dbl&gt; 3799, 3944, 4378, 4003, 1941, 3141, 2602, 974, 3738, 3…
## $ match_grp       &lt;chr&gt; &quot;true positive&quot;, &quot;true positive&quot;, &quot;true positive&quot;, &quot;tr…
## $ rn              &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, …
## $ spectral_weight &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, …</code></pre>
<div class="sourceCode" id="cb289"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb289-1"><a href="fusion_params_test.html#cb289-1" tabindex="-1"></a><span class="co"># # a row in `param_combos_spectral_gt` is unique by:</span></span>
<span id="cb289-2"><a href="fusion_params_test.html#cb289-2" tabindex="-1"></a><span class="co">#   # spectral_weight, rn, pile_id, pred_id </span></span>
<span id="cb289-3"><a href="fusion_params_test.html#cb289-3" tabindex="-1"></a><span class="co">#   # where rn is a link to the `param_combos_df` table defining the </span></span>
<span id="cb289-4"><a href="fusion_params_test.html#cb289-4" tabindex="-1"></a><span class="co">#   # unique combination of parameters tested in our raster-based watershed pile detection method</span></span>
<span id="cb289-5"><a href="fusion_params_test.html#cb289-5" tabindex="-1"></a><span class="co"># identical(</span></span>
<span id="cb289-6"><a href="fusion_params_test.html#cb289-6" tabindex="-1"></a><span class="co">#   param_combos_spectral_gt %&gt;% dplyr::distinct(spectral_weight, rn, pile_id, pred_id) %&gt;% nrow()</span></span>
<span id="cb289-7"><a href="fusion_params_test.html#cb289-7" tabindex="-1"></a><span class="co">#   , nrow(param_combos_spectral_gt)</span></span>
<span id="cb289-8"><a href="fusion_params_test.html#cb289-8" tabindex="-1"></a><span class="co"># )</span></span>
<span id="cb289-9"><a href="fusion_params_test.html#cb289-9" tabindex="-1"></a><span class="co"># param_combos_spectral_gt %&gt;%</span></span>
<span id="cb289-10"><a href="fusion_params_test.html#cb289-10" tabindex="-1"></a><span class="co">#   dplyr::inner_join(param_combos_df, by = &quot;rn&quot;) %&gt;%</span></span>
<span id="cb289-11"><a href="fusion_params_test.html#cb289-11" tabindex="-1"></a><span class="co">#   sf::st_drop_geometry() %&gt;%</span></span>
<span id="cb289-12"><a href="fusion_params_test.html#cb289-12" tabindex="-1"></a><span class="co">#   dplyr::count(max_ht_m)</span></span></code></pre></div>
<p>let’s attach a flag to only work with piles that intersect with the stand boundary and add the area of the ground truth and predicted piles</p>
<div class="sourceCode" id="cb290"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb290-1"><a href="fusion_params_test.html#cb290-1" tabindex="-1"></a><span class="co"># add it to validation</span></span>
<span id="cb290-2"><a href="fusion_params_test.html#cb290-2" tabindex="-1"></a>param_combos_spectral_gt <span class="ot">&lt;-</span></span>
<span id="cb290-3"><a href="fusion_params_test.html#cb290-3" tabindex="-1"></a>  param_combos_spectral_gt <span class="sc">%&gt;%</span> </span>
<span id="cb290-4"><a href="fusion_params_test.html#cb290-4" tabindex="-1"></a>  <span class="co"># add original candidate piles from the structural watershed method with spectral_weight=0</span></span>
<span id="cb290-5"><a href="fusion_params_test.html#cb290-5" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(</span>
<span id="cb290-6"><a href="fusion_params_test.html#cb290-6" tabindex="-1"></a>    param_combos_gt <span class="sc">%&gt;%</span> </span>
<span id="cb290-7"><a href="fusion_params_test.html#cb290-7" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">spectral_weight=</span><span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb290-8"><a href="fusion_params_test.html#cb290-8" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">names</span>(param_combos_spectral_gt))</span>
<span id="cb290-9"><a href="fusion_params_test.html#cb290-9" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb290-10"><a href="fusion_params_test.html#cb290-10" tabindex="-1"></a>  <span class="co"># make a description of spectral_weight</span></span>
<span id="cb290-11"><a href="fusion_params_test.html#cb290-11" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb290-12"><a href="fusion_params_test.html#cb290-12" tabindex="-1"></a>    <span class="at">spectral_weight_desc =</span> <span class="fu">factor</span>(</span>
<span id="cb290-13"><a href="fusion_params_test.html#cb290-13" tabindex="-1"></a>      spectral_weight</span>
<span id="cb290-14"><a href="fusion_params_test.html#cb290-14" tabindex="-1"></a>      , <span class="at">ordered =</span> T</span>
<span id="cb290-15"><a href="fusion_params_test.html#cb290-15" tabindex="-1"></a>      , <span class="at">levels =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">5</span></span>
<span id="cb290-16"><a href="fusion_params_test.html#cb290-16" tabindex="-1"></a>      , <span class="at">labels =</span> <span class="fu">c</span>(</span>
<span id="cb290-17"><a href="fusion_params_test.html#cb290-17" tabindex="-1"></a>        <span class="st">&quot;no spectral criteria&quot;</span></span>
<span id="cb290-18"><a href="fusion_params_test.html#cb290-18" tabindex="-1"></a>        , <span class="st">&quot;1 spectral criteria req.&quot;</span></span>
<span id="cb290-19"><a href="fusion_params_test.html#cb290-19" tabindex="-1"></a>        , <span class="st">&quot;2 spectral criteria req.&quot;</span></span>
<span id="cb290-20"><a href="fusion_params_test.html#cb290-20" tabindex="-1"></a>        , <span class="st">&quot;3 spectral criteria req.&quot;</span></span>
<span id="cb290-21"><a href="fusion_params_test.html#cb290-21" tabindex="-1"></a>        , <span class="st">&quot;4 spectral criteria req.&quot;</span></span>
<span id="cb290-22"><a href="fusion_params_test.html#cb290-22" tabindex="-1"></a>        , <span class="st">&quot;5 spectral criteria req.&quot;</span></span>
<span id="cb290-23"><a href="fusion_params_test.html#cb290-23" tabindex="-1"></a>      )</span>
<span id="cb290-24"><a href="fusion_params_test.html#cb290-24" tabindex="-1"></a>    )</span>
<span id="cb290-25"><a href="fusion_params_test.html#cb290-25" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb290-26"><a href="fusion_params_test.html#cb290-26" tabindex="-1"></a>  <span class="co"># add area of gt</span></span>
<span id="cb290-27"><a href="fusion_params_test.html#cb290-27" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(</span>
<span id="cb290-28"><a href="fusion_params_test.html#cb290-28" tabindex="-1"></a>    slash_piles_polys <span class="sc">%&gt;%</span> </span>
<span id="cb290-29"><a href="fusion_params_test.html#cb290-29" tabindex="-1"></a>      sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb290-30"><a href="fusion_params_test.html#cb290-30" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">select</span>(pile_id,image_gt_area_m2,field_gt_area_m2,image_gt_volume_m3,field_gt_volume_m3,height_m,field_diameter_m) <span class="sc">%&gt;%</span> </span>
<span id="cb290-31"><a href="fusion_params_test.html#cb290-31" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">rename</span>(</span>
<span id="cb290-32"><a href="fusion_params_test.html#cb290-32" tabindex="-1"></a>        <span class="at">gt_height_m =</span> height_m</span>
<span id="cb290-33"><a href="fusion_params_test.html#cb290-33" tabindex="-1"></a>        , <span class="at">gt_diameter_m =</span> field_diameter_m</span>
<span id="cb290-34"><a href="fusion_params_test.html#cb290-34" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span> </span>
<span id="cb290-35"><a href="fusion_params_test.html#cb290-35" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">pile_id=</span><span class="fu">as.numeric</span>(pile_id))</span>
<span id="cb290-36"><a href="fusion_params_test.html#cb290-36" tabindex="-1"></a>    , <span class="at">by =</span> <span class="st">&quot;pile_id&quot;</span></span>
<span id="cb290-37"><a href="fusion_params_test.html#cb290-37" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb290-38"><a href="fusion_params_test.html#cb290-38" tabindex="-1"></a>  <span class="co"># add info from predictions</span></span>
<span id="cb290-39"><a href="fusion_params_test.html#cb290-39" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(</span>
<span id="cb290-40"><a href="fusion_params_test.html#cb290-40" tabindex="-1"></a>    param_combos_piles <span class="sc">%&gt;%</span></span>
<span id="cb290-41"><a href="fusion_params_test.html#cb290-41" tabindex="-1"></a>      sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span></span>
<span id="cb290-42"><a href="fusion_params_test.html#cb290-42" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb290-43"><a href="fusion_params_test.html#cb290-43" tabindex="-1"></a>        rn,pred_id</span>
<span id="cb290-44"><a href="fusion_params_test.html#cb290-44" tabindex="-1"></a>        ,is_in_stand</span>
<span id="cb290-45"><a href="fusion_params_test.html#cb290-45" tabindex="-1"></a>        , area_m2, volume_m3, max_height_m, diameter_m</span>
<span id="cb290-46"><a href="fusion_params_test.html#cb290-46" tabindex="-1"></a>        , paraboloid_volume_m3</span>
<span id="cb290-47"><a href="fusion_params_test.html#cb290-47" tabindex="-1"></a>        <span class="co"># , shape_length # , shape_width</span></span>
<span id="cb290-48"><a href="fusion_params_test.html#cb290-48" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span> </span>
<span id="cb290-49"><a href="fusion_params_test.html#cb290-49" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">rename</span>(</span>
<span id="cb290-50"><a href="fusion_params_test.html#cb290-50" tabindex="-1"></a>        <span class="at">pred_area_m2 =</span> area_m2, <span class="at">pred_volume_m3 =</span> volume_m3</span>
<span id="cb290-51"><a href="fusion_params_test.html#cb290-51" tabindex="-1"></a>        , <span class="at">pred_height_m =</span> max_height_m, <span class="at">pred_diameter_m =</span> diameter_m</span>
<span id="cb290-52"><a href="fusion_params_test.html#cb290-52" tabindex="-1"></a>        , <span class="at">pred_paraboloid_volume_m3 =</span> paraboloid_volume_m3</span>
<span id="cb290-53"><a href="fusion_params_test.html#cb290-53" tabindex="-1"></a>      )</span>
<span id="cb290-54"><a href="fusion_params_test.html#cb290-54" tabindex="-1"></a>    , <span class="at">by =</span> dplyr<span class="sc">::</span><span class="fu">join_by</span>(rn,pred_id)</span>
<span id="cb290-55"><a href="fusion_params_test.html#cb290-55" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb290-56"><a href="fusion_params_test.html#cb290-56" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb290-57"><a href="fusion_params_test.html#cb290-57" tabindex="-1"></a>    <span class="at">is_in_stand =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb290-58"><a href="fusion_params_test.html#cb290-58" tabindex="-1"></a>      is_in_stand <span class="sc">==</span> T <span class="sc">~</span> T</span>
<span id="cb290-59"><a href="fusion_params_test.html#cb290-59" tabindex="-1"></a>      , is_in_stand <span class="sc">==</span> F <span class="sc">~</span> F</span>
<span id="cb290-60"><a href="fusion_params_test.html#cb290-60" tabindex="-1"></a>      , match_grp <span class="sc">==</span> <span class="st">&quot;omission&quot;</span> <span class="sc">~</span> T</span>
<span id="cb290-61"><a href="fusion_params_test.html#cb290-61" tabindex="-1"></a>      , T <span class="sc">~</span> F</span>
<span id="cb290-62"><a href="fusion_params_test.html#cb290-62" tabindex="-1"></a>    )</span>
<span id="cb290-63"><a href="fusion_params_test.html#cb290-63" tabindex="-1"></a>    <span class="do">### calculate these based on the formulas below...agg_ground_truth_match() depends on those formulas</span></span>
<span id="cb290-64"><a href="fusion_params_test.html#cb290-64" tabindex="-1"></a>    <span class="co"># ht diffs</span></span>
<span id="cb290-65"><a href="fusion_params_test.html#cb290-65" tabindex="-1"></a>    , <span class="at">height_diff =</span> pred_height_m<span class="sc">-</span>gt_height_m</span>
<span id="cb290-66"><a href="fusion_params_test.html#cb290-66" tabindex="-1"></a>    , <span class="at">pct_diff_height =</span> (gt_height_m<span class="sc">-</span>pred_height_m)<span class="sc">/</span>gt_height_m</span>
<span id="cb290-67"><a href="fusion_params_test.html#cb290-67" tabindex="-1"></a>    <span class="co"># diameter</span></span>
<span id="cb290-68"><a href="fusion_params_test.html#cb290-68" tabindex="-1"></a>    , <span class="at">diameter_diff =</span> pred_diameter_m<span class="sc">-</span>gt_diameter_m</span>
<span id="cb290-69"><a href="fusion_params_test.html#cb290-69" tabindex="-1"></a>    , <span class="at">pct_diff_diameter =</span> (gt_diameter_m<span class="sc">-</span>pred_diameter_m)<span class="sc">/</span>gt_diameter_m</span>
<span id="cb290-70"><a href="fusion_params_test.html#cb290-70" tabindex="-1"></a>    <span class="co"># area diffs</span></span>
<span id="cb290-71"><a href="fusion_params_test.html#cb290-71" tabindex="-1"></a>    <span class="co"># , area_diff_image = pred_area_m2-image_gt_area_m2</span></span>
<span id="cb290-72"><a href="fusion_params_test.html#cb290-72" tabindex="-1"></a>    <span class="co"># , pct_diff_area_image = (image_gt_area_m2-pred_area_m2)/image_gt_area_m2</span></span>
<span id="cb290-73"><a href="fusion_params_test.html#cb290-73" tabindex="-1"></a>    , <span class="at">area_diff_field =</span> pred_area_m2<span class="sc">-</span>field_gt_area_m2</span>
<span id="cb290-74"><a href="fusion_params_test.html#cb290-74" tabindex="-1"></a>    , <span class="at">pct_diff_area_field =</span> (field_gt_area_m2<span class="sc">-</span>pred_area_m2)<span class="sc">/</span>field_gt_area_m2</span>
<span id="cb290-75"><a href="fusion_params_test.html#cb290-75" tabindex="-1"></a>    <span class="co"># volume diffs</span></span>
<span id="cb290-76"><a href="fusion_params_test.html#cb290-76" tabindex="-1"></a>    <span class="co"># , volume_diff_image = pred_volume_m3-image_gt_volume_m3</span></span>
<span id="cb290-77"><a href="fusion_params_test.html#cb290-77" tabindex="-1"></a>    <span class="co"># , pct_diff_volume_image = (image_gt_volume_m3-pred_volume_m3)/image_gt_volume_m3</span></span>
<span id="cb290-78"><a href="fusion_params_test.html#cb290-78" tabindex="-1"></a>    , <span class="at">volume_diff_field =</span> pred_volume_m3<span class="sc">-</span>field_gt_volume_m3</span>
<span id="cb290-79"><a href="fusion_params_test.html#cb290-79" tabindex="-1"></a>    , <span class="at">pct_diff_volume_field =</span> (field_gt_volume_m3<span class="sc">-</span>pred_volume_m3)<span class="sc">/</span>field_gt_volume_m3</span>
<span id="cb290-80"><a href="fusion_params_test.html#cb290-80" tabindex="-1"></a>    <span class="co"># volume diffs cone</span></span>
<span id="cb290-81"><a href="fusion_params_test.html#cb290-81" tabindex="-1"></a>    <span class="co"># # , paraboloid_volume_diff_image = pred_paraboloid_volume_m3-image_gt_volume_m3</span></span>
<span id="cb290-82"><a href="fusion_params_test.html#cb290-82" tabindex="-1"></a>    <span class="co"># , paraboloid_volume_diff_field = pred_paraboloid_volume_m3-field_gt_volume_m3</span></span>
<span id="cb290-83"><a href="fusion_params_test.html#cb290-83" tabindex="-1"></a>    <span class="co"># , pct_diff_paraboloid_volume_field = (field_gt_volume_m3-pred_paraboloid_volume_m3)/field_gt_volume_m3</span></span>
<span id="cb290-84"><a href="fusion_params_test.html#cb290-84" tabindex="-1"></a>  )</span>
<span id="cb290-85"><a href="fusion_params_test.html#cb290-85" tabindex="-1"></a><span class="co"># what?</span></span>
<span id="cb290-86"><a href="fusion_params_test.html#cb290-86" tabindex="-1"></a>param_combos_spectral_gt <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">glimpse</span>()</span>
<span id="cb290-87"><a href="fusion_params_test.html#cb290-87" tabindex="-1"></a><span class="co"># param_combos_spectral_gt %&gt;% </span></span>
<span id="cb290-88"><a href="fusion_params_test.html#cb290-88" tabindex="-1"></a><span class="co">#   dplyr::inner_join(param_combos_df, by = &quot;rn&quot;) %&gt;% </span></span>
<span id="cb290-89"><a href="fusion_params_test.html#cb290-89" tabindex="-1"></a><span class="co">#   sf::st_drop_geometry() %&gt;% </span></span>
<span id="cb290-90"><a href="fusion_params_test.html#cb290-90" tabindex="-1"></a><span class="co">#   dplyr::count(max_ht_m)</span></span></code></pre></div>
<div id="example-comparison-by-spectral-weighting" class="section level2 hasAnchor" number="8.1">
<h2><span class="header-section-number">8.1</span> Example comparison by spectral weighting<a href="fusion_params_test.html#example-comparison-by-spectral-weighting" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>let’s check out a quick plot of the slash pile prediction classification by <code>spectral_weight</code> which controls the strictness of our spectral filtering. as the <code>spectral_weight</code> parameter increases from its lowest setting (“1”, requiring only one spectral index threshold to be met) to its highest (“5”, requiring all spectral index thresholds be met), we expect a clear trade-off: commissions (false positives) should decrease while true positive matches should decrease and omissions should increase. remember, the objective of this sensitivity testing is to find the parameter combination for our rules-based slash pile detection method that best balances correctly identifying ground truth piles while minimizing incorrect positive predictions as measured by F-score to quantify overall accuracy</p>
<div class="sourceCode" id="cb291"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb291-1"><a href="fusion_params_test.html#cb291-1" tabindex="-1"></a>param_combos_spectral_gt <span class="sc">%&gt;%</span> </span>
<span id="cb291-2"><a href="fusion_params_test.html#cb291-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">count</span>(spectral_weight,spectral_weight_desc,match_grp) <span class="sc">%&gt;%</span> </span>
<span id="cb291-3"><a href="fusion_params_test.html#cb291-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(spectral_weight,spectral_weight_desc) <span class="sc">%&gt;%</span> </span>
<span id="cb291-4"><a href="fusion_params_test.html#cb291-4" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">pct =</span> n<span class="sc">/</span><span class="fu">sum</span>(n)) <span class="sc">%&gt;%</span> </span>
<span id="cb291-5"><a href="fusion_params_test.html#cb291-5" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(</span>
<span id="cb291-6"><a href="fusion_params_test.html#cb291-6" tabindex="-1"></a>    <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">y =</span> n, <span class="at">x =</span> spectral_weight_desc, <span class="at">color =</span> match_grp, <span class="at">group =</span> match_grp)</span>
<span id="cb291-7"><a href="fusion_params_test.html#cb291-7" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb291-8"><a href="fusion_params_test.html#cb291-8" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_line</span>(<span class="at">lwd =</span> <span class="fl">1.5</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb291-9"><a href="fusion_params_test.html#cb291-9" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb291-10"><a href="fusion_params_test.html#cb291-10" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_color_manual</span>(<span class="at">values =</span> pal_match_grp, <span class="at">name =</span> <span class="st">&quot;&quot;</span>, <span class="at">na.value =</span> <span class="st">&quot;red&quot;</span>) <span class="sc">+</span></span>
<span id="cb291-11"><a href="fusion_params_test.html#cb291-11" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;&quot;</span>, <span class="at">y =</span> <span class="st">&quot;&quot;</span>, <span class="at">color =</span> <span class="st">&quot;&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;&quot;</span>) <span class="sc">+</span></span>
<span id="cb291-12"><a href="fusion_params_test.html#cb291-12" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb291-13"><a href="fusion_params_test.html#cb291-13" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb291-14"><a href="fusion_params_test.html#cb291-14" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;top&quot;</span></span>
<span id="cb291-15"><a href="fusion_params_test.html#cb291-15" tabindex="-1"></a>    , <span class="at">axis.text.y =</span> ggplot2<span class="sc">::</span><span class="fu">element_blank</span>()</span>
<span id="cb291-16"><a href="fusion_params_test.html#cb291-16" tabindex="-1"></a>    , <span class="at">axis.ticks.y =</span> ggplot2<span class="sc">::</span><span class="fu">element_blank</span>()</span>
<span id="cb291-17"><a href="fusion_params_test.html#cb291-17" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb291-18"><a href="fusion_params_test.html#cb291-18" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">guides</span>(</span>
<span id="cb291-19"><a href="fusion_params_test.html#cb291-19" tabindex="-1"></a>    <span class="at">color =</span> ggplot2<span class="sc">::</span><span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">shape =</span> <span class="dv">15</span>, <span class="at">linetype =</span> <span class="dv">0</span>, <span class="at">size =</span> <span class="dv">5</span>, <span class="at">alpha =</span> <span class="dv">1</span>))</span>
<span id="cb291-20"><a href="fusion_params_test.html#cb291-20" tabindex="-1"></a>    , <span class="at">shape =</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb291-21"><a href="fusion_params_test.html#cb291-21" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-253-1.png" width="1008" /></p>
<p>the trends here are as expected. however, for this data it appears that two criteria are highly correlated since we don’t see a change in the prediction classification until we require that at least three spectral index threshold criteria are met.</p>
<p>let’s look at a single parameter combination and the difference between different levels of spectral filtering</p>
<div class="sourceCode" id="cb292"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb292-1"><a href="fusion_params_test.html#cb292-1" tabindex="-1"></a><span class="co"># plot it</span></span>
<span id="cb292-2"><a href="fusion_params_test.html#cb292-2" tabindex="-1"></a>ortho_plt_temp <span class="ot">&lt;-</span> <span class="fu">ortho_plt_fn</span>(</span>
<span id="cb292-3"><a href="fusion_params_test.html#cb292-3" tabindex="-1"></a>    <span class="at">stand =</span> stand_boundary <span class="sc">%&gt;%</span> </span>
<span id="cb292-4"><a href="fusion_params_test.html#cb292-4" tabindex="-1"></a>      sf<span class="sc">::</span><span class="fu">st_transform</span>(terra<span class="sc">::</span><span class="fu">crs</span>(ortho_rast))</span>
<span id="cb292-5"><a href="fusion_params_test.html#cb292-5" tabindex="-1"></a>    , <span class="at">buffer =</span> <span class="dv">30</span></span>
<span id="cb292-6"><a href="fusion_params_test.html#cb292-6" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb292-7"><a href="fusion_params_test.html#cb292-7" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">geom_sf</span>(</span>
<span id="cb292-8"><a href="fusion_params_test.html#cb292-8" tabindex="-1"></a>      <span class="at">data =</span> stand_boundary <span class="sc">%&gt;%</span> </span>
<span id="cb292-9"><a href="fusion_params_test.html#cb292-9" tabindex="-1"></a>        sf<span class="sc">::</span><span class="fu">st_transform</span>(terra<span class="sc">::</span><span class="fu">crs</span>(ortho_rast))</span>
<span id="cb292-10"><a href="fusion_params_test.html#cb292-10" tabindex="-1"></a>      , <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">lwd =</span> <span class="fl">1.1</span></span>
<span id="cb292-11"><a href="fusion_params_test.html#cb292-11" tabindex="-1"></a>    )</span>
<span id="cb292-12"><a href="fusion_params_test.html#cb292-12" tabindex="-1"></a><span class="co"># ortho_plt_temp</span></span>
<span id="cb292-13"><a href="fusion_params_test.html#cb292-13" tabindex="-1"></a><span class="co"># filter for one combination</span></span>
<span id="cb292-14"><a href="fusion_params_test.html#cb292-14" tabindex="-1"></a></span>
<span id="cb292-15"><a href="fusion_params_test.html#cb292-15" tabindex="-1"></a>df_temp <span class="ot">&lt;-</span> param_combos_spectral_gt <span class="sc">%&gt;%</span> </span>
<span id="cb292-16"><a href="fusion_params_test.html#cb292-16" tabindex="-1"></a>  <span class="co"># dplyr::filter(rn == unique(param_combos_spectral_gt$rn) %&gt;% sample(1))</span></span>
<span id="cb292-17"><a href="fusion_params_test.html#cb292-17" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(rn <span class="sc">==</span> <span class="dv">172</span>)</span>
<span id="cb292-18"><a href="fusion_params_test.html#cb292-18" tabindex="-1"></a></span>
<span id="cb292-19"><a href="fusion_params_test.html#cb292-19" tabindex="-1"></a><span class="co"># add piles</span></span>
<span id="cb292-20"><a href="fusion_params_test.html#cb292-20" tabindex="-1"></a>plt_list_temp <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">5</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb292-21"><a href="fusion_params_test.html#cb292-21" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">map</span>(\(x)</span>
<span id="cb292-22"><a href="fusion_params_test.html#cb292-22" tabindex="-1"></a>    ortho_plt_temp <span class="sc">+</span></span>
<span id="cb292-23"><a href="fusion_params_test.html#cb292-23" tabindex="-1"></a>      ggplot2<span class="sc">::</span><span class="fu">geom_sf</span>(</span>
<span id="cb292-24"><a href="fusion_params_test.html#cb292-24" tabindex="-1"></a>        <span class="at">data =</span> </span>
<span id="cb292-25"><a href="fusion_params_test.html#cb292-25" tabindex="-1"></a>          slash_piles_polys <span class="sc">%&gt;%</span> </span>
<span id="cb292-26"><a href="fusion_params_test.html#cb292-26" tabindex="-1"></a>          dplyr<span class="sc">::</span><span class="fu">filter</span>(is_in_stand) <span class="sc">%&gt;%</span> </span>
<span id="cb292-27"><a href="fusion_params_test.html#cb292-27" tabindex="-1"></a>          sf<span class="sc">::</span><span class="fu">st_transform</span>(terra<span class="sc">::</span><span class="fu">crs</span>(ortho_rast)) <span class="sc">%&gt;%</span> </span>
<span id="cb292-28"><a href="fusion_params_test.html#cb292-28" tabindex="-1"></a>            dplyr<span class="sc">::</span><span class="fu">left_join</span>(</span>
<span id="cb292-29"><a href="fusion_params_test.html#cb292-29" tabindex="-1"></a>              df_temp <span class="sc">%&gt;%</span> </span>
<span id="cb292-30"><a href="fusion_params_test.html#cb292-30" tabindex="-1"></a>                dplyr<span class="sc">::</span><span class="fu">filter</span>(spectral_weight<span class="sc">==</span>x) <span class="sc">%&gt;%</span></span>
<span id="cb292-31"><a href="fusion_params_test.html#cb292-31" tabindex="-1"></a>                dplyr<span class="sc">::</span><span class="fu">select</span>(pile_id,match_grp,spectral_weight_desc) <span class="sc">%&gt;%</span> </span>
<span id="cb292-32"><a href="fusion_params_test.html#cb292-32" tabindex="-1"></a>                dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">pile_id=</span><span class="fu">as.character</span>(pile_id))</span>
<span id="cb292-33"><a href="fusion_params_test.html#cb292-33" tabindex="-1"></a>              , <span class="at">by =</span> <span class="st">&quot;pile_id&quot;</span></span>
<span id="cb292-34"><a href="fusion_params_test.html#cb292-34" tabindex="-1"></a>            )</span>
<span id="cb292-35"><a href="fusion_params_test.html#cb292-35" tabindex="-1"></a>        , <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">color =</span> match_grp)</span>
<span id="cb292-36"><a href="fusion_params_test.html#cb292-36" tabindex="-1"></a>        , <span class="at">inherit.aes =</span> F</span>
<span id="cb292-37"><a href="fusion_params_test.html#cb292-37" tabindex="-1"></a>        , <span class="at">fill =</span> <span class="cn">NA</span> , <span class="at">lwd =</span> <span class="fl">0.7</span></span>
<span id="cb292-38"><a href="fusion_params_test.html#cb292-38" tabindex="-1"></a>      )<span class="sc">+</span></span>
<span id="cb292-39"><a href="fusion_params_test.html#cb292-39" tabindex="-1"></a>      ggplot2<span class="sc">::</span><span class="fu">geom_sf</span>(</span>
<span id="cb292-40"><a href="fusion_params_test.html#cb292-40" tabindex="-1"></a>        <span class="at">data =</span></span>
<span id="cb292-41"><a href="fusion_params_test.html#cb292-41" tabindex="-1"></a>          param_combos_piles <span class="sc">%&gt;%</span> </span>
<span id="cb292-42"><a href="fusion_params_test.html#cb292-42" tabindex="-1"></a>            dplyr<span class="sc">::</span><span class="fu">inner_join</span>(</span>
<span id="cb292-43"><a href="fusion_params_test.html#cb292-43" tabindex="-1"></a>              df_temp <span class="sc">%&gt;%</span></span>
<span id="cb292-44"><a href="fusion_params_test.html#cb292-44" tabindex="-1"></a>                dplyr<span class="sc">::</span><span class="fu">filter</span>(is_in_stand <span class="sc">&amp;</span> match_grp <span class="sc">==</span> <span class="st">&quot;commission&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb292-45"><a href="fusion_params_test.html#cb292-45" tabindex="-1"></a>                dplyr<span class="sc">::</span><span class="fu">filter</span>(spectral_weight<span class="sc">==</span>x) <span class="sc">%&gt;%</span></span>
<span id="cb292-46"><a href="fusion_params_test.html#cb292-46" tabindex="-1"></a>                dplyr<span class="sc">::</span><span class="fu">select</span>(pred_id,match_grp,spectral_weight_desc)</span>
<span id="cb292-47"><a href="fusion_params_test.html#cb292-47" tabindex="-1"></a>              , <span class="at">by =</span> <span class="st">&quot;pred_id&quot;</span></span>
<span id="cb292-48"><a href="fusion_params_test.html#cb292-48" tabindex="-1"></a>            )</span>
<span id="cb292-49"><a href="fusion_params_test.html#cb292-49" tabindex="-1"></a>        , <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">color =</span> match_grp)</span>
<span id="cb292-50"><a href="fusion_params_test.html#cb292-50" tabindex="-1"></a>        , <span class="at">inherit.aes =</span> F</span>
<span id="cb292-51"><a href="fusion_params_test.html#cb292-51" tabindex="-1"></a>        , <span class="at">fill =</span> <span class="cn">NA</span> , <span class="at">lwd =</span> <span class="fl">0.4</span></span>
<span id="cb292-52"><a href="fusion_params_test.html#cb292-52" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb292-53"><a href="fusion_params_test.html#cb292-53" tabindex="-1"></a>      ggplot2<span class="sc">::</span><span class="fu">scale_color_manual</span>(</span>
<span id="cb292-54"><a href="fusion_params_test.html#cb292-54" tabindex="-1"></a>        <span class="at">values =</span> <span class="fu">c</span>(</span>
<span id="cb292-55"><a href="fusion_params_test.html#cb292-55" tabindex="-1"></a>            <span class="st">&quot;omission&quot;</span><span class="ot">=</span> <span class="st">&quot;blue2&quot;</span> <span class="co"># viridis::cividis(3)[1]</span></span>
<span id="cb292-56"><a href="fusion_params_test.html#cb292-56" tabindex="-1"></a>            , <span class="st">&quot;commission&quot;</span><span class="ot">=</span> <span class="st">&quot;gray88&quot;</span> <span class="co">#viridis::cividis(3)[2]</span></span>
<span id="cb292-57"><a href="fusion_params_test.html#cb292-57" tabindex="-1"></a>            , <span class="st">&quot;true positive&quot;</span><span class="ot">=</span> <span class="st">&quot;yellow2&quot;</span> <span class="co">#viridis::cividis(3)[3]</span></span>
<span id="cb292-58"><a href="fusion_params_test.html#cb292-58" tabindex="-1"></a>          )</span>
<span id="cb292-59"><a href="fusion_params_test.html#cb292-59" tabindex="-1"></a>        , <span class="at">name =</span> <span class="st">&quot;&quot;</span></span>
<span id="cb292-60"><a href="fusion_params_test.html#cb292-60" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb292-61"><a href="fusion_params_test.html#cb292-61" tabindex="-1"></a>      ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb292-62"><a href="fusion_params_test.html#cb292-62" tabindex="-1"></a>        <span class="at">subtitle =</span> <span class="fu">levels</span>(param_combos_spectral_gt<span class="sc">$</span>spectral_weight_desc)[x<span class="sc">+</span><span class="dv">1</span>]</span>
<span id="cb292-63"><a href="fusion_params_test.html#cb292-63" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb292-64"><a href="fusion_params_test.html#cb292-64" tabindex="-1"></a>      ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb292-65"><a href="fusion_params_test.html#cb292-65" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span></span>
<span id="cb292-66"><a href="fusion_params_test.html#cb292-66" tabindex="-1"></a>        , <span class="at">plot.subtitle =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">9</span>, <span class="at">hjust =</span> <span class="fl">0.4</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb292-67"><a href="fusion_params_test.html#cb292-67" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb292-68"><a href="fusion_params_test.html#cb292-68" tabindex="-1"></a>      ggplot2<span class="sc">::</span><span class="fu">guides</span>(</span>
<span id="cb292-69"><a href="fusion_params_test.html#cb292-69" tabindex="-1"></a>        <span class="at">color =</span> ggplot2<span class="sc">::</span><span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">lwd =</span> <span class="dv">9</span>))</span>
<span id="cb292-70"><a href="fusion_params_test.html#cb292-70" tabindex="-1"></a>        , <span class="at">fill =</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb292-71"><a href="fusion_params_test.html#cb292-71" tabindex="-1"></a>      )</span>
<span id="cb292-72"><a href="fusion_params_test.html#cb292-72" tabindex="-1"></a>  )</span></code></pre></div>
<div class="sourceCode" id="cb293"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb293-1"><a href="fusion_params_test.html#cb293-1" tabindex="-1"></a>patchwork<span class="sc">::</span><span class="fu">wrap_plots</span>(</span>
<span id="cb293-2"><a href="fusion_params_test.html#cb293-2" tabindex="-1"></a>    plt_list_temp</span>
<span id="cb293-3"><a href="fusion_params_test.html#cb293-3" tabindex="-1"></a>    , <span class="at">ncol =</span> <span class="dv">2</span></span>
<span id="cb293-4"><a href="fusion_params_test.html#cb293-4" tabindex="-1"></a>    , <span class="at">guides =</span> <span class="st">&quot;collect&quot;</span></span>
<span id="cb293-5"><a href="fusion_params_test.html#cb293-5" tabindex="-1"></a>  ) <span class="sc">&amp;</span></span>
<span id="cb293-6"><a href="fusion_params_test.html#cb293-6" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-255-1.png" width="816" /></p>
<div class="sourceCode" id="cb294"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb294-1"><a href="fusion_params_test.html#cb294-1" tabindex="-1"></a><span class="co"># ggplot2::ggsave(&quot;../data/best_detect_ever_spect_index_filtered.jpeg&quot;, height = 10.5, width = 8.5)</span></span></code></pre></div>
<p>the spectral filtering performed as intended, successfully removing candidate piles that visually appear as green vegetation on the imagery and it also eliminated some candidates that appeared to be rocks or rock outcroppings, though with less success visually than for vegetation</p>
</div>
<div id="aggregate-assessment-metrics-1" class="section level2 hasAnchor" number="8.2">
<h2><span class="header-section-number">8.2</span> Aggregate assessment metrics<a href="fusion_params_test.html#aggregate-assessment-metrics-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>now we need to aggregate the single-pile-level data into a single record for each parameter combination. aggregation will calculate detection performance metrics such as F-score, precision, and recall, as well as quantification accuracy metrics including Root Mean Squared Error (RMSE), Mean Error (ME), and Mean Absolute Percentage Error (MAPE) to assess the accuracy of our pile form measurements.</p>
<p>as a reminder regarding the form quantification accuracy evaluation, we will assess the method’s accuracy by comparing the true-positive matches using the following metrics:</p>
<ul>
<li><strong>Volume</strong> compares the predicted volume from the irregular elevation profile and footprint to the ground truth paraboloid volume</li>
<li><strong>Diameter</strong> compares the predicted diameter (from the maximum internal distance) to the ground truth field-measured diameter.</li>
<li><strong>Area</strong> compares the predicted area from the irregular shape to the ground truth assumed circular area</li>
<li><strong>Height</strong> compares the predicted maximum height from the CHM to the ground truth field-measured height</li>
</ul>
<div class="sourceCode" id="cb295"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb295-1"><a href="fusion_params_test.html#cb295-1" tabindex="-1"></a><span class="co"># unique combinations</span></span>
<span id="cb295-2"><a href="fusion_params_test.html#cb295-2" tabindex="-1"></a><span class="co"># param_combos_spectral_gt %&gt;% dplyr::glimpse()</span></span>
<span id="cb295-3"><a href="fusion_params_test.html#cb295-3" tabindex="-1"></a>combo_temp <span class="ot">&lt;-</span> param_combos_spectral_gt <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">distinct</span>(rn,spectral_weight)</span>
<span id="cb295-4"><a href="fusion_params_test.html#cb295-4" tabindex="-1"></a><span class="co"># aggregate over combinations</span></span>
<span id="cb295-5"><a href="fusion_params_test.html#cb295-5" tabindex="-1"></a>param_combos_spectral_gt_agg <span class="ot">&lt;-</span> </span>
<span id="cb295-6"><a href="fusion_params_test.html#cb295-6" tabindex="-1"></a>  <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(combo_temp) <span class="sc">%&gt;%</span></span>
<span id="cb295-7"><a href="fusion_params_test.html#cb295-7" tabindex="-1"></a>  <span class="co"># 1:3 %&gt;% </span></span>
<span id="cb295-8"><a href="fusion_params_test.html#cb295-8" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">map</span>(</span>
<span id="cb295-9"><a href="fusion_params_test.html#cb295-9" tabindex="-1"></a>    \(x)</span>
<span id="cb295-10"><a href="fusion_params_test.html#cb295-10" tabindex="-1"></a>    <span class="fu">agg_ground_truth_match</span>(</span>
<span id="cb295-11"><a href="fusion_params_test.html#cb295-11" tabindex="-1"></a>      param_combos_spectral_gt <span class="sc">%&gt;%</span> </span>
<span id="cb295-12"><a href="fusion_params_test.html#cb295-12" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">filter</span>(</span>
<span id="cb295-13"><a href="fusion_params_test.html#cb295-13" tabindex="-1"></a>          is_in_stand</span>
<span id="cb295-14"><a href="fusion_params_test.html#cb295-14" tabindex="-1"></a>          <span class="sc">&amp;</span> rn <span class="sc">==</span> combo_temp<span class="sc">$</span>rn[x]</span>
<span id="cb295-15"><a href="fusion_params_test.html#cb295-15" tabindex="-1"></a>          <span class="sc">&amp;</span> spectral_weight <span class="sc">==</span> combo_temp<span class="sc">$</span>spectral_weight[x]</span>
<span id="cb295-16"><a href="fusion_params_test.html#cb295-16" tabindex="-1"></a>        )</span>
<span id="cb295-17"><a href="fusion_params_test.html#cb295-17" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb295-18"><a href="fusion_params_test.html#cb295-18" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb295-19"><a href="fusion_params_test.html#cb295-19" tabindex="-1"></a>      <span class="at">rn =</span> combo_temp<span class="sc">$</span>rn[x]</span>
<span id="cb295-20"><a href="fusion_params_test.html#cb295-20" tabindex="-1"></a>      , <span class="at">spectral_weight =</span> combo_temp<span class="sc">$</span>spectral_weight[x]</span>
<span id="cb295-21"><a href="fusion_params_test.html#cb295-21" tabindex="-1"></a>    )</span>
<span id="cb295-22"><a href="fusion_params_test.html#cb295-22" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb295-23"><a href="fusion_params_test.html#cb295-23" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">bind_rows</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb295-24"><a href="fusion_params_test.html#cb295-24" tabindex="-1"></a>  <span class="co"># add in info on all parameter combinations</span></span>
<span id="cb295-25"><a href="fusion_params_test.html#cb295-25" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">inner_join</span>(</span>
<span id="cb295-26"><a href="fusion_params_test.html#cb295-26" tabindex="-1"></a>    param_combos_df</span>
<span id="cb295-27"><a href="fusion_params_test.html#cb295-27" tabindex="-1"></a>    , <span class="at">by =</span> <span class="st">&quot;rn&quot;</span></span>
<span id="cb295-28"><a href="fusion_params_test.html#cb295-28" tabindex="-1"></a>    , <span class="at">relationship =</span> <span class="st">&quot;many-to-one&quot;</span></span>
<span id="cb295-29"><a href="fusion_params_test.html#cb295-29" tabindex="-1"></a>  )</span>
<span id="cb295-30"><a href="fusion_params_test.html#cb295-30" tabindex="-1"></a><span class="co"># param_combos_spectral_gt %&gt;%  dplyr::glimpse()</span></span>
<span id="cb295-31"><a href="fusion_params_test.html#cb295-31" tabindex="-1"></a><span class="co"># param_combos_spectral_gt_agg %&gt;% dplyr::glimpse()</span></span>
<span id="cb295-32"><a href="fusion_params_test.html#cb295-32" tabindex="-1"></a><span class="co"># we can also add the relative rmse (rrmse) by comparing the rmse to the mean value of the ground truth data</span></span>
<span id="cb295-33"><a href="fusion_params_test.html#cb295-33" tabindex="-1"></a>param_combos_spectral_gt_agg <span class="ot">&lt;-</span> param_combos_spectral_gt_agg <span class="sc">%&gt;%</span></span>
<span id="cb295-34"><a href="fusion_params_test.html#cb295-34" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">bind_cols</span>(</span>
<span id="cb295-35"><a href="fusion_params_test.html#cb295-35" tabindex="-1"></a>    <span class="co"># add means of gt</span></span>
<span id="cb295-36"><a href="fusion_params_test.html#cb295-36" tabindex="-1"></a>    slash_piles_polys <span class="sc">%&gt;%</span> </span>
<span id="cb295-37"><a href="fusion_params_test.html#cb295-37" tabindex="-1"></a>      sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb295-38"><a href="fusion_params_test.html#cb295-38" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">select</span>(image_gt_area_m2,field_gt_area_m2,image_gt_volume_m3,field_gt_volume_m3,height_m,field_diameter_m) <span class="sc">%&gt;%</span> </span>
<span id="cb295-39"><a href="fusion_params_test.html#cb295-39" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb295-40"><a href="fusion_params_test.html#cb295-40" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">summarise</span>(dplyr<span class="sc">::</span><span class="fu">across</span>(dplyr<span class="sc">::</span><span class="fu">everything</span>(), <span class="sc">~</span><span class="fu">mean</span>(.x,<span class="at">na.rm=</span>T))) <span class="sc">%&gt;%</span> </span>
<span id="cb295-41"><a href="fusion_params_test.html#cb295-41" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">rename_with</span>(<span class="sc">~</span> <span class="fu">paste0</span>(<span class="st">&quot;gt_&quot;</span>, .x, <span class="at">recycle0 =</span> <span class="cn">TRUE</span>))</span>
<span id="cb295-42"><a href="fusion_params_test.html#cb295-42" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb295-43"><a href="fusion_params_test.html#cb295-43" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb295-44"><a href="fusion_params_test.html#cb295-44" tabindex="-1"></a>    <span class="at">area_diff_field_rrmse =</span> area_diff_field_rmse<span class="sc">/</span>gt_field_gt_area_m2</span>
<span id="cb295-45"><a href="fusion_params_test.html#cb295-45" tabindex="-1"></a>    <span class="co"># , area_diff_image_rrmse = area_diff_image_rmse/gt_image_gt_area_m2</span></span>
<span id="cb295-46"><a href="fusion_params_test.html#cb295-46" tabindex="-1"></a>    , <span class="at">volume_diff_field_rrmse =</span> volume_diff_field_rmse<span class="sc">/</span>gt_field_gt_volume_m3</span>
<span id="cb295-47"><a href="fusion_params_test.html#cb295-47" tabindex="-1"></a>    <span class="co"># , volume_diff_image_rrmse = volume_diff_image_rmse/gt_image_gt_volume_m3</span></span>
<span id="cb295-48"><a href="fusion_params_test.html#cb295-48" tabindex="-1"></a>    <span class="co"># , paraboloid_volume_diff_field_rrmse = paraboloid_volume_diff_field_rmse/gt_field_gt_volume_m3</span></span>
<span id="cb295-49"><a href="fusion_params_test.html#cb295-49" tabindex="-1"></a>    <span class="co"># , paraboloid_volume_diff_image_rrmse = paraboloid_volume_diff_image_rmse/gt_image_gt_volume_m3</span></span>
<span id="cb295-50"><a href="fusion_params_test.html#cb295-50" tabindex="-1"></a>    , <span class="at">height_diff_rrmse =</span> height_diff_rmse<span class="sc">/</span>gt_height_m</span>
<span id="cb295-51"><a href="fusion_params_test.html#cb295-51" tabindex="-1"></a>    , <span class="at">diameter_diff_rrmse =</span> diameter_diff_rmse<span class="sc">/</span>gt_field_diameter_m</span>
<span id="cb295-52"><a href="fusion_params_test.html#cb295-52" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb295-53"><a href="fusion_params_test.html#cb295-53" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">!</span>tidyselect<span class="sc">::</span><span class="fu">starts_with</span>(<span class="st">&quot;gt_&quot;</span>))</span>
<span id="cb295-54"><a href="fusion_params_test.html#cb295-54" tabindex="-1"></a><span class="co"># what is this?</span></span>
<span id="cb295-55"><a href="fusion_params_test.html#cb295-55" tabindex="-1"></a>param_combos_spectral_gt_agg <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">glimpse</span>()</span></code></pre></div>
<pre><code>## Rows: 8,640
## Columns: 31
## $ tp_n                       &lt;dbl&gt; 79, 73, 65, 54, 32, 4, 79, 73, 65, 54, 32, …
## $ fp_n                       &lt;dbl&gt; 44, 32, 17, 9, 0, 0, 44, 32, 17, 9, 0, 0, 4…
## $ fn_n                       &lt;dbl&gt; 42, 48, 56, 67, 89, 117, 42, 48, 56, 67, 89…
## $ omission_rate              &lt;dbl&gt; 0.3471074, 0.3966942, 0.4628099, 0.5537190,…
## $ commission_rate            &lt;dbl&gt; 0.3577236, 0.3047619, 0.2073171, 0.1428571,…
## $ precision                  &lt;dbl&gt; 0.6422764, 0.6952381, 0.7926829, 0.8571429,…
## $ recall                     &lt;dbl&gt; 0.65289256, 0.60330579, 0.53719008, 0.44628…
## $ f_score                    &lt;dbl&gt; 0.6475410, 0.6460177, 0.6403941, 0.5869565,…
## $ area_diff_field_rmse       &lt;dbl&gt; 1.611770, 1.664736, 1.626639, 1.638681, 1.6…
## $ diameter_diff_rmse         &lt;dbl&gt; 0.7485177, 0.7525893, 0.7488925, 0.7384185,…
## $ height_diff_rmse           &lt;dbl&gt; 0.3094341, 0.3178506, 0.3062417, 0.3100133,…
## $ volume_diff_field_rmse     &lt;dbl&gt; 2.134892, 2.206145, 2.192266, 2.191718, 2.0…
## $ area_diff_field_mean       &lt;dbl&gt; 0.022080324, 0.021422253, -0.002900846, -0.…
## $ diameter_diff_mean         &lt;dbl&gt; 0.6528961, 0.6522134, 0.6509824, 0.6366149,…
## $ height_diff_mean           &lt;dbl&gt; -0.2040260, -0.2230022, -0.2209795, -0.2303…
## $ volume_diff_field_mean     &lt;dbl&gt; -0.8267348, -0.8985110, -0.8974220, -0.8900…
## $ pct_diff_area_field_mape   &lt;dbl&gt; 0.1775634, 0.1861107, 0.1824384, 0.1827844,…
## $ pct_diff_diameter_mape     &lt;dbl&gt; 0.2236866, 0.2242669, 0.2226649, 0.2205699,…
## $ pct_diff_height_mape       &lt;dbl&gt; 0.1295703, 0.1335366, 0.1332140, 0.1357417,…
## $ pct_diff_volume_field_mape &lt;dbl&gt; 0.2357586, 0.2456211, 0.2479493, 0.2558522,…
## $ rn                         &lt;dbl&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, …
## $ spectral_weight            &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1…
## $ max_ht_m                   &lt;dbl&gt; 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2…
## $ min_area_m2                &lt;dbl&gt; 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2…
## $ max_area_m2                &lt;dbl&gt; 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10,…
## $ convexity_pct              &lt;dbl&gt; 0.3, 0.3, 0.3, 0.3, 0.3, 0.3, 0.4, 0.4, 0.4…
## $ circle_fit_iou_pct         &lt;dbl&gt; 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.3, 0.4, 0.5…
## $ area_diff_field_rrmse      &lt;dbl&gt; 0.1519422, 0.1569353, 0.1533438, 0.1544791,…
## $ volume_diff_field_rrmse    &lt;dbl&gt; 0.1396832, 0.1443452, 0.1434371, 0.1434012,…
## $ height_diff_rrmse          &lt;dbl&gt; 0.1417985, 0.1456554, 0.1403356, 0.1420639,…
## $ diameter_diff_rrmse        &lt;dbl&gt; 0.2162193, 0.2173954, 0.2163276, 0.2133020,…</code></pre>
<div class="sourceCode" id="cb297"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb297-1"><a href="fusion_params_test.html#cb297-1" tabindex="-1"></a><span class="co"># param_combos_spectral_gt_agg %&gt;%</span></span>
<span id="cb297-2"><a href="fusion_params_test.html#cb297-2" tabindex="-1"></a><span class="co">#   dplyr::count(max_ht_m)</span></span>
<span id="cb297-3"><a href="fusion_params_test.html#cb297-3" tabindex="-1"></a><span class="co"># param_combos_spectral_gt_agg %&gt;% </span></span>
<span id="cb297-4"><a href="fusion_params_test.html#cb297-4" tabindex="-1"></a><span class="co">#   dplyr::distinct(</span></span>
<span id="cb297-5"><a href="fusion_params_test.html#cb297-5" tabindex="-1"></a><span class="co">#     max_ht_m, min_area_m2, max_area_m2, convexity_pct, circle_fit_iou_pct, spectral_weight</span></span>
<span id="cb297-6"><a href="fusion_params_test.html#cb297-6" tabindex="-1"></a><span class="co">#   ) %&gt;% </span></span>
<span id="cb297-7"><a href="fusion_params_test.html#cb297-7" tabindex="-1"></a><span class="co">#   dplyr::count(max_ht_m) %&gt;% </span></span>
<span id="cb297-8"><a href="fusion_params_test.html#cb297-8" tabindex="-1"></a><span class="co">#   dplyr::mutate(n2 = n/length(unique(param_combos_spectral_gt_agg$spectral_weight)))</span></span>
<span id="cb297-9"><a href="fusion_params_test.html#cb297-9" tabindex="-1"></a><span class="co"># param_combos_df %&gt;% </span></span>
<span id="cb297-10"><a href="fusion_params_test.html#cb297-10" tabindex="-1"></a><span class="co">#   dplyr::count(max_ht_m)</span></span></code></pre></div>
</div>
<div id="parameter-sensitivity-test-results-1" class="section level2 hasAnchor" number="8.3">
<h2><span class="header-section-number">8.3</span> Parameter Sensitivity Test Results<a href="fusion_params_test.html#parameter-sensitivity-test-results-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>let’s get a quick summary of the evaluation metrics across all parameter combinations</p>
<div class="sourceCode" id="cb298"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb298-1"><a href="fusion_params_test.html#cb298-1" tabindex="-1"></a><span class="co"># pal</span></span>
<span id="cb298-2"><a href="fusion_params_test.html#cb298-2" tabindex="-1"></a>pal_eval_metric <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb298-3"><a href="fusion_params_test.html#cb298-3" tabindex="-1"></a>  RColorBrewer<span class="sc">::</span><span class="fu">brewer.pal</span>(<span class="dv">3</span>,<span class="st">&quot;Oranges&quot;</span>)[<span class="dv">3</span>]</span>
<span id="cb298-4"><a href="fusion_params_test.html#cb298-4" tabindex="-1"></a>  , RColorBrewer<span class="sc">::</span><span class="fu">brewer.pal</span>(<span class="dv">3</span>,<span class="st">&quot;Greys&quot;</span>)[<span class="dv">3</span>]</span>
<span id="cb298-5"><a href="fusion_params_test.html#cb298-5" tabindex="-1"></a>  , RColorBrewer<span class="sc">::</span><span class="fu">brewer.pal</span>(<span class="dv">3</span>,<span class="st">&quot;Purples&quot;</span>)[<span class="dv">3</span>]</span>
<span id="cb298-6"><a href="fusion_params_test.html#cb298-6" tabindex="-1"></a>)</span>
<span id="cb298-7"><a href="fusion_params_test.html#cb298-7" tabindex="-1"></a><span class="co"># summary</span></span>
<span id="cb298-8"><a href="fusion_params_test.html#cb298-8" tabindex="-1"></a>param_combos_spectral_gt_agg <span class="sc">%&gt;%</span> </span>
<span id="cb298-9"><a href="fusion_params_test.html#cb298-9" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(f_score,recall,precision,tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_mape&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb298-10"><a href="fusion_params_test.html#cb298-10" tabindex="-1"></a>  <span class="fu">summary</span>()</span></code></pre></div>
<pre><code>##     f_score           recall          precision      pct_diff_area_field_mape
##  Min.   :0.0640   Min.   :0.03306   Min.   :0.2905   Min.   :0.1062          
##  1st Qu.:0.5062   1st Qu.:0.42975   1st Qu.:0.5894   1st Qu.:0.2187          
##  Median :0.6196   Median :0.65289   Median :0.7171   Median :0.2270          
##  Mean   :0.5604   Mean   :0.57943   Mean   :0.7119   Mean   :0.2220          
##  3rd Qu.:0.7070   3rd Qu.:0.81818   3rd Qu.:0.8630   3rd Qu.:0.2346          
##  Max.   :0.8193   Max.   :0.91736   Max.   :1.0000   Max.   :0.2601          
##  pct_diff_diameter_mape pct_diff_height_mape pct_diff_volume_field_mape
##  Min.   :0.1343         Min.   :0.09824      Min.   :0.1032            
##  1st Qu.:0.2377         1st Qu.:0.14032      1st Qu.:0.2825            
##  Median :0.2488         Median :0.17649      Median :0.2962            
##  Mean   :0.2431         Mean   :0.16909      Mean   :0.2913            
##  3rd Qu.:0.2557         3rd Qu.:0.19155      3rd Qu.:0.3150            
##  Max.   :0.3053         Max.   :0.20849      Max.   :0.3433</code></pre>
<div id="main-effect-of-spectral-data-pile-detection" class="section level3 hasAnchor" number="8.3.1">
<h3><span class="header-section-number">8.3.1</span> Main effect of spectral data: pile detection<a href="fusion_params_test.html#main-effect-of-spectral-data-pile-detection" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>let’s average across all other factors to look at the main effect of <code>spectral_weight</code> which controls the strictness of our spectral filtering. as the <code>spectral_weight</code> parameter increases from its lowest setting (“1”, requiring only one spectral index threshold to be met) to its highest (“5”, requiring all spectral index thresholds be met)</p>
<div class="sourceCode" id="cb300"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb300-1"><a href="fusion_params_test.html#cb300-1" tabindex="-1"></a>param_combos_spectral_gt_agg <span class="sc">%&gt;%</span> </span>
<span id="cb300-2"><a href="fusion_params_test.html#cb300-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">c</span>(spectral_weight,precision,recall,f_score)) <span class="sc">%&gt;%</span> </span>
<span id="cb300-3"><a href="fusion_params_test.html#cb300-3" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(</span>
<span id="cb300-4"><a href="fusion_params_test.html#cb300-4" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">c</span>(precision,recall,f_score)</span>
<span id="cb300-5"><a href="fusion_params_test.html#cb300-5" tabindex="-1"></a>    , <span class="at">names_to =</span> <span class="st">&quot;metric&quot;</span></span>
<span id="cb300-6"><a href="fusion_params_test.html#cb300-6" tabindex="-1"></a>    , <span class="at">values_to =</span> <span class="st">&quot;value&quot;</span></span>
<span id="cb300-7"><a href="fusion_params_test.html#cb300-7" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb300-8"><a href="fusion_params_test.html#cb300-8" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(</span>
<span id="cb300-9"><a href="fusion_params_test.html#cb300-9" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">c</span>(spectral_weight)</span>
<span id="cb300-10"><a href="fusion_params_test.html#cb300-10" tabindex="-1"></a>    , <span class="at">names_to =</span> <span class="st">&quot;param&quot;</span></span>
<span id="cb300-11"><a href="fusion_params_test.html#cb300-11" tabindex="-1"></a>    , <span class="at">values_to =</span> <span class="st">&quot;param_value&quot;</span></span>
<span id="cb300-12"><a href="fusion_params_test.html#cb300-12" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb300-13"><a href="fusion_params_test.html#cb300-13" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(param, param_value, metric) <span class="sc">%&gt;%</span></span>
<span id="cb300-14"><a href="fusion_params_test.html#cb300-14" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(</span>
<span id="cb300-15"><a href="fusion_params_test.html#cb300-15" tabindex="-1"></a>    <span class="at">median =</span> <span class="fu">median</span>(value,<span class="at">na.rm=</span>T)</span>
<span id="cb300-16"><a href="fusion_params_test.html#cb300-16" tabindex="-1"></a>    , <span class="at">q25 =</span> stats<span class="sc">::</span><span class="fu">quantile</span>(value,<span class="at">na.rm=</span>T,<span class="at">probs =</span> <span class="fl">0.25</span>)</span>
<span id="cb300-17"><a href="fusion_params_test.html#cb300-17" tabindex="-1"></a>    , <span class="at">q75 =</span> stats<span class="sc">::</span><span class="fu">quantile</span>(value,<span class="at">na.rm=</span>T,<span class="at">probs =</span> <span class="fl">0.75</span>)</span>
<span id="cb300-18"><a href="fusion_params_test.html#cb300-18" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb300-19"><a href="fusion_params_test.html#cb300-19" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb300-20"><a href="fusion_params_test.html#cb300-20" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb300-21"><a href="fusion_params_test.html#cb300-21" tabindex="-1"></a>    <span class="at">metric =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb300-22"><a href="fusion_params_test.html#cb300-22" tabindex="-1"></a>        metric <span class="sc">==</span> <span class="st">&quot;f_score&quot;</span> <span class="sc">~</span> <span class="dv">1</span></span>
<span id="cb300-23"><a href="fusion_params_test.html#cb300-23" tabindex="-1"></a>        , metric <span class="sc">==</span> <span class="st">&quot;recall&quot;</span> <span class="sc">~</span> <span class="dv">2</span></span>
<span id="cb300-24"><a href="fusion_params_test.html#cb300-24" tabindex="-1"></a>        , metric <span class="sc">==</span> <span class="st">&quot;precision&quot;</span> <span class="sc">~</span> <span class="dv">3</span></span>
<span id="cb300-25"><a href="fusion_params_test.html#cb300-25" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span> </span>
<span id="cb300-26"><a href="fusion_params_test.html#cb300-26" tabindex="-1"></a>      <span class="fu">factor</span>(</span>
<span id="cb300-27"><a href="fusion_params_test.html#cb300-27" tabindex="-1"></a>        <span class="at">ordered =</span> T</span>
<span id="cb300-28"><a href="fusion_params_test.html#cb300-28" tabindex="-1"></a>        , <span class="at">levels =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span></span>
<span id="cb300-29"><a href="fusion_params_test.html#cb300-29" tabindex="-1"></a>        , <span class="at">labels =</span> <span class="fu">c</span>(</span>
<span id="cb300-30"><a href="fusion_params_test.html#cb300-30" tabindex="-1"></a>          <span class="st">&quot;F-score&quot;</span></span>
<span id="cb300-31"><a href="fusion_params_test.html#cb300-31" tabindex="-1"></a>          , <span class="st">&quot;Recall&quot;</span></span>
<span id="cb300-32"><a href="fusion_params_test.html#cb300-32" tabindex="-1"></a>          , <span class="st">&quot;Precision&quot;</span></span>
<span id="cb300-33"><a href="fusion_params_test.html#cb300-33" tabindex="-1"></a>        )</span>
<span id="cb300-34"><a href="fusion_params_test.html#cb300-34" tabindex="-1"></a>      )</span>
<span id="cb300-35"><a href="fusion_params_test.html#cb300-35" tabindex="-1"></a>    , <span class="at">param_value =</span> <span class="fu">factor</span>(<span class="at">x =</span> param_value, <span class="at">labels =</span> <span class="fu">levels</span>(param_combos_spectral_gt<span class="sc">$</span>spectral_weight_desc))</span>
<span id="cb300-36"><a href="fusion_params_test.html#cb300-36" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb300-37"><a href="fusion_params_test.html#cb300-37" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(</span>
<span id="cb300-38"><a href="fusion_params_test.html#cb300-38" tabindex="-1"></a>    <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">y =</span> median, <span class="at">x =</span> param_value, <span class="at">color =</span> metric, <span class="at">fill =</span> metric, <span class="at">group =</span> metric, <span class="at">shape =</span> metric)</span>
<span id="cb300-39"><a href="fusion_params_test.html#cb300-39" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb300-40"><a href="fusion_params_test.html#cb300-40" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_ribbon</span>(</span>
<span id="cb300-41"><a href="fusion_params_test.html#cb300-41" tabindex="-1"></a>    <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">ymin =</span> q25, <span class="at">ymax =</span> q75)</span>
<span id="cb300-42"><a href="fusion_params_test.html#cb300-42" tabindex="-1"></a>    , <span class="at">alpha =</span> <span class="fl">0.2</span>, <span class="at">color =</span> <span class="cn">NA</span></span>
<span id="cb300-43"><a href="fusion_params_test.html#cb300-43" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb300-44"><a href="fusion_params_test.html#cb300-44" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_line</span>(<span class="at">lwd =</span> <span class="fl">1.5</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb300-45"><a href="fusion_params_test.html#cb300-45" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb300-46"><a href="fusion_params_test.html#cb300-46" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">facet_wrap</span>(<span class="at">facets =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(param), <span class="at">scales =</span> <span class="st">&quot;free_x&quot;</span>) <span class="sc">+</span></span>
<span id="cb300-47"><a href="fusion_params_test.html#cb300-47" tabindex="-1"></a>  <span class="co"># ggplot2::scale_color_viridis_d(begin = 0.2, end = 0.8) +</span></span>
<span id="cb300-48"><a href="fusion_params_test.html#cb300-48" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_fill_manual</span>(<span class="at">values =</span> pal_eval_metric) <span class="sc">+</span></span>
<span id="cb300-49"><a href="fusion_params_test.html#cb300-49" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_color_manual</span>(<span class="at">values =</span> pal_eval_metric) <span class="sc">+</span></span>
<span id="cb300-50"><a href="fusion_params_test.html#cb300-50" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">labels =</span> scales<span class="sc">::</span>percent, <span class="at">breaks =</span> scales<span class="sc">::</span><span class="fu">breaks_extended</span>(<span class="dv">10</span>)) <span class="sc">+</span></span>
<span id="cb300-51"><a href="fusion_params_test.html#cb300-51" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;&quot;</span>, <span class="at">y =</span> <span class="st">&quot;median value&quot;</span>, <span class="at">color =</span> <span class="st">&quot;&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;&quot;</span>) <span class="sc">+</span></span>
<span id="cb300-52"><a href="fusion_params_test.html#cb300-52" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb300-53"><a href="fusion_params_test.html#cb300-53" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb300-54"><a href="fusion_params_test.html#cb300-54" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;top&quot;</span></span>
<span id="cb300-55"><a href="fusion_params_test.html#cb300-55" tabindex="-1"></a>    , <span class="at">strip.text =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb300-56"><a href="fusion_params_test.html#cb300-56" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb300-57"><a href="fusion_params_test.html#cb300-57" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">guides</span>(</span>
<span id="cb300-58"><a href="fusion_params_test.html#cb300-58" tabindex="-1"></a>    <span class="at">color =</span> ggplot2<span class="sc">::</span><span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">shape =</span> <span class="dv">15</span>, <span class="at">linetype =</span> <span class="dv">0</span>, <span class="at">size =</span> <span class="dv">5</span>, <span class="at">alpha =</span> <span class="dv">1</span>))</span>
<span id="cb300-59"><a href="fusion_params_test.html#cb300-59" tabindex="-1"></a>    , <span class="at">shape =</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb300-60"><a href="fusion_params_test.html#cb300-60" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-260-1.png" width="1008" /></p>
<div class="sourceCode" id="cb301"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb301-1"><a href="fusion_params_test.html#cb301-1" tabindex="-1"></a>ggplot2<span class="sc">::</span><span class="fu">ggsave</span>(<span class="st">&quot;../data/best_pile_detect_test.jpeg&quot;</span>, <span class="at">height =</span> <span class="dv">8</span>, <span class="at">width =</span> <span class="dv">8</span>)</span></code></pre></div>
<p>based on these main effect aggregated results:</p>
<ul>
<li>increasing the <code>spectral_weight</code> (where “5” requires all spectral index thresholds to be met) had minimal impact on metrics until a value of “3”, at which point F-score and precision both saw slight improvements. at a <code>spectral_weight</code> of “4”, the F-score significantly improved due to a substantial increase in precision. setting <code>spectral_weight</code> to “5” resulted in a significant drop in recall (detection rate) and a proportionally inverse increase in precision, leading to only a minor overall change in F-score.</li>
</ul>
</div>
<div id="main-effect-of-spectral-data-form-quantification" class="section level3 hasAnchor" number="8.3.2">
<h3><span class="header-section-number">8.3.2</span> Main effect of spectral data: form quantification<a href="fusion_params_test.html#main-effect-of-spectral-data-form-quantification" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>let’s average across all other factors to look at the main effect by parameter for the <strong>MAPE</strong> metrics quantifying the pile form accuracy</p>
<div class="sourceCode" id="cb302"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb302-1"><a href="fusion_params_test.html#cb302-1" tabindex="-1"></a>param_combos_spectral_gt_agg <span class="sc">%&gt;%</span> </span>
<span id="cb302-2"><a href="fusion_params_test.html#cb302-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb302-3"><a href="fusion_params_test.html#cb302-3" tabindex="-1"></a>    spectral_weight</span>
<span id="cb302-4"><a href="fusion_params_test.html#cb302-4" tabindex="-1"></a>    , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_mape&quot;</span>)</span>
<span id="cb302-5"><a href="fusion_params_test.html#cb302-5" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb302-6"><a href="fusion_params_test.html#cb302-6" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(</span>
<span id="cb302-7"><a href="fusion_params_test.html#cb302-7" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">c</span>(tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_mape&quot;</span>))</span>
<span id="cb302-8"><a href="fusion_params_test.html#cb302-8" tabindex="-1"></a>    , <span class="at">names_to =</span> <span class="st">&quot;metric&quot;</span></span>
<span id="cb302-9"><a href="fusion_params_test.html#cb302-9" tabindex="-1"></a>    , <span class="at">values_to =</span> <span class="st">&quot;value&quot;</span></span>
<span id="cb302-10"><a href="fusion_params_test.html#cb302-10" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb302-11"><a href="fusion_params_test.html#cb302-11" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(</span>
<span id="cb302-12"><a href="fusion_params_test.html#cb302-12" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">c</span>(spectral_weight)</span>
<span id="cb302-13"><a href="fusion_params_test.html#cb302-13" tabindex="-1"></a>    , <span class="at">names_to =</span> <span class="st">&quot;param&quot;</span></span>
<span id="cb302-14"><a href="fusion_params_test.html#cb302-14" tabindex="-1"></a>    , <span class="at">values_to =</span> <span class="st">&quot;param_value&quot;</span></span>
<span id="cb302-15"><a href="fusion_params_test.html#cb302-15" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb302-16"><a href="fusion_params_test.html#cb302-16" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(param, param_value, metric) <span class="sc">%&gt;%</span></span>
<span id="cb302-17"><a href="fusion_params_test.html#cb302-17" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(</span>
<span id="cb302-18"><a href="fusion_params_test.html#cb302-18" tabindex="-1"></a>    <span class="at">median =</span> <span class="fu">median</span>(value,<span class="at">na.rm=</span>T)</span>
<span id="cb302-19"><a href="fusion_params_test.html#cb302-19" tabindex="-1"></a>    , <span class="at">q25 =</span> stats<span class="sc">::</span><span class="fu">quantile</span>(value,<span class="at">na.rm=</span>T,<span class="at">probs =</span> <span class="fl">0.25</span>)</span>
<span id="cb302-20"><a href="fusion_params_test.html#cb302-20" tabindex="-1"></a>    , <span class="at">q75 =</span> stats<span class="sc">::</span><span class="fu">quantile</span>(value,<span class="at">na.rm=</span>T,<span class="at">probs =</span> <span class="fl">0.75</span>)</span>
<span id="cb302-21"><a href="fusion_params_test.html#cb302-21" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb302-22"><a href="fusion_params_test.html#cb302-22" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb302-23"><a href="fusion_params_test.html#cb302-23" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb302-24"><a href="fusion_params_test.html#cb302-24" tabindex="-1"></a>    <span class="at">metric =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb302-25"><a href="fusion_params_test.html#cb302-25" tabindex="-1"></a>        metric <span class="sc">==</span> <span class="st">&quot;f_score&quot;</span> <span class="sc">~</span> <span class="dv">1</span></span>
<span id="cb302-26"><a href="fusion_params_test.html#cb302-26" tabindex="-1"></a>        , metric <span class="sc">==</span> <span class="st">&quot;recall&quot;</span> <span class="sc">~</span> <span class="dv">2</span></span>
<span id="cb302-27"><a href="fusion_params_test.html#cb302-27" tabindex="-1"></a>        , metric <span class="sc">==</span> <span class="st">&quot;precision&quot;</span> <span class="sc">~</span> <span class="dv">3</span></span>
<span id="cb302-28"><a href="fusion_params_test.html#cb302-28" tabindex="-1"></a>        <span class="co"># rmse</span></span>
<span id="cb302-29"><a href="fusion_params_test.html#cb302-29" tabindex="-1"></a>        , metric <span class="sc">==</span> <span class="st">&quot;pct_diff_volume_field_mape&quot;</span> <span class="sc">~</span> <span class="dv">4</span></span>
<span id="cb302-30"><a href="fusion_params_test.html#cb302-30" tabindex="-1"></a>        , metric <span class="sc">==</span> <span class="st">&quot;pct_diff_paraboloid_volume_field_mape&quot;</span> <span class="sc">~</span> <span class="dv">5</span></span>
<span id="cb302-31"><a href="fusion_params_test.html#cb302-31" tabindex="-1"></a>        , metric <span class="sc">==</span> <span class="st">&quot;pct_diff_area_field_mape&quot;</span> <span class="sc">~</span> <span class="dv">6</span></span>
<span id="cb302-32"><a href="fusion_params_test.html#cb302-32" tabindex="-1"></a>        , metric <span class="sc">==</span> <span class="st">&quot;pct_diff_height_mape&quot;</span> <span class="sc">~</span> <span class="dv">7</span></span>
<span id="cb302-33"><a href="fusion_params_test.html#cb302-33" tabindex="-1"></a>        , metric <span class="sc">==</span> <span class="st">&quot;pct_diff_diameter_mape&quot;</span> <span class="sc">~</span> <span class="dv">8</span></span>
<span id="cb302-34"><a href="fusion_params_test.html#cb302-34" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span> </span>
<span id="cb302-35"><a href="fusion_params_test.html#cb302-35" tabindex="-1"></a>      <span class="fu">factor</span>(</span>
<span id="cb302-36"><a href="fusion_params_test.html#cb302-36" tabindex="-1"></a>        <span class="at">ordered =</span> T</span>
<span id="cb302-37"><a href="fusion_params_test.html#cb302-37" tabindex="-1"></a>        , <span class="at">levels =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">8</span></span>
<span id="cb302-38"><a href="fusion_params_test.html#cb302-38" tabindex="-1"></a>        , <span class="at">labels =</span> <span class="fu">c</span>(</span>
<span id="cb302-39"><a href="fusion_params_test.html#cb302-39" tabindex="-1"></a>          <span class="st">&quot;F-score&quot;</span></span>
<span id="cb302-40"><a href="fusion_params_test.html#cb302-40" tabindex="-1"></a>          , <span class="st">&quot;Recall&quot;</span></span>
<span id="cb302-41"><a href="fusion_params_test.html#cb302-41" tabindex="-1"></a>          , <span class="st">&quot;Precision&quot;</span></span>
<span id="cb302-42"><a href="fusion_params_test.html#cb302-42" tabindex="-1"></a>          , <span class="st">&quot;MAPE: Volume irregular (%)&quot;</span></span>
<span id="cb302-43"><a href="fusion_params_test.html#cb302-43" tabindex="-1"></a>          , <span class="st">&quot;MAPE: Volume paraboloid (%)&quot;</span></span>
<span id="cb302-44"><a href="fusion_params_test.html#cb302-44" tabindex="-1"></a>          , <span class="st">&quot;MAPE: Area (%)&quot;</span></span>
<span id="cb302-45"><a href="fusion_params_test.html#cb302-45" tabindex="-1"></a>          , <span class="st">&quot;MAPE: Height (%)&quot;</span></span>
<span id="cb302-46"><a href="fusion_params_test.html#cb302-46" tabindex="-1"></a>          , <span class="st">&quot;MAPE: Diameter (%)&quot;</span></span>
<span id="cb302-47"><a href="fusion_params_test.html#cb302-47" tabindex="-1"></a>        )</span>
<span id="cb302-48"><a href="fusion_params_test.html#cb302-48" tabindex="-1"></a>      )</span>
<span id="cb302-49"><a href="fusion_params_test.html#cb302-49" tabindex="-1"></a>    , <span class="at">param_value =</span> <span class="fu">factor</span>(<span class="at">x =</span> param_value, <span class="at">labels =</span> <span class="fu">levels</span>(param_combos_spectral_gt<span class="sc">$</span>spectral_weight_desc))</span>
<span id="cb302-50"><a href="fusion_params_test.html#cb302-50" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb302-51"><a href="fusion_params_test.html#cb302-51" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(</span>
<span id="cb302-52"><a href="fusion_params_test.html#cb302-52" tabindex="-1"></a>    <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">y =</span> median, <span class="at">x =</span> param_value, <span class="at">color =</span> metric, <span class="at">fill =</span> metric, <span class="at">group =</span> metric, <span class="at">shape =</span> metric)</span>
<span id="cb302-53"><a href="fusion_params_test.html#cb302-53" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb302-54"><a href="fusion_params_test.html#cb302-54" tabindex="-1"></a>  <span class="co"># ggplot2::geom_ribbon(</span></span>
<span id="cb302-55"><a href="fusion_params_test.html#cb302-55" tabindex="-1"></a>  <span class="co">#   mapping = ggplot2::aes(ymin = q25, ymax = q75)</span></span>
<span id="cb302-56"><a href="fusion_params_test.html#cb302-56" tabindex="-1"></a>  <span class="co">#   , alpha = 0.2, color = NA</span></span>
<span id="cb302-57"><a href="fusion_params_test.html#cb302-57" tabindex="-1"></a>  <span class="co"># ) +</span></span>
<span id="cb302-58"><a href="fusion_params_test.html#cb302-58" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_line</span>(<span class="at">lwd =</span> <span class="fl">1.5</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb302-59"><a href="fusion_params_test.html#cb302-59" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb302-60"><a href="fusion_params_test.html#cb302-60" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">facet_wrap</span>(<span class="at">facets =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(param), <span class="at">scales =</span> <span class="st">&quot;free_x&quot;</span>) <span class="sc">+</span></span>
<span id="cb302-61"><a href="fusion_params_test.html#cb302-61" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_fill_viridis_d</span>(<span class="at">option =</span> <span class="st">&quot;turbo&quot;</span>) <span class="sc">+</span></span>
<span id="cb302-62"><a href="fusion_params_test.html#cb302-62" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_color_viridis_d</span>(<span class="at">option =</span> <span class="st">&quot;turbo&quot;</span>) <span class="sc">+</span></span>
<span id="cb302-63"><a href="fusion_params_test.html#cb302-63" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_shape_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="dv">15</span>,<span class="dv">16</span>,<span class="dv">17</span>,<span class="dv">18</span>,<span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb302-64"><a href="fusion_params_test.html#cb302-64" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">labels =</span> scales<span class="sc">::</span>percent, <span class="at">breaks =</span> scales<span class="sc">::</span><span class="fu">breaks_extended</span>(<span class="dv">10</span>)) <span class="sc">+</span></span>
<span id="cb302-65"><a href="fusion_params_test.html#cb302-65" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;&quot;</span>, <span class="at">y =</span> <span class="st">&quot;median value&quot;</span>, <span class="at">color =</span> <span class="st">&quot;&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;&quot;</span>) <span class="sc">+</span></span>
<span id="cb302-66"><a href="fusion_params_test.html#cb302-66" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb302-67"><a href="fusion_params_test.html#cb302-67" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb302-68"><a href="fusion_params_test.html#cb302-68" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;top&quot;</span></span>
<span id="cb302-69"><a href="fusion_params_test.html#cb302-69" tabindex="-1"></a>    , <span class="at">strip.text =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb302-70"><a href="fusion_params_test.html#cb302-70" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb302-71"><a href="fusion_params_test.html#cb302-71" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">guides</span>(</span>
<span id="cb302-72"><a href="fusion_params_test.html#cb302-72" tabindex="-1"></a>    <span class="at">color =</span> ggplot2<span class="sc">::</span><span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">shape =</span> <span class="dv">15</span>, <span class="at">linetype =</span> <span class="dv">0</span>, <span class="at">size =</span> <span class="dv">5</span>, <span class="at">alpha =</span> <span class="dv">1</span>))</span>
<span id="cb302-73"><a href="fusion_params_test.html#cb302-73" tabindex="-1"></a>    , <span class="at">shape =</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb302-74"><a href="fusion_params_test.html#cb302-74" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-261-1.png" width="1008" /></p>
<p>these results indicate that the method’s accuracy in outlining slash pile form is robust to parameter changes, as the relevant shape accuracy metrics remain consistent across various settings of the <code>spectral_weight</code> parameter</p>
</div>
<div id="overall-pile-detection-1" class="section level3 hasAnchor" number="8.3.3">
<h3><span class="header-section-number">8.3.3</span> Overall: pile detection<a href="fusion_params_test.html#overall-pile-detection-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>let’s check out the distribution of the instance segmentation (i.e. pile detection) results by looking at the detection accuracy metrics where:</p>
<ul>
<li><strong>Precision</strong> precision measures how many of the objects our method detected as slash piles were actually correct. A high precision means the method has a low rate of false alarms.</li>
<li><strong>Recall</strong> recall (i.e. detection rate) indicates how many actual (ground truth) slash piles our method successfully identified. High recall means the method is good at finding most existing piles, minimizing omissions.</li>
<li><strong>F-score</strong> provides a single, balanced measure that combines both precision and recall. A high F-score indicates overall effectiveness in both finding most piles and ensuring most detections are correct.</li>
</ul>
<div class="sourceCode" id="cb303"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb303-1"><a href="fusion_params_test.html#cb303-1" tabindex="-1"></a><span class="co"># plot it</span></span>
<span id="cb303-2"><a href="fusion_params_test.html#cb303-2" tabindex="-1"></a><span class="fu">plt_detection_dist</span>(</span>
<span id="cb303-3"><a href="fusion_params_test.html#cb303-3" tabindex="-1"></a>  <span class="at">df =</span> param_combos_spectral_gt_agg</span>
<span id="cb303-4"><a href="fusion_params_test.html#cb303-4" tabindex="-1"></a>  , <span class="fu">paste0</span>(</span>
<span id="cb303-5"><a href="fusion_params_test.html#cb303-5" tabindex="-1"></a>     <span class="st">&quot;distribution of pile detection accuracy metrics for all&quot;</span></span>
<span id="cb303-6"><a href="fusion_params_test.html#cb303-6" tabindex="-1"></a>     , <span class="st">&quot; (n=&quot;</span></span>
<span id="cb303-7"><a href="fusion_params_test.html#cb303-7" tabindex="-1"></a>     , scales<span class="sc">::</span><span class="fu">comma</span>(<span class="fu">nrow</span>(param_combos_spectral_gt_agg), <span class="at">accuracy =</span> <span class="dv">1</span>)</span>
<span id="cb303-8"><a href="fusion_params_test.html#cb303-8" tabindex="-1"></a>     , <span class="st">&quot;) &quot;</span></span>
<span id="cb303-9"><a href="fusion_params_test.html#cb303-9" tabindex="-1"></a>     , <span class="st">&quot;parameter combinations tested&quot;</span></span>
<span id="cb303-10"><a href="fusion_params_test.html#cb303-10" tabindex="-1"></a>    )</span>
<span id="cb303-11"><a href="fusion_params_test.html#cb303-11" tabindex="-1"></a>  , <span class="at">show_rug =</span> F</span>
<span id="cb303-12"><a href="fusion_params_test.html#cb303-12" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-262-1.png" width="1008" /></p>
</div>
<div id="overall-form-quantification-1" class="section level3 hasAnchor" number="8.3.4">
<h3><span class="header-section-number">8.3.4</span> Overall: form quantification<a href="fusion_params_test.html#overall-form-quantification-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>let’s check out the the ability of the method to properly extract the form of the piles by looking at the quantification accuracy metrics where:</p>
<ul>
<li><strong>Mean Error (ME)</strong> represents the direction of bias (over or under-prediction) in the original units</li>
<li><strong>RMSE</strong> represents the typical magnitude of error in the original units, with a stronger penalty for large errors</li>
<li><strong>MAPE</strong> represents the typical magnitude of error as a percentage, allowing for scale-independent comparisons</li>
</ul>
<p>as a reminder regarding the form quantification accuracy evaluation, we will assess the method’s accuracy by comparing the true-positive matches using the following metrics:</p>
<ul>
<li><strong>Volume</strong> compares the predicted volume from the irregular elevation profile and footprint to the ground truth paraboloid volume</li>
<li><strong>Diameter</strong> compares the predicted diameter (from the maximum internal distance) to the ground truth field-measured diameter.</li>
<li><strong>Area</strong> compares the predicted area from the irregular shape to the ground truth assumed circular area</li>
<li><strong>Height</strong> compares the predicted maximum height from the CHM to the ground truth field-measured height</li>
</ul>
<div class="sourceCode" id="cb304"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb304-1"><a href="fusion_params_test.html#cb304-1" tabindex="-1"></a><span class="co"># plot it</span></span>
<span id="cb304-2"><a href="fusion_params_test.html#cb304-2" tabindex="-1"></a><span class="fu">plt_form_quantification_dist</span>(</span>
<span id="cb304-3"><a href="fusion_params_test.html#cb304-3" tabindex="-1"></a>  <span class="at">df =</span> param_combos_spectral_gt_agg <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">slice_sample</span>(<span class="at">prop =</span> <span class="fl">0.3</span>)</span>
<span id="cb304-4"><a href="fusion_params_test.html#cb304-4" tabindex="-1"></a>  , <span class="fu">paste0</span>(</span>
<span id="cb304-5"><a href="fusion_params_test.html#cb304-5" tabindex="-1"></a>     <span class="st">&quot;distribution of pile form quantification accuracy metrics for all&quot;</span></span>
<span id="cb304-6"><a href="fusion_params_test.html#cb304-6" tabindex="-1"></a>     , <span class="st">&quot; (n=&quot;</span></span>
<span id="cb304-7"><a href="fusion_params_test.html#cb304-7" tabindex="-1"></a>     , scales<span class="sc">::</span><span class="fu">comma</span>(<span class="fu">nrow</span>(param_combos_spectral_gt_agg), <span class="at">accuracy =</span> <span class="dv">1</span>)</span>
<span id="cb304-8"><a href="fusion_params_test.html#cb304-8" tabindex="-1"></a>     , <span class="st">&quot;) &quot;</span></span>
<span id="cb304-9"><a href="fusion_params_test.html#cb304-9" tabindex="-1"></a>     , <span class="st">&quot;parameter combinations tested&quot;</span></span>
<span id="cb304-10"><a href="fusion_params_test.html#cb304-10" tabindex="-1"></a>  )</span>
<span id="cb304-11"><a href="fusion_params_test.html#cb304-11" tabindex="-1"></a>  , <span class="at">show_rug =</span> F</span>
<span id="cb304-12"><a href="fusion_params_test.html#cb304-12" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-263-1.png" width="1008" /></p>
</div>
<div id="best-results-detection-accuracy-1" class="section level3 hasAnchor" number="8.3.5">
<h3><span class="header-section-number">8.3.5</span> Best results: detection accuracy<a href="fusion_params_test.html#best-results-detection-accuracy-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>we can cut to the chase and just look at the parameter combinations that achieved the best results based on the evaluation metrics</p>
<div class="sourceCode" id="cb305"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb305-1"><a href="fusion_params_test.html#cb305-1" tabindex="-1"></a>rank_th_temp <span class="ot">&lt;-</span> <span class="dv">12</span></span>
<span id="cb305-2"><a href="fusion_params_test.html#cb305-2" tabindex="-1"></a>df_temp <span class="ot">&lt;-</span></span>
<span id="cb305-3"><a href="fusion_params_test.html#cb305-3" tabindex="-1"></a>  param_combos_spectral_gt_agg <span class="sc">%&gt;%</span> </span>
<span id="cb305-4"><a href="fusion_params_test.html#cb305-4" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb305-5"><a href="fusion_params_test.html#cb305-5" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(<span class="fu">desc</span>(f_score)) <span class="sc">%&gt;%</span> </span>
<span id="cb305-6"><a href="fusion_params_test.html#cb305-6" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb305-7"><a href="fusion_params_test.html#cb305-7" tabindex="-1"></a>    <span class="at">rank_f_score =</span> dplyr<span class="sc">::</span><span class="fu">row_number</span>()</span>
<span id="cb305-8"><a href="fusion_params_test.html#cb305-8" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb305-9"><a href="fusion_params_test.html#cb305-9" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(<span class="fu">desc</span>(precision)) <span class="sc">%&gt;%</span> </span>
<span id="cb305-10"><a href="fusion_params_test.html#cb305-10" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb305-11"><a href="fusion_params_test.html#cb305-11" tabindex="-1"></a>    <span class="at">rank_precision =</span> dplyr<span class="sc">::</span><span class="fu">row_number</span>()</span>
<span id="cb305-12"><a href="fusion_params_test.html#cb305-12" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb305-13"><a href="fusion_params_test.html#cb305-13" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(<span class="fu">desc</span>(recall)) <span class="sc">%&gt;%</span> </span>
<span id="cb305-14"><a href="fusion_params_test.html#cb305-14" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb305-15"><a href="fusion_params_test.html#cb305-15" tabindex="-1"></a>    <span class="at">rank_recall =</span> dplyr<span class="sc">::</span><span class="fu">row_number</span>()</span>
<span id="cb305-16"><a href="fusion_params_test.html#cb305-16" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb305-17"><a href="fusion_params_test.html#cb305-17" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(<span class="fu">desc</span>(f_score), <span class="fu">desc</span>(recall), <span class="fu">desc</span>(precision)) <span class="sc">%&gt;%</span> </span>
<span id="cb305-18"><a href="fusion_params_test.html#cb305-18" tabindex="-1"></a>  <span class="co"># now get the max of these pct ranks by row</span></span>
<span id="cb305-19"><a href="fusion_params_test.html#cb305-19" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rowwise</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb305-20"><a href="fusion_params_test.html#cb305-20" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb305-21"><a href="fusion_params_test.html#cb305-21" tabindex="-1"></a>    <span class="at">rank_min =</span> <span class="fu">min</span>(</span>
<span id="cb305-22"><a href="fusion_params_test.html#cb305-22" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">c_across</span>(</span>
<span id="cb305-23"><a href="fusion_params_test.html#cb305-23" tabindex="-1"></a>        tidyselect<span class="sc">::</span><span class="fu">starts_with</span>(<span class="st">&quot;rank&quot;</span>)</span>
<span id="cb305-24"><a href="fusion_params_test.html#cb305-24" tabindex="-1"></a>      )</span>
<span id="cb305-25"><a href="fusion_params_test.html#cb305-25" tabindex="-1"></a>      , <span class="at">na.rm =</span> T</span>
<span id="cb305-26"><a href="fusion_params_test.html#cb305-26" tabindex="-1"></a>    )</span>
<span id="cb305-27"><a href="fusion_params_test.html#cb305-27" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb305-28"><a href="fusion_params_test.html#cb305-28" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb305-29"><a href="fusion_params_test.html#cb305-29" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb305-30"><a href="fusion_params_test.html#cb305-30" tabindex="-1"></a>    <span class="at">rank_lab =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb305-31"><a href="fusion_params_test.html#cb305-31" tabindex="-1"></a>      rank_f_score<span class="sc">&lt;=</span>rank_th_temp <span class="sc">~</span> <span class="dv">1</span></span>
<span id="cb305-32"><a href="fusion_params_test.html#cb305-32" tabindex="-1"></a>      , rank_recall<span class="sc">&lt;=</span>rank_th_temp <span class="sc">~</span> <span class="dv">2</span></span>
<span id="cb305-33"><a href="fusion_params_test.html#cb305-33" tabindex="-1"></a>      , rank_precision<span class="sc">&lt;=</span>rank_th_temp <span class="sc">~</span> <span class="dv">3</span></span>
<span id="cb305-34"><a href="fusion_params_test.html#cb305-34" tabindex="-1"></a>      , (rank_f_score<span class="sc">&gt;=</span>(<span class="fu">nrow</span>(param_combos_spectral_gt_agg)<span class="sc">-</span>rank_th_temp) <span class="sc">&amp;</span> dplyr<span class="sc">::</span><span class="fu">coalesce</span>(f_score,<span class="dv">0</span>)<span class="sc">&gt;</span><span class="dv">0</span>) <span class="sc">~</span> <span class="dv">4</span></span>
<span id="cb305-35"><a href="fusion_params_test.html#cb305-35" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb305-36"><a href="fusion_params_test.html#cb305-36" tabindex="-1"></a>      <span class="fu">factor</span>(</span>
<span id="cb305-37"><a href="fusion_params_test.html#cb305-37" tabindex="-1"></a>        <span class="at">ordered =</span> T</span>
<span id="cb305-38"><a href="fusion_params_test.html#cb305-38" tabindex="-1"></a>        , <span class="at">levels =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span></span>
<span id="cb305-39"><a href="fusion_params_test.html#cb305-39" tabindex="-1"></a>        , <span class="at">labels =</span> <span class="fu">c</span>(</span>
<span id="cb305-40"><a href="fusion_params_test.html#cb305-40" tabindex="-1"></a>          <span class="fu">paste0</span>(<span class="st">&quot;top &quot;</span>, scales<span class="sc">::</span><span class="fu">comma</span>(rank_th_temp, <span class="at">accuracy =</span> <span class="dv">1</span>), <span class="st">&quot; F-score&quot;</span>)</span>
<span id="cb305-41"><a href="fusion_params_test.html#cb305-41" tabindex="-1"></a>          , <span class="fu">paste0</span>(<span class="st">&quot;top &quot;</span>, scales<span class="sc">::</span><span class="fu">comma</span>(rank_th_temp, <span class="at">accuracy =</span> <span class="dv">1</span>), <span class="st">&quot; Recall&quot;</span>)</span>
<span id="cb305-42"><a href="fusion_params_test.html#cb305-42" tabindex="-1"></a>          , <span class="fu">paste0</span>(<span class="st">&quot;top &quot;</span>, scales<span class="sc">::</span><span class="fu">comma</span>(rank_th_temp, <span class="at">accuracy =</span> <span class="dv">1</span>), <span class="st">&quot; Precision&quot;</span>)</span>
<span id="cb305-43"><a href="fusion_params_test.html#cb305-43" tabindex="-1"></a>          , <span class="fu">paste0</span>(<span class="st">&quot;bottom &quot;</span>, scales<span class="sc">::</span><span class="fu">comma</span>(rank_th_temp, <span class="at">accuracy =</span> <span class="dv">1</span>), <span class="st">&quot; F-score&quot;</span>)</span>
<span id="cb305-44"><a href="fusion_params_test.html#cb305-44" tabindex="-1"></a>        )</span>
<span id="cb305-45"><a href="fusion_params_test.html#cb305-45" tabindex="-1"></a>      )</span>
<span id="cb305-46"><a href="fusion_params_test.html#cb305-46" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb305-47"><a href="fusion_params_test.html#cb305-47" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(</span>
<span id="cb305-48"><a href="fusion_params_test.html#cb305-48" tabindex="-1"></a>    <span class="sc">!</span><span class="fu">is.na</span>(rank_lab) <span class="co"># rank_min&gt;=0.99</span></span>
<span id="cb305-49"><a href="fusion_params_test.html#cb305-49" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb305-50"><a href="fusion_params_test.html#cb305-50" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb305-51"><a href="fusion_params_test.html#cb305-51" tabindex="-1"></a>    <span class="at">lab =</span> stringr<span class="sc">::</span><span class="fu">str_c</span>(max_ht_m,max_area_m2,convexity_pct,circle_fit_iou_pct,spectral_weight, <span class="at">sep =</span> <span class="st">&quot;:&quot;</span>)</span>
<span id="cb305-52"><a href="fusion_params_test.html#cb305-52" tabindex="-1"></a>  ) </span>
<span id="cb305-53"><a href="fusion_params_test.html#cb305-53" tabindex="-1"></a><span class="co"># plot</span></span>
<span id="cb305-54"><a href="fusion_params_test.html#cb305-54" tabindex="-1"></a>df_temp <span class="sc">%&gt;%</span> </span>
<span id="cb305-55"><a href="fusion_params_test.html#cb305-55" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span>stringr<span class="sc">::</span><span class="fu">str_starts</span>(rank_lab, <span class="st">&quot;bottom&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb305-56"><a href="fusion_params_test.html#cb305-56" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(</span>
<span id="cb305-57"><a href="fusion_params_test.html#cb305-57" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">c</span>(precision,recall,f_score)</span>
<span id="cb305-58"><a href="fusion_params_test.html#cb305-58" tabindex="-1"></a>    , <span class="at">names_to =</span> <span class="st">&quot;metric&quot;</span></span>
<span id="cb305-59"><a href="fusion_params_test.html#cb305-59" tabindex="-1"></a>    , <span class="at">values_to =</span> <span class="st">&quot;value&quot;</span></span>
<span id="cb305-60"><a href="fusion_params_test.html#cb305-60" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb305-61"><a href="fusion_params_test.html#cb305-61" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb305-62"><a href="fusion_params_test.html#cb305-62" tabindex="-1"></a>    <span class="at">metric =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb305-63"><a href="fusion_params_test.html#cb305-63" tabindex="-1"></a>        metric <span class="sc">==</span> <span class="st">&quot;f_score&quot;</span> <span class="sc">~</span> <span class="dv">1</span></span>
<span id="cb305-64"><a href="fusion_params_test.html#cb305-64" tabindex="-1"></a>        , metric <span class="sc">==</span> <span class="st">&quot;recall&quot;</span> <span class="sc">~</span> <span class="dv">2</span></span>
<span id="cb305-65"><a href="fusion_params_test.html#cb305-65" tabindex="-1"></a>        , metric <span class="sc">==</span> <span class="st">&quot;precision&quot;</span> <span class="sc">~</span> <span class="dv">3</span></span>
<span id="cb305-66"><a href="fusion_params_test.html#cb305-66" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span> </span>
<span id="cb305-67"><a href="fusion_params_test.html#cb305-67" tabindex="-1"></a>      <span class="fu">factor</span>(</span>
<span id="cb305-68"><a href="fusion_params_test.html#cb305-68" tabindex="-1"></a>        <span class="at">ordered =</span> T</span>
<span id="cb305-69"><a href="fusion_params_test.html#cb305-69" tabindex="-1"></a>        , <span class="at">levels =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span></span>
<span id="cb305-70"><a href="fusion_params_test.html#cb305-70" tabindex="-1"></a>        , <span class="at">labels =</span> <span class="fu">c</span>(</span>
<span id="cb305-71"><a href="fusion_params_test.html#cb305-71" tabindex="-1"></a>          <span class="st">&quot;F-score&quot;</span></span>
<span id="cb305-72"><a href="fusion_params_test.html#cb305-72" tabindex="-1"></a>          , <span class="st">&quot;Recall&quot;</span></span>
<span id="cb305-73"><a href="fusion_params_test.html#cb305-73" tabindex="-1"></a>          , <span class="st">&quot;Precision&quot;</span></span>
<span id="cb305-74"><a href="fusion_params_test.html#cb305-74" tabindex="-1"></a>        )</span>
<span id="cb305-75"><a href="fusion_params_test.html#cb305-75" tabindex="-1"></a>      )</span>
<span id="cb305-76"><a href="fusion_params_test.html#cb305-76" tabindex="-1"></a>    , <span class="at">lab =</span> forcats<span class="sc">::</span><span class="fu">fct_reorder</span>(lab, <span class="fu">desc</span>(rank_f_score))</span>
<span id="cb305-77"><a href="fusion_params_test.html#cb305-77" tabindex="-1"></a>    , <span class="at">val_lab =</span> scales<span class="sc">::</span><span class="fu">percent</span>(value, <span class="at">accuracy =</span> <span class="fl">0.1</span>)</span>
<span id="cb305-78"><a href="fusion_params_test.html#cb305-78" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb305-79"><a href="fusion_params_test.html#cb305-79" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(</span>
<span id="cb305-80"><a href="fusion_params_test.html#cb305-80" tabindex="-1"></a>    <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">y =</span> lab, <span class="at">fill =</span> metric, <span class="at">label =</span> val_lab)</span>
<span id="cb305-81"><a href="fusion_params_test.html#cb305-81" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb305-82"><a href="fusion_params_test.html#cb305-82" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_col</span>(<span class="at">width =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb305-83"><a href="fusion_params_test.html#cb305-83" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_text</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">size =</span> <span class="dv">2</span>, <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb305-84"><a href="fusion_params_test.html#cb305-84" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_fill_manual</span>(<span class="at">values =</span> pal_eval_metric) <span class="sc">+</span></span>
<span id="cb305-85"><a href="fusion_params_test.html#cb305-85" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_x_continuous</span>(</span>
<span id="cb305-86"><a href="fusion_params_test.html#cb305-86" tabindex="-1"></a>    <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">percent_format</span>(<span class="at">accuracy =</span> <span class="dv">1</span>)</span>
<span id="cb305-87"><a href="fusion_params_test.html#cb305-87" tabindex="-1"></a>    , <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">1.05</span>)</span>
<span id="cb305-88"><a href="fusion_params_test.html#cb305-88" tabindex="-1"></a>    <span class="co"># , expand = expansion(mult = c(0, .08))</span></span>
<span id="cb305-89"><a href="fusion_params_test.html#cb305-89" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb305-90"><a href="fusion_params_test.html#cb305-90" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">facet_grid</span>(<span class="at">cols =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(metric), <span class="at">rows =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(rank_lab), <span class="at">scales =</span> <span class="st">&quot;free_y&quot;</span>) <span class="sc">+</span></span>
<span id="cb305-91"><a href="fusion_params_test.html#cb305-91" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb305-92"><a href="fusion_params_test.html#cb305-92" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;&quot;</span>, <span class="at">y =</span> <span class="st">&quot;max_ht_m : max_area_m2 : convexity_pct : circle_fit_iou_pct : spectral_weight&quot;</span></span>
<span id="cb305-93"><a href="fusion_params_test.html#cb305-93" tabindex="-1"></a>    , <span class="at">fill =</span> <span class="st">&quot;&quot;</span></span>
<span id="cb305-94"><a href="fusion_params_test.html#cb305-94" tabindex="-1"></a>    , <span class="at">subtitle =</span> <span class="st">&quot;top parameter combinations by evaluation metrics&quot;</span></span>
<span id="cb305-95"><a href="fusion_params_test.html#cb305-95" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb305-96"><a href="fusion_params_test.html#cb305-96" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb305-97"><a href="fusion_params_test.html#cb305-97" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb305-98"><a href="fusion_params_test.html#cb305-98" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb305-99"><a href="fusion_params_test.html#cb305-99" tabindex="-1"></a>    , <span class="at">strip.text =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb305-100"><a href="fusion_params_test.html#cb305-100" tabindex="-1"></a>    , <span class="at">axis.text =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="fl">6.2</span>)</span>
<span id="cb305-101"><a href="fusion_params_test.html#cb305-101" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-265-1.png" width="1008" /></p>
<p>let’s make a table of these results</p>
<div class="sourceCode" id="cb306"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb306-1"><a href="fusion_params_test.html#cb306-1" tabindex="-1"></a>df_temp <span class="sc">%&gt;%</span> </span>
<span id="cb306-2"><a href="fusion_params_test.html#cb306-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(rank_min<span class="sc">&lt;=</span>rank_th_temp) <span class="sc">%&gt;%</span> </span>
<span id="cb306-3"><a href="fusion_params_test.html#cb306-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb306-4"><a href="fusion_params_test.html#cb306-4" tabindex="-1"></a>    rank_lab</span>
<span id="cb306-5"><a href="fusion_params_test.html#cb306-5" tabindex="-1"></a>    , max_ht_m,max_area_m2,convexity_pct,circle_fit_iou_pct,spectral_weight</span>
<span id="cb306-6"><a href="fusion_params_test.html#cb306-6" tabindex="-1"></a>    , f_score, recall, precision</span>
<span id="cb306-7"><a href="fusion_params_test.html#cb306-7" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb306-8"><a href="fusion_params_test.html#cb306-8" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb306-9"><a href="fusion_params_test.html#cb306-9" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(rank_lab,<span class="fu">desc</span>(f_score), <span class="fu">desc</span>(recall), <span class="fu">desc</span>(precision)) <span class="sc">%&gt;%</span> </span>
<span id="cb306-10"><a href="fusion_params_test.html#cb306-10" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(dplyr<span class="sc">::</span><span class="fu">across</span>(</span>
<span id="cb306-11"><a href="fusion_params_test.html#cb306-11" tabindex="-1"></a>    <span class="at">.cols =</span> <span class="fu">c</span>(f_score, recall, precision)</span>
<span id="cb306-12"><a href="fusion_params_test.html#cb306-12" tabindex="-1"></a>    , <span class="at">.fn =</span> <span class="sc">~</span> scales<span class="sc">::</span><span class="fu">percent</span>(.x, <span class="at">accuracy =</span> <span class="dv">1</span>)</span>
<span id="cb306-13"><a href="fusion_params_test.html#cb306-13" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb306-14"><a href="fusion_params_test.html#cb306-14" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">blank=</span> <span class="st">&quot;   &quot;</span> ) <span class="sc">%&gt;%</span> </span>
<span id="cb306-15"><a href="fusion_params_test.html#cb306-15" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">relocate</span>(blank, <span class="at">.before =</span> f_score) <span class="sc">%&gt;%</span> </span>
<span id="cb306-16"><a href="fusion_params_test.html#cb306-16" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kbl</span>(</span>
<span id="cb306-17"><a href="fusion_params_test.html#cb306-17" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">&quot;parameter combinations that achieved the best slash pile detection results&quot;</span></span>
<span id="cb306-18"><a href="fusion_params_test.html#cb306-18" tabindex="-1"></a>    , <span class="at">col.names =</span> <span class="fu">c</span>(</span>
<span id="cb306-19"><a href="fusion_params_test.html#cb306-19" tabindex="-1"></a>      <span class="st">&quot;.&quot;</span></span>
<span id="cb306-20"><a href="fusion_params_test.html#cb306-20" tabindex="-1"></a>      ,<span class="st">&quot;max_ht_m&quot;</span>,<span class="st">&quot;max_area_m2&quot;</span>,<span class="st">&quot;convexity_pct&quot;</span>,<span class="st">&quot;circle_fit_iou_pct&quot;</span>,<span class="st">&quot;spectral_weight&quot;</span></span>
<span id="cb306-21"><a href="fusion_params_test.html#cb306-21" tabindex="-1"></a>      , <span class="st">&quot;   &quot;</span></span>
<span id="cb306-22"><a href="fusion_params_test.html#cb306-22" tabindex="-1"></a>      , <span class="st">&quot;F-score&quot;</span>, <span class="st">&quot;Recall&quot;</span>, <span class="st">&quot;Precision&quot;</span></span>
<span id="cb306-23"><a href="fusion_params_test.html#cb306-23" tabindex="-1"></a>    )</span>
<span id="cb306-24"><a href="fusion_params_test.html#cb306-24" tabindex="-1"></a>    , <span class="at">escape =</span> F</span>
<span id="cb306-25"><a href="fusion_params_test.html#cb306-25" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb306-26"><a href="fusion_params_test.html#cb306-26" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kable_styling</span>(<span class="at">font_size =</span> <span class="fl">10.5</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb306-27"><a href="fusion_params_test.html#cb306-27" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">collapse_rows</span>(<span class="at">columns =</span> <span class="dv">1</span>, <span class="at">valign =</span> <span class="st">&quot;top&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb306-28"><a href="fusion_params_test.html#cb306-28" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">add_header_above</span>(<span class="fu">c</span>(<span class="st">&quot; &quot;</span><span class="ot">=</span><span class="dv">7</span>, <span class="st">&quot;Evaluation Metric&quot;</span> <span class="ot">=</span> <span class="dv">3</span>))</span></code></pre></div>
<table class="table" style="font-size: 10.5px; margin-left: auto; margin-right: auto;">
<caption style="font-size: initial !important;">
<span id="tab:unnamed-chunk-266">Table 8.1: </span>parameter combinations that achieved the best slash pile detection results
</caption>
<thead>
<tr>
<th style="empty-cells: hide;border-bottom:hidden;" colspan="7">
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="3">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Evaluation Metric
</div>
</th>
</tr>
<tr>
<th style="text-align:left;">
.
</th>
<th style="text-align:right;">
max_ht_m
</th>
<th style="text-align:right;">
max_area_m2
</th>
<th style="text-align:right;">
convexity_pct
</th>
<th style="text-align:right;">
circle_fit_iou_pct
</th>
<th style="text-align:right;">
spectral_weight
</th>
<th style="text-align:left;">
</th>
<th style="text-align:left;">
F-score
</th>
<th style="text-align:left;">
Recall
</th>
<th style="text-align:left;">
Precision
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="12">
top 12 F-score
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
40
</td>
<td style="text-align:right;">
0.6
</td>
<td style="text-align:right;">
0.3
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
82%
</td>
<td style="text-align:left;">
84%
</td>
<td style="text-align:left;">
80%
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
50
</td>
<td style="text-align:right;">
0.6
</td>
<td style="text-align:right;">
0.3
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
82%
</td>
<td style="text-align:left;">
84%
</td>
<td style="text-align:left;">
80%
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
60
</td>
<td style="text-align:right;">
0.6
</td>
<td style="text-align:right;">
0.3
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
82%
</td>
<td style="text-align:left;">
84%
</td>
<td style="text-align:left;">
80%
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
70
</td>
<td style="text-align:right;">
0.6
</td>
<td style="text-align:right;">
0.3
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
82%
</td>
<td style="text-align:left;">
84%
</td>
<td style="text-align:left;">
80%
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
80
</td>
<td style="text-align:right;">
0.6
</td>
<td style="text-align:right;">
0.3
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
82%
</td>
<td style="text-align:left;">
84%
</td>
<td style="text-align:left;">
80%
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
90
</td>
<td style="text-align:right;">
0.6
</td>
<td style="text-align:right;">
0.3
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
82%
</td>
<td style="text-align:left;">
84%
</td>
<td style="text-align:left;">
80%
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
100
</td>
<td style="text-align:right;">
0.6
</td>
<td style="text-align:right;">
0.3
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
82%
</td>
<td style="text-align:left;">
84%
</td>
<td style="text-align:left;">
80%
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
50
</td>
<td style="text-align:right;">
0.3
</td>
<td style="text-align:right;">
0.4
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
82%
</td>
<td style="text-align:left;">
90%
</td>
<td style="text-align:left;">
75%
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
50
</td>
<td style="text-align:right;">
0.4
</td>
<td style="text-align:right;">
0.4
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
82%
</td>
<td style="text-align:left;">
90%
</td>
<td style="text-align:left;">
75%
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
50
</td>
<td style="text-align:right;">
0.5
</td>
<td style="text-align:right;">
0.4
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
82%
</td>
<td style="text-align:left;">
90%
</td>
<td style="text-align:left;">
75%
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
50
</td>
<td style="text-align:right;">
0.6
</td>
<td style="text-align:right;">
0.4
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
82%
</td>
<td style="text-align:left;">
90%
</td>
<td style="text-align:left;">
75%
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
50
</td>
<td style="text-align:right;">
0.7
</td>
<td style="text-align:right;">
0.4
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
82%
</td>
<td style="text-align:left;">
90%
</td>
<td style="text-align:left;">
75%
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="12">
top 12 Recall
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
50
</td>
<td style="text-align:right;">
0.7
</td>
<td style="text-align:right;">
0.3
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
80%
</td>
<td style="text-align:left;">
92%
</td>
<td style="text-align:left;">
71%
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
60
</td>
<td style="text-align:right;">
0.7
</td>
<td style="text-align:right;">
0.3
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
80%
</td>
<td style="text-align:left;">
92%
</td>
<td style="text-align:left;">
71%
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
70
</td>
<td style="text-align:right;">
0.7
</td>
<td style="text-align:right;">
0.3
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
80%
</td>
<td style="text-align:left;">
92%
</td>
<td style="text-align:left;">
71%
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
80
</td>
<td style="text-align:right;">
0.7
</td>
<td style="text-align:right;">
0.3
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
80%
</td>
<td style="text-align:left;">
92%
</td>
<td style="text-align:left;">
71%
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
90
</td>
<td style="text-align:right;">
0.7
</td>
<td style="text-align:right;">
0.3
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
80%
</td>
<td style="text-align:left;">
92%
</td>
<td style="text-align:left;">
71%
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
100
</td>
<td style="text-align:right;">
0.7
</td>
<td style="text-align:right;">
0.3
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
80%
</td>
<td style="text-align:left;">
92%
</td>
<td style="text-align:left;">
71%
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
50
</td>
<td style="text-align:right;">
0.6
</td>
<td style="text-align:right;">
0.3
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
80%
</td>
<td style="text-align:left;">
92%
</td>
<td style="text-align:left;">
70%
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
60
</td>
<td style="text-align:right;">
0.6
</td>
<td style="text-align:right;">
0.3
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
80%
</td>
<td style="text-align:left;">
92%
</td>
<td style="text-align:left;">
70%
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
70
</td>
<td style="text-align:right;">
0.6
</td>
<td style="text-align:right;">
0.3
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
80%
</td>
<td style="text-align:left;">
92%
</td>
<td style="text-align:left;">
70%
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
80
</td>
<td style="text-align:right;">
0.6
</td>
<td style="text-align:right;">
0.3
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
80%
</td>
<td style="text-align:left;">
92%
</td>
<td style="text-align:left;">
70%
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
90
</td>
<td style="text-align:right;">
0.6
</td>
<td style="text-align:right;">
0.3
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
80%
</td>
<td style="text-align:left;">
92%
</td>
<td style="text-align:left;">
70%
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
100
</td>
<td style="text-align:right;">
0.6
</td>
<td style="text-align:right;">
0.3
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
80%
</td>
<td style="text-align:left;">
92%
</td>
<td style="text-align:left;">
70%
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="12">
top 12 Precision
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
20
</td>
<td style="text-align:right;">
0.3
</td>
<td style="text-align:right;">
0.7
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
51%
</td>
<td style="text-align:left;">
34%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
20
</td>
<td style="text-align:right;">
0.4
</td>
<td style="text-align:right;">
0.7
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
51%
</td>
<td style="text-align:left;">
34%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
20
</td>
<td style="text-align:right;">
0.5
</td>
<td style="text-align:right;">
0.7
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
51%
</td>
<td style="text-align:left;">
34%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
20
</td>
<td style="text-align:right;">
0.6
</td>
<td style="text-align:right;">
0.7
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
51%
</td>
<td style="text-align:left;">
34%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
20
</td>
<td style="text-align:right;">
0.7
</td>
<td style="text-align:right;">
0.7
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
51%
</td>
<td style="text-align:left;">
34%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
30
</td>
<td style="text-align:right;">
0.3
</td>
<td style="text-align:right;">
0.7
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
51%
</td>
<td style="text-align:left;">
34%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
30
</td>
<td style="text-align:right;">
0.4
</td>
<td style="text-align:right;">
0.7
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
51%
</td>
<td style="text-align:left;">
34%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
30
</td>
<td style="text-align:right;">
0.5
</td>
<td style="text-align:right;">
0.7
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
51%
</td>
<td style="text-align:left;">
34%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
30
</td>
<td style="text-align:right;">
0.6
</td>
<td style="text-align:right;">
0.7
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
51%
</td>
<td style="text-align:left;">
34%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
30
</td>
<td style="text-align:right;">
0.7
</td>
<td style="text-align:right;">
0.7
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
51%
</td>
<td style="text-align:left;">
34%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
40
</td>
<td style="text-align:right;">
0.3
</td>
<td style="text-align:right;">
0.7
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
51%
</td>
<td style="text-align:left;">
34%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
40
</td>
<td style="text-align:right;">
0.4
</td>
<td style="text-align:right;">
0.7
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
51%
</td>
<td style="text-align:left;">
34%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
</tbody>
</table>
<p>let’s look at only the top 5% of parameter combinations by F-score</p>
<div class="sourceCode" id="cb307"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb307-1"><a href="fusion_params_test.html#cb307-1" tabindex="-1"></a><span class="co"># filter parameter combos for top x pct</span></span>
<span id="cb307-2"><a href="fusion_params_test.html#cb307-2" tabindex="-1"></a>top_x_pct_fscore <span class="ot">&lt;-</span> </span>
<span id="cb307-3"><a href="fusion_params_test.html#cb307-3" tabindex="-1"></a>  param_combos_spectral_gt_agg <span class="sc">%&gt;%</span> </span>
<span id="cb307-4"><a href="fusion_params_test.html#cb307-4" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb307-5"><a href="fusion_params_test.html#cb307-5" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">arrange</span>(<span class="fu">desc</span>(f_score)) <span class="sc">%&gt;%</span> </span>
<span id="cb307-6"><a href="fusion_params_test.html#cb307-6" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb307-7"><a href="fusion_params_test.html#cb307-7" tabindex="-1"></a>      <span class="at">pct_rank_f_score =</span> dplyr<span class="sc">::</span><span class="fu">percent_rank</span>(f_score)</span>
<span id="cb307-8"><a href="fusion_params_test.html#cb307-8" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb307-9"><a href="fusion_params_test.html#cb307-9" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(pct_rank_f_score<span class="sc">&gt;=</span>pct_rank_th_top)</span>
<span id="cb307-10"><a href="fusion_params_test.html#cb307-10" tabindex="-1"></a><span class="co"># plot it</span></span>
<span id="cb307-11"><a href="fusion_params_test.html#cb307-11" tabindex="-1"></a><span class="fu">plt_detection_dist</span>(</span>
<span id="cb307-12"><a href="fusion_params_test.html#cb307-12" tabindex="-1"></a>  <span class="at">df =</span> top_x_pct_fscore</span>
<span id="cb307-13"><a href="fusion_params_test.html#cb307-13" tabindex="-1"></a>  , <span class="fu">paste0</span>(</span>
<span id="cb307-14"><a href="fusion_params_test.html#cb307-14" tabindex="-1"></a>     <span class="st">&quot;distribution of evaluation metrics for top &quot;</span></span>
<span id="cb307-15"><a href="fusion_params_test.html#cb307-15" tabindex="-1"></a>     , scales<span class="sc">::</span><span class="fu">percent</span>(<span class="dv">1</span><span class="sc">-</span>pct_rank_th_top,<span class="at">accuracy=</span><span class="dv">1</span>)</span>
<span id="cb307-16"><a href="fusion_params_test.html#cb307-16" tabindex="-1"></a>     , <span class="st">&quot; (n=&quot;</span></span>
<span id="cb307-17"><a href="fusion_params_test.html#cb307-17" tabindex="-1"></a>     , scales<span class="sc">::</span><span class="fu">comma</span>(<span class="fu">nrow</span>(top_x_pct_fscore), <span class="at">accuracy =</span> <span class="dv">1</span>)</span>
<span id="cb307-18"><a href="fusion_params_test.html#cb307-18" tabindex="-1"></a>     , <span class="st">&quot;) &quot;</span></span>
<span id="cb307-19"><a href="fusion_params_test.html#cb307-19" tabindex="-1"></a>     , <span class="st">&quot;of parameter combinations by F-score using structural+spectral data&quot;</span></span>
<span id="cb307-20"><a href="fusion_params_test.html#cb307-20" tabindex="-1"></a>  )</span>
<span id="cb307-21"><a href="fusion_params_test.html#cb307-21" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-268-1.png" width="1008" /></p>
<p>if we look at only the top 5% of parameter combinations by F-score, what is the distribution of individual parameter settings?</p>
<div class="sourceCode" id="cb308"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb308-1"><a href="fusion_params_test.html#cb308-1" tabindex="-1"></a>pal_param <span class="ot">&lt;-</span> viridis<span class="sc">::</span><span class="fu">plasma</span>(<span class="at">n=</span><span class="dv">5</span>, <span class="at">begin =</span> <span class="fl">0.1</span>, <span class="at">end =</span> <span class="fl">0.9</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>)</span>
<span id="cb308-2"><a href="fusion_params_test.html#cb308-2" tabindex="-1"></a>df_temp <span class="ot">&lt;-</span> top_x_pct_fscore <span class="sc">%&gt;%</span></span>
<span id="cb308-3"><a href="fusion_params_test.html#cb308-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;f_score&quot;</span>), max_ht_m,max_area_m2,convexity_pct,circle_fit_iou_pct,spectral_weight) <span class="sc">%&gt;%</span> </span>
<span id="cb308-4"><a href="fusion_params_test.html#cb308-4" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(</span>
<span id="cb308-5"><a href="fusion_params_test.html#cb308-5" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">c</span>(max_ht_m,max_area_m2,convexity_pct,circle_fit_iou_pct,spectral_weight)</span>
<span id="cb308-6"><a href="fusion_params_test.html#cb308-6" tabindex="-1"></a>    , <span class="at">names_to =</span> <span class="st">&quot;metric&quot;</span></span>
<span id="cb308-7"><a href="fusion_params_test.html#cb308-7" tabindex="-1"></a>    , <span class="at">values_to =</span> <span class="st">&quot;value&quot;</span></span>
<span id="cb308-8"><a href="fusion_params_test.html#cb308-8" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb308-9"><a href="fusion_params_test.html#cb308-9" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">count</span>(metric, value) <span class="sc">%&gt;%</span> </span>
<span id="cb308-10"><a href="fusion_params_test.html#cb308-10" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(metric) <span class="sc">%&gt;%</span> </span>
<span id="cb308-11"><a href="fusion_params_test.html#cb308-11" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb308-12"><a href="fusion_params_test.html#cb308-12" tabindex="-1"></a>    <span class="at">pct=</span>n<span class="sc">/</span><span class="fu">sum</span>(n)</span>
<span id="cb308-13"><a href="fusion_params_test.html#cb308-13" tabindex="-1"></a>    , <span class="at">lab =</span> <span class="fu">paste0</span>(scales<span class="sc">::</span><span class="fu">percent</span>(pct,<span class="at">accuracy=</span><span class="fl">0.1</span>), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">n=&quot;</span>, scales<span class="sc">::</span><span class="fu">comma</span>(n,<span class="at">accuracy=</span><span class="dv">1</span>))</span>
<span id="cb308-14"><a href="fusion_params_test.html#cb308-14" tabindex="-1"></a>  )</span>
<span id="cb308-15"><a href="fusion_params_test.html#cb308-15" tabindex="-1"></a><span class="co"># save best for later</span></span>
<span id="cb308-16"><a href="fusion_params_test.html#cb308-16" tabindex="-1"></a>best_spectral_weight <span class="ot">&lt;-</span> df_temp <span class="sc">%&gt;%</span> </span>
<span id="cb308-17"><a href="fusion_params_test.html#cb308-17" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(metric<span class="sc">==</span><span class="st">&quot;spectral_weight&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb308-18"><a href="fusion_params_test.html#cb308-18" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(<span class="fu">desc</span>(n)) <span class="sc">%&gt;%</span> </span>
<span id="cb308-19"><a href="fusion_params_test.html#cb308-19" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">slice</span>(<span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb308-20"><a href="fusion_params_test.html#cb308-20" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">pull</span>(value)</span>
<span id="cb308-21"><a href="fusion_params_test.html#cb308-21" tabindex="-1"></a><span class="co"># plot</span></span>
<span id="cb308-22"><a href="fusion_params_test.html#cb308-22" tabindex="-1"></a>df_temp <span class="sc">%&gt;%</span> </span>
<span id="cb308-23"><a href="fusion_params_test.html#cb308-23" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(</span>
<span id="cb308-24"><a href="fusion_params_test.html#cb308-24" tabindex="-1"></a>    <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">factor</span>(value), <span class="at">y=</span>pct, <span class="at">label=</span>lab, <span class="at">fill =</span> metric)</span>
<span id="cb308-25"><a href="fusion_params_test.html#cb308-25" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb308-26"><a href="fusion_params_test.html#cb308-26" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_col</span>(<span class="at">width =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb308-27"><a href="fusion_params_test.html#cb308-27" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_text</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">size =</span> <span class="fl">2.5</span>, <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb308-28"><a href="fusion_params_test.html#cb308-28" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">facet_wrap</span>(<span class="at">facets =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(metric), <span class="at">ncol=</span><span class="dv">2</span>, <span class="at">scales =</span> <span class="st">&quot;free_x&quot;</span>) <span class="sc">+</span></span>
<span id="cb308-29"><a href="fusion_params_test.html#cb308-29" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_y_continuous</span>(</span>
<span id="cb308-30"><a href="fusion_params_test.html#cb308-30" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="at">by=</span><span class="fl">0.2</span>)</span>
<span id="cb308-31"><a href="fusion_params_test.html#cb308-31" tabindex="-1"></a>    , <span class="at">labels =</span> scales<span class="sc">::</span>percent</span>
<span id="cb308-32"><a href="fusion_params_test.html#cb308-32" tabindex="-1"></a>    , <span class="at">expand =</span> ggplot2<span class="sc">::</span><span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">0.2</span>))</span>
<span id="cb308-33"><a href="fusion_params_test.html#cb308-33" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb308-34"><a href="fusion_params_test.html#cb308-34" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_fill_manual</span>(<span class="at">values =</span> pal_param) <span class="sc">+</span></span>
<span id="cb308-35"><a href="fusion_params_test.html#cb308-35" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb308-36"><a href="fusion_params_test.html#cb308-36" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;parameter setting&quot;</span>, <span class="at">y =</span> <span class="st">&quot;&quot;</span></span>
<span id="cb308-37"><a href="fusion_params_test.html#cb308-37" tabindex="-1"></a>    , <span class="at">fill =</span> <span class="st">&quot;&quot;</span></span>
<span id="cb308-38"><a href="fusion_params_test.html#cb308-38" tabindex="-1"></a>    , <span class="at">subtitle =</span> <span class="fu">paste0</span>(</span>
<span id="cb308-39"><a href="fusion_params_test.html#cb308-39" tabindex="-1"></a>       <span class="st">&quot;parameter settings of top &quot;</span></span>
<span id="cb308-40"><a href="fusion_params_test.html#cb308-40" tabindex="-1"></a>       , scales<span class="sc">::</span><span class="fu">percent</span>(<span class="dv">1</span><span class="sc">-</span>pct_rank_th_top,<span class="at">accuracy=</span><span class="dv">1</span>)</span>
<span id="cb308-41"><a href="fusion_params_test.html#cb308-41" tabindex="-1"></a>       , <span class="st">&quot; (n=&quot;</span></span>
<span id="cb308-42"><a href="fusion_params_test.html#cb308-42" tabindex="-1"></a>       , scales<span class="sc">::</span><span class="fu">comma</span>(<span class="fu">nrow</span>(top_x_pct_fscore), <span class="at">accuracy =</span> <span class="dv">1</span>)</span>
<span id="cb308-43"><a href="fusion_params_test.html#cb308-43" tabindex="-1"></a>       , <span class="st">&quot;) &quot;</span></span>
<span id="cb308-44"><a href="fusion_params_test.html#cb308-44" tabindex="-1"></a>       , <span class="st">&quot;of parameter combinations by F-score using structural+spectral data&quot;</span></span>
<span id="cb308-45"><a href="fusion_params_test.html#cb308-45" tabindex="-1"></a>    )</span>
<span id="cb308-46"><a href="fusion_params_test.html#cb308-46" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb308-47"><a href="fusion_params_test.html#cb308-47" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb308-48"><a href="fusion_params_test.html#cb308-48" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb308-49"><a href="fusion_params_test.html#cb308-49" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb308-50"><a href="fusion_params_test.html#cb308-50" tabindex="-1"></a>    , <span class="at">strip.text =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb308-51"><a href="fusion_params_test.html#cb308-51" tabindex="-1"></a>    , <span class="at">axis.text.y =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">6</span>)</span>
<span id="cb308-52"><a href="fusion_params_test.html#cb308-52" tabindex="-1"></a>    , <span class="at">axis.text.x =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>)</span>
<span id="cb308-53"><a href="fusion_params_test.html#cb308-53" tabindex="-1"></a>    , <span class="at">plot.subtitle =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>)</span>
<span id="cb308-54"><a href="fusion_params_test.html#cb308-54" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-269-1.png" width="1008" /></p>
<p>let’s use the value of <code>spectral_weight</code> that most frequently results in the best pile detection based on F-score (<code>spectral_weight</code> of “4”) to compare results to not using any spectral data (i.e. just using structural data as outlined in our method <a href="raster_watershed.html#raster_watershed">here</a>). We’ll then average across all other factors to look at the main effect of <code>spectral_weight</code> after creating a dichotomous factor of structural only versus structural+spectral</p>
<div class="sourceCode" id="cb309"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb309-1"><a href="fusion_params_test.html#cb309-1" tabindex="-1"></a><span class="co"># filter data</span></span>
<span id="cb309-2"><a href="fusion_params_test.html#cb309-2" tabindex="-1"></a>combos_df_temp <span class="ot">&lt;-</span></span>
<span id="cb309-3"><a href="fusion_params_test.html#cb309-3" tabindex="-1"></a>  param_combos_spectral_gt_agg <span class="sc">%&gt;%</span> </span>
<span id="cb309-4"><a href="fusion_params_test.html#cb309-4" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb309-5"><a href="fusion_params_test.html#cb309-5" tabindex="-1"></a>    <span class="at">combo =</span> forcats<span class="sc">::</span><span class="fu">fct_cross</span>(</span>
<span id="cb309-6"><a href="fusion_params_test.html#cb309-6" tabindex="-1"></a>      <span class="fu">factor</span>(max_ht_m)</span>
<span id="cb309-7"><a href="fusion_params_test.html#cb309-7" tabindex="-1"></a>      , <span class="fu">factor</span>(max_area_m2)</span>
<span id="cb309-8"><a href="fusion_params_test.html#cb309-8" tabindex="-1"></a>      , <span class="fu">factor</span>(convexity_pct)</span>
<span id="cb309-9"><a href="fusion_params_test.html#cb309-9" tabindex="-1"></a>      , <span class="fu">factor</span>(circle_fit_iou_pct)</span>
<span id="cb309-10"><a href="fusion_params_test.html#cb309-10" tabindex="-1"></a>    )</span>
<span id="cb309-11"><a href="fusion_params_test.html#cb309-11" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb309-12"><a href="fusion_params_test.html#cb309-12" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">c</span>(</span>
<span id="cb309-13"><a href="fusion_params_test.html#cb309-13" tabindex="-1"></a>    combo,spectral_weight</span>
<span id="cb309-14"><a href="fusion_params_test.html#cb309-14" tabindex="-1"></a>    ,precision,recall,f_score</span>
<span id="cb309-15"><a href="fusion_params_test.html#cb309-15" tabindex="-1"></a>    , pct_diff_volume_field_mape, pct_diff_diameter_mape, pct_diff_area_field_mape, pct_diff_height_mape</span>
<span id="cb309-16"><a href="fusion_params_test.html#cb309-16" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb309-17"><a href="fusion_params_test.html#cb309-17" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(</span>
<span id="cb309-18"><a href="fusion_params_test.html#cb309-18" tabindex="-1"></a>    spectral_weight <span class="sc">==</span> <span class="dv">0</span></span>
<span id="cb309-19"><a href="fusion_params_test.html#cb309-19" tabindex="-1"></a>    <span class="sc">|</span> spectral_weight <span class="sc">==</span> best_spectral_weight</span>
<span id="cb309-20"><a href="fusion_params_test.html#cb309-20" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb309-21"><a href="fusion_params_test.html#cb309-21" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb309-22"><a href="fusion_params_test.html#cb309-22" tabindex="-1"></a>    <span class="at">spectral_weight_fact =</span> <span class="fu">ifelse</span>(spectral_weight<span class="sc">==</span><span class="dv">0</span>,<span class="st">&quot;structural only&quot;</span>,<span class="st">&quot;structural+spectral&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb309-23"><a href="fusion_params_test.html#cb309-23" tabindex="-1"></a>      <span class="fu">factor</span>()</span>
<span id="cb309-24"><a href="fusion_params_test.html#cb309-24" tabindex="-1"></a>  )</span>
<span id="cb309-25"><a href="fusion_params_test.html#cb309-25" tabindex="-1"></a></span>
<span id="cb309-26"><a href="fusion_params_test.html#cb309-26" tabindex="-1"></a><span class="co"># quick mod</span></span>
<span id="cb309-27"><a href="fusion_params_test.html#cb309-27" tabindex="-1"></a>dep_vars_temp <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;f_score&quot;</span>,<span class="st">&quot;recall&quot;</span>,<span class="st">&quot;precision&quot;</span>)</span>
<span id="cb309-28"><a href="fusion_params_test.html#cb309-28" tabindex="-1"></a><span class="co"># list of formulas</span></span>
<span id="cb309-29"><a href="fusion_params_test.html#cb309-29" tabindex="-1"></a>formulas_temp <span class="ot">&lt;-</span> dep_vars_temp <span class="sc">%&gt;%</span> </span>
<span id="cb309-30"><a href="fusion_params_test.html#cb309-30" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">map</span>(<span class="sc">~</span>stats<span class="sc">::</span><span class="fu">reformulate</span>(<span class="fu">c</span>(<span class="st">&quot;spectral_weight_fact&quot;</span>,<span class="st">&quot;-1&quot;</span>), <span class="at">response =</span> .x))</span>
<span id="cb309-31"><a href="fusion_params_test.html#cb309-31" tabindex="-1"></a><span class="fu">names</span>(formulas_temp) <span class="ot">&lt;-</span> dep_vars_temp</span>
<span id="cb309-32"><a href="fusion_params_test.html#cb309-32" tabindex="-1"></a><span class="co"># formulas_temp</span></span>
<span id="cb309-33"><a href="fusion_params_test.html#cb309-33" tabindex="-1"></a>models_temp <span class="ot">&lt;-</span> formulas_temp <span class="sc">%&gt;%</span> </span>
<span id="cb309-34"><a href="fusion_params_test.html#cb309-34" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">map</span>(\(x) <span class="fu">lm</span>(<span class="at">formula =</span> x, <span class="at">data =</span> combos_df_temp))</span>
<span id="cb309-35"><a href="fusion_params_test.html#cb309-35" tabindex="-1"></a><span class="fu">names</span>(models_temp) <span class="ot">&lt;-</span> dep_vars_temp</span>
<span id="cb309-36"><a href="fusion_params_test.html#cb309-36" tabindex="-1"></a><span class="co"># models_temp</span></span>
<span id="cb309-37"><a href="fusion_params_test.html#cb309-37" tabindex="-1"></a><span class="co"># combine into df</span></span>
<span id="cb309-38"><a href="fusion_params_test.html#cb309-38" tabindex="-1"></a>pred_df_temp <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_df</span>(models_temp, broom<span class="sc">::</span>tidy, <span class="at">.id =</span> <span class="st">&quot;metric&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb309-39"><a href="fusion_params_test.html#cb309-39" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(statistic)) <span class="sc">%&gt;%</span> </span>
<span id="cb309-40"><a href="fusion_params_test.html#cb309-40" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb309-41"><a href="fusion_params_test.html#cb309-41" tabindex="-1"></a>    <span class="at">dep_var =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb309-42"><a href="fusion_params_test.html#cb309-42" tabindex="-1"></a>        metric <span class="sc">==</span> <span class="st">&quot;f_score&quot;</span> <span class="sc">~</span> <span class="dv">1</span></span>
<span id="cb309-43"><a href="fusion_params_test.html#cb309-43" tabindex="-1"></a>        , metric <span class="sc">==</span> <span class="st">&quot;recall&quot;</span> <span class="sc">~</span> <span class="dv">2</span></span>
<span id="cb309-44"><a href="fusion_params_test.html#cb309-44" tabindex="-1"></a>        , metric <span class="sc">==</span> <span class="st">&quot;precision&quot;</span> <span class="sc">~</span> <span class="dv">3</span></span>
<span id="cb309-45"><a href="fusion_params_test.html#cb309-45" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span> </span>
<span id="cb309-46"><a href="fusion_params_test.html#cb309-46" tabindex="-1"></a>      <span class="fu">factor</span>(</span>
<span id="cb309-47"><a href="fusion_params_test.html#cb309-47" tabindex="-1"></a>        <span class="at">ordered =</span> T</span>
<span id="cb309-48"><a href="fusion_params_test.html#cb309-48" tabindex="-1"></a>        , <span class="at">levels =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span></span>
<span id="cb309-49"><a href="fusion_params_test.html#cb309-49" tabindex="-1"></a>        , <span class="at">labels =</span> <span class="fu">c</span>(</span>
<span id="cb309-50"><a href="fusion_params_test.html#cb309-50" tabindex="-1"></a>          <span class="st">&quot;F-score&quot;</span></span>
<span id="cb309-51"><a href="fusion_params_test.html#cb309-51" tabindex="-1"></a>          , <span class="st">&quot;Recall&quot;</span></span>
<span id="cb309-52"><a href="fusion_params_test.html#cb309-52" tabindex="-1"></a>          , <span class="st">&quot;Precision&quot;</span></span>
<span id="cb309-53"><a href="fusion_params_test.html#cb309-53" tabindex="-1"></a>        )</span>
<span id="cb309-54"><a href="fusion_params_test.html#cb309-54" tabindex="-1"></a>      )</span>
<span id="cb309-55"><a href="fusion_params_test.html#cb309-55" tabindex="-1"></a>    , <span class="at">term =</span> stringr<span class="sc">::</span><span class="fu">str_remove_all</span>(term, <span class="st">&quot;spectral_weight_fact&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">factor</span>()</span>
<span id="cb309-56"><a href="fusion_params_test.html#cb309-56" tabindex="-1"></a>    <span class="co"># to obtain the 95% confidence interval...</span></span>
<span id="cb309-57"><a href="fusion_params_test.html#cb309-57" tabindex="-1"></a>      <span class="co"># ...1.96 times the standard error is added and subtracted from the sample mean</span></span>
<span id="cb309-58"><a href="fusion_params_test.html#cb309-58" tabindex="-1"></a>    , <span class="at">ul =</span> estimate<span class="sc">+</span>std.error<span class="sc">*</span><span class="fl">1.96</span></span>
<span id="cb309-59"><a href="fusion_params_test.html#cb309-59" tabindex="-1"></a>    , <span class="at">ll =</span> estimate<span class="sc">-</span>std.error<span class="sc">*</span><span class="fl">1.96</span></span>
<span id="cb309-60"><a href="fusion_params_test.html#cb309-60" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb309-61"><a href="fusion_params_test.html#cb309-61" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">spectral_weight_fact=</span>term) <span class="sc">%&gt;%</span> </span>
<span id="cb309-62"><a href="fusion_params_test.html#cb309-62" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">relocate</span>(dep_var) <span class="sc">%&gt;%</span> </span>
<span id="cb309-63"><a href="fusion_params_test.html#cb309-63" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(dep_var,spectral_weight_fact)</span>
<span id="cb309-64"><a href="fusion_params_test.html#cb309-64" tabindex="-1"></a></span>
<span id="cb309-65"><a href="fusion_params_test.html#cb309-65" tabindex="-1"></a><span class="co"># pred_df_temp</span></span>
<span id="cb309-66"><a href="fusion_params_test.html#cb309-66" tabindex="-1"></a><span class="co"># table it</span></span>
<span id="cb309-67"><a href="fusion_params_test.html#cb309-67" tabindex="-1"></a>pred_df_temp <span class="sc">%&gt;%</span> </span>
<span id="cb309-68"><a href="fusion_params_test.html#cb309-68" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(metric,ul,ll)) <span class="sc">%&gt;%</span> </span>
<span id="cb309-69"><a href="fusion_params_test.html#cb309-69" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb309-70"><a href="fusion_params_test.html#cb309-70" tabindex="-1"></a>    <span class="at">estimate =</span> scales<span class="sc">::</span><span class="fu">percent</span>(estimate, <span class="at">accuracy =</span> <span class="fl">0.1</span>)</span>
<span id="cb309-71"><a href="fusion_params_test.html#cb309-71" tabindex="-1"></a>    , <span class="at">std.error =</span> scales<span class="sc">::</span><span class="fu">percent</span>(std.error, <span class="at">accuracy =</span> <span class="fl">0.01</span>)</span>
<span id="cb309-72"><a href="fusion_params_test.html#cb309-72" tabindex="-1"></a>    , <span class="at">p.value =</span> <span class="fu">ifelse</span>(</span>
<span id="cb309-73"><a href="fusion_params_test.html#cb309-73" tabindex="-1"></a>        p.value <span class="sc">&lt;</span> <span class="fl">0.001</span></span>
<span id="cb309-74"><a href="fusion_params_test.html#cb309-74" tabindex="-1"></a>        , <span class="st">&quot;&lt; 0.001&quot;</span></span>
<span id="cb309-75"><a href="fusion_params_test.html#cb309-75" tabindex="-1"></a>        , scales<span class="sc">::</span><span class="fu">comma</span>(p.value, <span class="at">accuracy =</span> <span class="fl">0.0001</span>)</span>
<span id="cb309-76"><a href="fusion_params_test.html#cb309-76" tabindex="-1"></a>      )</span>
<span id="cb309-77"><a href="fusion_params_test.html#cb309-77" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb309-78"><a href="fusion_params_test.html#cb309-78" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kbl</span>(</span>
<span id="cb309-79"><a href="fusion_params_test.html#cb309-79" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">&quot;Predictions for detection accuracy metrics by detection method&lt;br&gt;averaging across all other structural detection parameters&quot;</span></span>
<span id="cb309-80"><a href="fusion_params_test.html#cb309-80" tabindex="-1"></a>    , <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">&quot;.&quot;</span>,<span class="st">&quot;method&quot;</span>,<span class="st">&quot;predicted mean&quot;</span>, <span class="st">&quot;SE&quot;</span>, <span class="st">&quot;p-value&quot;</span>)</span>
<span id="cb309-81"><a href="fusion_params_test.html#cb309-81" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb309-82"><a href="fusion_params_test.html#cb309-82" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kable_styling</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb309-83"><a href="fusion_params_test.html#cb309-83" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">collapse_rows</span>(<span class="at">columns =</span> <span class="dv">1</span>, <span class="at">valign =</span> <span class="st">&quot;top&quot;</span>)</span></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-270">Table 8.2: </span>Predictions for detection accuracy metrics by detection method<br>averaging across all other structural detection parameters
</caption>
<thead>
<tr>
<th style="text-align:left;">
.
</th>
<th style="text-align:left;">
method
</th>
<th style="text-align:left;">
predicted mean
</th>
<th style="text-align:left;">
SE
</th>
<th style="text-align:left;">
p-value
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="2">
F-score
</td>
<td style="text-align:left;">
structural only
</td>
<td style="text-align:left;">
54.7%
</td>
<td style="text-align:left;">
0.55%
</td>
<td style="text-align:left;">
&lt; 0.001
</td>
</tr>
<tr>
<td style="text-align:left;">
structural+spectral
</td>
<td style="text-align:left;">
60.8%
</td>
<td style="text-align:left;">
0.55%
</td>
<td style="text-align:left;">
&lt; 0.001
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="2">
Recall
</td>
<td style="text-align:left;">
structural only
</td>
<td style="text-align:left;">
60.3%
</td>
<td style="text-align:left;">
0.73%
</td>
<td style="text-align:left;">
&lt; 0.001
</td>
</tr>
<tr>
<td style="text-align:left;">
structural+spectral
</td>
<td style="text-align:left;">
60.3%
</td>
<td style="text-align:left;">
0.73%
</td>
<td style="text-align:left;">
&lt; 0.001
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="2">
Precision
</td>
<td style="text-align:left;">
structural only
</td>
<td style="text-align:left;">
65.7%
</td>
<td style="text-align:left;">
0.43%
</td>
<td style="text-align:left;">
&lt; 0.001
</td>
</tr>
<tr>
<td style="text-align:left;">
structural+spectral
</td>
<td style="text-align:left;">
76.5%
</td>
<td style="text-align:left;">
0.43%
</td>
<td style="text-align:left;">
&lt; 0.001
</td>
</tr>
</tbody>
</table>
<p>plot the change from including spectral data to the pile detection methodology</p>
<div class="sourceCode" id="cb310"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb310-1"><a href="fusion_params_test.html#cb310-1" tabindex="-1"></a><span class="co"># scales::show_col(pal_eval_metric)</span></span>
<span id="cb310-2"><a href="fusion_params_test.html#cb310-2" tabindex="-1"></a><span class="co"># plot</span></span>
<span id="cb310-3"><a href="fusion_params_test.html#cb310-3" tabindex="-1"></a>ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(</span>
<span id="cb310-4"><a href="fusion_params_test.html#cb310-4" tabindex="-1"></a>  <span class="at">data =</span> pred_df_temp</span>
<span id="cb310-5"><a href="fusion_params_test.html#cb310-5" tabindex="-1"></a>  , <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> spectral_weight_fact)</span>
<span id="cb310-6"><a href="fusion_params_test.html#cb310-6" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb310-7"><a href="fusion_params_test.html#cb310-7" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_line</span>(</span>
<span id="cb310-8"><a href="fusion_params_test.html#cb310-8" tabindex="-1"></a>    <span class="at">data =</span> combos_df_temp <span class="sc">%&gt;%</span> </span>
<span id="cb310-9"><a href="fusion_params_test.html#cb310-9" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">slice_sample</span>(<span class="at">prop =</span> <span class="fl">0.44</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb310-10"><a href="fusion_params_test.html#cb310-10" tabindex="-1"></a>      tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(</span>
<span id="cb310-11"><a href="fusion_params_test.html#cb310-11" tabindex="-1"></a>        <span class="at">cols =</span> <span class="fu">c</span>(precision,recall,f_score)</span>
<span id="cb310-12"><a href="fusion_params_test.html#cb310-12" tabindex="-1"></a>        , <span class="at">names_to =</span> <span class="st">&quot;metric&quot;</span></span>
<span id="cb310-13"><a href="fusion_params_test.html#cb310-13" tabindex="-1"></a>        , <span class="at">values_to =</span> <span class="st">&quot;value&quot;</span></span>
<span id="cb310-14"><a href="fusion_params_test.html#cb310-14" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span> </span>
<span id="cb310-15"><a href="fusion_params_test.html#cb310-15" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb310-16"><a href="fusion_params_test.html#cb310-16" tabindex="-1"></a>        <span class="at">dep_var =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb310-17"><a href="fusion_params_test.html#cb310-17" tabindex="-1"></a>          metric <span class="sc">==</span> <span class="st">&quot;f_score&quot;</span> <span class="sc">~</span> <span class="dv">1</span></span>
<span id="cb310-18"><a href="fusion_params_test.html#cb310-18" tabindex="-1"></a>          , metric <span class="sc">==</span> <span class="st">&quot;recall&quot;</span> <span class="sc">~</span> <span class="dv">2</span></span>
<span id="cb310-19"><a href="fusion_params_test.html#cb310-19" tabindex="-1"></a>          , metric <span class="sc">==</span> <span class="st">&quot;precision&quot;</span> <span class="sc">~</span> <span class="dv">3</span></span>
<span id="cb310-20"><a href="fusion_params_test.html#cb310-20" tabindex="-1"></a>        ) <span class="sc">%&gt;%</span> </span>
<span id="cb310-21"><a href="fusion_params_test.html#cb310-21" tabindex="-1"></a>        <span class="fu">factor</span>(</span>
<span id="cb310-22"><a href="fusion_params_test.html#cb310-22" tabindex="-1"></a>          <span class="at">ordered =</span> T</span>
<span id="cb310-23"><a href="fusion_params_test.html#cb310-23" tabindex="-1"></a>          , <span class="at">levels =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span></span>
<span id="cb310-24"><a href="fusion_params_test.html#cb310-24" tabindex="-1"></a>          , <span class="at">labels =</span> <span class="fu">c</span>(</span>
<span id="cb310-25"><a href="fusion_params_test.html#cb310-25" tabindex="-1"></a>            <span class="st">&quot;F-score&quot;</span></span>
<span id="cb310-26"><a href="fusion_params_test.html#cb310-26" tabindex="-1"></a>            , <span class="st">&quot;Recall&quot;</span></span>
<span id="cb310-27"><a href="fusion_params_test.html#cb310-27" tabindex="-1"></a>            , <span class="st">&quot;Precision&quot;</span></span>
<span id="cb310-28"><a href="fusion_params_test.html#cb310-28" tabindex="-1"></a>          )</span>
<span id="cb310-29"><a href="fusion_params_test.html#cb310-29" tabindex="-1"></a>        )</span>
<span id="cb310-30"><a href="fusion_params_test.html#cb310-30" tabindex="-1"></a>      )</span>
<span id="cb310-31"><a href="fusion_params_test.html#cb310-31" tabindex="-1"></a>    , <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">y =</span> value, <span class="at">group =</span> combo, <span class="at">color =</span> metric)</span>
<span id="cb310-32"><a href="fusion_params_test.html#cb310-32" tabindex="-1"></a>    , <span class="at">lwd =</span> <span class="fl">0.6</span>, <span class="at">alpha =</span> <span class="fl">0.1</span></span>
<span id="cb310-33"><a href="fusion_params_test.html#cb310-33" tabindex="-1"></a>    <span class="co"># , color = pal_eval_metric[1]</span></span>
<span id="cb310-34"><a href="fusion_params_test.html#cb310-34" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb310-35"><a href="fusion_params_test.html#cb310-35" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(</span>
<span id="cb310-36"><a href="fusion_params_test.html#cb310-36" tabindex="-1"></a>    <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">ymin =</span> ll, <span class="at">ymax =</span> ul, <span class="at">group =</span> <span class="dv">1</span>)</span>
<span id="cb310-37"><a href="fusion_params_test.html#cb310-37" tabindex="-1"></a>    , <span class="at">fill =</span> <span class="st">&quot;black&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.2</span></span>
<span id="cb310-38"><a href="fusion_params_test.html#cb310-38" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb310-39"><a href="fusion_params_test.html#cb310-39" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_line</span>(</span>
<span id="cb310-40"><a href="fusion_params_test.html#cb310-40" tabindex="-1"></a>    <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">y =</span> estimate, <span class="at">group =</span> <span class="dv">1</span>)</span>
<span id="cb310-41"><a href="fusion_params_test.html#cb310-41" tabindex="-1"></a>    , <span class="at">lwd =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span> <span class="co"># pal_eval_metric[1]</span></span>
<span id="cb310-42"><a href="fusion_params_test.html#cb310-42" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb310-43"><a href="fusion_params_test.html#cb310-43" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_text</span>(</span>
<span id="cb310-44"><a href="fusion_params_test.html#cb310-44" tabindex="-1"></a>    <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">y=</span>estimate, <span class="at">label =</span> scales<span class="sc">::</span><span class="fu">percent</span>(estimate,<span class="at">accuracy=</span><span class="fl">0.1</span>), <span class="at">group =</span> <span class="dv">1</span>)</span>
<span id="cb310-45"><a href="fusion_params_test.html#cb310-45" tabindex="-1"></a>    , <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.25</span></span>
<span id="cb310-46"><a href="fusion_params_test.html#cb310-46" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb310-47"><a href="fusion_params_test.html#cb310-47" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">facet_wrap</span>(<span class="at">facets =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(dep_var)) <span class="sc">+</span></span>
<span id="cb310-48"><a href="fusion_params_test.html#cb310-48" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(pal_eval_metric[<span class="dv">1</span>],pal_eval_metric[<span class="dv">3</span>],pal_eval_metric[<span class="dv">2</span>]) ) <span class="sc">+</span> <span class="co"># pal_eval_metric</span></span>
<span id="cb310-49"><a href="fusion_params_test.html#cb310-49" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">labels =</span> scales<span class="sc">::</span>percent, <span class="at">breaks =</span> scales<span class="sc">::</span><span class="fu">breaks_extended</span>(<span class="dv">10</span>)) <span class="sc">+</span></span>
<span id="cb310-50"><a href="fusion_params_test.html#cb310-50" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb310-51"><a href="fusion_params_test.html#cb310-51" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;&quot;</span>, <span class="at">y =</span> <span class="st">&quot;&quot;</span>, <span class="at">color =</span> <span class="st">&quot;&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;&quot;</span></span>
<span id="cb310-52"><a href="fusion_params_test.html#cb310-52" tabindex="-1"></a>    , <span class="at">caption =</span> <span class="fu">paste0</span>(</span>
<span id="cb310-53"><a href="fusion_params_test.html#cb310-53" tabindex="-1"></a>      <span class="st">&quot;*The spectral+structural group has the `spectral_weight` parameter set to &#39;&quot;</span></span>
<span id="cb310-54"><a href="fusion_params_test.html#cb310-54" tabindex="-1"></a>      , best_spectral_weight, <span class="st">&quot;&#39;&quot;</span></span>
<span id="cb310-55"><a href="fusion_params_test.html#cb310-55" tabindex="-1"></a>    )</span>
<span id="cb310-56"><a href="fusion_params_test.html#cb310-56" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb310-57"><a href="fusion_params_test.html#cb310-57" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb310-58"><a href="fusion_params_test.html#cb310-58" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb310-59"><a href="fusion_params_test.html#cb310-59" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb310-60"><a href="fusion_params_test.html#cb310-60" tabindex="-1"></a>    , <span class="at">strip.text =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb310-61"><a href="fusion_params_test.html#cb310-61" tabindex="-1"></a>    , <span class="at">plot.caption =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>)</span>
<span id="cb310-62"><a href="fusion_params_test.html#cb310-62" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-271-1.png" width="1008" /></p>
<p>remember, these values appear low but the value is not the important takeaway here because we averaged across all other parameter settings, including those that resulted in poor pile detection, instead the focus is on the change from including the spectral data. based on the data used here, these results indicate that including the spectral data resulted in a 6.1 percentage point increase in the F-score compared to just using the structural data irrespective of the parameter settings used in the structural detection method.</p>
<p>if we look at only the best pile detection methodology based on F-score using the structural data and the best using both structural and spectral data, what is the change in our performance metrics from including the spectral data?</p>
<div class="sourceCode" id="cb311"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb311-1"><a href="fusion_params_test.html#cb311-1" tabindex="-1"></a>df_temp <span class="ot">&lt;-</span> </span>
<span id="cb311-2"><a href="fusion_params_test.html#cb311-2" tabindex="-1"></a>  combos_df_temp <span class="sc">%&gt;%</span> </span>
<span id="cb311-3"><a href="fusion_params_test.html#cb311-3" tabindex="-1"></a>  <span class="co"># get the top by spectral_weight</span></span>
<span id="cb311-4"><a href="fusion_params_test.html#cb311-4" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(spectral_weight) <span class="sc">%&gt;%</span> </span>
<span id="cb311-5"><a href="fusion_params_test.html#cb311-5" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb311-6"><a href="fusion_params_test.html#cb311-6" tabindex="-1"></a>    <span class="at">is_top =</span> f_score <span class="sc">==</span> <span class="fu">max</span>(f_score)</span>
<span id="cb311-7"><a href="fusion_params_test.html#cb311-7" tabindex="-1"></a>    , <span class="at">top_what =</span> <span class="fu">ifelse</span>(is_top, spectral_weight, <span class="cn">NA</span>)</span>
<span id="cb311-8"><a href="fusion_params_test.html#cb311-8" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb311-9"><a href="fusion_params_test.html#cb311-9" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(<span class="fu">desc</span>(f_score),<span class="fu">desc</span>(recall),pct_diff_volume_field_mape,pct_diff_area_field_mape,pct_diff_height_mape) <span class="sc">%&gt;%</span> </span>
<span id="cb311-10"><a href="fusion_params_test.html#cb311-10" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(dplyr<span class="sc">::</span><span class="fu">row_number</span>() <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb311-11"><a href="fusion_params_test.html#cb311-11" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>()</span>
<span id="cb311-12"><a href="fusion_params_test.html#cb311-12" tabindex="-1"></a></span>
<span id="cb311-13"><a href="fusion_params_test.html#cb311-13" tabindex="-1"></a>  <span class="co"># add top</span></span>
<span id="cb311-14"><a href="fusion_params_test.html#cb311-14" tabindex="-1"></a>  </span>
<span id="cb311-15"><a href="fusion_params_test.html#cb311-15" tabindex="-1"></a>combos_df_temp <span class="ot">&lt;-</span></span>
<span id="cb311-16"><a href="fusion_params_test.html#cb311-16" tabindex="-1"></a>  df_temp <span class="sc">%&gt;%</span> </span>
<span id="cb311-17"><a href="fusion_params_test.html#cb311-17" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(</span>
<span id="cb311-18"><a href="fusion_params_test.html#cb311-18" tabindex="-1"></a>      combos_df_temp <span class="sc">%&gt;%</span> </span>
<span id="cb311-19"><a href="fusion_params_test.html#cb311-19" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">filter</span>(spectral_weight<span class="sc">!=</span><span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb311-20"><a href="fusion_params_test.html#cb311-20" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">inner_join</span>(</span>
<span id="cb311-21"><a href="fusion_params_test.html#cb311-21" tabindex="-1"></a>        df_temp <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(spectral_weight<span class="sc">==</span><span class="dv">0</span> <span class="sc">&amp;</span> is_top) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(combo)</span>
<span id="cb311-22"><a href="fusion_params_test.html#cb311-22" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span> </span>
<span id="cb311-23"><a href="fusion_params_test.html#cb311-23" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb311-24"><a href="fusion_params_test.html#cb311-24" tabindex="-1"></a>        <span class="at">is_top =</span> F</span>
<span id="cb311-25"><a href="fusion_params_test.html#cb311-25" tabindex="-1"></a>        , <span class="at">top_what =</span> <span class="dv">0</span></span>
<span id="cb311-26"><a href="fusion_params_test.html#cb311-26" tabindex="-1"></a>      )</span>
<span id="cb311-27"><a href="fusion_params_test.html#cb311-27" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb311-28"><a href="fusion_params_test.html#cb311-28" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(</span>
<span id="cb311-29"><a href="fusion_params_test.html#cb311-29" tabindex="-1"></a>      combos_df_temp <span class="sc">%&gt;%</span> </span>
<span id="cb311-30"><a href="fusion_params_test.html#cb311-30" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">filter</span>(spectral_weight<span class="sc">==</span><span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb311-31"><a href="fusion_params_test.html#cb311-31" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">inner_join</span>(</span>
<span id="cb311-32"><a href="fusion_params_test.html#cb311-32" tabindex="-1"></a>        df_temp <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(spectral_weight<span class="sc">!=</span><span class="dv">0</span> <span class="sc">&amp;</span> is_top) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(combo)</span>
<span id="cb311-33"><a href="fusion_params_test.html#cb311-33" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span> </span>
<span id="cb311-34"><a href="fusion_params_test.html#cb311-34" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb311-35"><a href="fusion_params_test.html#cb311-35" tabindex="-1"></a>        <span class="at">is_top =</span> F</span>
<span id="cb311-36"><a href="fusion_params_test.html#cb311-36" tabindex="-1"></a>        , <span class="at">top_what =</span> <span class="fu">max</span>(df_temp<span class="sc">$</span>spectral_weight)</span>
<span id="cb311-37"><a href="fusion_params_test.html#cb311-37" tabindex="-1"></a>      )</span>
<span id="cb311-38"><a href="fusion_params_test.html#cb311-38" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb311-39"><a href="fusion_params_test.html#cb311-39" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb311-40"><a href="fusion_params_test.html#cb311-40" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb311-41"><a href="fusion_params_test.html#cb311-41" tabindex="-1"></a>    <span class="at">top_what =</span> <span class="fu">ifelse</span>(top_what<span class="sc">==</span><span class="dv">0</span>,<span class="st">&quot;Top structural only&quot;</span>,<span class="st">&quot;Top structural+spectral&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb311-42"><a href="fusion_params_test.html#cb311-42" tabindex="-1"></a>      <span class="fu">factor</span>()</span>
<span id="cb311-43"><a href="fusion_params_test.html#cb311-43" tabindex="-1"></a>    , <span class="at">desc =</span> <span class="fu">paste0</span>(</span>
<span id="cb311-44"><a href="fusion_params_test.html#cb311-44" tabindex="-1"></a>      top_what</span>
<span id="cb311-45"><a href="fusion_params_test.html#cb311-45" tabindex="-1"></a>      , <span class="st">&quot; : max_ht_m=&quot;</span>, stringr<span class="sc">::</span><span class="fu">word</span>(combo,<span class="dv">1</span>,<span class="at">sep =</span> <span class="st">&quot;:&quot;</span>)</span>
<span id="cb311-46"><a href="fusion_params_test.html#cb311-46" tabindex="-1"></a>      , <span class="st">&quot;, max_area_m2=&quot;</span>, stringr<span class="sc">::</span><span class="fu">word</span>(combo,<span class="dv">2</span>,<span class="at">sep =</span> <span class="st">&quot;:&quot;</span>)</span>
<span id="cb311-47"><a href="fusion_params_test.html#cb311-47" tabindex="-1"></a>      , <span class="st">&quot;, convexity_pct=&quot;</span>, stringr<span class="sc">::</span><span class="fu">word</span>(combo,<span class="dv">3</span>,<span class="at">sep =</span> <span class="st">&quot;:&quot;</span>)</span>
<span id="cb311-48"><a href="fusion_params_test.html#cb311-48" tabindex="-1"></a>      , <span class="st">&quot;, circle_fit_iou_pct=&quot;</span>, stringr<span class="sc">::</span><span class="fu">word</span>(combo,<span class="dv">4</span>,<span class="at">sep =</span> <span class="st">&quot;:&quot;</span>)</span>
<span id="cb311-49"><a href="fusion_params_test.html#cb311-49" tabindex="-1"></a>    )</span>
<span id="cb311-50"><a href="fusion_params_test.html#cb311-50" tabindex="-1"></a>  )</span>
<span id="cb311-51"><a href="fusion_params_test.html#cb311-51" tabindex="-1"></a><span class="co"># plot</span></span>
<span id="cb311-52"><a href="fusion_params_test.html#cb311-52" tabindex="-1"></a>combos_df_temp <span class="sc">%&gt;%</span></span>
<span id="cb311-53"><a href="fusion_params_test.html#cb311-53" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(</span>
<span id="cb311-54"><a href="fusion_params_test.html#cb311-54" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">c</span>(precision,recall,f_score)</span>
<span id="cb311-55"><a href="fusion_params_test.html#cb311-55" tabindex="-1"></a>    , <span class="at">names_to =</span> <span class="st">&quot;metric&quot;</span></span>
<span id="cb311-56"><a href="fusion_params_test.html#cb311-56" tabindex="-1"></a>    , <span class="at">values_to =</span> <span class="st">&quot;value&quot;</span></span>
<span id="cb311-57"><a href="fusion_params_test.html#cb311-57" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb311-58"><a href="fusion_params_test.html#cb311-58" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb311-59"><a href="fusion_params_test.html#cb311-59" tabindex="-1"></a>    <span class="at">dep_var =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb311-60"><a href="fusion_params_test.html#cb311-60" tabindex="-1"></a>      metric <span class="sc">==</span> <span class="st">&quot;f_score&quot;</span> <span class="sc">~</span> <span class="dv">1</span></span>
<span id="cb311-61"><a href="fusion_params_test.html#cb311-61" tabindex="-1"></a>      , metric <span class="sc">==</span> <span class="st">&quot;recall&quot;</span> <span class="sc">~</span> <span class="dv">2</span></span>
<span id="cb311-62"><a href="fusion_params_test.html#cb311-62" tabindex="-1"></a>      , metric <span class="sc">==</span> <span class="st">&quot;precision&quot;</span> <span class="sc">~</span> <span class="dv">3</span></span>
<span id="cb311-63"><a href="fusion_params_test.html#cb311-63" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb311-64"><a href="fusion_params_test.html#cb311-64" tabindex="-1"></a>    <span class="fu">factor</span>(</span>
<span id="cb311-65"><a href="fusion_params_test.html#cb311-65" tabindex="-1"></a>      <span class="at">ordered =</span> T</span>
<span id="cb311-66"><a href="fusion_params_test.html#cb311-66" tabindex="-1"></a>      , <span class="at">levels =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span></span>
<span id="cb311-67"><a href="fusion_params_test.html#cb311-67" tabindex="-1"></a>      , <span class="at">labels =</span> <span class="fu">c</span>(</span>
<span id="cb311-68"><a href="fusion_params_test.html#cb311-68" tabindex="-1"></a>        <span class="st">&quot;F-score&quot;</span></span>
<span id="cb311-69"><a href="fusion_params_test.html#cb311-69" tabindex="-1"></a>        , <span class="st">&quot;Recall&quot;</span></span>
<span id="cb311-70"><a href="fusion_params_test.html#cb311-70" tabindex="-1"></a>        , <span class="st">&quot;Precision&quot;</span></span>
<span id="cb311-71"><a href="fusion_params_test.html#cb311-71" tabindex="-1"></a>      )</span>
<span id="cb311-72"><a href="fusion_params_test.html#cb311-72" tabindex="-1"></a>    )</span>
<span id="cb311-73"><a href="fusion_params_test.html#cb311-73" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb311-74"><a href="fusion_params_test.html#cb311-74" tabindex="-1"></a><span class="co"># plot</span></span>
<span id="cb311-75"><a href="fusion_params_test.html#cb311-75" tabindex="-1"></a>ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(</span>
<span id="cb311-76"><a href="fusion_params_test.html#cb311-76" tabindex="-1"></a>  <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> spectral_weight_fact,<span class="at">y =</span> value,<span class="at">label =</span> scales<span class="sc">::</span><span class="fu">percent</span>(value,<span class="at">accuracy=</span><span class="fl">0.1</span>), <span class="at">group =</span> combo, <span class="at">color =</span> desc)</span>
<span id="cb311-77"><a href="fusion_params_test.html#cb311-77" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb311-78"><a href="fusion_params_test.html#cb311-78" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_line</span>(<span class="at">key_glyph =</span> <span class="st">&quot;point&quot;</span>) <span class="sc">+</span></span>
<span id="cb311-79"><a href="fusion_params_test.html#cb311-79" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_text</span>(</span>
<span id="cb311-80"><a href="fusion_params_test.html#cb311-80" tabindex="-1"></a>    <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.25</span></span>
<span id="cb311-81"><a href="fusion_params_test.html#cb311-81" tabindex="-1"></a>    , <span class="at">show.legend =</span> <span class="cn">FALSE</span></span>
<span id="cb311-82"><a href="fusion_params_test.html#cb311-82" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb311-83"><a href="fusion_params_test.html#cb311-83" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">facet_wrap</span>(<span class="at">facets =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(dep_var)) <span class="sc">+</span></span>
<span id="cb311-84"><a href="fusion_params_test.html#cb311-84" tabindex="-1"></a>  harrypotter<span class="sc">::</span><span class="fu">scale_color_hp_d</span>(<span class="at">option =</span> <span class="st">&quot;hermionegranger&quot;</span>) <span class="sc">+</span></span>
<span id="cb311-85"><a href="fusion_params_test.html#cb311-85" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">labels =</span> scales<span class="sc">::</span>percent, <span class="at">breaks =</span> scales<span class="sc">::</span><span class="fu">breaks_extended</span>(<span class="dv">10</span>)) <span class="sc">+</span></span>
<span id="cb311-86"><a href="fusion_params_test.html#cb311-86" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb311-87"><a href="fusion_params_test.html#cb311-87" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;&quot;</span>, <span class="at">y =</span> <span class="st">&quot;&quot;</span>, <span class="at">color =</span> <span class="st">&quot;&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;&quot;</span></span>
<span id="cb311-88"><a href="fusion_params_test.html#cb311-88" tabindex="-1"></a>    , <span class="at">caption =</span> <span class="fu">paste0</span>(</span>
<span id="cb311-89"><a href="fusion_params_test.html#cb311-89" tabindex="-1"></a>      <span class="st">&quot;*The spectral+structural group has the `spectral_weight` parameter set to &#39;&quot;</span></span>
<span id="cb311-90"><a href="fusion_params_test.html#cb311-90" tabindex="-1"></a>      , best_spectral_weight, <span class="st">&quot;&#39;&quot;</span></span>
<span id="cb311-91"><a href="fusion_params_test.html#cb311-91" tabindex="-1"></a>    )</span>
<span id="cb311-92"><a href="fusion_params_test.html#cb311-92" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb311-93"><a href="fusion_params_test.html#cb311-93" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb311-94"><a href="fusion_params_test.html#cb311-94" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb311-95"><a href="fusion_params_test.html#cb311-95" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;top&quot;</span></span>
<span id="cb311-96"><a href="fusion_params_test.html#cb311-96" tabindex="-1"></a>    , <span class="at">legend.direction =</span> <span class="st">&quot;vertical&quot;</span></span>
<span id="cb311-97"><a href="fusion_params_test.html#cb311-97" tabindex="-1"></a>    , <span class="at">legend.justification =</span> <span class="st">&quot;left&quot;</span></span>
<span id="cb311-98"><a href="fusion_params_test.html#cb311-98" tabindex="-1"></a>    , <span class="at">strip.text =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb311-99"><a href="fusion_params_test.html#cb311-99" tabindex="-1"></a>    , <span class="at">plot.caption =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>)</span>
<span id="cb311-100"><a href="fusion_params_test.html#cb311-100" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb311-101"><a href="fusion_params_test.html#cb311-101" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">guides</span>(</span>
<span id="cb311-102"><a href="fusion_params_test.html#cb311-102" tabindex="-1"></a>    <span class="at">color =</span> ggplot2<span class="sc">::</span><span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">shape =</span> <span class="dv">15</span>, <span class="at">size =</span> <span class="dv">10</span>, <span class="at">alpha =</span> <span class="dv">1</span>))</span>
<span id="cb311-103"><a href="fusion_params_test.html#cb311-103" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-272-1.png" width="1008" /></p>
<p>table it</p>
<div class="sourceCode" id="cb312"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb312-1"><a href="fusion_params_test.html#cb312-1" tabindex="-1"></a><span class="co"># table it</span></span>
<span id="cb312-2"><a href="fusion_params_test.html#cb312-2" tabindex="-1"></a>combos_df_temp <span class="sc">%&gt;%</span> </span>
<span id="cb312-3"><a href="fusion_params_test.html#cb312-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb312-4"><a href="fusion_params_test.html#cb312-4" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">c</span>(</span>
<span id="cb312-5"><a href="fusion_params_test.html#cb312-5" tabindex="-1"></a>    desc,spectral_weight_fact</span>
<span id="cb312-6"><a href="fusion_params_test.html#cb312-6" tabindex="-1"></a>    ,f_score, recall, precision</span>
<span id="cb312-7"><a href="fusion_params_test.html#cb312-7" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb312-8"><a href="fusion_params_test.html#cb312-8" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(dplyr<span class="sc">::</span><span class="fu">across</span>(</span>
<span id="cb312-9"><a href="fusion_params_test.html#cb312-9" tabindex="-1"></a>    <span class="at">.cols =</span> <span class="fu">c</span>(f_score, recall, precision)</span>
<span id="cb312-10"><a href="fusion_params_test.html#cb312-10" tabindex="-1"></a>    , <span class="at">.fn =</span> <span class="sc">~</span> scales<span class="sc">::</span><span class="fu">percent</span>(.x, <span class="at">accuracy =</span> <span class="dv">1</span>)</span>
<span id="cb312-11"><a href="fusion_params_test.html#cb312-11" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb312-12"><a href="fusion_params_test.html#cb312-12" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(desc,spectral_weight_fact) <span class="sc">%&gt;%</span> </span>
<span id="cb312-13"><a href="fusion_params_test.html#cb312-13" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kbl</span>(</span>
<span id="cb312-14"><a href="fusion_params_test.html#cb312-14" tabindex="-1"></a>    <span class="at">caption =</span> <span class="fu">paste0</span>(</span>
<span id="cb312-15"><a href="fusion_params_test.html#cb312-15" tabindex="-1"></a>      <span class="st">&quot;parameter combinations that achieved the best slash pile detection results&quot;</span></span>
<span id="cb312-16"><a href="fusion_params_test.html#cb312-16" tabindex="-1"></a>    )</span>
<span id="cb312-17"><a href="fusion_params_test.html#cb312-17" tabindex="-1"></a>    , <span class="at">col.names =</span> <span class="fu">c</span>(</span>
<span id="cb312-18"><a href="fusion_params_test.html#cb312-18" tabindex="-1"></a>      <span class="st">&quot;.&quot;</span></span>
<span id="cb312-19"><a href="fusion_params_test.html#cb312-19" tabindex="-1"></a>      , <span class="st">&quot;method&quot;</span></span>
<span id="cb312-20"><a href="fusion_params_test.html#cb312-20" tabindex="-1"></a>      , <span class="st">&quot;F-score&quot;</span>, <span class="st">&quot;Recall&quot;</span>, <span class="st">&quot;Precision&quot;</span></span>
<span id="cb312-21"><a href="fusion_params_test.html#cb312-21" tabindex="-1"></a>    )</span>
<span id="cb312-22"><a href="fusion_params_test.html#cb312-22" tabindex="-1"></a>    , <span class="at">escape =</span> F</span>
<span id="cb312-23"><a href="fusion_params_test.html#cb312-23" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb312-24"><a href="fusion_params_test.html#cb312-24" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kable_styling</span>(<span class="at">font_size =</span> <span class="dv">12</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb312-25"><a href="fusion_params_test.html#cb312-25" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">collapse_rows</span>(<span class="at">columns =</span> <span class="dv">1</span>, <span class="at">valign =</span> <span class="st">&quot;top&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb312-26"><a href="fusion_params_test.html#cb312-26" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">add_header_above</span>(<span class="fu">c</span>(<span class="st">&quot; &quot;</span><span class="ot">=</span><span class="dv">2</span>, <span class="st">&quot;Evaluation Metric&quot;</span> <span class="ot">=</span> <span class="dv">3</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb312-27"><a href="fusion_params_test.html#cb312-27" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">footnote</span>(</span>
<span id="cb312-28"><a href="fusion_params_test.html#cb312-28" tabindex="-1"></a>    <span class="at">symbol =</span> <span class="fu">paste0</span>(</span>
<span id="cb312-29"><a href="fusion_params_test.html#cb312-29" tabindex="-1"></a>      <span class="st">&quot;the spectral+structural group has the `spectral_weight` parameter set to &#39;&quot;</span></span>
<span id="cb312-30"><a href="fusion_params_test.html#cb312-30" tabindex="-1"></a>      , best_spectral_weight, <span class="st">&quot;&#39;&quot;</span></span>
<span id="cb312-31"><a href="fusion_params_test.html#cb312-31" tabindex="-1"></a>    )</span>
<span id="cb312-32"><a href="fusion_params_test.html#cb312-32" tabindex="-1"></a>  )</span></code></pre></div>
<table class="table" style="font-size: 12px; margin-left: auto; margin-right: auto;border-bottom: 0;">
<caption style="font-size: initial !important;">
<span id="tab:unnamed-chunk-273">Table 8.3: </span>parameter combinations that achieved the best slash pile detection results
</caption>
<thead>
<tr>
<th style="empty-cells: hide;border-bottom:hidden;" colspan="2">
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="3">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Evaluation Metric
</div>
</th>
</tr>
<tr>
<th style="text-align:left;">
.
</th>
<th style="text-align:left;">
method
</th>
<th style="text-align:left;">
F-score
</th>
<th style="text-align:left;">
Recall
</th>
<th style="text-align:left;">
Precision
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="2">
Top structural only : max_ht_m=3, max_area_m2=50, convexity_pct=0.3, circle_fit_iou_pct=0.6
</td>
<td style="text-align:left;">
structural only
</td>
<td style="text-align:left;">
76%
</td>
<td style="text-align:left;">
76%
</td>
<td style="text-align:left;">
75%
</td>
</tr>
<tr>
<td style="text-align:left;">
structural+spectral
</td>
<td style="text-align:left;">
80%
</td>
<td style="text-align:left;">
76%
</td>
<td style="text-align:left;">
85%
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="2">
Top structural+spectral : max_ht_m=2, max_area_m2=40, convexity_pct=0.6, circle_fit_iou_pct=0.3
</td>
<td style="text-align:left;">
structural only
</td>
<td style="text-align:left;">
75%
</td>
<td style="text-align:left;">
84%
</td>
<td style="text-align:left;">
68%
</td>
</tr>
<tr>
<td style="text-align:left;">
structural+spectral
</td>
<td style="text-align:left;">
82%
</td>
<td style="text-align:left;">
84%
</td>
<td style="text-align:left;">
80%
</td>
</tr>
</tbody>
<tfoot>
<tr>
<td style="padding: 0; " colspan="100%">
<sup>*</sup> the spectral+structural group has the <code>spectral_weight</code> parameter set to ‘4’
</td>
</tr>
</tfoot>
</table>
<div class="sourceCode" id="cb313"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb313-1"><a href="fusion_params_test.html#cb313-1" tabindex="-1"></a><span class="co"># param_combos_spectral_gt_agg %&gt;% </span></span>
<span id="cb313-2"><a href="fusion_params_test.html#cb313-2" tabindex="-1"></a><span class="co">#   dplyr::filter(spectral_weight==2) %&gt;% </span></span>
<span id="cb313-3"><a href="fusion_params_test.html#cb313-3" tabindex="-1"></a><span class="co">#   dplyr::arrange(desc(f_score),desc(recall),pct_diff_volume_field_mape,pct_diff_area_field_mape,pct_diff_height_mape) %&gt;% </span></span>
<span id="cb313-4"><a href="fusion_params_test.html#cb313-4" tabindex="-1"></a><span class="co">#   dplyr::slice(1) %&gt;% </span></span>
<span id="cb313-5"><a href="fusion_params_test.html#cb313-5" tabindex="-1"></a><span class="co">#   dplyr::select(</span></span>
<span id="cb313-6"><a href="fusion_params_test.html#cb313-6" tabindex="-1"></a><span class="co">#     max_ht_m</span></span>
<span id="cb313-7"><a href="fusion_params_test.html#cb313-7" tabindex="-1"></a><span class="co">#       , max_area_m2</span></span>
<span id="cb313-8"><a href="fusion_params_test.html#cb313-8" tabindex="-1"></a><span class="co">#       , convexity_pct</span></span>
<span id="cb313-9"><a href="fusion_params_test.html#cb313-9" tabindex="-1"></a><span class="co">#       , circle_fit_iou_pct</span></span>
<span id="cb313-10"><a href="fusion_params_test.html#cb313-10" tabindex="-1"></a><span class="co">#   )</span></span></code></pre></div>
<p>looking at the best-performing methods:</p>
<ul>
<li>the top structural-only method achieved an F-score of 76%</li>
<li>when spectral data was included with <code>spectral_weight</code> of “4”, the F-score for this same structural setting increased to 80%</li>
<li>the absolute best-performing method using both structural and spectral data with <code>spectral_weight</code> of “4” achieved an F-score of 82%</li>
</ul>
<p>this clearly demonstrates the value of integrating spectral information for more accurate slash pile detection</p>
</div>
<div id="best-results-quantification-accuracy-1" class="section level3 hasAnchor" number="8.3.6">
<h3><span class="header-section-number">8.3.6</span> Best results: quantification accuracy<a href="fusion_params_test.html#best-results-quantification-accuracy-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>we can cut to the chase and just look at the parameter combinations that achieved the best results based on the form quantification accuracy metrics</p>
<div class="sourceCode" id="cb314"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb314-1"><a href="fusion_params_test.html#cb314-1" tabindex="-1"></a>pct_rank_th_temp <span class="ot">&lt;-</span> <span class="fl">0.99</span></span>
<span id="cb314-2"><a href="fusion_params_test.html#cb314-2" tabindex="-1"></a>df_temp <span class="ot">&lt;-</span></span>
<span id="cb314-3"><a href="fusion_params_test.html#cb314-3" tabindex="-1"></a>  param_combos_spectral_gt_agg <span class="sc">%&gt;%</span> </span>
<span id="cb314-4"><a href="fusion_params_test.html#cb314-4" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(pct_diff_volume_field_mape, pct_diff_diameter_mape, pct_diff_area_field_mape, pct_diff_height_mape) <span class="sc">%&gt;%</span> </span>
<span id="cb314-5"><a href="fusion_params_test.html#cb314-5" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb314-6"><a href="fusion_params_test.html#cb314-6" tabindex="-1"></a>    <span class="co"># label combining params</span></span>
<span id="cb314-7"><a href="fusion_params_test.html#cb314-7" tabindex="-1"></a>    <span class="at">lab =</span> stringr<span class="sc">::</span><span class="fu">str_c</span>(max_ht_m,max_area_m2,convexity_pct,circle_fit_iou_pct,spectral_weight, <span class="at">sep =</span> <span class="st">&quot;:&quot;</span>)</span>
<span id="cb314-8"><a href="fusion_params_test.html#cb314-8" tabindex="-1"></a>    , dplyr<span class="sc">::</span><span class="fu">across</span>(</span>
<span id="cb314-9"><a href="fusion_params_test.html#cb314-9" tabindex="-1"></a>      <span class="at">.cols =</span> <span class="fu">c</span>(tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_mape&quot;</span>))</span>
<span id="cb314-10"><a href="fusion_params_test.html#cb314-10" tabindex="-1"></a>      , <span class="at">.fn =</span> dplyr<span class="sc">::</span>percent_rank</span>
<span id="cb314-11"><a href="fusion_params_test.html#cb314-11" tabindex="-1"></a>      , <span class="at">.names =</span> <span class="st">&quot;pct_rank_{.col}&quot;</span></span>
<span id="cb314-12"><a href="fusion_params_test.html#cb314-12" tabindex="-1"></a>    )</span>
<span id="cb314-13"><a href="fusion_params_test.html#cb314-13" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb314-14"><a href="fusion_params_test.html#cb314-14" tabindex="-1"></a>  <span class="co"># dplyr::arrange(pct_diff_paraboloid_volume_field_mape) %&gt;% </span></span>
<span id="cb314-15"><a href="fusion_params_test.html#cb314-15" tabindex="-1"></a>  <span class="co"># dplyr::select(pct_diff_diameter_mape, pct_rank_pct_diff_paraboloid_volume_field_mape) %&gt;% </span></span>
<span id="cb314-16"><a href="fusion_params_test.html#cb314-16" tabindex="-1"></a>  <span class="co"># now get the max of these pct ranks by row</span></span>
<span id="cb314-17"><a href="fusion_params_test.html#cb314-17" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rowwise</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb314-18"><a href="fusion_params_test.html#cb314-18" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb314-19"><a href="fusion_params_test.html#cb314-19" tabindex="-1"></a>    <span class="at">pct_rank_min =</span> <span class="fu">min</span>(</span>
<span id="cb314-20"><a href="fusion_params_test.html#cb314-20" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">c_across</span>(</span>
<span id="cb314-21"><a href="fusion_params_test.html#cb314-21" tabindex="-1"></a>        tidyselect<span class="sc">::</span><span class="fu">starts_with</span>(<span class="st">&quot;pct_rank&quot;</span>)</span>
<span id="cb314-22"><a href="fusion_params_test.html#cb314-22" tabindex="-1"></a>      )</span>
<span id="cb314-23"><a href="fusion_params_test.html#cb314-23" tabindex="-1"></a>      , <span class="at">na.rm =</span> T</span>
<span id="cb314-24"><a href="fusion_params_test.html#cb314-24" tabindex="-1"></a>    )</span>
<span id="cb314-25"><a href="fusion_params_test.html#cb314-25" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb314-26"><a href="fusion_params_test.html#cb314-26" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb314-27"><a href="fusion_params_test.html#cb314-27" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(pct_rank_min<span class="sc">&lt;=</span>(<span class="dv">1</span><span class="sc">-</span>pct_rank_th_temp)) <span class="sc">%&gt;%</span> </span>
<span id="cb314-28"><a href="fusion_params_test.html#cb314-28" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb314-29"><a href="fusion_params_test.html#cb314-29" tabindex="-1"></a>    max_ht_m,max_area_m2,convexity_pct,circle_fit_iou_pct,spectral_weight</span>
<span id="cb314-30"><a href="fusion_params_test.html#cb314-30" tabindex="-1"></a>    , lab</span>
<span id="cb314-31"><a href="fusion_params_test.html#cb314-31" tabindex="-1"></a>    , tidyselect<span class="sc">::</span><span class="fu">starts_with</span>(<span class="st">&quot;pct_rank&quot;</span>)</span>
<span id="cb314-32"><a href="fusion_params_test.html#cb314-32" tabindex="-1"></a>    , tidyselect<span class="sc">::</span><span class="fu">starts_with</span>(<span class="st">&quot;pct_diff&quot;</span>)</span>
<span id="cb314-33"><a href="fusion_params_test.html#cb314-33" tabindex="-1"></a>    , <span class="sc">-</span><span class="fu">c</span>(pct_rank_min)</span>
<span id="cb314-34"><a href="fusion_params_test.html#cb314-34" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb314-35"><a href="fusion_params_test.html#cb314-35" tabindex="-1"></a>  <span class="co"># get sort for lab</span></span>
<span id="cb314-36"><a href="fusion_params_test.html#cb314-36" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(lab) <span class="sc">%&gt;%</span> </span>
<span id="cb314-37"><a href="fusion_params_test.html#cb314-37" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">sort_lab =</span> pct_rank_pct_diff_volume_field_mape) <span class="sc">%&gt;%</span> </span>
<span id="cb314-38"><a href="fusion_params_test.html#cb314-38" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb314-39"><a href="fusion_params_test.html#cb314-39" tabindex="-1"></a>  <span class="co"># expand data to unique lab, pct_rank</span></span>
<span id="cb314-40"><a href="fusion_params_test.html#cb314-40" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(</span>
<span id="cb314-41"><a href="fusion_params_test.html#cb314-41" tabindex="-1"></a>    <span class="at">cols =</span> tidyselect<span class="sc">::</span><span class="fu">starts_with</span>(<span class="st">&quot;pct_rank&quot;</span>)</span>
<span id="cb314-42"><a href="fusion_params_test.html#cb314-42" tabindex="-1"></a>    , <span class="at">names_to =</span> <span class="st">&quot;metric&quot;</span></span>
<span id="cb314-43"><a href="fusion_params_test.html#cb314-43" tabindex="-1"></a>    , <span class="at">values_to =</span> <span class="st">&quot;value&quot;</span></span>
<span id="cb314-44"><a href="fusion_params_test.html#cb314-44" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb314-45"><a href="fusion_params_test.html#cb314-45" tabindex="-1"></a>  <span class="co"># keep only relevant records </span></span>
<span id="cb314-46"><a href="fusion_params_test.html#cb314-46" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(value<span class="sc">&lt;=</span>(<span class="dv">1</span><span class="sc">-</span>pct_rank_th_temp)) <span class="sc">%&gt;%</span> </span>
<span id="cb314-47"><a href="fusion_params_test.html#cb314-47" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(metric) <span class="sc">%&gt;%</span> </span>
<span id="cb314-48"><a href="fusion_params_test.html#cb314-48" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(pct_diff_volume_field_mape, pct_diff_diameter_mape, pct_diff_area_field_mape, pct_diff_height_mape) <span class="sc">%&gt;%</span> </span>
<span id="cb314-49"><a href="fusion_params_test.html#cb314-49" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(dplyr<span class="sc">::</span><span class="fu">row_number</span>()<span class="sc">&lt;=</span><span class="dv">12</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb314-50"><a href="fusion_params_test.html#cb314-50" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb314-51"><a href="fusion_params_test.html#cb314-51" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb314-52"><a href="fusion_params_test.html#cb314-52" tabindex="-1"></a>    <span class="at">rank_lab =</span> stringr<span class="sc">::</span><span class="fu">str_remove</span>(metric,<span class="st">&quot;pct_rank_&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb314-53"><a href="fusion_params_test.html#cb314-53" tabindex="-1"></a>      <span class="fu">factor</span>(</span>
<span id="cb314-54"><a href="fusion_params_test.html#cb314-54" tabindex="-1"></a>        <span class="at">ordered =</span> T</span>
<span id="cb314-55"><a href="fusion_params_test.html#cb314-55" tabindex="-1"></a>        , <span class="at">levels =</span> <span class="fu">c</span>(</span>
<span id="cb314-56"><a href="fusion_params_test.html#cb314-56" tabindex="-1"></a>          <span class="st">&quot;pct_diff_volume_field_mape&quot;</span></span>
<span id="cb314-57"><a href="fusion_params_test.html#cb314-57" tabindex="-1"></a>          , <span class="st">&quot;pct_diff_paraboloid_volume_field_mape&quot;</span></span>
<span id="cb314-58"><a href="fusion_params_test.html#cb314-58" tabindex="-1"></a>          , <span class="st">&quot;pct_diff_area_field_mape&quot;</span></span>
<span id="cb314-59"><a href="fusion_params_test.html#cb314-59" tabindex="-1"></a>          , <span class="st">&quot;pct_diff_height_mape&quot;</span></span>
<span id="cb314-60"><a href="fusion_params_test.html#cb314-60" tabindex="-1"></a>          , <span class="st">&quot;pct_diff_diameter_mape&quot;</span></span>
<span id="cb314-61"><a href="fusion_params_test.html#cb314-61" tabindex="-1"></a>        )</span>
<span id="cb314-62"><a href="fusion_params_test.html#cb314-62" tabindex="-1"></a>        , <span class="at">labels =</span> <span class="fu">c</span>(</span>
<span id="cb314-63"><a href="fusion_params_test.html#cb314-63" tabindex="-1"></a>          <span class="fu">paste0</span>(<span class="st">&quot;top &quot;</span>, scales<span class="sc">::</span><span class="fu">percent</span>(<span class="dv">1</span><span class="sc">-</span>pct_rank_th_temp, <span class="at">accuracy =</span> <span class="dv">1</span>), <span class="st">&quot; MAPE Volume irregular&quot;</span>) <span class="sc">%&gt;%</span> stringr<span class="sc">::</span><span class="fu">str_wrap</span>(<span class="at">width =</span> <span class="dv">14</span>)</span>
<span id="cb314-64"><a href="fusion_params_test.html#cb314-64" tabindex="-1"></a>          , <span class="fu">paste0</span>(<span class="st">&quot;top &quot;</span>, scales<span class="sc">::</span><span class="fu">percent</span>(<span class="dv">1</span><span class="sc">-</span>pct_rank_th_temp, <span class="at">accuracy =</span> <span class="dv">1</span>), <span class="st">&quot; MAPE Volume paraboloid&quot;</span>) <span class="sc">%&gt;%</span> stringr<span class="sc">::</span><span class="fu">str_wrap</span>(<span class="at">width =</span> <span class="dv">14</span>)</span>
<span id="cb314-65"><a href="fusion_params_test.html#cb314-65" tabindex="-1"></a>          , <span class="fu">paste0</span>(<span class="st">&quot;top &quot;</span>, scales<span class="sc">::</span><span class="fu">percent</span>(<span class="dv">1</span><span class="sc">-</span>pct_rank_th_temp, <span class="at">accuracy =</span> <span class="dv">1</span>), <span class="st">&quot; MAPE Area&quot;</span>) <span class="sc">%&gt;%</span> stringr<span class="sc">::</span><span class="fu">str_wrap</span>(<span class="at">width =</span> <span class="dv">14</span>)</span>
<span id="cb314-66"><a href="fusion_params_test.html#cb314-66" tabindex="-1"></a>          , <span class="fu">paste0</span>(<span class="st">&quot;top &quot;</span>, scales<span class="sc">::</span><span class="fu">percent</span>(<span class="dv">1</span><span class="sc">-</span>pct_rank_th_temp, <span class="at">accuracy =</span> <span class="dv">1</span>), <span class="st">&quot; MAPE Height&quot;</span>) <span class="sc">%&gt;%</span> stringr<span class="sc">::</span><span class="fu">str_wrap</span>(<span class="at">width =</span> <span class="dv">14</span>)</span>
<span id="cb314-67"><a href="fusion_params_test.html#cb314-67" tabindex="-1"></a>          , <span class="fu">paste0</span>(<span class="st">&quot;top &quot;</span>, scales<span class="sc">::</span><span class="fu">percent</span>(<span class="dv">1</span><span class="sc">-</span>pct_rank_th_temp, <span class="at">accuracy =</span> <span class="dv">1</span>), <span class="st">&quot; MAPE Diameter&quot;</span>) <span class="sc">%&gt;%</span> stringr<span class="sc">::</span><span class="fu">str_wrap</span>(<span class="at">width =</span> <span class="dv">14</span>)</span>
<span id="cb314-68"><a href="fusion_params_test.html#cb314-68" tabindex="-1"></a>        )</span>
<span id="cb314-69"><a href="fusion_params_test.html#cb314-69" tabindex="-1"></a>      )</span>
<span id="cb314-70"><a href="fusion_params_test.html#cb314-70" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb314-71"><a href="fusion_params_test.html#cb314-71" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(rank_lab) <span class="sc">%&gt;%</span> </span>
<span id="cb314-72"><a href="fusion_params_test.html#cb314-72" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(value) <span class="sc">%&gt;%</span> </span>
<span id="cb314-73"><a href="fusion_params_test.html#cb314-73" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(dplyr<span class="sc">::</span><span class="fu">row_number</span>()<span class="sc">&lt;=</span><span class="dv">12</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb314-74"><a href="fusion_params_test.html#cb314-74" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(metric,value)) <span class="sc">%&gt;%</span></span>
<span id="cb314-75"><a href="fusion_params_test.html#cb314-75" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>()</span>
<span id="cb314-76"><a href="fusion_params_test.html#cb314-76" tabindex="-1"></a></span>
<span id="cb314-77"><a href="fusion_params_test.html#cb314-77" tabindex="-1"></a>  <span class="co"># View()</span></span>
<span id="cb314-78"><a href="fusion_params_test.html#cb314-78" tabindex="-1"></a><span class="co"># df_temp %&gt;% dplyr::glimpse()</span></span>
<span id="cb314-79"><a href="fusion_params_test.html#cb314-79" tabindex="-1"></a></span>
<span id="cb314-80"><a href="fusion_params_test.html#cb314-80" tabindex="-1"></a>df_temp <span class="sc">%&gt;%</span> </span>
<span id="cb314-81"><a href="fusion_params_test.html#cb314-81" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(</span>
<span id="cb314-82"><a href="fusion_params_test.html#cb314-82" tabindex="-1"></a>    <span class="at">cols =</span> tidyselect<span class="sc">::</span><span class="fu">starts_with</span>(<span class="st">&quot;pct_diff_&quot;</span>)</span>
<span id="cb314-83"><a href="fusion_params_test.html#cb314-83" tabindex="-1"></a>    , <span class="at">names_to =</span> <span class="st">&quot;metric&quot;</span></span>
<span id="cb314-84"><a href="fusion_params_test.html#cb314-84" tabindex="-1"></a>    , <span class="at">values_to =</span> <span class="st">&quot;value&quot;</span></span>
<span id="cb314-85"><a href="fusion_params_test.html#cb314-85" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb314-86"><a href="fusion_params_test.html#cb314-86" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb314-87"><a href="fusion_params_test.html#cb314-87" tabindex="-1"></a>    <span class="at">metric =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb314-88"><a href="fusion_params_test.html#cb314-88" tabindex="-1"></a>        metric <span class="sc">==</span> <span class="st">&quot;pct_diff_volume_field_mape&quot;</span> <span class="sc">~</span> <span class="dv">1</span></span>
<span id="cb314-89"><a href="fusion_params_test.html#cb314-89" tabindex="-1"></a>        , metric <span class="sc">==</span> <span class="st">&quot;pct_diff_paraboloid_volume_field_mape&quot;</span> <span class="sc">~</span> <span class="dv">2</span></span>
<span id="cb314-90"><a href="fusion_params_test.html#cb314-90" tabindex="-1"></a>        , metric <span class="sc">==</span> <span class="st">&quot;pct_diff_area_field_mape&quot;</span> <span class="sc">~</span> <span class="dv">3</span></span>
<span id="cb314-91"><a href="fusion_params_test.html#cb314-91" tabindex="-1"></a>        , metric <span class="sc">==</span> <span class="st">&quot;pct_diff_height_mape&quot;</span> <span class="sc">~</span> <span class="dv">4</span></span>
<span id="cb314-92"><a href="fusion_params_test.html#cb314-92" tabindex="-1"></a>        , metric <span class="sc">==</span> <span class="st">&quot;pct_diff_diameter_mape&quot;</span> <span class="sc">~</span> <span class="dv">5</span></span>
<span id="cb314-93"><a href="fusion_params_test.html#cb314-93" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span> </span>
<span id="cb314-94"><a href="fusion_params_test.html#cb314-94" tabindex="-1"></a>      <span class="fu">factor</span>(</span>
<span id="cb314-95"><a href="fusion_params_test.html#cb314-95" tabindex="-1"></a>        <span class="at">ordered =</span> T</span>
<span id="cb314-96"><a href="fusion_params_test.html#cb314-96" tabindex="-1"></a>        , <span class="at">levels =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span></span>
<span id="cb314-97"><a href="fusion_params_test.html#cb314-97" tabindex="-1"></a>        , <span class="at">labels =</span> <span class="fu">c</span>(</span>
<span id="cb314-98"><a href="fusion_params_test.html#cb314-98" tabindex="-1"></a>          <span class="st">&quot;MAPE Volume irregular&quot;</span></span>
<span id="cb314-99"><a href="fusion_params_test.html#cb314-99" tabindex="-1"></a>          , <span class="st">&quot;MAPE Volume paraboloid&quot;</span></span>
<span id="cb314-100"><a href="fusion_params_test.html#cb314-100" tabindex="-1"></a>          , <span class="st">&quot;MAPE Area&quot;</span></span>
<span id="cb314-101"><a href="fusion_params_test.html#cb314-101" tabindex="-1"></a>          , <span class="st">&quot;MAPE Height&quot;</span></span>
<span id="cb314-102"><a href="fusion_params_test.html#cb314-102" tabindex="-1"></a>          , <span class="st">&quot;MAPE Diameter&quot;</span></span>
<span id="cb314-103"><a href="fusion_params_test.html#cb314-103" tabindex="-1"></a>        )</span>
<span id="cb314-104"><a href="fusion_params_test.html#cb314-104" tabindex="-1"></a>      )</span>
<span id="cb314-105"><a href="fusion_params_test.html#cb314-105" tabindex="-1"></a>    , <span class="at">lab =</span> forcats<span class="sc">::</span><span class="fu">fct_reorder</span>(lab, sort_lab) <span class="sc">%&gt;%</span> forcats<span class="sc">::</span><span class="fu">fct_rev</span>()</span>
<span id="cb314-106"><a href="fusion_params_test.html#cb314-106" tabindex="-1"></a>    , <span class="at">val_lab =</span> scales<span class="sc">::</span><span class="fu">percent</span>(value, <span class="at">accuracy =</span> <span class="fl">0.1</span>)</span>
<span id="cb314-107"><a href="fusion_params_test.html#cb314-107" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb314-108"><a href="fusion_params_test.html#cb314-108" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(</span>
<span id="cb314-109"><a href="fusion_params_test.html#cb314-109" tabindex="-1"></a>    <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">y =</span> lab, <span class="at">fill =</span> metric, <span class="at">label =</span> val_lab)</span>
<span id="cb314-110"><a href="fusion_params_test.html#cb314-110" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb314-111"><a href="fusion_params_test.html#cb314-111" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_col</span>(<span class="at">width =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb314-112"><a href="fusion_params_test.html#cb314-112" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_text</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">size =</span> <span class="dv">2</span>, <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb314-113"><a href="fusion_params_test.html#cb314-113" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_fill_viridis_d</span>(<span class="at">option =</span> <span class="st">&quot;turbo&quot;</span>) <span class="sc">+</span></span>
<span id="cb314-114"><a href="fusion_params_test.html#cb314-114" tabindex="-1"></a>  <span class="co"># ggplot2::scale_fill_manual(values = pal_get_pairs_fn(6)[1:5][c(1,3,5)]) +</span></span>
<span id="cb314-115"><a href="fusion_params_test.html#cb314-115" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_x_continuous</span>(</span>
<span id="cb314-116"><a href="fusion_params_test.html#cb314-116" tabindex="-1"></a>    <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">percent_format</span>(<span class="at">accuracy =</span> <span class="dv">1</span>)</span>
<span id="cb314-117"><a href="fusion_params_test.html#cb314-117" tabindex="-1"></a>    , <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">1.05</span>)</span>
<span id="cb314-118"><a href="fusion_params_test.html#cb314-118" tabindex="-1"></a>    <span class="co"># , expand = expansion(mult = c(0, .08))</span></span>
<span id="cb314-119"><a href="fusion_params_test.html#cb314-119" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb314-120"><a href="fusion_params_test.html#cb314-120" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">facet_grid</span>(<span class="at">cols =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(metric), <span class="at">rows =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(rank_lab), <span class="at">scales =</span> <span class="st">&quot;free_y&quot;</span>) <span class="sc">+</span></span>
<span id="cb314-121"><a href="fusion_params_test.html#cb314-121" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb314-122"><a href="fusion_params_test.html#cb314-122" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;&quot;</span>, <span class="at">y =</span> <span class="st">&quot;max_ht_m : max_area_m2 : convexity_pct : circle_fit_iou_pct : spectral_weight&quot;</span></span>
<span id="cb314-123"><a href="fusion_params_test.html#cb314-123" tabindex="-1"></a>    , <span class="at">fill =</span> <span class="st">&quot;&quot;</span></span>
<span id="cb314-124"><a href="fusion_params_test.html#cb314-124" tabindex="-1"></a>    , <span class="at">subtitle =</span> <span class="fu">paste0</span>(</span>
<span id="cb314-125"><a href="fusion_params_test.html#cb314-125" tabindex="-1"></a>       <span class="st">&quot;pile shape quantification accuracy for top &quot;</span></span>
<span id="cb314-126"><a href="fusion_params_test.html#cb314-126" tabindex="-1"></a>       , scales<span class="sc">::</span><span class="fu">percent</span>(<span class="dv">1</span><span class="sc">-</span>pct_rank_th_temp,<span class="at">accuracy=</span><span class="dv">1</span>)</span>
<span id="cb314-127"><a href="fusion_params_test.html#cb314-127" tabindex="-1"></a>       , <span class="st">&quot; of parameter combinations&quot;</span></span>
<span id="cb314-128"><a href="fusion_params_test.html#cb314-128" tabindex="-1"></a>    )</span>
<span id="cb314-129"><a href="fusion_params_test.html#cb314-129" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb314-130"><a href="fusion_params_test.html#cb314-130" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb314-131"><a href="fusion_params_test.html#cb314-131" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb314-132"><a href="fusion_params_test.html#cb314-132" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb314-133"><a href="fusion_params_test.html#cb314-133" tabindex="-1"></a>    , <span class="at">strip.text =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb314-134"><a href="fusion_params_test.html#cb314-134" tabindex="-1"></a>    , <span class="at">axis.text =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">6</span>)</span>
<span id="cb314-135"><a href="fusion_params_test.html#cb314-135" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-274-1.png" width="1008" /></p>
<p>glancing at the values of the <code>spectral_weight</code> parameter for this set indicates that there may not be overlap between the best parameter combinations for detecting slash piles and the combinations the best estimate pile form. this is the same result we saw when using only the structural data for detecting and quantifying slash piles (<a href="watershed-segmentation-sensitivity-testing.html#wshed_best_best">see here</a>). we’ll explore this further in the next section.</p>
<p>let’s make a table of these results</p>
<div class="sourceCode" id="cb315"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb315-1"><a href="fusion_params_test.html#cb315-1" tabindex="-1"></a>df_temp <span class="sc">%&gt;%</span> </span>
<span id="cb315-2"><a href="fusion_params_test.html#cb315-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb315-3"><a href="fusion_params_test.html#cb315-3" tabindex="-1"></a>    rank_lab</span>
<span id="cb315-4"><a href="fusion_params_test.html#cb315-4" tabindex="-1"></a>    , max_ht_m,max_area_m2,convexity_pct,circle_fit_iou_pct,spectral_weight</span>
<span id="cb315-5"><a href="fusion_params_test.html#cb315-5" tabindex="-1"></a>    , pct_diff_volume_field_mape, pct_diff_area_field_mape, pct_diff_height_mape, pct_diff_diameter_mape</span>
<span id="cb315-6"><a href="fusion_params_test.html#cb315-6" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb315-7"><a href="fusion_params_test.html#cb315-7" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb315-8"><a href="fusion_params_test.html#cb315-8" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(rank_lab,pct_diff_volume_field_mape, pct_diff_area_field_mape, pct_diff_height_mape, pct_diff_diameter_mape) <span class="sc">%&gt;%</span> </span>
<span id="cb315-9"><a href="fusion_params_test.html#cb315-9" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(dplyr<span class="sc">::</span><span class="fu">across</span>(</span>
<span id="cb315-10"><a href="fusion_params_test.html#cb315-10" tabindex="-1"></a>    <span class="at">.cols =</span> tidyselect<span class="sc">::</span><span class="fu">starts_with</span>(<span class="st">&quot;pct_diff_&quot;</span>)</span>
<span id="cb315-11"><a href="fusion_params_test.html#cb315-11" tabindex="-1"></a>    , <span class="at">.fn =</span> <span class="sc">~</span> scales<span class="sc">::</span><span class="fu">percent</span>(.x, <span class="at">accuracy =</span> <span class="dv">1</span>)</span>
<span id="cb315-12"><a href="fusion_params_test.html#cb315-12" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb315-13"><a href="fusion_params_test.html#cb315-13" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">blank=</span> <span class="st">&quot;   &quot;</span> ) <span class="sc">%&gt;%</span> </span>
<span id="cb315-14"><a href="fusion_params_test.html#cb315-14" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">relocate</span>(blank, <span class="at">.before =</span> pct_diff_volume_field_mape) <span class="sc">%&gt;%</span> </span>
<span id="cb315-15"><a href="fusion_params_test.html#cb315-15" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kbl</span>(</span>
<span id="cb315-16"><a href="fusion_params_test.html#cb315-16" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">&quot;parameter combinations that achieved the best slash pile form quantification results&quot;</span></span>
<span id="cb315-17"><a href="fusion_params_test.html#cb315-17" tabindex="-1"></a>    , <span class="at">col.names =</span> <span class="fu">c</span>(</span>
<span id="cb315-18"><a href="fusion_params_test.html#cb315-18" tabindex="-1"></a>      <span class="st">&quot;.&quot;</span></span>
<span id="cb315-19"><a href="fusion_params_test.html#cb315-19" tabindex="-1"></a>      ,<span class="st">&quot;max_ht_m&quot;</span>,<span class="st">&quot;max_area_m2&quot;</span>,<span class="st">&quot;convexity_pct&quot;</span>,<span class="st">&quot;circle_fit_iou_pct&quot;</span>,<span class="st">&quot;spectral_weight&quot;</span></span>
<span id="cb315-20"><a href="fusion_params_test.html#cb315-20" tabindex="-1"></a>      , <span class="st">&quot;   &quot;</span></span>
<span id="cb315-21"><a href="fusion_params_test.html#cb315-21" tabindex="-1"></a>      , <span class="st">&quot;MAPE Volume irregular&quot;</span></span>
<span id="cb315-22"><a href="fusion_params_test.html#cb315-22" tabindex="-1"></a>      , <span class="st">&quot;MAPE Area&quot;</span></span>
<span id="cb315-23"><a href="fusion_params_test.html#cb315-23" tabindex="-1"></a>      , <span class="st">&quot;MAPE Height&quot;</span></span>
<span id="cb315-24"><a href="fusion_params_test.html#cb315-24" tabindex="-1"></a>      , <span class="st">&quot;MAPE Diameter&quot;</span></span>
<span id="cb315-25"><a href="fusion_params_test.html#cb315-25" tabindex="-1"></a>    )</span>
<span id="cb315-26"><a href="fusion_params_test.html#cb315-26" tabindex="-1"></a>    , <span class="at">escape =</span> F</span>
<span id="cb315-27"><a href="fusion_params_test.html#cb315-27" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb315-28"><a href="fusion_params_test.html#cb315-28" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kable_styling</span>(<span class="at">font_size =</span> <span class="dv">11</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb315-29"><a href="fusion_params_test.html#cb315-29" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">collapse_rows</span>(<span class="at">columns =</span> <span class="dv">1</span>, <span class="at">valign =</span> <span class="st">&quot;top&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb315-30"><a href="fusion_params_test.html#cb315-30" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">add_header_above</span>(<span class="fu">c</span>(<span class="st">&quot; &quot;</span><span class="ot">=</span><span class="dv">7</span>, <span class="st">&quot;Evaluation Metric&quot;</span> <span class="ot">=</span> <span class="dv">4</span>))</span></code></pre></div>
<table class="table" style="font-size: 11px; margin-left: auto; margin-right: auto;">
<caption style="font-size: initial !important;">
<span id="tab:unnamed-chunk-275">Table 8.4: </span>parameter combinations that achieved the best slash pile form quantification results
</caption>
<thead>
<tr>
<th style="empty-cells: hide;border-bottom:hidden;" colspan="7">
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="4">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Evaluation Metric
</div>
</th>
</tr>
<tr>
<th style="text-align:left;">
.
</th>
<th style="text-align:right;">
max_ht_m
</th>
<th style="text-align:right;">
max_area_m2
</th>
<th style="text-align:right;">
convexity_pct
</th>
<th style="text-align:right;">
circle_fit_iou_pct
</th>
<th style="text-align:right;">
spectral_weight
</th>
<th style="text-align:left;">
</th>
<th style="text-align:left;">
MAPE Volume irregular
</th>
<th style="text-align:left;">
MAPE Area
</th>
<th style="text-align:left;">
MAPE Height
</th>
<th style="text-align:left;">
MAPE Diameter
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="12">
top 1%
MAPE Volume
irregular
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
0.3
</td>
<td style="text-align:right;">
0.8
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
10%
</td>
<td style="text-align:left;">
11%
</td>
<td style="text-align:left;">
14%
</td>
<td style="text-align:left;">
13%
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
0.4
</td>
<td style="text-align:right;">
0.8
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
10%
</td>
<td style="text-align:left;">
11%
</td>
<td style="text-align:left;">
14%
</td>
<td style="text-align:left;">
13%
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
0.5
</td>
<td style="text-align:right;">
0.8
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
10%
</td>
<td style="text-align:left;">
11%
</td>
<td style="text-align:left;">
14%
</td>
<td style="text-align:left;">
13%
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
0.6
</td>
<td style="text-align:right;">
0.8
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
10%
</td>
<td style="text-align:left;">
11%
</td>
<td style="text-align:left;">
14%
</td>
<td style="text-align:left;">
13%
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
0.7
</td>
<td style="text-align:right;">
0.8
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
10%
</td>
<td style="text-align:left;">
11%
</td>
<td style="text-align:left;">
14%
</td>
<td style="text-align:left;">
13%
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
0.8
</td>
<td style="text-align:right;">
0.8
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
10%
</td>
<td style="text-align:left;">
11%
</td>
<td style="text-align:left;">
14%
</td>
<td style="text-align:left;">
13%
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
0.3
</td>
<td style="text-align:right;">
0.8
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
10%
</td>
<td style="text-align:left;">
11%
</td>
<td style="text-align:left;">
14%
</td>
<td style="text-align:left;">
13%
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
0.4
</td>
<td style="text-align:right;">
0.8
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
10%
</td>
<td style="text-align:left;">
11%
</td>
<td style="text-align:left;">
14%
</td>
<td style="text-align:left;">
13%
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
0.5
</td>
<td style="text-align:right;">
0.8
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
10%
</td>
<td style="text-align:left;">
11%
</td>
<td style="text-align:left;">
14%
</td>
<td style="text-align:left;">
13%
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
0.6
</td>
<td style="text-align:right;">
0.8
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
10%
</td>
<td style="text-align:left;">
11%
</td>
<td style="text-align:left;">
14%
</td>
<td style="text-align:left;">
13%
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
0.7
</td>
<td style="text-align:right;">
0.8
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
10%
</td>
<td style="text-align:left;">
11%
</td>
<td style="text-align:left;">
14%
</td>
<td style="text-align:left;">
13%
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
0.8
</td>
<td style="text-align:right;">
0.8
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
10%
</td>
<td style="text-align:left;">
11%
</td>
<td style="text-align:left;">
14%
</td>
<td style="text-align:left;">
13%
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="12">
top 1% MAPE
Area
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
0.3
</td>
<td style="text-align:right;">
0.8
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
10%
</td>
<td style="text-align:left;">
11%
</td>
<td style="text-align:left;">
14%
</td>
<td style="text-align:left;">
13%
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
0.4
</td>
<td style="text-align:right;">
0.8
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
10%
</td>
<td style="text-align:left;">
11%
</td>
<td style="text-align:left;">
14%
</td>
<td style="text-align:left;">
13%
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
0.5
</td>
<td style="text-align:right;">
0.8
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
10%
</td>
<td style="text-align:left;">
11%
</td>
<td style="text-align:left;">
14%
</td>
<td style="text-align:left;">
13%
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
0.6
</td>
<td style="text-align:right;">
0.8
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
10%
</td>
<td style="text-align:left;">
11%
</td>
<td style="text-align:left;">
14%
</td>
<td style="text-align:left;">
13%
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
0.7
</td>
<td style="text-align:right;">
0.8
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
10%
</td>
<td style="text-align:left;">
11%
</td>
<td style="text-align:left;">
14%
</td>
<td style="text-align:left;">
13%
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
0.8
</td>
<td style="text-align:right;">
0.8
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
10%
</td>
<td style="text-align:left;">
11%
</td>
<td style="text-align:left;">
14%
</td>
<td style="text-align:left;">
13%
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
0.3
</td>
<td style="text-align:right;">
0.8
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
10%
</td>
<td style="text-align:left;">
11%
</td>
<td style="text-align:left;">
14%
</td>
<td style="text-align:left;">
13%
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
0.4
</td>
<td style="text-align:right;">
0.8
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
10%
</td>
<td style="text-align:left;">
11%
</td>
<td style="text-align:left;">
14%
</td>
<td style="text-align:left;">
13%
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
0.5
</td>
<td style="text-align:right;">
0.8
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
10%
</td>
<td style="text-align:left;">
11%
</td>
<td style="text-align:left;">
14%
</td>
<td style="text-align:left;">
13%
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
0.6
</td>
<td style="text-align:right;">
0.8
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
10%
</td>
<td style="text-align:left;">
11%
</td>
<td style="text-align:left;">
14%
</td>
<td style="text-align:left;">
13%
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
0.7
</td>
<td style="text-align:right;">
0.8
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
10%
</td>
<td style="text-align:left;">
11%
</td>
<td style="text-align:left;">
14%
</td>
<td style="text-align:left;">
13%
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
0.8
</td>
<td style="text-align:right;">
0.8
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
10%
</td>
<td style="text-align:left;">
11%
</td>
<td style="text-align:left;">
14%
</td>
<td style="text-align:left;">
13%
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="12">
top 1% MAPE
Height
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
0.3
</td>
<td style="text-align:right;">
0.8
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
19%
</td>
<td style="text-align:left;">
19%
</td>
<td style="text-align:left;">
11%
</td>
<td style="text-align:left;">
21%
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
0.4
</td>
<td style="text-align:right;">
0.8
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
19%
</td>
<td style="text-align:left;">
19%
</td>
<td style="text-align:left;">
11%
</td>
<td style="text-align:left;">
21%
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
0.5
</td>
<td style="text-align:right;">
0.8
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
19%
</td>
<td style="text-align:left;">
19%
</td>
<td style="text-align:left;">
11%
</td>
<td style="text-align:left;">
21%
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
0.6
</td>
<td style="text-align:right;">
0.8
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
19%
</td>
<td style="text-align:left;">
19%
</td>
<td style="text-align:left;">
11%
</td>
<td style="text-align:left;">
21%
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
0.7
</td>
<td style="text-align:right;">
0.8
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
19%
</td>
<td style="text-align:left;">
19%
</td>
<td style="text-align:left;">
11%
</td>
<td style="text-align:left;">
21%
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
0.8
</td>
<td style="text-align:right;">
0.8
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
19%
</td>
<td style="text-align:left;">
19%
</td>
<td style="text-align:left;">
11%
</td>
<td style="text-align:left;">
21%
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
0.3
</td>
<td style="text-align:right;">
0.7
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
20%
</td>
<td style="text-align:left;">
16%
</td>
<td style="text-align:left;">
11%
</td>
<td style="text-align:left;">
20%
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
0.4
</td>
<td style="text-align:right;">
0.7
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
20%
</td>
<td style="text-align:left;">
16%
</td>
<td style="text-align:left;">
11%
</td>
<td style="text-align:left;">
20%
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
0.5
</td>
<td style="text-align:right;">
0.7
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
20%
</td>
<td style="text-align:left;">
16%
</td>
<td style="text-align:left;">
11%
</td>
<td style="text-align:left;">
20%
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
0.6
</td>
<td style="text-align:right;">
0.7
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
20%
</td>
<td style="text-align:left;">
16%
</td>
<td style="text-align:left;">
11%
</td>
<td style="text-align:left;">
20%
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
0.7
</td>
<td style="text-align:right;">
0.7
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
20%
</td>
<td style="text-align:left;">
16%
</td>
<td style="text-align:left;">
11%
</td>
<td style="text-align:left;">
20%
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
0.3
</td>
<td style="text-align:right;">
0.8
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
23%
</td>
<td style="text-align:left;">
21%
</td>
<td style="text-align:left;">
10%
</td>
<td style="text-align:left;">
24%
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="12">
top 1% MAPE
Diameter
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
0.3
</td>
<td style="text-align:right;">
0.8
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
10%
</td>
<td style="text-align:left;">
11%
</td>
<td style="text-align:left;">
14%
</td>
<td style="text-align:left;">
13%
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
0.4
</td>
<td style="text-align:right;">
0.8
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
10%
</td>
<td style="text-align:left;">
11%
</td>
<td style="text-align:left;">
14%
</td>
<td style="text-align:left;">
13%
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
0.5
</td>
<td style="text-align:right;">
0.8
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
10%
</td>
<td style="text-align:left;">
11%
</td>
<td style="text-align:left;">
14%
</td>
<td style="text-align:left;">
13%
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
0.6
</td>
<td style="text-align:right;">
0.8
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
10%
</td>
<td style="text-align:left;">
11%
</td>
<td style="text-align:left;">
14%
</td>
<td style="text-align:left;">
13%
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
0.7
</td>
<td style="text-align:right;">
0.8
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
10%
</td>
<td style="text-align:left;">
11%
</td>
<td style="text-align:left;">
14%
</td>
<td style="text-align:left;">
13%
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
0.8
</td>
<td style="text-align:right;">
0.8
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
10%
</td>
<td style="text-align:left;">
11%
</td>
<td style="text-align:left;">
14%
</td>
<td style="text-align:left;">
13%
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
0.3
</td>
<td style="text-align:right;">
0.8
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
10%
</td>
<td style="text-align:left;">
11%
</td>
<td style="text-align:left;">
14%
</td>
<td style="text-align:left;">
13%
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
0.4
</td>
<td style="text-align:right;">
0.8
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
10%
</td>
<td style="text-align:left;">
11%
</td>
<td style="text-align:left;">
14%
</td>
<td style="text-align:left;">
13%
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
0.5
</td>
<td style="text-align:right;">
0.8
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
10%
</td>
<td style="text-align:left;">
11%
</td>
<td style="text-align:left;">
14%
</td>
<td style="text-align:left;">
13%
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
0.6
</td>
<td style="text-align:right;">
0.8
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
10%
</td>
<td style="text-align:left;">
11%
</td>
<td style="text-align:left;">
14%
</td>
<td style="text-align:left;">
13%
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
0.7
</td>
<td style="text-align:right;">
0.8
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
10%
</td>
<td style="text-align:left;">
11%
</td>
<td style="text-align:left;">
14%
</td>
<td style="text-align:left;">
13%
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
0.8
</td>
<td style="text-align:right;">
0.8
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
10%
</td>
<td style="text-align:left;">
11%
</td>
<td style="text-align:left;">
14%
</td>
<td style="text-align:left;">
13%
</td>
</tr>
</tbody>
</table>
<p>let’s use the value of <code>spectral_weight</code> that most frequently results in the best pile detection based on F-score (“4”) to compare results to not using any spectral data (i.e. just using structural data as outlined in our method <a href="raster_watershed.html#raster_watershed">here</a>). We’ll then average across all other factors to look at the main effect of <code>spectral_weight</code> after creating a dichotomous factor of structural only versus structural+spectral</p>
<div class="sourceCode" id="cb316"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb316-1"><a href="fusion_params_test.html#cb316-1" tabindex="-1"></a><span class="co"># quick mod</span></span>
<span id="cb316-2"><a href="fusion_params_test.html#cb316-2" tabindex="-1"></a>dep_vars_temp <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;pct_diff_volume_field_mape&quot;</span>, <span class="st">&quot;pct_diff_area_field_mape&quot;</span>, <span class="st">&quot;pct_diff_height_mape&quot;</span>, <span class="st">&quot;pct_diff_diameter_mape&quot;</span>)</span>
<span id="cb316-3"><a href="fusion_params_test.html#cb316-3" tabindex="-1"></a><span class="co"># list of formulas</span></span>
<span id="cb316-4"><a href="fusion_params_test.html#cb316-4" tabindex="-1"></a>formulas_temp <span class="ot">&lt;-</span> dep_vars_temp <span class="sc">%&gt;%</span> </span>
<span id="cb316-5"><a href="fusion_params_test.html#cb316-5" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">map</span>(<span class="sc">~</span>stats<span class="sc">::</span><span class="fu">reformulate</span>(<span class="fu">c</span>(<span class="st">&quot;spectral_weight_fact&quot;</span>,<span class="st">&quot;-1&quot;</span>), <span class="at">response =</span> .x))</span>
<span id="cb316-6"><a href="fusion_params_test.html#cb316-6" tabindex="-1"></a><span class="fu">names</span>(formulas_temp) <span class="ot">&lt;-</span> dep_vars_temp</span>
<span id="cb316-7"><a href="fusion_params_test.html#cb316-7" tabindex="-1"></a><span class="co"># formulas_temp</span></span>
<span id="cb316-8"><a href="fusion_params_test.html#cb316-8" tabindex="-1"></a>models_temp <span class="ot">&lt;-</span> formulas_temp <span class="sc">%&gt;%</span> </span>
<span id="cb316-9"><a href="fusion_params_test.html#cb316-9" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">map</span>(\(x) <span class="fu">lm</span>(<span class="at">formula =</span> x, <span class="at">data =</span> combos_df_temp))</span>
<span id="cb316-10"><a href="fusion_params_test.html#cb316-10" tabindex="-1"></a><span class="fu">names</span>(models_temp) <span class="ot">&lt;-</span> dep_vars_temp</span>
<span id="cb316-11"><a href="fusion_params_test.html#cb316-11" tabindex="-1"></a><span class="co"># models_temp</span></span>
<span id="cb316-12"><a href="fusion_params_test.html#cb316-12" tabindex="-1"></a><span class="co"># combine into df</span></span>
<span id="cb316-13"><a href="fusion_params_test.html#cb316-13" tabindex="-1"></a>pred_df_temp <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_df</span>(models_temp, broom<span class="sc">::</span>tidy, <span class="at">.id =</span> <span class="st">&quot;metric&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb316-14"><a href="fusion_params_test.html#cb316-14" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(statistic)) <span class="sc">%&gt;%</span> </span>
<span id="cb316-15"><a href="fusion_params_test.html#cb316-15" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb316-16"><a href="fusion_params_test.html#cb316-16" tabindex="-1"></a>    <span class="at">dep_var =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb316-17"><a href="fusion_params_test.html#cb316-17" tabindex="-1"></a>        metric <span class="sc">==</span> <span class="st">&quot;pct_diff_volume_field_mape&quot;</span> <span class="sc">~</span> <span class="dv">1</span></span>
<span id="cb316-18"><a href="fusion_params_test.html#cb316-18" tabindex="-1"></a>        , metric <span class="sc">==</span> <span class="st">&quot;pct_diff_paraboloid_volume_field_mape&quot;</span> <span class="sc">~</span> <span class="dv">2</span></span>
<span id="cb316-19"><a href="fusion_params_test.html#cb316-19" tabindex="-1"></a>        , metric <span class="sc">==</span> <span class="st">&quot;pct_diff_area_field_mape&quot;</span> <span class="sc">~</span> <span class="dv">3</span></span>
<span id="cb316-20"><a href="fusion_params_test.html#cb316-20" tabindex="-1"></a>        , metric <span class="sc">==</span> <span class="st">&quot;pct_diff_height_mape&quot;</span> <span class="sc">~</span> <span class="dv">4</span></span>
<span id="cb316-21"><a href="fusion_params_test.html#cb316-21" tabindex="-1"></a>        , metric <span class="sc">==</span> <span class="st">&quot;pct_diff_diameter_mape&quot;</span> <span class="sc">~</span> <span class="dv">5</span></span>
<span id="cb316-22"><a href="fusion_params_test.html#cb316-22" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span> </span>
<span id="cb316-23"><a href="fusion_params_test.html#cb316-23" tabindex="-1"></a>      <span class="fu">factor</span>(</span>
<span id="cb316-24"><a href="fusion_params_test.html#cb316-24" tabindex="-1"></a>        <span class="at">ordered =</span> T</span>
<span id="cb316-25"><a href="fusion_params_test.html#cb316-25" tabindex="-1"></a>        , <span class="at">levels =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span></span>
<span id="cb316-26"><a href="fusion_params_test.html#cb316-26" tabindex="-1"></a>        , <span class="at">labels =</span> <span class="fu">c</span>(</span>
<span id="cb316-27"><a href="fusion_params_test.html#cb316-27" tabindex="-1"></a>          <span class="st">&quot;MAPE Volume irregular&quot;</span></span>
<span id="cb316-28"><a href="fusion_params_test.html#cb316-28" tabindex="-1"></a>          , <span class="st">&quot;MAPE Volume paraboloid&quot;</span></span>
<span id="cb316-29"><a href="fusion_params_test.html#cb316-29" tabindex="-1"></a>          , <span class="st">&quot;MAPE Area field&quot;</span></span>
<span id="cb316-30"><a href="fusion_params_test.html#cb316-30" tabindex="-1"></a>          , <span class="st">&quot;MAPE Height&quot;</span></span>
<span id="cb316-31"><a href="fusion_params_test.html#cb316-31" tabindex="-1"></a>          , <span class="st">&quot;MAPE Diameter&quot;</span></span>
<span id="cb316-32"><a href="fusion_params_test.html#cb316-32" tabindex="-1"></a>        )</span>
<span id="cb316-33"><a href="fusion_params_test.html#cb316-33" tabindex="-1"></a>      )</span>
<span id="cb316-34"><a href="fusion_params_test.html#cb316-34" tabindex="-1"></a>    , <span class="at">term =</span> stringr<span class="sc">::</span><span class="fu">str_remove_all</span>(term, <span class="st">&quot;spectral_weight_fact&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">factor</span>()</span>
<span id="cb316-35"><a href="fusion_params_test.html#cb316-35" tabindex="-1"></a>    <span class="co"># to obtain the 95% confidence interval...</span></span>
<span id="cb316-36"><a href="fusion_params_test.html#cb316-36" tabindex="-1"></a>      <span class="co"># ...1.96 times the standard error is added and subtracted from the sample mean</span></span>
<span id="cb316-37"><a href="fusion_params_test.html#cb316-37" tabindex="-1"></a>    , <span class="at">ul =</span> estimate<span class="sc">+</span>std.error<span class="sc">*</span><span class="fl">1.96</span></span>
<span id="cb316-38"><a href="fusion_params_test.html#cb316-38" tabindex="-1"></a>    , <span class="at">ll =</span> estimate<span class="sc">-</span>std.error<span class="sc">*</span><span class="fl">1.96</span></span>
<span id="cb316-39"><a href="fusion_params_test.html#cb316-39" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb316-40"><a href="fusion_params_test.html#cb316-40" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">spectral_weight_fact=</span>term) <span class="sc">%&gt;%</span> </span>
<span id="cb316-41"><a href="fusion_params_test.html#cb316-41" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">relocate</span>(dep_var) <span class="sc">%&gt;%</span> </span>
<span id="cb316-42"><a href="fusion_params_test.html#cb316-42" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(dep_var,spectral_weight_fact)</span>
<span id="cb316-43"><a href="fusion_params_test.html#cb316-43" tabindex="-1"></a></span>
<span id="cb316-44"><a href="fusion_params_test.html#cb316-44" tabindex="-1"></a><span class="co"># pred_df_temp</span></span>
<span id="cb316-45"><a href="fusion_params_test.html#cb316-45" tabindex="-1"></a><span class="co"># table it</span></span>
<span id="cb316-46"><a href="fusion_params_test.html#cb316-46" tabindex="-1"></a>pred_df_temp <span class="sc">%&gt;%</span> </span>
<span id="cb316-47"><a href="fusion_params_test.html#cb316-47" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(metric,ul,ll)) <span class="sc">%&gt;%</span> </span>
<span id="cb316-48"><a href="fusion_params_test.html#cb316-48" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb316-49"><a href="fusion_params_test.html#cb316-49" tabindex="-1"></a>    <span class="at">estimate =</span> scales<span class="sc">::</span><span class="fu">percent</span>(estimate, <span class="at">accuracy =</span> <span class="fl">0.1</span>)</span>
<span id="cb316-50"><a href="fusion_params_test.html#cb316-50" tabindex="-1"></a>    , <span class="at">std.error =</span> scales<span class="sc">::</span><span class="fu">percent</span>(std.error, <span class="at">accuracy =</span> <span class="fl">0.01</span>)</span>
<span id="cb316-51"><a href="fusion_params_test.html#cb316-51" tabindex="-1"></a>    , <span class="at">p.value =</span> <span class="fu">ifelse</span>(</span>
<span id="cb316-52"><a href="fusion_params_test.html#cb316-52" tabindex="-1"></a>        p.value <span class="sc">&lt;</span> <span class="fl">0.001</span></span>
<span id="cb316-53"><a href="fusion_params_test.html#cb316-53" tabindex="-1"></a>        , <span class="st">&quot;&lt; 0.001&quot;</span></span>
<span id="cb316-54"><a href="fusion_params_test.html#cb316-54" tabindex="-1"></a>        , scales<span class="sc">::</span><span class="fu">comma</span>(p.value, <span class="at">accuracy =</span> <span class="fl">0.0001</span>)</span>
<span id="cb316-55"><a href="fusion_params_test.html#cb316-55" tabindex="-1"></a>      )</span>
<span id="cb316-56"><a href="fusion_params_test.html#cb316-56" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb316-57"><a href="fusion_params_test.html#cb316-57" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kbl</span>(</span>
<span id="cb316-58"><a href="fusion_params_test.html#cb316-58" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">&quot;Predictions for quantification accuracy metrics by detection method&lt;br&gt;averaging across all other structural detection parameters&quot;</span></span>
<span id="cb316-59"><a href="fusion_params_test.html#cb316-59" tabindex="-1"></a>    , <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">&quot;.&quot;</span>,<span class="st">&quot;method&quot;</span>,<span class="st">&quot;predicted mean&quot;</span>, <span class="st">&quot;SE&quot;</span>, <span class="st">&quot;p-value&quot;</span>)</span>
<span id="cb316-60"><a href="fusion_params_test.html#cb316-60" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb316-61"><a href="fusion_params_test.html#cb316-61" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kable_styling</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb316-62"><a href="fusion_params_test.html#cb316-62" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">collapse_rows</span>(<span class="at">columns =</span> <span class="dv">1</span>, <span class="at">valign =</span> <span class="st">&quot;top&quot;</span>)</span></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-276">Table 8.5: </span>Predictions for quantification accuracy metrics by detection method<br>averaging across all other structural detection parameters
</caption>
<thead>
<tr>
<th style="text-align:left;">
.
</th>
<th style="text-align:left;">
method
</th>
<th style="text-align:left;">
predicted mean
</th>
<th style="text-align:left;">
SE
</th>
<th style="text-align:left;">
p-value
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="2">
MAPE Volume irregular
</td>
<td style="text-align:left;">
structural only
</td>
<td style="text-align:left;">
31.2%
</td>
<td style="text-align:left;">
0.36%
</td>
<td style="text-align:left;">
&lt; 0.001
</td>
</tr>
<tr>
<td style="text-align:left;">
structural+spectral
</td>
<td style="text-align:left;">
31.2%
</td>
<td style="text-align:left;">
0.36%
</td>
<td style="text-align:left;">
&lt; 0.001
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="2">
MAPE Area field
</td>
<td style="text-align:left;">
structural only
</td>
<td style="text-align:left;">
23.9%
</td>
<td style="text-align:left;">
0.55%
</td>
<td style="text-align:left;">
&lt; 0.001
</td>
</tr>
<tr>
<td style="text-align:left;">
structural+spectral
</td>
<td style="text-align:left;">
23.9%
</td>
<td style="text-align:left;">
0.55%
</td>
<td style="text-align:left;">
&lt; 0.001
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="2">
MAPE Height
</td>
<td style="text-align:left;">
structural only
</td>
<td style="text-align:left;">
16.6%
</td>
<td style="text-align:left;">
1.68%
</td>
<td style="text-align:left;">
0.0101
</td>
</tr>
<tr>
<td style="text-align:left;">
structural+spectral
</td>
<td style="text-align:left;">
16.6%
</td>
<td style="text-align:left;">
1.68%
</td>
<td style="text-align:left;">
0.0101
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="2">
MAPE Diameter
</td>
<td style="text-align:left;">
structural only
</td>
<td style="text-align:left;">
25.6%
</td>
<td style="text-align:left;">
0.31%
</td>
<td style="text-align:left;">
&lt; 0.001
</td>
</tr>
<tr>
<td style="text-align:left;">
structural+spectral
</td>
<td style="text-align:left;">
25.6%
</td>
<td style="text-align:left;">
0.31%
</td>
<td style="text-align:left;">
&lt; 0.001
</td>
</tr>
</tbody>
</table>
<p>the spectral data does not alter the quantification of slash pile form. this is because spectral information is used solely to filter candidate piles, meaning it neither reshapes existing ones nor introduces new detections.</p>
</div>
<div id="best-results-detection-quantification" class="section level3 hasAnchor" number="8.3.7">
<h3><span class="header-section-number">8.3.7</span> Best results: detection &amp; quantification<a href="fusion_params_test.html#best-results-detection-quantification" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>as we saw in the sensitivity testing of the structural detection methodology (<a href="watershed-segmentation-sensitivity-testing.html#wshed_best_best">here</a>), there was not a clear a relationship between the quantification and detection accuracy metrics</p>
<p>we need to find the parameter combinations that result in the best balanced detection and quantification accuracy</p>
<div class="sourceCode" id="cb317"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb317-1"><a href="fusion_params_test.html#cb317-1" tabindex="-1"></a>param_combos_spectral_gt_agg <span class="sc">%&gt;%</span> </span>
<span id="cb317-2"><a href="fusion_params_test.html#cb317-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb317-3"><a href="fusion_params_test.html#cb317-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb317-4"><a href="fusion_params_test.html#cb317-4" tabindex="-1"></a>    rn,max_ht_m,max_area_m2,convexity_pct,circle_fit_iou_pct,spectral_weight</span>
<span id="cb317-5"><a href="fusion_params_test.html#cb317-5" tabindex="-1"></a>    , f_score</span>
<span id="cb317-6"><a href="fusion_params_test.html#cb317-6" tabindex="-1"></a>    <span class="co"># quantification accuracy</span></span>
<span id="cb317-7"><a href="fusion_params_test.html#cb317-7" tabindex="-1"></a>    , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_mape&quot;</span>)</span>
<span id="cb317-8"><a href="fusion_params_test.html#cb317-8" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb317-9"><a href="fusion_params_test.html#cb317-9" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(</span>
<span id="cb317-10"><a href="fusion_params_test.html#cb317-10" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">c</span>(tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_mape&quot;</span>))</span>
<span id="cb317-11"><a href="fusion_params_test.html#cb317-11" tabindex="-1"></a>    , <span class="at">names_to =</span> <span class="st">&quot;metric&quot;</span></span>
<span id="cb317-12"><a href="fusion_params_test.html#cb317-12" tabindex="-1"></a>    , <span class="at">values_to =</span> <span class="st">&quot;value&quot;</span></span>
<span id="cb317-13"><a href="fusion_params_test.html#cb317-13" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb317-14"><a href="fusion_params_test.html#cb317-14" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb317-15"><a href="fusion_params_test.html#cb317-15" tabindex="-1"></a>    <span class="at">eval_metric =</span> stringr<span class="sc">::</span><span class="fu">str_extract</span>(metric, <span class="st">&quot;(_rmse|_rrmse|_mean|_mape)$&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb317-16"><a href="fusion_params_test.html#cb317-16" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_remove_all</span>(<span class="st">&quot;_&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb317-17"><a href="fusion_params_test.html#cb317-17" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_replace_all</span>(<span class="st">&quot;mean&quot;</span>,<span class="st">&quot;me&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb317-18"><a href="fusion_params_test.html#cb317-18" tabindex="-1"></a>      <span class="fu">toupper</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb317-19"><a href="fusion_params_test.html#cb317-19" tabindex="-1"></a>      <span class="fu">factor</span>(</span>
<span id="cb317-20"><a href="fusion_params_test.html#cb317-20" tabindex="-1"></a>        <span class="at">ordered =</span> T</span>
<span id="cb317-21"><a href="fusion_params_test.html#cb317-21" tabindex="-1"></a>        , <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;ME&quot;</span>,<span class="st">&quot;RMSE&quot;</span>,<span class="st">&quot;RRMSE&quot;</span>,<span class="st">&quot;MAPE&quot;</span>)</span>
<span id="cb317-22"><a href="fusion_params_test.html#cb317-22" tabindex="-1"></a>      )</span>
<span id="cb317-23"><a href="fusion_params_test.html#cb317-23" tabindex="-1"></a>    , <span class="at">pile_metric =</span> metric <span class="sc">%&gt;%</span> </span>
<span id="cb317-24"><a href="fusion_params_test.html#cb317-24" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_remove</span>(<span class="st">&quot;(_rmse|_rrmse|_mean|_mape)$&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb317-25"><a href="fusion_params_test.html#cb317-25" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_extract</span>(<span class="st">&quot;(paraboloid_volume|volume|area|height|diameter)&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb317-26"><a href="fusion_params_test.html#cb317-26" tabindex="-1"></a>      <span class="fu">factor</span>(</span>
<span id="cb317-27"><a href="fusion_params_test.html#cb317-27" tabindex="-1"></a>        <span class="at">ordered =</span> T</span>
<span id="cb317-28"><a href="fusion_params_test.html#cb317-28" tabindex="-1"></a>        , <span class="at">levels =</span> <span class="fu">c</span>(</span>
<span id="cb317-29"><a href="fusion_params_test.html#cb317-29" tabindex="-1"></a>          <span class="st">&quot;volume&quot;</span></span>
<span id="cb317-30"><a href="fusion_params_test.html#cb317-30" tabindex="-1"></a>          , <span class="st">&quot;paraboloid_volume&quot;</span></span>
<span id="cb317-31"><a href="fusion_params_test.html#cb317-31" tabindex="-1"></a>          , <span class="st">&quot;area&quot;</span></span>
<span id="cb317-32"><a href="fusion_params_test.html#cb317-32" tabindex="-1"></a>          , <span class="st">&quot;height&quot;</span></span>
<span id="cb317-33"><a href="fusion_params_test.html#cb317-33" tabindex="-1"></a>          , <span class="st">&quot;diameter&quot;</span></span>
<span id="cb317-34"><a href="fusion_params_test.html#cb317-34" tabindex="-1"></a>        )</span>
<span id="cb317-35"><a href="fusion_params_test.html#cb317-35" tabindex="-1"></a>        , <span class="at">labels =</span> <span class="fu">c</span>(</span>
<span id="cb317-36"><a href="fusion_params_test.html#cb317-36" tabindex="-1"></a>          <span class="st">&quot;Volume&quot;</span></span>
<span id="cb317-37"><a href="fusion_params_test.html#cb317-37" tabindex="-1"></a>          , <span class="st">&quot;Volume paraboloid&quot;</span></span>
<span id="cb317-38"><a href="fusion_params_test.html#cb317-38" tabindex="-1"></a>          , <span class="st">&quot;Area&quot;</span></span>
<span id="cb317-39"><a href="fusion_params_test.html#cb317-39" tabindex="-1"></a>          , <span class="st">&quot;Height&quot;</span></span>
<span id="cb317-40"><a href="fusion_params_test.html#cb317-40" tabindex="-1"></a>          , <span class="st">&quot;Diameter&quot;</span></span>
<span id="cb317-41"><a href="fusion_params_test.html#cb317-41" tabindex="-1"></a>        )</span>
<span id="cb317-42"><a href="fusion_params_test.html#cb317-42" tabindex="-1"></a>      )</span>
<span id="cb317-43"><a href="fusion_params_test.html#cb317-43" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb317-44"><a href="fusion_params_test.html#cb317-44" tabindex="-1"></a>  <span class="co"># plot</span></span>
<span id="cb317-45"><a href="fusion_params_test.html#cb317-45" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> f_score, <span class="at">y =</span> value, <span class="at">color =</span> pile_metric)) <span class="sc">+</span></span>
<span id="cb317-46"><a href="fusion_params_test.html#cb317-46" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb317-47"><a href="fusion_params_test.html#cb317-47" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">facet_wrap</span>(<span class="at">facets =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(pile_metric)) <span class="sc">+</span></span>
<span id="cb317-48"><a href="fusion_params_test.html#cb317-48" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_color_viridis_d</span>(<span class="at">option =</span> <span class="st">&quot;turbo&quot;</span>) <span class="sc">+</span></span>
<span id="cb317-49"><a href="fusion_params_test.html#cb317-49" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_x_continuous</span>(</span>
<span id="cb317-50"><a href="fusion_params_test.html#cb317-50" tabindex="-1"></a>    <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">percent_format</span>(<span class="at">accuracy =</span> <span class="dv">1</span>)</span>
<span id="cb317-51"><a href="fusion_params_test.html#cb317-51" tabindex="-1"></a>    , <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)</span>
<span id="cb317-52"><a href="fusion_params_test.html#cb317-52" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb317-53"><a href="fusion_params_test.html#cb317-53" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_y_continuous</span>(</span>
<span id="cb317-54"><a href="fusion_params_test.html#cb317-54" tabindex="-1"></a>    <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">percent_format</span>(<span class="at">accuracy =</span> <span class="dv">1</span>)</span>
<span id="cb317-55"><a href="fusion_params_test.html#cb317-55" tabindex="-1"></a>    , <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="cn">NA</span>)</span>
<span id="cb317-56"><a href="fusion_params_test.html#cb317-56" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb317-57"><a href="fusion_params_test.html#cb317-57" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;F-Score&quot;</span>, <span class="at">y =</span> <span class="st">&quot;MAPE&quot;</span>) <span class="sc">+</span></span>
<span id="cb317-58"><a href="fusion_params_test.html#cb317-58" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb317-59"><a href="fusion_params_test.html#cb317-59" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb317-60"><a href="fusion_params_test.html#cb317-60" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb317-61"><a href="fusion_params_test.html#cb317-61" tabindex="-1"></a>    , <span class="at">strip.text =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb317-62"><a href="fusion_params_test.html#cb317-62" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-278-1.png" width="1008" /></p>
<p>aside from a distinct cluster of points at the lower end of the F-Score range, there does not appear to be a relationship between the pile form quantification and detection accuracy metrics</p>
<p>let’s look at only parameter combinations that are among the best in both detection and form quantification accuracy</p>
<p>we’ll use the F-Score and the average rank of the MAPE metrics across all form measurements to determine the best overall list</p>
<div class="sourceCode" id="cb318"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb318-1"><a href="fusion_params_test.html#cb318-1" tabindex="-1"></a>df_temp <span class="ot">&lt;-</span></span>
<span id="cb318-2"><a href="fusion_params_test.html#cb318-2" tabindex="-1"></a>  param_combos_spectral_gt_agg <span class="sc">%&gt;%</span></span>
<span id="cb318-3"><a href="fusion_params_test.html#cb318-3" tabindex="-1"></a>  <span class="co"># dplyr::select(c(tidyselect::ends_with(&quot;_mape&quot;) &amp; tidyselect::contains(&quot;volume&quot;))) %&gt;% names()</span></span>
<span id="cb318-4"><a href="fusion_params_test.html#cb318-4" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb318-5"><a href="fusion_params_test.html#cb318-5" tabindex="-1"></a>    <span class="co"># label combining params</span></span>
<span id="cb318-6"><a href="fusion_params_test.html#cb318-6" tabindex="-1"></a>    <span class="at">lab =</span> stringr<span class="sc">::</span><span class="fu">str_c</span>(max_ht_m,max_area_m2,convexity_pct,circle_fit_iou_pct,spectral_weight, <span class="at">sep =</span> <span class="st">&quot;:&quot;</span>)</span>
<span id="cb318-7"><a href="fusion_params_test.html#cb318-7" tabindex="-1"></a>    , dplyr<span class="sc">::</span><span class="fu">across</span>(</span>
<span id="cb318-8"><a href="fusion_params_test.html#cb318-8" tabindex="-1"></a>      <span class="at">.cols =</span> <span class="fu">c</span>(tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_mape&quot;</span>))</span>
<span id="cb318-9"><a href="fusion_params_test.html#cb318-9" tabindex="-1"></a>      <span class="co"># .cols = c(tidyselect::ends_with(&quot;_mape&quot;) &amp; tidyselect::contains(&quot;volume&quot;))</span></span>
<span id="cb318-10"><a href="fusion_params_test.html#cb318-10" tabindex="-1"></a>      , <span class="at">.fn =</span> <span class="sc">~</span>dplyr<span class="sc">::</span><span class="fu">percent_rank</span>(<span class="sc">-</span>.x)</span>
<span id="cb318-11"><a href="fusion_params_test.html#cb318-11" tabindex="-1"></a>      , <span class="at">.names =</span> <span class="st">&quot;pct_rank_quant_{.col}&quot;</span></span>
<span id="cb318-12"><a href="fusion_params_test.html#cb318-12" tabindex="-1"></a>    )</span>
<span id="cb318-13"><a href="fusion_params_test.html#cb318-13" tabindex="-1"></a>    , dplyr<span class="sc">::</span><span class="fu">across</span>(</span>
<span id="cb318-14"><a href="fusion_params_test.html#cb318-14" tabindex="-1"></a>      <span class="at">.cols =</span> <span class="fu">c</span>(f_score)</span>
<span id="cb318-15"><a href="fusion_params_test.html#cb318-15" tabindex="-1"></a>      <span class="co"># .cols = c(f_score,recall)</span></span>
<span id="cb318-16"><a href="fusion_params_test.html#cb318-16" tabindex="-1"></a>      , <span class="at">.fn =</span> <span class="sc">~</span>dplyr<span class="sc">::</span><span class="fu">percent_rank</span>(.x)</span>
<span id="cb318-17"><a href="fusion_params_test.html#cb318-17" tabindex="-1"></a>      , <span class="at">.names =</span> <span class="st">&quot;pct_rank_det_{.col}&quot;</span></span>
<span id="cb318-18"><a href="fusion_params_test.html#cb318-18" tabindex="-1"></a>    )</span>
<span id="cb318-19"><a href="fusion_params_test.html#cb318-19" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb318-20"><a href="fusion_params_test.html#cb318-20" tabindex="-1"></a>  <span class="co"># dplyr::arrange(pct_diff_paraboloid_volume_field_mape) %&gt;%</span></span>
<span id="cb318-21"><a href="fusion_params_test.html#cb318-21" tabindex="-1"></a>  <span class="co"># dplyr::select(pct_diff_diameter_mape, pct_rank_pct_diff_paraboloid_volume_field_mape) %&gt;%</span></span>
<span id="cb318-22"><a href="fusion_params_test.html#cb318-22" tabindex="-1"></a>  <span class="co"># View()</span></span>
<span id="cb318-23"><a href="fusion_params_test.html#cb318-23" tabindex="-1"></a>  <span class="co"># now get the max of these pct ranks by row</span></span>
<span id="cb318-24"><a href="fusion_params_test.html#cb318-24" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rowwise</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb318-25"><a href="fusion_params_test.html#cb318-25" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb318-26"><a href="fusion_params_test.html#cb318-26" tabindex="-1"></a>    <span class="at">pct_rank_quant_mean =</span> <span class="fu">mean</span>(</span>
<span id="cb318-27"><a href="fusion_params_test.html#cb318-27" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">c_across</span>(</span>
<span id="cb318-28"><a href="fusion_params_test.html#cb318-28" tabindex="-1"></a>        tidyselect<span class="sc">::</span><span class="fu">starts_with</span>(<span class="st">&quot;pct_rank_quant_&quot;</span>)</span>
<span id="cb318-29"><a href="fusion_params_test.html#cb318-29" tabindex="-1"></a>      )</span>
<span id="cb318-30"><a href="fusion_params_test.html#cb318-30" tabindex="-1"></a>      , <span class="at">na.rm =</span> T</span>
<span id="cb318-31"><a href="fusion_params_test.html#cb318-31" tabindex="-1"></a>    )</span>
<span id="cb318-32"><a href="fusion_params_test.html#cb318-32" tabindex="-1"></a>    , <span class="at">pct_rank_det_mean =</span> <span class="fu">mean</span>(</span>
<span id="cb318-33"><a href="fusion_params_test.html#cb318-33" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">c_across</span>(</span>
<span id="cb318-34"><a href="fusion_params_test.html#cb318-34" tabindex="-1"></a>        tidyselect<span class="sc">::</span><span class="fu">starts_with</span>(<span class="st">&quot;pct_rank_det_&quot;</span>)</span>
<span id="cb318-35"><a href="fusion_params_test.html#cb318-35" tabindex="-1"></a>      )</span>
<span id="cb318-36"><a href="fusion_params_test.html#cb318-36" tabindex="-1"></a>      , <span class="at">na.rm =</span> T</span>
<span id="cb318-37"><a href="fusion_params_test.html#cb318-37" tabindex="-1"></a>    )</span>
<span id="cb318-38"><a href="fusion_params_test.html#cb318-38" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb318-39"><a href="fusion_params_test.html#cb318-39" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb318-40"><a href="fusion_params_test.html#cb318-40" tabindex="-1"></a>  <span class="co"># now make quadrant var</span></span>
<span id="cb318-41"><a href="fusion_params_test.html#cb318-41" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb318-42"><a href="fusion_params_test.html#cb318-42" tabindex="-1"></a>    <span class="co"># this is for the quadrant plot</span></span>
<span id="cb318-43"><a href="fusion_params_test.html#cb318-43" tabindex="-1"></a>    <span class="at">overall_accuracy =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb318-44"><a href="fusion_params_test.html#cb318-44" tabindex="-1"></a>      pct_rank_det_mean<span class="sc">&gt;=</span><span class="fl">0.95</span> <span class="sc">&amp;</span> pct_rank_quant_mean<span class="sc">&gt;=</span><span class="fl">0.95</span> <span class="sc">~</span> <span class="dv">1</span></span>
<span id="cb318-45"><a href="fusion_params_test.html#cb318-45" tabindex="-1"></a>      , pct_rank_det_mean<span class="sc">&gt;=</span><span class="fl">0.90</span> <span class="sc">&amp;</span> pct_rank_quant_mean<span class="sc">&gt;=</span><span class="fl">0.90</span> <span class="sc">~</span> <span class="dv">2</span></span>
<span id="cb318-46"><a href="fusion_params_test.html#cb318-46" tabindex="-1"></a>      , pct_rank_det_mean<span class="sc">&gt;=</span><span class="fl">0.75</span> <span class="sc">&amp;</span> pct_rank_quant_mean<span class="sc">&gt;=</span><span class="fl">0.75</span> <span class="sc">~</span> <span class="dv">3</span></span>
<span id="cb318-47"><a href="fusion_params_test.html#cb318-47" tabindex="-1"></a>      , pct_rank_det_mean<span class="sc">&gt;=</span><span class="fl">0.50</span> <span class="sc">&amp;</span> pct_rank_quant_mean<span class="sc">&gt;=</span><span class="fl">0.50</span> <span class="sc">~</span> <span class="dv">4</span></span>
<span id="cb318-48"><a href="fusion_params_test.html#cb318-48" tabindex="-1"></a>      , pct_rank_det_mean<span class="sc">&gt;=</span><span class="fl">0.50</span> <span class="sc">&amp;</span> pct_rank_quant_mean<span class="sc">&lt;</span><span class="fl">0.50</span> <span class="sc">~</span> <span class="dv">5</span></span>
<span id="cb318-49"><a href="fusion_params_test.html#cb318-49" tabindex="-1"></a>      , pct_rank_det_mean<span class="sc">&lt;</span><span class="fl">0.50</span> <span class="sc">&amp;</span> pct_rank_quant_mean<span class="sc">&gt;=</span><span class="fl">0.50</span> <span class="sc">~</span> <span class="dv">6</span></span>
<span id="cb318-50"><a href="fusion_params_test.html#cb318-50" tabindex="-1"></a>      , T <span class="sc">~</span> <span class="dv">7</span></span>
<span id="cb318-51"><a href="fusion_params_test.html#cb318-51" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb318-52"><a href="fusion_params_test.html#cb318-52" tabindex="-1"></a>    <span class="fu">factor</span>(</span>
<span id="cb318-53"><a href="fusion_params_test.html#cb318-53" tabindex="-1"></a>      <span class="at">ordered =</span> T</span>
<span id="cb318-54"><a href="fusion_params_test.html#cb318-54" tabindex="-1"></a>      , <span class="at">levels =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">7</span></span>
<span id="cb318-55"><a href="fusion_params_test.html#cb318-55" tabindex="-1"></a>      , <span class="at">labels =</span> <span class="fu">c</span>(</span>
<span id="cb318-56"><a href="fusion_params_test.html#cb318-56" tabindex="-1"></a>        <span class="st">&quot;top 5% detection &amp; quantification&quot;</span> <span class="co"># pct_rank_mean&gt;=0.95 &amp; pct_rank_f_score&gt;=0.95 ~ 1</span></span>
<span id="cb318-57"><a href="fusion_params_test.html#cb318-57" tabindex="-1"></a>        , <span class="st">&quot;top 10% detection &amp; quantification&quot;</span> <span class="co"># pct_rank_mean&gt;=0.90 &amp; pct_rank_f_score&gt;=0.90 ~ 2</span></span>
<span id="cb318-58"><a href="fusion_params_test.html#cb318-58" tabindex="-1"></a>        , <span class="st">&quot;top 25% detection &amp; quantification&quot;</span> <span class="co"># pct_rank_mean&gt;=0.75 &amp; pct_rank_f_score&gt;=0.75 ~ 3</span></span>
<span id="cb318-59"><a href="fusion_params_test.html#cb318-59" tabindex="-1"></a>        , <span class="st">&quot;top 50% detection &amp; quantification&quot;</span> <span class="co"># pct_rank_mean&gt;=0.50 &amp; pct_rank_f_score&gt;=0.50 ~ 4</span></span>
<span id="cb318-60"><a href="fusion_params_test.html#cb318-60" tabindex="-1"></a>        , <span class="st">&quot;top 50% quantification&quot;</span> <span class="co"># pct_rank_mean&gt;=0.50 &amp; pct_rank_f_score&lt;0.50 ~ 5</span></span>
<span id="cb318-61"><a href="fusion_params_test.html#cb318-61" tabindex="-1"></a>        , <span class="st">&quot;top 50% detection&quot;</span> <span class="co"># pct_rank_mean&lt;0.50 &amp; pct_rank_f_score&gt;=0.50 ~ 6</span></span>
<span id="cb318-62"><a href="fusion_params_test.html#cb318-62" tabindex="-1"></a>        , <span class="st">&quot;bottom 50% detection &amp; quantification&quot;</span></span>
<span id="cb318-63"><a href="fusion_params_test.html#cb318-63" tabindex="-1"></a>      )</span>
<span id="cb318-64"><a href="fusion_params_test.html#cb318-64" tabindex="-1"></a>    )</span>
<span id="cb318-65"><a href="fusion_params_test.html#cb318-65" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb318-66"><a href="fusion_params_test.html#cb318-66" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb318-67"><a href="fusion_params_test.html#cb318-67" tabindex="-1"></a>    rn,max_ht_m,max_area_m2,convexity_pct,circle_fit_iou_pct,spectral_weight</span>
<span id="cb318-68"><a href="fusion_params_test.html#cb318-68" tabindex="-1"></a>    , lab</span>
<span id="cb318-69"><a href="fusion_params_test.html#cb318-69" tabindex="-1"></a>    , f_score, recall, precision</span>
<span id="cb318-70"><a href="fusion_params_test.html#cb318-70" tabindex="-1"></a>    , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_mape&quot;</span>)</span>
<span id="cb318-71"><a href="fusion_params_test.html#cb318-71" tabindex="-1"></a>    , tidyselect<span class="sc">::</span><span class="fu">starts_with</span>(<span class="st">&quot;pct_rank&quot;</span>)</span>
<span id="cb318-72"><a href="fusion_params_test.html#cb318-72" tabindex="-1"></a>    , overall_accuracy</span>
<span id="cb318-73"><a href="fusion_params_test.html#cb318-73" tabindex="-1"></a>  )</span>
<span id="cb318-74"><a href="fusion_params_test.html#cb318-74" tabindex="-1"></a></span>
<span id="cb318-75"><a href="fusion_params_test.html#cb318-75" tabindex="-1"></a><span class="co"># plot</span></span>
<span id="cb318-76"><a href="fusion_params_test.html#cb318-76" tabindex="-1"></a>df_temp <span class="sc">%&gt;%</span>   </span>
<span id="cb318-77"><a href="fusion_params_test.html#cb318-77" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(</span>
<span id="cb318-78"><a href="fusion_params_test.html#cb318-78" tabindex="-1"></a>    <span class="at">mapping=</span>ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> pct_rank_det_mean, <span class="at">y =</span> pct_rank_quant_mean, <span class="at">color =</span> overall_accuracy)</span>
<span id="cb318-79"><a href="fusion_params_test.html#cb318-79" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb318-80"><a href="fusion_params_test.html#cb318-80" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fl">0.5</span>, <span class="at">color =</span> <span class="st">&quot;gray22&quot;</span>) <span class="sc">+</span></span>
<span id="cb318-81"><a href="fusion_params_test.html#cb318-81" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fl">0.5</span>, <span class="at">color =</span> <span class="st">&quot;gray22&quot;</span>) <span class="sc">+</span></span>
<span id="cb318-82"><a href="fusion_params_test.html#cb318-82" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fl">0.75</span>, <span class="at">color =</span> <span class="st">&quot;gray44&quot;</span>) <span class="sc">+</span></span>
<span id="cb318-83"><a href="fusion_params_test.html#cb318-83" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fl">0.75</span>, <span class="at">color =</span> <span class="st">&quot;gray44&quot;</span>) <span class="sc">+</span></span>
<span id="cb318-84"><a href="fusion_params_test.html#cb318-84" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fl">0.9</span>, <span class="at">color =</span> <span class="st">&quot;gray66&quot;</span>) <span class="sc">+</span></span>
<span id="cb318-85"><a href="fusion_params_test.html#cb318-85" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fl">0.9</span>, <span class="at">color =</span> <span class="st">&quot;gray66&quot;</span>) <span class="sc">+</span></span>
<span id="cb318-86"><a href="fusion_params_test.html#cb318-86" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb318-87"><a href="fusion_params_test.html#cb318-87" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_colour_viridis_d</span>(<span class="at">option =</span> <span class="st">&quot;inferno&quot;</span>, <span class="at">end =</span> <span class="fl">0.8</span>, <span class="at">direction =</span> <span class="sc">-</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb318-88"><a href="fusion_params_test.html#cb318-88" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_x_continuous</span>(</span>
<span id="cb318-89"><a href="fusion_params_test.html#cb318-89" tabindex="-1"></a>    <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">percent_format</span>(<span class="at">accuracy =</span> <span class="dv">1</span>)</span>
<span id="cb318-90"><a href="fusion_params_test.html#cb318-90" tabindex="-1"></a>    , <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)</span>
<span id="cb318-91"><a href="fusion_params_test.html#cb318-91" tabindex="-1"></a>  ) <span class="sc">+</span>  </span>
<span id="cb318-92"><a href="fusion_params_test.html#cb318-92" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_y_continuous</span>(</span>
<span id="cb318-93"><a href="fusion_params_test.html#cb318-93" tabindex="-1"></a>    <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">percent_format</span>(<span class="at">accuracy =</span> <span class="dv">1</span>)</span>
<span id="cb318-94"><a href="fusion_params_test.html#cb318-94" tabindex="-1"></a>    , <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)</span>
<span id="cb318-95"><a href="fusion_params_test.html#cb318-95" tabindex="-1"></a>  ) <span class="sc">+</span>  </span>
<span id="cb318-96"><a href="fusion_params_test.html#cb318-96" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb318-97"><a href="fusion_params_test.html#cb318-97" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;Percentile F-Score&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Percentile MAPE (mean)&quot;</span></span>
<span id="cb318-98"><a href="fusion_params_test.html#cb318-98" tabindex="-1"></a>    , <span class="at">color =</span> <span class="st">&quot;&quot;</span></span>
<span id="cb318-99"><a href="fusion_params_test.html#cb318-99" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb318-100"><a href="fusion_params_test.html#cb318-100" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb318-101"><a href="fusion_params_test.html#cb318-101" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb318-102"><a href="fusion_params_test.html#cb318-102" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span></span>
<span id="cb318-103"><a href="fusion_params_test.html#cb318-103" tabindex="-1"></a>    , <span class="at">legend.text =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>)</span>
<span id="cb318-104"><a href="fusion_params_test.html#cb318-104" tabindex="-1"></a>    , <span class="at">strip.text =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb318-105"><a href="fusion_params_test.html#cb318-105" tabindex="-1"></a>    , <span class="at">axis.text =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">7</span>)</span>
<span id="cb318-106"><a href="fusion_params_test.html#cb318-106" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb318-107"><a href="fusion_params_test.html#cb318-107" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">guides</span>(</span>
<span id="cb318-108"><a href="fusion_params_test.html#cb318-108" tabindex="-1"></a>    <span class="at">color =</span> ggplot2<span class="sc">::</span><span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">shape =</span> <span class="dv">15</span>, <span class="at">linetype =</span> <span class="dv">0</span>, <span class="at">size =</span> <span class="dv">5</span>, <span class="at">alpha =</span> <span class="dv">1</span>))</span>
<span id="cb318-109"><a href="fusion_params_test.html#cb318-109" tabindex="-1"></a>    , <span class="at">shape =</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb318-110"><a href="fusion_params_test.html#cb318-110" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-279-1.png" width="1008" /></p>
<p>before we look at the parameter combinations that are in the upper-right of the quadrant plot, let’s color this by the <code>spectral_weight</code> parameter to look for patterns</p>
<div class="sourceCode" id="cb319"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb319-1"><a href="fusion_params_test.html#cb319-1" tabindex="-1"></a><span class="co"># plot</span></span>
<span id="cb319-2"><a href="fusion_params_test.html#cb319-2" tabindex="-1"></a>df_temp <span class="sc">%&gt;%</span>   </span>
<span id="cb319-3"><a href="fusion_params_test.html#cb319-3" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(</span>
<span id="cb319-4"><a href="fusion_params_test.html#cb319-4" tabindex="-1"></a>    <span class="at">mapping=</span>ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> pct_rank_det_mean, <span class="at">y =</span> pct_rank_quant_mean, <span class="at">color =</span> <span class="fu">factor</span>(spectral_weight))</span>
<span id="cb319-5"><a href="fusion_params_test.html#cb319-5" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb319-6"><a href="fusion_params_test.html#cb319-6" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fl">0.5</span>, <span class="at">color =</span> <span class="st">&quot;gray22&quot;</span>) <span class="sc">+</span></span>
<span id="cb319-7"><a href="fusion_params_test.html#cb319-7" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fl">0.5</span>, <span class="at">color =</span> <span class="st">&quot;gray22&quot;</span>) <span class="sc">+</span></span>
<span id="cb319-8"><a href="fusion_params_test.html#cb319-8" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fl">0.75</span>, <span class="at">color =</span> <span class="st">&quot;gray44&quot;</span>) <span class="sc">+</span></span>
<span id="cb319-9"><a href="fusion_params_test.html#cb319-9" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fl">0.75</span>, <span class="at">color =</span> <span class="st">&quot;gray44&quot;</span>) <span class="sc">+</span></span>
<span id="cb319-10"><a href="fusion_params_test.html#cb319-10" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fl">0.9</span>, <span class="at">color =</span> <span class="st">&quot;gray66&quot;</span>) <span class="sc">+</span></span>
<span id="cb319-11"><a href="fusion_params_test.html#cb319-11" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fl">0.9</span>, <span class="at">color =</span> <span class="st">&quot;gray66&quot;</span>) <span class="sc">+</span></span>
<span id="cb319-12"><a href="fusion_params_test.html#cb319-12" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb319-13"><a href="fusion_params_test.html#cb319-13" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_color_viridis_d</span>(<span class="at">begin =</span> <span class="fl">0.1</span>,<span class="at">end=</span><span class="fl">0.9</span>) <span class="sc">+</span></span>
<span id="cb319-14"><a href="fusion_params_test.html#cb319-14" tabindex="-1"></a>  <span class="co"># ggplot2::scale_colour_viridis_d(option = &quot;viridis&quot;, end = 0.8, direction = -1) +</span></span>
<span id="cb319-15"><a href="fusion_params_test.html#cb319-15" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_x_continuous</span>(</span>
<span id="cb319-16"><a href="fusion_params_test.html#cb319-16" tabindex="-1"></a>    <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">percent_format</span>(<span class="at">accuracy =</span> <span class="dv">1</span>)</span>
<span id="cb319-17"><a href="fusion_params_test.html#cb319-17" tabindex="-1"></a>    , <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)</span>
<span id="cb319-18"><a href="fusion_params_test.html#cb319-18" tabindex="-1"></a>  ) <span class="sc">+</span>  </span>
<span id="cb319-19"><a href="fusion_params_test.html#cb319-19" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_y_continuous</span>(</span>
<span id="cb319-20"><a href="fusion_params_test.html#cb319-20" tabindex="-1"></a>    <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">percent_format</span>(<span class="at">accuracy =</span> <span class="dv">1</span>)</span>
<span id="cb319-21"><a href="fusion_params_test.html#cb319-21" tabindex="-1"></a>    , <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)</span>
<span id="cb319-22"><a href="fusion_params_test.html#cb319-22" tabindex="-1"></a>  ) <span class="sc">+</span>  </span>
<span id="cb319-23"><a href="fusion_params_test.html#cb319-23" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb319-24"><a href="fusion_params_test.html#cb319-24" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;Percentile F-Score&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Percentile MAPE (mean)&quot;</span></span>
<span id="cb319-25"><a href="fusion_params_test.html#cb319-25" tabindex="-1"></a>    , <span class="at">color =</span> <span class="st">&quot;spectral_weight&quot;</span></span>
<span id="cb319-26"><a href="fusion_params_test.html#cb319-26" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb319-27"><a href="fusion_params_test.html#cb319-27" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb319-28"><a href="fusion_params_test.html#cb319-28" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb319-29"><a href="fusion_params_test.html#cb319-29" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span></span>
<span id="cb319-30"><a href="fusion_params_test.html#cb319-30" tabindex="-1"></a>    , <span class="at">legend.text =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>)</span>
<span id="cb319-31"><a href="fusion_params_test.html#cb319-31" tabindex="-1"></a>    , <span class="at">strip.text =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb319-32"><a href="fusion_params_test.html#cb319-32" tabindex="-1"></a>    , <span class="at">axis.text =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">7</span>)</span>
<span id="cb319-33"><a href="fusion_params_test.html#cb319-33" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb319-34"><a href="fusion_params_test.html#cb319-34" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">guides</span>(</span>
<span id="cb319-35"><a href="fusion_params_test.html#cb319-35" tabindex="-1"></a>    <span class="at">color =</span> ggplot2<span class="sc">::</span><span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">shape =</span> <span class="dv">15</span>, <span class="at">linetype =</span> <span class="dv">0</span>, <span class="at">size =</span> <span class="dv">5</span>, <span class="at">alpha =</span> <span class="dv">1</span>))</span>
<span id="cb319-36"><a href="fusion_params_test.html#cb319-36" tabindex="-1"></a>    , <span class="at">shape =</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb319-37"><a href="fusion_params_test.html#cb319-37" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-280-1.png" width="1008" /></p>
<p>as we already discovered from our investigation of the top performing method based on pile detection accuracy, having the <code>spectral_weight</code> parameter set to 3, 4, or 5 results in the best detection. the upper right of this quadrant plot reveals that some of these top performing methods for detecting piles also result in relatively accurate pile form quantification</p>
<p>let’s look at the parameter combinations that are in the upper-right of the quadrant plot. That is, the parameter combinations that performed best at both pile detection accuracy and pile form quantification accuracy</p>
<div class="sourceCode" id="cb320"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb320-1"><a href="fusion_params_test.html#cb320-1" tabindex="-1"></a><span class="co"># filter</span></span>
<span id="cb320-2"><a href="fusion_params_test.html#cb320-2" tabindex="-1"></a>df_temp <span class="ot">&lt;-</span> df_temp <span class="sc">%&gt;%</span> </span>
<span id="cb320-3"><a href="fusion_params_test.html#cb320-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(</span>
<span id="cb320-4"><a href="fusion_params_test.html#cb320-4" tabindex="-1"></a>    pct_rank_det_mean<span class="sc">&gt;=</span><span class="fl">0.75</span> <span class="sc">&amp;</span> pct_rank_quant_mean<span class="sc">&gt;=</span><span class="fl">0.75</span></span>
<span id="cb320-5"><a href="fusion_params_test.html#cb320-5" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb320-6"><a href="fusion_params_test.html#cb320-6" tabindex="-1"></a>  <span class="co"># nrow()</span></span>
<span id="cb320-7"><a href="fusion_params_test.html#cb320-7" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb320-8"><a href="fusion_params_test.html#cb320-8" tabindex="-1"></a>    <span class="at">pct_rank_overall =</span> (pct_rank_det_mean<span class="sc">+</span>pct_rank_quant_mean)<span class="sc">/</span><span class="dv">2</span></span>
<span id="cb320-9"><a href="fusion_params_test.html#cb320-9" tabindex="-1"></a>    , <span class="at">lab =</span> forcats<span class="sc">::</span><span class="fu">fct_reorder</span>(lab, pct_rank_overall)</span>
<span id="cb320-10"><a href="fusion_params_test.html#cb320-10" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb320-11"><a href="fusion_params_test.html#cb320-11" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(<span class="fu">desc</span>(pct_rank_overall)) <span class="sc">%&gt;%</span> </span>
<span id="cb320-12"><a href="fusion_params_test.html#cb320-12" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">rank_overall =</span> dplyr<span class="sc">::</span><span class="fu">row_number</span>())</span>
<span id="cb320-13"><a href="fusion_params_test.html#cb320-13" tabindex="-1"></a><span class="co"># save the best overall param_combo_df record numbers</span></span>
<span id="cb320-14"><a href="fusion_params_test.html#cb320-14" tabindex="-1"></a>best_pile_detect_spectral_rn <span class="ot">&lt;-</span> df_temp <span class="sc">%&gt;%</span> </span>
<span id="cb320-15"><a href="fusion_params_test.html#cb320-15" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">distinct</span>(rn,spectral_weight,lab,rank_overall,pct_rank_overall,pct_rank_det_mean,pct_rank_quant_mean)</span>
<span id="cb320-16"><a href="fusion_params_test.html#cb320-16" tabindex="-1"></a><span class="co"># best_pile_detect_spectral_rn %&gt;% dplyr::glimpse()</span></span></code></pre></div>
<div class="sourceCode" id="cb321"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb321-1"><a href="fusion_params_test.html#cb321-1" tabindex="-1"></a>param_combos_spectral_gt_agg <span class="sc">%&gt;%</span> </span>
<span id="cb321-2"><a href="fusion_params_test.html#cb321-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb321-3"><a href="fusion_params_test.html#cb321-3" tabindex="-1"></a>  <span class="co"># filter for the best </span></span>
<span id="cb321-4"><a href="fusion_params_test.html#cb321-4" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(</span>
<span id="cb321-5"><a href="fusion_params_test.html#cb321-5" tabindex="-1"></a>    best_pile_detect_spectral_rn <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">distinct</span>(rn,spectral_weight) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">is_best=</span>T)</span>
<span id="cb321-6"><a href="fusion_params_test.html#cb321-6" tabindex="-1"></a>    , <span class="at">by =</span> dplyr<span class="sc">::</span><span class="fu">join_by</span>(rn,spectral_weight)</span>
<span id="cb321-7"><a href="fusion_params_test.html#cb321-7" tabindex="-1"></a>    , <span class="at">relationship =</span> <span class="st">&quot;one-to-one&quot;</span></span>
<span id="cb321-8"><a href="fusion_params_test.html#cb321-8" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb321-9"><a href="fusion_params_test.html#cb321-9" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">is_best =</span> dplyr<span class="sc">::</span><span class="fu">coalesce</span>(is_best,F)) <span class="sc">%&gt;%</span> </span>
<span id="cb321-10"><a href="fusion_params_test.html#cb321-10" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb321-11"><a href="fusion_params_test.html#cb321-11" tabindex="-1"></a>    rn,max_ht_m,max_area_m2,convexity_pct,circle_fit_iou_pct,spectral_weight</span>
<span id="cb321-12"><a href="fusion_params_test.html#cb321-12" tabindex="-1"></a>    , is_best</span>
<span id="cb321-13"><a href="fusion_params_test.html#cb321-13" tabindex="-1"></a>    , f_score</span>
<span id="cb321-14"><a href="fusion_params_test.html#cb321-14" tabindex="-1"></a>    <span class="co"># quantification accuracy</span></span>
<span id="cb321-15"><a href="fusion_params_test.html#cb321-15" tabindex="-1"></a>    , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_mape&quot;</span>)</span>
<span id="cb321-16"><a href="fusion_params_test.html#cb321-16" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb321-17"><a href="fusion_params_test.html#cb321-17" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(</span>
<span id="cb321-18"><a href="fusion_params_test.html#cb321-18" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">c</span>(tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_mape&quot;</span>))</span>
<span id="cb321-19"><a href="fusion_params_test.html#cb321-19" tabindex="-1"></a>    , <span class="at">names_to =</span> <span class="st">&quot;metric&quot;</span></span>
<span id="cb321-20"><a href="fusion_params_test.html#cb321-20" tabindex="-1"></a>    , <span class="at">values_to =</span> <span class="st">&quot;value&quot;</span></span>
<span id="cb321-21"><a href="fusion_params_test.html#cb321-21" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb321-22"><a href="fusion_params_test.html#cb321-22" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb321-23"><a href="fusion_params_test.html#cb321-23" tabindex="-1"></a>    <span class="at">eval_metric =</span> stringr<span class="sc">::</span><span class="fu">str_extract</span>(metric, <span class="st">&quot;(_rmse|_rrmse|_mean|_mape)$&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb321-24"><a href="fusion_params_test.html#cb321-24" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_remove_all</span>(<span class="st">&quot;_&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb321-25"><a href="fusion_params_test.html#cb321-25" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_replace_all</span>(<span class="st">&quot;mean&quot;</span>,<span class="st">&quot;me&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb321-26"><a href="fusion_params_test.html#cb321-26" tabindex="-1"></a>      <span class="fu">toupper</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb321-27"><a href="fusion_params_test.html#cb321-27" tabindex="-1"></a>      <span class="fu">factor</span>(</span>
<span id="cb321-28"><a href="fusion_params_test.html#cb321-28" tabindex="-1"></a>        <span class="at">ordered =</span> T</span>
<span id="cb321-29"><a href="fusion_params_test.html#cb321-29" tabindex="-1"></a>        , <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;ME&quot;</span>,<span class="st">&quot;RMSE&quot;</span>,<span class="st">&quot;RRMSE&quot;</span>,<span class="st">&quot;MAPE&quot;</span>)</span>
<span id="cb321-30"><a href="fusion_params_test.html#cb321-30" tabindex="-1"></a>      )</span>
<span id="cb321-31"><a href="fusion_params_test.html#cb321-31" tabindex="-1"></a>    , <span class="at">pile_metric =</span> metric <span class="sc">%&gt;%</span> </span>
<span id="cb321-32"><a href="fusion_params_test.html#cb321-32" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_remove</span>(<span class="st">&quot;(_rmse|_rrmse|_mean|_mape)$&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb321-33"><a href="fusion_params_test.html#cb321-33" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_extract</span>(<span class="st">&quot;(paraboloid_volume|volume|area|height|diameter)&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb321-34"><a href="fusion_params_test.html#cb321-34" tabindex="-1"></a>      <span class="fu">factor</span>(</span>
<span id="cb321-35"><a href="fusion_params_test.html#cb321-35" tabindex="-1"></a>        <span class="at">ordered =</span> T</span>
<span id="cb321-36"><a href="fusion_params_test.html#cb321-36" tabindex="-1"></a>        , <span class="at">levels =</span> <span class="fu">c</span>(</span>
<span id="cb321-37"><a href="fusion_params_test.html#cb321-37" tabindex="-1"></a>          <span class="st">&quot;volume&quot;</span></span>
<span id="cb321-38"><a href="fusion_params_test.html#cb321-38" tabindex="-1"></a>          , <span class="st">&quot;paraboloid_volume&quot;</span></span>
<span id="cb321-39"><a href="fusion_params_test.html#cb321-39" tabindex="-1"></a>          , <span class="st">&quot;area&quot;</span></span>
<span id="cb321-40"><a href="fusion_params_test.html#cb321-40" tabindex="-1"></a>          , <span class="st">&quot;height&quot;</span></span>
<span id="cb321-41"><a href="fusion_params_test.html#cb321-41" tabindex="-1"></a>          , <span class="st">&quot;diameter&quot;</span></span>
<span id="cb321-42"><a href="fusion_params_test.html#cb321-42" tabindex="-1"></a>        )</span>
<span id="cb321-43"><a href="fusion_params_test.html#cb321-43" tabindex="-1"></a>        , <span class="at">labels =</span> <span class="fu">c</span>(</span>
<span id="cb321-44"><a href="fusion_params_test.html#cb321-44" tabindex="-1"></a>          <span class="st">&quot;Volume&quot;</span></span>
<span id="cb321-45"><a href="fusion_params_test.html#cb321-45" tabindex="-1"></a>          , <span class="st">&quot;Volume paraboloid&quot;</span></span>
<span id="cb321-46"><a href="fusion_params_test.html#cb321-46" tabindex="-1"></a>          , <span class="st">&quot;Area&quot;</span></span>
<span id="cb321-47"><a href="fusion_params_test.html#cb321-47" tabindex="-1"></a>          , <span class="st">&quot;Height&quot;</span></span>
<span id="cb321-48"><a href="fusion_params_test.html#cb321-48" tabindex="-1"></a>          , <span class="st">&quot;Diameter&quot;</span></span>
<span id="cb321-49"><a href="fusion_params_test.html#cb321-49" tabindex="-1"></a>        )</span>
<span id="cb321-50"><a href="fusion_params_test.html#cb321-50" tabindex="-1"></a>      )</span>
<span id="cb321-51"><a href="fusion_params_test.html#cb321-51" tabindex="-1"></a>    , <span class="at">color_metric =</span> <span class="fu">ifelse</span>(is_best, pile_metric, <span class="cn">NA</span>) <span class="sc">%&gt;%</span> <span class="fu">factor</span>()</span>
<span id="cb321-52"><a href="fusion_params_test.html#cb321-52" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb321-53"><a href="fusion_params_test.html#cb321-53" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(is_best) <span class="sc">%&gt;%</span> </span>
<span id="cb321-54"><a href="fusion_params_test.html#cb321-54" tabindex="-1"></a>  <span class="co"># plot</span></span>
<span id="cb321-55"><a href="fusion_params_test.html#cb321-55" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> f_score, <span class="at">y =</span> value, <span class="at">color =</span> color_metric)) <span class="sc">+</span></span>
<span id="cb321-56"><a href="fusion_params_test.html#cb321-56" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb321-57"><a href="fusion_params_test.html#cb321-57" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">facet_wrap</span>(<span class="at">facets =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(pile_metric)) <span class="sc">+</span></span>
<span id="cb321-58"><a href="fusion_params_test.html#cb321-58" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_color_viridis_d</span>(<span class="at">option =</span> <span class="st">&quot;turbo&quot;</span>, <span class="at">na.value =</span> <span class="st">&quot;gray88&quot;</span>) <span class="sc">+</span></span>
<span id="cb321-59"><a href="fusion_params_test.html#cb321-59" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_x_continuous</span>(</span>
<span id="cb321-60"><a href="fusion_params_test.html#cb321-60" tabindex="-1"></a>    <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">percent_format</span>(<span class="at">accuracy =</span> <span class="dv">1</span>)</span>
<span id="cb321-61"><a href="fusion_params_test.html#cb321-61" tabindex="-1"></a>    , <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)</span>
<span id="cb321-62"><a href="fusion_params_test.html#cb321-62" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb321-63"><a href="fusion_params_test.html#cb321-63" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_y_continuous</span>(</span>
<span id="cb321-64"><a href="fusion_params_test.html#cb321-64" tabindex="-1"></a>    <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">percent_format</span>(<span class="at">accuracy =</span> <span class="dv">1</span>)</span>
<span id="cb321-65"><a href="fusion_params_test.html#cb321-65" tabindex="-1"></a>    , <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="cn">NA</span>)</span>
<span id="cb321-66"><a href="fusion_params_test.html#cb321-66" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb321-67"><a href="fusion_params_test.html#cb321-67" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;F-Score&quot;</span>, <span class="at">y =</span> <span class="st">&quot;MAPE&quot;</span>, <span class="at">caption =</span> <span class="st">&quot;*records in gray not selected&quot;</span>) <span class="sc">+</span></span>
<span id="cb321-68"><a href="fusion_params_test.html#cb321-68" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb321-69"><a href="fusion_params_test.html#cb321-69" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb321-70"><a href="fusion_params_test.html#cb321-70" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb321-71"><a href="fusion_params_test.html#cb321-71" tabindex="-1"></a>    , <span class="at">strip.text =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb321-72"><a href="fusion_params_test.html#cb321-72" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-282-1.png" width="1008" /></p>
<p>if we look at these top parameter combinations only, what can we expect regarding detection accuracy</p>
<div class="sourceCode" id="cb322"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb322-1"><a href="fusion_params_test.html#cb322-1" tabindex="-1"></a><span class="co"># plot it</span></span>
<span id="cb322-2"><a href="fusion_params_test.html#cb322-2" tabindex="-1"></a><span class="fu">plt_detection_dist</span>(</span>
<span id="cb322-3"><a href="fusion_params_test.html#cb322-3" tabindex="-1"></a>  <span class="at">df =</span> param_combos_spectral_gt_agg <span class="sc">%&gt;%</span></span>
<span id="cb322-4"><a href="fusion_params_test.html#cb322-4" tabindex="-1"></a>    <span class="co"># filter for best of best</span></span>
<span id="cb322-5"><a href="fusion_params_test.html#cb322-5" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">inner_join</span>(</span>
<span id="cb322-6"><a href="fusion_params_test.html#cb322-6" tabindex="-1"></a>      best_pile_detect_spectral_rn <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">distinct</span>(rn,spectral_weight) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">is_best=</span>T)</span>
<span id="cb322-7"><a href="fusion_params_test.html#cb322-7" tabindex="-1"></a>      , <span class="at">by =</span> dplyr<span class="sc">::</span><span class="fu">join_by</span>(rn,spectral_weight)</span>
<span id="cb322-8"><a href="fusion_params_test.html#cb322-8" tabindex="-1"></a>      , <span class="at">relationship =</span> <span class="st">&quot;one-to-one&quot;</span></span>
<span id="cb322-9"><a href="fusion_params_test.html#cb322-9" tabindex="-1"></a>    )</span>
<span id="cb322-10"><a href="fusion_params_test.html#cb322-10" tabindex="-1"></a>  , <span class="fu">paste0</span>(</span>
<span id="cb322-11"><a href="fusion_params_test.html#cb322-11" tabindex="-1"></a>   <span class="st">&quot;distribution of pile detection accuracy metrics for the top&quot;</span></span>
<span id="cb322-12"><a href="fusion_params_test.html#cb322-12" tabindex="-1"></a>   , <span class="st">&quot; (n=&quot;</span></span>
<span id="cb322-13"><a href="fusion_params_test.html#cb322-13" tabindex="-1"></a>   , scales<span class="sc">::</span><span class="fu">comma</span>(<span class="fu">nrow</span>(best_pile_detect_spectral_rn), <span class="at">accuracy =</span> <span class="dv">1</span>)</span>
<span id="cb322-14"><a href="fusion_params_test.html#cb322-14" tabindex="-1"></a>   , <span class="st">&quot;) &quot;</span></span>
<span id="cb322-15"><a href="fusion_params_test.html#cb322-15" tabindex="-1"></a>   , <span class="st">&quot;parameter combinations</span><span class="sc">\n</span><span class="st">based on both detection and quantification accuracy using structural and spectral data&quot;</span></span>
<span id="cb322-16"><a href="fusion_params_test.html#cb322-16" tabindex="-1"></a>  )</span>
<span id="cb322-17"><a href="fusion_params_test.html#cb322-17" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-283-1.png" width="1008" /></p>
<p>this is interesting, among the top performers in both detection (F-score) and quantification (overall MAPE), a few combinations had noticeably higher recall rates. assuming quantification accuracy is similar across this elite group, we should prioritize those with the highest recall.</p>
<p>but first, if we look at all these top combinations, what can we expect regarding their quantification accuracy?</p>
<div class="sourceCode" id="cb323"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb323-1"><a href="fusion_params_test.html#cb323-1" tabindex="-1"></a><span class="co"># plot it</span></span>
<span id="cb323-2"><a href="fusion_params_test.html#cb323-2" tabindex="-1"></a><span class="fu">plt_form_quantification_dist</span>(</span>
<span id="cb323-3"><a href="fusion_params_test.html#cb323-3" tabindex="-1"></a>  <span class="at">df =</span> param_combos_spectral_gt_agg <span class="sc">%&gt;%</span> </span>
<span id="cb323-4"><a href="fusion_params_test.html#cb323-4" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb323-5"><a href="fusion_params_test.html#cb323-5" tabindex="-1"></a>    <span class="co"># filter for best of best</span></span>
<span id="cb323-6"><a href="fusion_params_test.html#cb323-6" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">inner_join</span>(</span>
<span id="cb323-7"><a href="fusion_params_test.html#cb323-7" tabindex="-1"></a>      best_pile_detect_spectral_rn <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">distinct</span>(rn,spectral_weight) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">is_best=</span>T)</span>
<span id="cb323-8"><a href="fusion_params_test.html#cb323-8" tabindex="-1"></a>      , <span class="at">by =</span> dplyr<span class="sc">::</span><span class="fu">join_by</span>(rn,spectral_weight)</span>
<span id="cb323-9"><a href="fusion_params_test.html#cb323-9" tabindex="-1"></a>      , <span class="at">relationship =</span> <span class="st">&quot;one-to-one&quot;</span></span>
<span id="cb323-10"><a href="fusion_params_test.html#cb323-10" tabindex="-1"></a>    )</span>
<span id="cb323-11"><a href="fusion_params_test.html#cb323-11" tabindex="-1"></a>  , <span class="fu">paste0</span>(</span>
<span id="cb323-12"><a href="fusion_params_test.html#cb323-12" tabindex="-1"></a>     <span class="st">&quot;distribution of pile form quantification accuracy metrics for the top&quot;</span></span>
<span id="cb323-13"><a href="fusion_params_test.html#cb323-13" tabindex="-1"></a>     <span class="co"># , scales::percent(1-pct_rank_th_top,accuracy=1)</span></span>
<span id="cb323-14"><a href="fusion_params_test.html#cb323-14" tabindex="-1"></a>     , <span class="st">&quot; (n=&quot;</span></span>
<span id="cb323-15"><a href="fusion_params_test.html#cb323-15" tabindex="-1"></a>     , scales<span class="sc">::</span><span class="fu">comma</span>(<span class="fu">nrow</span>(best_pile_detect_spectral_rn), <span class="at">accuracy =</span> <span class="dv">1</span>)</span>
<span id="cb323-16"><a href="fusion_params_test.html#cb323-16" tabindex="-1"></a>     , <span class="st">&quot;) &quot;</span></span>
<span id="cb323-17"><a href="fusion_params_test.html#cb323-17" tabindex="-1"></a>     , <span class="st">&quot;parameter combinations</span><span class="sc">\n</span><span class="st">based on both detection and quantification accuracy using structural and spectral data&quot;</span></span>
<span id="cb323-18"><a href="fusion_params_test.html#cb323-18" tabindex="-1"></a>  )</span>
<span id="cb323-19"><a href="fusion_params_test.html#cb323-19" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-284-1.png" width="1008" /></p>
<p>the distributions of these form quantification accuracy metrics span a narrow range, especially with respect to MAPE. as such, we’ll focus on the best overall parameter combinations that also achieved the highest recall rates</p>
<p>before we move on, let’s check the distribution of the <code>spectral_weight</code> parameter for these top performing settings</p>
<div class="sourceCode" id="cb324"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb324-1"><a href="fusion_params_test.html#cb324-1" tabindex="-1"></a>param_combos_spectral_gt_agg <span class="sc">%&gt;%</span> </span>
<span id="cb324-2"><a href="fusion_params_test.html#cb324-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">distinct</span>(spectral_weight) <span class="sc">%&gt;%</span> </span>
<span id="cb324-3"><a href="fusion_params_test.html#cb324-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(</span>
<span id="cb324-4"><a href="fusion_params_test.html#cb324-4" tabindex="-1"></a>    best_pile_detect_spectral_rn <span class="sc">%&gt;%</span> </span>
<span id="cb324-5"><a href="fusion_params_test.html#cb324-5" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">count</span>(spectral_weight)</span>
<span id="cb324-6"><a href="fusion_params_test.html#cb324-6" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb324-7"><a href="fusion_params_test.html#cb324-7" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(spectral_weight) <span class="sc">%&gt;%</span> </span>
<span id="cb324-8"><a href="fusion_params_test.html#cb324-8" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb324-9"><a href="fusion_params_test.html#cb324-9" tabindex="-1"></a>    <span class="at">n =</span> dplyr<span class="sc">::</span><span class="fu">coalesce</span>(n,<span class="dv">0</span>)</span>
<span id="cb324-10"><a href="fusion_params_test.html#cb324-10" tabindex="-1"></a>    , <span class="at">pct =</span> scales<span class="sc">::</span><span class="fu">percent</span>( n<span class="sc">/</span><span class="fu">sum</span>(n), <span class="at">accuracy =</span> <span class="fl">0.1</span>)</span>
<span id="cb324-11"><a href="fusion_params_test.html#cb324-11" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb324-12"><a href="fusion_params_test.html#cb324-12" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kbl</span>(</span>
<span id="cb324-13"><a href="fusion_params_test.html#cb324-13" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">&quot;spectral_weight setting of top performers in both detection (F-score) and quantification (overall MAPE)&quot;</span></span>
<span id="cb324-14"><a href="fusion_params_test.html#cb324-14" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb324-15"><a href="fusion_params_test.html#cb324-15" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kable_styling</span>()</span></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-285">Table 8.6: </span>spectral_weight setting of top performers in both detection (F-score) and quantification (overall MAPE)
</caption>
<thead>
<tr>
<th style="text-align:right;">
spectral_weight
</th>
<th style="text-align:right;">
n
</th>
<th style="text-align:left;">
pct
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
12
</td>
<td style="text-align:left;">
18.8%
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
12
</td>
<td style="text-align:left;">
18.8%
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
12
</td>
<td style="text-align:left;">
18.8%
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
12
</td>
<td style="text-align:left;">
18.8%
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
16
</td>
<td style="text-align:left;">
25.0%
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:left;">
0.0%
</td>
</tr>
</tbody>
</table>
<p>where these settings in our final recommended settings when looking at the structural data only?</p>
</div>
</div>
<div id="final-recommended-settings-1" class="section level2 hasAnchor" number="8.4">
<h2><span class="header-section-number">8.4</span> Final recommended settings<a href="fusion_params_test.html#final-recommended-settings-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>our final step in this sensitivity testing is to identify the best-performing parameter combinations that not only balance detection and quantification accuracy but also achieve the highest recall rates. we’ll select these by choosing any combination whose recall rate is at least two standard deviations above the average for this top group. if no combinations meet this criterion, we will instead select the top 10 combinations based on their recall rates.</p>
<div class="sourceCode" id="cb325"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb325-1"><a href="fusion_params_test.html#cb325-1" tabindex="-1"></a><span class="co"># put a flag in our best_pile_detect_spectral_rn data</span></span>
<span id="cb325-2"><a href="fusion_params_test.html#cb325-2" tabindex="-1"></a>best_pile_detect_spectral_rn <span class="ot">&lt;-</span></span>
<span id="cb325-3"><a href="fusion_params_test.html#cb325-3" tabindex="-1"></a>  best_pile_detect_spectral_rn <span class="sc">%&gt;%</span> </span>
<span id="cb325-4"><a href="fusion_params_test.html#cb325-4" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(</span>
<span id="cb325-5"><a href="fusion_params_test.html#cb325-5" tabindex="-1"></a>    param_combos_spectral_gt_agg <span class="sc">%&gt;%</span> </span>
<span id="cb325-6"><a href="fusion_params_test.html#cb325-6" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb325-7"><a href="fusion_params_test.html#cb325-7" tabindex="-1"></a>      <span class="co"># filter for best of best</span></span>
<span id="cb325-8"><a href="fusion_params_test.html#cb325-8" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">inner_join</span>(</span>
<span id="cb325-9"><a href="fusion_params_test.html#cb325-9" tabindex="-1"></a>        best_pile_detect_spectral_rn <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">distinct</span>(rn,spectral_weight) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">is_best=</span>T)</span>
<span id="cb325-10"><a href="fusion_params_test.html#cb325-10" tabindex="-1"></a>        , <span class="at">by =</span> dplyr<span class="sc">::</span><span class="fu">join_by</span>(rn,spectral_weight)</span>
<span id="cb325-11"><a href="fusion_params_test.html#cb325-11" tabindex="-1"></a>        , <span class="at">relationship =</span> <span class="st">&quot;one-to-one&quot;</span></span>
<span id="cb325-12"><a href="fusion_params_test.html#cb325-12" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span> </span>
<span id="cb325-13"><a href="fusion_params_test.html#cb325-13" tabindex="-1"></a>      <span class="co"># check recall rate</span></span>
<span id="cb325-14"><a href="fusion_params_test.html#cb325-14" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">arrange</span>(<span class="fu">desc</span>(recall)) <span class="sc">%&gt;%</span> </span>
<span id="cb325-15"><a href="fusion_params_test.html#cb325-15" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb325-16"><a href="fusion_params_test.html#cb325-16" tabindex="-1"></a>        <span class="at">is_recall_above_mean =</span> recall <span class="sc">&gt;=</span> ( <span class="fu">mean</span>(recall) <span class="sc">+</span> <span class="fu">sd</span>(recall)<span class="sc">*</span><span class="dv">2</span> )</span>
<span id="cb325-17"><a href="fusion_params_test.html#cb325-17" tabindex="-1"></a>        <span class="co"># if no records have a recall at least one stdandard dev above the mean, just take the top ten</span></span>
<span id="cb325-18"><a href="fusion_params_test.html#cb325-18" tabindex="-1"></a>        , <span class="at">is_top_recall =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb325-19"><a href="fusion_params_test.html#cb325-19" tabindex="-1"></a>          <span class="fu">sum</span>(is_recall_above_mean)<span class="sc">&gt;</span><span class="dv">4</span> <span class="sc">~</span> is_recall_above_mean</span>
<span id="cb325-20"><a href="fusion_params_test.html#cb325-20" tabindex="-1"></a>          , T <span class="sc">~</span> dplyr<span class="sc">::</span><span class="fu">row_number</span>()<span class="sc">&lt;=</span><span class="dv">10</span></span>
<span id="cb325-21"><a href="fusion_params_test.html#cb325-21" tabindex="-1"></a>        )</span>
<span id="cb325-22"><a href="fusion_params_test.html#cb325-22" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span> </span>
<span id="cb325-23"><a href="fusion_params_test.html#cb325-23" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">select</span>(rn,spectral_weight,is_top_recall)</span>
<span id="cb325-24"><a href="fusion_params_test.html#cb325-24" tabindex="-1"></a>    , <span class="at">by =</span> dplyr<span class="sc">::</span><span class="fu">join_by</span>(rn,spectral_weight)</span>
<span id="cb325-25"><a href="fusion_params_test.html#cb325-25" tabindex="-1"></a>    , <span class="at">relationship =</span> <span class="st">&quot;one-to-one&quot;</span></span>
<span id="cb325-26"><a href="fusion_params_test.html#cb325-26" tabindex="-1"></a>  ) </span>
<span id="cb325-27"><a href="fusion_params_test.html#cb325-27" tabindex="-1"></a><span class="co"># huh?</span></span>
<span id="cb325-28"><a href="fusion_params_test.html#cb325-28" tabindex="-1"></a><span class="co"># best_pile_detect_spectral_rn %&gt;% dplyr::glimpse()</span></span>
<span id="cb325-29"><a href="fusion_params_test.html#cb325-29" tabindex="-1"></a>best_pile_detect_spectral_rn <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">count</span>(is_top_recall)</span></code></pre></div>
<pre><code>## # A tibble: 2 × 2
##   is_top_recall     n
##   &lt;lgl&gt;         &lt;int&gt;
## 1 FALSE            54
## 2 TRUE             10</code></pre>
<p>finally, let’s look at the pile detection accuracy metrics at the individual parameter combination level</p>
<div class="sourceCode" id="cb327"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb327-1"><a href="fusion_params_test.html#cb327-1" tabindex="-1"></a><span class="co"># pal_temp %&gt;% scales::show_col()</span></span>
<span id="cb327-2"><a href="fusion_params_test.html#cb327-2" tabindex="-1"></a><span class="co"># filter and reshape</span></span>
<span id="cb327-3"><a href="fusion_params_test.html#cb327-3" tabindex="-1"></a>df_temp <span class="ot">&lt;-</span> </span>
<span id="cb327-4"><a href="fusion_params_test.html#cb327-4" tabindex="-1"></a>  param_combos_spectral_gt_agg <span class="sc">%&gt;%</span> </span>
<span id="cb327-5"><a href="fusion_params_test.html#cb327-5" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb327-6"><a href="fusion_params_test.html#cb327-6" tabindex="-1"></a>  <span class="co"># filter for best of best</span></span>
<span id="cb327-7"><a href="fusion_params_test.html#cb327-7" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">inner_join</span>(</span>
<span id="cb327-8"><a href="fusion_params_test.html#cb327-8" tabindex="-1"></a>    best_pile_detect_spectral_rn <span class="sc">%&gt;%</span> </span>
<span id="cb327-9"><a href="fusion_params_test.html#cb327-9" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">filter</span>(is_top_recall) <span class="sc">%&gt;%</span> </span>
<span id="cb327-10"><a href="fusion_params_test.html#cb327-10" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">select</span>(rn,spectral_weight,lab,rank_overall)</span>
<span id="cb327-11"><a href="fusion_params_test.html#cb327-11" tabindex="-1"></a>    , <span class="at">by =</span> dplyr<span class="sc">::</span><span class="fu">join_by</span>(rn,spectral_weight)</span>
<span id="cb327-12"><a href="fusion_params_test.html#cb327-12" tabindex="-1"></a>    , <span class="at">relationship =</span> <span class="st">&quot;one-to-one&quot;</span></span>
<span id="cb327-13"><a href="fusion_params_test.html#cb327-13" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb327-14"><a href="fusion_params_test.html#cb327-14" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb327-15"><a href="fusion_params_test.html#cb327-15" tabindex="-1"></a>    max_ht_m,max_area_m2,convexity_pct,circle_fit_iou_pct,spectral_weight</span>
<span id="cb327-16"><a href="fusion_params_test.html#cb327-16" tabindex="-1"></a>    , lab</span>
<span id="cb327-17"><a href="fusion_params_test.html#cb327-17" tabindex="-1"></a>    <span class="co"># detection</span></span>
<span id="cb327-18"><a href="fusion_params_test.html#cb327-18" tabindex="-1"></a>    , f_score, recall, precision</span>
<span id="cb327-19"><a href="fusion_params_test.html#cb327-19" tabindex="-1"></a>    <span class="co"># quantification</span></span>
<span id="cb327-20"><a href="fusion_params_test.html#cb327-20" tabindex="-1"></a>    , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_rmse&quot;</span>)</span>
<span id="cb327-21"><a href="fusion_params_test.html#cb327-21" tabindex="-1"></a>    , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_rrmse&quot;</span>)</span>
<span id="cb327-22"><a href="fusion_params_test.html#cb327-22" tabindex="-1"></a>    , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_mean&quot;</span>)</span>
<span id="cb327-23"><a href="fusion_params_test.html#cb327-23" tabindex="-1"></a>    , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_mape&quot;</span>)</span>
<span id="cb327-24"><a href="fusion_params_test.html#cb327-24" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb327-25"><a href="fusion_params_test.html#cb327-25" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(</span>
<span id="cb327-26"><a href="fusion_params_test.html#cb327-26" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">c</span>(</span>
<span id="cb327-27"><a href="fusion_params_test.html#cb327-27" tabindex="-1"></a>      f_score, recall, precision</span>
<span id="cb327-28"><a href="fusion_params_test.html#cb327-28" tabindex="-1"></a>      , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_rmse&quot;</span>)</span>
<span id="cb327-29"><a href="fusion_params_test.html#cb327-29" tabindex="-1"></a>      , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_rrmse&quot;</span>)</span>
<span id="cb327-30"><a href="fusion_params_test.html#cb327-30" tabindex="-1"></a>      , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_mean&quot;</span>)</span>
<span id="cb327-31"><a href="fusion_params_test.html#cb327-31" tabindex="-1"></a>      , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_mape&quot;</span>)</span>
<span id="cb327-32"><a href="fusion_params_test.html#cb327-32" tabindex="-1"></a>    )</span>
<span id="cb327-33"><a href="fusion_params_test.html#cb327-33" tabindex="-1"></a>    , <span class="at">names_to =</span> <span class="st">&quot;metric&quot;</span></span>
<span id="cb327-34"><a href="fusion_params_test.html#cb327-34" tabindex="-1"></a>    , <span class="at">values_to =</span> <span class="st">&quot;value&quot;</span></span>
<span id="cb327-35"><a href="fusion_params_test.html#cb327-35" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb327-36"><a href="fusion_params_test.html#cb327-36" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb327-37"><a href="fusion_params_test.html#cb327-37" tabindex="-1"></a>    <span class="at">eval_metric =</span> stringr<span class="sc">::</span><span class="fu">str_extract</span>(metric, <span class="st">&quot;(_rmse|_rrmse|_mean|_mape|f_score|recall|precision)$&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb327-38"><a href="fusion_params_test.html#cb327-38" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_remove_all</span>(<span class="st">&quot;_&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb327-39"><a href="fusion_params_test.html#cb327-39" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_replace_all</span>(<span class="st">&quot;mean&quot;</span>,<span class="st">&quot;me&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb327-40"><a href="fusion_params_test.html#cb327-40" tabindex="-1"></a>      <span class="fu">toupper</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb327-41"><a href="fusion_params_test.html#cb327-41" tabindex="-1"></a>      <span class="fu">factor</span>(</span>
<span id="cb327-42"><a href="fusion_params_test.html#cb327-42" tabindex="-1"></a>        <span class="at">ordered =</span> T</span>
<span id="cb327-43"><a href="fusion_params_test.html#cb327-43" tabindex="-1"></a>        , <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;FSCORE&quot;</span>,<span class="st">&quot;RECALL&quot;</span>,<span class="st">&quot;PRECISION&quot;</span>, <span class="st">&quot;ME&quot;</span>,<span class="st">&quot;RMSE&quot;</span>,<span class="st">&quot;RRMSE&quot;</span>,<span class="st">&quot;MAPE&quot;</span>)</span>
<span id="cb327-44"><a href="fusion_params_test.html#cb327-44" tabindex="-1"></a>        , <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;F-score&quot;</span>,<span class="st">&quot;Recall&quot;</span>,<span class="st">&quot;Precision&quot;</span>, <span class="st">&quot;ME&quot;</span>,<span class="st">&quot;RMSE&quot;</span>,<span class="st">&quot;RRMSE&quot;</span>,<span class="st">&quot;MAPE&quot;</span>)</span>
<span id="cb327-45"><a href="fusion_params_test.html#cb327-45" tabindex="-1"></a>      )</span>
<span id="cb327-46"><a href="fusion_params_test.html#cb327-46" tabindex="-1"></a>    , <span class="at">pile_metric =</span> metric <span class="sc">%&gt;%</span> </span>
<span id="cb327-47"><a href="fusion_params_test.html#cb327-47" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_remove</span>(<span class="st">&quot;(_rmse|_rrmse|_mean|_mape)$&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb327-48"><a href="fusion_params_test.html#cb327-48" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_extract</span>(<span class="st">&quot;(paraboloid_volume|volume|area|height|diameter)&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb327-49"><a href="fusion_params_test.html#cb327-49" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">coalesce</span>(<span class="st">&quot;detection&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb327-50"><a href="fusion_params_test.html#cb327-50" tabindex="-1"></a>      <span class="fu">factor</span>(</span>
<span id="cb327-51"><a href="fusion_params_test.html#cb327-51" tabindex="-1"></a>        <span class="at">ordered =</span> T</span>
<span id="cb327-52"><a href="fusion_params_test.html#cb327-52" tabindex="-1"></a>        , <span class="at">levels =</span> <span class="fu">c</span>(</span>
<span id="cb327-53"><a href="fusion_params_test.html#cb327-53" tabindex="-1"></a>          <span class="st">&quot;detection&quot;</span></span>
<span id="cb327-54"><a href="fusion_params_test.html#cb327-54" tabindex="-1"></a>          , <span class="st">&quot;volume&quot;</span></span>
<span id="cb327-55"><a href="fusion_params_test.html#cb327-55" tabindex="-1"></a>          , <span class="st">&quot;paraboloid_volume&quot;</span></span>
<span id="cb327-56"><a href="fusion_params_test.html#cb327-56" tabindex="-1"></a>          , <span class="st">&quot;area&quot;</span></span>
<span id="cb327-57"><a href="fusion_params_test.html#cb327-57" tabindex="-1"></a>          , <span class="st">&quot;height&quot;</span></span>
<span id="cb327-58"><a href="fusion_params_test.html#cb327-58" tabindex="-1"></a>          , <span class="st">&quot;diameter&quot;</span></span>
<span id="cb327-59"><a href="fusion_params_test.html#cb327-59" tabindex="-1"></a>        )</span>
<span id="cb327-60"><a href="fusion_params_test.html#cb327-60" tabindex="-1"></a>        , <span class="at">labels =</span> <span class="fu">c</span>(</span>
<span id="cb327-61"><a href="fusion_params_test.html#cb327-61" tabindex="-1"></a>          <span class="st">&quot;Detection&quot;</span></span>
<span id="cb327-62"><a href="fusion_params_test.html#cb327-62" tabindex="-1"></a>          , <span class="st">&quot;Volume&quot;</span></span>
<span id="cb327-63"><a href="fusion_params_test.html#cb327-63" tabindex="-1"></a>          , <span class="st">&quot;Volume paraboloid&quot;</span></span>
<span id="cb327-64"><a href="fusion_params_test.html#cb327-64" tabindex="-1"></a>          , <span class="st">&quot;Area&quot;</span></span>
<span id="cb327-65"><a href="fusion_params_test.html#cb327-65" tabindex="-1"></a>          , <span class="st">&quot;Height&quot;</span></span>
<span id="cb327-66"><a href="fusion_params_test.html#cb327-66" tabindex="-1"></a>          , <span class="st">&quot;Diameter&quot;</span></span>
<span id="cb327-67"><a href="fusion_params_test.html#cb327-67" tabindex="-1"></a>        )</span>
<span id="cb327-68"><a href="fusion_params_test.html#cb327-68" tabindex="-1"></a>      )</span>
<span id="cb327-69"><a href="fusion_params_test.html#cb327-69" tabindex="-1"></a>    , <span class="at">value_lab =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb327-70"><a href="fusion_params_test.html#cb327-70" tabindex="-1"></a>        eval_metric <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;F-score&quot;</span>,<span class="st">&quot;Recall&quot;</span>,<span class="st">&quot;Precision&quot;</span>, <span class="st">&quot;RRMSE&quot;</span>, <span class="st">&quot;MAPE&quot;</span>) <span class="sc">~</span> scales<span class="sc">::</span><span class="fu">percent</span>(value,<span class="at">accuracy=</span><span class="fl">0.1</span>)</span>
<span id="cb327-71"><a href="fusion_params_test.html#cb327-71" tabindex="-1"></a>        , eval_metric <span class="sc">==</span> <span class="st">&quot;ME&quot;</span> <span class="sc">~</span> scales<span class="sc">::</span><span class="fu">comma</span>(value,<span class="at">accuracy=</span><span class="fl">0.01</span>)</span>
<span id="cb327-72"><a href="fusion_params_test.html#cb327-72" tabindex="-1"></a>        , T <span class="sc">~</span> scales<span class="sc">::</span><span class="fu">comma</span>(value,<span class="at">accuracy=</span><span class="fl">0.1</span>)</span>
<span id="cb327-73"><a href="fusion_params_test.html#cb327-73" tabindex="-1"></a>      )</span>
<span id="cb327-74"><a href="fusion_params_test.html#cb327-74" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb327-75"><a href="fusion_params_test.html#cb327-75" tabindex="-1"></a>  <span class="co"># make var for color</span></span>
<span id="cb327-76"><a href="fusion_params_test.html#cb327-76" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(pile_metric, eval_metric) <span class="sc">%&gt;%</span> </span>
<span id="cb327-77"><a href="fusion_params_test.html#cb327-77" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb327-78"><a href="fusion_params_test.html#cb327-78" tabindex="-1"></a>    <span class="co"># for ME, color by abs...for f-score,recall,precision color by -value so that higher means better...</span></span>
<span id="cb327-79"><a href="fusion_params_test.html#cb327-79" tabindex="-1"></a>      <span class="co"># ...since higher means worse for quantification accuracy metrics</span></span>
<span id="cb327-80"><a href="fusion_params_test.html#cb327-80" tabindex="-1"></a>    <span class="at">value_dir =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb327-81"><a href="fusion_params_test.html#cb327-81" tabindex="-1"></a>      eval_metric <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;ME&quot;</span>) <span class="sc">~</span> <span class="fu">abs</span>(value)</span>
<span id="cb327-82"><a href="fusion_params_test.html#cb327-82" tabindex="-1"></a>      , eval_metric <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;F-score&quot;</span>,<span class="st">&quot;Recall&quot;</span>,<span class="st">&quot;Precision&quot;</span>) <span class="sc">~</span> <span class="sc">-</span>value</span>
<span id="cb327-83"><a href="fusion_params_test.html#cb327-83" tabindex="-1"></a>      , T <span class="sc">~</span> value</span>
<span id="cb327-84"><a href="fusion_params_test.html#cb327-84" tabindex="-1"></a>    )</span>
<span id="cb327-85"><a href="fusion_params_test.html#cb327-85" tabindex="-1"></a>    , <span class="at">value_z =</span> (value_dir<span class="sc">-</span><span class="fu">mean</span>(value_dir,<span class="at">na.rm=</span>T))<span class="sc">/</span><span class="fu">sd</span>(value_dir,<span class="at">na.rm=</span>T) <span class="co"># this is the key to the different colors within facets</span></span>
<span id="cb327-86"><a href="fusion_params_test.html#cb327-86" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb327-87"><a href="fusion_params_test.html#cb327-87" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>()</span>
<span id="cb327-88"><a href="fusion_params_test.html#cb327-88" tabindex="-1"></a>  </span>
<span id="cb327-89"><a href="fusion_params_test.html#cb327-89" tabindex="-1"></a><span class="co"># how to plot all of this (without patchwork)?????</span></span>
<span id="cb327-90"><a href="fusion_params_test.html#cb327-90" tabindex="-1"></a>df_temp <span class="sc">%&gt;%</span> </span>
<span id="cb327-91"><a href="fusion_params_test.html#cb327-91" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span>eval_metric <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;RRMSE&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb327-92"><a href="fusion_params_test.html#cb327-92" tabindex="-1"></a>  <span class="co"># View()</span></span>
<span id="cb327-93"><a href="fusion_params_test.html#cb327-93" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> eval_metric, <span class="at">y =</span> lab)) <span class="sc">+</span> </span>
<span id="cb327-94"><a href="fusion_params_test.html#cb327-94" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_tile</span>(</span>
<span id="cb327-95"><a href="fusion_params_test.html#cb327-95" tabindex="-1"></a>    <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">fill =</span> pile_metric, <span class="at">alpha =</span> <span class="sc">-</span>value_z)</span>
<span id="cb327-96"><a href="fusion_params_test.html#cb327-96" tabindex="-1"></a>    , <span class="at">color =</span> <span class="st">&quot;gray&quot;</span></span>
<span id="cb327-97"><a href="fusion_params_test.html#cb327-97" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb327-98"><a href="fusion_params_test.html#cb327-98" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_text</span>(</span>
<span id="cb327-99"><a href="fusion_params_test.html#cb327-99" tabindex="-1"></a>    <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">label =</span> value_lab, <span class="at">fontface =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb327-100"><a href="fusion_params_test.html#cb327-100" tabindex="-1"></a>    , <span class="at">color =</span> <span class="st">&quot;white&quot;</span></span>
<span id="cb327-101"><a href="fusion_params_test.html#cb327-101" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb327-102"><a href="fusion_params_test.html#cb327-102" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">facet_grid</span>(<span class="at">cols =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(pile_metric), <span class="at">scales =</span> <span class="st">&quot;free_x&quot;</span>) <span class="sc">+</span> </span>
<span id="cb327-103"><a href="fusion_params_test.html#cb327-103" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_x_discrete</span>(<span class="at">position =</span> <span class="st">&quot;top&quot;</span>) <span class="sc">+</span></span>
<span id="cb327-104"><a href="fusion_params_test.html#cb327-104" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;gray33&quot;</span>, viridis<span class="sc">::</span><span class="fu">turbo</span>(<span class="at">n=</span><span class="dv">4</span>))) <span class="sc">+</span></span>
<span id="cb327-105"><a href="fusion_params_test.html#cb327-105" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_alpha_binned</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="fl">0.55</span>, <span class="dv">1</span>)) <span class="sc">+</span> <span class="co"># this is the key to the different colors within facets</span></span>
<span id="cb327-106"><a href="fusion_params_test.html#cb327-106" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb327-107"><a href="fusion_params_test.html#cb327-107" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb327-108"><a href="fusion_params_test.html#cb327-108" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;&quot;</span></span>
<span id="cb327-109"><a href="fusion_params_test.html#cb327-109" tabindex="-1"></a>    , <span class="at">y =</span> <span class="st">&quot;max_ht_m : max_area_m2 : convexity_pct : circle_fit_iou_pct : spectral_weight&quot;</span></span>
<span id="cb327-110"><a href="fusion_params_test.html#cb327-110" tabindex="-1"></a>    , <span class="at">subtitle =</span> <span class="fu">paste0</span>(</span>
<span id="cb327-111"><a href="fusion_params_test.html#cb327-111" tabindex="-1"></a>       <span class="st">&quot;pile detection and form quantification accuracy metrics for the top&quot;</span></span>
<span id="cb327-112"><a href="fusion_params_test.html#cb327-112" tabindex="-1"></a>       <span class="co"># , scales::percent(1-pct_rank_th_top,accuracy=1)</span></span>
<span id="cb327-113"><a href="fusion_params_test.html#cb327-113" tabindex="-1"></a>       , <span class="st">&quot; (n=&quot;</span></span>
<span id="cb327-114"><a href="fusion_params_test.html#cb327-114" tabindex="-1"></a>       , scales<span class="sc">::</span><span class="fu">comma</span>(<span class="fu">sum</span>(best_pile_detect_spectral_rn<span class="sc">$</span>is_top_recall,<span class="at">na.rm=</span>T), <span class="at">accuracy =</span> <span class="dv">1</span>)</span>
<span id="cb327-115"><a href="fusion_params_test.html#cb327-115" tabindex="-1"></a>       , <span class="st">&quot;) &quot;</span></span>
<span id="cb327-116"><a href="fusion_params_test.html#cb327-116" tabindex="-1"></a>       , <span class="st">&quot;overall parameter combinations</span><span class="sc">\n</span><span class="st">based on both detection and quantification accuracy using structural and spectral data&quot;</span></span>
<span id="cb327-117"><a href="fusion_params_test.html#cb327-117" tabindex="-1"></a>      )</span>
<span id="cb327-118"><a href="fusion_params_test.html#cb327-118" tabindex="-1"></a>    , <span class="at">caption =</span> <span class="st">&quot;*darker colors indicate relatively higher accuracy values&quot;</span></span>
<span id="cb327-119"><a href="fusion_params_test.html#cb327-119" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb327-120"><a href="fusion_params_test.html#cb327-120" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb327-121"><a href="fusion_params_test.html#cb327-121" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb327-122"><a href="fusion_params_test.html#cb327-122" tabindex="-1"></a>    , <span class="at">panel.grid =</span> ggplot2<span class="sc">::</span><span class="fu">element_blank</span>()</span>
<span id="cb327-123"><a href="fusion_params_test.html#cb327-123" tabindex="-1"></a>    , <span class="at">strip.placement =</span> <span class="st">&quot;outside&quot;</span></span>
<span id="cb327-124"><a href="fusion_params_test.html#cb327-124" tabindex="-1"></a>    , <span class="at">strip.text.x =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb327-125"><a href="fusion_params_test.html#cb327-125" tabindex="-1"></a>    , <span class="at">axis.text.x =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">7</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb327-126"><a href="fusion_params_test.html#cb327-126" tabindex="-1"></a>    , <span class="at">axis.title.x =</span> ggplot2<span class="sc">::</span><span class="fu">element_blank</span>()</span>
<span id="cb327-127"><a href="fusion_params_test.html#cb327-127" tabindex="-1"></a>    , <span class="at">plot.subtitle =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>)</span>
<span id="cb327-128"><a href="fusion_params_test.html#cb327-128" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-289-1.png" width="1008" /></p>
<div class="sourceCode" id="cb328"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb328-1"><a href="fusion_params_test.html#cb328-1" tabindex="-1"></a>ggplot2<span class="sc">::</span><span class="fu">ggsave</span>(<span class="st">&quot;../data/bestofthebest_spectral_watersheddetectever.jpg&quot;</span>, <span class="at">height =</span> <span class="fl">8.2</span>, <span class="at">width =</span> <span class="fl">10.5</span>)</span></code></pre></div>
<p>this plot allows for a simultaneous comparison of all metrics for pile detection and pile form quantification. it includes only the parameter combinations that achieved the best balanced accuracy, helping users identify the optimal settings by evaluating the trade-offs between detection and form quantification.</p>
<p>let’s table this</p>
<div class="sourceCode" id="cb329"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb329-1"><a href="fusion_params_test.html#cb329-1" tabindex="-1"></a>param_combos_spectral_gt_agg <span class="sc">%&gt;%</span> </span>
<span id="cb329-2"><a href="fusion_params_test.html#cb329-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb329-3"><a href="fusion_params_test.html#cb329-3" tabindex="-1"></a>  <span class="co"># filter for best of best</span></span>
<span id="cb329-4"><a href="fusion_params_test.html#cb329-4" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">inner_join</span>(</span>
<span id="cb329-5"><a href="fusion_params_test.html#cb329-5" tabindex="-1"></a>    best_pile_detect_spectral_rn <span class="sc">%&gt;%</span> </span>
<span id="cb329-6"><a href="fusion_params_test.html#cb329-6" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">filter</span>(is_top_recall) <span class="sc">%&gt;%</span> </span>
<span id="cb329-7"><a href="fusion_params_test.html#cb329-7" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">select</span>(rn,spectral_weight,lab,rank_overall)</span>
<span id="cb329-8"><a href="fusion_params_test.html#cb329-8" tabindex="-1"></a>    , <span class="at">by =</span> dplyr<span class="sc">::</span><span class="fu">join_by</span>(rn,spectral_weight)</span>
<span id="cb329-9"><a href="fusion_params_test.html#cb329-9" tabindex="-1"></a>    , <span class="at">relationship =</span> <span class="st">&quot;one-to-one&quot;</span></span>
<span id="cb329-10"><a href="fusion_params_test.html#cb329-10" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb329-11"><a href="fusion_params_test.html#cb329-11" tabindex="-1"></a>  <span class="co"># first select to arrange eval_metric</span></span>
<span id="cb329-12"><a href="fusion_params_test.html#cb329-12" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb329-13"><a href="fusion_params_test.html#cb329-13" tabindex="-1"></a>    lab</span>
<span id="cb329-14"><a href="fusion_params_test.html#cb329-14" tabindex="-1"></a>    , max_ht_m,max_area_m2,convexity_pct,circle_fit_iou_pct,spectral_weight</span>
<span id="cb329-15"><a href="fusion_params_test.html#cb329-15" tabindex="-1"></a>    <span class="co"># detection</span></span>
<span id="cb329-16"><a href="fusion_params_test.html#cb329-16" tabindex="-1"></a>    , f_score, recall, precision</span>
<span id="cb329-17"><a href="fusion_params_test.html#cb329-17" tabindex="-1"></a>    <span class="co"># quantification</span></span>
<span id="cb329-18"><a href="fusion_params_test.html#cb329-18" tabindex="-1"></a>    , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_mean&quot;</span>)</span>
<span id="cb329-19"><a href="fusion_params_test.html#cb329-19" tabindex="-1"></a>    , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_rmse&quot;</span>)</span>
<span id="cb329-20"><a href="fusion_params_test.html#cb329-20" tabindex="-1"></a>    <span class="co"># , tidyselect::ends_with(&quot;_rrmse&quot;)</span></span>
<span id="cb329-21"><a href="fusion_params_test.html#cb329-21" tabindex="-1"></a>    , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_mape&quot;</span>)</span>
<span id="cb329-22"><a href="fusion_params_test.html#cb329-22" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb329-23"><a href="fusion_params_test.html#cb329-23" tabindex="-1"></a>  <span class="co"># second select to arrange pile_metric</span></span>
<span id="cb329-24"><a href="fusion_params_test.html#cb329-24" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb329-25"><a href="fusion_params_test.html#cb329-25" tabindex="-1"></a>    lab</span>
<span id="cb329-26"><a href="fusion_params_test.html#cb329-26" tabindex="-1"></a>    , max_ht_m,max_area_m2,convexity_pct,circle_fit_iou_pct,spectral_weight</span>
<span id="cb329-27"><a href="fusion_params_test.html#cb329-27" tabindex="-1"></a>    <span class="co"># detection</span></span>
<span id="cb329-28"><a href="fusion_params_test.html#cb329-28" tabindex="-1"></a>    , f_score, recall, precision</span>
<span id="cb329-29"><a href="fusion_params_test.html#cb329-29" tabindex="-1"></a>    <span class="co"># quantification</span></span>
<span id="cb329-30"><a href="fusion_params_test.html#cb329-30" tabindex="-1"></a>    , <span class="fu">c</span>(tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;volume&quot;</span>) <span class="sc">&amp;</span> <span class="sc">!</span>tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;paraboloid&quot;</span>))</span>
<span id="cb329-31"><a href="fusion_params_test.html#cb329-31" tabindex="-1"></a>    <span class="co"># , tidyselect::contains(&quot;paraboloid_volume&quot;)</span></span>
<span id="cb329-32"><a href="fusion_params_test.html#cb329-32" tabindex="-1"></a>    , tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;area&quot;</span>)</span>
<span id="cb329-33"><a href="fusion_params_test.html#cb329-33" tabindex="-1"></a>    , tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;height&quot;</span>)</span>
<span id="cb329-34"><a href="fusion_params_test.html#cb329-34" tabindex="-1"></a>    , tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;diameter&quot;</span>)</span>
<span id="cb329-35"><a href="fusion_params_test.html#cb329-35" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb329-36"><a href="fusion_params_test.html#cb329-36" tabindex="-1"></a>  <span class="co"># names()</span></span>
<span id="cb329-37"><a href="fusion_params_test.html#cb329-37" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb329-38"><a href="fusion_params_test.html#cb329-38" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">across</span>(</span>
<span id="cb329-39"><a href="fusion_params_test.html#cb329-39" tabindex="-1"></a>      <span class="at">.cols =</span> <span class="fu">c</span>(f_score, recall, precision, tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_mape&quot;</span>))</span>
<span id="cb329-40"><a href="fusion_params_test.html#cb329-40" tabindex="-1"></a>      , <span class="at">.fn =</span> <span class="sc">~</span> scales<span class="sc">::</span><span class="fu">percent</span>(.x, <span class="at">accuracy =</span> <span class="dv">1</span>)</span>
<span id="cb329-41"><a href="fusion_params_test.html#cb329-41" tabindex="-1"></a>    )</span>
<span id="cb329-42"><a href="fusion_params_test.html#cb329-42" tabindex="-1"></a>    , dplyr<span class="sc">::</span><span class="fu">across</span>(</span>
<span id="cb329-43"><a href="fusion_params_test.html#cb329-43" tabindex="-1"></a>      <span class="at">.cols =</span> <span class="fu">c</span>(tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_mean&quot;</span>))</span>
<span id="cb329-44"><a href="fusion_params_test.html#cb329-44" tabindex="-1"></a>      , <span class="at">.fn =</span> <span class="sc">~</span> scales<span class="sc">::</span><span class="fu">comma</span>(.x, <span class="at">accuracy =</span> <span class="fl">0.01</span>)</span>
<span id="cb329-45"><a href="fusion_params_test.html#cb329-45" tabindex="-1"></a>    )</span>
<span id="cb329-46"><a href="fusion_params_test.html#cb329-46" tabindex="-1"></a>    , dplyr<span class="sc">::</span><span class="fu">across</span>(</span>
<span id="cb329-47"><a href="fusion_params_test.html#cb329-47" tabindex="-1"></a>      <span class="at">.cols =</span> <span class="fu">c</span>(tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_rmse&quot;</span>))</span>
<span id="cb329-48"><a href="fusion_params_test.html#cb329-48" tabindex="-1"></a>      , <span class="at">.fn =</span> <span class="sc">~</span> scales<span class="sc">::</span><span class="fu">comma</span>(.x, <span class="at">accuracy =</span> <span class="fl">0.1</span>)</span>
<span id="cb329-49"><a href="fusion_params_test.html#cb329-49" tabindex="-1"></a>    )</span>
<span id="cb329-50"><a href="fusion_params_test.html#cb329-50" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb329-51"><a href="fusion_params_test.html#cb329-51" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">blank=</span> <span class="st">&quot;   &quot;</span> ) <span class="sc">%&gt;%</span> </span>
<span id="cb329-52"><a href="fusion_params_test.html#cb329-52" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">relocate</span>(blank, <span class="at">.before =</span> f_score) <span class="sc">%&gt;%</span> </span>
<span id="cb329-53"><a href="fusion_params_test.html#cb329-53" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(<span class="fu">desc</span>(lab)) <span class="sc">%&gt;%</span> </span>
<span id="cb329-54"><a href="fusion_params_test.html#cb329-54" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kbl</span>(</span>
<span id="cb329-55"><a href="fusion_params_test.html#cb329-55" tabindex="-1"></a>    <span class="at">caption =</span> <span class="fu">paste0</span>(</span>
<span id="cb329-56"><a href="fusion_params_test.html#cb329-56" tabindex="-1"></a>       <span class="st">&quot;pile detection and form quantification accuracy metrics for the final recommended parameter settings&quot;</span></span>
<span id="cb329-57"><a href="fusion_params_test.html#cb329-57" tabindex="-1"></a>       <span class="co"># , scales::percent(1-pct_rank_th_top,accuracy=1)</span></span>
<span id="cb329-58"><a href="fusion_params_test.html#cb329-58" tabindex="-1"></a>       , <span class="st">&quot; (n=&quot;</span></span>
<span id="cb329-59"><a href="fusion_params_test.html#cb329-59" tabindex="-1"></a>       , scales<span class="sc">::</span><span class="fu">comma</span>(<span class="fu">sum</span>(best_pile_detect_spectral_rn<span class="sc">$</span>is_top_recall,<span class="at">na.rm=</span>T), <span class="at">accuracy =</span> <span class="dv">1</span>)</span>
<span id="cb329-60"><a href="fusion_params_test.html#cb329-60" tabindex="-1"></a>       , <span class="st">&quot;)&quot;</span></span>
<span id="cb329-61"><a href="fusion_params_test.html#cb329-61" tabindex="-1"></a>       , <span class="st">&quot;&lt;br&gt;using structural and spectral data&quot;</span></span>
<span id="cb329-62"><a href="fusion_params_test.html#cb329-62" tabindex="-1"></a>      )</span>
<span id="cb329-63"><a href="fusion_params_test.html#cb329-63" tabindex="-1"></a>    , <span class="at">col.names =</span> <span class="fu">c</span>(</span>
<span id="cb329-64"><a href="fusion_params_test.html#cb329-64" tabindex="-1"></a>      <span class="st">&quot;&quot;</span></span>
<span id="cb329-65"><a href="fusion_params_test.html#cb329-65" tabindex="-1"></a>      ,<span class="st">&quot;max_ht_m&quot;</span>,<span class="st">&quot;max_area_m2&quot;</span>,<span class="st">&quot;convexity_pct&quot;</span>,<span class="st">&quot;circle_fit_iou_pct&quot;</span>,<span class="st">&quot;spectral_weight&quot;</span></span>
<span id="cb329-66"><a href="fusion_params_test.html#cb329-66" tabindex="-1"></a>      , <span class="st">&quot;   &quot;</span></span>
<span id="cb329-67"><a href="fusion_params_test.html#cb329-67" tabindex="-1"></a>      , <span class="st">&quot;F-score&quot;</span>, <span class="st">&quot;Recall&quot;</span>, <span class="st">&quot;Precision&quot;</span></span>
<span id="cb329-68"><a href="fusion_params_test.html#cb329-68" tabindex="-1"></a>      , <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;ME&quot;</span>,<span class="st">&quot;RMSE&quot;</span>,<span class="st">&quot;MAPE&quot;</span>), <span class="at">times =</span> <span class="dv">4</span>)</span>
<span id="cb329-69"><a href="fusion_params_test.html#cb329-69" tabindex="-1"></a>    )</span>
<span id="cb329-70"><a href="fusion_params_test.html#cb329-70" tabindex="-1"></a>    , <span class="at">escape =</span> F</span>
<span id="cb329-71"><a href="fusion_params_test.html#cb329-71" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb329-72"><a href="fusion_params_test.html#cb329-72" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kable_styling</span>(<span class="at">font_size =</span> <span class="dv">11</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb329-73"><a href="fusion_params_test.html#cb329-73" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">add_header_above</span>(<span class="fu">c</span>(</span>
<span id="cb329-74"><a href="fusion_params_test.html#cb329-74" tabindex="-1"></a>    <span class="st">&quot; &quot;</span><span class="ot">=</span><span class="dv">7</span></span>
<span id="cb329-75"><a href="fusion_params_test.html#cb329-75" tabindex="-1"></a>    , <span class="st">&quot;Detection&quot;</span> <span class="ot">=</span> <span class="dv">3</span></span>
<span id="cb329-76"><a href="fusion_params_test.html#cb329-76" tabindex="-1"></a>    , <span class="st">&quot;Volume&quot;</span> <span class="ot">=</span> <span class="dv">3</span></span>
<span id="cb329-77"><a href="fusion_params_test.html#cb329-77" tabindex="-1"></a>    , <span class="st">&quot;Area&quot;</span> <span class="ot">=</span> <span class="dv">3</span></span>
<span id="cb329-78"><a href="fusion_params_test.html#cb329-78" tabindex="-1"></a>    , <span class="st">&quot;Height&quot;</span> <span class="ot">=</span> <span class="dv">3</span></span>
<span id="cb329-79"><a href="fusion_params_test.html#cb329-79" tabindex="-1"></a>    , <span class="st">&quot;Diameter&quot;</span> <span class="ot">=</span> <span class="dv">3</span></span>
<span id="cb329-80"><a href="fusion_params_test.html#cb329-80" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb329-81"><a href="fusion_params_test.html#cb329-81" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">column_spec</span>(<span class="fu">seq</span>(<span class="dv">7</span>,<span class="dv">22</span>,<span class="at">by=</span><span class="dv">3</span>), <span class="at">border_right =</span> <span class="cn">TRUE</span>, <span class="at">include_thead =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb329-82"><a href="fusion_params_test.html#cb329-82" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">column_spec</span>(</span>
<span id="cb329-83"><a href="fusion_params_test.html#cb329-83" tabindex="-1"></a>    <span class="at">column =</span> <span class="dv">8</span><span class="sc">:</span><span class="dv">22</span></span>
<span id="cb329-84"><a href="fusion_params_test.html#cb329-84" tabindex="-1"></a>    , <span class="at">extra_css =</span> <span class="st">&quot;font-size: 10px;&quot;</span></span>
<span id="cb329-85"><a href="fusion_params_test.html#cb329-85" tabindex="-1"></a>    , <span class="at">include_thead =</span> T</span>
<span id="cb329-86"><a href="fusion_params_test.html#cb329-86" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb329-87"><a href="fusion_params_test.html#cb329-87" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">scroll_box</span>(<span class="at">width =</span> <span class="st">&quot;740px&quot;</span>) </span></code></pre></div>
<div style="border: 1px solid #ddd; padding: 5px; overflow-x: scroll; width:740px; ">
<table class="table" style="font-size: 11px; margin-left: auto; margin-right: auto;">
<caption style="font-size: initial !important;">
<span id="tab:unnamed-chunk-290">Table 8.7: </span>pile detection and form quantification accuracy metrics for the final recommended parameter settings (n=10)<br>using structural and spectral data
</caption>
<thead>
<tr>
<th style="empty-cells: hide;border-bottom:hidden;" colspan="7">
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="3">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Detection
</div>
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="3">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Volume
</div>
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="3">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Area
</div>
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="3">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Height
</div>
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="3">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Diameter
</div>
</th>
</tr>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
max_ht_m
</th>
<th style="text-align:right;">
max_area_m2
</th>
<th style="text-align:right;">
convexity_pct
</th>
<th style="text-align:right;">
circle_fit_iou_pct
</th>
<th style="text-align:right;">
spectral_weight
</th>
<th style="text-align:left;border-right:1px solid;">
</th>
<th style="text-align:left;font-size: 10px;">
F-score
</th>
<th style="text-align:left;font-size: 10px;">
Recall
</th>
<th style="text-align:left;border-right:1px solid;font-size: 10px;">
Precision
</th>
<th style="text-align:left;font-size: 10px;">
ME
</th>
<th style="text-align:left;font-size: 10px;">
RMSE
</th>
<th style="text-align:left;border-right:1px solid;font-size: 10px;">
MAPE
</th>
<th style="text-align:left;font-size: 10px;">
ME
</th>
<th style="text-align:left;font-size: 10px;">
RMSE
</th>
<th style="text-align:left;border-right:1px solid;font-size: 10px;">
MAPE
</th>
<th style="text-align:left;font-size: 10px;">
ME
</th>
<th style="text-align:left;font-size: 10px;">
RMSE
</th>
<th style="text-align:left;border-right:1px solid;font-size: 10px;">
MAPE
</th>
<th style="text-align:left;font-size: 10px;">
ME
</th>
<th style="text-align:left;font-size: 10px;">
RMSE
</th>
<th style="text-align:left;border-right:1px solid;font-size: 10px;">
MAPE
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
2:30:0.4:0.5:3
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
30
</td>
<td style="text-align:right;">
0.4
</td>
<td style="text-align:right;">
0.5
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;border-right:1px solid;">
</td>
<td style="text-align:left;font-size: 10px;">
73%
</td>
<td style="text-align:left;font-size: 10px;">
66%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
82%
</td>
<td style="text-align:left;font-size: 10px;">
-1.61
</td>
<td style="text-align:left;font-size: 10px;">
9.2
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
28%
</td>
<td style="text-align:left;font-size: 10px;">
0.04
</td>
<td style="text-align:left;font-size: 10px;">
3.1
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
22%
</td>
<td style="text-align:left;font-size: 10px;">
-0.25
</td>
<td style="text-align:left;font-size: 10px;">
0.5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
14%
</td>
<td style="text-align:left;font-size: 10px;">
0.72
</td>
<td style="text-align:left;font-size: 10px;">
0.9
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
24%
</td>
</tr>
<tr>
<td style="text-align:left;">
2:30:0.3:0.5:3
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
30
</td>
<td style="text-align:right;">
0.3
</td>
<td style="text-align:right;">
0.5
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;border-right:1px solid;">
</td>
<td style="text-align:left;font-size: 10px;">
73%
</td>
<td style="text-align:left;font-size: 10px;">
66%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
82%
</td>
<td style="text-align:left;font-size: 10px;">
-1.61
</td>
<td style="text-align:left;font-size: 10px;">
9.2
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
28%
</td>
<td style="text-align:left;font-size: 10px;">
0.04
</td>
<td style="text-align:left;font-size: 10px;">
3.1
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
22%
</td>
<td style="text-align:left;font-size: 10px;">
-0.25
</td>
<td style="text-align:left;font-size: 10px;">
0.5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
14%
</td>
<td style="text-align:left;font-size: 10px;">
0.72
</td>
<td style="text-align:left;font-size: 10px;">
0.9
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
24%
</td>
</tr>
<tr>
<td style="text-align:left;">
2:30:0.6:0.5:2
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
30
</td>
<td style="text-align:right;">
0.6
</td>
<td style="text-align:right;">
0.5
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;border-right:1px solid;">
</td>
<td style="text-align:left;font-size: 10px;">
72%
</td>
<td style="text-align:left;font-size: 10px;">
66%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
80%
</td>
<td style="text-align:left;font-size: 10px;">
-1.61
</td>
<td style="text-align:left;font-size: 10px;">
9.2
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
28%
</td>
<td style="text-align:left;font-size: 10px;">
0.04
</td>
<td style="text-align:left;font-size: 10px;">
3.1
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
22%
</td>
<td style="text-align:left;font-size: 10px;">
-0.25
</td>
<td style="text-align:left;font-size: 10px;">
0.5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
14%
</td>
<td style="text-align:left;font-size: 10px;">
0.72
</td>
<td style="text-align:left;font-size: 10px;">
0.9
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
24%
</td>
</tr>
<tr>
<td style="text-align:left;">
2:30:0.6:0.5:1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
30
</td>
<td style="text-align:right;">
0.6
</td>
<td style="text-align:right;">
0.5
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;border-right:1px solid;">
</td>
<td style="text-align:left;font-size: 10px;">
72%
</td>
<td style="text-align:left;font-size: 10px;">
66%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
80%
</td>
<td style="text-align:left;font-size: 10px;">
-1.61
</td>
<td style="text-align:left;font-size: 10px;">
9.2
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
28%
</td>
<td style="text-align:left;font-size: 10px;">
0.04
</td>
<td style="text-align:left;font-size: 10px;">
3.1
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
22%
</td>
<td style="text-align:left;font-size: 10px;">
-0.25
</td>
<td style="text-align:left;font-size: 10px;">
0.5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
14%
</td>
<td style="text-align:left;font-size: 10px;">
0.72
</td>
<td style="text-align:left;font-size: 10px;">
0.9
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
24%
</td>
</tr>
<tr>
<td style="text-align:left;">
2:30:0.5:0.5:2
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
30
</td>
<td style="text-align:right;">
0.5
</td>
<td style="text-align:right;">
0.5
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;border-right:1px solid;">
</td>
<td style="text-align:left;font-size: 10px;">
72%
</td>
<td style="text-align:left;font-size: 10px;">
66%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
80%
</td>
<td style="text-align:left;font-size: 10px;">
-1.61
</td>
<td style="text-align:left;font-size: 10px;">
9.2
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
28%
</td>
<td style="text-align:left;font-size: 10px;">
0.04
</td>
<td style="text-align:left;font-size: 10px;">
3.1
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
22%
</td>
<td style="text-align:left;font-size: 10px;">
-0.25
</td>
<td style="text-align:left;font-size: 10px;">
0.5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
14%
</td>
<td style="text-align:left;font-size: 10px;">
0.72
</td>
<td style="text-align:left;font-size: 10px;">
0.9
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
24%
</td>
</tr>
<tr>
<td style="text-align:left;">
2:30:0.5:0.5:1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
30
</td>
<td style="text-align:right;">
0.5
</td>
<td style="text-align:right;">
0.5
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;border-right:1px solid;">
</td>
<td style="text-align:left;font-size: 10px;">
72%
</td>
<td style="text-align:left;font-size: 10px;">
66%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
80%
</td>
<td style="text-align:left;font-size: 10px;">
-1.61
</td>
<td style="text-align:left;font-size: 10px;">
9.2
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
28%
</td>
<td style="text-align:left;font-size: 10px;">
0.04
</td>
<td style="text-align:left;font-size: 10px;">
3.1
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
22%
</td>
<td style="text-align:left;font-size: 10px;">
-0.25
</td>
<td style="text-align:left;font-size: 10px;">
0.5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
14%
</td>
<td style="text-align:left;font-size: 10px;">
0.72
</td>
<td style="text-align:left;font-size: 10px;">
0.9
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
24%
</td>
</tr>
<tr>
<td style="text-align:left;">
2:30:0.4:0.5:2
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
30
</td>
<td style="text-align:right;">
0.4
</td>
<td style="text-align:right;">
0.5
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;border-right:1px solid;">
</td>
<td style="text-align:left;font-size: 10px;">
72%
</td>
<td style="text-align:left;font-size: 10px;">
66%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
80%
</td>
<td style="text-align:left;font-size: 10px;">
-1.61
</td>
<td style="text-align:left;font-size: 10px;">
9.2
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
28%
</td>
<td style="text-align:left;font-size: 10px;">
0.04
</td>
<td style="text-align:left;font-size: 10px;">
3.1
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
22%
</td>
<td style="text-align:left;font-size: 10px;">
-0.25
</td>
<td style="text-align:left;font-size: 10px;">
0.5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
14%
</td>
<td style="text-align:left;font-size: 10px;">
0.72
</td>
<td style="text-align:left;font-size: 10px;">
0.9
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
24%
</td>
</tr>
<tr>
<td style="text-align:left;">
2:30:0.4:0.5:1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
30
</td>
<td style="text-align:right;">
0.4
</td>
<td style="text-align:right;">
0.5
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;border-right:1px solid;">
</td>
<td style="text-align:left;font-size: 10px;">
72%
</td>
<td style="text-align:left;font-size: 10px;">
66%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
80%
</td>
<td style="text-align:left;font-size: 10px;">
-1.61
</td>
<td style="text-align:left;font-size: 10px;">
9.2
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
28%
</td>
<td style="text-align:left;font-size: 10px;">
0.04
</td>
<td style="text-align:left;font-size: 10px;">
3.1
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
22%
</td>
<td style="text-align:left;font-size: 10px;">
-0.25
</td>
<td style="text-align:left;font-size: 10px;">
0.5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
14%
</td>
<td style="text-align:left;font-size: 10px;">
0.72
</td>
<td style="text-align:left;font-size: 10px;">
0.9
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
24%
</td>
</tr>
<tr>
<td style="text-align:left;">
2:30:0.3:0.5:2
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
30
</td>
<td style="text-align:right;">
0.3
</td>
<td style="text-align:right;">
0.5
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;border-right:1px solid;">
</td>
<td style="text-align:left;font-size: 10px;">
72%
</td>
<td style="text-align:left;font-size: 10px;">
66%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
80%
</td>
<td style="text-align:left;font-size: 10px;">
-1.61
</td>
<td style="text-align:left;font-size: 10px;">
9.2
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
28%
</td>
<td style="text-align:left;font-size: 10px;">
0.04
</td>
<td style="text-align:left;font-size: 10px;">
3.1
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
22%
</td>
<td style="text-align:left;font-size: 10px;">
-0.25
</td>
<td style="text-align:left;font-size: 10px;">
0.5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
14%
</td>
<td style="text-align:left;font-size: 10px;">
0.72
</td>
<td style="text-align:left;font-size: 10px;">
0.9
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
24%
</td>
</tr>
<tr>
<td style="text-align:left;">
2:30:0.3:0.5:1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
30
</td>
<td style="text-align:right;">
0.3
</td>
<td style="text-align:right;">
0.5
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;border-right:1px solid;">
</td>
<td style="text-align:left;font-size: 10px;">
72%
</td>
<td style="text-align:left;font-size: 10px;">
66%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
80%
</td>
<td style="text-align:left;font-size: 10px;">
-1.61
</td>
<td style="text-align:left;font-size: 10px;">
9.2
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
28%
</td>
<td style="text-align:left;font-size: 10px;">
0.04
</td>
<td style="text-align:left;font-size: 10px;">
3.1
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
22%
</td>
<td style="text-align:left;font-size: 10px;">
-0.25
</td>
<td style="text-align:left;font-size: 10px;">
0.5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
14%
</td>
<td style="text-align:left;font-size: 10px;">
0.72
</td>
<td style="text-align:left;font-size: 10px;">
0.9
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
24%
</td>
</tr>
</tbody>
</table>
</div>
<p>what is the detection accuracy of these final recommended parameter settings?</p>
<div class="sourceCode" id="cb330"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb330-1"><a href="fusion_params_test.html#cb330-1" tabindex="-1"></a><span class="co"># plot it</span></span>
<span id="cb330-2"><a href="fusion_params_test.html#cb330-2" tabindex="-1"></a><span class="fu">plt_detection_dist</span>(</span>
<span id="cb330-3"><a href="fusion_params_test.html#cb330-3" tabindex="-1"></a>  <span class="at">df =</span> param_combos_spectral_gt_agg <span class="sc">%&gt;%</span> </span>
<span id="cb330-4"><a href="fusion_params_test.html#cb330-4" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb330-5"><a href="fusion_params_test.html#cb330-5" tabindex="-1"></a>    <span class="co"># filter for best of best</span></span>
<span id="cb330-6"><a href="fusion_params_test.html#cb330-6" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">inner_join</span>(</span>
<span id="cb330-7"><a href="fusion_params_test.html#cb330-7" tabindex="-1"></a>      best_pile_detect_spectral_rn <span class="sc">%&gt;%</span> </span>
<span id="cb330-8"><a href="fusion_params_test.html#cb330-8" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">filter</span>(is_top_recall) <span class="sc">%&gt;%</span> </span>
<span id="cb330-9"><a href="fusion_params_test.html#cb330-9" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">distinct</span>(rn,spectral_weight)</span>
<span id="cb330-10"><a href="fusion_params_test.html#cb330-10" tabindex="-1"></a>      , <span class="at">by =</span> dplyr<span class="sc">::</span><span class="fu">join_by</span>(rn,spectral_weight)</span>
<span id="cb330-11"><a href="fusion_params_test.html#cb330-11" tabindex="-1"></a>      , <span class="at">relationship =</span> <span class="st">&quot;one-to-one&quot;</span></span>
<span id="cb330-12"><a href="fusion_params_test.html#cb330-12" tabindex="-1"></a>    )</span>
<span id="cb330-13"><a href="fusion_params_test.html#cb330-13" tabindex="-1"></a>  , <span class="fu">paste0</span>(</span>
<span id="cb330-14"><a href="fusion_params_test.html#cb330-14" tabindex="-1"></a>       <span class="st">&quot;distribution of pile detection accuracy metrics for the final recommended parameter settings&quot;</span></span>
<span id="cb330-15"><a href="fusion_params_test.html#cb330-15" tabindex="-1"></a>       <span class="co"># , scales::percent(1-pct_rank_th_top,accuracy=1)</span></span>
<span id="cb330-16"><a href="fusion_params_test.html#cb330-16" tabindex="-1"></a>       , <span class="st">&quot; (n=&quot;</span></span>
<span id="cb330-17"><a href="fusion_params_test.html#cb330-17" tabindex="-1"></a>       , scales<span class="sc">::</span><span class="fu">comma</span>(<span class="fu">sum</span>(best_pile_detect_spectral_rn<span class="sc">$</span>is_top_recall,<span class="at">na.rm=</span>T), <span class="at">accuracy =</span> <span class="dv">1</span>)</span>
<span id="cb330-18"><a href="fusion_params_test.html#cb330-18" tabindex="-1"></a>       , <span class="st">&quot;)&quot;</span></span>
<span id="cb330-19"><a href="fusion_params_test.html#cb330-19" tabindex="-1"></a>       , <span class="st">&quot;</span><span class="sc">\n</span><span class="st">using structural and spectral data&quot;</span></span>
<span id="cb330-20"><a href="fusion_params_test.html#cb330-20" tabindex="-1"></a>      )</span>
<span id="cb330-21"><a href="fusion_params_test.html#cb330-21" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-291-1.png" width="1008" /></p>
<p>what is the quantification accuracy of these final recommended parameter settings?</p>
<div class="sourceCode" id="cb331"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb331-1"><a href="fusion_params_test.html#cb331-1" tabindex="-1"></a><span class="co"># plot it</span></span>
<span id="cb331-2"><a href="fusion_params_test.html#cb331-2" tabindex="-1"></a><span class="fu">plt_form_quantification_dist</span>(</span>
<span id="cb331-3"><a href="fusion_params_test.html#cb331-3" tabindex="-1"></a>  <span class="at">df =</span> param_combos_spectral_gt_agg <span class="sc">%&gt;%</span> </span>
<span id="cb331-4"><a href="fusion_params_test.html#cb331-4" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb331-5"><a href="fusion_params_test.html#cb331-5" tabindex="-1"></a>    <span class="co"># filter for best of best</span></span>
<span id="cb331-6"><a href="fusion_params_test.html#cb331-6" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">inner_join</span>(</span>
<span id="cb331-7"><a href="fusion_params_test.html#cb331-7" tabindex="-1"></a>      best_pile_detect_spectral_rn <span class="sc">%&gt;%</span> </span>
<span id="cb331-8"><a href="fusion_params_test.html#cb331-8" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">filter</span>(is_top_recall) <span class="sc">%&gt;%</span> </span>
<span id="cb331-9"><a href="fusion_params_test.html#cb331-9" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">distinct</span>(rn,spectral_weight)</span>
<span id="cb331-10"><a href="fusion_params_test.html#cb331-10" tabindex="-1"></a>      , <span class="at">by =</span> dplyr<span class="sc">::</span><span class="fu">join_by</span>(rn,spectral_weight)</span>
<span id="cb331-11"><a href="fusion_params_test.html#cb331-11" tabindex="-1"></a>      , <span class="at">relationship =</span> <span class="st">&quot;one-to-one&quot;</span></span>
<span id="cb331-12"><a href="fusion_params_test.html#cb331-12" tabindex="-1"></a>    )</span>
<span id="cb331-13"><a href="fusion_params_test.html#cb331-13" tabindex="-1"></a>  , <span class="fu">paste0</span>(</span>
<span id="cb331-14"><a href="fusion_params_test.html#cb331-14" tabindex="-1"></a>       <span class="st">&quot;distribution of pile form quantification accuracy metrics for the final recommended parameter settings&quot;</span></span>
<span id="cb331-15"><a href="fusion_params_test.html#cb331-15" tabindex="-1"></a>       <span class="co"># , scales::percent(1-pct_rank_th_top,accuracy=1)</span></span>
<span id="cb331-16"><a href="fusion_params_test.html#cb331-16" tabindex="-1"></a>       , <span class="st">&quot; (n=&quot;</span></span>
<span id="cb331-17"><a href="fusion_params_test.html#cb331-17" tabindex="-1"></a>       , scales<span class="sc">::</span><span class="fu">comma</span>(<span class="fu">sum</span>(best_pile_detect_spectral_rn<span class="sc">$</span>is_top_recall,<span class="at">na.rm=</span>T), <span class="at">accuracy =</span> <span class="dv">1</span>)</span>
<span id="cb331-18"><a href="fusion_params_test.html#cb331-18" tabindex="-1"></a>       , <span class="st">&quot;)&quot;</span></span>
<span id="cb331-19"><a href="fusion_params_test.html#cb331-19" tabindex="-1"></a>       , <span class="st">&quot;</span><span class="sc">\n</span><span class="st">using structural and spectral data&quot;</span></span>
<span id="cb331-20"><a href="fusion_params_test.html#cb331-20" tabindex="-1"></a>      )</span>
<span id="cb331-21"><a href="fusion_params_test.html#cb331-21" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-292-1.png" width="1008" /></p>
<p>if we look at only these final recommended parameter settings, what is the distribution of individual parameter settings?</p>
<div class="sourceCode" id="cb332"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb332-1"><a href="fusion_params_test.html#cb332-1" tabindex="-1"></a>pal_param <span class="ot">&lt;-</span> viridis<span class="sc">::</span><span class="fu">plasma</span>(<span class="at">n=</span><span class="dv">5</span>, <span class="at">begin =</span> <span class="fl">0.1</span>, <span class="at">end =</span> <span class="fl">0.9</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>)</span>
<span id="cb332-2"><a href="fusion_params_test.html#cb332-2" tabindex="-1"></a><span class="co"># plot</span></span>
<span id="cb332-3"><a href="fusion_params_test.html#cb332-3" tabindex="-1"></a>param_combos_spectral_gt_agg <span class="sc">%&gt;%</span> </span>
<span id="cb332-4"><a href="fusion_params_test.html#cb332-4" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb332-5"><a href="fusion_params_test.html#cb332-5" tabindex="-1"></a>  <span class="co"># filter for best of best</span></span>
<span id="cb332-6"><a href="fusion_params_test.html#cb332-6" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">inner_join</span>(</span>
<span id="cb332-7"><a href="fusion_params_test.html#cb332-7" tabindex="-1"></a>    best_pile_detect_spectral_rn <span class="sc">%&gt;%</span> </span>
<span id="cb332-8"><a href="fusion_params_test.html#cb332-8" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">filter</span>(is_top_recall) <span class="sc">%&gt;%</span> </span>
<span id="cb332-9"><a href="fusion_params_test.html#cb332-9" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">distinct</span>(rn,spectral_weight)</span>
<span id="cb332-10"><a href="fusion_params_test.html#cb332-10" tabindex="-1"></a>    , <span class="at">by =</span> dplyr<span class="sc">::</span><span class="fu">join_by</span>(rn,spectral_weight)</span>
<span id="cb332-11"><a href="fusion_params_test.html#cb332-11" tabindex="-1"></a>    , <span class="at">relationship =</span> <span class="st">&quot;one-to-one&quot;</span></span>
<span id="cb332-12"><a href="fusion_params_test.html#cb332-12" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb332-13"><a href="fusion_params_test.html#cb332-13" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;f_score&quot;</span>), max_ht_m,max_area_m2,convexity_pct,circle_fit_iou_pct,spectral_weight) <span class="sc">%&gt;%</span> </span>
<span id="cb332-14"><a href="fusion_params_test.html#cb332-14" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(</span>
<span id="cb332-15"><a href="fusion_params_test.html#cb332-15" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">c</span>(max_ht_m,max_area_m2,convexity_pct,circle_fit_iou_pct,spectral_weight)</span>
<span id="cb332-16"><a href="fusion_params_test.html#cb332-16" tabindex="-1"></a>    , <span class="at">names_to =</span> <span class="st">&quot;metric&quot;</span></span>
<span id="cb332-17"><a href="fusion_params_test.html#cb332-17" tabindex="-1"></a>    , <span class="at">values_to =</span> <span class="st">&quot;value&quot;</span></span>
<span id="cb332-18"><a href="fusion_params_test.html#cb332-18" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb332-19"><a href="fusion_params_test.html#cb332-19" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">count</span>(metric, value) <span class="sc">%&gt;%</span> </span>
<span id="cb332-20"><a href="fusion_params_test.html#cb332-20" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(metric) <span class="sc">%&gt;%</span> </span>
<span id="cb332-21"><a href="fusion_params_test.html#cb332-21" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb332-22"><a href="fusion_params_test.html#cb332-22" tabindex="-1"></a>    <span class="at">pct=</span>n<span class="sc">/</span><span class="fu">sum</span>(n)</span>
<span id="cb332-23"><a href="fusion_params_test.html#cb332-23" tabindex="-1"></a>    , <span class="at">lab =</span> <span class="fu">paste0</span>(scales<span class="sc">::</span><span class="fu">percent</span>(pct,<span class="at">accuracy=</span><span class="fl">0.1</span>), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">n=&quot;</span>, scales<span class="sc">::</span><span class="fu">comma</span>(n,<span class="at">accuracy=</span><span class="dv">1</span>))</span>
<span id="cb332-24"><a href="fusion_params_test.html#cb332-24" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb332-25"><a href="fusion_params_test.html#cb332-25" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(</span>
<span id="cb332-26"><a href="fusion_params_test.html#cb332-26" tabindex="-1"></a>    <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">factor</span>(value), <span class="at">y=</span>pct, <span class="at">label=</span>lab, <span class="at">fill =</span> metric)</span>
<span id="cb332-27"><a href="fusion_params_test.html#cb332-27" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb332-28"><a href="fusion_params_test.html#cb332-28" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_col</span>(<span class="at">width =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb332-29"><a href="fusion_params_test.html#cb332-29" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_text</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">size =</span> <span class="fl">2.5</span>, <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb332-30"><a href="fusion_params_test.html#cb332-30" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">facet_wrap</span>(<span class="at">facets =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(metric), <span class="at">ncol=</span><span class="dv">2</span>, <span class="at">scales =</span> <span class="st">&quot;free_x&quot;</span>) <span class="sc">+</span></span>
<span id="cb332-31"><a href="fusion_params_test.html#cb332-31" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_y_continuous</span>(</span>
<span id="cb332-32"><a href="fusion_params_test.html#cb332-32" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="at">by=</span><span class="fl">0.2</span>)</span>
<span id="cb332-33"><a href="fusion_params_test.html#cb332-33" tabindex="-1"></a>    , <span class="at">labels =</span> scales<span class="sc">::</span>percent</span>
<span id="cb332-34"><a href="fusion_params_test.html#cb332-34" tabindex="-1"></a>    , <span class="at">expand =</span> ggplot2<span class="sc">::</span><span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">0.2</span>))</span>
<span id="cb332-35"><a href="fusion_params_test.html#cb332-35" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb332-36"><a href="fusion_params_test.html#cb332-36" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_fill_manual</span>(<span class="at">values =</span> pal_param) <span class="sc">+</span></span>
<span id="cb332-37"><a href="fusion_params_test.html#cb332-37" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb332-38"><a href="fusion_params_test.html#cb332-38" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;parameter setting&quot;</span>, <span class="at">y =</span> <span class="st">&quot;&quot;</span></span>
<span id="cb332-39"><a href="fusion_params_test.html#cb332-39" tabindex="-1"></a>    , <span class="at">fill =</span> <span class="st">&quot;&quot;</span></span>
<span id="cb332-40"><a href="fusion_params_test.html#cb332-40" tabindex="-1"></a>    , <span class="at">subtitle =</span> <span class="fu">paste0</span>(</span>
<span id="cb332-41"><a href="fusion_params_test.html#cb332-41" tabindex="-1"></a>       <span class="st">&quot;parameter settings for the final recommended parameter settings&quot;</span></span>
<span id="cb332-42"><a href="fusion_params_test.html#cb332-42" tabindex="-1"></a>       <span class="co"># , scales::percent(1-pct_rank_th_top,accuracy=1)</span></span>
<span id="cb332-43"><a href="fusion_params_test.html#cb332-43" tabindex="-1"></a>       , <span class="st">&quot; (n=&quot;</span></span>
<span id="cb332-44"><a href="fusion_params_test.html#cb332-44" tabindex="-1"></a>       , scales<span class="sc">::</span><span class="fu">comma</span>(<span class="fu">sum</span>(best_pile_detect_spectral_rn<span class="sc">$</span>is_top_recall,<span class="at">na.rm=</span>T), <span class="at">accuracy =</span> <span class="dv">1</span>)</span>
<span id="cb332-45"><a href="fusion_params_test.html#cb332-45" tabindex="-1"></a>       , <span class="st">&quot;)&quot;</span></span>
<span id="cb332-46"><a href="fusion_params_test.html#cb332-46" tabindex="-1"></a>       , <span class="st">&quot;</span><span class="sc">\n</span><span class="st">using structural and spectral data&quot;</span></span>
<span id="cb332-47"><a href="fusion_params_test.html#cb332-47" tabindex="-1"></a>      )</span>
<span id="cb332-48"><a href="fusion_params_test.html#cb332-48" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb332-49"><a href="fusion_params_test.html#cb332-49" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb332-50"><a href="fusion_params_test.html#cb332-50" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb332-51"><a href="fusion_params_test.html#cb332-51" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb332-52"><a href="fusion_params_test.html#cb332-52" tabindex="-1"></a>    , <span class="at">strip.text =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb332-53"><a href="fusion_params_test.html#cb332-53" tabindex="-1"></a>    , <span class="at">axis.text.y =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">6</span>)</span>
<span id="cb332-54"><a href="fusion_params_test.html#cb332-54" tabindex="-1"></a>    , <span class="at">axis.text.x =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>)</span>
<span id="cb332-55"><a href="fusion_params_test.html#cb332-55" tabindex="-1"></a>    , <span class="at">plot.subtitle =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>)</span>
<span id="cb332-56"><a href="fusion_params_test.html#cb332-56" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-293-1.png" width="1008" /></p>
</div>
<div id="final-recommended-settings-data-fusion-versus-structural-only" class="section level2 hasAnchor" number="8.5">
<h2><span class="header-section-number">8.5</span> Final recommended settings: data fusion versus structural only<a href="fusion_params_test.html#final-recommended-settings-data-fusion-versus-structural-only" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>let’s determine the impact of including both structural and spectral data in a data fusion approach versus using structural data alone (i.e. point cloud or raster data) for detecting and determining the form of slash piles. we’ll do this by comparing only the top 10 final recommended settings which were determined by selecting those sets that not only balance detection and quantification accuracy, but also achieve the highest recall rates. if a parameter combination set using our data fusion approach was selected that did not utilize any spectral data was selected, then it will be dropped from consideration within the data fusion grouping.</p>
<p>we’ll average across all 10 final recommended settings of the data fusion and structural-only approach to determine the impact of including spectral data</p>
<p>first, we need to compile data from the recommended settings from both methods</p>
<div class="sourceCode" id="cb333"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb333-1"><a href="fusion_params_test.html#cb333-1" tabindex="-1"></a>param_combos_gt_meth_comp <span class="ot">&lt;-</span> </span>
<span id="cb333-2"><a href="fusion_params_test.html#cb333-2" tabindex="-1"></a>  <span class="co"># structural only</span></span>
<span id="cb333-3"><a href="fusion_params_test.html#cb333-3" tabindex="-1"></a>  param_combos_gt_agg <span class="sc">%&gt;%</span></span>
<span id="cb333-4"><a href="fusion_params_test.html#cb333-4" tabindex="-1"></a>  <span class="co"># filter for best of best</span></span>
<span id="cb333-5"><a href="fusion_params_test.html#cb333-5" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">inner_join</span>(</span>
<span id="cb333-6"><a href="fusion_params_test.html#cb333-6" tabindex="-1"></a>    best_pile_detect_rn <span class="sc">%&gt;%</span> </span>
<span id="cb333-7"><a href="fusion_params_test.html#cb333-7" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">filter</span>(is_top_recall) <span class="sc">%&gt;%</span> </span>
<span id="cb333-8"><a href="fusion_params_test.html#cb333-8" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">arrange</span>(rank_overall) <span class="sc">%&gt;%</span> </span>
<span id="cb333-9"><a href="fusion_params_test.html#cb333-9" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">filter</span>(dplyr<span class="sc">::</span><span class="fu">row_number</span>()<span class="sc">&lt;=</span><span class="dv">10</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb333-10"><a href="fusion_params_test.html#cb333-10" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">distinct</span>(rn)</span>
<span id="cb333-11"><a href="fusion_params_test.html#cb333-11" tabindex="-1"></a>    , <span class="at">by =</span> <span class="st">&quot;rn&quot;</span></span>
<span id="cb333-12"><a href="fusion_params_test.html#cb333-12" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb333-13"><a href="fusion_params_test.html#cb333-13" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">spectral_weight =</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb333-14"><a href="fusion_params_test.html#cb333-14" tabindex="-1"></a><span class="co"># structural+spectral</span></span>
<span id="cb333-15"><a href="fusion_params_test.html#cb333-15" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(</span>
<span id="cb333-16"><a href="fusion_params_test.html#cb333-16" tabindex="-1"></a>    param_combos_spectral_gt_agg <span class="sc">%&gt;%</span> </span>
<span id="cb333-17"><a href="fusion_params_test.html#cb333-17" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb333-18"><a href="fusion_params_test.html#cb333-18" tabindex="-1"></a>      <span class="co"># filter for best of best</span></span>
<span id="cb333-19"><a href="fusion_params_test.html#cb333-19" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">inner_join</span>(</span>
<span id="cb333-20"><a href="fusion_params_test.html#cb333-20" tabindex="-1"></a>        best_pile_detect_spectral_rn <span class="sc">%&gt;%</span> </span>
<span id="cb333-21"><a href="fusion_params_test.html#cb333-21" tabindex="-1"></a>          dplyr<span class="sc">::</span><span class="fu">filter</span>(is_top_recall) <span class="sc">%&gt;%</span> </span>
<span id="cb333-22"><a href="fusion_params_test.html#cb333-22" tabindex="-1"></a>          dplyr<span class="sc">::</span><span class="fu">arrange</span>(rank_overall) <span class="sc">%&gt;%</span> </span>
<span id="cb333-23"><a href="fusion_params_test.html#cb333-23" tabindex="-1"></a>          dplyr<span class="sc">::</span><span class="fu">filter</span>(dplyr<span class="sc">::</span><span class="fu">row_number</span>()<span class="sc">&lt;=</span><span class="dv">10</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb333-24"><a href="fusion_params_test.html#cb333-24" tabindex="-1"></a>          dplyr<span class="sc">::</span><span class="fu">distinct</span>(rn,spectral_weight)</span>
<span id="cb333-25"><a href="fusion_params_test.html#cb333-25" tabindex="-1"></a>        , <span class="at">by =</span> dplyr<span class="sc">::</span><span class="fu">join_by</span>(rn,spectral_weight)</span>
<span id="cb333-26"><a href="fusion_params_test.html#cb333-26" tabindex="-1"></a>        , <span class="at">relationship =</span> <span class="st">&quot;one-to-one&quot;</span></span>
<span id="cb333-27"><a href="fusion_params_test.html#cb333-27" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span></span>
<span id="cb333-28"><a href="fusion_params_test.html#cb333-28" tabindex="-1"></a>      <span class="co"># remove non spectral</span></span>
<span id="cb333-29"><a href="fusion_params_test.html#cb333-29" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">filter</span>(spectral_weight<span class="sc">!=</span><span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb333-30"><a href="fusion_params_test.html#cb333-30" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">names</span>(param_combos_gt_agg),spectral_weight)</span>
<span id="cb333-31"><a href="fusion_params_test.html#cb333-31" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb333-32"><a href="fusion_params_test.html#cb333-32" tabindex="-1"></a>  <span class="co"># make dichotomous factor</span></span>
<span id="cb333-33"><a href="fusion_params_test.html#cb333-33" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb333-34"><a href="fusion_params_test.html#cb333-34" tabindex="-1"></a>    <span class="at">spectral_weight_fact =</span> <span class="fu">ifelse</span>(spectral_weight<span class="sc">==</span><span class="dv">0</span>,<span class="st">&quot;structural only&quot;</span>,<span class="st">&quot;structural+spectral&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb333-35"><a href="fusion_params_test.html#cb333-35" tabindex="-1"></a>      <span class="fu">factor</span>()</span>
<span id="cb333-36"><a href="fusion_params_test.html#cb333-36" tabindex="-1"></a>  )</span></code></pre></div>
<p>let’s look at the distributions of the evaluation metrics</p>
<div class="sourceCode" id="cb334"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb334-1"><a href="fusion_params_test.html#cb334-1" tabindex="-1"></a>df_temp <span class="ot">&lt;-</span> </span>
<span id="cb334-2"><a href="fusion_params_test.html#cb334-2" tabindex="-1"></a>  param_combos_gt_meth_comp <span class="sc">%&gt;%</span> </span>
<span id="cb334-3"><a href="fusion_params_test.html#cb334-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb334-4"><a href="fusion_params_test.html#cb334-4" tabindex="-1"></a>    max_ht_m,max_area_m2,convexity_pct,circle_fit_iou_pct,spectral_weight</span>
<span id="cb334-5"><a href="fusion_params_test.html#cb334-5" tabindex="-1"></a>    , spectral_weight_fact</span>
<span id="cb334-6"><a href="fusion_params_test.html#cb334-6" tabindex="-1"></a>    <span class="co"># detection</span></span>
<span id="cb334-7"><a href="fusion_params_test.html#cb334-7" tabindex="-1"></a>    , f_score, recall, precision</span>
<span id="cb334-8"><a href="fusion_params_test.html#cb334-8" tabindex="-1"></a>    <span class="co"># quantification</span></span>
<span id="cb334-9"><a href="fusion_params_test.html#cb334-9" tabindex="-1"></a>    , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_rmse&quot;</span>)</span>
<span id="cb334-10"><a href="fusion_params_test.html#cb334-10" tabindex="-1"></a>    , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_rrmse&quot;</span>)</span>
<span id="cb334-11"><a href="fusion_params_test.html#cb334-11" tabindex="-1"></a>    , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_mean&quot;</span>)</span>
<span id="cb334-12"><a href="fusion_params_test.html#cb334-12" tabindex="-1"></a>    , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_mape&quot;</span>)</span>
<span id="cb334-13"><a href="fusion_params_test.html#cb334-13" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb334-14"><a href="fusion_params_test.html#cb334-14" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(</span>
<span id="cb334-15"><a href="fusion_params_test.html#cb334-15" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">c</span>(</span>
<span id="cb334-16"><a href="fusion_params_test.html#cb334-16" tabindex="-1"></a>      f_score, recall, precision</span>
<span id="cb334-17"><a href="fusion_params_test.html#cb334-17" tabindex="-1"></a>      , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_rmse&quot;</span>)</span>
<span id="cb334-18"><a href="fusion_params_test.html#cb334-18" tabindex="-1"></a>      , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_rrmse&quot;</span>)</span>
<span id="cb334-19"><a href="fusion_params_test.html#cb334-19" tabindex="-1"></a>      , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_mean&quot;</span>)</span>
<span id="cb334-20"><a href="fusion_params_test.html#cb334-20" tabindex="-1"></a>      , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_mape&quot;</span>)</span>
<span id="cb334-21"><a href="fusion_params_test.html#cb334-21" tabindex="-1"></a>    )</span>
<span id="cb334-22"><a href="fusion_params_test.html#cb334-22" tabindex="-1"></a>    , <span class="at">names_to =</span> <span class="st">&quot;metric&quot;</span></span>
<span id="cb334-23"><a href="fusion_params_test.html#cb334-23" tabindex="-1"></a>    , <span class="at">values_to =</span> <span class="st">&quot;value&quot;</span></span>
<span id="cb334-24"><a href="fusion_params_test.html#cb334-24" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb334-25"><a href="fusion_params_test.html#cb334-25" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb334-26"><a href="fusion_params_test.html#cb334-26" tabindex="-1"></a>    <span class="at">eval_metric =</span> stringr<span class="sc">::</span><span class="fu">str_extract</span>(metric, <span class="st">&quot;(_rmse|_rrmse|_mean|_mape|f_score|recall|precision)$&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb334-27"><a href="fusion_params_test.html#cb334-27" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_remove_all</span>(<span class="st">&quot;_&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb334-28"><a href="fusion_params_test.html#cb334-28" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_replace_all</span>(<span class="st">&quot;mean&quot;</span>,<span class="st">&quot;me&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb334-29"><a href="fusion_params_test.html#cb334-29" tabindex="-1"></a>      <span class="fu">toupper</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb334-30"><a href="fusion_params_test.html#cb334-30" tabindex="-1"></a>      <span class="fu">factor</span>(</span>
<span id="cb334-31"><a href="fusion_params_test.html#cb334-31" tabindex="-1"></a>        <span class="at">ordered =</span> T</span>
<span id="cb334-32"><a href="fusion_params_test.html#cb334-32" tabindex="-1"></a>        , <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;FSCORE&quot;</span>,<span class="st">&quot;RECALL&quot;</span>,<span class="st">&quot;PRECISION&quot;</span>, <span class="st">&quot;ME&quot;</span>,<span class="st">&quot;RMSE&quot;</span>,<span class="st">&quot;RRMSE&quot;</span>,<span class="st">&quot;MAPE&quot;</span>)</span>
<span id="cb334-33"><a href="fusion_params_test.html#cb334-33" tabindex="-1"></a>        , <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;F-score&quot;</span>,<span class="st">&quot;Recall&quot;</span>,<span class="st">&quot;Precision&quot;</span>, <span class="st">&quot;ME&quot;</span>,<span class="st">&quot;RMSE&quot;</span>,<span class="st">&quot;RRMSE&quot;</span>,<span class="st">&quot;MAPE&quot;</span>)</span>
<span id="cb334-34"><a href="fusion_params_test.html#cb334-34" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span> forcats<span class="sc">::</span><span class="fu">fct_rev</span>()</span>
<span id="cb334-35"><a href="fusion_params_test.html#cb334-35" tabindex="-1"></a>    , <span class="at">pile_metric =</span> metric <span class="sc">%&gt;%</span> </span>
<span id="cb334-36"><a href="fusion_params_test.html#cb334-36" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_remove</span>(<span class="st">&quot;(_rmse|_rrmse|_mean|_mape)$&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb334-37"><a href="fusion_params_test.html#cb334-37" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_extract</span>(<span class="st">&quot;(paraboloid_volume|volume|area|height|diameter)&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb334-38"><a href="fusion_params_test.html#cb334-38" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">coalesce</span>(<span class="st">&quot;detection&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb334-39"><a href="fusion_params_test.html#cb334-39" tabindex="-1"></a>      <span class="fu">factor</span>(</span>
<span id="cb334-40"><a href="fusion_params_test.html#cb334-40" tabindex="-1"></a>        <span class="at">ordered =</span> T</span>
<span id="cb334-41"><a href="fusion_params_test.html#cb334-41" tabindex="-1"></a>        , <span class="at">levels =</span> <span class="fu">c</span>(</span>
<span id="cb334-42"><a href="fusion_params_test.html#cb334-42" tabindex="-1"></a>          <span class="st">&quot;detection&quot;</span></span>
<span id="cb334-43"><a href="fusion_params_test.html#cb334-43" tabindex="-1"></a>          , <span class="st">&quot;volume&quot;</span></span>
<span id="cb334-44"><a href="fusion_params_test.html#cb334-44" tabindex="-1"></a>          , <span class="st">&quot;paraboloid_volume&quot;</span></span>
<span id="cb334-45"><a href="fusion_params_test.html#cb334-45" tabindex="-1"></a>          , <span class="st">&quot;area&quot;</span></span>
<span id="cb334-46"><a href="fusion_params_test.html#cb334-46" tabindex="-1"></a>          , <span class="st">&quot;height&quot;</span></span>
<span id="cb334-47"><a href="fusion_params_test.html#cb334-47" tabindex="-1"></a>          , <span class="st">&quot;diameter&quot;</span></span>
<span id="cb334-48"><a href="fusion_params_test.html#cb334-48" tabindex="-1"></a>        )</span>
<span id="cb334-49"><a href="fusion_params_test.html#cb334-49" tabindex="-1"></a>        , <span class="at">labels =</span> <span class="fu">c</span>(</span>
<span id="cb334-50"><a href="fusion_params_test.html#cb334-50" tabindex="-1"></a>          <span class="st">&quot;Detection&quot;</span></span>
<span id="cb334-51"><a href="fusion_params_test.html#cb334-51" tabindex="-1"></a>          , <span class="st">&quot;Volume&quot;</span></span>
<span id="cb334-52"><a href="fusion_params_test.html#cb334-52" tabindex="-1"></a>          , <span class="st">&quot;Volume paraboloid&quot;</span></span>
<span id="cb334-53"><a href="fusion_params_test.html#cb334-53" tabindex="-1"></a>          , <span class="st">&quot;Area&quot;</span></span>
<span id="cb334-54"><a href="fusion_params_test.html#cb334-54" tabindex="-1"></a>          , <span class="st">&quot;Height&quot;</span></span>
<span id="cb334-55"><a href="fusion_params_test.html#cb334-55" tabindex="-1"></a>          , <span class="st">&quot;Diameter&quot;</span></span>
<span id="cb334-56"><a href="fusion_params_test.html#cb334-56" tabindex="-1"></a>        )</span>
<span id="cb334-57"><a href="fusion_params_test.html#cb334-57" tabindex="-1"></a>      )</span>
<span id="cb334-58"><a href="fusion_params_test.html#cb334-58" tabindex="-1"></a>    , <span class="at">value_lab =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb334-59"><a href="fusion_params_test.html#cb334-59" tabindex="-1"></a>        eval_metric <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;F-score&quot;</span>,<span class="st">&quot;Recall&quot;</span>,<span class="st">&quot;Precision&quot;</span>, <span class="st">&quot;RRMSE&quot;</span>, <span class="st">&quot;MAPE&quot;</span>) <span class="sc">~</span> scales<span class="sc">::</span><span class="fu">percent</span>(value,<span class="at">accuracy=</span><span class="fl">0.1</span>)</span>
<span id="cb334-60"><a href="fusion_params_test.html#cb334-60" tabindex="-1"></a>        , eval_metric <span class="sc">==</span> <span class="st">&quot;ME&quot;</span> <span class="sc">~</span> scales<span class="sc">::</span><span class="fu">comma</span>(value,<span class="at">accuracy=</span><span class="fl">0.01</span>)</span>
<span id="cb334-61"><a href="fusion_params_test.html#cb334-61" tabindex="-1"></a>        , T <span class="sc">~</span> scales<span class="sc">::</span><span class="fu">comma</span>(value,<span class="at">accuracy=</span><span class="fl">0.1</span>)</span>
<span id="cb334-62"><a href="fusion_params_test.html#cb334-62" tabindex="-1"></a>      )</span>
<span id="cb334-63"><a href="fusion_params_test.html#cb334-63" tabindex="-1"></a>    , <span class="at">overall_metric =</span> forcats<span class="sc">::</span><span class="fu">fct_cross</span>(pile_metric,eval_metric)</span>
<span id="cb334-64"><a href="fusion_params_test.html#cb334-64" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb334-65"><a href="fusion_params_test.html#cb334-65" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb334-66"><a href="fusion_params_test.html#cb334-66" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(eval_metric<span class="sc">!=</span><span class="st">&quot;RRMSE&quot;</span>)</span>
<span id="cb334-67"><a href="fusion_params_test.html#cb334-67" tabindex="-1"></a>  <span class="co"># dplyr::count(overall_metric,pile_metric,eval_metric) %&gt;% </span></span>
<span id="cb334-68"><a href="fusion_params_test.html#cb334-68" tabindex="-1"></a>  <span class="co"># dplyr::arrange(pile_metric,eval_metric)</span></span>
<span id="cb334-69"><a href="fusion_params_test.html#cb334-69" tabindex="-1"></a>  <span class="co"># dplyr::arrange(overall_metric)</span></span>
<span id="cb334-70"><a href="fusion_params_test.html#cb334-70" tabindex="-1"></a><span class="co"># aggregate</span></span>
<span id="cb334-71"><a href="fusion_params_test.html#cb334-71" tabindex="-1"></a>xxxdf_temp <span class="ot">&lt;-</span> df_temp <span class="sc">%&gt;%</span> </span>
<span id="cb334-72"><a href="fusion_params_test.html#cb334-72" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(spectral_weight_fact, overall_metric) <span class="sc">%&gt;%</span> </span>
<span id="cb334-73"><a href="fusion_params_test.html#cb334-73" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(<span class="at">value =</span> <span class="fu">median</span>(value,<span class="at">na.rm=</span>T)) <span class="sc">%&gt;%</span> </span>
<span id="cb334-74"><a href="fusion_params_test.html#cb334-74" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb334-75"><a href="fusion_params_test.html#cb334-75" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb334-76"><a href="fusion_params_test.html#cb334-76" tabindex="-1"></a>    <span class="at">value_lab =</span> <span class="fu">paste0</span>(</span>
<span id="cb334-77"><a href="fusion_params_test.html#cb334-77" tabindex="-1"></a>        <span class="st">&quot;median:</span><span class="sc">\n</span><span class="st">&quot;</span></span>
<span id="cb334-78"><a href="fusion_params_test.html#cb334-78" tabindex="-1"></a>      , dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb334-79"><a href="fusion_params_test.html#cb334-79" tabindex="-1"></a>        stringr<span class="sc">::</span><span class="fu">str_detect</span>(</span>
<span id="cb334-80"><a href="fusion_params_test.html#cb334-80" tabindex="-1"></a>          overall_metric</span>
<span id="cb334-81"><a href="fusion_params_test.html#cb334-81" tabindex="-1"></a>          , <span class="st">&quot;(F-score|Recall|Precision|RRMSE|MAPE)&quot;</span></span>
<span id="cb334-82"><a href="fusion_params_test.html#cb334-82" tabindex="-1"></a>        ) <span class="sc">~</span> scales<span class="sc">::</span><span class="fu">percent</span>(value,<span class="at">accuracy=</span><span class="fl">0.1</span>)</span>
<span id="cb334-83"><a href="fusion_params_test.html#cb334-83" tabindex="-1"></a>        <span class="co"># , eval_metric == &quot;ME&quot; ~ scales::comma(value,accuracy=0.01)</span></span>
<span id="cb334-84"><a href="fusion_params_test.html#cb334-84" tabindex="-1"></a>        , T <span class="sc">~</span> scales<span class="sc">::</span><span class="fu">comma</span>(value,<span class="at">accuracy=</span><span class="fl">0.1</span>)</span>
<span id="cb334-85"><a href="fusion_params_test.html#cb334-85" tabindex="-1"></a>      )</span>
<span id="cb334-86"><a href="fusion_params_test.html#cb334-86" tabindex="-1"></a>    )</span>
<span id="cb334-87"><a href="fusion_params_test.html#cb334-87" tabindex="-1"></a>  )</span>
<span id="cb334-88"><a href="fusion_params_test.html#cb334-88" tabindex="-1"></a><span class="co"># xxxdf_temp</span></span>
<span id="cb334-89"><a href="fusion_params_test.html#cb334-89" tabindex="-1"></a></span>
<span id="cb334-90"><a href="fusion_params_test.html#cb334-90" tabindex="-1"></a><span class="co"># plot</span></span>
<span id="cb334-91"><a href="fusion_params_test.html#cb334-91" tabindex="-1"></a>df_temp <span class="sc">%&gt;%</span> </span>
<span id="cb334-92"><a href="fusion_params_test.html#cb334-92" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(</span>
<span id="cb334-93"><a href="fusion_params_test.html#cb334-93" tabindex="-1"></a>      <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(</span>
<span id="cb334-94"><a href="fusion_params_test.html#cb334-94" tabindex="-1"></a>        <span class="at">x =</span> value</span>
<span id="cb334-95"><a href="fusion_params_test.html#cb334-95" tabindex="-1"></a>        , <span class="at">color =</span> spectral_weight_fact, <span class="at">fill =</span> spectral_weight_fact</span>
<span id="cb334-96"><a href="fusion_params_test.html#cb334-96" tabindex="-1"></a>        , <span class="at">group =</span> spectral_weight_fact</span>
<span id="cb334-97"><a href="fusion_params_test.html#cb334-97" tabindex="-1"></a>      )</span>
<span id="cb334-98"><a href="fusion_params_test.html#cb334-98" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb334-99"><a href="fusion_params_test.html#cb334-99" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">geom_density</span>(<span class="at">color =</span> <span class="cn">NA</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb334-100"><a href="fusion_params_test.html#cb334-100" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">geom_rug</span>() <span class="sc">+</span></span>
<span id="cb334-101"><a href="fusion_params_test.html#cb334-101" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">geom_vline</span>(</span>
<span id="cb334-102"><a href="fusion_params_test.html#cb334-102" tabindex="-1"></a>      <span class="at">data =</span> xxxdf_temp</span>
<span id="cb334-103"><a href="fusion_params_test.html#cb334-103" tabindex="-1"></a>      , <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">xintercept =</span> value, <span class="at">color =</span> spectral_weight_fact)</span>
<span id="cb334-104"><a href="fusion_params_test.html#cb334-104" tabindex="-1"></a>      , <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>, <span class="at">lwd =</span> <span class="dv">1</span></span>
<span id="cb334-105"><a href="fusion_params_test.html#cb334-105" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb334-106"><a href="fusion_params_test.html#cb334-106" tabindex="-1"></a>    <span class="co"># ggplot2::geom_text(</span></span>
<span id="cb334-107"><a href="fusion_params_test.html#cb334-107" tabindex="-1"></a>    <span class="co">#   data = xxxdf_temp</span></span>
<span id="cb334-108"><a href="fusion_params_test.html#cb334-108" tabindex="-1"></a>    <span class="co">#   , mapping = ggplot2::aes(</span></span>
<span id="cb334-109"><a href="fusion_params_test.html#cb334-109" tabindex="-1"></a>    <span class="co">#     x = -Inf, y = Inf # always in upper left?</span></span>
<span id="cb334-110"><a href="fusion_params_test.html#cb334-110" tabindex="-1"></a>    <span class="co">#     # x = value, y = 0</span></span>
<span id="cb334-111"><a href="fusion_params_test.html#cb334-111" tabindex="-1"></a>    <span class="co">#     , label = value_lab</span></span>
<span id="cb334-112"><a href="fusion_params_test.html#cb334-112" tabindex="-1"></a>    <span class="co">#   )</span></span>
<span id="cb334-113"><a href="fusion_params_test.html#cb334-113" tabindex="-1"></a>    <span class="co">#   , hjust = -0.1, vjust = 1 # always in upper left?</span></span>
<span id="cb334-114"><a href="fusion_params_test.html#cb334-114" tabindex="-1"></a>    <span class="co">#   # , hjust = -0.1, vjust = -5</span></span>
<span id="cb334-115"><a href="fusion_params_test.html#cb334-115" tabindex="-1"></a>    <span class="co">#   , size = 2.5, color = &quot;black&quot;</span></span>
<span id="cb334-116"><a href="fusion_params_test.html#cb334-116" tabindex="-1"></a>    <span class="co"># ) +</span></span>
<span id="cb334-117"><a href="fusion_params_test.html#cb334-117" tabindex="-1"></a>    harrypotter<span class="sc">::</span><span class="fu">scale_fill_hp_d</span>(<span class="at">option =</span> <span class="st">&quot;hermionegranger&quot;</span>) <span class="sc">+</span></span>
<span id="cb334-118"><a href="fusion_params_test.html#cb334-118" tabindex="-1"></a>    harrypotter<span class="sc">::</span><span class="fu">scale_color_hp_d</span>(<span class="at">option =</span> <span class="st">&quot;hermionegranger&quot;</span>) <span class="sc">+</span></span>
<span id="cb334-119"><a href="fusion_params_test.html#cb334-119" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">facet_wrap</span>(<span class="at">facets =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(overall_metric), <span class="at">ncol =</span> <span class="dv">4</span>, <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>) <span class="sc">+</span></span>
<span id="cb334-120"><a href="fusion_params_test.html#cb334-120" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb334-121"><a href="fusion_params_test.html#cb334-121" tabindex="-1"></a>      <span class="at">x =</span> <span class="st">&quot;&quot;</span>, <span class="at">y =</span> <span class="st">&quot;&quot;</span></span>
<span id="cb334-122"><a href="fusion_params_test.html#cb334-122" tabindex="-1"></a>      , <span class="at">subtitle =</span> <span class="st">&quot;&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;&quot;</span>, <span class="at">color =</span> <span class="st">&quot;&quot;</span></span>
<span id="cb334-123"><a href="fusion_params_test.html#cb334-123" tabindex="-1"></a>      , <span class="at">caption =</span> <span class="st">&quot;*median value represented by dashed line&quot;</span></span>
<span id="cb334-124"><a href="fusion_params_test.html#cb334-124" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb334-125"><a href="fusion_params_test.html#cb334-125" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb334-126"><a href="fusion_params_test.html#cb334-126" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb334-127"><a href="fusion_params_test.html#cb334-127" tabindex="-1"></a>      <span class="at">legend.position =</span> <span class="st">&quot;top&quot;</span></span>
<span id="cb334-128"><a href="fusion_params_test.html#cb334-128" tabindex="-1"></a>      , <span class="at">strip.text =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">9</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb334-129"><a href="fusion_params_test.html#cb334-129" tabindex="-1"></a>      , <span class="at">axis.text.x =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">7</span>)</span>
<span id="cb334-130"><a href="fusion_params_test.html#cb334-130" tabindex="-1"></a>      , <span class="at">axis.text.y =</span> ggplot2<span class="sc">::</span><span class="fu">element_blank</span>()</span>
<span id="cb334-131"><a href="fusion_params_test.html#cb334-131" tabindex="-1"></a>      , <span class="at">plot.subtitle =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>)</span>
<span id="cb334-132"><a href="fusion_params_test.html#cb334-132" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb334-133"><a href="fusion_params_test.html#cb334-133" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">guides</span>(</span>
<span id="cb334-134"><a href="fusion_params_test.html#cb334-134" tabindex="-1"></a>      <span class="at">color =</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb334-135"><a href="fusion_params_test.html#cb334-135" tabindex="-1"></a>    )</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-296-1.png" width="1008" /></p>
<p>for the most part, including the spectral data for slash pile detection does not alter the quantification of slash pile form when using these optimal parameter settings. this is because spectral information is used solely to filter candidate piles, meaning it neither reshapes existing ones nor introduces new detections.</p>
<p>however, including the spectral data does appear to significantly alter slash pile detection accuracy as measured by F-score primarily by increasing the precision of the detection method by using the spectral data to filter out false positive (commission) predictions which would have been kept as predictions when using only the structural data</p>
<p>let’s do some statistical quantification of the impact of including the spectral data</p>
<p>we can use the <code>marginaleffects</code> package to <a href="https://marginaleffects.com/chapters/comparisons.html">compare and contrast</a> the mean estimates by group. this approach calculates the average difference in the predicted outcome (evaluation metric in our case) between the different levels of the factor variable (structural only versus structural+spectral data). this is similar to the Tukey’s Honestly Significant Difference (HSD) test to compare group means to determine if there are significant differences between them.</p>
<div class="sourceCode" id="cb335"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb335-1"><a href="fusion_params_test.html#cb335-1" tabindex="-1"></a><span class="co"># quick mod</span></span>
<span id="cb335-2"><a href="fusion_params_test.html#cb335-2" tabindex="-1"></a>dep_vars_temp <span class="ot">&lt;-</span> <span class="co"># c(&quot;f_score&quot;,&quot;recall&quot;,&quot;precision&quot;)</span></span>
<span id="cb335-3"><a href="fusion_params_test.html#cb335-3" tabindex="-1"></a>  param_combos_gt_meth_comp <span class="sc">%&gt;%</span> </span>
<span id="cb335-4"><a href="fusion_params_test.html#cb335-4" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb335-5"><a href="fusion_params_test.html#cb335-5" tabindex="-1"></a>    <span class="co"># detection</span></span>
<span id="cb335-6"><a href="fusion_params_test.html#cb335-6" tabindex="-1"></a>    f_score, recall, precision</span>
<span id="cb335-7"><a href="fusion_params_test.html#cb335-7" tabindex="-1"></a>    <span class="co"># quantification</span></span>
<span id="cb335-8"><a href="fusion_params_test.html#cb335-8" tabindex="-1"></a>    , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_rmse&quot;</span>)</span>
<span id="cb335-9"><a href="fusion_params_test.html#cb335-9" tabindex="-1"></a>    <span class="co"># , tidyselect::ends_with(&quot;_rrmse&quot;)</span></span>
<span id="cb335-10"><a href="fusion_params_test.html#cb335-10" tabindex="-1"></a>    , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_mean&quot;</span>)</span>
<span id="cb335-11"><a href="fusion_params_test.html#cb335-11" tabindex="-1"></a>    , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_mape&quot;</span>)</span>
<span id="cb335-12"><a href="fusion_params_test.html#cb335-12" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb335-13"><a href="fusion_params_test.html#cb335-13" tabindex="-1"></a>  <span class="fu">names</span>()</span>
<span id="cb335-14"><a href="fusion_params_test.html#cb335-14" tabindex="-1"></a><span class="co"># list of formulas</span></span>
<span id="cb335-15"><a href="fusion_params_test.html#cb335-15" tabindex="-1"></a>formulas_temp <span class="ot">&lt;-</span> dep_vars_temp <span class="sc">%&gt;%</span> </span>
<span id="cb335-16"><a href="fusion_params_test.html#cb335-16" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">map</span>(<span class="sc">~</span>stats<span class="sc">::</span><span class="fu">reformulate</span>(<span class="fu">c</span>(<span class="st">&quot;spectral_weight_fact&quot;</span>,<span class="st">&quot;-1&quot;</span>), <span class="at">response =</span> .x))</span>
<span id="cb335-17"><a href="fusion_params_test.html#cb335-17" tabindex="-1"></a><span class="fu">names</span>(formulas_temp) <span class="ot">&lt;-</span> dep_vars_temp</span>
<span id="cb335-18"><a href="fusion_params_test.html#cb335-18" tabindex="-1"></a><span class="co"># formulas_temp</span></span>
<span id="cb335-19"><a href="fusion_params_test.html#cb335-19" tabindex="-1"></a>models_temp <span class="ot">&lt;-</span> formulas_temp <span class="sc">%&gt;%</span> </span>
<span id="cb335-20"><a href="fusion_params_test.html#cb335-20" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">map</span>(\(x) <span class="fu">lm</span>(<span class="at">formula =</span> x, <span class="at">data =</span> param_combos_gt_meth_comp))</span>
<span id="cb335-21"><a href="fusion_params_test.html#cb335-21" tabindex="-1"></a><span class="fu">names</span>(models_temp) <span class="ot">&lt;-</span> dep_vars_temp</span>
<span id="cb335-22"><a href="fusion_params_test.html#cb335-22" tabindex="-1"></a><span class="co"># models_temp</span></span>
<span id="cb335-23"><a href="fusion_params_test.html#cb335-23" tabindex="-1"></a></span>
<span id="cb335-24"><a href="fusion_params_test.html#cb335-24" tabindex="-1"></a><span class="do">## comparisons</span></span>
<span id="cb335-25"><a href="fusion_params_test.html#cb335-25" tabindex="-1"></a><span class="co"># purrr::map_df(models_temp, broom::tidy, .id = &quot;metric&quot;)</span></span>
<span id="cb335-26"><a href="fusion_params_test.html#cb335-26" tabindex="-1"></a>pred_df_temp <span class="ot">&lt;-</span> models_temp <span class="sc">%&gt;%</span> </span>
<span id="cb335-27"><a href="fusion_params_test.html#cb335-27" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">map_df</span>(</span>
<span id="cb335-28"><a href="fusion_params_test.html#cb335-28" tabindex="-1"></a>    \(x)</span>
<span id="cb335-29"><a href="fusion_params_test.html#cb335-29" tabindex="-1"></a>    marginaleffects<span class="sc">::</span><span class="fu">avg_comparisons</span>(</span>
<span id="cb335-30"><a href="fusion_params_test.html#cb335-30" tabindex="-1"></a>      <span class="at">model =</span> x</span>
<span id="cb335-31"><a href="fusion_params_test.html#cb335-31" tabindex="-1"></a>      , <span class="at">variables =</span> <span class="fu">list</span>(<span class="at">spectral_weight_fact =</span> <span class="st">&quot;pairwise&quot;</span>)</span>
<span id="cb335-32"><a href="fusion_params_test.html#cb335-32" tabindex="-1"></a>        <span class="co"># list(spectral_weight_fact = &quot;revpairwise&quot;)</span></span>
<span id="cb335-33"><a href="fusion_params_test.html#cb335-33" tabindex="-1"></a>      , <span class="at">comparison =</span> <span class="st">&quot;difference&quot;</span></span>
<span id="cb335-34"><a href="fusion_params_test.html#cb335-34" tabindex="-1"></a>    )</span>
<span id="cb335-35"><a href="fusion_params_test.html#cb335-35" tabindex="-1"></a>    , <span class="at">.id =</span> <span class="st">&quot;metric&quot;</span></span>
<span id="cb335-36"><a href="fusion_params_test.html#cb335-36" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb335-37"><a href="fusion_params_test.html#cb335-37" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb335-38"><a href="fusion_params_test.html#cb335-38" tabindex="-1"></a>    <span class="at">contrast =</span> contrast <span class="sc">%&gt;%</span></span>
<span id="cb335-39"><a href="fusion_params_test.html#cb335-39" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_remove_all</span>(<span class="st">&quot;mean</span><span class="sc">\\</span><span class="st">(&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb335-40"><a href="fusion_params_test.html#cb335-40" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_remove_all</span>(<span class="st">&quot;</span><span class="sc">\\</span><span class="st">)&quot;</span>) </span>
<span id="cb335-41"><a href="fusion_params_test.html#cb335-41" tabindex="-1"></a>    , <span class="at">sig_lvl =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb335-42"><a href="fusion_params_test.html#cb335-42" tabindex="-1"></a>        p.value <span class="sc">&lt;=</span> <span class="fl">0.01</span> <span class="sc">~</span> <span class="st">&quot;0.01&quot;</span></span>
<span id="cb335-43"><a href="fusion_params_test.html#cb335-43" tabindex="-1"></a>        , p.value <span class="sc">&lt;=</span> <span class="fl">0.05</span> <span class="sc">~</span> <span class="st">&quot;0.05&quot;</span></span>
<span id="cb335-44"><a href="fusion_params_test.html#cb335-44" tabindex="-1"></a>        , p.value <span class="sc">&lt;=</span> <span class="fl">0.1</span> <span class="sc">~</span> <span class="st">&quot;0.10&quot;</span></span>
<span id="cb335-45"><a href="fusion_params_test.html#cb335-45" tabindex="-1"></a>        , T <span class="sc">~</span> <span class="st">&quot;not significant&quot;</span></span>
<span id="cb335-46"><a href="fusion_params_test.html#cb335-46" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span> </span>
<span id="cb335-47"><a href="fusion_params_test.html#cb335-47" tabindex="-1"></a>      <span class="fu">factor</span>(</span>
<span id="cb335-48"><a href="fusion_params_test.html#cb335-48" tabindex="-1"></a>        <span class="at">ordered =</span> T</span>
<span id="cb335-49"><a href="fusion_params_test.html#cb335-49" tabindex="-1"></a>        , <span class="at">levels =</span> <span class="fu">c</span>(</span>
<span id="cb335-50"><a href="fusion_params_test.html#cb335-50" tabindex="-1"></a>          <span class="st">&quot;0.01&quot;</span></span>
<span id="cb335-51"><a href="fusion_params_test.html#cb335-51" tabindex="-1"></a>          , <span class="st">&quot;0.05&quot;</span></span>
<span id="cb335-52"><a href="fusion_params_test.html#cb335-52" tabindex="-1"></a>          , <span class="st">&quot;0.10&quot;</span></span>
<span id="cb335-53"><a href="fusion_params_test.html#cb335-53" tabindex="-1"></a>          , <span class="st">&quot;not significant&quot;</span></span>
<span id="cb335-54"><a href="fusion_params_test.html#cb335-54" tabindex="-1"></a>        )</span>
<span id="cb335-55"><a href="fusion_params_test.html#cb335-55" tabindex="-1"></a>      ) </span>
<span id="cb335-56"><a href="fusion_params_test.html#cb335-56" tabindex="-1"></a>    <span class="co"># pretty metric</span></span>
<span id="cb335-57"><a href="fusion_params_test.html#cb335-57" tabindex="-1"></a>    , <span class="at">eval_metric =</span> stringr<span class="sc">::</span><span class="fu">str_extract</span>(metric, <span class="st">&quot;(_rmse|_rrmse|_mean|_mape)$&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb335-58"><a href="fusion_params_test.html#cb335-58" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_remove_all</span>(<span class="st">&quot;_&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb335-59"><a href="fusion_params_test.html#cb335-59" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_replace_all</span>(<span class="st">&quot;mean&quot;</span>,<span class="st">&quot;me&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb335-60"><a href="fusion_params_test.html#cb335-60" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">coalesce</span>(<span class="st">&quot;detection&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb335-61"><a href="fusion_params_test.html#cb335-61" tabindex="-1"></a>      <span class="fu">toupper</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb335-62"><a href="fusion_params_test.html#cb335-62" tabindex="-1"></a>      <span class="fu">factor</span>(</span>
<span id="cb335-63"><a href="fusion_params_test.html#cb335-63" tabindex="-1"></a>        <span class="at">ordered =</span> T</span>
<span id="cb335-64"><a href="fusion_params_test.html#cb335-64" tabindex="-1"></a>        , <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;DETECTION&quot;</span>, <span class="st">&quot;ME&quot;</span>,<span class="st">&quot;RMSE&quot;</span>,<span class="st">&quot;RRMSE&quot;</span>,<span class="st">&quot;MAPE&quot;</span>)</span>
<span id="cb335-65"><a href="fusion_params_test.html#cb335-65" tabindex="-1"></a>        , <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;Detection&quot;</span>, <span class="st">&quot;ME&quot;</span>,<span class="st">&quot;RMSE&quot;</span>,<span class="st">&quot;RRMSE&quot;</span>,<span class="st">&quot;MAPE&quot;</span>)</span>
<span id="cb335-66"><a href="fusion_params_test.html#cb335-66" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span> forcats<span class="sc">::</span><span class="fu">fct_rev</span>()</span>
<span id="cb335-67"><a href="fusion_params_test.html#cb335-67" tabindex="-1"></a>    , <span class="at">pile_metric =</span> metric <span class="sc">%&gt;%</span> </span>
<span id="cb335-68"><a href="fusion_params_test.html#cb335-68" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_remove</span>(<span class="st">&quot;(_rmse|_rrmse|_mean|_mape)$&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb335-69"><a href="fusion_params_test.html#cb335-69" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_extract</span>(<span class="st">&quot;(paraboloid_volume|volume|area|height|diameter|f_score|recall|precision)&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb335-70"><a href="fusion_params_test.html#cb335-70" tabindex="-1"></a>      <span class="fu">factor</span>(</span>
<span id="cb335-71"><a href="fusion_params_test.html#cb335-71" tabindex="-1"></a>        <span class="at">ordered =</span> T</span>
<span id="cb335-72"><a href="fusion_params_test.html#cb335-72" tabindex="-1"></a>        , <span class="at">levels =</span> <span class="fu">c</span>(</span>
<span id="cb335-73"><a href="fusion_params_test.html#cb335-73" tabindex="-1"></a>          <span class="st">&quot;f_score&quot;</span>,<span class="st">&quot;recall&quot;</span>,<span class="st">&quot;precision&quot;</span></span>
<span id="cb335-74"><a href="fusion_params_test.html#cb335-74" tabindex="-1"></a>          , <span class="st">&quot;volume&quot;</span></span>
<span id="cb335-75"><a href="fusion_params_test.html#cb335-75" tabindex="-1"></a>          , <span class="st">&quot;paraboloid_volume&quot;</span></span>
<span id="cb335-76"><a href="fusion_params_test.html#cb335-76" tabindex="-1"></a>          , <span class="st">&quot;area&quot;</span></span>
<span id="cb335-77"><a href="fusion_params_test.html#cb335-77" tabindex="-1"></a>          , <span class="st">&quot;height&quot;</span></span>
<span id="cb335-78"><a href="fusion_params_test.html#cb335-78" tabindex="-1"></a>          , <span class="st">&quot;diameter&quot;</span></span>
<span id="cb335-79"><a href="fusion_params_test.html#cb335-79" tabindex="-1"></a>        )</span>
<span id="cb335-80"><a href="fusion_params_test.html#cb335-80" tabindex="-1"></a>        , <span class="at">labels =</span> <span class="fu">c</span>(</span>
<span id="cb335-81"><a href="fusion_params_test.html#cb335-81" tabindex="-1"></a>          <span class="st">&quot;F-score&quot;</span>,<span class="st">&quot;Recall&quot;</span>,<span class="st">&quot;Precision&quot;</span></span>
<span id="cb335-82"><a href="fusion_params_test.html#cb335-82" tabindex="-1"></a>          , <span class="st">&quot;Volume&quot;</span></span>
<span id="cb335-83"><a href="fusion_params_test.html#cb335-83" tabindex="-1"></a>          , <span class="st">&quot;Volume paraboloid&quot;</span></span>
<span id="cb335-84"><a href="fusion_params_test.html#cb335-84" tabindex="-1"></a>          , <span class="st">&quot;Area&quot;</span></span>
<span id="cb335-85"><a href="fusion_params_test.html#cb335-85" tabindex="-1"></a>          , <span class="st">&quot;Height&quot;</span></span>
<span id="cb335-86"><a href="fusion_params_test.html#cb335-86" tabindex="-1"></a>          , <span class="st">&quot;Diameter&quot;</span></span>
<span id="cb335-87"><a href="fusion_params_test.html#cb335-87" tabindex="-1"></a>        )</span>
<span id="cb335-88"><a href="fusion_params_test.html#cb335-88" tabindex="-1"></a>      )</span>
<span id="cb335-89"><a href="fusion_params_test.html#cb335-89" tabindex="-1"></a>    , <span class="at">value_lab =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb335-90"><a href="fusion_params_test.html#cb335-90" tabindex="-1"></a>        eval_metric <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;Detection&quot;</span>, <span class="st">&quot;F-score&quot;</span>,<span class="st">&quot;Recall&quot;</span>,<span class="st">&quot;Precision&quot;</span>, <span class="st">&quot;RRMSE&quot;</span>, <span class="st">&quot;MAPE&quot;</span>) <span class="sc">~</span> scales<span class="sc">::</span><span class="fu">percent</span>(estimate,<span class="at">accuracy=</span><span class="fl">0.1</span>)</span>
<span id="cb335-91"><a href="fusion_params_test.html#cb335-91" tabindex="-1"></a>        , eval_metric <span class="sc">==</span> <span class="st">&quot;ME&quot;</span> <span class="sc">~</span> scales<span class="sc">::</span><span class="fu">comma</span>(estimate,<span class="at">accuracy=</span><span class="fl">0.01</span>)</span>
<span id="cb335-92"><a href="fusion_params_test.html#cb335-92" tabindex="-1"></a>        , T <span class="sc">~</span> scales<span class="sc">::</span><span class="fu">comma</span>(estimate,<span class="at">accuracy=</span><span class="fl">0.1</span>)</span>
<span id="cb335-93"><a href="fusion_params_test.html#cb335-93" tabindex="-1"></a>      )</span>
<span id="cb335-94"><a href="fusion_params_test.html#cb335-94" tabindex="-1"></a>  )</span>
<span id="cb335-95"><a href="fusion_params_test.html#cb335-95" tabindex="-1"></a><span class="co"># pred_df_temp %&gt;% dplyr::glimpse()</span></span>
<span id="cb335-96"><a href="fusion_params_test.html#cb335-96" tabindex="-1"></a><span class="co"># plot</span></span>
<span id="cb335-97"><a href="fusion_params_test.html#cb335-97" tabindex="-1"></a>pred_df_temp <span class="sc">%&gt;%</span></span>
<span id="cb335-98"><a href="fusion_params_test.html#cb335-98" tabindex="-1"></a>  <span class="co"># plot</span></span>
<span id="cb335-99"><a href="fusion_params_test.html#cb335-99" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> estimate, <span class="at">y =</span> pile_metric, <span class="at">color =</span> sig_lvl)) <span class="sc">+</span></span>
<span id="cb335-100"><a href="fusion_params_test.html#cb335-100" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>, <span class="at">color =</span> <span class="st">&quot;gray44&quot;</span>) <span class="sc">+</span></span>
<span id="cb335-101"><a href="fusion_params_test.html#cb335-101" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">geom_linerange</span>(</span>
<span id="cb335-102"><a href="fusion_params_test.html#cb335-102" tabindex="-1"></a>      <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">xmin =</span> conf.low, <span class="at">xmax =</span> conf.high)</span>
<span id="cb335-103"><a href="fusion_params_test.html#cb335-103" tabindex="-1"></a>      , <span class="at">linewidth =</span> <span class="dv">2</span></span>
<span id="cb335-104"><a href="fusion_params_test.html#cb335-104" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb335-105"><a href="fusion_params_test.html#cb335-105" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb335-106"><a href="fusion_params_test.html#cb335-106" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">geom_text</span>(<span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">label =</span> value_lab), <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">vjust =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb335-107"><a href="fusion_params_test.html#cb335-107" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">annotate</span>(</span>
<span id="cb335-108"><a href="fusion_params_test.html#cb335-108" tabindex="-1"></a>      <span class="st">&quot;text&quot;</span>, <span class="at">x =</span> <span class="sc">-</span><span class="cn">Inf</span>, <span class="at">y =</span> <span class="cn">Inf</span></span>
<span id="cb335-109"><a href="fusion_params_test.html#cb335-109" tabindex="-1"></a>      , <span class="at">label =</span> stringr<span class="sc">::</span><span class="fu">str_replace_all</span>(pred_df_temp<span class="sc">$</span>contrast[<span class="dv">1</span>],<span class="st">&quot; - &quot;</span>,<span class="st">&quot; &lt; &quot;</span>) <span class="co"># &quot;Top Left Text&quot;</span></span>
<span id="cb335-110"><a href="fusion_params_test.html#cb335-110" tabindex="-1"></a>      , <span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">vjust =</span> <span class="dv">1</span></span>
<span id="cb335-111"><a href="fusion_params_test.html#cb335-111" tabindex="-1"></a>      , <span class="at">size =</span> <span class="fl">2.5</span></span>
<span id="cb335-112"><a href="fusion_params_test.html#cb335-112" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb335-113"><a href="fusion_params_test.html#cb335-113" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">annotate</span>(</span>
<span id="cb335-114"><a href="fusion_params_test.html#cb335-114" tabindex="-1"></a>      <span class="st">&quot;text&quot;</span>, <span class="at">x =</span> <span class="cn">Inf</span>, <span class="at">y =</span> <span class="cn">Inf</span></span>
<span id="cb335-115"><a href="fusion_params_test.html#cb335-115" tabindex="-1"></a>      , <span class="at">label =</span> stringr<span class="sc">::</span><span class="fu">str_replace_all</span>(pred_df_temp<span class="sc">$</span>contrast[<span class="dv">1</span>],<span class="st">&quot; - &quot;</span>,<span class="st">&quot; &gt; &quot;</span>) <span class="co"># &quot;Top Right Text&quot;</span></span>
<span id="cb335-116"><a href="fusion_params_test.html#cb335-116" tabindex="-1"></a>      , <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">vjust =</span> <span class="dv">1</span></span>
<span id="cb335-117"><a href="fusion_params_test.html#cb335-117" tabindex="-1"></a>      , <span class="at">size =</span> <span class="fl">2.5</span></span>
<span id="cb335-118"><a href="fusion_params_test.html#cb335-118" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb335-119"><a href="fusion_params_test.html#cb335-119" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">scale_color_viridis_d</span>(<span class="at">option =</span> <span class="st">&quot;mako&quot;</span>, <span class="at">begin =</span> <span class="fl">0.2</span>, <span class="at">end =</span> <span class="fl">0.8</span>, <span class="at">drop =</span> F) <span class="sc">+</span></span>
<span id="cb335-120"><a href="fusion_params_test.html#cb335-120" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">facet_wrap</span>(<span class="at">facets =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(eval_metric), <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>) <span class="sc">+</span></span>
<span id="cb335-121"><a href="fusion_params_test.html#cb335-121" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">scale_x_continuous</span>(<span class="at">labels =</span> <span class="dv">0</span>, <span class="at">breaks =</span> <span class="dv">0</span>, <span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.8</span>, <span class="fl">0.7</span>))) <span class="sc">+</span></span>
<span id="cb335-122"><a href="fusion_params_test.html#cb335-122" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb335-123"><a href="fusion_params_test.html#cb335-123" tabindex="-1"></a>      <span class="at">y =</span> <span class="st">&quot;&quot;</span></span>
<span id="cb335-124"><a href="fusion_params_test.html#cb335-124" tabindex="-1"></a>      , <span class="at">x =</span> <span class="fu">paste0</span>(<span class="st">&quot;Difference: &quot;</span>, pred_df_temp<span class="sc">$</span>contrast[<span class="dv">1</span>])</span>
<span id="cb335-125"><a href="fusion_params_test.html#cb335-125" tabindex="-1"></a>      , <span class="at">subtitle =</span> <span class="st">&quot;Mean group constrasts&quot;</span></span>
<span id="cb335-126"><a href="fusion_params_test.html#cb335-126" tabindex="-1"></a>      , <span class="at">color =</span> <span class="st">&quot;sig. level&quot;</span></span>
<span id="cb335-127"><a href="fusion_params_test.html#cb335-127" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb335-128"><a href="fusion_params_test.html#cb335-128" tabindex="-1"></a>    <span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb335-129"><a href="fusion_params_test.html#cb335-129" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb335-130"><a href="fusion_params_test.html#cb335-130" tabindex="-1"></a>      <span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span></span>
<span id="cb335-131"><a href="fusion_params_test.html#cb335-131" tabindex="-1"></a>      , <span class="at">strip.text =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb335-132"><a href="fusion_params_test.html#cb335-132" tabindex="-1"></a>      , <span class="at">axis.text.y =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb335-133"><a href="fusion_params_test.html#cb335-133" tabindex="-1"></a>      , <span class="at">axis.text.x =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>)</span>
<span id="cb335-134"><a href="fusion_params_test.html#cb335-134" tabindex="-1"></a>      <span class="co"># , axis.ticks.x = ggplot2::element_blank()</span></span>
<span id="cb335-135"><a href="fusion_params_test.html#cb335-135" tabindex="-1"></a>      , <span class="at">panel.grid.major.x =</span> ggplot2<span class="sc">::</span><span class="fu">element_blank</span>()</span>
<span id="cb335-136"><a href="fusion_params_test.html#cb335-136" tabindex="-1"></a>      , <span class="at">panel.grid.minor.x =</span> ggplot2<span class="sc">::</span><span class="fu">element_blank</span>()</span>
<span id="cb335-137"><a href="fusion_params_test.html#cb335-137" tabindex="-1"></a>      , <span class="at">plot.subtitle =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>)</span>
<span id="cb335-138"><a href="fusion_params_test.html#cb335-138" tabindex="-1"></a>    )</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-298-1.png" width="1008" /></p>
<p>and view the contrasts in a table</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="data_fusion.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="chm-raster-resolution-testing.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
  "sharing": {
    "github": false,
    "facebook": true,
    "twitter": true,
    "linkedin": false,
    "weibo": false,
    "instapaper": false,
    "vk": false,
    "whatsapp": false,
    "all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
  },
  "fontsettings": {
    "theme": "white",
    "family": "sans",
    "size": 2
  },
  "edit": {
    "link": null,
    "text": null
  },
  "history": {
    "link": null,
    "text": null
  },
  "view": {
    "link": null,
    "text": null
  },
  "download": null,
  "search": {
    "engine": "fuse",
    "options": null
  },
  "toc": {
    "collapse": "subsection"
  }
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
