<!DOCTYPE html>
<html lang="en-US" xml:lang="en-US">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Section 8 Sensitivity Testing Results | Aerial Imagery and Point Cloud Data for Slash Pile Quantification</title>
  <meta name="description" content="Using the bookdown package to write a book of data exploration. The output format for this example is bookdown::gitbook." />
  <meta name="generator" content="bookdown 0.34 and GitBook 2.6.7" />

  <meta property="og:title" content="Section 8 Sensitivity Testing Results | Aerial Imagery and Point Cloud Data for Slash Pile Quantification" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="Using the bookdown package to write a book of data exploration. The output format for this example is bookdown::gitbook." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Section 8 Sensitivity Testing Results | Aerial Imagery and Point Cloud Data for Slash Pile Quantification" />
  
  <meta name="twitter:description" content="Using the bookdown package to write a book of data exploration. The output format for this example is bookdown::gitbook." />
  

<meta name="author" content="George Woolsey" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="wshed_params_test.html"/>
<link rel="next" href="stats_method.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<link href="libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet" />
<script src="libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/proj4-2.6.2/proj4.min.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.2.2/leaflet.js"></script>
<script src="libs/leaflet-providers-2.0.0/leaflet-providers_2.0.0.js"></script>
<script src="libs/leaflet-providers-plugin-2.2.2/leaflet-providers-plugin.js"></script>
<script src="libs/clipboard-0.0.1/setClipboardText.js"></script>
<link href="libs/mapviewCSS-0.0.1/mapview-popup.css" rel="stylesheet" />
<link href="libs/mapviewCSS-0.0.1/mapview.css" rel="stylesheet" />
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<link href="libs/bsTable-3.3.7/bootstrapTable.min.css" rel="stylesheet" />
<script src="libs/bsTable-3.3.7/bootstrapTable.js"></script>
<script src="libs/. - 1_d2f159-1/data_stars_1b1597e.txt"></script>
<script src="libs/joda-0.0.1/joda.js"></script>
<script src="libs/joda-0.0.1/addImageQuery-bindings.js"></script>
<script src="libs/HomeButton-0.0.1/home-button.js"></script>
<script src="libs/HomeButton-0.0.1/easy-button-src.min.js"></script>
<link href="libs/study sites-CSS-0.0.1/study sites_home-button.css" rel="stylesheet" />
<script type="text/javascript">

// toggle visibility of R source blocks in R Markdown output
function toggle_R() {
  var x = document.getElementsByClassName('r');
  if (x.length == 0) return;
  function toggle_vis(o) {
    var d = o.style.display;
    o.style.display = (d == 'block' || d == '') ? 'none':'block';
  }

  for (i = 0; i < x.length; i++) {
    var y = x[i];
    if (y.tagName.toLowerCase() === 'pre') toggle_vis(y);
  }

    var elem = document.getElementById("myButton1");
    if (elem.value === "Hide Code") elem.value = "Show Code";
    else elem.value = "Hide Code";
}

document.write('<input onclick="toggle_R();" type="button" value="Hide Code" id="myButton1" style="position: absolute; top: 10%; right: 2%; z-index: 200"></input>')

</script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#objective"><i class="fa fa-check"></i><b>1.1</b> Objective</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#data_desc"><i class="fa fa-check"></i><b>1.2</b> Data</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#analysis-plan"><i class="fa fa-check"></i><b>1.3</b> Analysis Plan</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="training-data.html"><a href="training-data.html"><i class="fa fa-check"></i><b>2</b> Training Data</a>
<ul>
<li class="chapter" data-level="2.1" data-path="training-data.html"><a href="training-data.html#site-introduction"><i class="fa fa-check"></i><b>2.1</b> Site Introduction</a></li>
<li class="chapter" data-level="2.2" data-path="training-data.html"><a href="training-data.html#slash-pile-vector-data"><i class="fa fa-check"></i><b>2.2</b> Slash Pile Vector Data</a></li>
<li class="chapter" data-level="2.3" data-path="training-data.html"><a href="training-data.html#rgb-orthomosaic"><i class="fa fa-check"></i><b>2.3</b> RGB orthomosaic</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="training-data.html"><a href="training-data.html#example-ratio-based-index"><i class="fa fa-check"></i><b>2.3.1</b> Example ratio-based index</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="training-data.html"><a href="training-data.html#study-area-imagery"><i class="fa fa-check"></i><b>2.4</b> Study area imagery</a></li>
<li class="chapter" data-level="2.5" data-path="training-data.html"><a href="training-data.html#point-cloud-data"><i class="fa fa-check"></i><b>2.5</b> Point Cloud Data</a></li>
<li class="chapter" data-level="2.6" data-path="training-data.html"><a href="training-data.html#check-out-one-pile"><i class="fa fa-check"></i><b>2.6</b> Check out one pile</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="method-evaluation.html"><a href="method-evaluation.html"><i class="fa fa-check"></i><b>3</b> Method Evaluation</a>
<ul>
<li class="chapter" data-level="3.1" data-path="method-evaluation.html"><a href="method-evaluation.html#iou_match"><i class="fa fa-check"></i><b>3.1</b> Instance Matching</a></li>
<li class="chapter" data-level="3.2" data-path="method-evaluation.html"><a href="method-evaluation.html#detect_metrics_form"><i class="fa fa-check"></i><b>3.2</b> Detection Accuracy Metrics</a></li>
<li class="chapter" data-level="3.3" data-path="method-evaluation.html"><a href="method-evaluation.html#quant_metrics_form"><i class="fa fa-check"></i><b>3.3</b> Quantification Accuracy Metrics</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="ptcld_process.html"><a href="ptcld_process.html"><i class="fa fa-check"></i><b>4</b> Point Cloud Processing and Pile Segmentation</a>
<ul>
<li class="chapter" data-level="4.1" data-path="ptcld_process.html"><a href="ptcld_process.html#process-raw-point-cloud"><i class="fa fa-check"></i><b>4.1</b> Process Raw Point Cloud</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="ptcld_process.html"><a href="ptcld_process.html#dtm-and-chm-piles"><i class="fa fa-check"></i><b>4.1.1</b> DTM and CHM + piles</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="raster_watershed.html"><a href="raster_watershed.html"><i class="fa fa-check"></i><b>5</b> Structural Detection from CHM</a>
<ul>
<li class="chapter" data-level="5.1" data-path="raster_watershed.html"><a href="raster_watershed.html#method-demonstration"><i class="fa fa-check"></i><b>5.1</b> Method Demonstration</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="raster_watershed.html"><a href="raster_watershed.html#geometric-filtering-irregularity-filtering"><i class="fa fa-check"></i><b>5.1.1</b> Geometric filtering: Irregularity Filtering</a></li>
<li class="chapter" data-level="5.1.2" data-path="raster_watershed.html"><a href="raster_watershed.html#area-filtering"><i class="fa fa-check"></i><b>5.1.2</b> Area Filtering</a></li>
<li class="chapter" data-level="5.1.3" data-path="raster_watershed.html"><a href="raster_watershed.html#geometric-filtering-circularity-filtering"><i class="fa fa-check"></i><b>5.1.3</b> Geometric filtering: Circularity Filtering</a></li>
<li class="chapter" data-level="5.1.4" data-path="raster_watershed.html"><a href="raster_watershed.html#area-and-volume-from-chm"><i class="fa fa-check"></i><b>5.1.4</b> Area and Volume from CHM</a></li>
<li class="chapter" data-level="5.1.5" data-path="raster_watershed.html"><a href="raster_watershed.html#shape-refinement"><i class="fa fa-check"></i><b>5.1.5</b> Shape Refinement</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="raster_watershed.html"><a href="raster_watershed.html#instance-matching"><i class="fa fa-check"></i><b>5.2</b> Instance Matching</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="raster_watershed.html"><a href="raster_watershed.html#example-area"><i class="fa fa-check"></i><b>5.2.1</b> Example Area</a></li>
<li class="chapter" data-level="5.2.2" data-path="raster_watershed.html"><a href="raster_watershed.html#full-study-area"><i class="fa fa-check"></i><b>5.2.2</b> Full Study Area</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="raster_watershed.html"><a href="raster_watershed.html#slash_pile_detect_watershed"><i class="fa fa-check"></i><b>5.3</b> Watershed Pile Detection Function</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="data_fusion.html"><a href="data_fusion.html"><i class="fa fa-check"></i><b>6</b> Data Fusion</a>
<ul>
<li class="chapter" data-level="6.1" data-path="data_fusion.html"><a href="data_fusion.html#rgb-indices"><i class="fa fa-check"></i><b>6.1</b> RGB Indices</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="data_fusion.html"><a href="data_fusion.html#spectral-index-functions"><i class="fa fa-check"></i><b>6.1.1</b> Spectral Index Functions</a></li>
<li class="chapter" data-level="6.1.2" data-path="data_fusion.html"><a href="data_fusion.html#spectral-index-of-polygons"><i class="fa fa-check"></i><b>6.1.2</b> Spectral Index of Polygons</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="data_fusion.html"><a href="data_fusion.html#ground-truth-pile-spectral-summary"><i class="fa fa-check"></i><b>6.2</b> Ground Truth Pile Spectral Summary</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="data_fusion.html"><a href="data_fusion.html#voting-system"><i class="fa fa-check"></i><b>6.2.1</b> Voting System</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="data_fusion.html"><a href="data_fusion.html#polygon_spectral_filtering"><i class="fa fa-check"></i><b>6.3</b> Candidate Polygon Spectral Filtering Function</a></li>
<li class="chapter" data-level="6.4" data-path="data_fusion.html"><a href="data_fusion.html#data-fusion-example"><i class="fa fa-check"></i><b>6.4</b> Data Fusion Example</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="data_fusion.html"><a href="data_fusion.html#instance-matching-1"><i class="fa fa-check"></i><b>6.4.1</b> Instance Matching</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="wshed_params_test.html"><a href="wshed_params_test.html"><i class="fa fa-check"></i><b>7</b> Sensitivity Testing Method</a>
<ul>
<li class="chapter" data-level="7.1" data-path="wshed_params_test.html"><a href="wshed_params_test.html#all_the_combos"><i class="fa fa-check"></i><b>7.1</b> Workflow over parameter combinations</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="wshed_params_test.html"><a href="wshed_params_test.html#test-workflow"><i class="fa fa-check"></i><b>7.1.1</b> Test Workflow</a></li>
<li class="chapter" data-level="7.1.2" data-path="wshed_params_test.html"><a href="wshed_params_test.html#test-instance-matching"><i class="fa fa-check"></i><b>7.1.2</b> Test Instance Matching</a></li>
<li class="chapter" data-level="7.1.3" data-path="wshed_params_test.html"><a href="wshed_params_test.html#test-accuracy"><i class="fa fa-check"></i><b>7.1.3</b> Test Accuracy</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="chm_sens_test.html"><a href="chm_sens_test.html"><i class="fa fa-check"></i><b>8</b> Sensitivity Testing Results</a>
<ul>
<li class="chapter" data-level="8.1" data-path="chm_sens_test.html"><a href="chm_sens_test.html#process-raw-point-cloud-1"><i class="fa fa-check"></i><b>8.1</b> Process Raw Point Cloud</a></li>
<li class="chapter" data-level="8.2" data-path="chm_sens_test.html"><a href="chm_sens_test.html#structural-only-parameter-testing"><i class="fa fa-check"></i><b>8.2</b> Structural Only: Parameter Testing</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="chm_sens_test.html"><a href="chm_sens_test.html#validation-over-parameter-combinations"><i class="fa fa-check"></i><b>8.2.1</b> Validation over parameter combinations</a></li>
<li class="chapter" data-level="8.2.2" data-path="chm_sens_test.html"><a href="chm_sens_test.html#aggregate-validation-metrics-to-parameter-combination"><i class="fa fa-check"></i><b>8.2.2</b> Aggregate Validation Metrics to Parameter Combination</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="chm_sens_test.html"><a href="chm_sens_test.html#data-fusion-parameter-testing"><i class="fa fa-check"></i><b>8.3</b> Data Fusion: Parameter Testing</a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="chm_sens_test.html"><a href="chm_sens_test.html#aggregate-validation-metrics-to-parameter-combination-1"><i class="fa fa-check"></i><b>8.3.1</b> Aggregate Validation Metrics to Parameter Combination</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="chm_sens_test.html"><a href="chm_sens_test.html#read-data-for-analysis"><i class="fa fa-check"></i><b>8.4</b> Read Data for Analysis</a>
<ul>
<li class="chapter" data-level="8.4.1" data-path="chm_sens_test.html"><a href="chm_sens_test.html#structural-only"><i class="fa fa-check"></i><b>8.4.1</b> Structural Only</a></li>
<li class="chapter" data-level="8.4.2" data-path="chm_sens_test.html"><a href="chm_sens_test.html#data-fusion"><i class="fa fa-check"></i><b>8.4.2</b> Data Fusion</a></li>
</ul></li>
<li class="chapter" data-level="8.5" data-path="chm_sens_test.html"><a href="chm_sens_test.html#allthetests"><i class="fa fa-check"></i><b>8.5</b> Structural Only: Sensitivity Testing</a>
<ul>
<li class="chapter" data-level="8.5.1" data-path="chm_sens_test.html"><a href="chm_sens_test.html#detect_trends"><i class="fa fa-check"></i><b>8.5.1</b> Main Effects: pile detection</a></li>
<li class="chapter" data-level="8.5.2" data-path="chm_sens_test.html"><a href="chm_sens_test.html#quant_trends"><i class="fa fa-check"></i><b>8.5.2</b> Main Effects: form quantification</a></li>
<li class="chapter" data-level="8.5.3" data-path="chm_sens_test.html"><a href="chm_sens_test.html#best-settings"><i class="fa fa-check"></i><b>8.5.3</b> Best settings</a></li>
</ul></li>
<li class="chapter" data-level="8.6" data-path="chm_sens_test.html"><a href="chm_sens_test.html#data-fusion-sensitivity-testing"><i class="fa fa-check"></i><b>8.6</b> Data Fusion: Sensitivity Testing</a>
<ul>
<li class="chapter" data-level="8.6.1" data-path="chm_sens_test.html"><a href="chm_sens_test.html#main-effects-pile-detection"><i class="fa fa-check"></i><b>8.6.1</b> Main Effects: pile detection</a></li>
<li class="chapter" data-level="8.6.2" data-path="chm_sens_test.html"><a href="chm_sens_test.html#main-effects-form-quantification"><i class="fa fa-check"></i><b>8.6.2</b> Main Effects: form quantification</a></li>
<li class="chapter" data-level="8.6.3" data-path="chm_sens_test.html"><a href="chm_sens_test.html#balanced_acc_assess"><i class="fa fa-check"></i><b>8.6.3</b> Top settings</a></li>
</ul></li>
<li class="chapter" data-level="8.7" data-path="chm_sens_test.html"><a href="chm_sens_test.html#save-the-data"><i class="fa fa-check"></i><b>8.7</b> save the data</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="stats_method.html"><a href="stats_method.html"><i class="fa fa-check"></i><b>9</b> Statistical Testing of Method Settings</a>
<ul>
<li class="chapter" data-level="9.1" data-path="stats_method.html"><a href="stats_method.html#bayesian-glm---f-score"><i class="fa fa-check"></i><b>9.1</b> Bayesian GLM - F-score</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="stats_method.html"><a href="stats_method.html#model-selection"><i class="fa fa-check"></i><b>9.1.1</b> Model selection</a></li>
<li class="chapter" data-level="9.1.2" data-path="stats_method.html"><a href="stats_method.html#modeling"><i class="fa fa-check"></i><b>9.1.2</b> Modeling</a></li>
<li class="chapter" data-level="9.1.3" data-path="stats_method.html"><a href="stats_method.html#posterior-predictive-checks"><i class="fa fa-check"></i><b>9.1.3</b> Posterior Predictive Checks</a></li>
<li class="chapter" data-level="9.1.4" data-path="stats_method.html"><a href="stats_method.html#conditional-effects"><i class="fa fa-check"></i><b>9.1.4</b> Conditional Effects</a></li>
<li class="chapter" data-level="9.1.5" data-path="stats_method.html"><a href="stats_method.html#f_score_epred"><i class="fa fa-check"></i><b>9.1.5</b> Posterior Predictive Expectation</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="stats_method.html"><a href="stats_method.html#mod_diam_mape"><i class="fa fa-check"></i><b>9.2</b> Bayesian GLM - Diameter MAPE</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="stats_method.html"><a href="stats_method.html#model-selection-1"><i class="fa fa-check"></i><b>9.2.1</b> Model selection</a></li>
<li class="chapter" data-level="9.2.2" data-path="stats_method.html"><a href="stats_method.html#mod_diam_mape2"><i class="fa fa-check"></i><b>9.2.2</b> Modeling</a></li>
<li class="chapter" data-level="9.2.3" data-path="stats_method.html"><a href="stats_method.html#posterior-predictive-checks-1"><i class="fa fa-check"></i><b>9.2.3</b> Posterior Predictive Checks</a></li>
<li class="chapter" data-level="9.2.4" data-path="stats_method.html"><a href="stats_method.html#conditional-effects-1"><i class="fa fa-check"></i><b>9.2.4</b> Conditional Effects</a></li>
<li class="chapter" data-level="9.2.5" data-path="stats_method.html"><a href="stats_method.html#posterior-predictive-expectation"><i class="fa fa-check"></i><b>9.2.5</b> Posterior Predictive Expectation</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="stats_method.html"><a href="stats_method.html#bayesian-glm---height-mape"><i class="fa fa-check"></i><b>9.3</b> Bayesian GLM - Height MAPE</a>
<ul>
<li class="chapter" data-level="9.3.1" data-path="stats_method.html"><a href="stats_method.html#model-selection-2"><i class="fa fa-check"></i><b>9.3.1</b> Model selection</a></li>
<li class="chapter" data-level="9.3.2" data-path="stats_method.html"><a href="stats_method.html#modeling-1"><i class="fa fa-check"></i><b>9.3.2</b> Modeling</a></li>
<li class="chapter" data-level="9.3.3" data-path="stats_method.html"><a href="stats_method.html#posterior-predictive-checks-2"><i class="fa fa-check"></i><b>9.3.3</b> Posterior Predictive Checks</a></li>
<li class="chapter" data-level="9.3.4" data-path="stats_method.html"><a href="stats_method.html#conditional-effects-2"><i class="fa fa-check"></i><b>9.3.4</b> Conditional Effects</a></li>
<li class="chapter" data-level="9.3.5" data-path="stats_method.html"><a href="stats_method.html#posterior-predictive-expectation-1"><i class="fa fa-check"></i><b>9.3.5</b> Posterior Predictive Expectation</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="stats_method.html"><a href="stats_method.html#hey_balanced_acc"><i class="fa fa-check"></i><b>9.4</b> Balanced Accuracy Bayesian Optimization</a>
<ul>
<li class="chapter" data-level="9.4.1" data-path="stats_method.html"><a href="stats_method.html#balanced-accuracy-selection"><i class="fa fa-check"></i><b>9.4.1</b> Balanced Accuracy Selection</a></li>
<li class="chapter" data-level="9.4.2" data-path="stats_method.html"><a href="stats_method.html#overall-across-chm-resolution-2"><i class="fa fa-check"></i><b>9.4.2</b> Overall (across CHM resolution)</a></li>
<li class="chapter" data-level="9.4.3" data-path="stats_method.html"><a href="stats_method.html#by-chm-resolution-2"><i class="fa fa-check"></i><b>9.4.3</b> by CHM resolution</a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="stats_method.html"><a href="stats_method.html#training_detect_final"><i class="fa fa-check"></i><b>9.5</b> Balanced Accuracy Validation</a>
<ul>
<li class="chapter" data-level="9.5.1" data-path="stats_method.html"><a href="stats_method.html#detection"><i class="fa fa-check"></i><b>9.5.1</b> Detection</a></li>
<li class="chapter" data-level="9.5.2" data-path="stats_method.html"><a href="stats_method.html#instance-match-accuracy-assessment"><i class="fa fa-check"></i><b>9.5.2</b> Instance Match &amp; Accuracy Assessment</a></li>
<li class="chapter" data-level="9.5.3" data-path="stats_method.html"><a href="stats_method.html#training_detect_final_volcomp"><i class="fa fa-check"></i><b>9.5.3</b> Volume Comparison</a></li>
<li class="chapter" data-level="9.5.4" data-path="stats_method.html"><a href="stats_method.html#stand-level-aggregation"><i class="fa fa-check"></i><b>9.5.4</b> Stand-level Aggregation</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="method-validation-pinyon-juniper.html"><a href="method-validation-pinyon-juniper.html"><i class="fa fa-check"></i><b>10</b> Method Validation: Pinyon-Juniper</a>
<ul>
<li class="chapter" data-level="10.1" data-path="method-validation-pinyon-juniper.html"><a href="method-validation-pinyon-juniper.html#site-introduction-1"><i class="fa fa-check"></i><b>10.1</b> Site Introduction</a></li>
<li class="chapter" data-level="10.2" data-path="method-validation-pinyon-juniper.html"><a href="method-validation-pinyon-juniper.html#data-processing"><i class="fa fa-check"></i><b>10.2</b> Data Processing</a>
<ul>
<li class="chapter" data-level="10.2.1" data-path="method-validation-pinyon-juniper.html"><a href="method-validation-pinyon-juniper.html#vector-data"><i class="fa fa-check"></i><b>10.2.1</b> Vector Data</a></li>
<li class="chapter" data-level="10.2.2" data-path="method-validation-pinyon-juniper.html"><a href="method-validation-pinyon-juniper.html#rgb-data"><i class="fa fa-check"></i><b>10.2.2</b> RGB Data</a></li>
<li class="chapter" data-level="10.2.3" data-path="method-validation-pinyon-juniper.html"><a href="method-validation-pinyon-juniper.html#process-raw-point-cloud-2"><i class="fa fa-check"></i><b>10.2.3</b> Process Raw Point Cloud</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="method-validation-pinyon-juniper.html"><a href="method-validation-pinyon-juniper.html#pj_detect_fusion"><i class="fa fa-check"></i><b>10.3</b> Pile Detection: Data Fusion</a>
<ul>
<li class="chapter" data-level="10.3.1" data-path="method-validation-pinyon-juniper.html"><a href="method-validation-pinyon-juniper.html#structural-candidate-segments"><i class="fa fa-check"></i><b>10.3.1</b> Structural Candidate Segments</a></li>
<li class="chapter" data-level="10.3.2" data-path="method-validation-pinyon-juniper.html"><a href="method-validation-pinyon-juniper.html#accuracy-of-these-structural-settings"><i class="fa fa-check"></i><b>10.3.2</b> Accuracy of these structural settings</a></li>
<li class="chapter" data-level="10.3.3" data-path="method-validation-pinyon-juniper.html"><a href="method-validation-pinyon-juniper.html#spect_filtering_final_pj"><i class="fa fa-check"></i><b>10.3.3</b> Spectral Filtering of Candidate Segments</a></li>
<li class="chapter" data-level="10.3.4" data-path="method-validation-pinyon-juniper.html"><a href="method-validation-pinyon-juniper.html#detection-and-quantification-accuracy"><i class="fa fa-check"></i><b>10.3.4</b> Detection and Quantification Accuracy</a></li>
<li class="chapter" data-level="10.3.5" data-path="method-validation-pinyon-juniper.html"><a href="method-validation-pinyon-juniper.html#validation_detect_final_volcomp"><i class="fa fa-check"></i><b>10.3.5</b> Volume Comparison</a></li>
<li class="chapter" data-level="10.3.6" data-path="method-validation-pinyon-juniper.html"><a href="method-validation-pinyon-juniper.html#stand-level-aggregation-1"><i class="fa fa-check"></i><b>10.3.6</b> Stand-level Aggregation</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="method-validation-pinyon-juniper.html"><a href="method-validation-pinyon-juniper.html#pj_detect_struct"><i class="fa fa-check"></i><b>10.4</b> Pile Detection: Structural Only</a>
<ul>
<li class="chapter" data-level="10.4.1" data-path="method-validation-pinyon-juniper.html"><a href="method-validation-pinyon-juniper.html#structural-detection"><i class="fa fa-check"></i><b>10.4.1</b> Structural Detection</a></li>
<li class="chapter" data-level="10.4.2" data-path="method-validation-pinyon-juniper.html"><a href="method-validation-pinyon-juniper.html#detection-and-quantification-accuracy-1"><i class="fa fa-check"></i><b>10.4.2</b> Detection and Quantification Accuracy</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11" data-path="method-validation-bhef-machine-piles.html"><a href="method-validation-bhef-machine-piles.html"><i class="fa fa-check"></i><b>11</b> Method Validation: BHEF Machine Piles</a>
<ul>
<li class="chapter" data-level="11.1" data-path="method-validation-bhef-machine-piles.html"><a href="method-validation-bhef-machine-piles.html#site-introduction-2"><i class="fa fa-check"></i><b>11.1</b> Site Introduction</a></li>
<li class="chapter" data-level="11.2" data-path="method-validation-bhef-machine-piles.html"><a href="method-validation-bhef-machine-piles.html#data-processing-1"><i class="fa fa-check"></i><b>11.2</b> Data Processing</a>
<ul>
<li class="chapter" data-level="11.2.1" data-path="method-validation-bhef-machine-piles.html"><a href="method-validation-bhef-machine-piles.html#rgb-data-1"><i class="fa fa-check"></i><b>11.2.1</b> RGB Data</a></li>
<li class="chapter" data-level="11.2.2" data-path="method-validation-bhef-machine-piles.html"><a href="method-validation-bhef-machine-piles.html#process-raw-point-cloud-3"><i class="fa fa-check"></i><b>11.2.2</b> Process Raw Point Cloud</a></li>
<li class="chapter" data-level="11.2.3" data-path="method-validation-bhef-machine-piles.html"><a href="method-validation-bhef-machine-piles.html#vector-data-1"><i class="fa fa-check"></i><b>11.2.3</b> Vector Data</a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="method-validation-bhef-machine-piles.html"><a href="method-validation-bhef-machine-piles.html#bhef_detect_fusion"><i class="fa fa-check"></i><b>11.3</b> Pile Detection: Data Fusion</a>
<ul>
<li class="chapter" data-level="11.3.1" data-path="method-validation-bhef-machine-piles.html"><a href="method-validation-bhef-machine-piles.html#structural-candidate-segments-1"><i class="fa fa-check"></i><b>11.3.1</b> Structural Candidate Segments</a></li>
<li class="chapter" data-level="11.3.2" data-path="method-validation-bhef-machine-piles.html"><a href="method-validation-bhef-machine-piles.html#accuracy-of-these-structural-settings-1"><i class="fa fa-check"></i><b>11.3.2</b> Accuracy of these structural settings</a></li>
<li class="chapter" data-level="11.3.3" data-path="method-validation-bhef-machine-piles.html"><a href="method-validation-bhef-machine-piles.html#spect_filtering_final_bhef"><i class="fa fa-check"></i><b>11.3.3</b> Spectral Filtering of Candidate Segments</a></li>
<li class="chapter" data-level="11.3.4" data-path="method-validation-bhef-machine-piles.html"><a href="method-validation-bhef-machine-piles.html#detection-and-quantification-accuracy-2"><i class="fa fa-check"></i><b>11.3.4</b> Detection and Quantification Accuracy</a></li>
<li class="chapter" data-level="11.3.5" data-path="method-validation-bhef-machine-piles.html"><a href="method-validation-bhef-machine-piles.html#stand-level-aggregation-2"><i class="fa fa-check"></i><b>11.3.5</b> Stand-level Aggregation</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="12" data-path="method-validation-arnf-machine-piles.html"><a href="method-validation-arnf-machine-piles.html"><i class="fa fa-check"></i><b>12</b> Method Validation: ARNF Machine Piles</a>
<ul>
<li class="chapter" data-level="12.1" data-path="method-validation-arnf-machine-piles.html"><a href="method-validation-arnf-machine-piles.html#site-introduction-3"><i class="fa fa-check"></i><b>12.1</b> Site Introduction</a></li>
<li class="chapter" data-level="12.2" data-path="method-validation-arnf-machine-piles.html"><a href="method-validation-arnf-machine-piles.html#data-processing-2"><i class="fa fa-check"></i><b>12.2</b> Data Processing</a>
<ul>
<li class="chapter" data-level="12.2.1" data-path="method-validation-arnf-machine-piles.html"><a href="method-validation-arnf-machine-piles.html#process-raw-point-cloud-4"><i class="fa fa-check"></i><b>12.2.1</b> Process Raw Point Cloud</a></li>
<li class="chapter" data-level="12.2.2" data-path="method-validation-arnf-machine-piles.html"><a href="method-validation-arnf-machine-piles.html#vector-data-2"><i class="fa fa-check"></i><b>12.2.2</b> Vector Data</a></li>
<li class="chapter" data-level="12.2.3" data-path="method-validation-arnf-machine-piles.html"><a href="method-validation-arnf-machine-piles.html#rgb-data-2"><i class="fa fa-check"></i><b>12.2.3</b> RGB Data</a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="method-validation-arnf-machine-piles.html"><a href="method-validation-arnf-machine-piles.html#arnf_detect_fusion"><i class="fa fa-check"></i><b>12.3</b> Pile Detection: Data Fusion</a>
<ul>
<li class="chapter" data-level="12.3.1" data-path="method-validation-arnf-machine-piles.html"><a href="method-validation-arnf-machine-piles.html#structural-candidate-segments-2"><i class="fa fa-check"></i><b>12.3.1</b> Structural Candidate Segments</a></li>
<li class="chapter" data-level="12.3.2" data-path="method-validation-arnf-machine-piles.html"><a href="method-validation-arnf-machine-piles.html#accuracy-of-these-structural-settings-2"><i class="fa fa-check"></i><b>12.3.2</b> Accuracy of these structural settings</a></li>
<li class="chapter" data-level="12.3.3" data-path="method-validation-bhef-machine-piles.html"><a href="method-validation-bhef-machine-piles.html#spect_filtering_final_bhef"><i class="fa fa-check"></i><b>12.3.3</b> Spectral Filtering of Candidate Segments</a></li>
<li class="chapter" data-level="12.3.4" data-path="method-validation-arnf-machine-piles.html"><a href="method-validation-arnf-machine-piles.html#detection-and-quantification-accuracy-3"><i class="fa fa-check"></i><b>12.3.4</b> Detection and Quantification Accuracy</a></li>
<li class="chapter" data-level="12.3.5" data-path="method-validation-arnf-machine-piles.html"><a href="method-validation-arnf-machine-piles.html#stand-level-aggregation-3"><i class="fa fa-check"></i><b>12.3.5</b> Stand-level Aggregation</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="13" data-path="validation_summary.html"><a href="validation_summary.html"><i class="fa fa-check"></i><b>13</b> Method Validation: Summary</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Aerial Imagery and Point Cloud Data for Slash Pile Quantification</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="chm_sens_test" class="section level1 hasAnchor" number="8">
<h1><span class="header-section-number">Section 8</span> Sensitivity Testing Results<a href="chm_sens_test.html#chm_sens_test" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>In this section we’ll use the slash pile detection workflow to perform <a href="wshed_params_test.html#wshed_params_test">parameter sensitivity testing</a> with different resolution CHM data as input. The objective here is to generate the point estimate data for statistical analysis to fully evaluate our slash pile detection method’s performance. In this <a href="ptcld_process.html#ptcld_process">prior section</a>, we demonstrated how to use the <code>cloud2trees::cloud2raster()</code> function to process raw point cloud data CHM data (a DSM with the ground removed) for our raster-based watershed segmentation methodology. The <code>cloud2trees</code> package makes it easy to generate CHM data at various resolutions, so we’ll use it to systematically test the influence of CHM resolution on both pile detection and form quantification accuracy. Using various CHM resolutions, we will repeatedly execute the entire pile detection method while systematically varying the values of one or more structural parameters (such as minimum area or maximum height). These sensitivity tests will be performed under two conditions: using only the CHM data as input (<a href="raster_watershed.html#raster_watershed">structural detection</a>) and incorporating the RGB spectral data via our <a href="data_fusion.html#data_fusion">data fusion approach</a> across five different levels of the <code>spectral_weight</code> parameter. The results of these sensitivity tests will serve as individual point estimates of detection accuracy (i.e. F-score) and quantification accuracy (e.g., RMSE and MAPE) for each unique combination of CHM resolution, spectral data weighting, and parameter settings. This generated dataset will be used as the input for subsequent statistical modeling to quantify the influence of parameters and input data on the detection and form quantification accuracy of our slash pile detection methodology.</p>
<div id="process-raw-point-cloud-1" class="section level2 hasAnchor" number="8.1">
<h2><span class="header-section-number">8.1</span> Process Raw Point Cloud<a href="chm_sens_test.html#process-raw-point-cloud-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We’ll use <code>cloud2trees::cloud2raster()</code> to process the raw point cloud data to generate a set of CHM rasters at varying resolutions</p>
<div class="sourceCode" id="cb223"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb223-1"><a href="chm_sens_test.html#cb223-1" tabindex="-1"></a>chm_res_list <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from=</span><span class="fl">0.10</span>,<span class="at">to=</span><span class="fl">0.50</span>,<span class="at">by=</span><span class="fl">0.1</span>)</span>
<span id="cb223-2"><a href="chm_sens_test.html#cb223-2" tabindex="-1"></a><span class="co"># process point clouds</span></span>
<span id="cb223-3"><a href="chm_sens_test.html#cb223-3" tabindex="-1"></a>chm_res_list <span class="sc">%&gt;%</span> </span>
<span id="cb223-4"><a href="chm_sens_test.html#cb223-4" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">map</span>(<span class="cf">function</span>(chm_res_m){</span>
<span id="cb223-5"><a href="chm_sens_test.html#cb223-5" tabindex="-1"></a>    <span class="fu">message</span>(<span class="fu">paste0</span>(<span class="st">&quot;CHMing...........&quot;</span>,chm_res_m))</span>
<span id="cb223-6"><a href="chm_sens_test.html#cb223-6" tabindex="-1"></a>    dir_temp <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&quot;../data/point_cloud_processing_delivery_chm&quot;</span>,chm_res_m,<span class="st">&quot;m&quot;</span>)</span>
<span id="cb223-7"><a href="chm_sens_test.html#cb223-7" tabindex="-1"></a>    <span class="co"># do it</span></span>
<span id="cb223-8"><a href="chm_sens_test.html#cb223-8" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span><span class="fu">dir.exists</span>(dir_temp)){</span>
<span id="cb223-9"><a href="chm_sens_test.html#cb223-9" tabindex="-1"></a>      <span class="co"># cloud2trees</span></span>
<span id="cb223-10"><a href="chm_sens_test.html#cb223-10" tabindex="-1"></a>      cloud2raster_ans <span class="ot">&lt;-</span> cloud2trees<span class="sc">::</span><span class="fu">cloud2raster</span>(</span>
<span id="cb223-11"><a href="chm_sens_test.html#cb223-11" tabindex="-1"></a>        <span class="at">output_dir =</span> <span class="st">&quot;../data&quot;</span></span>
<span id="cb223-12"><a href="chm_sens_test.html#cb223-12" tabindex="-1"></a>        , <span class="at">input_las_dir =</span> <span class="st">&quot;f:</span><span class="sc">\\</span><span class="st">PFDP_Data</span><span class="sc">\\</span><span class="st">p4pro_images</span><span class="sc">\\</span><span class="st">P4Pro_06_17_2021_half_half_optimal</span><span class="sc">\\</span><span class="st">2_densification</span><span class="sc">\\</span><span class="st">point_cloud&quot;</span></span>
<span id="cb223-13"><a href="chm_sens_test.html#cb223-13" tabindex="-1"></a>        , <span class="at">accuracy_level =</span> <span class="dv">2</span></span>
<span id="cb223-14"><a href="chm_sens_test.html#cb223-14" tabindex="-1"></a>        , <span class="at">keep_intrmdt =</span> T</span>
<span id="cb223-15"><a href="chm_sens_test.html#cb223-15" tabindex="-1"></a>        , <span class="at">dtm_res_m =</span> <span class="fl">0.25</span></span>
<span id="cb223-16"><a href="chm_sens_test.html#cb223-16" tabindex="-1"></a>        , <span class="at">chm_res_m =</span> chm_res_m</span>
<span id="cb223-17"><a href="chm_sens_test.html#cb223-17" tabindex="-1"></a>        , <span class="at">min_height =</span> <span class="dv">0</span> <span class="co"># effectively generates a DSM based on non-ground points</span></span>
<span id="cb223-18"><a href="chm_sens_test.html#cb223-18" tabindex="-1"></a>      )</span>
<span id="cb223-19"><a href="chm_sens_test.html#cb223-19" tabindex="-1"></a>      <span class="co"># rename</span></span>
<span id="cb223-20"><a href="chm_sens_test.html#cb223-20" tabindex="-1"></a>      <span class="fu">file.rename</span>(<span class="at">from =</span> <span class="st">&quot;../data/point_cloud_processing_delivery&quot;</span>, <span class="at">to =</span> dir_temp)</span>
<span id="cb223-21"><a href="chm_sens_test.html#cb223-21" tabindex="-1"></a>    }    </span>
<span id="cb223-22"><a href="chm_sens_test.html#cb223-22" tabindex="-1"></a>  })</span>
<span id="cb223-23"><a href="chm_sens_test.html#cb223-23" tabindex="-1"></a><span class="co"># which dirs?</span></span>
<span id="cb223-24"><a href="chm_sens_test.html#cb223-24" tabindex="-1"></a>chm_res_list[</span>
<span id="cb223-25"><a href="chm_sens_test.html#cb223-25" tabindex="-1"></a>  chm_res_list <span class="sc">%&gt;%</span></span>
<span id="cb223-26"><a href="chm_sens_test.html#cb223-26" tabindex="-1"></a>    purrr<span class="sc">::</span><span class="fu">map</span>(<span class="sc">~</span><span class="fu">paste0</span>(<span class="st">&quot;../data/point_cloud_processing_delivery_chm&quot;</span>,.x,<span class="st">&quot;m&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb223-27"><a href="chm_sens_test.html#cb223-27" tabindex="-1"></a>    <span class="fu">unlist</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb223-28"><a href="chm_sens_test.html#cb223-28" tabindex="-1"></a>    <span class="fu">dir.exists</span>()</span>
<span id="cb223-29"><a href="chm_sens_test.html#cb223-29" tabindex="-1"></a>]</span></code></pre></div>
</div>
<div id="structural-only-parameter-testing" class="section level2 hasAnchor" number="8.2">
<h2><span class="header-section-number">8.2</span> Structural Only: Parameter Testing<a href="chm_sens_test.html#structural-only-parameter-testing" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>we could simply map these combinations over our <code>slash_pile_detect_watershed()</code> function we reviewed in this <a href="raster_watershed.html#slash_pile_detect_watershed">prior section</a>, but that would entail performing the same action multiple times. we defined a specialized function to efficiently map over all of these combinations in this <a href="wshed_params_test.html#all_the_combos">section</a> to obtain pile predictions based on the different settings.</p>
<p>let’s test different parameter combinations of our watershed segmentation, rules-based slash pile detection methodology for each CHM raster resolution from more coarse, to finer resolution</p>
<div class="sourceCode" id="cb224"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb224-1"><a href="chm_sens_test.html#cb224-1" tabindex="-1"></a>param_combos_df <span class="ot">&lt;-</span></span>
<span id="cb224-2"><a href="chm_sens_test.html#cb224-2" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">crossing</span>(</span>
<span id="cb224-3"><a href="chm_sens_test.html#cb224-3" tabindex="-1"></a>    <span class="at">max_ht_m =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">2</span>, <span class="at">to =</span>  <span class="dv">5</span>, <span class="at">by =</span> <span class="dv">1</span>) <span class="co"># set the max expected pile height (could also do a minimum??)</span></span>
<span id="cb224-4"><a href="chm_sens_test.html#cb224-4" tabindex="-1"></a>    , <span class="at">min_area_m2 =</span> <span class="fu">c</span>(<span class="dv">2</span>) <span class="co"># seq(from = 1, to =  2, by = 1) # set the min expected pile area</span></span>
<span id="cb224-5"><a href="chm_sens_test.html#cb224-5" tabindex="-1"></a>    , <span class="at">max_area_m2 =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">10</span>, <span class="at">to =</span> <span class="dv">60</span>, <span class="at">by =</span> <span class="dv">10</span>) <span class="co"># set the max expected pile area</span></span>
<span id="cb224-6"><a href="chm_sens_test.html#cb224-6" tabindex="-1"></a>    , <span class="at">convexity_pct =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fl">0.05</span>, <span class="at">to =</span> <span class="fl">0.95</span>, <span class="at">length.out =</span> <span class="dv">7</span>) <span class="co"># min required overlap between the predicted pile and the convex hull of the predicted pile</span></span>
<span id="cb224-7"><a href="chm_sens_test.html#cb224-7" tabindex="-1"></a>    , <span class="at">circle_fit_iou_pct =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fl">0.05</span>, <span class="at">to =</span> <span class="fl">0.95</span>, <span class="at">length.out =</span> <span class="dv">7</span>) </span>
<span id="cb224-8"><a href="chm_sens_test.html#cb224-8" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb224-9"><a href="chm_sens_test.html#cb224-9" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">rn =</span> dplyr<span class="sc">::</span><span class="fu">row_number</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb224-10"><a href="chm_sens_test.html#cb224-10" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">relocate</span>(rn)</span>
<span id="cb224-11"><a href="chm_sens_test.html#cb224-11" tabindex="-1"></a><span class="co"># param_combos_df %&gt;% dplyr::glimpse()</span></span>
<span id="cb224-12"><a href="chm_sens_test.html#cb224-12" tabindex="-1"></a><span class="co"># param_combos_df %&gt;% dplyr::count(convexity_pct)</span></span>
<span id="cb224-13"><a href="chm_sens_test.html#cb224-13" tabindex="-1"></a><span class="co"># param_combos_df %&gt;% dplyr::count(circle_fit_iou_pct)</span></span>
<span id="cb224-14"><a href="chm_sens_test.html#cb224-14" tabindex="-1"></a><span class="co"># seq(from = 0.05, to = 0.95, length.out = 7)</span></span>
<span id="cb224-15"><a href="chm_sens_test.html#cb224-15" tabindex="-1"></a></span>
<span id="cb224-16"><a href="chm_sens_test.html#cb224-16" tabindex="-1"></a><span class="co"># how many combos are we testing?</span></span>
<span id="cb224-17"><a href="chm_sens_test.html#cb224-17" tabindex="-1"></a>n_combos_tested_chm <span class="ot">&lt;-</span> <span class="fu">nrow</span>(param_combos_df) <span class="co">#combos per chm</span></span>
<span id="cb224-18"><a href="chm_sens_test.html#cb224-18" tabindex="-1"></a>n_combos_tested <span class="ot">&lt;-</span> <span class="fu">length</span>(chm_res_list)<span class="sc">*</span>n_combos_tested_chm <span class="co">#combos overall structural only</span></span>
<span id="cb224-19"><a href="chm_sens_test.html#cb224-19" tabindex="-1"></a><span class="co"># there are 5 spectral_weight settings + no spectral data (spectral_weight=0) = 6</span></span>
<span id="cb224-20"><a href="chm_sens_test.html#cb224-20" tabindex="-1"></a>spectral_settings_tested <span class="ot">&lt;-</span> <span class="dv">6</span></span>
<span id="cb224-21"><a href="chm_sens_test.html#cb224-21" tabindex="-1"></a><span class="co"># how many combos overall is this for the spectral testing?</span></span>
<span id="cb224-22"><a href="chm_sens_test.html#cb224-22" tabindex="-1"></a>n_combos_tested_spectral <span class="ot">&lt;-</span> n_combos_tested<span class="sc">*</span>spectral_settings_tested </span>
<span id="cb224-23"><a href="chm_sens_test.html#cb224-23" tabindex="-1"></a><span class="co"># how many combos PER CHM is this for the spectral testing?</span></span>
<span id="cb224-24"><a href="chm_sens_test.html#cb224-24" tabindex="-1"></a>n_combos_tested_spectral_chm <span class="ot">&lt;-</span> n_combos_tested_chm<span class="sc">*</span>spectral_settings_tested</span></code></pre></div>
<p>map over each CHM raster for pile detection using each of these parameter combinations</p>
<div class="sourceCode" id="cb225"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb225-1"><a href="chm_sens_test.html#cb225-1" tabindex="-1"></a>param_combos_piles_flist <span class="ot">&lt;-</span> chm_res_list <span class="sc">%&gt;%</span> </span>
<span id="cb225-2"><a href="chm_sens_test.html#cb225-2" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">map</span>(<span class="cf">function</span>(chm_res_m){</span>
<span id="cb225-3"><a href="chm_sens_test.html#cb225-3" tabindex="-1"></a>    <span class="fu">message</span>(<span class="fu">paste0</span>(<span class="st">&quot;param_combos_piles_detect_fn...........&quot;</span>,chm_res_m))</span>
<span id="cb225-4"><a href="chm_sens_test.html#cb225-4" tabindex="-1"></a>    <span class="co"># file</span></span>
<span id="cb225-5"><a href="chm_sens_test.html#cb225-5" tabindex="-1"></a>    f_temp <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">&quot;../data&quot;</span>,<span class="fu">paste0</span>(<span class="st">&quot;param_combos_piles_chm&quot;</span>,chm_res_m,<span class="st">&quot;m.gpkg&quot;</span>))</span>
<span id="cb225-6"><a href="chm_sens_test.html#cb225-6" tabindex="-1"></a>    <span class="co"># chm dir</span></span>
<span id="cb225-7"><a href="chm_sens_test.html#cb225-7" tabindex="-1"></a>    dir_temp <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&quot;../data/point_cloud_processing_delivery_chm&quot;</span>,chm_res_m,<span class="st">&quot;m&quot;</span>)</span>
<span id="cb225-8"><a href="chm_sens_test.html#cb225-8" tabindex="-1"></a>    <span class="co"># chm file</span></span>
<span id="cb225-9"><a href="chm_sens_test.html#cb225-9" tabindex="-1"></a>    chm_f <span class="ot">&lt;-</span> <span class="fu">file.path</span>(dir_temp, <span class="fu">paste0</span>(<span class="st">&quot;chm_&quot;</span>, chm_res_m,<span class="st">&quot;m.tif&quot;</span>))</span>
<span id="cb225-10"><a href="chm_sens_test.html#cb225-10" tabindex="-1"></a>    <span class="co"># check and do it</span></span>
<span id="cb225-11"><a href="chm_sens_test.html#cb225-11" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(f_temp) <span class="sc">&amp;&amp;</span> <span class="fu">file.exists</span>(chm_f) ){</span>
<span id="cb225-12"><a href="chm_sens_test.html#cb225-12" tabindex="-1"></a>      <span class="co"># read chm</span></span>
<span id="cb225-13"><a href="chm_sens_test.html#cb225-13" tabindex="-1"></a>      chm_rast <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rast</span>(chm_f)</span>
<span id="cb225-14"><a href="chm_sens_test.html#cb225-14" tabindex="-1"></a>      <span class="co"># do it</span></span>
<span id="cb225-15"><a href="chm_sens_test.html#cb225-15" tabindex="-1"></a>      param_combos_piles <span class="ot">&lt;-</span> <span class="fu">param_combos_piles_detect_fn</span>(</span>
<span id="cb225-16"><a href="chm_sens_test.html#cb225-16" tabindex="-1"></a>        <span class="at">chm =</span> chm_rast <span class="sc">%&gt;%</span> </span>
<span id="cb225-17"><a href="chm_sens_test.html#cb225-17" tabindex="-1"></a>          terra<span class="sc">::</span><span class="fu">crop</span>(</span>
<span id="cb225-18"><a href="chm_sens_test.html#cb225-18" tabindex="-1"></a>            stand_boundary <span class="sc">%&gt;%</span></span>
<span id="cb225-19"><a href="chm_sens_test.html#cb225-19" tabindex="-1"></a>              dplyr<span class="sc">::</span><span class="fu">slice</span>(<span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb225-20"><a href="chm_sens_test.html#cb225-20" tabindex="-1"></a>              sf<span class="sc">::</span><span class="fu">st_buffer</span>(<span class="dv">5</span>) <span class="sc">%&gt;%</span></span>
<span id="cb225-21"><a href="chm_sens_test.html#cb225-21" tabindex="-1"></a>              sf<span class="sc">::</span><span class="fu">st_transform</span>(terra<span class="sc">::</span><span class="fu">crs</span>(chm_rast)) <span class="sc">%&gt;%</span></span>
<span id="cb225-22"><a href="chm_sens_test.html#cb225-22" tabindex="-1"></a>              terra<span class="sc">::</span><span class="fu">vect</span>()</span>
<span id="cb225-23"><a href="chm_sens_test.html#cb225-23" tabindex="-1"></a>          )</span>
<span id="cb225-24"><a href="chm_sens_test.html#cb225-24" tabindex="-1"></a>        , <span class="at">param_combos_df =</span> param_combos_df</span>
<span id="cb225-25"><a href="chm_sens_test.html#cb225-25" tabindex="-1"></a>        , <span class="at">smooth_segs =</span> T</span>
<span id="cb225-26"><a href="chm_sens_test.html#cb225-26" tabindex="-1"></a>        , <span class="at">ofile =</span> f_temp</span>
<span id="cb225-27"><a href="chm_sens_test.html#cb225-27" tabindex="-1"></a>      )</span>
<span id="cb225-28"><a href="chm_sens_test.html#cb225-28" tabindex="-1"></a>      <span class="co"># param_combos_piles %&gt;% dplyr::glimpse()</span></span>
<span id="cb225-29"><a href="chm_sens_test.html#cb225-29" tabindex="-1"></a>      </span>
<span id="cb225-30"><a href="chm_sens_test.html#cb225-30" tabindex="-1"></a>      <span class="co"># save it</span></span>
<span id="cb225-31"><a href="chm_sens_test.html#cb225-31" tabindex="-1"></a>      sf<span class="sc">::</span><span class="fu">st_write</span>(param_combos_piles, f_temp, <span class="at">append =</span> F, <span class="at">quiet =</span> T)</span>
<span id="cb225-32"><a href="chm_sens_test.html#cb225-32" tabindex="-1"></a>      <span class="fu">return</span>(f_temp)</span>
<span id="cb225-33"><a href="chm_sens_test.html#cb225-33" tabindex="-1"></a>    }<span class="cf">else</span> <span class="cf">if</span>(<span class="fu">file.exists</span>(f_temp)){</span>
<span id="cb225-34"><a href="chm_sens_test.html#cb225-34" tabindex="-1"></a>      <span class="fu">return</span>(f_temp)</span>
<span id="cb225-35"><a href="chm_sens_test.html#cb225-35" tabindex="-1"></a>    }<span class="cf">else</span>{</span>
<span id="cb225-36"><a href="chm_sens_test.html#cb225-36" tabindex="-1"></a>      <span class="fu">return</span>(<span class="cn">NULL</span>)</span>
<span id="cb225-37"><a href="chm_sens_test.html#cb225-37" tabindex="-1"></a>    }</span>
<span id="cb225-38"><a href="chm_sens_test.html#cb225-38" tabindex="-1"></a>  })</span>
<span id="cb225-39"><a href="chm_sens_test.html#cb225-39" tabindex="-1"></a><span class="co"># which successes?</span></span>
<span id="cb225-40"><a href="chm_sens_test.html#cb225-40" tabindex="-1"></a>param_combos_piles_flist</span></code></pre></div>
<div id="validation-over-parameter-combinations" class="section level3 hasAnchor" number="8.2.1">
<h3><span class="header-section-number">8.2.1</span> Validation over parameter combinations<a href="chm_sens_test.html#validation-over-parameter-combinations" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>now we need to validate these combinations against the ground truth data and we can map over the <code>ground_truth_prediction_match()</code> function to get true positive, false positive (commission), and false negative (omission) classifications for the predicted and ground truth piles</p>
<div class="sourceCode" id="cb226"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb226-1"><a href="chm_sens_test.html#cb226-1" tabindex="-1"></a>param_combos_gt_flist <span class="ot">&lt;-</span> chm_res_list <span class="sc">%&gt;%</span> </span>
<span id="cb226-2"><a href="chm_sens_test.html#cb226-2" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">map</span>(<span class="cf">function</span>(chm_res_m){</span>
<span id="cb226-3"><a href="chm_sens_test.html#cb226-3" tabindex="-1"></a>    <span class="fu">message</span>(<span class="fu">paste0</span>(<span class="st">&quot;ground_truth_prediction_match...........&quot;</span>,chm_res_m))</span>
<span id="cb226-4"><a href="chm_sens_test.html#cb226-4" tabindex="-1"></a>    param_combos_piles_fnm <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">&quot;../data&quot;</span>,<span class="fu">paste0</span>(<span class="st">&quot;param_combos_piles_chm&quot;</span>,chm_res_m,<span class="st">&quot;m.gpkg&quot;</span>))</span>
<span id="cb226-5"><a href="chm_sens_test.html#cb226-5" tabindex="-1"></a>    <span class="co"># file creating now</span></span>
<span id="cb226-6"><a href="chm_sens_test.html#cb226-6" tabindex="-1"></a>    f_temp <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">&quot;../data&quot;</span>,<span class="fu">paste0</span>(<span class="st">&quot;param_combos_gt_chm&quot;</span>,chm_res_m,<span class="st">&quot;m.csv&quot;</span>))</span>
<span id="cb226-7"><a href="chm_sens_test.html#cb226-7" tabindex="-1"></a>    <span class="co"># check</span></span>
<span id="cb226-8"><a href="chm_sens_test.html#cb226-8" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(f_temp) <span class="sc">&amp;&amp;</span> <span class="fu">file.exists</span>(param_combos_piles_fnm)){</span>
<span id="cb226-9"><a href="chm_sens_test.html#cb226-9" tabindex="-1"></a>      <span class="co"># read it</span></span>
<span id="cb226-10"><a href="chm_sens_test.html#cb226-10" tabindex="-1"></a>      param_combos_piles <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_read</span>(param_combos_piles_fnm)</span>
<span id="cb226-11"><a href="chm_sens_test.html#cb226-11" tabindex="-1"></a>      <span class="co"># do it</span></span>
<span id="cb226-12"><a href="chm_sens_test.html#cb226-12" tabindex="-1"></a>      param_combos_gt <span class="ot">&lt;-</span> </span>
<span id="cb226-13"><a href="chm_sens_test.html#cb226-13" tabindex="-1"></a>        <span class="fu">unique</span>(param_combos_df<span class="sc">$</span>rn) <span class="sc">%&gt;%</span> </span>
<span id="cb226-14"><a href="chm_sens_test.html#cb226-14" tabindex="-1"></a>        purrr<span class="sc">::</span><span class="fu">map</span>(\(x)</span>
<span id="cb226-15"><a href="chm_sens_test.html#cb226-15" tabindex="-1"></a>          <span class="fu">ground_truth_prediction_match</span>(</span>
<span id="cb226-16"><a href="chm_sens_test.html#cb226-16" tabindex="-1"></a>            <span class="at">ground_truth =</span> slash_piles_polys <span class="sc">%&gt;%</span> </span>
<span id="cb226-17"><a href="chm_sens_test.html#cb226-17" tabindex="-1"></a>              dplyr<span class="sc">::</span><span class="fu">filter</span>(is_in_stand) <span class="sc">%&gt;%</span> </span>
<span id="cb226-18"><a href="chm_sens_test.html#cb226-18" tabindex="-1"></a>              dplyr<span class="sc">::</span><span class="fu">arrange</span>(<span class="fu">desc</span>(field_diameter_m)) <span class="sc">%&gt;%</span> </span>
<span id="cb226-19"><a href="chm_sens_test.html#cb226-19" tabindex="-1"></a>              sf<span class="sc">::</span><span class="fu">st_transform</span>(sf<span class="sc">::</span><span class="fu">st_crs</span>(param_combos_piles))</span>
<span id="cb226-20"><a href="chm_sens_test.html#cb226-20" tabindex="-1"></a>            , <span class="at">gt_id =</span> <span class="st">&quot;pile_id&quot;</span></span>
<span id="cb226-21"><a href="chm_sens_test.html#cb226-21" tabindex="-1"></a>            , <span class="at">predictions =</span> param_combos_piles <span class="sc">%&gt;%</span> </span>
<span id="cb226-22"><a href="chm_sens_test.html#cb226-22" tabindex="-1"></a>              dplyr<span class="sc">::</span><span class="fu">filter</span>(rn <span class="sc">==</span> x) <span class="sc">%&gt;%</span> </span>
<span id="cb226-23"><a href="chm_sens_test.html#cb226-23" tabindex="-1"></a>              dplyr<span class="sc">::</span><span class="fu">filter</span>(</span>
<span id="cb226-24"><a href="chm_sens_test.html#cb226-24" tabindex="-1"></a>                pred_id <span class="sc">%in%</span> (param_combos_piles <span class="sc">%&gt;%</span> </span>
<span id="cb226-25"><a href="chm_sens_test.html#cb226-25" tabindex="-1"></a>                  dplyr<span class="sc">::</span><span class="fu">filter</span>(rn <span class="sc">==</span> x) <span class="sc">%&gt;%</span> </span>
<span id="cb226-26"><a href="chm_sens_test.html#cb226-26" tabindex="-1"></a>                  sf<span class="sc">::</span><span class="fu">st_intersection</span>(</span>
<span id="cb226-27"><a href="chm_sens_test.html#cb226-27" tabindex="-1"></a>                    stand_boundary <span class="sc">%&gt;%</span> </span>
<span id="cb226-28"><a href="chm_sens_test.html#cb226-28" tabindex="-1"></a>                      sf<span class="sc">::</span><span class="fu">st_transform</span>(sf<span class="sc">::</span><span class="fu">st_crs</span>(param_combos_piles))</span>
<span id="cb226-29"><a href="chm_sens_test.html#cb226-29" tabindex="-1"></a>                  ) <span class="sc">%&gt;%</span> </span>
<span id="cb226-30"><a href="chm_sens_test.html#cb226-30" tabindex="-1"></a>                  sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb226-31"><a href="chm_sens_test.html#cb226-31" tabindex="-1"></a>                  dplyr<span class="sc">::</span><span class="fu">pull</span>(pred_id))</span>
<span id="cb226-32"><a href="chm_sens_test.html#cb226-32" tabindex="-1"></a>              )</span>
<span id="cb226-33"><a href="chm_sens_test.html#cb226-33" tabindex="-1"></a>            , <span class="at">pred_id =</span> <span class="st">&quot;pred_id&quot;</span></span>
<span id="cb226-34"><a href="chm_sens_test.html#cb226-34" tabindex="-1"></a>            , <span class="at">min_iou_pct =</span> <span class="fl">0.05</span></span>
<span id="cb226-35"><a href="chm_sens_test.html#cb226-35" tabindex="-1"></a>          ) <span class="sc">%&gt;%</span> </span>
<span id="cb226-36"><a href="chm_sens_test.html#cb226-36" tabindex="-1"></a>          dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">rn=</span>x)</span>
<span id="cb226-37"><a href="chm_sens_test.html#cb226-37" tabindex="-1"></a>        ) <span class="sc">%&gt;%</span> </span>
<span id="cb226-38"><a href="chm_sens_test.html#cb226-38" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">bind_rows</span>()</span>
<span id="cb226-39"><a href="chm_sens_test.html#cb226-39" tabindex="-1"></a>      <span class="co"># write it</span></span>
<span id="cb226-40"><a href="chm_sens_test.html#cb226-40" tabindex="-1"></a>      param_combos_gt <span class="sc">%&gt;%</span> readr<span class="sc">::</span><span class="fu">write_csv</span>(f_temp, <span class="at">append =</span> F, <span class="at">progress =</span> F)</span>
<span id="cb226-41"><a href="chm_sens_test.html#cb226-41" tabindex="-1"></a>      <span class="fu">return</span>(f_temp)</span>
<span id="cb226-42"><a href="chm_sens_test.html#cb226-42" tabindex="-1"></a>    }<span class="cf">else</span> <span class="cf">if</span>(<span class="fu">file.exists</span>(f_temp)){</span>
<span id="cb226-43"><a href="chm_sens_test.html#cb226-43" tabindex="-1"></a>      <span class="fu">return</span>(f_temp)</span>
<span id="cb226-44"><a href="chm_sens_test.html#cb226-44" tabindex="-1"></a>    }<span class="cf">else</span>{</span>
<span id="cb226-45"><a href="chm_sens_test.html#cb226-45" tabindex="-1"></a>      <span class="fu">return</span>(<span class="cn">NULL</span>)</span>
<span id="cb226-46"><a href="chm_sens_test.html#cb226-46" tabindex="-1"></a>    }</span>
<span id="cb226-47"><a href="chm_sens_test.html#cb226-47" tabindex="-1"></a>  })</span>
<span id="cb226-48"><a href="chm_sens_test.html#cb226-48" tabindex="-1"></a><span class="co"># which successes?</span></span>
<span id="cb226-49"><a href="chm_sens_test.html#cb226-49" tabindex="-1"></a>param_combos_gt_flist</span></code></pre></div>
</div>
<div id="aggregate-validation-metrics-to-parameter-combination" class="section level3 hasAnchor" number="8.2.2">
<h3><span class="header-section-number">8.2.2</span> Aggregate Validation Metrics to Parameter Combination<a href="chm_sens_test.html#aggregate-validation-metrics-to-parameter-combination" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>now we’re going to calculate aggregated detection accuracy metrics and quantification accuracy metrics</p>
<p><strong>detection accuracy metrics</strong>:</p>
<ul>
<li><strong>Precision</strong> precision measures how many of the objects our method detected as slash piles were actually correct. A high precision means the method has a low rate of false alarms.</li>
<li><strong>Recall</strong> recall (i.e. detection rate) indicates how many actual (ground truth) slash piles our method successfully identified. High recall means the method is good at finding most existing piles, minimizing omissions.</li>
<li><strong>F-score</strong> provides a single, balanced measure that combines both precision and recall. A high F-score indicates overall effectiveness in both finding most piles and ensuring most detections are correct.</li>
</ul>
<p><strong>quantification accuracy metrics</strong>:</p>
<ul>
<li><strong>Mean Error (ME)</strong> represents the direction of bias (over or under-prediction) in the original units</li>
<li><strong>RMSE</strong> represents the typical magnitude of error in the original units, with a stronger penalty for large errors</li>
<li><strong>MAPE</strong> represents the typical magnitude of error as a percentage, allowing for scale-independent comparisons</li>
</ul>
<p>regarding the form quantification accuracy evaluation, we will assess the method’s accuracy by comparing the true-positive matches using the following metrics:</p>
<ul>
<li><strong>Diameter</strong> compares the predicted diameter (from the maximum internal distance) to the ground truth field-measured diameter</li>
<li><strong>Area</strong> compares the predicted area from the irregular shape to the image-annotated area based on the potentially irregular pile perimeter</li>
<li><strong>Height</strong> compares the predicted maximum height from the CHM to the ground truth field-measured height</li>
</ul>
<div class="sourceCode" id="cb227"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb227-1"><a href="chm_sens_test.html#cb227-1" tabindex="-1"></a>param_combos_gt_agg_flist <span class="ot">&lt;-</span> chm_res_list <span class="sc">%&gt;%</span> </span>
<span id="cb227-2"><a href="chm_sens_test.html#cb227-2" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">map</span>(<span class="cf">function</span>(chm_res_m){</span>
<span id="cb227-3"><a href="chm_sens_test.html#cb227-3" tabindex="-1"></a>    <span class="fu">message</span>(<span class="fu">paste0</span>(<span class="st">&quot;param_combos_gt_agg...........&quot;</span>,chm_res_m))</span>
<span id="cb227-4"><a href="chm_sens_test.html#cb227-4" tabindex="-1"></a>    <span class="co"># param_combos_piles file</span></span>
<span id="cb227-5"><a href="chm_sens_test.html#cb227-5" tabindex="-1"></a>    param_combos_piles_fnm <span class="ot">&lt;-</span> param_combos_piles_flist <span class="sc">%&gt;%</span> stringr<span class="sc">::</span><span class="fu">str_subset</span>(<span class="at">pattern =</span> <span class="fu">paste0</span>(<span class="st">&quot;chm&quot;</span>,chm_res_m,<span class="st">&quot;m.gpkg&quot;</span>)) <span class="sc">%&gt;%</span> purrr<span class="sc">::</span><span class="fu">pluck</span>(<span class="dv">1</span>)</span>
<span id="cb227-6"><a href="chm_sens_test.html#cb227-6" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">is.null</span>(param_combos_piles_fnm) <span class="sc">||</span> <span class="sc">!</span><span class="fu">file.exists</span>(param_combos_piles_fnm)){<span class="fu">return</span>(<span class="cn">NULL</span>)}</span>
<span id="cb227-7"><a href="chm_sens_test.html#cb227-7" tabindex="-1"></a>    <span class="co"># param_combos_gt file</span></span>
<span id="cb227-8"><a href="chm_sens_test.html#cb227-8" tabindex="-1"></a>    param_combos_gt_fnm <span class="ot">&lt;-</span> param_combos_gt_flist <span class="sc">%&gt;%</span> stringr<span class="sc">::</span><span class="fu">str_subset</span>(<span class="at">pattern =</span> <span class="fu">paste0</span>(<span class="st">&quot;chm&quot;</span>,chm_res_m,<span class="st">&quot;m.csv&quot;</span>)) <span class="sc">%&gt;%</span> purrr<span class="sc">::</span><span class="fu">pluck</span>(<span class="dv">1</span>)</span>
<span id="cb227-9"><a href="chm_sens_test.html#cb227-9" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">is.null</span>(param_combos_gt_fnm) <span class="sc">||</span> <span class="sc">!</span><span class="fu">file.exists</span>(param_combos_gt_fnm)){<span class="fu">return</span>(<span class="cn">NULL</span>)}</span>
<span id="cb227-10"><a href="chm_sens_test.html#cb227-10" tabindex="-1"></a>    <span class="co"># file creating now</span></span>
<span id="cb227-11"><a href="chm_sens_test.html#cb227-11" tabindex="-1"></a>    f_temp <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">&quot;../data&quot;</span>,<span class="fu">paste0</span>(<span class="st">&quot;param_combos_gt_agg_chm&quot;</span>,chm_res_m,<span class="st">&quot;m.csv&quot;</span>))</span>
<span id="cb227-12"><a href="chm_sens_test.html#cb227-12" tabindex="-1"></a>    <span class="co"># check and do it</span></span>
<span id="cb227-13"><a href="chm_sens_test.html#cb227-13" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(f_temp)){</span>
<span id="cb227-14"><a href="chm_sens_test.html#cb227-14" tabindex="-1"></a>      <span class="co"># read param_combos_piles</span></span>
<span id="cb227-15"><a href="chm_sens_test.html#cb227-15" tabindex="-1"></a>      param_combos_piles <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_read</span>(param_combos_piles_fnm)</span>
<span id="cb227-16"><a href="chm_sens_test.html#cb227-16" tabindex="-1"></a>      <span class="co"># read param_combos_piles</span></span>
<span id="cb227-17"><a href="chm_sens_test.html#cb227-17" tabindex="-1"></a>      param_combos_gt <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(param_combos_gt_fnm)</span>
<span id="cb227-18"><a href="chm_sens_test.html#cb227-18" tabindex="-1"></a>      </span>
<span id="cb227-19"><a href="chm_sens_test.html#cb227-19" tabindex="-1"></a>      <span class="do">#######################################</span></span>
<span id="cb227-20"><a href="chm_sens_test.html#cb227-20" tabindex="-1"></a>      <span class="co"># let&#39;s attach a flag to only work with piles that intersect with the stand boundary</span></span>
<span id="cb227-21"><a href="chm_sens_test.html#cb227-21" tabindex="-1"></a>      <span class="co"># add in/out to piles data</span></span>
<span id="cb227-22"><a href="chm_sens_test.html#cb227-22" tabindex="-1"></a>      <span class="do">#######################################</span></span>
<span id="cb227-23"><a href="chm_sens_test.html#cb227-23" tabindex="-1"></a>      param_combos_piles <span class="ot">&lt;-</span> param_combos_piles <span class="sc">%&gt;%</span> </span>
<span id="cb227-24"><a href="chm_sens_test.html#cb227-24" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">left_join</span>(</span>
<span id="cb227-25"><a href="chm_sens_test.html#cb227-25" tabindex="-1"></a>          param_combos_piles <span class="sc">%&gt;%</span> </span>
<span id="cb227-26"><a href="chm_sens_test.html#cb227-26" tabindex="-1"></a>            sf<span class="sc">::</span><span class="fu">st_intersection</span>(</span>
<span id="cb227-27"><a href="chm_sens_test.html#cb227-27" tabindex="-1"></a>              stand_boundary <span class="sc">%&gt;%</span> </span>
<span id="cb227-28"><a href="chm_sens_test.html#cb227-28" tabindex="-1"></a>                sf<span class="sc">::</span><span class="fu">st_transform</span>(sf<span class="sc">::</span><span class="fu">st_crs</span>(param_combos_piles))</span>
<span id="cb227-29"><a href="chm_sens_test.html#cb227-29" tabindex="-1"></a>            ) <span class="sc">%&gt;%</span> </span>
<span id="cb227-30"><a href="chm_sens_test.html#cb227-30" tabindex="-1"></a>            sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb227-31"><a href="chm_sens_test.html#cb227-31" tabindex="-1"></a>            dplyr<span class="sc">::</span><span class="fu">select</span>(rn,pred_id) <span class="sc">%&gt;%</span> </span>
<span id="cb227-32"><a href="chm_sens_test.html#cb227-32" tabindex="-1"></a>            dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">is_in_stand =</span> T)</span>
<span id="cb227-33"><a href="chm_sens_test.html#cb227-33" tabindex="-1"></a>          , <span class="at">by =</span> dplyr<span class="sc">::</span><span class="fu">join_by</span>(rn,pred_id)</span>
<span id="cb227-34"><a href="chm_sens_test.html#cb227-34" tabindex="-1"></a>        ) <span class="sc">%&gt;%</span> </span>
<span id="cb227-35"><a href="chm_sens_test.html#cb227-35" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb227-36"><a href="chm_sens_test.html#cb227-36" tabindex="-1"></a>          <span class="at">is_in_stand =</span> dplyr<span class="sc">::</span><span class="fu">coalesce</span>(is_in_stand,F)</span>
<span id="cb227-37"><a href="chm_sens_test.html#cb227-37" tabindex="-1"></a>        ) <span class="sc">%&gt;%</span> </span>
<span id="cb227-38"><a href="chm_sens_test.html#cb227-38" tabindex="-1"></a>        <span class="co"># # get the length (diameter) and width of the polygon</span></span>
<span id="cb227-39"><a href="chm_sens_test.html#cb227-39" tabindex="-1"></a>        <span class="co"># st_bbox_by_row(dimensions = T) %&gt;% # gets shape_length, where shape_length=length of longest bbox side</span></span>
<span id="cb227-40"><a href="chm_sens_test.html#cb227-40" tabindex="-1"></a>        <span class="co"># and paraboloid volume</span></span>
<span id="cb227-41"><a href="chm_sens_test.html#cb227-41" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb227-42"><a href="chm_sens_test.html#cb227-42" tabindex="-1"></a>          <span class="co"># paraboloid_volume_m3 = (1/8) * pi * (shape_length^2) * max_height_m</span></span>
<span id="cb227-43"><a href="chm_sens_test.html#cb227-43" tabindex="-1"></a>          <span class="at">paraboloid_volume_m3 =</span> (<span class="dv">1</span><span class="sc">/</span><span class="dv">8</span>) <span class="sc">*</span> pi <span class="sc">*</span> (diameter_m<span class="sc">^</span><span class="dv">2</span>) <span class="sc">*</span> max_height_m</span>
<span id="cb227-44"><a href="chm_sens_test.html#cb227-44" tabindex="-1"></a>        )</span>
<span id="cb227-45"><a href="chm_sens_test.html#cb227-45" tabindex="-1"></a>      <span class="co"># param_combos_piles %&gt;% dplyr::glimpse()</span></span>
<span id="cb227-46"><a href="chm_sens_test.html#cb227-46" tabindex="-1"></a>      <span class="do">#######################################</span></span>
<span id="cb227-47"><a href="chm_sens_test.html#cb227-47" tabindex="-1"></a>      <span class="co"># add data to validation</span></span>
<span id="cb227-48"><a href="chm_sens_test.html#cb227-48" tabindex="-1"></a>      <span class="do">#######################################</span></span>
<span id="cb227-49"><a href="chm_sens_test.html#cb227-49" tabindex="-1"></a>      param_combos_gt <span class="ot">&lt;-</span></span>
<span id="cb227-50"><a href="chm_sens_test.html#cb227-50" tabindex="-1"></a>        param_combos_gt <span class="sc">%&gt;%</span> </span>
<span id="cb227-51"><a href="chm_sens_test.html#cb227-51" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">pile_id =</span> <span class="fu">as.numeric</span>(pile_id)) <span class="sc">%&gt;%</span> </span>
<span id="cb227-52"><a href="chm_sens_test.html#cb227-52" tabindex="-1"></a>        <span class="co"># add area of gt</span></span>
<span id="cb227-53"><a href="chm_sens_test.html#cb227-53" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">left_join</span>(</span>
<span id="cb227-54"><a href="chm_sens_test.html#cb227-54" tabindex="-1"></a>          slash_piles_polys <span class="sc">%&gt;%</span> </span>
<span id="cb227-55"><a href="chm_sens_test.html#cb227-55" tabindex="-1"></a>            sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb227-56"><a href="chm_sens_test.html#cb227-56" tabindex="-1"></a>            dplyr<span class="sc">::</span><span class="fu">select</span>(pile_id,image_gt_area_m2,height_m,field_diameter_m) <span class="sc">%&gt;%</span> </span>
<span id="cb227-57"><a href="chm_sens_test.html#cb227-57" tabindex="-1"></a>            dplyr<span class="sc">::</span><span class="fu">rename</span>(</span>
<span id="cb227-58"><a href="chm_sens_test.html#cb227-58" tabindex="-1"></a>              <span class="at">gt_height_m =</span> height_m</span>
<span id="cb227-59"><a href="chm_sens_test.html#cb227-59" tabindex="-1"></a>              , <span class="at">gt_diameter_m =</span> field_diameter_m</span>
<span id="cb227-60"><a href="chm_sens_test.html#cb227-60" tabindex="-1"></a>              , <span class="at">gt_area_m2 =</span> image_gt_area_m2</span>
<span id="cb227-61"><a href="chm_sens_test.html#cb227-61" tabindex="-1"></a>            ) <span class="sc">%&gt;%</span> </span>
<span id="cb227-62"><a href="chm_sens_test.html#cb227-62" tabindex="-1"></a>            dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">pile_id=</span><span class="fu">as.numeric</span>(pile_id))</span>
<span id="cb227-63"><a href="chm_sens_test.html#cb227-63" tabindex="-1"></a>          , <span class="at">by =</span> <span class="st">&quot;pile_id&quot;</span></span>
<span id="cb227-64"><a href="chm_sens_test.html#cb227-64" tabindex="-1"></a>        ) <span class="sc">%&gt;%</span> </span>
<span id="cb227-65"><a href="chm_sens_test.html#cb227-65" tabindex="-1"></a>        <span class="co"># add info from predictions</span></span>
<span id="cb227-66"><a href="chm_sens_test.html#cb227-66" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">left_join</span>(</span>
<span id="cb227-67"><a href="chm_sens_test.html#cb227-67" tabindex="-1"></a>          param_combos_piles <span class="sc">%&gt;%</span></span>
<span id="cb227-68"><a href="chm_sens_test.html#cb227-68" tabindex="-1"></a>            sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span></span>
<span id="cb227-69"><a href="chm_sens_test.html#cb227-69" tabindex="-1"></a>            dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb227-70"><a href="chm_sens_test.html#cb227-70" tabindex="-1"></a>              rn,pred_id</span>
<span id="cb227-71"><a href="chm_sens_test.html#cb227-71" tabindex="-1"></a>              , is_in_stand</span>
<span id="cb227-72"><a href="chm_sens_test.html#cb227-72" tabindex="-1"></a>              , area_m2, volume_m3, max_height_m, diameter_m</span>
<span id="cb227-73"><a href="chm_sens_test.html#cb227-73" tabindex="-1"></a>              , paraboloid_volume_m3</span>
<span id="cb227-74"><a href="chm_sens_test.html#cb227-74" tabindex="-1"></a>              <span class="co"># , shape_length # , shape_width</span></span>
<span id="cb227-75"><a href="chm_sens_test.html#cb227-75" tabindex="-1"></a>            ) <span class="sc">%&gt;%</span> </span>
<span id="cb227-76"><a href="chm_sens_test.html#cb227-76" tabindex="-1"></a>            dplyr<span class="sc">::</span><span class="fu">rename</span>(</span>
<span id="cb227-77"><a href="chm_sens_test.html#cb227-77" tabindex="-1"></a>              <span class="at">pred_area_m2 =</span> area_m2, <span class="at">pred_volume_m3 =</span> volume_m3</span>
<span id="cb227-78"><a href="chm_sens_test.html#cb227-78" tabindex="-1"></a>              , <span class="at">pred_height_m =</span> max_height_m, <span class="at">pred_diameter_m =</span> diameter_m</span>
<span id="cb227-79"><a href="chm_sens_test.html#cb227-79" tabindex="-1"></a>              , <span class="at">pred_paraboloid_volume_m3 =</span> paraboloid_volume_m3</span>
<span id="cb227-80"><a href="chm_sens_test.html#cb227-80" tabindex="-1"></a>            )</span>
<span id="cb227-81"><a href="chm_sens_test.html#cb227-81" tabindex="-1"></a>          , <span class="at">by =</span> dplyr<span class="sc">::</span><span class="fu">join_by</span>(rn,pred_id)</span>
<span id="cb227-82"><a href="chm_sens_test.html#cb227-82" tabindex="-1"></a>        ) <span class="sc">%&gt;%</span></span>
<span id="cb227-83"><a href="chm_sens_test.html#cb227-83" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb227-84"><a href="chm_sens_test.html#cb227-84" tabindex="-1"></a>          <span class="at">is_in_stand =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb227-85"><a href="chm_sens_test.html#cb227-85" tabindex="-1"></a>            is_in_stand <span class="sc">==</span> T <span class="sc">~</span> T</span>
<span id="cb227-86"><a href="chm_sens_test.html#cb227-86" tabindex="-1"></a>            , is_in_stand <span class="sc">==</span> F <span class="sc">~</span> F</span>
<span id="cb227-87"><a href="chm_sens_test.html#cb227-87" tabindex="-1"></a>            , match_grp <span class="sc">==</span> <span class="st">&quot;omission&quot;</span> <span class="sc">~</span> T</span>
<span id="cb227-88"><a href="chm_sens_test.html#cb227-88" tabindex="-1"></a>            , T <span class="sc">~</span> F</span>
<span id="cb227-89"><a href="chm_sens_test.html#cb227-89" tabindex="-1"></a>          )</span>
<span id="cb227-90"><a href="chm_sens_test.html#cb227-90" tabindex="-1"></a>          <span class="do">### calculate these based on the formulas below...agg_ground_truth_match() depends on those formulas</span></span>
<span id="cb227-91"><a href="chm_sens_test.html#cb227-91" tabindex="-1"></a>          <span class="co"># area_m2</span></span>
<span id="cb227-92"><a href="chm_sens_test.html#cb227-92" tabindex="-1"></a>          , <span class="at">diff_area_m2 =</span> pred_area_m2<span class="sc">-</span>gt_area_m2</span>
<span id="cb227-93"><a href="chm_sens_test.html#cb227-93" tabindex="-1"></a>          , <span class="at">pct_diff_area_m2 =</span> (gt_area_m2<span class="sc">-</span>pred_area_m2)<span class="sc">/</span>gt_area_m2</span>
<span id="cb227-94"><a href="chm_sens_test.html#cb227-94" tabindex="-1"></a>          <span class="co"># height_m</span></span>
<span id="cb227-95"><a href="chm_sens_test.html#cb227-95" tabindex="-1"></a>          , <span class="at">diff_height_m =</span> pred_height_m<span class="sc">-</span>gt_height_m</span>
<span id="cb227-96"><a href="chm_sens_test.html#cb227-96" tabindex="-1"></a>          , <span class="at">pct_diff_height_m =</span> (gt_height_m<span class="sc">-</span>pred_height_m)<span class="sc">/</span>gt_height_m</span>
<span id="cb227-97"><a href="chm_sens_test.html#cb227-97" tabindex="-1"></a>          <span class="co"># diameter_m</span></span>
<span id="cb227-98"><a href="chm_sens_test.html#cb227-98" tabindex="-1"></a>          , <span class="at">diff_diameter_m =</span> pred_diameter_m<span class="sc">-</span>gt_diameter_m</span>
<span id="cb227-99"><a href="chm_sens_test.html#cb227-99" tabindex="-1"></a>          , <span class="at">pct_diff_diameter_m =</span> (gt_diameter_m<span class="sc">-</span>pred_diameter_m)<span class="sc">/</span>gt_diameter_m</span>
<span id="cb227-100"><a href="chm_sens_test.html#cb227-100" tabindex="-1"></a>        )</span>
<span id="cb227-101"><a href="chm_sens_test.html#cb227-101" tabindex="-1"></a>      <span class="do">#######################################</span></span>
<span id="cb227-102"><a href="chm_sens_test.html#cb227-102" tabindex="-1"></a>      <span class="co"># aggregate results from ground_truth_prediction_match()</span></span>
<span id="cb227-103"><a href="chm_sens_test.html#cb227-103" tabindex="-1"></a>      <span class="do">#######################################</span></span>
<span id="cb227-104"><a href="chm_sens_test.html#cb227-104" tabindex="-1"></a>      param_combos_gt_agg <span class="ot">&lt;-</span> <span class="fu">unique</span>(param_combos_gt<span class="sc">$</span>rn) <span class="sc">%&gt;%</span> </span>
<span id="cb227-105"><a href="chm_sens_test.html#cb227-105" tabindex="-1"></a>        purrr<span class="sc">::</span><span class="fu">map</span>(\(x)</span>
<span id="cb227-106"><a href="chm_sens_test.html#cb227-106" tabindex="-1"></a>          <span class="fu">agg_ground_truth_match</span>(</span>
<span id="cb227-107"><a href="chm_sens_test.html#cb227-107" tabindex="-1"></a>            param_combos_gt <span class="sc">%&gt;%</span> </span>
<span id="cb227-108"><a href="chm_sens_test.html#cb227-108" tabindex="-1"></a>              dplyr<span class="sc">::</span><span class="fu">filter</span>(</span>
<span id="cb227-109"><a href="chm_sens_test.html#cb227-109" tabindex="-1"></a>                is_in_stand</span>
<span id="cb227-110"><a href="chm_sens_test.html#cb227-110" tabindex="-1"></a>                <span class="sc">&amp;</span> rn <span class="sc">==</span> x</span>
<span id="cb227-111"><a href="chm_sens_test.html#cb227-111" tabindex="-1"></a>              )</span>
<span id="cb227-112"><a href="chm_sens_test.html#cb227-112" tabindex="-1"></a>          ) <span class="sc">%&gt;%</span> </span>
<span id="cb227-113"><a href="chm_sens_test.html#cb227-113" tabindex="-1"></a>          dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">rn =</span> x) <span class="sc">%&gt;%</span> </span>
<span id="cb227-114"><a href="chm_sens_test.html#cb227-114" tabindex="-1"></a>          dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">!</span>tidyselect<span class="sc">::</span><span class="fu">starts_with</span>(<span class="st">&quot;gt_&quot;</span>))</span>
<span id="cb227-115"><a href="chm_sens_test.html#cb227-115" tabindex="-1"></a>        ) <span class="sc">%&gt;%</span> </span>
<span id="cb227-116"><a href="chm_sens_test.html#cb227-116" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">bind_rows</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb227-117"><a href="chm_sens_test.html#cb227-117" tabindex="-1"></a>        <span class="co"># add in info on all parameter combinations</span></span>
<span id="cb227-118"><a href="chm_sens_test.html#cb227-118" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">inner_join</span>(</span>
<span id="cb227-119"><a href="chm_sens_test.html#cb227-119" tabindex="-1"></a>          param_combos_piles <span class="sc">%&gt;%</span> </span>
<span id="cb227-120"><a href="chm_sens_test.html#cb227-120" tabindex="-1"></a>          sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb227-121"><a href="chm_sens_test.html#cb227-121" tabindex="-1"></a>          dplyr<span class="sc">::</span><span class="fu">distinct</span>(</span>
<span id="cb227-122"><a href="chm_sens_test.html#cb227-122" tabindex="-1"></a>            rn,max_ht_m,min_area_m2,max_area_m2,convexity_pct,circle_fit_iou_pct</span>
<span id="cb227-123"><a href="chm_sens_test.html#cb227-123" tabindex="-1"></a>          )</span>
<span id="cb227-124"><a href="chm_sens_test.html#cb227-124" tabindex="-1"></a>          , <span class="at">by =</span> <span class="st">&quot;rn&quot;</span></span>
<span id="cb227-125"><a href="chm_sens_test.html#cb227-125" tabindex="-1"></a>          , <span class="at">relationship =</span> <span class="st">&quot;one-to-one&quot;</span></span>
<span id="cb227-126"><a href="chm_sens_test.html#cb227-126" tabindex="-1"></a>        )</span>
<span id="cb227-127"><a href="chm_sens_test.html#cb227-127" tabindex="-1"></a>      <span class="co"># write it</span></span>
<span id="cb227-128"><a href="chm_sens_test.html#cb227-128" tabindex="-1"></a>      param_combos_gt_agg <span class="sc">%&gt;%</span> readr<span class="sc">::</span><span class="fu">write_csv</span>(f_temp, <span class="at">append =</span> F, <span class="at">progress =</span> F)</span>
<span id="cb227-129"><a href="chm_sens_test.html#cb227-129" tabindex="-1"></a>      <span class="fu">return</span>(f_temp)</span>
<span id="cb227-130"><a href="chm_sens_test.html#cb227-130" tabindex="-1"></a>    }<span class="cf">else</span> <span class="cf">if</span>(<span class="fu">file.exists</span>(f_temp)){</span>
<span id="cb227-131"><a href="chm_sens_test.html#cb227-131" tabindex="-1"></a>      <span class="fu">return</span>(f_temp)</span>
<span id="cb227-132"><a href="chm_sens_test.html#cb227-132" tabindex="-1"></a>    }<span class="cf">else</span>{</span>
<span id="cb227-133"><a href="chm_sens_test.html#cb227-133" tabindex="-1"></a>      <span class="fu">return</span>(<span class="cn">NULL</span>)</span>
<span id="cb227-134"><a href="chm_sens_test.html#cb227-134" tabindex="-1"></a>    }</span>
<span id="cb227-135"><a href="chm_sens_test.html#cb227-135" tabindex="-1"></a>  })</span>
<span id="cb227-136"><a href="chm_sens_test.html#cb227-136" tabindex="-1"></a><span class="co"># which successes?</span></span>
<span id="cb227-137"><a href="chm_sens_test.html#cb227-137" tabindex="-1"></a>param_combos_gt_agg_flist</span></code></pre></div>
</div>
</div>
<div id="data-fusion-parameter-testing" class="section level2 hasAnchor" number="8.3">
<h2><span class="header-section-number">8.3</span> Data Fusion: Parameter Testing<a href="chm_sens_test.html#data-fusion-parameter-testing" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We also reviewed a <a href="data_fusion.html#data_fusion">data fusion approach</a> that uses both a CHM generated from aerial point cloud data (for structural information) and RGB imagery, whereby initial candidate slash piles are first identified based on their structural form and then, filtered spectrally using the RGB imagery. We created a <a href="data_fusion.html#polygon_spectral_filtering">process</a> to perform this filtering which takes as input: 1) a spatial data frame of candidate polygons; 2) a raster with RGB spectral data; 3) user-defined spectral weighting (voting system). let’s apply that process to the candidate piles detected using the structural data only from the prior section.</p>
<div class="sourceCode" id="cb228"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb228-1"><a href="chm_sens_test.html#cb228-1" tabindex="-1"></a>param_combos_spectral_gt_flist <span class="ot">&lt;-</span> chm_res_list <span class="sc">%&gt;%</span> </span>
<span id="cb228-2"><a href="chm_sens_test.html#cb228-2" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">map</span>(<span class="cf">function</span>(chm_res_m){</span>
<span id="cb228-3"><a href="chm_sens_test.html#cb228-3" tabindex="-1"></a>    <span class="fu">message</span>(<span class="fu">paste0</span>(<span class="st">&quot;param_combos_spectral_gt...........&quot;</span>,chm_res_m))</span>
<span id="cb228-4"><a href="chm_sens_test.html#cb228-4" tabindex="-1"></a>    <span class="co"># param_combos_piles file</span></span>
<span id="cb228-5"><a href="chm_sens_test.html#cb228-5" tabindex="-1"></a>    param_combos_piles_fnm <span class="ot">&lt;-</span> param_combos_piles_flist <span class="sc">%&gt;%</span> stringr<span class="sc">::</span><span class="fu">str_subset</span>(<span class="at">pattern =</span> <span class="fu">paste0</span>(<span class="st">&quot;chm&quot;</span>,chm_res_m,<span class="st">&quot;m.gpkg&quot;</span>)) <span class="sc">%&gt;%</span> purrr<span class="sc">::</span><span class="fu">pluck</span>(<span class="dv">1</span>)</span>
<span id="cb228-6"><a href="chm_sens_test.html#cb228-6" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">is.null</span>(param_combos_piles_fnm) <span class="sc">||</span> <span class="sc">!</span><span class="fu">file.exists</span>(param_combos_piles_fnm)){<span class="fu">return</span>(<span class="cn">NULL</span>)}</span>
<span id="cb228-7"><a href="chm_sens_test.html#cb228-7" tabindex="-1"></a>    <span class="co"># param_combos_gt file</span></span>
<span id="cb228-8"><a href="chm_sens_test.html#cb228-8" tabindex="-1"></a>    param_combos_gt_fnm <span class="ot">&lt;-</span> param_combos_gt_flist <span class="sc">%&gt;%</span> stringr<span class="sc">::</span><span class="fu">str_subset</span>(<span class="at">pattern =</span> <span class="fu">paste0</span>(<span class="st">&quot;chm&quot;</span>,chm_res_m,<span class="st">&quot;m.csv&quot;</span>)) <span class="sc">%&gt;%</span> purrr<span class="sc">::</span><span class="fu">pluck</span>(<span class="dv">1</span>)</span>
<span id="cb228-9"><a href="chm_sens_test.html#cb228-9" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">is.null</span>(param_combos_gt_fnm) <span class="sc">||</span> <span class="sc">!</span><span class="fu">file.exists</span>(param_combos_gt_fnm)){<span class="fu">return</span>(<span class="cn">NULL</span>)}</span>
<span id="cb228-10"><a href="chm_sens_test.html#cb228-10" tabindex="-1"></a>    <span class="co"># file creating now</span></span>
<span id="cb228-11"><a href="chm_sens_test.html#cb228-11" tabindex="-1"></a>    f_temp <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">&quot;../data&quot;</span>,<span class="fu">paste0</span>(<span class="st">&quot;param_combos_spectral_gt_chm&quot;</span>,chm_res_m,<span class="st">&quot;m.csv&quot;</span>))</span>
<span id="cb228-12"><a href="chm_sens_test.html#cb228-12" tabindex="-1"></a>    <span class="co"># check and do it</span></span>
<span id="cb228-13"><a href="chm_sens_test.html#cb228-13" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(f_temp)){</span>
<span id="cb228-14"><a href="chm_sens_test.html#cb228-14" tabindex="-1"></a>      <span class="co"># read param_combos_piles</span></span>
<span id="cb228-15"><a href="chm_sens_test.html#cb228-15" tabindex="-1"></a>      param_combos_piles <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_read</span>(param_combos_piles_fnm)</span>
<span id="cb228-16"><a href="chm_sens_test.html#cb228-16" tabindex="-1"></a>      <span class="co"># read param_combos_piles</span></span>
<span id="cb228-17"><a href="chm_sens_test.html#cb228-17" tabindex="-1"></a>      param_combos_gt <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(param_combos_gt_fnm)</span>
<span id="cb228-18"><a href="chm_sens_test.html#cb228-18" tabindex="-1"></a>      </span>
<span id="cb228-19"><a href="chm_sens_test.html#cb228-19" tabindex="-1"></a>      <span class="do">#######################################</span></span>
<span id="cb228-20"><a href="chm_sens_test.html#cb228-20" tabindex="-1"></a>      <span class="co"># let&#39;s attach a flag to only work with piles that intersect with the stand boundary</span></span>
<span id="cb228-21"><a href="chm_sens_test.html#cb228-21" tabindex="-1"></a>      <span class="co"># add in/out to piles data</span></span>
<span id="cb228-22"><a href="chm_sens_test.html#cb228-22" tabindex="-1"></a>      <span class="do">#######################################</span></span>
<span id="cb228-23"><a href="chm_sens_test.html#cb228-23" tabindex="-1"></a>      param_combos_spectral_gt <span class="ot">&lt;-</span> </span>
<span id="cb228-24"><a href="chm_sens_test.html#cb228-24" tabindex="-1"></a>        <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>) <span class="sc">%&gt;%</span></span>
<span id="cb228-25"><a href="chm_sens_test.html#cb228-25" tabindex="-1"></a>        purrr<span class="sc">::</span><span class="fu">map</span>(<span class="cf">function</span>(sw){</span>
<span id="cb228-26"><a href="chm_sens_test.html#cb228-26" tabindex="-1"></a>          <span class="co"># polygon_spectral_filtering</span></span>
<span id="cb228-27"><a href="chm_sens_test.html#cb228-27" tabindex="-1"></a>          param_combos_piles_filtered <span class="ot">&lt;-</span> <span class="fu">polygon_spectral_filtering</span>(</span>
<span id="cb228-28"><a href="chm_sens_test.html#cb228-28" tabindex="-1"></a>              <span class="at">sf_data =</span> param_combos_piles</span>
<span id="cb228-29"><a href="chm_sens_test.html#cb228-29" tabindex="-1"></a>              , <span class="at">rgb_rast =</span> ortho_rast</span>
<span id="cb228-30"><a href="chm_sens_test.html#cb228-30" tabindex="-1"></a>              , <span class="at">red_band_idx =</span> <span class="dv">1</span></span>
<span id="cb228-31"><a href="chm_sens_test.html#cb228-31" tabindex="-1"></a>              , <span class="at">green_band_idx =</span> <span class="dv">2</span></span>
<span id="cb228-32"><a href="chm_sens_test.html#cb228-32" tabindex="-1"></a>              , <span class="at">blue_band_idx =</span> <span class="dv">3</span></span>
<span id="cb228-33"><a href="chm_sens_test.html#cb228-33" tabindex="-1"></a>              , <span class="at">spectral_weight =</span> sw</span>
<span id="cb228-34"><a href="chm_sens_test.html#cb228-34" tabindex="-1"></a>            ) <span class="sc">%&gt;%</span></span>
<span id="cb228-35"><a href="chm_sens_test.html#cb228-35" tabindex="-1"></a>            dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">spectral_weight=</span>sw)</span>
<span id="cb228-36"><a href="chm_sens_test.html#cb228-36" tabindex="-1"></a>          </span>
<span id="cb228-37"><a href="chm_sens_test.html#cb228-37" tabindex="-1"></a>          <span class="co"># dplyr::glimpse(param_combos_piles_filtered)</span></span>
<span id="cb228-38"><a href="chm_sens_test.html#cb228-38" tabindex="-1"></a>          <span class="co"># param_combos_piles_filtered %&gt;% sf::st_drop_geometry() %&gt;% dplyr::count(rn) %&gt;%  </span></span>
<span id="cb228-39"><a href="chm_sens_test.html#cb228-39" tabindex="-1"></a>          <span class="co">#   dplyr::inner_join(</span></span>
<span id="cb228-40"><a href="chm_sens_test.html#cb228-40" tabindex="-1"></a>          <span class="co">#     param_combos_piles %&gt;% sf::st_drop_geometry() %&gt;% dplyr::count(rn) %&gt;% dplyr::rename(orig_n=n)</span></span>
<span id="cb228-41"><a href="chm_sens_test.html#cb228-41" tabindex="-1"></a>          <span class="co">#   ) %&gt;% </span></span>
<span id="cb228-42"><a href="chm_sens_test.html#cb228-42" tabindex="-1"></a>          <span class="co">#   dplyr::arrange(desc(orig_n-n))</span></span>
<span id="cb228-43"><a href="chm_sens_test.html#cb228-43" tabindex="-1"></a>          </span>
<span id="cb228-44"><a href="chm_sens_test.html#cb228-44" tabindex="-1"></a>          <span class="co"># now we need to reclassify the combinations against the ground truth data</span></span>
<span id="cb228-45"><a href="chm_sens_test.html#cb228-45" tabindex="-1"></a>          gt_reclassify <span class="ot">&lt;-</span></span>
<span id="cb228-46"><a href="chm_sens_test.html#cb228-46" tabindex="-1"></a>            param_combos_gt <span class="sc">%&gt;%</span> </span>
<span id="cb228-47"><a href="chm_sens_test.html#cb228-47" tabindex="-1"></a>              <span class="co"># add info from predictions</span></span>
<span id="cb228-48"><a href="chm_sens_test.html#cb228-48" tabindex="-1"></a>              dplyr<span class="sc">::</span><span class="fu">left_join</span>(</span>
<span id="cb228-49"><a href="chm_sens_test.html#cb228-49" tabindex="-1"></a>                param_combos_piles_filtered <span class="sc">%&gt;%</span></span>
<span id="cb228-50"><a href="chm_sens_test.html#cb228-50" tabindex="-1"></a>                  sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span></span>
<span id="cb228-51"><a href="chm_sens_test.html#cb228-51" tabindex="-1"></a>                  dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb228-52"><a href="chm_sens_test.html#cb228-52" tabindex="-1"></a>                    rn,pred_id,spectral_weight</span>
<span id="cb228-53"><a href="chm_sens_test.html#cb228-53" tabindex="-1"></a>                  )</span>
<span id="cb228-54"><a href="chm_sens_test.html#cb228-54" tabindex="-1"></a>                , <span class="at">by =</span> dplyr<span class="sc">::</span><span class="fu">join_by</span>(rn,pred_id)</span>
<span id="cb228-55"><a href="chm_sens_test.html#cb228-55" tabindex="-1"></a>              ) <span class="sc">%&gt;%</span></span>
<span id="cb228-56"><a href="chm_sens_test.html#cb228-56" tabindex="-1"></a>              <span class="co"># dplyr::count(match_grp)</span></span>
<span id="cb228-57"><a href="chm_sens_test.html#cb228-57" tabindex="-1"></a>              <span class="co"># reclassify</span></span>
<span id="cb228-58"><a href="chm_sens_test.html#cb228-58" tabindex="-1"></a>              dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb228-59"><a href="chm_sens_test.html#cb228-59" tabindex="-1"></a>                <span class="co"># reclassify match_grp</span></span>
<span id="cb228-60"><a href="chm_sens_test.html#cb228-60" tabindex="-1"></a>                <span class="at">match_grp =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb228-61"><a href="chm_sens_test.html#cb228-61" tabindex="-1"></a>                  match_grp <span class="sc">==</span> <span class="st">&quot;true positive&quot;</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(spectral_weight) <span class="sc">~</span> <span class="st">&quot;omission&quot;</span> <span class="co"># is.na(spectral_weight) =&gt; removed by spectral filtering</span></span>
<span id="cb228-62"><a href="chm_sens_test.html#cb228-62" tabindex="-1"></a>                  , match_grp <span class="sc">==</span> <span class="st">&quot;commission&quot;</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(spectral_weight) <span class="sc">~</span> <span class="st">&quot;remove&quot;</span> <span class="co"># is.na(spectral_weight) =&gt; removed by spectral filtering</span></span>
<span id="cb228-63"><a href="chm_sens_test.html#cb228-63" tabindex="-1"></a>                  , T <span class="sc">~</span> match_grp</span>
<span id="cb228-64"><a href="chm_sens_test.html#cb228-64" tabindex="-1"></a>                )</span>
<span id="cb228-65"><a href="chm_sens_test.html#cb228-65" tabindex="-1"></a>                <span class="co"># update pred_id</span></span>
<span id="cb228-66"><a href="chm_sens_test.html#cb228-66" tabindex="-1"></a>                , <span class="at">pred_id =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb228-67"><a href="chm_sens_test.html#cb228-67" tabindex="-1"></a>                  match_grp <span class="sc">==</span> <span class="st">&quot;omission&quot;</span> <span class="sc">~</span> <span class="cn">NA</span></span>
<span id="cb228-68"><a href="chm_sens_test.html#cb228-68" tabindex="-1"></a>                  , T <span class="sc">~</span> pred_id</span>
<span id="cb228-69"><a href="chm_sens_test.html#cb228-69" tabindex="-1"></a>                )</span>
<span id="cb228-70"><a href="chm_sens_test.html#cb228-70" tabindex="-1"></a>                <span class="co"># update spectral_weight (just adds it to this iteration&#39;s omissions)</span></span>
<span id="cb228-71"><a href="chm_sens_test.html#cb228-71" tabindex="-1"></a>                , <span class="at">spectral_weight =</span> sw</span>
<span id="cb228-72"><a href="chm_sens_test.html#cb228-72" tabindex="-1"></a>              ) <span class="sc">%&gt;%</span> </span>
<span id="cb228-73"><a href="chm_sens_test.html#cb228-73" tabindex="-1"></a>              <span class="co"># remove old commissions</span></span>
<span id="cb228-74"><a href="chm_sens_test.html#cb228-74" tabindex="-1"></a>              <span class="co"># dplyr::count(match_grp)</span></span>
<span id="cb228-75"><a href="chm_sens_test.html#cb228-75" tabindex="-1"></a>              dplyr<span class="sc">::</span><span class="fu">filter</span>(match_grp<span class="sc">!=</span><span class="st">&quot;remove&quot;</span>)</span>
<span id="cb228-76"><a href="chm_sens_test.html#cb228-76" tabindex="-1"></a>          <span class="co"># return</span></span>
<span id="cb228-77"><a href="chm_sens_test.html#cb228-77" tabindex="-1"></a>          <span class="fu">return</span>(gt_reclassify)</span>
<span id="cb228-78"><a href="chm_sens_test.html#cb228-78" tabindex="-1"></a>        }) <span class="sc">%&gt;%</span> </span>
<span id="cb228-79"><a href="chm_sens_test.html#cb228-79" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">bind_rows</span>()</span>
<span id="cb228-80"><a href="chm_sens_test.html#cb228-80" tabindex="-1"></a>      </span>
<span id="cb228-81"><a href="chm_sens_test.html#cb228-81" tabindex="-1"></a>      <span class="co"># write it</span></span>
<span id="cb228-82"><a href="chm_sens_test.html#cb228-82" tabindex="-1"></a>      param_combos_spectral_gt <span class="sc">%&gt;%</span> readr<span class="sc">::</span><span class="fu">write_csv</span>(f_temp, <span class="at">append =</span> F, <span class="at">progress =</span> F)</span>
<span id="cb228-83"><a href="chm_sens_test.html#cb228-83" tabindex="-1"></a>      <span class="fu">return</span>(f_temp)</span>
<span id="cb228-84"><a href="chm_sens_test.html#cb228-84" tabindex="-1"></a>    }<span class="cf">else</span> <span class="cf">if</span>(<span class="fu">file.exists</span>(f_temp)){</span>
<span id="cb228-85"><a href="chm_sens_test.html#cb228-85" tabindex="-1"></a>      <span class="fu">return</span>(f_temp)</span>
<span id="cb228-86"><a href="chm_sens_test.html#cb228-86" tabindex="-1"></a>    }<span class="cf">else</span>{</span>
<span id="cb228-87"><a href="chm_sens_test.html#cb228-87" tabindex="-1"></a>      <span class="fu">return</span>(<span class="cn">NULL</span>)</span>
<span id="cb228-88"><a href="chm_sens_test.html#cb228-88" tabindex="-1"></a>    }</span>
<span id="cb228-89"><a href="chm_sens_test.html#cb228-89" tabindex="-1"></a>  })</span>
<span id="cb228-90"><a href="chm_sens_test.html#cb228-90" tabindex="-1"></a><span class="co"># which successes?</span></span>
<span id="cb228-91"><a href="chm_sens_test.html#cb228-91" tabindex="-1"></a>param_combos_spectral_gt_flist</span></code></pre></div>
<div id="aggregate-validation-metrics-to-parameter-combination-1" class="section level3 hasAnchor" number="8.3.1">
<h3><span class="header-section-number">8.3.1</span> Aggregate Validation Metrics to Parameter Combination<a href="chm_sens_test.html#aggregate-validation-metrics-to-parameter-combination-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>now we’re going to calculate aggregated detection accuracy metrics and quantification accuracy metrics</p>
<div class="sourceCode" id="cb229"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb229-1"><a href="chm_sens_test.html#cb229-1" tabindex="-1"></a>param_combos_spectral_gt_agg_flist <span class="ot">&lt;-</span> chm_res_list <span class="sc">%&gt;%</span> </span>
<span id="cb229-2"><a href="chm_sens_test.html#cb229-2" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">map</span>(<span class="cf">function</span>(chm_res_m){</span>
<span id="cb229-3"><a href="chm_sens_test.html#cb229-3" tabindex="-1"></a>    <span class="fu">message</span>(<span class="fu">paste0</span>(<span class="st">&quot;param_combos_spectral_gt_agg...........&quot;</span>,chm_res_m))</span>
<span id="cb229-4"><a href="chm_sens_test.html#cb229-4" tabindex="-1"></a>    <span class="co"># param_combos_piles file</span></span>
<span id="cb229-5"><a href="chm_sens_test.html#cb229-5" tabindex="-1"></a>    param_combos_piles_fnm <span class="ot">&lt;-</span> param_combos_piles_flist <span class="sc">%&gt;%</span> stringr<span class="sc">::</span><span class="fu">str_subset</span>(<span class="at">pattern =</span> <span class="fu">paste0</span>(<span class="st">&quot;chm&quot;</span>,chm_res_m,<span class="st">&quot;m.gpkg&quot;</span>)) <span class="sc">%&gt;%</span> purrr<span class="sc">::</span><span class="fu">pluck</span>(<span class="dv">1</span>)</span>
<span id="cb229-6"><a href="chm_sens_test.html#cb229-6" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">is.null</span>(param_combos_piles_fnm) <span class="sc">||</span> <span class="sc">!</span><span class="fu">file.exists</span>(param_combos_piles_fnm)){<span class="fu">return</span>(<span class="cn">NULL</span>)}</span>
<span id="cb229-7"><a href="chm_sens_test.html#cb229-7" tabindex="-1"></a>    <span class="co"># param_combos_gt file</span></span>
<span id="cb229-8"><a href="chm_sens_test.html#cb229-8" tabindex="-1"></a>    param_combos_gt_fnm <span class="ot">&lt;-</span> param_combos_gt_flist <span class="sc">%&gt;%</span> stringr<span class="sc">::</span><span class="fu">str_subset</span>(<span class="at">pattern =</span> <span class="fu">paste0</span>(<span class="st">&quot;chm&quot;</span>,chm_res_m,<span class="st">&quot;m.csv&quot;</span>)) <span class="sc">%&gt;%</span> purrr<span class="sc">::</span><span class="fu">pluck</span>(<span class="dv">1</span>)</span>
<span id="cb229-9"><a href="chm_sens_test.html#cb229-9" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">is.null</span>(param_combos_gt_fnm) <span class="sc">||</span> <span class="sc">!</span><span class="fu">file.exists</span>(param_combos_gt_fnm)){<span class="fu">return</span>(<span class="cn">NULL</span>)}</span>
<span id="cb229-10"><a href="chm_sens_test.html#cb229-10" tabindex="-1"></a>    <span class="co"># param_combos_spectral_gt_flist file</span></span>
<span id="cb229-11"><a href="chm_sens_test.html#cb229-11" tabindex="-1"></a>    param_combos_spectral_gt_fnm <span class="ot">&lt;-</span> param_combos_spectral_gt_flist <span class="sc">%&gt;%</span> stringr<span class="sc">::</span><span class="fu">str_subset</span>(<span class="at">pattern =</span> <span class="fu">paste0</span>(<span class="st">&quot;chm&quot;</span>,chm_res_m,<span class="st">&quot;m.csv&quot;</span>)) <span class="sc">%&gt;%</span> purrr<span class="sc">::</span><span class="fu">pluck</span>(<span class="dv">1</span>)</span>
<span id="cb229-12"><a href="chm_sens_test.html#cb229-12" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">is.null</span>(param_combos_spectral_gt_fnm) <span class="sc">||</span> <span class="sc">!</span><span class="fu">file.exists</span>(param_combos_spectral_gt_fnm)){<span class="fu">return</span>(<span class="cn">NULL</span>)}</span>
<span id="cb229-13"><a href="chm_sens_test.html#cb229-13" tabindex="-1"></a>    <span class="co"># file creating now</span></span>
<span id="cb229-14"><a href="chm_sens_test.html#cb229-14" tabindex="-1"></a>    f_temp <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">&quot;../data&quot;</span>,<span class="fu">paste0</span>(<span class="st">&quot;param_combos_spectral_gt_agg_chm&quot;</span>,chm_res_m,<span class="st">&quot;m.csv&quot;</span>))</span>
<span id="cb229-15"><a href="chm_sens_test.html#cb229-15" tabindex="-1"></a>    <span class="co"># check and do it</span></span>
<span id="cb229-16"><a href="chm_sens_test.html#cb229-16" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(f_temp)){</span>
<span id="cb229-17"><a href="chm_sens_test.html#cb229-17" tabindex="-1"></a>      <span class="co"># read param_combos_piles</span></span>
<span id="cb229-18"><a href="chm_sens_test.html#cb229-18" tabindex="-1"></a>      param_combos_piles <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_read</span>(param_combos_piles_fnm)</span>
<span id="cb229-19"><a href="chm_sens_test.html#cb229-19" tabindex="-1"></a>      <span class="co"># read param_combos_gt</span></span>
<span id="cb229-20"><a href="chm_sens_test.html#cb229-20" tabindex="-1"></a>      param_combos_gt <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(param_combos_gt_fnm)</span>
<span id="cb229-21"><a href="chm_sens_test.html#cb229-21" tabindex="-1"></a>      <span class="co"># read param_combos_spectral_gt</span></span>
<span id="cb229-22"><a href="chm_sens_test.html#cb229-22" tabindex="-1"></a>      param_combos_spectral_gt <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(param_combos_spectral_gt_fnm)</span>
<span id="cb229-23"><a href="chm_sens_test.html#cb229-23" tabindex="-1"></a>      </span>
<span id="cb229-24"><a href="chm_sens_test.html#cb229-24" tabindex="-1"></a>      <span class="do">#######################################</span></span>
<span id="cb229-25"><a href="chm_sens_test.html#cb229-25" tabindex="-1"></a>      <span class="co"># let&#39;s attach a flag to only work with piles that intersect with the stand boundary</span></span>
<span id="cb229-26"><a href="chm_sens_test.html#cb229-26" tabindex="-1"></a>      <span class="co"># add in/out to piles data</span></span>
<span id="cb229-27"><a href="chm_sens_test.html#cb229-27" tabindex="-1"></a>      <span class="do">#######################################</span></span>
<span id="cb229-28"><a href="chm_sens_test.html#cb229-28" tabindex="-1"></a>      param_combos_piles <span class="ot">&lt;-</span> param_combos_piles <span class="sc">%&gt;%</span> </span>
<span id="cb229-29"><a href="chm_sens_test.html#cb229-29" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">left_join</span>(</span>
<span id="cb229-30"><a href="chm_sens_test.html#cb229-30" tabindex="-1"></a>          param_combos_piles <span class="sc">%&gt;%</span> </span>
<span id="cb229-31"><a href="chm_sens_test.html#cb229-31" tabindex="-1"></a>            sf<span class="sc">::</span><span class="fu">st_intersection</span>(</span>
<span id="cb229-32"><a href="chm_sens_test.html#cb229-32" tabindex="-1"></a>              stand_boundary <span class="sc">%&gt;%</span> </span>
<span id="cb229-33"><a href="chm_sens_test.html#cb229-33" tabindex="-1"></a>                sf<span class="sc">::</span><span class="fu">st_transform</span>(sf<span class="sc">::</span><span class="fu">st_crs</span>(param_combos_piles))</span>
<span id="cb229-34"><a href="chm_sens_test.html#cb229-34" tabindex="-1"></a>            ) <span class="sc">%&gt;%</span> </span>
<span id="cb229-35"><a href="chm_sens_test.html#cb229-35" tabindex="-1"></a>            sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb229-36"><a href="chm_sens_test.html#cb229-36" tabindex="-1"></a>            dplyr<span class="sc">::</span><span class="fu">select</span>(rn,pred_id) <span class="sc">%&gt;%</span> </span>
<span id="cb229-37"><a href="chm_sens_test.html#cb229-37" tabindex="-1"></a>            dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">is_in_stand =</span> T)</span>
<span id="cb229-38"><a href="chm_sens_test.html#cb229-38" tabindex="-1"></a>          , <span class="at">by =</span> dplyr<span class="sc">::</span><span class="fu">join_by</span>(rn,pred_id)</span>
<span id="cb229-39"><a href="chm_sens_test.html#cb229-39" tabindex="-1"></a>        ) <span class="sc">%&gt;%</span> </span>
<span id="cb229-40"><a href="chm_sens_test.html#cb229-40" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb229-41"><a href="chm_sens_test.html#cb229-41" tabindex="-1"></a>          <span class="at">is_in_stand =</span> dplyr<span class="sc">::</span><span class="fu">coalesce</span>(is_in_stand,F)</span>
<span id="cb229-42"><a href="chm_sens_test.html#cb229-42" tabindex="-1"></a>        ) <span class="sc">%&gt;%</span> </span>
<span id="cb229-43"><a href="chm_sens_test.html#cb229-43" tabindex="-1"></a>        <span class="co"># # get the length (diameter) and width of the polygon</span></span>
<span id="cb229-44"><a href="chm_sens_test.html#cb229-44" tabindex="-1"></a>        <span class="co"># st_bbox_by_row(dimensions = T) %&gt;% # gets shape_length, where shape_length=length of longest bbox side</span></span>
<span id="cb229-45"><a href="chm_sens_test.html#cb229-45" tabindex="-1"></a>        <span class="co"># and paraboloid volume</span></span>
<span id="cb229-46"><a href="chm_sens_test.html#cb229-46" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb229-47"><a href="chm_sens_test.html#cb229-47" tabindex="-1"></a>          <span class="co"># paraboloid_volume_m3 = (1/8) * pi * (shape_length^2) * max_height_m</span></span>
<span id="cb229-48"><a href="chm_sens_test.html#cb229-48" tabindex="-1"></a>          <span class="at">paraboloid_volume_m3 =</span> (<span class="dv">1</span><span class="sc">/</span><span class="dv">8</span>) <span class="sc">*</span> pi <span class="sc">*</span> (diameter_m<span class="sc">^</span><span class="dv">2</span>) <span class="sc">*</span> max_height_m</span>
<span id="cb229-49"><a href="chm_sens_test.html#cb229-49" tabindex="-1"></a>        )</span>
<span id="cb229-50"><a href="chm_sens_test.html#cb229-50" tabindex="-1"></a>      <span class="co"># param_combos_piles %&gt;% dplyr::glimpse()</span></span>
<span id="cb229-51"><a href="chm_sens_test.html#cb229-51" tabindex="-1"></a>      <span class="do">#######################################</span></span>
<span id="cb229-52"><a href="chm_sens_test.html#cb229-52" tabindex="-1"></a>      <span class="co"># add data to validation</span></span>
<span id="cb229-53"><a href="chm_sens_test.html#cb229-53" tabindex="-1"></a>      <span class="do">#######################################</span></span>
<span id="cb229-54"><a href="chm_sens_test.html#cb229-54" tabindex="-1"></a>      <span class="co"># add it to validation</span></span>
<span id="cb229-55"><a href="chm_sens_test.html#cb229-55" tabindex="-1"></a>      param_combos_spectral_gt <span class="ot">&lt;-</span></span>
<span id="cb229-56"><a href="chm_sens_test.html#cb229-56" tabindex="-1"></a>        param_combos_spectral_gt <span class="sc">%&gt;%</span> </span>
<span id="cb229-57"><a href="chm_sens_test.html#cb229-57" tabindex="-1"></a>        <span class="co"># add original candidate piles from the structural watershed method with spectral_weight=0</span></span>
<span id="cb229-58"><a href="chm_sens_test.html#cb229-58" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(</span>
<span id="cb229-59"><a href="chm_sens_test.html#cb229-59" tabindex="-1"></a>          param_combos_gt <span class="sc">%&gt;%</span> </span>
<span id="cb229-60"><a href="chm_sens_test.html#cb229-60" tabindex="-1"></a>            dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">spectral_weight=</span><span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb229-61"><a href="chm_sens_test.html#cb229-61" tabindex="-1"></a>            dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">names</span>(param_combos_spectral_gt))</span>
<span id="cb229-62"><a href="chm_sens_test.html#cb229-62" tabindex="-1"></a>        ) <span class="sc">%&gt;%</span> </span>
<span id="cb229-63"><a href="chm_sens_test.html#cb229-63" tabindex="-1"></a>        <span class="co"># make a description of spectral_weight</span></span>
<span id="cb229-64"><a href="chm_sens_test.html#cb229-64" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb229-65"><a href="chm_sens_test.html#cb229-65" tabindex="-1"></a>          <span class="at">spectral_weight_desc =</span> <span class="fu">factor</span>(</span>
<span id="cb229-66"><a href="chm_sens_test.html#cb229-66" tabindex="-1"></a>            spectral_weight</span>
<span id="cb229-67"><a href="chm_sens_test.html#cb229-67" tabindex="-1"></a>            , <span class="at">ordered =</span> T</span>
<span id="cb229-68"><a href="chm_sens_test.html#cb229-68" tabindex="-1"></a>            , <span class="at">levels =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">5</span></span>
<span id="cb229-69"><a href="chm_sens_test.html#cb229-69" tabindex="-1"></a>            , <span class="at">labels =</span> <span class="fu">c</span>(</span>
<span id="cb229-70"><a href="chm_sens_test.html#cb229-70" tabindex="-1"></a>              <span class="st">&quot;no spectral criteria&quot;</span></span>
<span id="cb229-71"><a href="chm_sens_test.html#cb229-71" tabindex="-1"></a>              , <span class="st">&quot;1 spectral criteria req.&quot;</span></span>
<span id="cb229-72"><a href="chm_sens_test.html#cb229-72" tabindex="-1"></a>              , <span class="st">&quot;2 spectral criteria req.&quot;</span></span>
<span id="cb229-73"><a href="chm_sens_test.html#cb229-73" tabindex="-1"></a>              , <span class="st">&quot;3 spectral criteria req.&quot;</span></span>
<span id="cb229-74"><a href="chm_sens_test.html#cb229-74" tabindex="-1"></a>              , <span class="st">&quot;4 spectral criteria req.&quot;</span></span>
<span id="cb229-75"><a href="chm_sens_test.html#cb229-75" tabindex="-1"></a>              , <span class="st">&quot;5 spectral criteria req.&quot;</span></span>
<span id="cb229-76"><a href="chm_sens_test.html#cb229-76" tabindex="-1"></a>            )</span>
<span id="cb229-77"><a href="chm_sens_test.html#cb229-77" tabindex="-1"></a>          )</span>
<span id="cb229-78"><a href="chm_sens_test.html#cb229-78" tabindex="-1"></a>        ) <span class="sc">%&gt;%</span> </span>
<span id="cb229-79"><a href="chm_sens_test.html#cb229-79" tabindex="-1"></a>        <span class="co"># add area of gt</span></span>
<span id="cb229-80"><a href="chm_sens_test.html#cb229-80" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">left_join</span>(</span>
<span id="cb229-81"><a href="chm_sens_test.html#cb229-81" tabindex="-1"></a>          slash_piles_polys <span class="sc">%&gt;%</span> </span>
<span id="cb229-82"><a href="chm_sens_test.html#cb229-82" tabindex="-1"></a>            sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb229-83"><a href="chm_sens_test.html#cb229-83" tabindex="-1"></a>            dplyr<span class="sc">::</span><span class="fu">select</span>(pile_id,image_gt_area_m2,height_m,field_diameter_m) <span class="sc">%&gt;%</span> </span>
<span id="cb229-84"><a href="chm_sens_test.html#cb229-84" tabindex="-1"></a>            dplyr<span class="sc">::</span><span class="fu">rename</span>(</span>
<span id="cb229-85"><a href="chm_sens_test.html#cb229-85" tabindex="-1"></a>              <span class="at">gt_height_m =</span> height_m</span>
<span id="cb229-86"><a href="chm_sens_test.html#cb229-86" tabindex="-1"></a>              , <span class="at">gt_diameter_m =</span> field_diameter_m</span>
<span id="cb229-87"><a href="chm_sens_test.html#cb229-87" tabindex="-1"></a>              , <span class="at">gt_area_m2 =</span> image_gt_area_m2</span>
<span id="cb229-88"><a href="chm_sens_test.html#cb229-88" tabindex="-1"></a>            ) <span class="sc">%&gt;%</span> </span>
<span id="cb229-89"><a href="chm_sens_test.html#cb229-89" tabindex="-1"></a>            dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">pile_id=</span><span class="fu">as.numeric</span>(pile_id))</span>
<span id="cb229-90"><a href="chm_sens_test.html#cb229-90" tabindex="-1"></a>          , <span class="at">by =</span> <span class="st">&quot;pile_id&quot;</span></span>
<span id="cb229-91"><a href="chm_sens_test.html#cb229-91" tabindex="-1"></a>        ) <span class="sc">%&gt;%</span> </span>
<span id="cb229-92"><a href="chm_sens_test.html#cb229-92" tabindex="-1"></a>        <span class="co"># add info from predictions</span></span>
<span id="cb229-93"><a href="chm_sens_test.html#cb229-93" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">left_join</span>(</span>
<span id="cb229-94"><a href="chm_sens_test.html#cb229-94" tabindex="-1"></a>          param_combos_piles <span class="sc">%&gt;%</span></span>
<span id="cb229-95"><a href="chm_sens_test.html#cb229-95" tabindex="-1"></a>            sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span></span>
<span id="cb229-96"><a href="chm_sens_test.html#cb229-96" tabindex="-1"></a>            dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb229-97"><a href="chm_sens_test.html#cb229-97" tabindex="-1"></a>              rn,pred_id</span>
<span id="cb229-98"><a href="chm_sens_test.html#cb229-98" tabindex="-1"></a>              ,is_in_stand</span>
<span id="cb229-99"><a href="chm_sens_test.html#cb229-99" tabindex="-1"></a>              , area_m2, volume_m3, max_height_m, diameter_m</span>
<span id="cb229-100"><a href="chm_sens_test.html#cb229-100" tabindex="-1"></a>              , paraboloid_volume_m3</span>
<span id="cb229-101"><a href="chm_sens_test.html#cb229-101" tabindex="-1"></a>              <span class="co"># , shape_length # , shape_width</span></span>
<span id="cb229-102"><a href="chm_sens_test.html#cb229-102" tabindex="-1"></a>            ) <span class="sc">%&gt;%</span> </span>
<span id="cb229-103"><a href="chm_sens_test.html#cb229-103" tabindex="-1"></a>            dplyr<span class="sc">::</span><span class="fu">rename</span>(</span>
<span id="cb229-104"><a href="chm_sens_test.html#cb229-104" tabindex="-1"></a>              <span class="at">pred_area_m2 =</span> area_m2, <span class="at">pred_volume_m3 =</span> volume_m3</span>
<span id="cb229-105"><a href="chm_sens_test.html#cb229-105" tabindex="-1"></a>              , <span class="at">pred_height_m =</span> max_height_m, <span class="at">pred_diameter_m =</span> diameter_m</span>
<span id="cb229-106"><a href="chm_sens_test.html#cb229-106" tabindex="-1"></a>              , <span class="at">pred_paraboloid_volume_m3 =</span> paraboloid_volume_m3</span>
<span id="cb229-107"><a href="chm_sens_test.html#cb229-107" tabindex="-1"></a>            )</span>
<span id="cb229-108"><a href="chm_sens_test.html#cb229-108" tabindex="-1"></a>          , <span class="at">by =</span> dplyr<span class="sc">::</span><span class="fu">join_by</span>(rn,pred_id)</span>
<span id="cb229-109"><a href="chm_sens_test.html#cb229-109" tabindex="-1"></a>        ) <span class="sc">%&gt;%</span></span>
<span id="cb229-110"><a href="chm_sens_test.html#cb229-110" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb229-111"><a href="chm_sens_test.html#cb229-111" tabindex="-1"></a>          <span class="at">is_in_stand =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb229-112"><a href="chm_sens_test.html#cb229-112" tabindex="-1"></a>            is_in_stand <span class="sc">==</span> T <span class="sc">~</span> T</span>
<span id="cb229-113"><a href="chm_sens_test.html#cb229-113" tabindex="-1"></a>            , is_in_stand <span class="sc">==</span> F <span class="sc">~</span> F</span>
<span id="cb229-114"><a href="chm_sens_test.html#cb229-114" tabindex="-1"></a>            , match_grp <span class="sc">==</span> <span class="st">&quot;omission&quot;</span> <span class="sc">~</span> T</span>
<span id="cb229-115"><a href="chm_sens_test.html#cb229-115" tabindex="-1"></a>            , T <span class="sc">~</span> F</span>
<span id="cb229-116"><a href="chm_sens_test.html#cb229-116" tabindex="-1"></a>          )</span>
<span id="cb229-117"><a href="chm_sens_test.html#cb229-117" tabindex="-1"></a>          <span class="do">### calculate these based on the formulas below...agg_ground_truth_match() depends on those formulas</span></span>
<span id="cb229-118"><a href="chm_sens_test.html#cb229-118" tabindex="-1"></a>          <span class="co"># area_m2</span></span>
<span id="cb229-119"><a href="chm_sens_test.html#cb229-119" tabindex="-1"></a>          , <span class="at">diff_area_m2 =</span> pred_area_m2<span class="sc">-</span>gt_area_m2</span>
<span id="cb229-120"><a href="chm_sens_test.html#cb229-120" tabindex="-1"></a>          , <span class="at">pct_diff_area_m2 =</span> (gt_area_m2<span class="sc">-</span>pred_area_m2)<span class="sc">/</span>gt_area_m2</span>
<span id="cb229-121"><a href="chm_sens_test.html#cb229-121" tabindex="-1"></a>          <span class="co"># height_m</span></span>
<span id="cb229-122"><a href="chm_sens_test.html#cb229-122" tabindex="-1"></a>          , <span class="at">diff_height_m =</span> pred_height_m<span class="sc">-</span>gt_height_m</span>
<span id="cb229-123"><a href="chm_sens_test.html#cb229-123" tabindex="-1"></a>          , <span class="at">pct_diff_height_m =</span> (gt_height_m<span class="sc">-</span>pred_height_m)<span class="sc">/</span>gt_height_m</span>
<span id="cb229-124"><a href="chm_sens_test.html#cb229-124" tabindex="-1"></a>          <span class="co"># diameter_m</span></span>
<span id="cb229-125"><a href="chm_sens_test.html#cb229-125" tabindex="-1"></a>          , <span class="at">diff_diameter_m =</span> pred_diameter_m<span class="sc">-</span>gt_diameter_m</span>
<span id="cb229-126"><a href="chm_sens_test.html#cb229-126" tabindex="-1"></a>          , <span class="at">pct_diff_diameter_m =</span> (gt_diameter_m<span class="sc">-</span>pred_diameter_m)<span class="sc">/</span>gt_diameter_m</span>
<span id="cb229-127"><a href="chm_sens_test.html#cb229-127" tabindex="-1"></a>        )</span>
<span id="cb229-128"><a href="chm_sens_test.html#cb229-128" tabindex="-1"></a>      </span>
<span id="cb229-129"><a href="chm_sens_test.html#cb229-129" tabindex="-1"></a>      <span class="do">#######################################</span></span>
<span id="cb229-130"><a href="chm_sens_test.html#cb229-130" tabindex="-1"></a>      <span class="co"># aggregate results from ground_truth_prediction_match()</span></span>
<span id="cb229-131"><a href="chm_sens_test.html#cb229-131" tabindex="-1"></a>      <span class="do">#######################################</span></span>
<span id="cb229-132"><a href="chm_sens_test.html#cb229-132" tabindex="-1"></a>      <span class="co"># unique combinations</span></span>
<span id="cb229-133"><a href="chm_sens_test.html#cb229-133" tabindex="-1"></a>      combo_temp <span class="ot">&lt;-</span> param_combos_spectral_gt <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">distinct</span>(rn,spectral_weight)</span>
<span id="cb229-134"><a href="chm_sens_test.html#cb229-134" tabindex="-1"></a>      <span class="co"># aggregate results from ground_truth_prediction_match()</span></span>
<span id="cb229-135"><a href="chm_sens_test.html#cb229-135" tabindex="-1"></a>      param_combos_spectral_gt_agg <span class="ot">&lt;-</span> </span>
<span id="cb229-136"><a href="chm_sens_test.html#cb229-136" tabindex="-1"></a>        <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(combo_temp) <span class="sc">%&gt;%</span></span>
<span id="cb229-137"><a href="chm_sens_test.html#cb229-137" tabindex="-1"></a>        purrr<span class="sc">::</span><span class="fu">map</span>(\(x)</span>
<span id="cb229-138"><a href="chm_sens_test.html#cb229-138" tabindex="-1"></a>          <span class="fu">agg_ground_truth_match</span>(</span>
<span id="cb229-139"><a href="chm_sens_test.html#cb229-139" tabindex="-1"></a>            param_combos_spectral_gt <span class="sc">%&gt;%</span> </span>
<span id="cb229-140"><a href="chm_sens_test.html#cb229-140" tabindex="-1"></a>              dplyr<span class="sc">::</span><span class="fu">filter</span>(</span>
<span id="cb229-141"><a href="chm_sens_test.html#cb229-141" tabindex="-1"></a>                is_in_stand</span>
<span id="cb229-142"><a href="chm_sens_test.html#cb229-142" tabindex="-1"></a>                <span class="sc">&amp;</span> rn <span class="sc">==</span> combo_temp<span class="sc">$</span>rn[x]</span>
<span id="cb229-143"><a href="chm_sens_test.html#cb229-143" tabindex="-1"></a>                <span class="sc">&amp;</span> spectral_weight <span class="sc">==</span> combo_temp<span class="sc">$</span>spectral_weight[x]</span>
<span id="cb229-144"><a href="chm_sens_test.html#cb229-144" tabindex="-1"></a>              )</span>
<span id="cb229-145"><a href="chm_sens_test.html#cb229-145" tabindex="-1"></a>          ) <span class="sc">%&gt;%</span> </span>
<span id="cb229-146"><a href="chm_sens_test.html#cb229-146" tabindex="-1"></a>          dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb229-147"><a href="chm_sens_test.html#cb229-147" tabindex="-1"></a>            <span class="at">rn =</span> combo_temp<span class="sc">$</span>rn[x]</span>
<span id="cb229-148"><a href="chm_sens_test.html#cb229-148" tabindex="-1"></a>            , <span class="at">spectral_weight =</span> combo_temp<span class="sc">$</span>spectral_weight[x]</span>
<span id="cb229-149"><a href="chm_sens_test.html#cb229-149" tabindex="-1"></a>          ) <span class="sc">%&gt;%</span> </span>
<span id="cb229-150"><a href="chm_sens_test.html#cb229-150" tabindex="-1"></a>          dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">!</span>tidyselect<span class="sc">::</span><span class="fu">starts_with</span>(<span class="st">&quot;gt_&quot;</span>))</span>
<span id="cb229-151"><a href="chm_sens_test.html#cb229-151" tabindex="-1"></a>        ) <span class="sc">%&gt;%</span> </span>
<span id="cb229-152"><a href="chm_sens_test.html#cb229-152" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">bind_rows</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb229-153"><a href="chm_sens_test.html#cb229-153" tabindex="-1"></a>        <span class="co"># add in info on all parameter combinations</span></span>
<span id="cb229-154"><a href="chm_sens_test.html#cb229-154" tabindex="-1"></a>        <span class="co"># add in info on all parameter combinations</span></span>
<span id="cb229-155"><a href="chm_sens_test.html#cb229-155" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">inner_join</span>(</span>
<span id="cb229-156"><a href="chm_sens_test.html#cb229-156" tabindex="-1"></a>          param_combos_df</span>
<span id="cb229-157"><a href="chm_sens_test.html#cb229-157" tabindex="-1"></a>          , <span class="at">by =</span> <span class="st">&quot;rn&quot;</span></span>
<span id="cb229-158"><a href="chm_sens_test.html#cb229-158" tabindex="-1"></a>          , <span class="at">relationship =</span> <span class="st">&quot;many-to-one&quot;</span></span>
<span id="cb229-159"><a href="chm_sens_test.html#cb229-159" tabindex="-1"></a>        )</span>
<span id="cb229-160"><a href="chm_sens_test.html#cb229-160" tabindex="-1"></a>      <span class="co"># write it</span></span>
<span id="cb229-161"><a href="chm_sens_test.html#cb229-161" tabindex="-1"></a>      param_combos_spectral_gt_agg <span class="sc">%&gt;%</span> readr<span class="sc">::</span><span class="fu">write_csv</span>(f_temp, <span class="at">append =</span> F, <span class="at">progress =</span> F)</span>
<span id="cb229-162"><a href="chm_sens_test.html#cb229-162" tabindex="-1"></a>      <span class="fu">return</span>(f_temp)</span>
<span id="cb229-163"><a href="chm_sens_test.html#cb229-163" tabindex="-1"></a>    }<span class="cf">else</span> <span class="cf">if</span>(<span class="fu">file.exists</span>(f_temp)){</span>
<span id="cb229-164"><a href="chm_sens_test.html#cb229-164" tabindex="-1"></a>      <span class="fu">return</span>(f_temp)</span>
<span id="cb229-165"><a href="chm_sens_test.html#cb229-165" tabindex="-1"></a>    }<span class="cf">else</span>{</span>
<span id="cb229-166"><a href="chm_sens_test.html#cb229-166" tabindex="-1"></a>      <span class="fu">return</span>(<span class="cn">NULL</span>)</span>
<span id="cb229-167"><a href="chm_sens_test.html#cb229-167" tabindex="-1"></a>    }</span>
<span id="cb229-168"><a href="chm_sens_test.html#cb229-168" tabindex="-1"></a>  })</span>
<span id="cb229-169"><a href="chm_sens_test.html#cb229-169" tabindex="-1"></a><span class="co"># which successes?</span></span>
<span id="cb229-170"><a href="chm_sens_test.html#cb229-170" tabindex="-1"></a>param_combos_spectral_gt_agg_flist</span></code></pre></div>
</div>
</div>
<div id="read-data-for-analysis" class="section level2 hasAnchor" number="8.4">
<h2><span class="header-section-number">8.4</span> Read Data for Analysis<a href="chm_sens_test.html#read-data-for-analysis" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>let’s read this data in for analysis</p>
<div id="structural-only" class="section level3 hasAnchor" number="8.4.1">
<h3><span class="header-section-number">8.4.1</span> Structural Only<a href="chm_sens_test.html#structural-only" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb230"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb230-1"><a href="chm_sens_test.html#cb230-1" tabindex="-1"></a>param_combos_gt_agg <span class="ot">&lt;-</span> </span>
<span id="cb230-2"><a href="chm_sens_test.html#cb230-2" tabindex="-1"></a>  chm_res_list <span class="sc">%&gt;%</span> </span>
<span id="cb230-3"><a href="chm_sens_test.html#cb230-3" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">map</span>(<span class="cf">function</span>(chm_res_m){</span>
<span id="cb230-4"><a href="chm_sens_test.html#cb230-4" tabindex="-1"></a>    <span class="co"># param_combos_gt file</span></span>
<span id="cb230-5"><a href="chm_sens_test.html#cb230-5" tabindex="-1"></a>    fnm <span class="ot">&lt;-</span> param_combos_gt_agg_flist <span class="sc">%&gt;%</span> stringr<span class="sc">::</span><span class="fu">str_subset</span>(<span class="at">pattern =</span> <span class="fu">paste0</span>(<span class="st">&quot;chm&quot;</span>,chm_res_m,<span class="st">&quot;m.csv&quot;</span>)) <span class="sc">%&gt;%</span> purrr<span class="sc">::</span><span class="fu">pluck</span>(<span class="dv">1</span>)</span>
<span id="cb230-6"><a href="chm_sens_test.html#cb230-6" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">is.null</span>(fnm) <span class="sc">||</span> <span class="sc">!</span><span class="fu">file.exists</span>(fnm)){<span class="fu">return</span>(<span class="cn">NULL</span>)}</span>
<span id="cb230-7"><a href="chm_sens_test.html#cb230-7" tabindex="-1"></a>    <span class="co"># read it</span></span>
<span id="cb230-8"><a href="chm_sens_test.html#cb230-8" tabindex="-1"></a>    readr<span class="sc">::</span><span class="fu">read_csv</span>(fnm, <span class="at">progress =</span> F, <span class="at">show_col_types =</span> F) <span class="sc">%&gt;%</span> </span>
<span id="cb230-9"><a href="chm_sens_test.html#cb230-9" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">chm_res_m =</span> chm_res_m)</span>
<span id="cb230-10"><a href="chm_sens_test.html#cb230-10" tabindex="-1"></a>  }) <span class="sc">%&gt;%</span> </span>
<span id="cb230-11"><a href="chm_sens_test.html#cb230-11" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">bind_rows</span>()</span>
<span id="cb230-12"><a href="chm_sens_test.html#cb230-12" tabindex="-1"></a>  </span>
<span id="cb230-13"><a href="chm_sens_test.html#cb230-13" tabindex="-1"></a><span class="co"># add in combos that returned no results</span></span>
<span id="cb230-14"><a href="chm_sens_test.html#cb230-14" tabindex="-1"></a><span class="co"># param_combos_gt_agg %&gt;% dplyr::mutate(tot = tp_n + fn_n) %&gt;% dplyr::select(tot) %&gt;% summary()</span></span>
<span id="cb230-15"><a href="chm_sens_test.html#cb230-15" tabindex="-1"></a><span class="co"># (slash_piles_polys %&gt;% dplyr::filter(is_in_stand) %&gt;% nrow())</span></span>
<span id="cb230-16"><a href="chm_sens_test.html#cb230-16" tabindex="-1"></a>param_combos_gt_agg <span class="ot">&lt;-</span> param_combos_df <span class="sc">%&gt;%</span> </span>
<span id="cb230-17"><a href="chm_sens_test.html#cb230-17" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">crossing</span>(</span>
<span id="cb230-18"><a href="chm_sens_test.html#cb230-18" tabindex="-1"></a>    <span class="at">chm_res_m =</span> chm_res_list</span>
<span id="cb230-19"><a href="chm_sens_test.html#cb230-19" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb230-20"><a href="chm_sens_test.html#cb230-20" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(</span>
<span id="cb230-21"><a href="chm_sens_test.html#cb230-21" tabindex="-1"></a>   param_combos_gt_agg <span class="sc">%&gt;%</span> </span>
<span id="cb230-22"><a href="chm_sens_test.html#cb230-22" tabindex="-1"></a>    <span class="co"># throw in hey_xxxxxxxxxx to test it works if we include non-existant columns</span></span>
<span id="cb230-23"><a href="chm_sens_test.html#cb230-23" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>( <span class="sc">-</span>dplyr<span class="sc">::</span><span class="fu">any_of</span>(<span class="fu">c</span>(</span>
<span id="cb230-24"><a href="chm_sens_test.html#cb230-24" tabindex="-1"></a>      <span class="st">&quot;hey_xxxxxxxxxx&quot;</span></span>
<span id="cb230-25"><a href="chm_sens_test.html#cb230-25" tabindex="-1"></a>      , <span class="fu">names</span>(param_combos_df <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(rn)))</span>
<span id="cb230-26"><a href="chm_sens_test.html#cb230-26" tabindex="-1"></a>    )))</span>
<span id="cb230-27"><a href="chm_sens_test.html#cb230-27" tabindex="-1"></a>   , <span class="at">by =</span> dplyr<span class="sc">::</span><span class="fu">join_by</span>(rn,chm_res_m)</span>
<span id="cb230-28"><a href="chm_sens_test.html#cb230-28" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb230-29"><a href="chm_sens_test.html#cb230-29" tabindex="-1"></a>  <span class="co"># fill TP,FP,FN counts for those with no predictions</span></span>
<span id="cb230-30"><a href="chm_sens_test.html#cb230-30" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb230-31"><a href="chm_sens_test.html#cb230-31" tabindex="-1"></a>    <span class="at">chm_res_m_desc =</span> <span class="fu">paste0</span>(chm_res_m, <span class="st">&quot;m CHM&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">factor</span>() <span class="sc">%&gt;%</span> forcats<span class="sc">::</span><span class="fu">fct_reorder</span>(chm_res_m)</span>
<span id="cb230-32"><a href="chm_sens_test.html#cb230-32" tabindex="-1"></a>    , <span class="at">fn_n =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb230-33"><a href="chm_sens_test.html#cb230-33" tabindex="-1"></a>      <span class="fu">is.na</span>(tp_n) <span class="sc">&amp;</span> <span class="fu">is.na</span>(fp_n) <span class="sc">&amp;</span> <span class="fu">is.na</span>(fn_n) <span class="sc">~</span> (slash_piles_polys <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(is_in_stand) <span class="sc">%&gt;%</span> <span class="fu">nrow</span>())</span>
<span id="cb230-34"><a href="chm_sens_test.html#cb230-34" tabindex="-1"></a>      , T <span class="sc">~</span> fn_n</span>
<span id="cb230-35"><a href="chm_sens_test.html#cb230-35" tabindex="-1"></a>    )</span>
<span id="cb230-36"><a href="chm_sens_test.html#cb230-36" tabindex="-1"></a>    , dplyr<span class="sc">::</span><span class="fu">across</span>(</span>
<span id="cb230-37"><a href="chm_sens_test.html#cb230-37" tabindex="-1"></a>      <span class="fu">c</span>(tp_n,fp_n)</span>
<span id="cb230-38"><a href="chm_sens_test.html#cb230-38" tabindex="-1"></a>      , <span class="sc">~</span>dplyr<span class="sc">::</span><span class="fu">coalesce</span>(.x,<span class="dv">0</span>)</span>
<span id="cb230-39"><a href="chm_sens_test.html#cb230-39" tabindex="-1"></a>    )</span>
<span id="cb230-40"><a href="chm_sens_test.html#cb230-40" tabindex="-1"></a>    , </span>
<span id="cb230-41"><a href="chm_sens_test.html#cb230-41" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb230-42"><a href="chm_sens_test.html#cb230-42" tabindex="-1"></a>  <span class="co"># fill detection rates for those with no predictions</span></span>
<span id="cb230-43"><a href="chm_sens_test.html#cb230-43" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb230-44"><a href="chm_sens_test.html#cb230-44" tabindex="-1"></a>    <span class="at">omission_rate =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb230-45"><a href="chm_sens_test.html#cb230-45" tabindex="-1"></a>      <span class="fu">is.na</span>(omission_rate) <span class="sc">&amp;</span> dplyr<span class="sc">::</span><span class="fu">coalesce</span>(tp_n,<span class="dv">0</span>) <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> dplyr<span class="sc">::</span><span class="fu">coalesce</span>(fn_n,<span class="dv">0</span>) <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="dv">1</span> <span class="co"># every single actual pile was missed</span></span>
<span id="cb230-46"><a href="chm_sens_test.html#cb230-46" tabindex="-1"></a>      , T <span class="sc">~</span> omission_rate</span>
<span id="cb230-47"><a href="chm_sens_test.html#cb230-47" tabindex="-1"></a>    ) <span class="co"># False Negative Rate or Miss Rate</span></span>
<span id="cb230-48"><a href="chm_sens_test.html#cb230-48" tabindex="-1"></a>    , <span class="at">commission_rate =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb230-49"><a href="chm_sens_test.html#cb230-49" tabindex="-1"></a>      <span class="fu">is.na</span>(commission_rate) <span class="sc">&amp;</span> dplyr<span class="sc">::</span><span class="fu">coalesce</span>(tp_n,<span class="dv">0</span>) <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> dplyr<span class="sc">::</span><span class="fu">coalesce</span>(fp_n,<span class="dv">0</span>) <span class="sc">==</span> <span class="dv">0</span> <span class="sc">~</span> <span class="dv">0</span> <span class="co"># if no predictions are made, the model could not have made any commission errors</span></span>
<span id="cb230-50"><a href="chm_sens_test.html#cb230-50" tabindex="-1"></a>      , T <span class="sc">~</span> commission_rate</span>
<span id="cb230-51"><a href="chm_sens_test.html#cb230-51" tabindex="-1"></a>    ) <span class="co"># False Positive Rate</span></span>
<span id="cb230-52"><a href="chm_sens_test.html#cb230-52" tabindex="-1"></a>    , <span class="at">precision =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb230-53"><a href="chm_sens_test.html#cb230-53" tabindex="-1"></a>      <span class="fu">is.na</span>(precision) <span class="sc">&amp;</span> dplyr<span class="sc">::</span><span class="fu">coalesce</span>(tp_n,<span class="dv">0</span>) <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> dplyr<span class="sc">::</span><span class="fu">coalesce</span>(fp_n,<span class="dv">0</span>) <span class="sc">==</span> <span class="dv">0</span> <span class="sc">~</span> <span class="dv">1</span> <span class="co"># if no predictions are made, the model made zero incorrect positive claims</span></span>
<span id="cb230-54"><a href="chm_sens_test.html#cb230-54" tabindex="-1"></a>      , T <span class="sc">~</span> precision</span>
<span id="cb230-55"><a href="chm_sens_test.html#cb230-55" tabindex="-1"></a>    )</span>
<span id="cb230-56"><a href="chm_sens_test.html#cb230-56" tabindex="-1"></a>    , <span class="at">recall =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb230-57"><a href="chm_sens_test.html#cb230-57" tabindex="-1"></a>      <span class="fu">is.na</span>(recall) <span class="sc">&amp;</span> dplyr<span class="sc">::</span><span class="fu">coalesce</span>(tp_n,<span class="dv">0</span>) <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> dplyr<span class="sc">::</span><span class="fu">coalesce</span>(fn_n,<span class="dv">0</span>) <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="dv">0</span> <span class="co"># every single actual pile was missed</span></span>
<span id="cb230-58"><a href="chm_sens_test.html#cb230-58" tabindex="-1"></a>      , T <span class="sc">~</span> recall</span>
<span id="cb230-59"><a href="chm_sens_test.html#cb230-59" tabindex="-1"></a>    )</span>
<span id="cb230-60"><a href="chm_sens_test.html#cb230-60" tabindex="-1"></a>    , <span class="at">f_score =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb230-61"><a href="chm_sens_test.html#cb230-61" tabindex="-1"></a>      <span class="fu">is.na</span>(f_score) <span class="sc">&amp;</span> ( dplyr<span class="sc">::</span><span class="fu">coalesce</span>(precision,<span class="dv">0</span>) <span class="sc">==</span> <span class="dv">0</span> <span class="sc">|</span> dplyr<span class="sc">::</span><span class="fu">coalesce</span>(recall,<span class="dv">0</span>) <span class="sc">==</span> <span class="dv">0</span> ) <span class="sc">~</span> <span class="dv">0</span></span>
<span id="cb230-62"><a href="chm_sens_test.html#cb230-62" tabindex="-1"></a>      , T <span class="sc">~</span> f_score</span>
<span id="cb230-63"><a href="chm_sens_test.html#cb230-63" tabindex="-1"></a>    ) </span>
<span id="cb230-64"><a href="chm_sens_test.html#cb230-64" tabindex="-1"></a>  )</span></code></pre></div>
<p>what did we get from all of that work?</p>
<div class="sourceCode" id="cb231"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb231-1"><a href="chm_sens_test.html#cb231-1" tabindex="-1"></a>param_combos_gt_agg <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">glimpse</span>()</span></code></pre></div>
<pre><code>## Rows: 5,880
## Columns: 25
## $ rn                       &lt;dbl&gt; 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, …
## $ max_ht_m                 &lt;dbl&gt; 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, …
## $ min_area_m2              &lt;dbl&gt; 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, …
## $ max_area_m2              &lt;dbl&gt; 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 1…
## $ convexity_pct            &lt;dbl&gt; 0.05, 0.05, 0.05, 0.05, 0.05, 0.05, 0.05, 0.0…
## $ circle_fit_iou_pct       &lt;dbl&gt; 0.05, 0.05, 0.05, 0.05, 0.05, 0.20, 0.20, 0.2…
## $ chm_res_m                &lt;dbl&gt; 0.1, 0.2, 0.3, 0.4, 0.5, 0.1, 0.2, 0.3, 0.4, …
## $ tp_n                     &lt;dbl&gt; 98, 97, 91, 79, 59, 95, 90, 80, 72, 51, 91, 8…
## $ fp_n                     &lt;dbl&gt; 76, 126, 156, 184, 266, 70, 108, 140, 174, 25…
## $ fn_n                     &lt;dbl&gt; 23, 24, 30, 42, 62, 26, 31, 41, 49, 70, 30, 4…
## $ omission_rate            &lt;dbl&gt; 0.1900826, 0.1983471, 0.2479339, 0.3471074, 0…
## $ commission_rate          &lt;dbl&gt; 0.43678161, 0.56502242, 0.63157895, 0.6996197…
## $ precision                &lt;dbl&gt; 0.5632184, 0.4349776, 0.3684211, 0.3003802, 0…
## $ recall                   &lt;dbl&gt; 0.8099174, 0.8016529, 0.7520661, 0.6528926, 0…
## $ f_score                  &lt;dbl&gt; 0.6644068, 0.5639535, 0.4945652, 0.4114583, 0…
## $ diff_area_m2_rmse        &lt;dbl&gt; 0.9553187, 1.0630419, 1.7936904, 4.7264949, 3…
## $ diff_diameter_m_rmse     &lt;dbl&gt; 0.4146916, 0.6204824, 0.7931262, 1.1344303, 1…
## $ diff_height_m_rmse       &lt;dbl&gt; 0.3186457, 0.3295112, 0.3433166, 0.5022307, 0…
## $ diff_area_m2_mean        &lt;dbl&gt; -0.4845496, 0.5805644, 1.5061345, 1.7276581, …
## $ diff_diameter_m_mean     &lt;dbl&gt; 0.1722271, 0.4569563, 0.6992050, 0.8418140, 1…
## $ diff_height_m_mean       &lt;dbl&gt; -0.2039459, -0.2158827, -0.2325115, -0.284825…
## $ pct_diff_area_m2_mape    &lt;dbl&gt; 0.1077556, 0.1273854, 0.2328611, 0.3611736, 0…
## $ pct_diff_diameter_m_mape &lt;dbl&gt; 0.09959918, 0.16915037, 0.24160115, 0.3229551…
## $ pct_diff_height_m_mape   &lt;dbl&gt; 0.1255508, 0.1306792, 0.1348453, 0.1453663, 0…
## $ chm_res_m_desc           &lt;fct&gt; 0.1m CHM, 0.2m CHM, 0.3m CHM, 0.4m CHM, 0.5m …</code></pre>
<p>we should have the same number of records per tested CHM resolution as the number of parameter records tested (n = 1,176) for an overall total of 5,880 combinations tested</p>
<div class="sourceCode" id="cb233"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb233-1"><a href="chm_sens_test.html#cb233-1" tabindex="-1"></a>param_combos_gt_agg <span class="sc">%&gt;%</span></span>
<span id="cb233-2"><a href="chm_sens_test.html#cb233-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">count</span>(chm_res_m_desc)</span></code></pre></div>
<pre><code>## # A tibble: 5 × 2
##   chm_res_m_desc     n
##   &lt;fct&gt;          &lt;int&gt;
## 1 0.1m CHM        1176
## 2 0.2m CHM        1176
## 3 0.3m CHM        1176
## 4 0.4m CHM        1176
## 5 0.5m CHM        1176</code></pre>
<p>that is close enough as all we are looking to do is assess the sensitivity of the parameterization of the detection method and identify the most appropriate parameter settings to use for a given CHM resolution</p>
</div>
<div id="data-fusion" class="section level3 hasAnchor" number="8.4.2">
<h3><span class="header-section-number">8.4.2</span> Data Fusion<a href="chm_sens_test.html#data-fusion" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb235"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb235-1"><a href="chm_sens_test.html#cb235-1" tabindex="-1"></a>param_combos_spectral_gt_agg <span class="ot">&lt;-</span> </span>
<span id="cb235-2"><a href="chm_sens_test.html#cb235-2" tabindex="-1"></a>  chm_res_list <span class="sc">%&gt;%</span> </span>
<span id="cb235-3"><a href="chm_sens_test.html#cb235-3" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">map</span>(<span class="cf">function</span>(chm_res_m){</span>
<span id="cb235-4"><a href="chm_sens_test.html#cb235-4" tabindex="-1"></a>    <span class="co"># param_combos_gt file</span></span>
<span id="cb235-5"><a href="chm_sens_test.html#cb235-5" tabindex="-1"></a>    fnm <span class="ot">&lt;-</span> param_combos_spectral_gt_agg_flist <span class="sc">%&gt;%</span> stringr<span class="sc">::</span><span class="fu">str_subset</span>(<span class="at">pattern =</span> <span class="fu">paste0</span>(<span class="st">&quot;chm&quot;</span>,chm_res_m,<span class="st">&quot;m.csv&quot;</span>)) <span class="sc">%&gt;%</span> purrr<span class="sc">::</span><span class="fu">pluck</span>(<span class="dv">1</span>)</span>
<span id="cb235-6"><a href="chm_sens_test.html#cb235-6" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">is.null</span>(fnm) <span class="sc">||</span> <span class="sc">!</span><span class="fu">file.exists</span>(fnm)){<span class="fu">return</span>(<span class="cn">NULL</span>)}</span>
<span id="cb235-7"><a href="chm_sens_test.html#cb235-7" tabindex="-1"></a>    <span class="co"># read it</span></span>
<span id="cb235-8"><a href="chm_sens_test.html#cb235-8" tabindex="-1"></a>    readr<span class="sc">::</span><span class="fu">read_csv</span>(fnm, <span class="at">progress =</span> F, <span class="at">show_col_types =</span> F) <span class="sc">%&gt;%</span> </span>
<span id="cb235-9"><a href="chm_sens_test.html#cb235-9" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">chm_res_m =</span> chm_res_m)</span>
<span id="cb235-10"><a href="chm_sens_test.html#cb235-10" tabindex="-1"></a>  }) <span class="sc">%&gt;%</span> </span>
<span id="cb235-11"><a href="chm_sens_test.html#cb235-11" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">bind_rows</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb235-12"><a href="chm_sens_test.html#cb235-12" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb235-13"><a href="chm_sens_test.html#cb235-13" tabindex="-1"></a>    <span class="at">chm_res_m_desc =</span> <span class="fu">paste0</span>(chm_res_m, <span class="st">&quot;m CHM&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">factor</span>() <span class="sc">%&gt;%</span> forcats<span class="sc">::</span><span class="fu">fct_reorder</span>(chm_res_m)</span>
<span id="cb235-14"><a href="chm_sens_test.html#cb235-14" tabindex="-1"></a>    , <span class="at">spectral_weight_fact =</span> <span class="fu">ifelse</span>(spectral_weight<span class="sc">==</span><span class="dv">0</span>,<span class="st">&quot;structural only&quot;</span>,<span class="st">&quot;structural+spectral&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">factor</span>()</span>
<span id="cb235-15"><a href="chm_sens_test.html#cb235-15" tabindex="-1"></a>  )</span>
<span id="cb235-16"><a href="chm_sens_test.html#cb235-16" tabindex="-1"></a><span class="co"># param_combos_spectral_gt_agg %&gt;% dplyr::glimpse()</span></span></code></pre></div>
<p>what did we get from all of that work?</p>
<div class="sourceCode" id="cb236"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb236-1"><a href="chm_sens_test.html#cb236-1" tabindex="-1"></a>param_combos_spectral_gt_agg <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">glimpse</span>()</span></code></pre></div>
<pre><code>## Rows: 35,280
## Columns: 27
## $ tp_n                     &lt;dbl&gt; 98, 95, 91, 88, 81, 50, 0, 98, 95, 91, 88, 81…
## $ fp_n                     &lt;dbl&gt; 76, 70, 55, 36, 15, 1, 0, 76, 70, 55, 36, 15,…
## $ fn_n                     &lt;dbl&gt; 23, 26, 30, 33, 40, 71, 121, 23, 26, 30, 33, …
## $ omission_rate            &lt;dbl&gt; 0.1900826, 0.2148760, 0.2479339, 0.2727273, 0…
## $ commission_rate          &lt;dbl&gt; 0.43678161, 0.42424242, 0.37671233, 0.2903225…
## $ precision                &lt;dbl&gt; 0.5632184, 0.5757576, 0.6232877, 0.7096774, 0…
## $ recall                   &lt;dbl&gt; 0.8099174, 0.7851240, 0.7520661, 0.7272727, 0…
## $ f_score                  &lt;dbl&gt; 0.6644068, 0.6643357, 0.6816479, 0.7183673, 0…
## $ diff_area_m2_rmse        &lt;dbl&gt; 0.9553187, 0.9671790, 0.9832242, 0.9714572, 0…
## $ diff_diameter_m_rmse     &lt;dbl&gt; 0.4146916, 0.4184979, 0.4186223, 0.4221027, 0…
## $ diff_height_m_rmse       &lt;dbl&gt; 0.3186457, 0.3232764, 0.3270866, 0.3098395, 0…
## $ diff_area_m2_mean        &lt;dbl&gt; -0.4845496, -0.4896862, -0.4906696, -0.478697…
## $ diff_diameter_m_mean     &lt;dbl&gt; 0.1722271, 0.1724538, 0.1737368, 0.1746051, 0…
## $ diff_height_m_mean       &lt;dbl&gt; -0.2039459, -0.2087653, -0.2134582, -0.204894…
## $ pct_diff_area_m2_mape    &lt;dbl&gt; 0.1077556, 0.1092832, 0.1113608, 0.1094018, 0…
## $ pct_diff_diameter_m_mape &lt;dbl&gt; 0.09959918, 0.10076252, 0.10063595, 0.1007289…
## $ pct_diff_height_m_mape   &lt;dbl&gt; 0.1255508, 0.1287027, 0.1322157, 0.1283063, 0…
## $ rn                       &lt;dbl&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14…
## $ spectral_weight          &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, …
## $ max_ht_m                 &lt;dbl&gt; 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, …
## $ min_area_m2              &lt;dbl&gt; 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, …
## $ max_area_m2              &lt;dbl&gt; 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 1…
## $ convexity_pct            &lt;dbl&gt; 0.05, 0.05, 0.05, 0.05, 0.05, 0.05, 0.05, 0.2…
## $ circle_fit_iou_pct       &lt;dbl&gt; 0.05, 0.20, 0.35, 0.50, 0.65, 0.80, 0.95, 0.0…
## $ chm_res_m                &lt;dbl&gt; 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, …
## $ chm_res_m_desc           &lt;fct&gt; 0.1m CHM, 0.1m CHM, 0.1m CHM, 0.1m CHM, 0.1m …
## $ spectral_weight_fact     &lt;fct&gt; structural+spectral, structural+spectral, str…</code></pre>
<div class="sourceCode" id="cb238"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb238-1"><a href="chm_sens_test.html#cb238-1" tabindex="-1"></a><span class="co"># scales::comma(n_combos_tested*6,accuracy=1)</span></span></code></pre></div>
<p>we should have the same number of records per tested CHM resolution as the number of parameter records tested (n = 1,176) multiplied by six for the different five levels of the <code>spectral_weight</code> parameter tested when adding the spectral data in our data fusion approach and one combination representing no spectral data; for a total of 7,056 combinations tested per CHM resolution and an overall total of 35,280 combinations tested</p>
<div class="sourceCode" id="cb239"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb239-1"><a href="chm_sens_test.html#cb239-1" tabindex="-1"></a>param_combos_spectral_gt_agg <span class="sc">%&gt;%</span> </span>
<span id="cb239-2"><a href="chm_sens_test.html#cb239-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">count</span>(chm_res_m_desc)</span></code></pre></div>
<pre><code>## # A tibble: 5 × 2
##   chm_res_m_desc     n
##   &lt;fct&gt;          &lt;int&gt;
## 1 0.1m CHM        7056
## 2 0.2m CHM        7056
## 3 0.3m CHM        7056
## 4 0.4m CHM        7056
## 5 0.5m CHM        7056</code></pre>
<p>that is close enough as all we are looking to do is assess the sensitivity of the parameterization of the detection method and identify the most appropriate parameter settings to use for a given CHM resolution</p>
</div>
</div>
<div id="allthetests" class="section level2 hasAnchor" number="8.5">
<h2><span class="header-section-number">8.5</span> Structural Only: Sensitivity Testing<a href="chm_sens_test.html#allthetests" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>let’s look at the sensitivity testing results for the raster-based method using only structural data of the study area from the CHM to evaluate how changes to the specific thresholds and settings within the detection methodology impact the final results. Since the method doesn’t use training data, its performance is highly dependent on these manually defined parameters</p>
<p>we tested a total of 1,176 combinations tested per CHM resolution and an overall total of 5,880 combinations tested</p>
<div id="detect_trends" class="section level3 hasAnchor" number="8.5.1">
<h3><span class="header-section-number">8.5.1</span> Main Effects: pile detection<a href="chm_sens_test.html#detect_trends" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>what is the detection accuracy across all parameter combinations tested for each CHM resolution?</p>
<div class="sourceCode" id="cb241"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb241-1"><a href="chm_sens_test.html#cb241-1" tabindex="-1"></a><span class="co"># this is a lot of work, so we&#39;re going to make it a function</span></span>
<span id="cb241-2"><a href="chm_sens_test.html#cb241-2" tabindex="-1"></a>plt_detection_dist2 <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb241-3"><a href="chm_sens_test.html#cb241-3" tabindex="-1"></a>  df</span>
<span id="cb241-4"><a href="chm_sens_test.html#cb241-4" tabindex="-1"></a>  , <span class="at">my_subtitle =</span> <span class="st">&quot;&quot;</span></span>
<span id="cb241-5"><a href="chm_sens_test.html#cb241-5" tabindex="-1"></a>  , <span class="at">show_rug =</span> T</span>
<span id="cb241-6"><a href="chm_sens_test.html#cb241-6" tabindex="-1"></a>) {</span>
<span id="cb241-7"><a href="chm_sens_test.html#cb241-7" tabindex="-1"></a>  <span class="co"># Construct the formula for facet_grid</span></span>
<span id="cb241-8"><a href="chm_sens_test.html#cb241-8" tabindex="-1"></a>  <span class="co"># facet_formula &lt;- reformulate(&quot;metric&quot;, &quot;chm_res_m_desc&quot;) # reformulate(col_facet_var, row_facet_var)</span></span>
<span id="cb241-9"><a href="chm_sens_test.html#cb241-9" tabindex="-1"></a>  </span>
<span id="cb241-10"><a href="chm_sens_test.html#cb241-10" tabindex="-1"></a>  pal_eval_metric <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb241-11"><a href="chm_sens_test.html#cb241-11" tabindex="-1"></a>    RColorBrewer<span class="sc">::</span><span class="fu">brewer.pal</span>(<span class="dv">3</span>,<span class="st">&quot;Oranges&quot;</span>)[<span class="dv">3</span>]</span>
<span id="cb241-12"><a href="chm_sens_test.html#cb241-12" tabindex="-1"></a>    , RColorBrewer<span class="sc">::</span><span class="fu">brewer.pal</span>(<span class="dv">3</span>,<span class="st">&quot;Greys&quot;</span>)[<span class="dv">3</span>]</span>
<span id="cb241-13"><a href="chm_sens_test.html#cb241-13" tabindex="-1"></a>    , RColorBrewer<span class="sc">::</span><span class="fu">brewer.pal</span>(<span class="dv">3</span>,<span class="st">&quot;Purples&quot;</span>)[<span class="dv">3</span>]</span>
<span id="cb241-14"><a href="chm_sens_test.html#cb241-14" tabindex="-1"></a>  )</span>
<span id="cb241-15"><a href="chm_sens_test.html#cb241-15" tabindex="-1"></a>  </span>
<span id="cb241-16"><a href="chm_sens_test.html#cb241-16" tabindex="-1"></a>  df_temp <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> </span>
<span id="cb241-17"><a href="chm_sens_test.html#cb241-17" tabindex="-1"></a>    tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(</span>
<span id="cb241-18"><a href="chm_sens_test.html#cb241-18" tabindex="-1"></a>      <span class="at">cols =</span> <span class="fu">c</span>(precision,recall,f_score)</span>
<span id="cb241-19"><a href="chm_sens_test.html#cb241-19" tabindex="-1"></a>      , <span class="at">names_to =</span> <span class="st">&quot;metric&quot;</span></span>
<span id="cb241-20"><a href="chm_sens_test.html#cb241-20" tabindex="-1"></a>      , <span class="at">values_to =</span> <span class="st">&quot;value&quot;</span></span>
<span id="cb241-21"><a href="chm_sens_test.html#cb241-21" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb241-22"><a href="chm_sens_test.html#cb241-22" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb241-23"><a href="chm_sens_test.html#cb241-23" tabindex="-1"></a>      <span class="at">metric =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb241-24"><a href="chm_sens_test.html#cb241-24" tabindex="-1"></a>          metric <span class="sc">==</span> <span class="st">&quot;f_score&quot;</span> <span class="sc">~</span> <span class="dv">1</span></span>
<span id="cb241-25"><a href="chm_sens_test.html#cb241-25" tabindex="-1"></a>          , metric <span class="sc">==</span> <span class="st">&quot;recall&quot;</span> <span class="sc">~</span> <span class="dv">2</span></span>
<span id="cb241-26"><a href="chm_sens_test.html#cb241-26" tabindex="-1"></a>          , metric <span class="sc">==</span> <span class="st">&quot;precision&quot;</span> <span class="sc">~</span> <span class="dv">3</span></span>
<span id="cb241-27"><a href="chm_sens_test.html#cb241-27" tabindex="-1"></a>        ) <span class="sc">%&gt;%</span> </span>
<span id="cb241-28"><a href="chm_sens_test.html#cb241-28" tabindex="-1"></a>        <span class="fu">factor</span>(</span>
<span id="cb241-29"><a href="chm_sens_test.html#cb241-29" tabindex="-1"></a>          <span class="at">ordered =</span> T</span>
<span id="cb241-30"><a href="chm_sens_test.html#cb241-30" tabindex="-1"></a>          , <span class="at">levels =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span></span>
<span id="cb241-31"><a href="chm_sens_test.html#cb241-31" tabindex="-1"></a>          , <span class="at">labels =</span> <span class="fu">c</span>(</span>
<span id="cb241-32"><a href="chm_sens_test.html#cb241-32" tabindex="-1"></a>            <span class="st">&quot;F-score&quot;</span></span>
<span id="cb241-33"><a href="chm_sens_test.html#cb241-33" tabindex="-1"></a>            , <span class="st">&quot;Recall&quot;</span></span>
<span id="cb241-34"><a href="chm_sens_test.html#cb241-34" tabindex="-1"></a>            , <span class="st">&quot;Precision&quot;</span></span>
<span id="cb241-35"><a href="chm_sens_test.html#cb241-35" tabindex="-1"></a>          )</span>
<span id="cb241-36"><a href="chm_sens_test.html#cb241-36" tabindex="-1"></a>        )</span>
<span id="cb241-37"><a href="chm_sens_test.html#cb241-37" tabindex="-1"></a>    ) </span>
<span id="cb241-38"><a href="chm_sens_test.html#cb241-38" tabindex="-1"></a>  </span>
<span id="cb241-39"><a href="chm_sens_test.html#cb241-39" tabindex="-1"></a>  <span class="co"># chm check</span></span>
<span id="cb241-40"><a href="chm_sens_test.html#cb241-40" tabindex="-1"></a>  nrow_check <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> </span>
<span id="cb241-41"><a href="chm_sens_test.html#cb241-41" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">count</span>(chm_res_m_desc) <span class="sc">%&gt;%</span> </span>
<span id="cb241-42"><a href="chm_sens_test.html#cb241-42" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">pull</span>(n) <span class="sc">%&gt;%</span> </span>
<span id="cb241-43"><a href="chm_sens_test.html#cb241-43" tabindex="-1"></a>    <span class="fu">max</span>()</span>
<span id="cb241-44"><a href="chm_sens_test.html#cb241-44" tabindex="-1"></a>  </span>
<span id="cb241-45"><a href="chm_sens_test.html#cb241-45" tabindex="-1"></a>  <span class="co"># plot </span></span>
<span id="cb241-46"><a href="chm_sens_test.html#cb241-46" tabindex="-1"></a>  <span class="cf">if</span>(nrow_check<span class="sc">&lt;=</span><span class="dv">15</span>){</span>
<span id="cb241-47"><a href="chm_sens_test.html#cb241-47" tabindex="-1"></a>    <span class="co"># round</span></span>
<span id="cb241-48"><a href="chm_sens_test.html#cb241-48" tabindex="-1"></a>    df_temp <span class="ot">&lt;-</span> df_temp <span class="sc">%&gt;%</span> </span>
<span id="cb241-49"><a href="chm_sens_test.html#cb241-49" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb241-50"><a href="chm_sens_test.html#cb241-50" tabindex="-1"></a>        <span class="at">value =</span> <span class="fu">round</span>(value,<span class="dv">2</span>)</span>
<span id="cb241-51"><a href="chm_sens_test.html#cb241-51" tabindex="-1"></a>      )</span>
<span id="cb241-52"><a href="chm_sens_test.html#cb241-52" tabindex="-1"></a>    <span class="co"># agg for median plotting</span></span>
<span id="cb241-53"><a href="chm_sens_test.html#cb241-53" tabindex="-1"></a>    xxxdf_temp <span class="ot">&lt;-</span> df_temp <span class="sc">%&gt;%</span> </span>
<span id="cb241-54"><a href="chm_sens_test.html#cb241-54" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">group_by</span>(chm_res_m_desc,metric) <span class="sc">%&gt;%</span> </span>
<span id="cb241-55"><a href="chm_sens_test.html#cb241-55" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">summarise</span>(<span class="at">value =</span> <span class="fu">median</span>(value,<span class="at">na.rm=</span>T)) <span class="sc">%&gt;%</span> </span>
<span id="cb241-56"><a href="chm_sens_test.html#cb241-56" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb241-57"><a href="chm_sens_test.html#cb241-57" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb241-58"><a href="chm_sens_test.html#cb241-58" tabindex="-1"></a>        <span class="at">value_lab =</span> <span class="fu">paste0</span>(</span>
<span id="cb241-59"><a href="chm_sens_test.html#cb241-59" tabindex="-1"></a>          <span class="st">&quot;median:</span><span class="sc">\n</span><span class="st">&quot;</span></span>
<span id="cb241-60"><a href="chm_sens_test.html#cb241-60" tabindex="-1"></a>          , scales<span class="sc">::</span><span class="fu">percent</span>(value,<span class="at">accuracy=</span><span class="dv">1</span>)</span>
<span id="cb241-61"><a href="chm_sens_test.html#cb241-61" tabindex="-1"></a>        )</span>
<span id="cb241-62"><a href="chm_sens_test.html#cb241-62" tabindex="-1"></a>      )</span>
<span id="cb241-63"><a href="chm_sens_test.html#cb241-63" tabindex="-1"></a>    </span>
<span id="cb241-64"><a href="chm_sens_test.html#cb241-64" tabindex="-1"></a>    <span class="co"># plot </span></span>
<span id="cb241-65"><a href="chm_sens_test.html#cb241-65" tabindex="-1"></a>    plt <span class="ot">&lt;-</span> df_temp <span class="sc">%&gt;%</span> </span>
<span id="cb241-66"><a href="chm_sens_test.html#cb241-66" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">count</span>(chm_res_m_desc,metric,value) <span class="sc">%&gt;%</span> </span>
<span id="cb241-67"><a href="chm_sens_test.html#cb241-67" tabindex="-1"></a>      ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(</span>
<span id="cb241-68"><a href="chm_sens_test.html#cb241-68" tabindex="-1"></a>        <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">fill =</span> metric, <span class="at">color =</span> metric)</span>
<span id="cb241-69"><a href="chm_sens_test.html#cb241-69" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb241-70"><a href="chm_sens_test.html#cb241-70" tabindex="-1"></a>      ggplot2<span class="sc">::</span><span class="fu">geom_vline</span>(</span>
<span id="cb241-71"><a href="chm_sens_test.html#cb241-71" tabindex="-1"></a>        <span class="at">data =</span> xxxdf_temp</span>
<span id="cb241-72"><a href="chm_sens_test.html#cb241-72" tabindex="-1"></a>        , <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">xintercept =</span> value)</span>
<span id="cb241-73"><a href="chm_sens_test.html#cb241-73" tabindex="-1"></a>        , <span class="at">color =</span> <span class="st">&quot;gray44&quot;</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span></span>
<span id="cb241-74"><a href="chm_sens_test.html#cb241-74" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb241-75"><a href="chm_sens_test.html#cb241-75" tabindex="-1"></a>      <span class="co"># ggplot2::geom_jitter(mapping = ggplot2::aes(y=-0.2), width = 0, height = 0.1) +</span></span>
<span id="cb241-76"><a href="chm_sens_test.html#cb241-76" tabindex="-1"></a>      <span class="co"># ggplot2::geom_boxplot(width = 0.1, color = &quot;black&quot;, fill = NA, outliers = F) +</span></span>
<span id="cb241-77"><a href="chm_sens_test.html#cb241-77" tabindex="-1"></a>      ggplot2<span class="sc">::</span><span class="fu">geom_segment</span>(</span>
<span id="cb241-78"><a href="chm_sens_test.html#cb241-78" tabindex="-1"></a>        <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">y=</span>n,<span class="at">yend=</span><span class="dv">0</span>)</span>
<span id="cb241-79"><a href="chm_sens_test.html#cb241-79" tabindex="-1"></a>        , <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.8</span></span>
<span id="cb241-80"><a href="chm_sens_test.html#cb241-80" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb241-81"><a href="chm_sens_test.html#cb241-81" tabindex="-1"></a>      ggplot2<span class="sc">::</span><span class="fu">geom_point</span>(</span>
<span id="cb241-82"><a href="chm_sens_test.html#cb241-82" tabindex="-1"></a>        <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">y=</span>n)</span>
<span id="cb241-83"><a href="chm_sens_test.html#cb241-83" tabindex="-1"></a>        , <span class="at">alpha =</span> <span class="dv">1</span></span>
<span id="cb241-84"><a href="chm_sens_test.html#cb241-84" tabindex="-1"></a>        , <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">color =</span> <span class="st">&quot;gray44&quot;</span>, <span class="at">size =</span> <span class="dv">5</span></span>
<span id="cb241-85"><a href="chm_sens_test.html#cb241-85" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb241-86"><a href="chm_sens_test.html#cb241-86" tabindex="-1"></a>      ggplot2<span class="sc">::</span><span class="fu">geom_text</span>(</span>
<span id="cb241-87"><a href="chm_sens_test.html#cb241-87" tabindex="-1"></a>        <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">y=</span>n,<span class="at">label=</span>n)</span>
<span id="cb241-88"><a href="chm_sens_test.html#cb241-88" tabindex="-1"></a>        , <span class="at">size =</span> <span class="fl">2.5</span>, <span class="at">color =</span> <span class="st">&quot;white&quot;</span></span>
<span id="cb241-89"><a href="chm_sens_test.html#cb241-89" tabindex="-1"></a>        <span class="co"># , vjust = -0.01</span></span>
<span id="cb241-90"><a href="chm_sens_test.html#cb241-90" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb241-91"><a href="chm_sens_test.html#cb241-91" tabindex="-1"></a>      ggplot2<span class="sc">::</span><span class="fu">geom_text</span>(</span>
<span id="cb241-92"><a href="chm_sens_test.html#cb241-92" tabindex="-1"></a>        <span class="at">data =</span> xxxdf_temp</span>
<span id="cb241-93"><a href="chm_sens_test.html#cb241-93" tabindex="-1"></a>        , <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(</span>
<span id="cb241-94"><a href="chm_sens_test.html#cb241-94" tabindex="-1"></a>          <span class="at">x =</span> <span class="sc">-</span><span class="cn">Inf</span>, <span class="at">y =</span> <span class="cn">Inf</span> <span class="co"># always in upper left?</span></span>
<span id="cb241-95"><a href="chm_sens_test.html#cb241-95" tabindex="-1"></a>          <span class="co"># x = value, y = 0</span></span>
<span id="cb241-96"><a href="chm_sens_test.html#cb241-96" tabindex="-1"></a>          , <span class="at">label =</span> value_lab</span>
<span id="cb241-97"><a href="chm_sens_test.html#cb241-97" tabindex="-1"></a>        )</span>
<span id="cb241-98"><a href="chm_sens_test.html#cb241-98" tabindex="-1"></a>        , <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">0.1</span>, <span class="at">vjust =</span> <span class="dv">1</span> <span class="co"># always in upper left?</span></span>
<span id="cb241-99"><a href="chm_sens_test.html#cb241-99" tabindex="-1"></a>        <span class="co"># , hjust = -0.1, vjust = -5</span></span>
<span id="cb241-100"><a href="chm_sens_test.html#cb241-100" tabindex="-1"></a>        , <span class="at">size =</span> <span class="fl">2.5</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span></span>
<span id="cb241-101"><a href="chm_sens_test.html#cb241-101" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb241-102"><a href="chm_sens_test.html#cb241-102" tabindex="-1"></a>      <span class="co"># ggplot2::geom_rug() +</span></span>
<span id="cb241-103"><a href="chm_sens_test.html#cb241-103" tabindex="-1"></a>      ggplot2<span class="sc">::</span><span class="fu">scale_fill_manual</span>(<span class="at">values =</span> pal_eval_metric) <span class="sc">+</span></span>
<span id="cb241-104"><a href="chm_sens_test.html#cb241-104" tabindex="-1"></a>      ggplot2<span class="sc">::</span><span class="fu">scale_color_manual</span>(<span class="at">values =</span> pal_eval_metric) <span class="sc">+</span></span>
<span id="cb241-105"><a href="chm_sens_test.html#cb241-105" tabindex="-1"></a>      ggplot2<span class="sc">::</span><span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> ggplot2<span class="sc">::</span><span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="dv">0</span>, .<span class="dv">2</span>))) <span class="sc">+</span></span>
<span id="cb241-106"><a href="chm_sens_test.html#cb241-106" tabindex="-1"></a>      ggplot2<span class="sc">::</span><span class="fu">scale_x_continuous</span>(</span>
<span id="cb241-107"><a href="chm_sens_test.html#cb241-107" tabindex="-1"></a>        <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">percent_format</span>(<span class="at">accuracy =</span> <span class="dv">1</span>)</span>
<span id="cb241-108"><a href="chm_sens_test.html#cb241-108" tabindex="-1"></a>        <span class="co"># , limits = c(0,1.05)</span></span>
<span id="cb241-109"><a href="chm_sens_test.html#cb241-109" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb241-110"><a href="chm_sens_test.html#cb241-110" tabindex="-1"></a>      ggplot2<span class="sc">::</span><span class="fu">facet_grid</span>(<span class="at">cols =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(metric), <span class="at">rows =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(chm_res_m_desc), <span class="at">scales =</span> <span class="st">&quot;free_x&quot;</span>) <span class="sc">+</span></span>
<span id="cb241-111"><a href="chm_sens_test.html#cb241-111" tabindex="-1"></a>      ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb241-112"><a href="chm_sens_test.html#cb241-112" tabindex="-1"></a>        <span class="at">x =</span> <span class="st">&quot;&quot;</span>, <span class="at">y =</span> <span class="st">&quot;&quot;</span></span>
<span id="cb241-113"><a href="chm_sens_test.html#cb241-113" tabindex="-1"></a>        , <span class="at">subtitle =</span> my_subtitle</span>
<span id="cb241-114"><a href="chm_sens_test.html#cb241-114" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb241-115"><a href="chm_sens_test.html#cb241-115" tabindex="-1"></a>      ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb241-116"><a href="chm_sens_test.html#cb241-116" tabindex="-1"></a>      ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb241-117"><a href="chm_sens_test.html#cb241-117" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb241-118"><a href="chm_sens_test.html#cb241-118" tabindex="-1"></a>        , <span class="at">strip.text =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb241-119"><a href="chm_sens_test.html#cb241-119" tabindex="-1"></a>        , <span class="at">axis.text.x =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">7</span>)</span>
<span id="cb241-120"><a href="chm_sens_test.html#cb241-120" tabindex="-1"></a>        , <span class="at">axis.text.y =</span> ggplot2<span class="sc">::</span><span class="fu">element_blank</span>()</span>
<span id="cb241-121"><a href="chm_sens_test.html#cb241-121" tabindex="-1"></a>        , <span class="at">axis.ticks.y =</span> ggplot2<span class="sc">::</span><span class="fu">element_blank</span>()</span>
<span id="cb241-122"><a href="chm_sens_test.html#cb241-122" tabindex="-1"></a>        , <span class="at">panel.grid.major.y =</span> ggplot2<span class="sc">::</span><span class="fu">element_blank</span>()</span>
<span id="cb241-123"><a href="chm_sens_test.html#cb241-123" tabindex="-1"></a>        , <span class="at">panel.grid.minor.y =</span> ggplot2<span class="sc">::</span><span class="fu">element_blank</span>()</span>
<span id="cb241-124"><a href="chm_sens_test.html#cb241-124" tabindex="-1"></a>        , <span class="at">plot.subtitle =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>)</span>
<span id="cb241-125"><a href="chm_sens_test.html#cb241-125" tabindex="-1"></a>      )</span>
<span id="cb241-126"><a href="chm_sens_test.html#cb241-126" tabindex="-1"></a>  }<span class="cf">else</span>{</span>
<span id="cb241-127"><a href="chm_sens_test.html#cb241-127" tabindex="-1"></a>    <span class="co"># agg for median plotting</span></span>
<span id="cb241-128"><a href="chm_sens_test.html#cb241-128" tabindex="-1"></a>    xxxdf_temp <span class="ot">&lt;-</span> df_temp <span class="sc">%&gt;%</span> </span>
<span id="cb241-129"><a href="chm_sens_test.html#cb241-129" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">group_by</span>(chm_res_m_desc,metric) <span class="sc">%&gt;%</span> </span>
<span id="cb241-130"><a href="chm_sens_test.html#cb241-130" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">summarise</span>(<span class="at">value =</span> <span class="fu">median</span>(value,<span class="at">na.rm=</span>T)) <span class="sc">%&gt;%</span> </span>
<span id="cb241-131"><a href="chm_sens_test.html#cb241-131" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb241-132"><a href="chm_sens_test.html#cb241-132" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb241-133"><a href="chm_sens_test.html#cb241-133" tabindex="-1"></a>        <span class="at">value_lab =</span> <span class="fu">paste0</span>(</span>
<span id="cb241-134"><a href="chm_sens_test.html#cb241-134" tabindex="-1"></a>          <span class="st">&quot;median:</span><span class="sc">\n</span><span class="st">&quot;</span></span>
<span id="cb241-135"><a href="chm_sens_test.html#cb241-135" tabindex="-1"></a>          , scales<span class="sc">::</span><span class="fu">percent</span>(value,<span class="at">accuracy=</span><span class="dv">1</span>)</span>
<span id="cb241-136"><a href="chm_sens_test.html#cb241-136" tabindex="-1"></a>        )</span>
<span id="cb241-137"><a href="chm_sens_test.html#cb241-137" tabindex="-1"></a>      )</span>
<span id="cb241-138"><a href="chm_sens_test.html#cb241-138" tabindex="-1"></a>    plt <span class="ot">&lt;-</span> df_temp <span class="sc">%&gt;%</span> </span>
<span id="cb241-139"><a href="chm_sens_test.html#cb241-139" tabindex="-1"></a>      ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(</span>
<span id="cb241-140"><a href="chm_sens_test.html#cb241-140" tabindex="-1"></a>        <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">fill =</span> metric, <span class="at">color =</span> metric)</span>
<span id="cb241-141"><a href="chm_sens_test.html#cb241-141" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb241-142"><a href="chm_sens_test.html#cb241-142" tabindex="-1"></a>      ggplot2<span class="sc">::</span><span class="fu">geom_density</span>(<span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">y=</span>ggplot2<span class="sc">::</span><span class="fu">after_stat</span>(scaled)), <span class="at">color =</span> <span class="cn">NA</span>, <span class="at">alpha =</span> <span class="fl">0.9</span>) <span class="sc">+</span></span>
<span id="cb241-143"><a href="chm_sens_test.html#cb241-143" tabindex="-1"></a>      <span class="co"># ggplot2::geom_rug(</span></span>
<span id="cb241-144"><a href="chm_sens_test.html#cb241-144" tabindex="-1"></a>      <span class="co">#   # # setting these makes the plotting more computationally intensive</span></span>
<span id="cb241-145"><a href="chm_sens_test.html#cb241-145" tabindex="-1"></a>      <span class="co">#   # alpha = 0.5</span></span>
<span id="cb241-146"><a href="chm_sens_test.html#cb241-146" tabindex="-1"></a>      <span class="co">#   # , length = ggplot2::unit(0.01, &quot;npc&quot;)</span></span>
<span id="cb241-147"><a href="chm_sens_test.html#cb241-147" tabindex="-1"></a>      <span class="co"># ) +</span></span>
<span id="cb241-148"><a href="chm_sens_test.html#cb241-148" tabindex="-1"></a>      ggplot2<span class="sc">::</span><span class="fu">geom_vline</span>(</span>
<span id="cb241-149"><a href="chm_sens_test.html#cb241-149" tabindex="-1"></a>        <span class="at">data =</span> xxxdf_temp</span>
<span id="cb241-150"><a href="chm_sens_test.html#cb241-150" tabindex="-1"></a>        , <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">xintercept =</span> value)</span>
<span id="cb241-151"><a href="chm_sens_test.html#cb241-151" tabindex="-1"></a>        , <span class="at">color =</span> <span class="st">&quot;gray44&quot;</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span></span>
<span id="cb241-152"><a href="chm_sens_test.html#cb241-152" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb241-153"><a href="chm_sens_test.html#cb241-153" tabindex="-1"></a>      ggplot2<span class="sc">::</span><span class="fu">geom_text</span>(</span>
<span id="cb241-154"><a href="chm_sens_test.html#cb241-154" tabindex="-1"></a>        <span class="at">data =</span> xxxdf_temp</span>
<span id="cb241-155"><a href="chm_sens_test.html#cb241-155" tabindex="-1"></a>        , <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(</span>
<span id="cb241-156"><a href="chm_sens_test.html#cb241-156" tabindex="-1"></a>          <span class="at">x =</span> <span class="sc">-</span><span class="cn">Inf</span>, <span class="at">y =</span> <span class="cn">Inf</span> <span class="co"># always in upper left?</span></span>
<span id="cb241-157"><a href="chm_sens_test.html#cb241-157" tabindex="-1"></a>          <span class="co"># x = value, y = 0</span></span>
<span id="cb241-158"><a href="chm_sens_test.html#cb241-158" tabindex="-1"></a>          , <span class="at">label =</span> value_lab</span>
<span id="cb241-159"><a href="chm_sens_test.html#cb241-159" tabindex="-1"></a>        )</span>
<span id="cb241-160"><a href="chm_sens_test.html#cb241-160" tabindex="-1"></a>        , <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">0.1</span>, <span class="at">vjust =</span> <span class="dv">1</span> <span class="co"># always in upper left?</span></span>
<span id="cb241-161"><a href="chm_sens_test.html#cb241-161" tabindex="-1"></a>        <span class="co"># , hjust = -0.1, vjust = -5</span></span>
<span id="cb241-162"><a href="chm_sens_test.html#cb241-162" tabindex="-1"></a>        , <span class="at">size =</span> <span class="fl">2.5</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span></span>
<span id="cb241-163"><a href="chm_sens_test.html#cb241-163" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb241-164"><a href="chm_sens_test.html#cb241-164" tabindex="-1"></a>      ggplot2<span class="sc">::</span><span class="fu">scale_fill_manual</span>(<span class="at">values =</span> pal_eval_metric) <span class="sc">+</span></span>
<span id="cb241-165"><a href="chm_sens_test.html#cb241-165" tabindex="-1"></a>      ggplot2<span class="sc">::</span><span class="fu">scale_color_manual</span>(<span class="at">values =</span> pal_eval_metric) <span class="sc">+</span></span>
<span id="cb241-166"><a href="chm_sens_test.html#cb241-166" tabindex="-1"></a>      ggplot2<span class="sc">::</span><span class="fu">scale_x_continuous</span>(</span>
<span id="cb241-167"><a href="chm_sens_test.html#cb241-167" tabindex="-1"></a>        <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">percent_format</span>(<span class="at">accuracy =</span> <span class="dv">1</span>)</span>
<span id="cb241-168"><a href="chm_sens_test.html#cb241-168" tabindex="-1"></a>        , <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">1.05</span>)</span>
<span id="cb241-169"><a href="chm_sens_test.html#cb241-169" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb241-170"><a href="chm_sens_test.html#cb241-170" tabindex="-1"></a>      ggplot2<span class="sc">::</span><span class="fu">facet_grid</span>(<span class="at">cols =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(metric), <span class="at">rows =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(chm_res_m_desc), <span class="at">scales =</span> <span class="st">&quot;free_y&quot;</span>) <span class="sc">+</span></span>
<span id="cb241-171"><a href="chm_sens_test.html#cb241-171" tabindex="-1"></a>      ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb241-172"><a href="chm_sens_test.html#cb241-172" tabindex="-1"></a>        <span class="at">x =</span> <span class="st">&quot;&quot;</span>, <span class="at">y =</span> <span class="st">&quot;&quot;</span></span>
<span id="cb241-173"><a href="chm_sens_test.html#cb241-173" tabindex="-1"></a>        , <span class="at">subtitle =</span> my_subtitle</span>
<span id="cb241-174"><a href="chm_sens_test.html#cb241-174" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb241-175"><a href="chm_sens_test.html#cb241-175" tabindex="-1"></a>      ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb241-176"><a href="chm_sens_test.html#cb241-176" tabindex="-1"></a>      ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb241-177"><a href="chm_sens_test.html#cb241-177" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb241-178"><a href="chm_sens_test.html#cb241-178" tabindex="-1"></a>        , <span class="at">strip.text.x =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb241-179"><a href="chm_sens_test.html#cb241-179" tabindex="-1"></a>        , <span class="at">strip.text.y =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">9</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb241-180"><a href="chm_sens_test.html#cb241-180" tabindex="-1"></a>        , <span class="at">axis.text.x =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">7</span>)</span>
<span id="cb241-181"><a href="chm_sens_test.html#cb241-181" tabindex="-1"></a>        , <span class="at">axis.text.y =</span> ggplot2<span class="sc">::</span><span class="fu">element_blank</span>()</span>
<span id="cb241-182"><a href="chm_sens_test.html#cb241-182" tabindex="-1"></a>        , <span class="at">axis.ticks.y =</span> ggplot2<span class="sc">::</span><span class="fu">element_blank</span>()</span>
<span id="cb241-183"><a href="chm_sens_test.html#cb241-183" tabindex="-1"></a>        , <span class="at">panel.grid.major.y =</span> ggplot2<span class="sc">::</span><span class="fu">element_blank</span>()</span>
<span id="cb241-184"><a href="chm_sens_test.html#cb241-184" tabindex="-1"></a>        , <span class="at">panel.grid.minor.y =</span> ggplot2<span class="sc">::</span><span class="fu">element_blank</span>()</span>
<span id="cb241-185"><a href="chm_sens_test.html#cb241-185" tabindex="-1"></a>        , <span class="at">plot.subtitle =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>)</span>
<span id="cb241-186"><a href="chm_sens_test.html#cb241-186" tabindex="-1"></a>      )</span>
<span id="cb241-187"><a href="chm_sens_test.html#cb241-187" tabindex="-1"></a>    <span class="cf">if</span>(show_rug){</span>
<span id="cb241-188"><a href="chm_sens_test.html#cb241-188" tabindex="-1"></a>      plt <span class="ot">&lt;-</span> plt <span class="sc">+</span> </span>
<span id="cb241-189"><a href="chm_sens_test.html#cb241-189" tabindex="-1"></a>        ggplot2<span class="sc">::</span><span class="fu">geom_rug</span>(</span>
<span id="cb241-190"><a href="chm_sens_test.html#cb241-190" tabindex="-1"></a>          <span class="co"># # setting these makes the plotting more computationally intensive</span></span>
<span id="cb241-191"><a href="chm_sens_test.html#cb241-191" tabindex="-1"></a>          <span class="co"># alpha = 0.5</span></span>
<span id="cb241-192"><a href="chm_sens_test.html#cb241-192" tabindex="-1"></a>          <span class="co"># , length = ggplot2::unit(0.01, &quot;npc&quot;)</span></span>
<span id="cb241-193"><a href="chm_sens_test.html#cb241-193" tabindex="-1"></a>        )</span>
<span id="cb241-194"><a href="chm_sens_test.html#cb241-194" tabindex="-1"></a>    }</span>
<span id="cb241-195"><a href="chm_sens_test.html#cb241-195" tabindex="-1"></a>  }</span>
<span id="cb241-196"><a href="chm_sens_test.html#cb241-196" tabindex="-1"></a>  <span class="fu">return</span>(plt)</span>
<span id="cb241-197"><a href="chm_sens_test.html#cb241-197" tabindex="-1"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb242"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb242-1"><a href="chm_sens_test.html#cb242-1" tabindex="-1"></a><span class="co"># plot it</span></span>
<span id="cb242-2"><a href="chm_sens_test.html#cb242-2" tabindex="-1"></a><span class="fu">plt_detection_dist2</span>(</span>
<span id="cb242-3"><a href="chm_sens_test.html#cb242-3" tabindex="-1"></a>  <span class="at">df =</span> param_combos_gt_agg</span>
<span id="cb242-4"><a href="chm_sens_test.html#cb242-4" tabindex="-1"></a>  , <span class="fu">paste0</span>(</span>
<span id="cb242-5"><a href="chm_sens_test.html#cb242-5" tabindex="-1"></a>    <span class="st">&quot;Structural Data Only&quot;</span></span>
<span id="cb242-6"><a href="chm_sens_test.html#cb242-6" tabindex="-1"></a>      , <span class="st">&quot;</span><span class="sc">\n</span><span class="st">distribution of pile detection accuracy metrics for all&quot;</span></span>
<span id="cb242-7"><a href="chm_sens_test.html#cb242-7" tabindex="-1"></a>     , <span class="st">&quot; (n=&quot;</span></span>
<span id="cb242-8"><a href="chm_sens_test.html#cb242-8" tabindex="-1"></a>     , scales<span class="sc">::</span><span class="fu">comma</span>(n_combos_tested_chm, <span class="at">accuracy =</span> <span class="dv">1</span>)</span>
<span id="cb242-9"><a href="chm_sens_test.html#cb242-9" tabindex="-1"></a>     , <span class="st">&quot;) &quot;</span></span>
<span id="cb242-10"><a href="chm_sens_test.html#cb242-10" tabindex="-1"></a>     , <span class="st">&quot;parameter combinations tested&quot;</span></span>
<span id="cb242-11"><a href="chm_sens_test.html#cb242-11" tabindex="-1"></a>    )</span>
<span id="cb242-12"><a href="chm_sens_test.html#cb242-12" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-210-1.png" width="1008" /></p>
<p>collapsing across all other parameters, what is the main effect of each individual parameter or CHM resolution?</p>
<div class="sourceCode" id="cb243"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb243-1"><a href="chm_sens_test.html#cb243-1" tabindex="-1"></a>param_combos_gt_agg <span class="sc">%&gt;%</span> </span>
<span id="cb243-2"><a href="chm_sens_test.html#cb243-2" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(</span>
<span id="cb243-3"><a href="chm_sens_test.html#cb243-3" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">c</span>(precision,recall,f_score)</span>
<span id="cb243-4"><a href="chm_sens_test.html#cb243-4" tabindex="-1"></a>    , <span class="at">names_to =</span> <span class="st">&quot;metric&quot;</span></span>
<span id="cb243-5"><a href="chm_sens_test.html#cb243-5" tabindex="-1"></a>    , <span class="at">values_to =</span> <span class="st">&quot;value&quot;</span></span>
<span id="cb243-6"><a href="chm_sens_test.html#cb243-6" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb243-7"><a href="chm_sens_test.html#cb243-7" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(</span>
<span id="cb243-8"><a href="chm_sens_test.html#cb243-8" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">c</span>(max_ht_m,max_area_m2,convexity_pct,circle_fit_iou_pct,chm_res_m)</span>
<span id="cb243-9"><a href="chm_sens_test.html#cb243-9" tabindex="-1"></a>    , <span class="at">names_to =</span> <span class="st">&quot;param&quot;</span></span>
<span id="cb243-10"><a href="chm_sens_test.html#cb243-10" tabindex="-1"></a>    , <span class="at">values_to =</span> <span class="st">&quot;param_value&quot;</span></span>
<span id="cb243-11"><a href="chm_sens_test.html#cb243-11" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb243-12"><a href="chm_sens_test.html#cb243-12" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(param, param_value, metric) <span class="sc">%&gt;%</span></span>
<span id="cb243-13"><a href="chm_sens_test.html#cb243-13" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(</span>
<span id="cb243-14"><a href="chm_sens_test.html#cb243-14" tabindex="-1"></a>    <span class="at">median =</span> <span class="fu">median</span>(value,<span class="at">na.rm=</span>T)</span>
<span id="cb243-15"><a href="chm_sens_test.html#cb243-15" tabindex="-1"></a>    , <span class="at">q25 =</span> stats<span class="sc">::</span><span class="fu">quantile</span>(value,<span class="at">na.rm=</span>T,<span class="at">probs =</span> <span class="fl">0.25</span>)</span>
<span id="cb243-16"><a href="chm_sens_test.html#cb243-16" tabindex="-1"></a>    , <span class="at">q75 =</span> stats<span class="sc">::</span><span class="fu">quantile</span>(value,<span class="at">na.rm=</span>T,<span class="at">probs =</span> <span class="fl">0.75</span>)</span>
<span id="cb243-17"><a href="chm_sens_test.html#cb243-17" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb243-18"><a href="chm_sens_test.html#cb243-18" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb243-19"><a href="chm_sens_test.html#cb243-19" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb243-20"><a href="chm_sens_test.html#cb243-20" tabindex="-1"></a>    <span class="at">param =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb243-21"><a href="chm_sens_test.html#cb243-21" tabindex="-1"></a>        param <span class="sc">==</span> <span class="st">&quot;chm_res_m&quot;</span> <span class="sc">~</span> <span class="dv">1</span></span>
<span id="cb243-22"><a href="chm_sens_test.html#cb243-22" tabindex="-1"></a>        , param <span class="sc">==</span> <span class="st">&quot;max_ht_m&quot;</span> <span class="sc">~</span> <span class="dv">2</span></span>
<span id="cb243-23"><a href="chm_sens_test.html#cb243-23" tabindex="-1"></a>        , param <span class="sc">==</span> <span class="st">&quot;min_area_m2&quot;</span> <span class="sc">~</span> <span class="dv">3</span></span>
<span id="cb243-24"><a href="chm_sens_test.html#cb243-24" tabindex="-1"></a>        , param <span class="sc">==</span> <span class="st">&quot;max_area_m2&quot;</span> <span class="sc">~</span> <span class="dv">4</span></span>
<span id="cb243-25"><a href="chm_sens_test.html#cb243-25" tabindex="-1"></a>        , param <span class="sc">==</span> <span class="st">&quot;convexity_pct&quot;</span> <span class="sc">~</span> <span class="dv">5</span></span>
<span id="cb243-26"><a href="chm_sens_test.html#cb243-26" tabindex="-1"></a>        , param <span class="sc">==</span> <span class="st">&quot;circle_fit_iou_pct&quot;</span> <span class="sc">~</span> <span class="dv">6</span></span>
<span id="cb243-27"><a href="chm_sens_test.html#cb243-27" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span> </span>
<span id="cb243-28"><a href="chm_sens_test.html#cb243-28" tabindex="-1"></a>      <span class="fu">factor</span>(</span>
<span id="cb243-29"><a href="chm_sens_test.html#cb243-29" tabindex="-1"></a>        <span class="at">ordered =</span> T</span>
<span id="cb243-30"><a href="chm_sens_test.html#cb243-30" tabindex="-1"></a>        , <span class="at">levels =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">6</span></span>
<span id="cb243-31"><a href="chm_sens_test.html#cb243-31" tabindex="-1"></a>        , <span class="at">labels =</span> <span class="fu">c</span>(</span>
<span id="cb243-32"><a href="chm_sens_test.html#cb243-32" tabindex="-1"></a>          <span class="st">&quot;CHM resolution (m)&quot;</span></span>
<span id="cb243-33"><a href="chm_sens_test.html#cb243-33" tabindex="-1"></a>          , <span class="st">&quot;max_ht_m&quot;</span></span>
<span id="cb243-34"><a href="chm_sens_test.html#cb243-34" tabindex="-1"></a>          , <span class="st">&quot;min_area_m2&quot;</span></span>
<span id="cb243-35"><a href="chm_sens_test.html#cb243-35" tabindex="-1"></a>          , <span class="st">&quot;max_area_m2&quot;</span></span>
<span id="cb243-36"><a href="chm_sens_test.html#cb243-36" tabindex="-1"></a>          , <span class="st">&quot;convexity_pct&quot;</span></span>
<span id="cb243-37"><a href="chm_sens_test.html#cb243-37" tabindex="-1"></a>          , <span class="st">&quot;circle_fit_iou_pct&quot;</span></span>
<span id="cb243-38"><a href="chm_sens_test.html#cb243-38" tabindex="-1"></a>        )</span>
<span id="cb243-39"><a href="chm_sens_test.html#cb243-39" tabindex="-1"></a>      )</span>
<span id="cb243-40"><a href="chm_sens_test.html#cb243-40" tabindex="-1"></a>    , <span class="at">metric =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb243-41"><a href="chm_sens_test.html#cb243-41" tabindex="-1"></a>        metric <span class="sc">==</span> <span class="st">&quot;f_score&quot;</span> <span class="sc">~</span> <span class="dv">1</span></span>
<span id="cb243-42"><a href="chm_sens_test.html#cb243-42" tabindex="-1"></a>        , metric <span class="sc">==</span> <span class="st">&quot;recall&quot;</span> <span class="sc">~</span> <span class="dv">2</span></span>
<span id="cb243-43"><a href="chm_sens_test.html#cb243-43" tabindex="-1"></a>        , metric <span class="sc">==</span> <span class="st">&quot;precision&quot;</span> <span class="sc">~</span> <span class="dv">3</span></span>
<span id="cb243-44"><a href="chm_sens_test.html#cb243-44" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span> </span>
<span id="cb243-45"><a href="chm_sens_test.html#cb243-45" tabindex="-1"></a>      <span class="fu">factor</span>(</span>
<span id="cb243-46"><a href="chm_sens_test.html#cb243-46" tabindex="-1"></a>        <span class="at">ordered =</span> T</span>
<span id="cb243-47"><a href="chm_sens_test.html#cb243-47" tabindex="-1"></a>        , <span class="at">levels =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span></span>
<span id="cb243-48"><a href="chm_sens_test.html#cb243-48" tabindex="-1"></a>        , <span class="at">labels =</span> <span class="fu">c</span>(</span>
<span id="cb243-49"><a href="chm_sens_test.html#cb243-49" tabindex="-1"></a>          <span class="st">&quot;F-score&quot;</span></span>
<span id="cb243-50"><a href="chm_sens_test.html#cb243-50" tabindex="-1"></a>          , <span class="st">&quot;Recall&quot;</span></span>
<span id="cb243-51"><a href="chm_sens_test.html#cb243-51" tabindex="-1"></a>          , <span class="st">&quot;Precision&quot;</span></span>
<span id="cb243-52"><a href="chm_sens_test.html#cb243-52" tabindex="-1"></a>        )</span>
<span id="cb243-53"><a href="chm_sens_test.html#cb243-53" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span> </span>
<span id="cb243-54"><a href="chm_sens_test.html#cb243-54" tabindex="-1"></a>      forcats<span class="sc">::</span><span class="fu">fct_rev</span>()</span>
<span id="cb243-55"><a href="chm_sens_test.html#cb243-55" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb243-56"><a href="chm_sens_test.html#cb243-56" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(</span>
<span id="cb243-57"><a href="chm_sens_test.html#cb243-57" tabindex="-1"></a>    <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">y =</span> median, <span class="at">x =</span> param_value, <span class="at">color =</span> metric, <span class="at">fill =</span> metric, <span class="at">group =</span> metric, <span class="at">shape =</span> metric)</span>
<span id="cb243-58"><a href="chm_sens_test.html#cb243-58" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb243-59"><a href="chm_sens_test.html#cb243-59" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_ribbon</span>(</span>
<span id="cb243-60"><a href="chm_sens_test.html#cb243-60" tabindex="-1"></a>    <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">ymin =</span> q25, <span class="at">ymax =</span> q75)</span>
<span id="cb243-61"><a href="chm_sens_test.html#cb243-61" tabindex="-1"></a>    , <span class="at">alpha =</span> <span class="fl">0.2</span>, <span class="at">color =</span> <span class="cn">NA</span></span>
<span id="cb243-62"><a href="chm_sens_test.html#cb243-62" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb243-63"><a href="chm_sens_test.html#cb243-63" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_line</span>(<span class="at">lwd =</span> <span class="fl">1.5</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb243-64"><a href="chm_sens_test.html#cb243-64" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb243-65"><a href="chm_sens_test.html#cb243-65" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">facet_wrap</span>(<span class="at">facets =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(param), <span class="at">scales =</span> <span class="st">&quot;free_x&quot;</span>) <span class="sc">+</span></span>
<span id="cb243-66"><a href="chm_sens_test.html#cb243-66" tabindex="-1"></a>  <span class="co"># ggplot2::scale_color_viridis_d(begin = 0.2, end = 0.8) +</span></span>
<span id="cb243-67"><a href="chm_sens_test.html#cb243-67" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">rev</span>(pal_eval_metric)) <span class="sc">+</span></span>
<span id="cb243-68"><a href="chm_sens_test.html#cb243-68" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">rev</span>(pal_eval_metric)) <span class="sc">+</span></span>
<span id="cb243-69"><a href="chm_sens_test.html#cb243-69" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">labels =</span> scales<span class="sc">::</span>percent, <span class="at">breaks =</span> scales<span class="sc">::</span><span class="fu">breaks_extended</span>(<span class="dv">10</span>)) <span class="sc">+</span></span>
<span id="cb243-70"><a href="chm_sens_test.html#cb243-70" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb243-71"><a href="chm_sens_test.html#cb243-71" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;&quot;</span>, <span class="at">y =</span> <span class="st">&quot;median value&quot;</span>, <span class="at">color =</span> <span class="st">&quot;&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;&quot;</span></span>
<span id="cb243-72"><a href="chm_sens_test.html#cb243-72" tabindex="-1"></a>    , <span class="at">subtitle =</span> <span class="st">&quot;Structural Data Only&quot;</span></span>
<span id="cb243-73"><a href="chm_sens_test.html#cb243-73" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb243-74"><a href="chm_sens_test.html#cb243-74" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb243-75"><a href="chm_sens_test.html#cb243-75" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb243-76"><a href="chm_sens_test.html#cb243-76" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;top&quot;</span></span>
<span id="cb243-77"><a href="chm_sens_test.html#cb243-77" tabindex="-1"></a>    , <span class="at">strip.text =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb243-78"><a href="chm_sens_test.html#cb243-78" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb243-79"><a href="chm_sens_test.html#cb243-79" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">guides</span>(</span>
<span id="cb243-80"><a href="chm_sens_test.html#cb243-80" tabindex="-1"></a>    <span class="at">color =</span> ggplot2<span class="sc">::</span><span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">shape =</span> <span class="dv">15</span>, <span class="at">linetype =</span> <span class="dv">0</span>, <span class="at">size =</span> <span class="dv">5</span>, <span class="at">alpha =</span> <span class="dv">1</span>))</span>
<span id="cb243-81"><a href="chm_sens_test.html#cb243-81" tabindex="-1"></a>    , <span class="at">shape =</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb243-82"><a href="chm_sens_test.html#cb243-82" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-211-1.png" width="1008" /></p>
<p>based on these main effect aggregated results using our point cloud and validation data:</p>
<ul>
<li>increasing the CHM resolution (making it more coarse) consistently reduced all detection accuracy metrics (F-score, precision, and recall) across the tested range of 0.1m to 0.5m</li>
<li>increasing the <code>max_ht_m</code> (which sets the maximum height of the CHM slice) steadily reduced precision. conversely, F-score and recall improved when the parameter was increased from 2 m to 3 m, remaining stable or slightly declining thereafter</li>
<li>increasing the <code>max_area_m2</code> (which determines the maximum pile area) had minimal impact on detection metrics once the value was set above ~10 m<sup>2</sup></li>
<li>increasing <code>convexity_pct</code> (toward 1 to favor more regular shapes) had minimal impact on metrics until values exceeded ~0.75. at this point, recall decreased significantly while precision improved but not enough to offset the losses from the recall decline as F-score plummeted</li>
<li>increasing <code>circle_fit_iou_pct</code> (toward 1 to favor circular shapes) improved precision and F-score up to a value of ~0.6 with minimal effect on recall. Beyond this point, recall dropped significantly and overall accuracy crashed past.</li>
</ul>
<p>do the trends vary by CHM resolution?</p>
<div class="sourceCode" id="cb244"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb244-1"><a href="chm_sens_test.html#cb244-1" tabindex="-1"></a>param_combos_gt_agg <span class="sc">%&gt;%</span> </span>
<span id="cb244-2"><a href="chm_sens_test.html#cb244-2" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(</span>
<span id="cb244-3"><a href="chm_sens_test.html#cb244-3" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">c</span>(precision,recall,f_score)</span>
<span id="cb244-4"><a href="chm_sens_test.html#cb244-4" tabindex="-1"></a>    , <span class="at">names_to =</span> <span class="st">&quot;metric&quot;</span></span>
<span id="cb244-5"><a href="chm_sens_test.html#cb244-5" tabindex="-1"></a>    , <span class="at">values_to =</span> <span class="st">&quot;value&quot;</span></span>
<span id="cb244-6"><a href="chm_sens_test.html#cb244-6" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb244-7"><a href="chm_sens_test.html#cb244-7" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(</span>
<span id="cb244-8"><a href="chm_sens_test.html#cb244-8" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">c</span>(max_ht_m,max_area_m2,convexity_pct,circle_fit_iou_pct)</span>
<span id="cb244-9"><a href="chm_sens_test.html#cb244-9" tabindex="-1"></a>    , <span class="at">names_to =</span> <span class="st">&quot;param&quot;</span></span>
<span id="cb244-10"><a href="chm_sens_test.html#cb244-10" tabindex="-1"></a>    , <span class="at">values_to =</span> <span class="st">&quot;param_value&quot;</span></span>
<span id="cb244-11"><a href="chm_sens_test.html#cb244-11" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb244-12"><a href="chm_sens_test.html#cb244-12" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(param, param_value, metric, chm_res_m) <span class="sc">%&gt;%</span></span>
<span id="cb244-13"><a href="chm_sens_test.html#cb244-13" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(</span>
<span id="cb244-14"><a href="chm_sens_test.html#cb244-14" tabindex="-1"></a>    <span class="at">median =</span> <span class="fu">median</span>(value,<span class="at">na.rm=</span>T)</span>
<span id="cb244-15"><a href="chm_sens_test.html#cb244-15" tabindex="-1"></a>    , <span class="at">q25 =</span> stats<span class="sc">::</span><span class="fu">quantile</span>(value,<span class="at">na.rm=</span>T,<span class="at">probs =</span> <span class="fl">0.25</span>)</span>
<span id="cb244-16"><a href="chm_sens_test.html#cb244-16" tabindex="-1"></a>    , <span class="at">q75 =</span> stats<span class="sc">::</span><span class="fu">quantile</span>(value,<span class="at">na.rm=</span>T,<span class="at">probs =</span> <span class="fl">0.75</span>)</span>
<span id="cb244-17"><a href="chm_sens_test.html#cb244-17" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb244-18"><a href="chm_sens_test.html#cb244-18" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb244-19"><a href="chm_sens_test.html#cb244-19" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb244-20"><a href="chm_sens_test.html#cb244-20" tabindex="-1"></a>    <span class="at">param =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb244-21"><a href="chm_sens_test.html#cb244-21" tabindex="-1"></a>        param <span class="sc">==</span> <span class="st">&quot;chm_res_m&quot;</span> <span class="sc">~</span> <span class="dv">1</span></span>
<span id="cb244-22"><a href="chm_sens_test.html#cb244-22" tabindex="-1"></a>        , param <span class="sc">==</span> <span class="st">&quot;max_ht_m&quot;</span> <span class="sc">~</span> <span class="dv">2</span></span>
<span id="cb244-23"><a href="chm_sens_test.html#cb244-23" tabindex="-1"></a>        , param <span class="sc">==</span> <span class="st">&quot;min_area_m2&quot;</span> <span class="sc">~</span> <span class="dv">3</span></span>
<span id="cb244-24"><a href="chm_sens_test.html#cb244-24" tabindex="-1"></a>        , param <span class="sc">==</span> <span class="st">&quot;max_area_m2&quot;</span> <span class="sc">~</span> <span class="dv">4</span></span>
<span id="cb244-25"><a href="chm_sens_test.html#cb244-25" tabindex="-1"></a>        , param <span class="sc">==</span> <span class="st">&quot;convexity_pct&quot;</span> <span class="sc">~</span> <span class="dv">5</span></span>
<span id="cb244-26"><a href="chm_sens_test.html#cb244-26" tabindex="-1"></a>        , param <span class="sc">==</span> <span class="st">&quot;circle_fit_iou_pct&quot;</span> <span class="sc">~</span> <span class="dv">6</span></span>
<span id="cb244-27"><a href="chm_sens_test.html#cb244-27" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span> </span>
<span id="cb244-28"><a href="chm_sens_test.html#cb244-28" tabindex="-1"></a>      <span class="fu">factor</span>(</span>
<span id="cb244-29"><a href="chm_sens_test.html#cb244-29" tabindex="-1"></a>        <span class="at">ordered =</span> T</span>
<span id="cb244-30"><a href="chm_sens_test.html#cb244-30" tabindex="-1"></a>        , <span class="at">levels =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">6</span></span>
<span id="cb244-31"><a href="chm_sens_test.html#cb244-31" tabindex="-1"></a>        , <span class="at">labels =</span> <span class="fu">c</span>(</span>
<span id="cb244-32"><a href="chm_sens_test.html#cb244-32" tabindex="-1"></a>          <span class="st">&quot;CHM resolution (m)&quot;</span></span>
<span id="cb244-33"><a href="chm_sens_test.html#cb244-33" tabindex="-1"></a>          , <span class="st">&quot;max_ht_m&quot;</span></span>
<span id="cb244-34"><a href="chm_sens_test.html#cb244-34" tabindex="-1"></a>          , <span class="st">&quot;min_area_m2&quot;</span></span>
<span id="cb244-35"><a href="chm_sens_test.html#cb244-35" tabindex="-1"></a>          , <span class="st">&quot;max_area_m2&quot;</span></span>
<span id="cb244-36"><a href="chm_sens_test.html#cb244-36" tabindex="-1"></a>          , <span class="st">&quot;convexity_pct&quot;</span></span>
<span id="cb244-37"><a href="chm_sens_test.html#cb244-37" tabindex="-1"></a>          , <span class="st">&quot;circle_fit_iou_pct&quot;</span></span>
<span id="cb244-38"><a href="chm_sens_test.html#cb244-38" tabindex="-1"></a>        )</span>
<span id="cb244-39"><a href="chm_sens_test.html#cb244-39" tabindex="-1"></a>      )</span>
<span id="cb244-40"><a href="chm_sens_test.html#cb244-40" tabindex="-1"></a>    , <span class="at">metric =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb244-41"><a href="chm_sens_test.html#cb244-41" tabindex="-1"></a>        metric <span class="sc">==</span> <span class="st">&quot;f_score&quot;</span> <span class="sc">~</span> <span class="dv">1</span></span>
<span id="cb244-42"><a href="chm_sens_test.html#cb244-42" tabindex="-1"></a>        , metric <span class="sc">==</span> <span class="st">&quot;recall&quot;</span> <span class="sc">~</span> <span class="dv">2</span></span>
<span id="cb244-43"><a href="chm_sens_test.html#cb244-43" tabindex="-1"></a>        , metric <span class="sc">==</span> <span class="st">&quot;precision&quot;</span> <span class="sc">~</span> <span class="dv">3</span></span>
<span id="cb244-44"><a href="chm_sens_test.html#cb244-44" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span> </span>
<span id="cb244-45"><a href="chm_sens_test.html#cb244-45" tabindex="-1"></a>      <span class="fu">factor</span>(</span>
<span id="cb244-46"><a href="chm_sens_test.html#cb244-46" tabindex="-1"></a>        <span class="at">ordered =</span> T</span>
<span id="cb244-47"><a href="chm_sens_test.html#cb244-47" tabindex="-1"></a>        , <span class="at">levels =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span></span>
<span id="cb244-48"><a href="chm_sens_test.html#cb244-48" tabindex="-1"></a>        , <span class="at">labels =</span> <span class="fu">c</span>(</span>
<span id="cb244-49"><a href="chm_sens_test.html#cb244-49" tabindex="-1"></a>          <span class="st">&quot;F-score&quot;</span></span>
<span id="cb244-50"><a href="chm_sens_test.html#cb244-50" tabindex="-1"></a>          , <span class="st">&quot;Recall&quot;</span></span>
<span id="cb244-51"><a href="chm_sens_test.html#cb244-51" tabindex="-1"></a>          , <span class="st">&quot;Precision&quot;</span></span>
<span id="cb244-52"><a href="chm_sens_test.html#cb244-52" tabindex="-1"></a>        )</span>
<span id="cb244-53"><a href="chm_sens_test.html#cb244-53" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span> </span>
<span id="cb244-54"><a href="chm_sens_test.html#cb244-54" tabindex="-1"></a>      forcats<span class="sc">::</span><span class="fu">fct_rev</span>()</span>
<span id="cb244-55"><a href="chm_sens_test.html#cb244-55" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb244-56"><a href="chm_sens_test.html#cb244-56" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(</span>
<span id="cb244-57"><a href="chm_sens_test.html#cb244-57" tabindex="-1"></a>    <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">y =</span> median, <span class="at">x =</span> param_value, <span class="at">color =</span> metric, <span class="at">fill =</span> metric, <span class="at">group =</span> metric, <span class="at">shape =</span> metric)</span>
<span id="cb244-58"><a href="chm_sens_test.html#cb244-58" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb244-59"><a href="chm_sens_test.html#cb244-59" tabindex="-1"></a>  <span class="co"># ggplot2::geom_ribbon(</span></span>
<span id="cb244-60"><a href="chm_sens_test.html#cb244-60" tabindex="-1"></a>  <span class="co">#   mapping = ggplot2::aes(ymin = q25, ymax = q75)</span></span>
<span id="cb244-61"><a href="chm_sens_test.html#cb244-61" tabindex="-1"></a>  <span class="co">#   , alpha = 0.2, color = NA</span></span>
<span id="cb244-62"><a href="chm_sens_test.html#cb244-62" tabindex="-1"></a>  <span class="co"># ) +</span></span>
<span id="cb244-63"><a href="chm_sens_test.html#cb244-63" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_line</span>(<span class="at">lwd =</span> <span class="fl">1.5</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb244-64"><a href="chm_sens_test.html#cb244-64" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb244-65"><a href="chm_sens_test.html#cb244-65" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">facet_grid</span>(<span class="at">cols =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(param), <span class="at">rows =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(chm_res_m), <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>) <span class="sc">+</span></span>
<span id="cb244-66"><a href="chm_sens_test.html#cb244-66" tabindex="-1"></a>  <span class="co"># ggplot2::scale_color_viridis_d(begin = 0.2, end = 0.8) +</span></span>
<span id="cb244-67"><a href="chm_sens_test.html#cb244-67" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">rev</span>(pal_eval_metric)) <span class="sc">+</span></span>
<span id="cb244-68"><a href="chm_sens_test.html#cb244-68" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">rev</span>(pal_eval_metric)) <span class="sc">+</span></span>
<span id="cb244-69"><a href="chm_sens_test.html#cb244-69" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>percent) <span class="sc">+</span></span>
<span id="cb244-70"><a href="chm_sens_test.html#cb244-70" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb244-71"><a href="chm_sens_test.html#cb244-71" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;&quot;</span>, <span class="at">y =</span> <span class="st">&quot;median value&quot;</span>, <span class="at">color =</span> <span class="st">&quot;&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;&quot;</span></span>
<span id="cb244-72"><a href="chm_sens_test.html#cb244-72" tabindex="-1"></a>    , <span class="at">subtitle =</span> <span class="st">&quot;Structural Data Only&quot;</span></span>
<span id="cb244-73"><a href="chm_sens_test.html#cb244-73" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb244-74"><a href="chm_sens_test.html#cb244-74" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb244-75"><a href="chm_sens_test.html#cb244-75" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb244-76"><a href="chm_sens_test.html#cb244-76" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;top&quot;</span></span>
<span id="cb244-77"><a href="chm_sens_test.html#cb244-77" tabindex="-1"></a>    , <span class="at">strip.text =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb244-78"><a href="chm_sens_test.html#cb244-78" tabindex="-1"></a>    , <span class="at">axis.text =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">7</span>)</span>
<span id="cb244-79"><a href="chm_sens_test.html#cb244-79" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb244-80"><a href="chm_sens_test.html#cb244-80" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">guides</span>(</span>
<span id="cb244-81"><a href="chm_sens_test.html#cb244-81" tabindex="-1"></a>    <span class="at">color =</span> ggplot2<span class="sc">::</span><span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">shape =</span> <span class="dv">15</span>, <span class="at">linetype =</span> <span class="dv">0</span>, <span class="at">size =</span> <span class="dv">5</span>, <span class="at">alpha =</span> <span class="dv">1</span>))</span>
<span id="cb244-82"><a href="chm_sens_test.html#cb244-82" tabindex="-1"></a>    , <span class="at">shape =</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb244-83"><a href="chm_sens_test.html#cb244-83" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-212-1.png" width="1008" /></p>
<p>generally, the tends do not appear to vary substantially by CHM resolution but we can see that detection accuracy decreases as CHM resolution becomes more coarse</p>
</div>
<div id="quant_trends" class="section level3 hasAnchor" number="8.5.2">
<h3><span class="header-section-number">8.5.2</span> Main Effects: form quantification<a href="chm_sens_test.html#quant_trends" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>let’s check out the the ability of the method to properly extract the form of the piles by looking at the quantification accuracy metrics where:</p>
<ul>
<li><strong>Mean Error (ME)</strong> represents the direction of bias (over or under-prediction) in the original units</li>
<li><strong>RMSE</strong> represents the typical magnitude of error in the original units, with a stronger penalty for large errors</li>
<li><strong>MAPE</strong> represents the typical magnitude of error as a percentage, allowing for scale-independent comparisons</li>
</ul>
<p>as a reminder regarding the form quantification accuracy evaluation, we will assess the method’s accuracy by comparing the true-positive matches using the following metrics:</p>
<ul>
<li><strong>Diameter</strong> compares the predicted diameter (from the maximum internal distance) to the ground truth field-measured diameter</li>
<li><strong>Area</strong> compares the predicted area from the irregular shape to the image-annotated area based on the potentially irregular pile perimeter</li>
<li><strong>Height</strong> compares the predicted maximum height from the CHM to the ground truth field-measured height</li>
</ul>
<p>what is the quantification accuracy across all parameter combinations tested for each CHM resolution?</p>
<div class="sourceCode" id="cb245"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb245-1"><a href="chm_sens_test.html#cb245-1" tabindex="-1"></a><span class="co"># let&#39;s average across all other factors to look at the main effect by parameter for the **MAPE** metrics quantifying the pile form accuracy</span></span>
<span id="cb245-2"><a href="chm_sens_test.html#cb245-2" tabindex="-1"></a><span class="co"># this is a lot of work, so we&#39;re going to make it a function</span></span>
<span id="cb245-3"><a href="chm_sens_test.html#cb245-3" tabindex="-1"></a>plt_form_quantification_trend <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb245-4"><a href="chm_sens_test.html#cb245-4" tabindex="-1"></a>  df</span>
<span id="cb245-5"><a href="chm_sens_test.html#cb245-5" tabindex="-1"></a>  , <span class="at">my_subtitle =</span> <span class="st">&quot;&quot;</span></span>
<span id="cb245-6"><a href="chm_sens_test.html#cb245-6" tabindex="-1"></a>  , <span class="at">quant_metric =</span> <span class="st">&quot;mape&quot;</span> <span class="co"># rmse, mean, mape</span></span>
<span id="cb245-7"><a href="chm_sens_test.html#cb245-7" tabindex="-1"></a>) {</span>
<span id="cb245-8"><a href="chm_sens_test.html#cb245-8" tabindex="-1"></a>  quant_metric <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb245-9"><a href="chm_sens_test.html#cb245-9" tabindex="-1"></a>      <span class="fu">tolower</span>(quant_metric) <span class="sc">==</span> <span class="st">&quot;mape&quot;</span> <span class="sc">~</span> <span class="st">&quot;mape&quot;</span></span>
<span id="cb245-10"><a href="chm_sens_test.html#cb245-10" tabindex="-1"></a>      , <span class="fu">tolower</span>(quant_metric) <span class="sc">==</span> <span class="st">&quot;rmse&quot;</span> <span class="sc">~</span> <span class="st">&quot;rmse&quot;</span></span>
<span id="cb245-11"><a href="chm_sens_test.html#cb245-11" tabindex="-1"></a>      , <span class="fu">tolower</span>(quant_metric) <span class="sc">==</span> <span class="st">&quot;mean&quot;</span> <span class="sc">~</span> <span class="st">&quot;mean&quot;</span></span>
<span id="cb245-12"><a href="chm_sens_test.html#cb245-12" tabindex="-1"></a>      , T <span class="sc">~</span> <span class="st">&quot;mape&quot;</span></span>
<span id="cb245-13"><a href="chm_sens_test.html#cb245-13" tabindex="-1"></a>    )</span>
<span id="cb245-14"><a href="chm_sens_test.html#cb245-14" tabindex="-1"></a>  </span>
<span id="cb245-15"><a href="chm_sens_test.html#cb245-15" tabindex="-1"></a>  p <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> </span>
<span id="cb245-16"><a href="chm_sens_test.html#cb245-16" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(</span>
<span id="cb245-17"><a href="chm_sens_test.html#cb245-17" tabindex="-1"></a>    <span class="at">cols =</span> tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="fu">paste0</span>(<span class="st">&quot;_&quot;</span>,quant_metric))</span>
<span id="cb245-18"><a href="chm_sens_test.html#cb245-18" tabindex="-1"></a>    , <span class="at">names_to =</span> <span class="st">&quot;metric&quot;</span></span>
<span id="cb245-19"><a href="chm_sens_test.html#cb245-19" tabindex="-1"></a>    , <span class="at">values_to =</span> <span class="st">&quot;value&quot;</span></span>
<span id="cb245-20"><a href="chm_sens_test.html#cb245-20" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb245-21"><a href="chm_sens_test.html#cb245-21" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(</span>
<span id="cb245-22"><a href="chm_sens_test.html#cb245-22" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">c</span>(max_ht_m,max_area_m2,convexity_pct,circle_fit_iou_pct,chm_res_m)</span>
<span id="cb245-23"><a href="chm_sens_test.html#cb245-23" tabindex="-1"></a>    , <span class="at">names_to =</span> <span class="st">&quot;param&quot;</span></span>
<span id="cb245-24"><a href="chm_sens_test.html#cb245-24" tabindex="-1"></a>    , <span class="at">values_to =</span> <span class="st">&quot;param_value&quot;</span></span>
<span id="cb245-25"><a href="chm_sens_test.html#cb245-25" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb245-26"><a href="chm_sens_test.html#cb245-26" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(param, param_value, metric) <span class="sc">%&gt;%</span></span>
<span id="cb245-27"><a href="chm_sens_test.html#cb245-27" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(</span>
<span id="cb245-28"><a href="chm_sens_test.html#cb245-28" tabindex="-1"></a>    <span class="at">median =</span> <span class="fu">median</span>(value,<span class="at">na.rm=</span>T)</span>
<span id="cb245-29"><a href="chm_sens_test.html#cb245-29" tabindex="-1"></a>    , <span class="at">q25 =</span> stats<span class="sc">::</span><span class="fu">quantile</span>(value,<span class="at">na.rm=</span>T,<span class="at">probs =</span> <span class="fl">0.25</span>)</span>
<span id="cb245-30"><a href="chm_sens_test.html#cb245-30" tabindex="-1"></a>    , <span class="at">q75 =</span> stats<span class="sc">::</span><span class="fu">quantile</span>(value,<span class="at">na.rm=</span>T,<span class="at">probs =</span> <span class="fl">0.75</span>)</span>
<span id="cb245-31"><a href="chm_sens_test.html#cb245-31" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb245-32"><a href="chm_sens_test.html#cb245-32" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb245-33"><a href="chm_sens_test.html#cb245-33" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb245-34"><a href="chm_sens_test.html#cb245-34" tabindex="-1"></a>    <span class="at">param =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb245-35"><a href="chm_sens_test.html#cb245-35" tabindex="-1"></a>        param <span class="sc">==</span> <span class="st">&quot;chm_res_m&quot;</span> <span class="sc">~</span> <span class="dv">1</span></span>
<span id="cb245-36"><a href="chm_sens_test.html#cb245-36" tabindex="-1"></a>        , param <span class="sc">==</span> <span class="st">&quot;max_ht_m&quot;</span> <span class="sc">~</span> <span class="dv">2</span></span>
<span id="cb245-37"><a href="chm_sens_test.html#cb245-37" tabindex="-1"></a>        , param <span class="sc">==</span> <span class="st">&quot;min_area_m2&quot;</span> <span class="sc">~</span> <span class="dv">3</span></span>
<span id="cb245-38"><a href="chm_sens_test.html#cb245-38" tabindex="-1"></a>        , param <span class="sc">==</span> <span class="st">&quot;max_area_m2&quot;</span> <span class="sc">~</span> <span class="dv">4</span></span>
<span id="cb245-39"><a href="chm_sens_test.html#cb245-39" tabindex="-1"></a>        , param <span class="sc">==</span> <span class="st">&quot;convexity_pct&quot;</span> <span class="sc">~</span> <span class="dv">5</span></span>
<span id="cb245-40"><a href="chm_sens_test.html#cb245-40" tabindex="-1"></a>        , param <span class="sc">==</span> <span class="st">&quot;circle_fit_iou_pct&quot;</span> <span class="sc">~</span> <span class="dv">6</span></span>
<span id="cb245-41"><a href="chm_sens_test.html#cb245-41" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span> </span>
<span id="cb245-42"><a href="chm_sens_test.html#cb245-42" tabindex="-1"></a>      <span class="fu">factor</span>(</span>
<span id="cb245-43"><a href="chm_sens_test.html#cb245-43" tabindex="-1"></a>        <span class="at">ordered =</span> T</span>
<span id="cb245-44"><a href="chm_sens_test.html#cb245-44" tabindex="-1"></a>        , <span class="at">levels =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">6</span></span>
<span id="cb245-45"><a href="chm_sens_test.html#cb245-45" tabindex="-1"></a>        , <span class="at">labels =</span> <span class="fu">c</span>(</span>
<span id="cb245-46"><a href="chm_sens_test.html#cb245-46" tabindex="-1"></a>          <span class="st">&quot;CHM resolution (m)&quot;</span></span>
<span id="cb245-47"><a href="chm_sens_test.html#cb245-47" tabindex="-1"></a>          , <span class="st">&quot;max_ht_m&quot;</span></span>
<span id="cb245-48"><a href="chm_sens_test.html#cb245-48" tabindex="-1"></a>          , <span class="st">&quot;min_area_m2&quot;</span></span>
<span id="cb245-49"><a href="chm_sens_test.html#cb245-49" tabindex="-1"></a>          , <span class="st">&quot;max_area_m2&quot;</span></span>
<span id="cb245-50"><a href="chm_sens_test.html#cb245-50" tabindex="-1"></a>          , <span class="st">&quot;convexity_pct&quot;</span></span>
<span id="cb245-51"><a href="chm_sens_test.html#cb245-51" tabindex="-1"></a>          , <span class="st">&quot;circle_fit_iou_pct&quot;</span></span>
<span id="cb245-52"><a href="chm_sens_test.html#cb245-52" tabindex="-1"></a>        )</span>
<span id="cb245-53"><a href="chm_sens_test.html#cb245-53" tabindex="-1"></a>      )</span>
<span id="cb245-54"><a href="chm_sens_test.html#cb245-54" tabindex="-1"></a>    , <span class="at">pile_metric =</span> metric <span class="sc">%&gt;%</span> </span>
<span id="cb245-55"><a href="chm_sens_test.html#cb245-55" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_remove</span>(<span class="st">&quot;(_rmse|_rrmse|_mean|_mape)$&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb245-56"><a href="chm_sens_test.html#cb245-56" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_extract</span>(<span class="st">&quot;(paraboloid_volume|volume|area|height|diameter)&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb245-57"><a href="chm_sens_test.html#cb245-57" tabindex="-1"></a>      <span class="fu">factor</span>(</span>
<span id="cb245-58"><a href="chm_sens_test.html#cb245-58" tabindex="-1"></a>        <span class="at">ordered =</span> T</span>
<span id="cb245-59"><a href="chm_sens_test.html#cb245-59" tabindex="-1"></a>        , <span class="at">levels =</span> <span class="fu">c</span>(</span>
<span id="cb245-60"><a href="chm_sens_test.html#cb245-60" tabindex="-1"></a>          <span class="st">&quot;volume&quot;</span></span>
<span id="cb245-61"><a href="chm_sens_test.html#cb245-61" tabindex="-1"></a>          , <span class="st">&quot;paraboloid_volume&quot;</span></span>
<span id="cb245-62"><a href="chm_sens_test.html#cb245-62" tabindex="-1"></a>          , <span class="st">&quot;area&quot;</span></span>
<span id="cb245-63"><a href="chm_sens_test.html#cb245-63" tabindex="-1"></a>          , <span class="st">&quot;height&quot;</span></span>
<span id="cb245-64"><a href="chm_sens_test.html#cb245-64" tabindex="-1"></a>          , <span class="st">&quot;diameter&quot;</span></span>
<span id="cb245-65"><a href="chm_sens_test.html#cb245-65" tabindex="-1"></a>        )</span>
<span id="cb245-66"><a href="chm_sens_test.html#cb245-66" tabindex="-1"></a>        , <span class="at">labels =</span> <span class="fu">c</span>(</span>
<span id="cb245-67"><a href="chm_sens_test.html#cb245-67" tabindex="-1"></a>          <span class="st">&quot;Volume&quot;</span></span>
<span id="cb245-68"><a href="chm_sens_test.html#cb245-68" tabindex="-1"></a>          , <span class="st">&quot;Volume paraboloid&quot;</span></span>
<span id="cb245-69"><a href="chm_sens_test.html#cb245-69" tabindex="-1"></a>          , <span class="st">&quot;Area (m2)&quot;</span></span>
<span id="cb245-70"><a href="chm_sens_test.html#cb245-70" tabindex="-1"></a>          , <span class="st">&quot;Height (m)&quot;</span></span>
<span id="cb245-71"><a href="chm_sens_test.html#cb245-71" tabindex="-1"></a>          , <span class="st">&quot;Diameter (m)&quot;</span></span>
<span id="cb245-72"><a href="chm_sens_test.html#cb245-72" tabindex="-1"></a>        )</span>
<span id="cb245-73"><a href="chm_sens_test.html#cb245-73" tabindex="-1"></a>      )</span>
<span id="cb245-74"><a href="chm_sens_test.html#cb245-74" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb245-75"><a href="chm_sens_test.html#cb245-75" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(</span>
<span id="cb245-76"><a href="chm_sens_test.html#cb245-76" tabindex="-1"></a>    <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">y =</span> median, <span class="at">x =</span> param_value, <span class="at">color =</span> pile_metric, <span class="at">fill =</span> pile_metric, <span class="at">group =</span> pile_metric) <span class="co">#, shape = pile_metric)</span></span>
<span id="cb245-77"><a href="chm_sens_test.html#cb245-77" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb245-78"><a href="chm_sens_test.html#cb245-78" tabindex="-1"></a>  <span class="co"># ggplot2::geom_ribbon(</span></span>
<span id="cb245-79"><a href="chm_sens_test.html#cb245-79" tabindex="-1"></a>  <span class="co">#   mapping = ggplot2::aes(ymin = q25, ymax = q75)</span></span>
<span id="cb245-80"><a href="chm_sens_test.html#cb245-80" tabindex="-1"></a>  <span class="co">#   , alpha = 0.2, color = NA</span></span>
<span id="cb245-81"><a href="chm_sens_test.html#cb245-81" tabindex="-1"></a>  <span class="co"># ) +</span></span>
<span id="cb245-82"><a href="chm_sens_test.html#cb245-82" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_line</span>(<span class="at">lwd =</span> <span class="fl">1.5</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb245-83"><a href="chm_sens_test.html#cb245-83" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb245-84"><a href="chm_sens_test.html#cb245-84" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">facet_grid</span>(<span class="at">cols =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(param), <span class="at">rows =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(pile_metric), <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>, <span class="at">axes =</span> <span class="st">&quot;all&quot;</span>) <span class="sc">+</span></span>
<span id="cb245-85"><a href="chm_sens_test.html#cb245-85" tabindex="-1"></a>  <span class="co"># ggplot2::scale_color_viridis_d(begin = 0.2, end = 0.8) +</span></span>
<span id="cb245-86"><a href="chm_sens_test.html#cb245-86" tabindex="-1"></a>  harrypotter<span class="sc">::</span><span class="fu">scale_fill_hp_d</span>(<span class="at">option =</span> <span class="st">&quot;hermionegranger&quot;</span>) <span class="sc">+</span></span>
<span id="cb245-87"><a href="chm_sens_test.html#cb245-87" tabindex="-1"></a>  harrypotter<span class="sc">::</span><span class="fu">scale_color_hp_d</span>(<span class="at">option =</span> <span class="st">&quot;hermionegranger&quot;</span>) <span class="sc">+</span></span>
<span id="cb245-88"><a href="chm_sens_test.html#cb245-88" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb245-89"><a href="chm_sens_test.html#cb245-89" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;&quot;</span></span>
<span id="cb245-90"><a href="chm_sens_test.html#cb245-90" tabindex="-1"></a>    , <span class="at">y =</span> <span class="fu">paste0</span>(<span class="fu">ifelse</span>(quant_metric<span class="sc">==</span><span class="st">&quot;mean&quot;</span>,<span class="st">&quot;Mean Error&quot;</span>, <span class="fu">toupper</span>(quant_metric)), <span class="st">&quot; (median)&quot;</span>)</span>
<span id="cb245-91"><a href="chm_sens_test.html#cb245-91" tabindex="-1"></a>    , <span class="at">color =</span> <span class="st">&quot;&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;&quot;</span></span>
<span id="cb245-92"><a href="chm_sens_test.html#cb245-92" tabindex="-1"></a>    , <span class="at">title =</span> <span class="fu">ifelse</span>(quant_metric<span class="sc">==</span><span class="st">&quot;mean&quot;</span>,<span class="st">&quot;Mean Error&quot;</span>, <span class="fu">toupper</span>(quant_metric))</span>
<span id="cb245-93"><a href="chm_sens_test.html#cb245-93" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb245-94"><a href="chm_sens_test.html#cb245-94" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb245-95"><a href="chm_sens_test.html#cb245-95" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb245-96"><a href="chm_sens_test.html#cb245-96" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb245-97"><a href="chm_sens_test.html#cb245-97" tabindex="-1"></a>    , <span class="at">strip.text =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb245-98"><a href="chm_sens_test.html#cb245-98" tabindex="-1"></a>    , <span class="at">axis.text.x =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">7</span>)</span>
<span id="cb245-99"><a href="chm_sens_test.html#cb245-99" tabindex="-1"></a>    , <span class="at">axis.text.y =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>)</span>
<span id="cb245-100"><a href="chm_sens_test.html#cb245-100" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb245-101"><a href="chm_sens_test.html#cb245-101" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">guides</span>(</span>
<span id="cb245-102"><a href="chm_sens_test.html#cb245-102" tabindex="-1"></a>    <span class="at">color =</span> ggplot2<span class="sc">::</span><span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">shape =</span> <span class="dv">15</span>, <span class="at">linetype =</span> <span class="dv">0</span>, <span class="at">size =</span> <span class="dv">5</span>, <span class="at">alpha =</span> <span class="dv">1</span>))</span>
<span id="cb245-103"><a href="chm_sens_test.html#cb245-103" tabindex="-1"></a>    , <span class="at">shape =</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb245-104"><a href="chm_sens_test.html#cb245-104" tabindex="-1"></a>  )</span>
<span id="cb245-105"><a href="chm_sens_test.html#cb245-105" tabindex="-1"></a>  </span>
<span id="cb245-106"><a href="chm_sens_test.html#cb245-106" tabindex="-1"></a>  <span class="cf">if</span>(quant_metric <span class="sc">==</span> <span class="st">&quot;mape&quot;</span>){</span>
<span id="cb245-107"><a href="chm_sens_test.html#cb245-107" tabindex="-1"></a>    p <span class="ot">&lt;-</span> p <span class="sc">+</span></span>
<span id="cb245-108"><a href="chm_sens_test.html#cb245-108" tabindex="-1"></a>      ggplot2<span class="sc">::</span><span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>percent, <span class="at">breaks =</span> scales<span class="sc">::</span><span class="fu">breaks_extended</span>(<span class="dv">10</span>))</span>
<span id="cb245-109"><a href="chm_sens_test.html#cb245-109" tabindex="-1"></a>  }<span class="cf">else</span>{</span>
<span id="cb245-110"><a href="chm_sens_test.html#cb245-110" tabindex="-1"></a>    p <span class="ot">&lt;-</span> p <span class="sc">+</span></span>
<span id="cb245-111"><a href="chm_sens_test.html#cb245-111" tabindex="-1"></a>      ggplot2<span class="sc">::</span><span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>comma, <span class="at">breaks =</span> scales<span class="sc">::</span><span class="fu">breaks_extended</span>(<span class="dv">10</span>))</span>
<span id="cb245-112"><a href="chm_sens_test.html#cb245-112" tabindex="-1"></a>  }</span>
<span id="cb245-113"><a href="chm_sens_test.html#cb245-113" tabindex="-1"></a>  <span class="fu">return</span>(p)</span>
<span id="cb245-114"><a href="chm_sens_test.html#cb245-114" tabindex="-1"></a>}</span>
<span id="cb245-115"><a href="chm_sens_test.html#cb245-115" tabindex="-1"></a><span class="co"># plt_form_quantification_trend(param_combos_gt_agg, quant_metric = &quot;mean&quot;)</span></span>
<span id="cb245-116"><a href="chm_sens_test.html#cb245-116" tabindex="-1"></a><span class="co"># plt_form_quantification_trend(param_combos_gt_agg, quant_metric = &quot;mape&quot;)</span></span>
<span id="cb245-117"><a href="chm_sens_test.html#cb245-117" tabindex="-1"></a></span>
<span id="cb245-118"><a href="chm_sens_test.html#cb245-118" tabindex="-1"></a><span class="co"># this is a lot of work, so we&#39;re going to make it a function</span></span>
<span id="cb245-119"><a href="chm_sens_test.html#cb245-119" tabindex="-1"></a>plt_form_quantification_dist2 <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb245-120"><a href="chm_sens_test.html#cb245-120" tabindex="-1"></a>  df</span>
<span id="cb245-121"><a href="chm_sens_test.html#cb245-121" tabindex="-1"></a>  , <span class="at">my_subtitle =</span> <span class="st">&quot;&quot;</span></span>
<span id="cb245-122"><a href="chm_sens_test.html#cb245-122" tabindex="-1"></a>  , <span class="at">show_rug =</span> T</span>
<span id="cb245-123"><a href="chm_sens_test.html#cb245-123" tabindex="-1"></a>  , <span class="at">quant_metric =</span> <span class="st">&quot;mape&quot;</span> <span class="co"># rmse, mean, mape</span></span>
<span id="cb245-124"><a href="chm_sens_test.html#cb245-124" tabindex="-1"></a>) {</span>
<span id="cb245-125"><a href="chm_sens_test.html#cb245-125" tabindex="-1"></a>  <span class="co"># reshape data to go long by evaluation metric</span></span>
<span id="cb245-126"><a href="chm_sens_test.html#cb245-126" tabindex="-1"></a>  df_temp <span class="ot">&lt;-</span></span>
<span id="cb245-127"><a href="chm_sens_test.html#cb245-127" tabindex="-1"></a>    df <span class="sc">%&gt;%</span> </span>
<span id="cb245-128"><a href="chm_sens_test.html#cb245-128" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb245-129"><a href="chm_sens_test.html#cb245-129" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb245-130"><a href="chm_sens_test.html#cb245-130" tabindex="-1"></a>      max_ht_m,max_area_m2,convexity_pct,circle_fit_iou_pct,chm_res_m_desc,chm_res_m</span>
<span id="cb245-131"><a href="chm_sens_test.html#cb245-131" tabindex="-1"></a>      <span class="co"># quantification</span></span>
<span id="cb245-132"><a href="chm_sens_test.html#cb245-132" tabindex="-1"></a>      , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_rmse&quot;</span>)</span>
<span id="cb245-133"><a href="chm_sens_test.html#cb245-133" tabindex="-1"></a>      , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_rrmse&quot;</span>)</span>
<span id="cb245-134"><a href="chm_sens_test.html#cb245-134" tabindex="-1"></a>      , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_mean&quot;</span>)</span>
<span id="cb245-135"><a href="chm_sens_test.html#cb245-135" tabindex="-1"></a>      , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_mape&quot;</span>)</span>
<span id="cb245-136"><a href="chm_sens_test.html#cb245-136" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb245-137"><a href="chm_sens_test.html#cb245-137" tabindex="-1"></a>    tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(</span>
<span id="cb245-138"><a href="chm_sens_test.html#cb245-138" tabindex="-1"></a>      <span class="at">cols =</span> <span class="fu">c</span>(</span>
<span id="cb245-139"><a href="chm_sens_test.html#cb245-139" tabindex="-1"></a>        tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_rmse&quot;</span>)</span>
<span id="cb245-140"><a href="chm_sens_test.html#cb245-140" tabindex="-1"></a>        , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_rrmse&quot;</span>)</span>
<span id="cb245-141"><a href="chm_sens_test.html#cb245-141" tabindex="-1"></a>        , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_mean&quot;</span>)</span>
<span id="cb245-142"><a href="chm_sens_test.html#cb245-142" tabindex="-1"></a>        , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_mape&quot;</span>)</span>
<span id="cb245-143"><a href="chm_sens_test.html#cb245-143" tabindex="-1"></a>      )</span>
<span id="cb245-144"><a href="chm_sens_test.html#cb245-144" tabindex="-1"></a>      , <span class="at">names_to =</span> <span class="st">&quot;metric&quot;</span></span>
<span id="cb245-145"><a href="chm_sens_test.html#cb245-145" tabindex="-1"></a>      , <span class="at">values_to =</span> <span class="st">&quot;value&quot;</span></span>
<span id="cb245-146"><a href="chm_sens_test.html#cb245-146" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb245-147"><a href="chm_sens_test.html#cb245-147" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb245-148"><a href="chm_sens_test.html#cb245-148" tabindex="-1"></a>      <span class="at">eval_metric =</span> stringr<span class="sc">::</span><span class="fu">str_extract</span>(metric, <span class="st">&quot;(_rmse|_rrmse|_mean|_mape)$&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb245-149"><a href="chm_sens_test.html#cb245-149" tabindex="-1"></a>        stringr<span class="sc">::</span><span class="fu">str_remove_all</span>(<span class="st">&quot;_&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb245-150"><a href="chm_sens_test.html#cb245-150" tabindex="-1"></a>        stringr<span class="sc">::</span><span class="fu">str_replace_all</span>(<span class="st">&quot;mean&quot;</span>,<span class="st">&quot;me&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb245-151"><a href="chm_sens_test.html#cb245-151" tabindex="-1"></a>        <span class="fu">toupper</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb245-152"><a href="chm_sens_test.html#cb245-152" tabindex="-1"></a>        <span class="fu">factor</span>(</span>
<span id="cb245-153"><a href="chm_sens_test.html#cb245-153" tabindex="-1"></a>          <span class="at">ordered =</span> T</span>
<span id="cb245-154"><a href="chm_sens_test.html#cb245-154" tabindex="-1"></a>          , <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;ME&quot;</span>,<span class="st">&quot;RMSE&quot;</span>,<span class="st">&quot;RRMSE&quot;</span>,<span class="st">&quot;MAPE&quot;</span>)</span>
<span id="cb245-155"><a href="chm_sens_test.html#cb245-155" tabindex="-1"></a>        )</span>
<span id="cb245-156"><a href="chm_sens_test.html#cb245-156" tabindex="-1"></a>      , <span class="at">pile_metric =</span> metric <span class="sc">%&gt;%</span> </span>
<span id="cb245-157"><a href="chm_sens_test.html#cb245-157" tabindex="-1"></a>        stringr<span class="sc">::</span><span class="fu">str_remove</span>(<span class="st">&quot;(_rmse|_rrmse|_mean|_mape)$&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb245-158"><a href="chm_sens_test.html#cb245-158" tabindex="-1"></a>        stringr<span class="sc">::</span><span class="fu">str_extract</span>(<span class="st">&quot;(paraboloid_volume|volume|area|height|diameter)&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb245-159"><a href="chm_sens_test.html#cb245-159" tabindex="-1"></a>        <span class="fu">factor</span>(</span>
<span id="cb245-160"><a href="chm_sens_test.html#cb245-160" tabindex="-1"></a>          <span class="at">ordered =</span> T</span>
<span id="cb245-161"><a href="chm_sens_test.html#cb245-161" tabindex="-1"></a>          , <span class="at">levels =</span> <span class="fu">c</span>(</span>
<span id="cb245-162"><a href="chm_sens_test.html#cb245-162" tabindex="-1"></a>            <span class="st">&quot;volume&quot;</span></span>
<span id="cb245-163"><a href="chm_sens_test.html#cb245-163" tabindex="-1"></a>            , <span class="st">&quot;paraboloid_volume&quot;</span></span>
<span id="cb245-164"><a href="chm_sens_test.html#cb245-164" tabindex="-1"></a>            , <span class="st">&quot;area&quot;</span></span>
<span id="cb245-165"><a href="chm_sens_test.html#cb245-165" tabindex="-1"></a>            , <span class="st">&quot;height&quot;</span></span>
<span id="cb245-166"><a href="chm_sens_test.html#cb245-166" tabindex="-1"></a>            , <span class="st">&quot;diameter&quot;</span></span>
<span id="cb245-167"><a href="chm_sens_test.html#cb245-167" tabindex="-1"></a>          )</span>
<span id="cb245-168"><a href="chm_sens_test.html#cb245-168" tabindex="-1"></a>          , <span class="at">labels =</span> <span class="fu">c</span>(</span>
<span id="cb245-169"><a href="chm_sens_test.html#cb245-169" tabindex="-1"></a>            <span class="st">&quot;Volume&quot;</span></span>
<span id="cb245-170"><a href="chm_sens_test.html#cb245-170" tabindex="-1"></a>            , <span class="st">&quot;Volume paraboloid&quot;</span></span>
<span id="cb245-171"><a href="chm_sens_test.html#cb245-171" tabindex="-1"></a>            , <span class="st">&quot;Area (m2)&quot;</span></span>
<span id="cb245-172"><a href="chm_sens_test.html#cb245-172" tabindex="-1"></a>            , <span class="st">&quot;Height (m)&quot;</span></span>
<span id="cb245-173"><a href="chm_sens_test.html#cb245-173" tabindex="-1"></a>            , <span class="st">&quot;Diameter (m)&quot;</span></span>
<span id="cb245-174"><a href="chm_sens_test.html#cb245-174" tabindex="-1"></a>          )</span>
<span id="cb245-175"><a href="chm_sens_test.html#cb245-175" tabindex="-1"></a>        )</span>
<span id="cb245-176"><a href="chm_sens_test.html#cb245-176" tabindex="-1"></a>    )</span>
<span id="cb245-177"><a href="chm_sens_test.html#cb245-177" tabindex="-1"></a>  </span>
<span id="cb245-178"><a href="chm_sens_test.html#cb245-178" tabindex="-1"></a>  <span class="co"># plot</span></span>
<span id="cb245-179"><a href="chm_sens_test.html#cb245-179" tabindex="-1"></a>  <span class="co"># chm check</span></span>
<span id="cb245-180"><a href="chm_sens_test.html#cb245-180" tabindex="-1"></a>  nrow_check <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> </span>
<span id="cb245-181"><a href="chm_sens_test.html#cb245-181" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">count</span>(chm_res_m_desc) <span class="sc">%&gt;%</span> </span>
<span id="cb245-182"><a href="chm_sens_test.html#cb245-182" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">pull</span>(n) <span class="sc">%&gt;%</span> </span>
<span id="cb245-183"><a href="chm_sens_test.html#cb245-183" tabindex="-1"></a>    <span class="fu">max</span>()</span>
<span id="cb245-184"><a href="chm_sens_test.html#cb245-184" tabindex="-1"></a>  </span>
<span id="cb245-185"><a href="chm_sens_test.html#cb245-185" tabindex="-1"></a>  <span class="co"># plot </span></span>
<span id="cb245-186"><a href="chm_sens_test.html#cb245-186" tabindex="-1"></a>  <span class="cf">if</span>(nrow_check<span class="sc">&lt;=</span><span class="dv">15</span>){</span>
<span id="cb245-187"><a href="chm_sens_test.html#cb245-187" tabindex="-1"></a>    <span class="co"># round</span></span>
<span id="cb245-188"><a href="chm_sens_test.html#cb245-188" tabindex="-1"></a>    df_temp <span class="ot">&lt;-</span> df_temp <span class="sc">%&gt;%</span> </span>
<span id="cb245-189"><a href="chm_sens_test.html#cb245-189" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">filter</span>(</span>
<span id="cb245-190"><a href="chm_sens_test.html#cb245-190" tabindex="-1"></a>        eval_metric<span class="sc">==</span>dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb245-191"><a href="chm_sens_test.html#cb245-191" tabindex="-1"></a>          <span class="fu">tolower</span>(quant_metric) <span class="sc">==</span> <span class="st">&quot;mape&quot;</span> <span class="sc">~</span> <span class="st">&quot;MAPE&quot;</span></span>
<span id="cb245-192"><a href="chm_sens_test.html#cb245-192" tabindex="-1"></a>          , <span class="fu">tolower</span>(quant_metric) <span class="sc">==</span> <span class="st">&quot;rmse&quot;</span> <span class="sc">~</span> <span class="st">&quot;RMSE&quot;</span></span>
<span id="cb245-193"><a href="chm_sens_test.html#cb245-193" tabindex="-1"></a>          , <span class="fu">tolower</span>(quant_metric) <span class="sc">==</span> <span class="st">&quot;mean&quot;</span> <span class="sc">~</span> <span class="st">&quot;ME&quot;</span></span>
<span id="cb245-194"><a href="chm_sens_test.html#cb245-194" tabindex="-1"></a>          , T <span class="sc">~</span> <span class="st">&quot;MAPE&quot;</span></span>
<span id="cb245-195"><a href="chm_sens_test.html#cb245-195" tabindex="-1"></a>        )</span>
<span id="cb245-196"><a href="chm_sens_test.html#cb245-196" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span> </span>
<span id="cb245-197"><a href="chm_sens_test.html#cb245-197" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb245-198"><a href="chm_sens_test.html#cb245-198" tabindex="-1"></a>        <span class="at">value =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb245-199"><a href="chm_sens_test.html#cb245-199" tabindex="-1"></a>          eval_metric <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;RRMSE&quot;</span>, <span class="st">&quot;MAPE&quot;</span>) <span class="sc">~</span> <span class="fu">round</span>(value,<span class="dv">2</span>)</span>
<span id="cb245-200"><a href="chm_sens_test.html#cb245-200" tabindex="-1"></a>          , T <span class="sc">~</span> <span class="fu">round</span>(value,<span class="dv">1</span>)</span>
<span id="cb245-201"><a href="chm_sens_test.html#cb245-201" tabindex="-1"></a>        )</span>
<span id="cb245-202"><a href="chm_sens_test.html#cb245-202" tabindex="-1"></a>      )</span>
<span id="cb245-203"><a href="chm_sens_test.html#cb245-203" tabindex="-1"></a>    <span class="co"># agg for median plotting</span></span>
<span id="cb245-204"><a href="chm_sens_test.html#cb245-204" tabindex="-1"></a>    xxxdf_temp <span class="ot">&lt;-</span> df_temp <span class="sc">%&gt;%</span> </span>
<span id="cb245-205"><a href="chm_sens_test.html#cb245-205" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">group_by</span>(chm_res_m_desc,pile_metric,eval_metric) <span class="sc">%&gt;%</span> </span>
<span id="cb245-206"><a href="chm_sens_test.html#cb245-206" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">summarise</span>(<span class="at">value =</span> <span class="fu">median</span>(value,<span class="at">na.rm=</span>T)) <span class="sc">%&gt;%</span> </span>
<span id="cb245-207"><a href="chm_sens_test.html#cb245-207" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb245-208"><a href="chm_sens_test.html#cb245-208" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb245-209"><a href="chm_sens_test.html#cb245-209" tabindex="-1"></a>        <span class="at">value_lab =</span> <span class="fu">paste0</span>(</span>
<span id="cb245-210"><a href="chm_sens_test.html#cb245-210" tabindex="-1"></a>            <span class="st">&quot;median:</span><span class="sc">\n</span><span class="st">&quot;</span></span>
<span id="cb245-211"><a href="chm_sens_test.html#cb245-211" tabindex="-1"></a>          , dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb245-212"><a href="chm_sens_test.html#cb245-212" tabindex="-1"></a>            eval_metric <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;RRMSE&quot;</span>, <span class="st">&quot;MAPE&quot;</span>) <span class="sc">~</span> scales<span class="sc">::</span><span class="fu">percent</span>(value,<span class="at">accuracy=</span><span class="dv">1</span>)</span>
<span id="cb245-213"><a href="chm_sens_test.html#cb245-213" tabindex="-1"></a>            , eval_metric <span class="sc">==</span> <span class="st">&quot;ME&quot;</span> <span class="sc">~</span> scales<span class="sc">::</span><span class="fu">comma</span>(value,<span class="at">accuracy=</span><span class="fl">0.1</span>)</span>
<span id="cb245-214"><a href="chm_sens_test.html#cb245-214" tabindex="-1"></a>            , T <span class="sc">~</span> scales<span class="sc">::</span><span class="fu">comma</span>(value,<span class="at">accuracy=</span><span class="fl">0.1</span>)</span>
<span id="cb245-215"><a href="chm_sens_test.html#cb245-215" tabindex="-1"></a>          )</span>
<span id="cb245-216"><a href="chm_sens_test.html#cb245-216" tabindex="-1"></a>        )</span>
<span id="cb245-217"><a href="chm_sens_test.html#cb245-217" tabindex="-1"></a>      )</span>
<span id="cb245-218"><a href="chm_sens_test.html#cb245-218" tabindex="-1"></a>    </span>
<span id="cb245-219"><a href="chm_sens_test.html#cb245-219" tabindex="-1"></a>    <span class="co"># plot </span></span>
<span id="cb245-220"><a href="chm_sens_test.html#cb245-220" tabindex="-1"></a>    p <span class="ot">&lt;-</span> </span>
<span id="cb245-221"><a href="chm_sens_test.html#cb245-221" tabindex="-1"></a>      df_temp <span class="sc">%&gt;%</span> </span>
<span id="cb245-222"><a href="chm_sens_test.html#cb245-222" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">count</span>(chm_res_m_desc,pile_metric,value) <span class="sc">%&gt;%</span></span>
<span id="cb245-223"><a href="chm_sens_test.html#cb245-223" tabindex="-1"></a>        ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x=</span>value,<span class="at">color =</span> pile_metric,<span class="at">fill =</span> pile_metric)) <span class="sc">+</span></span>
<span id="cb245-224"><a href="chm_sens_test.html#cb245-224" tabindex="-1"></a>        ggplot2<span class="sc">::</span><span class="fu">geom_vline</span>(</span>
<span id="cb245-225"><a href="chm_sens_test.html#cb245-225" tabindex="-1"></a>          <span class="at">data =</span> xxxdf_temp <span class="sc">%&gt;%</span> </span>
<span id="cb245-226"><a href="chm_sens_test.html#cb245-226" tabindex="-1"></a>            dplyr<span class="sc">::</span><span class="fu">filter</span>(</span>
<span id="cb245-227"><a href="chm_sens_test.html#cb245-227" tabindex="-1"></a>              eval_metric<span class="sc">==</span>dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb245-228"><a href="chm_sens_test.html#cb245-228" tabindex="-1"></a>                <span class="fu">tolower</span>(quant_metric) <span class="sc">==</span> <span class="st">&quot;mape&quot;</span> <span class="sc">~</span> <span class="st">&quot;MAPE&quot;</span></span>
<span id="cb245-229"><a href="chm_sens_test.html#cb245-229" tabindex="-1"></a>                , <span class="fu">tolower</span>(quant_metric) <span class="sc">==</span> <span class="st">&quot;rmse&quot;</span> <span class="sc">~</span> <span class="st">&quot;RMSE&quot;</span></span>
<span id="cb245-230"><a href="chm_sens_test.html#cb245-230" tabindex="-1"></a>                , <span class="fu">tolower</span>(quant_metric) <span class="sc">==</span> <span class="st">&quot;mean&quot;</span> <span class="sc">~</span> <span class="st">&quot;ME&quot;</span></span>
<span id="cb245-231"><a href="chm_sens_test.html#cb245-231" tabindex="-1"></a>                , T <span class="sc">~</span> <span class="st">&quot;MAPE&quot;</span></span>
<span id="cb245-232"><a href="chm_sens_test.html#cb245-232" tabindex="-1"></a>              )</span>
<span id="cb245-233"><a href="chm_sens_test.html#cb245-233" tabindex="-1"></a>            )</span>
<span id="cb245-234"><a href="chm_sens_test.html#cb245-234" tabindex="-1"></a>          , <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">xintercept =</span> value)</span>
<span id="cb245-235"><a href="chm_sens_test.html#cb245-235" tabindex="-1"></a>          , <span class="at">color =</span> <span class="st">&quot;gray44&quot;</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span></span>
<span id="cb245-236"><a href="chm_sens_test.html#cb245-236" tabindex="-1"></a>        ) <span class="sc">+</span></span>
<span id="cb245-237"><a href="chm_sens_test.html#cb245-237" tabindex="-1"></a>        ggplot2<span class="sc">::</span><span class="fu">geom_segment</span>(</span>
<span id="cb245-238"><a href="chm_sens_test.html#cb245-238" tabindex="-1"></a>          <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">y=</span>n,<span class="at">yend=</span><span class="dv">0</span>)</span>
<span id="cb245-239"><a href="chm_sens_test.html#cb245-239" tabindex="-1"></a>          , <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.8</span></span>
<span id="cb245-240"><a href="chm_sens_test.html#cb245-240" tabindex="-1"></a>        ) <span class="sc">+</span></span>
<span id="cb245-241"><a href="chm_sens_test.html#cb245-241" tabindex="-1"></a>        ggplot2<span class="sc">::</span><span class="fu">geom_point</span>(</span>
<span id="cb245-242"><a href="chm_sens_test.html#cb245-242" tabindex="-1"></a>          <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">y=</span>n)</span>
<span id="cb245-243"><a href="chm_sens_test.html#cb245-243" tabindex="-1"></a>          , <span class="at">alpha =</span> <span class="dv">1</span></span>
<span id="cb245-244"><a href="chm_sens_test.html#cb245-244" tabindex="-1"></a>          , <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">color =</span> <span class="st">&quot;gray44&quot;</span>, <span class="at">size =</span> <span class="dv">5</span></span>
<span id="cb245-245"><a href="chm_sens_test.html#cb245-245" tabindex="-1"></a>        ) <span class="sc">+</span></span>
<span id="cb245-246"><a href="chm_sens_test.html#cb245-246" tabindex="-1"></a>        ggplot2<span class="sc">::</span><span class="fu">geom_text</span>(</span>
<span id="cb245-247"><a href="chm_sens_test.html#cb245-247" tabindex="-1"></a>          <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">y=</span>n,<span class="at">label=</span>n)</span>
<span id="cb245-248"><a href="chm_sens_test.html#cb245-248" tabindex="-1"></a>          , <span class="at">size =</span> <span class="fl">2.5</span>, <span class="at">color =</span> <span class="st">&quot;white&quot;</span></span>
<span id="cb245-249"><a href="chm_sens_test.html#cb245-249" tabindex="-1"></a>          <span class="co"># , vjust = -0.01</span></span>
<span id="cb245-250"><a href="chm_sens_test.html#cb245-250" tabindex="-1"></a>        ) <span class="sc">+</span></span>
<span id="cb245-251"><a href="chm_sens_test.html#cb245-251" tabindex="-1"></a>        ggplot2<span class="sc">::</span><span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> ggplot2<span class="sc">::</span><span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="dv">0</span>, .<span class="dv">2</span>))) <span class="sc">+</span></span>
<span id="cb245-252"><a href="chm_sens_test.html#cb245-252" tabindex="-1"></a>        harrypotter<span class="sc">::</span><span class="fu">scale_fill_hp_d</span>(<span class="at">option =</span> <span class="st">&quot;hermionegranger&quot;</span>) <span class="sc">+</span></span>
<span id="cb245-253"><a href="chm_sens_test.html#cb245-253" tabindex="-1"></a>        harrypotter<span class="sc">::</span><span class="fu">scale_color_hp_d</span>(<span class="at">option =</span> <span class="st">&quot;hermionegranger&quot;</span>) <span class="sc">+</span></span>
<span id="cb245-254"><a href="chm_sens_test.html#cb245-254" tabindex="-1"></a>        ggplot2<span class="sc">::</span><span class="fu">geom_text</span>(</span>
<span id="cb245-255"><a href="chm_sens_test.html#cb245-255" tabindex="-1"></a>          <span class="at">data =</span> xxxdf_temp <span class="sc">%&gt;%</span> </span>
<span id="cb245-256"><a href="chm_sens_test.html#cb245-256" tabindex="-1"></a>            dplyr<span class="sc">::</span><span class="fu">filter</span>(</span>
<span id="cb245-257"><a href="chm_sens_test.html#cb245-257" tabindex="-1"></a>              eval_metric<span class="sc">==</span>dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb245-258"><a href="chm_sens_test.html#cb245-258" tabindex="-1"></a>                <span class="fu">tolower</span>(quant_metric) <span class="sc">==</span> <span class="st">&quot;mape&quot;</span> <span class="sc">~</span> <span class="st">&quot;MAPE&quot;</span></span>
<span id="cb245-259"><a href="chm_sens_test.html#cb245-259" tabindex="-1"></a>                , <span class="fu">tolower</span>(quant_metric) <span class="sc">==</span> <span class="st">&quot;rmse&quot;</span> <span class="sc">~</span> <span class="st">&quot;RMSE&quot;</span></span>
<span id="cb245-260"><a href="chm_sens_test.html#cb245-260" tabindex="-1"></a>                , <span class="fu">tolower</span>(quant_metric) <span class="sc">==</span> <span class="st">&quot;mean&quot;</span> <span class="sc">~</span> <span class="st">&quot;ME&quot;</span></span>
<span id="cb245-261"><a href="chm_sens_test.html#cb245-261" tabindex="-1"></a>                , T <span class="sc">~</span> <span class="st">&quot;MAPE&quot;</span></span>
<span id="cb245-262"><a href="chm_sens_test.html#cb245-262" tabindex="-1"></a>              )</span>
<span id="cb245-263"><a href="chm_sens_test.html#cb245-263" tabindex="-1"></a>            )</span>
<span id="cb245-264"><a href="chm_sens_test.html#cb245-264" tabindex="-1"></a>          , <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(</span>
<span id="cb245-265"><a href="chm_sens_test.html#cb245-265" tabindex="-1"></a>            <span class="at">x =</span> <span class="sc">-</span><span class="cn">Inf</span>, <span class="at">y =</span> <span class="cn">Inf</span> <span class="co"># always in upper left?</span></span>
<span id="cb245-266"><a href="chm_sens_test.html#cb245-266" tabindex="-1"></a>            <span class="co"># x = value, y = 0</span></span>
<span id="cb245-267"><a href="chm_sens_test.html#cb245-267" tabindex="-1"></a>            , <span class="at">label =</span> value_lab</span>
<span id="cb245-268"><a href="chm_sens_test.html#cb245-268" tabindex="-1"></a>          )</span>
<span id="cb245-269"><a href="chm_sens_test.html#cb245-269" tabindex="-1"></a>          , <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">0.1</span>, <span class="at">vjust =</span> <span class="dv">1</span> <span class="co"># always in upper left?</span></span>
<span id="cb245-270"><a href="chm_sens_test.html#cb245-270" tabindex="-1"></a>          <span class="co"># , hjust = -0.1, vjust = -5</span></span>
<span id="cb245-271"><a href="chm_sens_test.html#cb245-271" tabindex="-1"></a>          , <span class="at">size =</span> <span class="fl">2.5</span></span>
<span id="cb245-272"><a href="chm_sens_test.html#cb245-272" tabindex="-1"></a>          , <span class="at">color =</span> <span class="st">&quot;black&quot;</span></span>
<span id="cb245-273"><a href="chm_sens_test.html#cb245-273" tabindex="-1"></a>        ) <span class="sc">+</span></span>
<span id="cb245-274"><a href="chm_sens_test.html#cb245-274" tabindex="-1"></a>        ggplot2<span class="sc">::</span><span class="fu">facet_grid</span>(<span class="at">cols =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(pile_metric), <span class="at">rows =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(chm_res_m_desc), <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>) <span class="sc">+</span></span>
<span id="cb245-275"><a href="chm_sens_test.html#cb245-275" tabindex="-1"></a>        ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb245-276"><a href="chm_sens_test.html#cb245-276" tabindex="-1"></a>          <span class="at">x =</span> <span class="st">&quot;&quot;</span>, <span class="at">y =</span> <span class="st">&quot;&quot;</span></span>
<span id="cb245-277"><a href="chm_sens_test.html#cb245-277" tabindex="-1"></a>          , <span class="at">subtitle =</span> my_subtitle</span>
<span id="cb245-278"><a href="chm_sens_test.html#cb245-278" tabindex="-1"></a>          , <span class="at">title =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb245-279"><a href="chm_sens_test.html#cb245-279" tabindex="-1"></a>            <span class="fu">tolower</span>(quant_metric) <span class="sc">==</span> <span class="st">&quot;mape&quot;</span> <span class="sc">~</span> <span class="st">&quot;MAPE&quot;</span></span>
<span id="cb245-280"><a href="chm_sens_test.html#cb245-280" tabindex="-1"></a>            , <span class="fu">tolower</span>(quant_metric) <span class="sc">==</span> <span class="st">&quot;rmse&quot;</span> <span class="sc">~</span> <span class="st">&quot;RMSE&quot;</span></span>
<span id="cb245-281"><a href="chm_sens_test.html#cb245-281" tabindex="-1"></a>            , <span class="fu">tolower</span>(quant_metric) <span class="sc">==</span> <span class="st">&quot;mean&quot;</span> <span class="sc">~</span> <span class="st">&quot;Mean Error&quot;</span></span>
<span id="cb245-282"><a href="chm_sens_test.html#cb245-282" tabindex="-1"></a>            , T <span class="sc">~</span> <span class="st">&quot;MAPE&quot;</span></span>
<span id="cb245-283"><a href="chm_sens_test.html#cb245-283" tabindex="-1"></a>          )</span>
<span id="cb245-284"><a href="chm_sens_test.html#cb245-284" tabindex="-1"></a>        ) <span class="sc">+</span></span>
<span id="cb245-285"><a href="chm_sens_test.html#cb245-285" tabindex="-1"></a>        ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb245-286"><a href="chm_sens_test.html#cb245-286" tabindex="-1"></a>        ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb245-287"><a href="chm_sens_test.html#cb245-287" tabindex="-1"></a>          <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb245-288"><a href="chm_sens_test.html#cb245-288" tabindex="-1"></a>          , <span class="at">strip.text.x =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb245-289"><a href="chm_sens_test.html#cb245-289" tabindex="-1"></a>          , <span class="at">strip.text.y =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">9</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb245-290"><a href="chm_sens_test.html#cb245-290" tabindex="-1"></a>          , <span class="at">axis.text.x =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">7</span>)</span>
<span id="cb245-291"><a href="chm_sens_test.html#cb245-291" tabindex="-1"></a>          , <span class="at">axis.text.y =</span> ggplot2<span class="sc">::</span><span class="fu">element_blank</span>()</span>
<span id="cb245-292"><a href="chm_sens_test.html#cb245-292" tabindex="-1"></a>          , <span class="at">axis.ticks.y =</span> ggplot2<span class="sc">::</span><span class="fu">element_blank</span>()</span>
<span id="cb245-293"><a href="chm_sens_test.html#cb245-293" tabindex="-1"></a>          , <span class="at">panel.grid.major.y =</span> ggplot2<span class="sc">::</span><span class="fu">element_blank</span>()</span>
<span id="cb245-294"><a href="chm_sens_test.html#cb245-294" tabindex="-1"></a>          , <span class="at">panel.grid.minor.y =</span> ggplot2<span class="sc">::</span><span class="fu">element_blank</span>()</span>
<span id="cb245-295"><a href="chm_sens_test.html#cb245-295" tabindex="-1"></a>          , <span class="at">plot.subtitle =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>)</span>
<span id="cb245-296"><a href="chm_sens_test.html#cb245-296" tabindex="-1"></a>        )</span>
<span id="cb245-297"><a href="chm_sens_test.html#cb245-297" tabindex="-1"></a>    </span>
<span id="cb245-298"><a href="chm_sens_test.html#cb245-298" tabindex="-1"></a>  }<span class="cf">else</span>{</span>
<span id="cb245-299"><a href="chm_sens_test.html#cb245-299" tabindex="-1"></a>    <span class="co"># aggregate</span></span>
<span id="cb245-300"><a href="chm_sens_test.html#cb245-300" tabindex="-1"></a>    xxxdf_temp <span class="ot">&lt;-</span> df_temp <span class="sc">%&gt;%</span> </span>
<span id="cb245-301"><a href="chm_sens_test.html#cb245-301" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">group_by</span>(chm_res_m_desc,pile_metric,eval_metric) <span class="sc">%&gt;%</span> </span>
<span id="cb245-302"><a href="chm_sens_test.html#cb245-302" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">summarise</span>(<span class="at">value =</span> <span class="fu">median</span>(value,<span class="at">na.rm=</span>T)) <span class="sc">%&gt;%</span> </span>
<span id="cb245-303"><a href="chm_sens_test.html#cb245-303" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb245-304"><a href="chm_sens_test.html#cb245-304" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb245-305"><a href="chm_sens_test.html#cb245-305" tabindex="-1"></a>        <span class="at">value_lab =</span> <span class="fu">paste0</span>(</span>
<span id="cb245-306"><a href="chm_sens_test.html#cb245-306" tabindex="-1"></a>            <span class="st">&quot;median:</span><span class="sc">\n</span><span class="st">&quot;</span></span>
<span id="cb245-307"><a href="chm_sens_test.html#cb245-307" tabindex="-1"></a>          , dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb245-308"><a href="chm_sens_test.html#cb245-308" tabindex="-1"></a>            eval_metric <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;RRMSE&quot;</span>, <span class="st">&quot;MAPE&quot;</span>) <span class="sc">~</span> scales<span class="sc">::</span><span class="fu">percent</span>(value,<span class="at">accuracy=</span><span class="fl">0.1</span>)</span>
<span id="cb245-309"><a href="chm_sens_test.html#cb245-309" tabindex="-1"></a>            , eval_metric <span class="sc">==</span> <span class="st">&quot;ME&quot;</span> <span class="sc">~</span> scales<span class="sc">::</span><span class="fu">comma</span>(value,<span class="at">accuracy=</span><span class="fl">0.01</span>)</span>
<span id="cb245-310"><a href="chm_sens_test.html#cb245-310" tabindex="-1"></a>            , T <span class="sc">~</span> scales<span class="sc">::</span><span class="fu">comma</span>(value,<span class="at">accuracy=</span><span class="fl">0.1</span>)</span>
<span id="cb245-311"><a href="chm_sens_test.html#cb245-311" tabindex="-1"></a>          )</span>
<span id="cb245-312"><a href="chm_sens_test.html#cb245-312" tabindex="-1"></a>        )</span>
<span id="cb245-313"><a href="chm_sens_test.html#cb245-313" tabindex="-1"></a>      )</span>
<span id="cb245-314"><a href="chm_sens_test.html#cb245-314" tabindex="-1"></a>    </span>
<span id="cb245-315"><a href="chm_sens_test.html#cb245-315" tabindex="-1"></a>    p <span class="ot">&lt;-</span> </span>
<span id="cb245-316"><a href="chm_sens_test.html#cb245-316" tabindex="-1"></a>      df_temp <span class="sc">%&gt;%</span> </span>
<span id="cb245-317"><a href="chm_sens_test.html#cb245-317" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">filter</span>(</span>
<span id="cb245-318"><a href="chm_sens_test.html#cb245-318" tabindex="-1"></a>        eval_metric<span class="sc">==</span>dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb245-319"><a href="chm_sens_test.html#cb245-319" tabindex="-1"></a>          <span class="fu">tolower</span>(quant_metric) <span class="sc">==</span> <span class="st">&quot;mape&quot;</span> <span class="sc">~</span> <span class="st">&quot;MAPE&quot;</span></span>
<span id="cb245-320"><a href="chm_sens_test.html#cb245-320" tabindex="-1"></a>          , <span class="fu">tolower</span>(quant_metric) <span class="sc">==</span> <span class="st">&quot;rmse&quot;</span> <span class="sc">~</span> <span class="st">&quot;RMSE&quot;</span></span>
<span id="cb245-321"><a href="chm_sens_test.html#cb245-321" tabindex="-1"></a>          , <span class="fu">tolower</span>(quant_metric) <span class="sc">==</span> <span class="st">&quot;mean&quot;</span> <span class="sc">~</span> <span class="st">&quot;ME&quot;</span></span>
<span id="cb245-322"><a href="chm_sens_test.html#cb245-322" tabindex="-1"></a>          , T <span class="sc">~</span> <span class="st">&quot;MAPE&quot;</span></span>
<span id="cb245-323"><a href="chm_sens_test.html#cb245-323" tabindex="-1"></a>        )</span>
<span id="cb245-324"><a href="chm_sens_test.html#cb245-324" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span> </span>
<span id="cb245-325"><a href="chm_sens_test.html#cb245-325" tabindex="-1"></a>          ggplot2<span class="sc">::</span><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb245-326"><a href="chm_sens_test.html#cb245-326" tabindex="-1"></a>          <span class="co"># ggplot2::geom_vline(xintercept = 0, color = &quot;gray&quot;) +</span></span>
<span id="cb245-327"><a href="chm_sens_test.html#cb245-327" tabindex="-1"></a>          ggplot2<span class="sc">::</span><span class="fu">geom_density</span>(<span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">y =</span> ggplot2<span class="sc">::</span><span class="fu">after_stat</span>(scaled), <span class="at">fill =</span> pile_metric), <span class="at">color =</span> <span class="cn">NA</span>, <span class="at">alpha =</span> <span class="fl">0.9</span>) <span class="sc">+</span></span>
<span id="cb245-328"><a href="chm_sens_test.html#cb245-328" tabindex="-1"></a>          harrypotter<span class="sc">::</span><span class="fu">scale_fill_hp_d</span>(<span class="at">option =</span> <span class="st">&quot;hermionegranger&quot;</span>) <span class="sc">+</span></span>
<span id="cb245-329"><a href="chm_sens_test.html#cb245-329" tabindex="-1"></a>          harrypotter<span class="sc">::</span><span class="fu">scale_color_hp_d</span>(<span class="at">option =</span> <span class="st">&quot;hermionegranger&quot;</span>) <span class="sc">+</span></span>
<span id="cb245-330"><a href="chm_sens_test.html#cb245-330" tabindex="-1"></a>          ggplot2<span class="sc">::</span><span class="fu">geom_vline</span>(</span>
<span id="cb245-331"><a href="chm_sens_test.html#cb245-331" tabindex="-1"></a>            <span class="at">data =</span> xxxdf_temp <span class="sc">%&gt;%</span> </span>
<span id="cb245-332"><a href="chm_sens_test.html#cb245-332" tabindex="-1"></a>              dplyr<span class="sc">::</span><span class="fu">filter</span>(</span>
<span id="cb245-333"><a href="chm_sens_test.html#cb245-333" tabindex="-1"></a>                eval_metric<span class="sc">==</span>dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb245-334"><a href="chm_sens_test.html#cb245-334" tabindex="-1"></a>                  <span class="fu">tolower</span>(quant_metric) <span class="sc">==</span> <span class="st">&quot;mape&quot;</span> <span class="sc">~</span> <span class="st">&quot;MAPE&quot;</span></span>
<span id="cb245-335"><a href="chm_sens_test.html#cb245-335" tabindex="-1"></a>                  , <span class="fu">tolower</span>(quant_metric) <span class="sc">==</span> <span class="st">&quot;rmse&quot;</span> <span class="sc">~</span> <span class="st">&quot;RMSE&quot;</span></span>
<span id="cb245-336"><a href="chm_sens_test.html#cb245-336" tabindex="-1"></a>                  , <span class="fu">tolower</span>(quant_metric) <span class="sc">==</span> <span class="st">&quot;mean&quot;</span> <span class="sc">~</span> <span class="st">&quot;ME&quot;</span></span>
<span id="cb245-337"><a href="chm_sens_test.html#cb245-337" tabindex="-1"></a>                  , T <span class="sc">~</span> <span class="st">&quot;MAPE&quot;</span></span>
<span id="cb245-338"><a href="chm_sens_test.html#cb245-338" tabindex="-1"></a>                )</span>
<span id="cb245-339"><a href="chm_sens_test.html#cb245-339" tabindex="-1"></a>              )</span>
<span id="cb245-340"><a href="chm_sens_test.html#cb245-340" tabindex="-1"></a>            , <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">xintercept =</span> value)</span>
<span id="cb245-341"><a href="chm_sens_test.html#cb245-341" tabindex="-1"></a>            , <span class="at">color =</span> <span class="st">&quot;gray44&quot;</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span></span>
<span id="cb245-342"><a href="chm_sens_test.html#cb245-342" tabindex="-1"></a>          ) <span class="sc">+</span></span>
<span id="cb245-343"><a href="chm_sens_test.html#cb245-343" tabindex="-1"></a>          ggplot2<span class="sc">::</span><span class="fu">geom_text</span>(</span>
<span id="cb245-344"><a href="chm_sens_test.html#cb245-344" tabindex="-1"></a>            <span class="at">data =</span> xxxdf_temp <span class="sc">%&gt;%</span> </span>
<span id="cb245-345"><a href="chm_sens_test.html#cb245-345" tabindex="-1"></a>              dplyr<span class="sc">::</span><span class="fu">filter</span>(</span>
<span id="cb245-346"><a href="chm_sens_test.html#cb245-346" tabindex="-1"></a>                eval_metric<span class="sc">==</span>dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb245-347"><a href="chm_sens_test.html#cb245-347" tabindex="-1"></a>                  <span class="fu">tolower</span>(quant_metric) <span class="sc">==</span> <span class="st">&quot;mape&quot;</span> <span class="sc">~</span> <span class="st">&quot;MAPE&quot;</span></span>
<span id="cb245-348"><a href="chm_sens_test.html#cb245-348" tabindex="-1"></a>                  , <span class="fu">tolower</span>(quant_metric) <span class="sc">==</span> <span class="st">&quot;rmse&quot;</span> <span class="sc">~</span> <span class="st">&quot;RMSE&quot;</span></span>
<span id="cb245-349"><a href="chm_sens_test.html#cb245-349" tabindex="-1"></a>                  , <span class="fu">tolower</span>(quant_metric) <span class="sc">==</span> <span class="st">&quot;mean&quot;</span> <span class="sc">~</span> <span class="st">&quot;ME&quot;</span></span>
<span id="cb245-350"><a href="chm_sens_test.html#cb245-350" tabindex="-1"></a>                  , T <span class="sc">~</span> <span class="st">&quot;MAPE&quot;</span></span>
<span id="cb245-351"><a href="chm_sens_test.html#cb245-351" tabindex="-1"></a>                )</span>
<span id="cb245-352"><a href="chm_sens_test.html#cb245-352" tabindex="-1"></a>              )</span>
<span id="cb245-353"><a href="chm_sens_test.html#cb245-353" tabindex="-1"></a>            , <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(</span>
<span id="cb245-354"><a href="chm_sens_test.html#cb245-354" tabindex="-1"></a>              <span class="at">x =</span> <span class="sc">-</span><span class="cn">Inf</span>, <span class="at">y =</span> <span class="cn">Inf</span> <span class="co"># always in upper left?</span></span>
<span id="cb245-355"><a href="chm_sens_test.html#cb245-355" tabindex="-1"></a>              <span class="co"># x = value, y = 0</span></span>
<span id="cb245-356"><a href="chm_sens_test.html#cb245-356" tabindex="-1"></a>              , <span class="at">label =</span> value_lab</span>
<span id="cb245-357"><a href="chm_sens_test.html#cb245-357" tabindex="-1"></a>            )</span>
<span id="cb245-358"><a href="chm_sens_test.html#cb245-358" tabindex="-1"></a>            , <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">0.1</span>, <span class="at">vjust =</span> <span class="dv">1</span> <span class="co"># always in upper left?</span></span>
<span id="cb245-359"><a href="chm_sens_test.html#cb245-359" tabindex="-1"></a>            <span class="co"># , hjust = -0.1, vjust = -5</span></span>
<span id="cb245-360"><a href="chm_sens_test.html#cb245-360" tabindex="-1"></a>            , <span class="at">size =</span> <span class="fl">2.5</span></span>
<span id="cb245-361"><a href="chm_sens_test.html#cb245-361" tabindex="-1"></a>          ) <span class="sc">+</span></span>
<span id="cb245-362"><a href="chm_sens_test.html#cb245-362" tabindex="-1"></a>          ggplot2<span class="sc">::</span><span class="fu">facet_grid</span>(<span class="at">cols =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(pile_metric), <span class="at">rows =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(chm_res_m_desc), <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>) <span class="sc">+</span></span>
<span id="cb245-363"><a href="chm_sens_test.html#cb245-363" tabindex="-1"></a>          ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb245-364"><a href="chm_sens_test.html#cb245-364" tabindex="-1"></a>            <span class="at">x =</span> <span class="st">&quot;&quot;</span>, <span class="at">y =</span> <span class="st">&quot;&quot;</span></span>
<span id="cb245-365"><a href="chm_sens_test.html#cb245-365" tabindex="-1"></a>            , <span class="at">subtitle =</span> my_subtitle</span>
<span id="cb245-366"><a href="chm_sens_test.html#cb245-366" tabindex="-1"></a>            , <span class="at">title =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb245-367"><a href="chm_sens_test.html#cb245-367" tabindex="-1"></a>              <span class="fu">tolower</span>(quant_metric) <span class="sc">==</span> <span class="st">&quot;mape&quot;</span> <span class="sc">~</span> <span class="st">&quot;MAPE&quot;</span></span>
<span id="cb245-368"><a href="chm_sens_test.html#cb245-368" tabindex="-1"></a>              , <span class="fu">tolower</span>(quant_metric) <span class="sc">==</span> <span class="st">&quot;rmse&quot;</span> <span class="sc">~</span> <span class="st">&quot;RMSE&quot;</span></span>
<span id="cb245-369"><a href="chm_sens_test.html#cb245-369" tabindex="-1"></a>              , <span class="fu">tolower</span>(quant_metric) <span class="sc">==</span> <span class="st">&quot;mean&quot;</span> <span class="sc">~</span> <span class="st">&quot;Mean Error&quot;</span></span>
<span id="cb245-370"><a href="chm_sens_test.html#cb245-370" tabindex="-1"></a>              , T <span class="sc">~</span> <span class="st">&quot;MAPE&quot;</span></span>
<span id="cb245-371"><a href="chm_sens_test.html#cb245-371" tabindex="-1"></a>            )</span>
<span id="cb245-372"><a href="chm_sens_test.html#cb245-372" tabindex="-1"></a>          ) <span class="sc">+</span></span>
<span id="cb245-373"><a href="chm_sens_test.html#cb245-373" tabindex="-1"></a>          ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb245-374"><a href="chm_sens_test.html#cb245-374" tabindex="-1"></a>          ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb245-375"><a href="chm_sens_test.html#cb245-375" tabindex="-1"></a>            <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb245-376"><a href="chm_sens_test.html#cb245-376" tabindex="-1"></a>            , <span class="at">strip.text.x =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb245-377"><a href="chm_sens_test.html#cb245-377" tabindex="-1"></a>            , <span class="at">strip.text.y =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">9</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb245-378"><a href="chm_sens_test.html#cb245-378" tabindex="-1"></a>            , <span class="at">axis.text.x =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">7</span>)</span>
<span id="cb245-379"><a href="chm_sens_test.html#cb245-379" tabindex="-1"></a>            , <span class="at">axis.text.y =</span> ggplot2<span class="sc">::</span><span class="fu">element_blank</span>()</span>
<span id="cb245-380"><a href="chm_sens_test.html#cb245-380" tabindex="-1"></a>            , <span class="at">axis.ticks.y =</span> ggplot2<span class="sc">::</span><span class="fu">element_blank</span>()</span>
<span id="cb245-381"><a href="chm_sens_test.html#cb245-381" tabindex="-1"></a>            , <span class="at">panel.grid.major.y =</span> ggplot2<span class="sc">::</span><span class="fu">element_blank</span>()</span>
<span id="cb245-382"><a href="chm_sens_test.html#cb245-382" tabindex="-1"></a>            , <span class="at">panel.grid.minor.y =</span> ggplot2<span class="sc">::</span><span class="fu">element_blank</span>()</span>
<span id="cb245-383"><a href="chm_sens_test.html#cb245-383" tabindex="-1"></a>            , <span class="at">plot.subtitle =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>)</span>
<span id="cb245-384"><a href="chm_sens_test.html#cb245-384" tabindex="-1"></a>          )</span>
<span id="cb245-385"><a href="chm_sens_test.html#cb245-385" tabindex="-1"></a>        </span>
<span id="cb245-386"><a href="chm_sens_test.html#cb245-386" tabindex="-1"></a>        <span class="cf">if</span>(show_rug){</span>
<span id="cb245-387"><a href="chm_sens_test.html#cb245-387" tabindex="-1"></a>          p <span class="ot">&lt;-</span> p <span class="sc">+</span> ggplot2<span class="sc">::</span><span class="fu">geom_rug</span>(<span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">color =</span> pile_metric))</span>
<span id="cb245-388"><a href="chm_sens_test.html#cb245-388" tabindex="-1"></a>        }</span>
<span id="cb245-389"><a href="chm_sens_test.html#cb245-389" tabindex="-1"></a>  }</span>
<span id="cb245-390"><a href="chm_sens_test.html#cb245-390" tabindex="-1"></a>      </span>
<span id="cb245-391"><a href="chm_sens_test.html#cb245-391" tabindex="-1"></a>  <span class="cf">if</span>(</span>
<span id="cb245-392"><a href="chm_sens_test.html#cb245-392" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb245-393"><a href="chm_sens_test.html#cb245-393" tabindex="-1"></a>      <span class="fu">tolower</span>(quant_metric) <span class="sc">==</span> <span class="st">&quot;mape&quot;</span> <span class="sc">~</span> <span class="st">&quot;MAPE&quot;</span></span>
<span id="cb245-394"><a href="chm_sens_test.html#cb245-394" tabindex="-1"></a>      , <span class="fu">tolower</span>(quant_metric) <span class="sc">==</span> <span class="st">&quot;rmse&quot;</span> <span class="sc">~</span> <span class="st">&quot;RMSE&quot;</span></span>
<span id="cb245-395"><a href="chm_sens_test.html#cb245-395" tabindex="-1"></a>      , <span class="fu">tolower</span>(quant_metric) <span class="sc">==</span> <span class="st">&quot;mean&quot;</span> <span class="sc">~</span> <span class="st">&quot;ME&quot;</span></span>
<span id="cb245-396"><a href="chm_sens_test.html#cb245-396" tabindex="-1"></a>      , T <span class="sc">~</span> <span class="st">&quot;MAPE&quot;</span></span>
<span id="cb245-397"><a href="chm_sens_test.html#cb245-397" tabindex="-1"></a>    ) <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;RRMSE&quot;</span>, <span class="st">&quot;MAPE&quot;</span>)</span>
<span id="cb245-398"><a href="chm_sens_test.html#cb245-398" tabindex="-1"></a>  ){</span>
<span id="cb245-399"><a href="chm_sens_test.html#cb245-399" tabindex="-1"></a>    <span class="fu">return</span>(p<span class="sc">+</span>ggplot2<span class="sc">::</span><span class="fu">scale_x_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">percent_format</span>(<span class="at">accuracy =</span> <span class="dv">1</span>)))</span>
<span id="cb245-400"><a href="chm_sens_test.html#cb245-400" tabindex="-1"></a>  }<span class="cf">else</span>{</span>
<span id="cb245-401"><a href="chm_sens_test.html#cb245-401" tabindex="-1"></a>    <span class="fu">return</span>(p)</span>
<span id="cb245-402"><a href="chm_sens_test.html#cb245-402" tabindex="-1"></a>  }</span>
<span id="cb245-403"><a href="chm_sens_test.html#cb245-403" tabindex="-1"></a>    </span>
<span id="cb245-404"><a href="chm_sens_test.html#cb245-404" tabindex="-1"></a>}</span></code></pre></div>
<div id="mape_trends" class="section level4 hasAnchor" number="8.5.2.1">
<h4><span class="header-section-number">8.5.2.1</span> MAPE<a href="chm_sens_test.html#mape_trends" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><strong>MAPE</strong> represents the typical magnitude of error as a percentage, allowing for scale-independent comparisons</p>
<p>distribution across all parameter combinations tested</p>
<div class="sourceCode" id="cb246"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb246-1"><a href="chm_sens_test.html#cb246-1" tabindex="-1"></a><span class="co"># plot it</span></span>
<span id="cb246-2"><a href="chm_sens_test.html#cb246-2" tabindex="-1"></a><span class="fu">plt_form_quantification_dist2</span>(</span>
<span id="cb246-3"><a href="chm_sens_test.html#cb246-3" tabindex="-1"></a>  <span class="at">df =</span> param_combos_gt_agg</span>
<span id="cb246-4"><a href="chm_sens_test.html#cb246-4" tabindex="-1"></a>  , <span class="at">quant_metric =</span> <span class="st">&quot;mape&quot;</span></span>
<span id="cb246-5"><a href="chm_sens_test.html#cb246-5" tabindex="-1"></a>  , <span class="fu">paste0</span>(</span>
<span id="cb246-6"><a href="chm_sens_test.html#cb246-6" tabindex="-1"></a>     <span class="st">&quot;Structural Data Only&quot;</span></span>
<span id="cb246-7"><a href="chm_sens_test.html#cb246-7" tabindex="-1"></a>      , <span class="st">&quot;</span><span class="sc">\n</span><span class="st">distribution of pile form quantification accuracy metrics for all&quot;</span></span>
<span id="cb246-8"><a href="chm_sens_test.html#cb246-8" tabindex="-1"></a>     , <span class="st">&quot; (n=&quot;</span></span>
<span id="cb246-9"><a href="chm_sens_test.html#cb246-9" tabindex="-1"></a>     , scales<span class="sc">::</span><span class="fu">comma</span>(n_combos_tested_chm, <span class="at">accuracy =</span> <span class="dv">1</span>)</span>
<span id="cb246-10"><a href="chm_sens_test.html#cb246-10" tabindex="-1"></a>     , <span class="st">&quot;) &quot;</span></span>
<span id="cb246-11"><a href="chm_sens_test.html#cb246-11" tabindex="-1"></a>     , <span class="st">&quot;parameter combinations tested&quot;</span></span>
<span id="cb246-12"><a href="chm_sens_test.html#cb246-12" tabindex="-1"></a>  )</span>
<span id="cb246-13"><a href="chm_sens_test.html#cb246-13" tabindex="-1"></a>  , <span class="at">show_rug =</span> F</span>
<span id="cb246-14"><a href="chm_sens_test.html#cb246-14" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-215-1.png" width="1008" /></p>
<p>let’s average across all other factors to look at the median main effect by parameter and quantification metric</p>
<div class="sourceCode" id="cb247"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb247-1"><a href="chm_sens_test.html#cb247-1" tabindex="-1"></a><span class="fu">plt_form_quantification_trend</span>(param_combos_gt_agg, <span class="at">quant_metric =</span> <span class="st">&quot;mape&quot;</span>)</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-216-1.png" width="1008" /></p>
<p>Across the different pile measurement metrics, there are non-linear trends between MAPE and CHM resolution, <code>convexity_pct</code>, and <code>circle_fit_iou_pct</code>. Additionally, the height MAPE does not appear to vary much across the different CHM resolutions tested, so non-linear trends between the height measurement error and parameter settings may be less consequential.</p>
</div>
<div id="mean-error-me" class="section level4 hasAnchor" number="8.5.2.2">
<h4><span class="header-section-number">8.5.2.2</span> Mean Error (ME)<a href="chm_sens_test.html#mean-error-me" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><strong>Mean Error (ME)</strong> represents the direction of bias (over or under-prediction) in the original units</p>
<p>distribution across all parameter combinations tested</p>
<div class="sourceCode" id="cb248"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb248-1"><a href="chm_sens_test.html#cb248-1" tabindex="-1"></a><span class="co"># plot it</span></span>
<span id="cb248-2"><a href="chm_sens_test.html#cb248-2" tabindex="-1"></a><span class="fu">plt_form_quantification_dist2</span>(</span>
<span id="cb248-3"><a href="chm_sens_test.html#cb248-3" tabindex="-1"></a>  <span class="at">df =</span> param_combos_gt_agg</span>
<span id="cb248-4"><a href="chm_sens_test.html#cb248-4" tabindex="-1"></a>  , <span class="at">quant_metric =</span> <span class="st">&quot;mean&quot;</span></span>
<span id="cb248-5"><a href="chm_sens_test.html#cb248-5" tabindex="-1"></a>  , <span class="fu">paste0</span>(</span>
<span id="cb248-6"><a href="chm_sens_test.html#cb248-6" tabindex="-1"></a>     <span class="st">&quot;Structural Data Only&quot;</span></span>
<span id="cb248-7"><a href="chm_sens_test.html#cb248-7" tabindex="-1"></a>      , <span class="st">&quot;</span><span class="sc">\n</span><span class="st">distribution of pile form quantification accuracy metrics for all&quot;</span></span>
<span id="cb248-8"><a href="chm_sens_test.html#cb248-8" tabindex="-1"></a>     , <span class="st">&quot; (n=&quot;</span></span>
<span id="cb248-9"><a href="chm_sens_test.html#cb248-9" tabindex="-1"></a>     , scales<span class="sc">::</span><span class="fu">comma</span>(n_combos_tested_chm, <span class="at">accuracy =</span> <span class="dv">1</span>)</span>
<span id="cb248-10"><a href="chm_sens_test.html#cb248-10" tabindex="-1"></a>     , <span class="st">&quot;) &quot;</span></span>
<span id="cb248-11"><a href="chm_sens_test.html#cb248-11" tabindex="-1"></a>     , <span class="st">&quot;parameter combinations tested&quot;</span></span>
<span id="cb248-12"><a href="chm_sens_test.html#cb248-12" tabindex="-1"></a>  )</span>
<span id="cb248-13"><a href="chm_sens_test.html#cb248-13" tabindex="-1"></a>  , <span class="at">show_rug =</span> F</span>
<span id="cb248-14"><a href="chm_sens_test.html#cb248-14" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-217-1.png" width="1008" /></p>
<p>let’s average across all other factors to look at the median main effect by parameter and quantification metric</p>
<div class="sourceCode" id="cb249"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb249-1"><a href="chm_sens_test.html#cb249-1" tabindex="-1"></a><span class="fu">plt_form_quantification_trend</span>(param_combos_gt_agg, <span class="at">quant_metric =</span> <span class="st">&quot;mean&quot;</span>)</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-218-1.png" width="1008" /></p>
</div>
<div id="rmse" class="section level4 hasAnchor" number="8.5.2.3">
<h4><span class="header-section-number">8.5.2.3</span> RMSE<a href="chm_sens_test.html#rmse" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><strong>RMSE</strong> represents the typical magnitude of error in the original units, with a stronger penalty for large errors</p>
<div class="sourceCode" id="cb250"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb250-1"><a href="chm_sens_test.html#cb250-1" tabindex="-1"></a><span class="co"># plot it</span></span>
<span id="cb250-2"><a href="chm_sens_test.html#cb250-2" tabindex="-1"></a><span class="fu">plt_form_quantification_dist2</span>(</span>
<span id="cb250-3"><a href="chm_sens_test.html#cb250-3" tabindex="-1"></a>  <span class="at">df =</span> param_combos_gt_agg</span>
<span id="cb250-4"><a href="chm_sens_test.html#cb250-4" tabindex="-1"></a>  , <span class="at">quant_metric =</span> <span class="st">&quot;rmse&quot;</span></span>
<span id="cb250-5"><a href="chm_sens_test.html#cb250-5" tabindex="-1"></a>  , <span class="fu">paste0</span>(</span>
<span id="cb250-6"><a href="chm_sens_test.html#cb250-6" tabindex="-1"></a>     <span class="st">&quot;Structural Data Only&quot;</span></span>
<span id="cb250-7"><a href="chm_sens_test.html#cb250-7" tabindex="-1"></a>      , <span class="st">&quot;</span><span class="sc">\n</span><span class="st">distribution of pile form quantification accuracy metrics for all&quot;</span></span>
<span id="cb250-8"><a href="chm_sens_test.html#cb250-8" tabindex="-1"></a>     , <span class="st">&quot; (n=&quot;</span></span>
<span id="cb250-9"><a href="chm_sens_test.html#cb250-9" tabindex="-1"></a>     , scales<span class="sc">::</span><span class="fu">comma</span>(n_combos_tested_chm, <span class="at">accuracy =</span> <span class="dv">1</span>)</span>
<span id="cb250-10"><a href="chm_sens_test.html#cb250-10" tabindex="-1"></a>     , <span class="st">&quot;) &quot;</span></span>
<span id="cb250-11"><a href="chm_sens_test.html#cb250-11" tabindex="-1"></a>     , <span class="st">&quot;parameter combinations tested&quot;</span></span>
<span id="cb250-12"><a href="chm_sens_test.html#cb250-12" tabindex="-1"></a>  )</span>
<span id="cb250-13"><a href="chm_sens_test.html#cb250-13" tabindex="-1"></a>  , <span class="at">show_rug =</span> F</span>
<span id="cb250-14"><a href="chm_sens_test.html#cb250-14" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-219-1.png" width="1008" /></p>
<p>let’s average across all other factors to look at the median main effect by parameter and quantification metric</p>
<div class="sourceCode" id="cb251"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb251-1"><a href="chm_sens_test.html#cb251-1" tabindex="-1"></a><span class="fu">plt_form_quantification_trend</span>(param_combos_gt_agg, <span class="at">quant_metric =</span> <span class="st">&quot;rmse&quot;</span>)</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-220-1.png" width="1008" /></p>
</div>
</div>
<div id="best-settings" class="section level3 hasAnchor" number="8.5.3">
<h3><span class="header-section-number">8.5.3</span> Best settings<a href="chm_sens_test.html#best-settings" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Of the parameter levels we tested to generate these accuracy point estimates, let’s identify the best-performing parameter combinations that not only balance detection and quantification accuracy but also achieve the highest recall rates. we’ll select these by choosing any combination whose recall rate is at least one standard deviation above the average for this top group. if no combinations meet this criterion, we will instead select the top 10 combinations based on their recall rates.</p>
<div id="overall-across-chm-resolution" class="section level4 hasAnchor" number="8.5.3.1">
<h4><span class="header-section-number">8.5.3.1</span> Overall (across CHM resolution)<a href="chm_sens_test.html#overall-across-chm-resolution" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>To select the best-performing parameter combinations, we will prioritize those that balance detection and quantification accuracy. From this group, we will then identify the settings that achieve the highest pile detection rates (recall). We emphasize that these recommendations are for users who can generate a CHM from the original point cloud. This is critical because creating a new CHM at the desired resolution is a fundamentally different process than simply disaggregating an existing, coarser raster.</p>
<p>we’ll use the F-Score and the average rank of the MAPE metrics across all form measurements (i.e. height, diameter, area, volume) to determine the best overall list</p>
<div class="sourceCode" id="cb252"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb252-1"><a href="chm_sens_test.html#cb252-1" tabindex="-1"></a><span class="do">##################### START USER DEFINED #####################</span></span>
<span id="cb252-2"><a href="chm_sens_test.html#cb252-2" tabindex="-1"></a><span class="co"># what percent should we classify as top?</span></span>
<span id="cb252-3"><a href="chm_sens_test.html#cb252-3" tabindex="-1"></a>pct_th_top <span class="ot">&lt;-</span> <span class="fl">0.01</span></span>
<span id="cb252-4"><a href="chm_sens_test.html#cb252-4" tabindex="-1"></a><span class="co"># of those top, how many should be selected by recall?</span></span>
<span id="cb252-5"><a href="chm_sens_test.html#cb252-5" tabindex="-1"></a>n_th_top <span class="ot">&lt;-</span> <span class="dv">12</span></span>
<span id="cb252-6"><a href="chm_sens_test.html#cb252-6" tabindex="-1"></a><span class="do">##################### </span><span class="re">END</span><span class="do"> USER DEFINED #####################</span></span>
<span id="cb252-7"><a href="chm_sens_test.html#cb252-7" tabindex="-1"></a></span>
<span id="cb252-8"><a href="chm_sens_test.html#cb252-8" tabindex="-1"></a><span class="co"># math on user defined to label stuff</span></span>
<span id="cb252-9"><a href="chm_sens_test.html#cb252-9" tabindex="-1"></a><span class="co"># structural only</span></span>
<span id="cb252-10"><a href="chm_sens_test.html#cb252-10" tabindex="-1"></a>n_combos_top_overall <span class="ot">&lt;-</span> n_combos_tested<span class="sc">*</span>pct_th_top</span>
<span id="cb252-11"><a href="chm_sens_test.html#cb252-11" tabindex="-1"></a>n_th_top_chm <span class="ot">&lt;-</span> <span class="fu">round</span>(n_th_top<span class="sc">/</span><span class="dv">2</span>)</span>
<span id="cb252-12"><a href="chm_sens_test.html#cb252-12" tabindex="-1"></a>pct_th_top_chm <span class="ot">&lt;-</span> pct_th_top<span class="sc">*</span><span class="dv">2</span></span>
<span id="cb252-13"><a href="chm_sens_test.html#cb252-13" tabindex="-1"></a>n_combos_top_chm <span class="ot">&lt;-</span> <span class="fu">floor</span>(n_combos_tested_chm<span class="sc">*</span>pct_th_top_chm) <span class="co"># double it so we look at more than 14??</span></span>
<span id="cb252-14"><a href="chm_sens_test.html#cb252-14" tabindex="-1"></a>n_combos_top_spectral_chm <span class="ot">&lt;-</span> <span class="fu">floor</span>(n_combos_tested_spectral_chm<span class="sc">*</span>pct_th_top_chm)</span>
<span id="cb252-15"><a href="chm_sens_test.html#cb252-15" tabindex="-1"></a></span>
<span id="cb252-16"><a href="chm_sens_test.html#cb252-16" tabindex="-1"></a><span class="co"># param_combos_gt_agg %&gt;% nrow()</span></span>
<span id="cb252-17"><a href="chm_sens_test.html#cb252-17" tabindex="-1"></a><span class="co"># param_combos_gt_agg %&gt;% dplyr::select(tidyselect::ends_with(&quot;_mape&quot;)) %&gt;% dplyr::glimpse()</span></span>
<span id="cb252-18"><a href="chm_sens_test.html#cb252-18" tabindex="-1"></a>param_combos_ranked <span class="ot">&lt;-</span></span>
<span id="cb252-19"><a href="chm_sens_test.html#cb252-19" tabindex="-1"></a>  param_combos_gt_agg <span class="sc">%&gt;%</span></span>
<span id="cb252-20"><a href="chm_sens_test.html#cb252-20" tabindex="-1"></a>  <span class="do">##########</span></span>
<span id="cb252-21"><a href="chm_sens_test.html#cb252-21" tabindex="-1"></a>  <span class="co"># first. find overall top combinations irrespective of CHM res</span></span>
<span id="cb252-22"><a href="chm_sens_test.html#cb252-22" tabindex="-1"></a>  <span class="do">##########</span></span>
<span id="cb252-23"><a href="chm_sens_test.html#cb252-23" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb252-24"><a href="chm_sens_test.html#cb252-24" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb252-25"><a href="chm_sens_test.html#cb252-25" tabindex="-1"></a>    <span class="co"># label combining params</span></span>
<span id="cb252-26"><a href="chm_sens_test.html#cb252-26" tabindex="-1"></a>    <span class="at">lab =</span> stringr<span class="sc">::</span><span class="fu">str_c</span>(max_ht_m,max_area_m2,convexity_pct,circle_fit_iou_pct,chm_res_m, <span class="at">sep =</span> <span class="st">&quot;:&quot;</span>)</span>
<span id="cb252-27"><a href="chm_sens_test.html#cb252-27" tabindex="-1"></a>    , dplyr<span class="sc">::</span><span class="fu">across</span>(</span>
<span id="cb252-28"><a href="chm_sens_test.html#cb252-28" tabindex="-1"></a>      <span class="at">.cols =</span> <span class="fu">c</span>(tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_mape&quot;</span>))</span>
<span id="cb252-29"><a href="chm_sens_test.html#cb252-29" tabindex="-1"></a>      , <span class="at">.fn =</span> <span class="sc">~</span>dplyr<span class="sc">::</span><span class="fu">percent_rank</span>(<span class="sc">-</span>.x)</span>
<span id="cb252-30"><a href="chm_sens_test.html#cb252-30" tabindex="-1"></a>      , <span class="at">.names =</span> <span class="st">&quot;ovrall_pct_rank_quant_{.col}&quot;</span></span>
<span id="cb252-31"><a href="chm_sens_test.html#cb252-31" tabindex="-1"></a>    )</span>
<span id="cb252-32"><a href="chm_sens_test.html#cb252-32" tabindex="-1"></a>    , dplyr<span class="sc">::</span><span class="fu">across</span>(</span>
<span id="cb252-33"><a href="chm_sens_test.html#cb252-33" tabindex="-1"></a>      <span class="at">.cols =</span> <span class="fu">c</span>(f_score)</span>
<span id="cb252-34"><a href="chm_sens_test.html#cb252-34" tabindex="-1"></a>      <span class="co"># .cols = c(f_score,recall)</span></span>
<span id="cb252-35"><a href="chm_sens_test.html#cb252-35" tabindex="-1"></a>      , <span class="at">.fn =</span> <span class="sc">~</span>dplyr<span class="sc">::</span><span class="fu">percent_rank</span>(.x)</span>
<span id="cb252-36"><a href="chm_sens_test.html#cb252-36" tabindex="-1"></a>      , <span class="at">.names =</span> <span class="st">&quot;ovrall_pct_rank_det_{.col}&quot;</span></span>
<span id="cb252-37"><a href="chm_sens_test.html#cb252-37" tabindex="-1"></a>    )</span>
<span id="cb252-38"><a href="chm_sens_test.html#cb252-38" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb252-39"><a href="chm_sens_test.html#cb252-39" tabindex="-1"></a>  <span class="do">##########</span></span>
<span id="cb252-40"><a href="chm_sens_test.html#cb252-40" tabindex="-1"></a>  <span class="co"># second. find top combinations by CHM res</span></span>
<span id="cb252-41"><a href="chm_sens_test.html#cb252-41" tabindex="-1"></a>  <span class="do">##########</span></span>
<span id="cb252-42"><a href="chm_sens_test.html#cb252-42" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(chm_res_m) <span class="sc">%&gt;%</span> </span>
<span id="cb252-43"><a href="chm_sens_test.html#cb252-43" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb252-44"><a href="chm_sens_test.html#cb252-44" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">across</span>(</span>
<span id="cb252-45"><a href="chm_sens_test.html#cb252-45" tabindex="-1"></a>      <span class="at">.cols =</span> <span class="fu">c</span>(tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_mape&quot;</span>) <span class="sc">&amp;</span> <span class="sc">!</span>tidyselect<span class="sc">::</span><span class="fu">starts_with</span>(<span class="st">&quot;ovrall_pct_rank_&quot;</span>))</span>
<span id="cb252-46"><a href="chm_sens_test.html#cb252-46" tabindex="-1"></a>      , <span class="at">.fn =</span> <span class="sc">~</span>dplyr<span class="sc">::</span><span class="fu">percent_rank</span>(<span class="sc">-</span>.x)</span>
<span id="cb252-47"><a href="chm_sens_test.html#cb252-47" tabindex="-1"></a>      , <span class="at">.names =</span> <span class="st">&quot;chm_pct_rank_quant_{.col}&quot;</span></span>
<span id="cb252-48"><a href="chm_sens_test.html#cb252-48" tabindex="-1"></a>    )</span>
<span id="cb252-49"><a href="chm_sens_test.html#cb252-49" tabindex="-1"></a>    , dplyr<span class="sc">::</span><span class="fu">across</span>(</span>
<span id="cb252-50"><a href="chm_sens_test.html#cb252-50" tabindex="-1"></a>      <span class="at">.cols =</span> <span class="fu">c</span>(f_score)</span>
<span id="cb252-51"><a href="chm_sens_test.html#cb252-51" tabindex="-1"></a>      <span class="co"># .cols = c(f_score,recall)</span></span>
<span id="cb252-52"><a href="chm_sens_test.html#cb252-52" tabindex="-1"></a>      , <span class="at">.fn =</span> <span class="sc">~</span>dplyr<span class="sc">::</span><span class="fu">percent_rank</span>(.x)</span>
<span id="cb252-53"><a href="chm_sens_test.html#cb252-53" tabindex="-1"></a>      , <span class="at">.names =</span> <span class="st">&quot;chm_pct_rank_det_{.col}&quot;</span></span>
<span id="cb252-54"><a href="chm_sens_test.html#cb252-54" tabindex="-1"></a>    )</span>
<span id="cb252-55"><a href="chm_sens_test.html#cb252-55" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb252-56"><a href="chm_sens_test.html#cb252-56" tabindex="-1"></a>  <span class="co"># now get the max of these pct ranks by row</span></span>
<span id="cb252-57"><a href="chm_sens_test.html#cb252-57" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rowwise</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb252-58"><a href="chm_sens_test.html#cb252-58" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb252-59"><a href="chm_sens_test.html#cb252-59" tabindex="-1"></a>    <span class="at">ovrall_pct_rank_quant_mean =</span> <span class="fu">mean</span>(</span>
<span id="cb252-60"><a href="chm_sens_test.html#cb252-60" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">c_across</span>(</span>
<span id="cb252-61"><a href="chm_sens_test.html#cb252-61" tabindex="-1"></a>        tidyselect<span class="sc">::</span><span class="fu">starts_with</span>(<span class="st">&quot;ovrall_pct_rank_quant_&quot;</span>)</span>
<span id="cb252-62"><a href="chm_sens_test.html#cb252-62" tabindex="-1"></a>      )</span>
<span id="cb252-63"><a href="chm_sens_test.html#cb252-63" tabindex="-1"></a>      , <span class="at">na.rm =</span> T</span>
<span id="cb252-64"><a href="chm_sens_test.html#cb252-64" tabindex="-1"></a>    )</span>
<span id="cb252-65"><a href="chm_sens_test.html#cb252-65" tabindex="-1"></a>    , <span class="at">ovrall_pct_rank_det_mean =</span> <span class="fu">mean</span>(</span>
<span id="cb252-66"><a href="chm_sens_test.html#cb252-66" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">c_across</span>(</span>
<span id="cb252-67"><a href="chm_sens_test.html#cb252-67" tabindex="-1"></a>        tidyselect<span class="sc">::</span><span class="fu">starts_with</span>(<span class="st">&quot;ovrall_pct_rank_det_&quot;</span>)</span>
<span id="cb252-68"><a href="chm_sens_test.html#cb252-68" tabindex="-1"></a>      )</span>
<span id="cb252-69"><a href="chm_sens_test.html#cb252-69" tabindex="-1"></a>      , <span class="at">na.rm =</span> T</span>
<span id="cb252-70"><a href="chm_sens_test.html#cb252-70" tabindex="-1"></a>    )</span>
<span id="cb252-71"><a href="chm_sens_test.html#cb252-71" tabindex="-1"></a>    , <span class="at">chm_pct_rank_quant_mean =</span> <span class="fu">mean</span>(</span>
<span id="cb252-72"><a href="chm_sens_test.html#cb252-72" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">c_across</span>(</span>
<span id="cb252-73"><a href="chm_sens_test.html#cb252-73" tabindex="-1"></a>        tidyselect<span class="sc">::</span><span class="fu">starts_with</span>(<span class="st">&quot;chm_pct_rank_quant_&quot;</span>)</span>
<span id="cb252-74"><a href="chm_sens_test.html#cb252-74" tabindex="-1"></a>      )</span>
<span id="cb252-75"><a href="chm_sens_test.html#cb252-75" tabindex="-1"></a>      , <span class="at">na.rm =</span> T</span>
<span id="cb252-76"><a href="chm_sens_test.html#cb252-76" tabindex="-1"></a>    )</span>
<span id="cb252-77"><a href="chm_sens_test.html#cb252-77" tabindex="-1"></a>    , <span class="at">chm_pct_rank_det_mean =</span> <span class="fu">mean</span>(</span>
<span id="cb252-78"><a href="chm_sens_test.html#cb252-78" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">c_across</span>(</span>
<span id="cb252-79"><a href="chm_sens_test.html#cb252-79" tabindex="-1"></a>        tidyselect<span class="sc">::</span><span class="fu">starts_with</span>(<span class="st">&quot;chm_pct_rank_det_&quot;</span>)</span>
<span id="cb252-80"><a href="chm_sens_test.html#cb252-80" tabindex="-1"></a>      )</span>
<span id="cb252-81"><a href="chm_sens_test.html#cb252-81" tabindex="-1"></a>      , <span class="at">na.rm =</span> T</span>
<span id="cb252-82"><a href="chm_sens_test.html#cb252-82" tabindex="-1"></a>    )</span>
<span id="cb252-83"><a href="chm_sens_test.html#cb252-83" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb252-84"><a href="chm_sens_test.html#cb252-84" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb252-85"><a href="chm_sens_test.html#cb252-85" tabindex="-1"></a>  <span class="co"># fill na values</span></span>
<span id="cb252-86"><a href="chm_sens_test.html#cb252-86" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb252-87"><a href="chm_sens_test.html#cb252-87" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">across</span>(</span>
<span id="cb252-88"><a href="chm_sens_test.html#cb252-88" tabindex="-1"></a>      <span class="at">.cols =</span> <span class="fu">c</span>(ovrall_pct_rank_det_mean, ovrall_pct_rank_quant_mean, chm_pct_rank_det_mean, chm_pct_rank_quant_mean)</span>
<span id="cb252-89"><a href="chm_sens_test.html#cb252-89" tabindex="-1"></a>      , <span class="at">.fn =</span> <span class="sc">~</span><span class="fu">ifelse</span>(<span class="fu">is.na</span>(.x),<span class="dv">0</span>,.x)</span>
<span id="cb252-90"><a href="chm_sens_test.html#cb252-90" tabindex="-1"></a>    )</span>
<span id="cb252-91"><a href="chm_sens_test.html#cb252-91" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb252-92"><a href="chm_sens_test.html#cb252-92" tabindex="-1"></a>  <span class="co"># now make quadrant var</span></span>
<span id="cb252-93"><a href="chm_sens_test.html#cb252-93" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb252-94"><a href="chm_sens_test.html#cb252-94" tabindex="-1"></a>    <span class="co"># groupings for the quadrant plot</span></span>
<span id="cb252-95"><a href="chm_sens_test.html#cb252-95" tabindex="-1"></a>    <span class="at">ovrall_accuracy_grp =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb252-96"><a href="chm_sens_test.html#cb252-96" tabindex="-1"></a>        ovrall_pct_rank_det_mean<span class="sc">&gt;=</span><span class="fl">0.95</span> <span class="sc">&amp;</span> ovrall_pct_rank_quant_mean<span class="sc">&gt;=</span><span class="fl">0.95</span> <span class="sc">~</span> <span class="dv">1</span></span>
<span id="cb252-97"><a href="chm_sens_test.html#cb252-97" tabindex="-1"></a>        , ovrall_pct_rank_det_mean<span class="sc">&gt;=</span><span class="fl">0.90</span> <span class="sc">&amp;</span> ovrall_pct_rank_quant_mean<span class="sc">&gt;=</span><span class="fl">0.90</span> <span class="sc">~</span> <span class="dv">2</span></span>
<span id="cb252-98"><a href="chm_sens_test.html#cb252-98" tabindex="-1"></a>        , ovrall_pct_rank_det_mean<span class="sc">&gt;=</span><span class="fl">0.75</span> <span class="sc">&amp;</span> ovrall_pct_rank_quant_mean<span class="sc">&gt;=</span><span class="fl">0.75</span> <span class="sc">~</span> <span class="dv">3</span></span>
<span id="cb252-99"><a href="chm_sens_test.html#cb252-99" tabindex="-1"></a>        , ovrall_pct_rank_det_mean<span class="sc">&gt;=</span><span class="fl">0.50</span> <span class="sc">&amp;</span> ovrall_pct_rank_quant_mean<span class="sc">&gt;=</span><span class="fl">0.50</span> <span class="sc">~</span> <span class="dv">4</span></span>
<span id="cb252-100"><a href="chm_sens_test.html#cb252-100" tabindex="-1"></a>        , ovrall_pct_rank_det_mean<span class="sc">&gt;=</span><span class="fl">0.50</span> <span class="sc">&amp;</span> ovrall_pct_rank_quant_mean<span class="sc">&lt;</span><span class="fl">0.50</span> <span class="sc">~</span> <span class="dv">5</span></span>
<span id="cb252-101"><a href="chm_sens_test.html#cb252-101" tabindex="-1"></a>        , ovrall_pct_rank_det_mean<span class="sc">&lt;</span><span class="fl">0.50</span> <span class="sc">&amp;</span> ovrall_pct_rank_quant_mean<span class="sc">&gt;=</span><span class="fl">0.50</span> <span class="sc">~</span> <span class="dv">6</span></span>
<span id="cb252-102"><a href="chm_sens_test.html#cb252-102" tabindex="-1"></a>        , T <span class="sc">~</span> <span class="dv">7</span></span>
<span id="cb252-103"><a href="chm_sens_test.html#cb252-103" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span> </span>
<span id="cb252-104"><a href="chm_sens_test.html#cb252-104" tabindex="-1"></a>      <span class="fu">factor</span>(</span>
<span id="cb252-105"><a href="chm_sens_test.html#cb252-105" tabindex="-1"></a>        <span class="at">ordered =</span> T</span>
<span id="cb252-106"><a href="chm_sens_test.html#cb252-106" tabindex="-1"></a>        , <span class="at">levels =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">7</span></span>
<span id="cb252-107"><a href="chm_sens_test.html#cb252-107" tabindex="-1"></a>        , <span class="at">labels =</span> <span class="fu">c</span>(</span>
<span id="cb252-108"><a href="chm_sens_test.html#cb252-108" tabindex="-1"></a>          <span class="st">&quot;top 5% detection &amp; quantification&quot;</span> <span class="co"># ovrall_pct_rank_mean&gt;=0.95 &amp; ovrall_pct_rank_f_score&gt;=0.95 ~ 1</span></span>
<span id="cb252-109"><a href="chm_sens_test.html#cb252-109" tabindex="-1"></a>          , <span class="st">&quot;top 10% detection &amp; quantification&quot;</span> <span class="co"># ovrall_pct_rank_mean&gt;=0.90 &amp; ovrall_pct_rank_f_score&gt;=0.90 ~ 2</span></span>
<span id="cb252-110"><a href="chm_sens_test.html#cb252-110" tabindex="-1"></a>          , <span class="st">&quot;top 25% detection &amp; quantification&quot;</span> <span class="co"># ovrall_pct_rank_mean&gt;=0.75 &amp; ovrall_pct_rank_f_score&gt;=0.75 ~ 3</span></span>
<span id="cb252-111"><a href="chm_sens_test.html#cb252-111" tabindex="-1"></a>          , <span class="st">&quot;top 50% detection &amp; quantification&quot;</span> <span class="co"># ovrall_pct_rank_mean&gt;=0.50 &amp; ovrall_pct_rank_f_score&gt;=0.50 ~ 4</span></span>
<span id="cb252-112"><a href="chm_sens_test.html#cb252-112" tabindex="-1"></a>          , <span class="st">&quot;top 50% quantification&quot;</span> <span class="co"># ovrall_pct_rank_mean&gt;=0.50 &amp; ovrall_pct_rank_f_score&lt;0.50 ~ 5</span></span>
<span id="cb252-113"><a href="chm_sens_test.html#cb252-113" tabindex="-1"></a>          , <span class="st">&quot;top 50% detection&quot;</span> <span class="co"># ovrall_pct_rank_mean&lt;0.50 &amp; ovrall_pct_rank_f_score&gt;=0.50 ~ 6</span></span>
<span id="cb252-114"><a href="chm_sens_test.html#cb252-114" tabindex="-1"></a>          , <span class="st">&quot;bottom 50% detection &amp; quantification&quot;</span></span>
<span id="cb252-115"><a href="chm_sens_test.html#cb252-115" tabindex="-1"></a>        )</span>
<span id="cb252-116"><a href="chm_sens_test.html#cb252-116" tabindex="-1"></a>      )</span>
<span id="cb252-117"><a href="chm_sens_test.html#cb252-117" tabindex="-1"></a>    , <span class="at">chm_accuracy_grp =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb252-118"><a href="chm_sens_test.html#cb252-118" tabindex="-1"></a>        chm_pct_rank_det_mean<span class="sc">&gt;=</span><span class="fl">0.95</span> <span class="sc">&amp;</span> chm_pct_rank_quant_mean<span class="sc">&gt;=</span><span class="fl">0.95</span> <span class="sc">~</span> <span class="dv">1</span></span>
<span id="cb252-119"><a href="chm_sens_test.html#cb252-119" tabindex="-1"></a>        , chm_pct_rank_det_mean<span class="sc">&gt;=</span><span class="fl">0.90</span> <span class="sc">&amp;</span> chm_pct_rank_quant_mean<span class="sc">&gt;=</span><span class="fl">0.90</span> <span class="sc">~</span> <span class="dv">2</span></span>
<span id="cb252-120"><a href="chm_sens_test.html#cb252-120" tabindex="-1"></a>        , chm_pct_rank_det_mean<span class="sc">&gt;=</span><span class="fl">0.75</span> <span class="sc">&amp;</span> chm_pct_rank_quant_mean<span class="sc">&gt;=</span><span class="fl">0.75</span> <span class="sc">~</span> <span class="dv">3</span></span>
<span id="cb252-121"><a href="chm_sens_test.html#cb252-121" tabindex="-1"></a>        , chm_pct_rank_det_mean<span class="sc">&gt;=</span><span class="fl">0.50</span> <span class="sc">&amp;</span> chm_pct_rank_quant_mean<span class="sc">&gt;=</span><span class="fl">0.50</span> <span class="sc">~</span> <span class="dv">4</span></span>
<span id="cb252-122"><a href="chm_sens_test.html#cb252-122" tabindex="-1"></a>        , chm_pct_rank_det_mean<span class="sc">&gt;=</span><span class="fl">0.50</span> <span class="sc">&amp;</span> chm_pct_rank_quant_mean<span class="sc">&lt;</span><span class="fl">0.50</span> <span class="sc">~</span> <span class="dv">5</span></span>
<span id="cb252-123"><a href="chm_sens_test.html#cb252-123" tabindex="-1"></a>        , chm_pct_rank_det_mean<span class="sc">&lt;</span><span class="fl">0.50</span> <span class="sc">&amp;</span> chm_pct_rank_quant_mean<span class="sc">&gt;=</span><span class="fl">0.50</span> <span class="sc">~</span> <span class="dv">6</span></span>
<span id="cb252-124"><a href="chm_sens_test.html#cb252-124" tabindex="-1"></a>        , T <span class="sc">~</span> <span class="dv">7</span></span>
<span id="cb252-125"><a href="chm_sens_test.html#cb252-125" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span> </span>
<span id="cb252-126"><a href="chm_sens_test.html#cb252-126" tabindex="-1"></a>      <span class="fu">factor</span>(</span>
<span id="cb252-127"><a href="chm_sens_test.html#cb252-127" tabindex="-1"></a>        <span class="at">ordered =</span> T</span>
<span id="cb252-128"><a href="chm_sens_test.html#cb252-128" tabindex="-1"></a>        , <span class="at">levels =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">7</span></span>
<span id="cb252-129"><a href="chm_sens_test.html#cb252-129" tabindex="-1"></a>        , <span class="at">labels =</span> <span class="fu">c</span>(</span>
<span id="cb252-130"><a href="chm_sens_test.html#cb252-130" tabindex="-1"></a>          <span class="st">&quot;top 5% detection &amp; quantification&quot;</span> <span class="co"># chm_pct_rank_mean&gt;=0.95 &amp; chm_pct_rank_f_score&gt;=0.95 ~ 1</span></span>
<span id="cb252-131"><a href="chm_sens_test.html#cb252-131" tabindex="-1"></a>          , <span class="st">&quot;top 10% detection &amp; quantification&quot;</span> <span class="co"># chm_pct_rank_mean&gt;=0.90 &amp; chm_pct_rank_f_score&gt;=0.90 ~ 2</span></span>
<span id="cb252-132"><a href="chm_sens_test.html#cb252-132" tabindex="-1"></a>          , <span class="st">&quot;top 25% detection &amp; quantification&quot;</span> <span class="co"># chm_pct_rank_mean&gt;=0.75 &amp; chm_pct_rank_f_score&gt;=0.75 ~ 3</span></span>
<span id="cb252-133"><a href="chm_sens_test.html#cb252-133" tabindex="-1"></a>          , <span class="st">&quot;top 50% detection &amp; quantification&quot;</span> <span class="co"># chm_pct_rank_mean&gt;=0.50 &amp; chm_pct_rank_f_score&gt;=0.50 ~ 4</span></span>
<span id="cb252-134"><a href="chm_sens_test.html#cb252-134" tabindex="-1"></a>          , <span class="st">&quot;top 50% quantification&quot;</span> <span class="co"># chm_pct_rank_mean&gt;=0.50 &amp; chm_pct_rank_f_score&lt;0.50 ~ 5</span></span>
<span id="cb252-135"><a href="chm_sens_test.html#cb252-135" tabindex="-1"></a>          , <span class="st">&quot;top 50% detection&quot;</span> <span class="co"># chm_pct_rank_mean&lt;0.50 &amp; chm_pct_rank_f_score&gt;=0.50 ~ 6</span></span>
<span id="cb252-136"><a href="chm_sens_test.html#cb252-136" tabindex="-1"></a>          , <span class="st">&quot;bottom 50% detection &amp; quantification&quot;</span></span>
<span id="cb252-137"><a href="chm_sens_test.html#cb252-137" tabindex="-1"></a>        )</span>
<span id="cb252-138"><a href="chm_sens_test.html#cb252-138" tabindex="-1"></a>      )</span>
<span id="cb252-139"><a href="chm_sens_test.html#cb252-139" tabindex="-1"></a>    , </span>
<span id="cb252-140"><a href="chm_sens_test.html#cb252-140" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb252-141"><a href="chm_sens_test.html#cb252-141" tabindex="-1"></a>  <span class="do">##########</span></span>
<span id="cb252-142"><a href="chm_sens_test.html#cb252-142" tabindex="-1"></a>  <span class="co"># first. find overall top combinations irrespective of CHM res</span></span>
<span id="cb252-143"><a href="chm_sens_test.html#cb252-143" tabindex="-1"></a>  <span class="do">##########</span></span>
<span id="cb252-144"><a href="chm_sens_test.html#cb252-144" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb252-145"><a href="chm_sens_test.html#cb252-145" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb252-146"><a href="chm_sens_test.html#cb252-146" tabindex="-1"></a>    <span class="at">ovrall_balanced_pct_rank =</span> dplyr<span class="sc">::</span><span class="fu">percent_rank</span>( (ovrall_pct_rank_det_mean<span class="sc">+</span>ovrall_pct_rank_quant_mean)<span class="sc">/</span><span class="dv">2</span> ) <span class="co"># equally weight quant and detection</span></span>
<span id="cb252-147"><a href="chm_sens_test.html#cb252-147" tabindex="-1"></a>    , <span class="at">ovrall_lab =</span> forcats<span class="sc">::</span><span class="fu">fct_reorder</span>(lab, ovrall_balanced_pct_rank)</span>
<span id="cb252-148"><a href="chm_sens_test.html#cb252-148" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb252-149"><a href="chm_sens_test.html#cb252-149" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(<span class="fu">desc</span>(ovrall_balanced_pct_rank),<span class="fu">desc</span>(ovrall_pct_rank_det_mean),<span class="fu">desc</span>(ovrall_pct_rank_quant_mean)) <span class="sc">%&gt;%</span> </span>
<span id="cb252-150"><a href="chm_sens_test.html#cb252-150" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb252-151"><a href="chm_sens_test.html#cb252-151" tabindex="-1"></a>    <span class="at">ovrall_balanced_rank =</span> dplyr<span class="sc">::</span><span class="fu">row_number</span>()</span>
<span id="cb252-152"><a href="chm_sens_test.html#cb252-152" tabindex="-1"></a>    <span class="co"># is_top_overall = using rows in case not all combos resulted in piles and/or </span></span>
<span id="cb252-153"><a href="chm_sens_test.html#cb252-153" tabindex="-1"></a>      <span class="co"># there are many ties in the data leading to no records with a percent rank &lt;= pct_th_top (e.g. many tied at 98%)</span></span>
<span id="cb252-154"><a href="chm_sens_test.html#cb252-154" tabindex="-1"></a>    , <span class="at">is_top_overall =</span> dplyr<span class="sc">::</span><span class="fu">row_number</span>()<span class="sc">&lt;=</span>(n_combos_top_overall)</span>
<span id="cb252-155"><a href="chm_sens_test.html#cb252-155" tabindex="-1"></a>      <span class="co"># ovrall_balanced_pct_rank&gt;=(1-pct_th_top)</span></span>
<span id="cb252-156"><a href="chm_sens_test.html#cb252-156" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb252-157"><a href="chm_sens_test.html#cb252-157" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(<span class="fu">desc</span>(is_top_overall),<span class="fu">desc</span>(recall),<span class="fu">desc</span>(ovrall_pct_rank_det_mean),<span class="fu">desc</span>(ovrall_pct_rank_quant_mean),ovrall_balanced_rank) <span class="sc">%&gt;%</span> </span>
<span id="cb252-158"><a href="chm_sens_test.html#cb252-158" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">is_final_selection =</span> is_top_overall <span class="sc">&amp;</span> dplyr<span class="sc">::</span><span class="fu">row_number</span>()<span class="sc">&lt;=</span>n_th_top) <span class="sc">%&gt;%</span> </span>
<span id="cb252-159"><a href="chm_sens_test.html#cb252-159" tabindex="-1"></a>  <span class="do">##########</span></span>
<span id="cb252-160"><a href="chm_sens_test.html#cb252-160" tabindex="-1"></a>  <span class="co"># second. find top combinations by CHM res</span></span>
<span id="cb252-161"><a href="chm_sens_test.html#cb252-161" tabindex="-1"></a>  <span class="do">##########</span></span>
<span id="cb252-162"><a href="chm_sens_test.html#cb252-162" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(chm_res_m) <span class="sc">%&gt;%</span> </span>
<span id="cb252-163"><a href="chm_sens_test.html#cb252-163" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb252-164"><a href="chm_sens_test.html#cb252-164" tabindex="-1"></a>    <span class="at">chm_balanced_pct_rank =</span> dplyr<span class="sc">::</span><span class="fu">percent_rank</span>( (chm_pct_rank_det_mean<span class="sc">+</span>chm_pct_rank_quant_mean)<span class="sc">/</span><span class="dv">2</span> ) <span class="co"># equally weight quant and detection</span></span>
<span id="cb252-165"><a href="chm_sens_test.html#cb252-165" tabindex="-1"></a>    , <span class="at">chm_lab =</span> forcats<span class="sc">::</span><span class="fu">fct_reorder</span>(lab, chm_balanced_pct_rank)</span>
<span id="cb252-166"><a href="chm_sens_test.html#cb252-166" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb252-167"><a href="chm_sens_test.html#cb252-167" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(chm_res_m,<span class="fu">desc</span>(chm_balanced_pct_rank),<span class="fu">desc</span>(chm_pct_rank_det_mean),<span class="fu">desc</span>(chm_pct_rank_quant_mean),ovrall_balanced_rank) <span class="sc">%&gt;%</span> </span>
<span id="cb252-168"><a href="chm_sens_test.html#cb252-168" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb252-169"><a href="chm_sens_test.html#cb252-169" tabindex="-1"></a>    <span class="at">chm_balanced_rank =</span> dplyr<span class="sc">::</span><span class="fu">row_number</span>()</span>
<span id="cb252-170"><a href="chm_sens_test.html#cb252-170" tabindex="-1"></a>    <span class="co"># is_top_chm = using rows in case not all combos resulted in piles and/or </span></span>
<span id="cb252-171"><a href="chm_sens_test.html#cb252-171" tabindex="-1"></a>      <span class="co"># there are many ties in the data leading to no records with a percent rank &lt;= pct_th_top (e.g. many tied at 98%)</span></span>
<span id="cb252-172"><a href="chm_sens_test.html#cb252-172" tabindex="-1"></a>    , <span class="at">is_top_chm =</span> dplyr<span class="sc">::</span><span class="fu">row_number</span>()<span class="sc">&lt;=</span>n_combos_top_chm <span class="co"># double it so we look at more than 14??</span></span>
<span id="cb252-173"><a href="chm_sens_test.html#cb252-173" tabindex="-1"></a>      <span class="co"># chm_balanced_pct_rank&gt;=(1-pct_th_top)</span></span>
<span id="cb252-174"><a href="chm_sens_test.html#cb252-174" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb252-175"><a href="chm_sens_test.html#cb252-175" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(chm_res_m,<span class="fu">desc</span>(is_top_chm),<span class="fu">desc</span>(recall),<span class="fu">desc</span>(chm_pct_rank_det_mean),<span class="fu">desc</span>(chm_pct_rank_quant_mean),ovrall_balanced_rank) <span class="sc">%&gt;%</span> </span>
<span id="cb252-176"><a href="chm_sens_test.html#cb252-176" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">is_final_selection_chm =</span> is_top_chm <span class="sc">&amp;</span> dplyr<span class="sc">::</span><span class="fu">row_number</span>()<span class="sc">&lt;=</span>n_th_top_chm) <span class="sc">%&gt;%</span> <span class="co"># half it because it&#39;s going to be a lot to show in our facet ggplot</span></span>
<span id="cb252-177"><a href="chm_sens_test.html#cb252-177" tabindex="-1"></a>  <span class="do">##### clean up</span></span>
<span id="cb252-178"><a href="chm_sens_test.html#cb252-178" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb252-179"><a href="chm_sens_test.html#cb252-179" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(</span>
<span id="cb252-180"><a href="chm_sens_test.html#cb252-180" tabindex="-1"></a>    <span class="fu">c</span>(tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_mape&quot;</span>) <span class="sc">&amp;</span> tidyselect<span class="sc">::</span><span class="fu">starts_with</span>(<span class="st">&quot;ovrall_pct_rank_&quot;</span>))</span>
<span id="cb252-181"><a href="chm_sens_test.html#cb252-181" tabindex="-1"></a>    , <span class="fu">c</span>(tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_mape&quot;</span>) <span class="sc">&amp;</span> tidyselect<span class="sc">::</span><span class="fu">starts_with</span>(<span class="st">&quot;chm_pct_rank_&quot;</span>))</span>
<span id="cb252-182"><a href="chm_sens_test.html#cb252-182" tabindex="-1"></a>    , <span class="fu">c</span>(tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_f_score&quot;</span>) <span class="sc">&amp;</span> tidyselect<span class="sc">::</span><span class="fu">starts_with</span>(<span class="st">&quot;ovrall_pct_rank_&quot;</span>))</span>
<span id="cb252-183"><a href="chm_sens_test.html#cb252-183" tabindex="-1"></a>    , <span class="fu">c</span>(tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_f_score&quot;</span>) <span class="sc">&amp;</span> tidyselect<span class="sc">::</span><span class="fu">starts_with</span>(<span class="st">&quot;chm_pct_rank_&quot;</span>))</span>
<span id="cb252-184"><a href="chm_sens_test.html#cb252-184" tabindex="-1"></a>  ))</span>
<span id="cb252-185"><a href="chm_sens_test.html#cb252-185" tabindex="-1"></a><span class="co"># huh?</span></span>
<span id="cb252-186"><a href="chm_sens_test.html#cb252-186" tabindex="-1"></a><span class="co"># param_combos_ranked %&gt;% dplyr::glimpse()</span></span>
<span id="cb252-187"><a href="chm_sens_test.html#cb252-187" tabindex="-1"></a><span class="co"># param_combos_ranked %&gt;% dplyr::count(is_final_selection)</span></span></code></pre></div>
<p>to determine the combinations that achieved the best balance between both detection and quantification accuracy, we’re selecting the parameter combinations that are in the upper-right of the quadrant plot. That is, the parameter combinations that performed best at both pile detection accuracy and pile form quantification accuracy</p>
<div class="sourceCode" id="cb253"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb253-1"><a href="chm_sens_test.html#cb253-1" tabindex="-1"></a><span class="co"># plot</span></span>
<span id="cb253-2"><a href="chm_sens_test.html#cb253-2" tabindex="-1"></a>param_combos_ranked <span class="sc">%&gt;%</span>   </span>
<span id="cb253-3"><a href="chm_sens_test.html#cb253-3" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(</span>
<span id="cb253-4"><a href="chm_sens_test.html#cb253-4" tabindex="-1"></a>    <span class="at">mapping=</span>ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> ovrall_pct_rank_det_mean, <span class="at">y =</span> ovrall_pct_rank_quant_mean, <span class="at">color =</span> ovrall_accuracy_grp)</span>
<span id="cb253-5"><a href="chm_sens_test.html#cb253-5" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb253-6"><a href="chm_sens_test.html#cb253-6" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fl">0.5</span>, <span class="at">color =</span> <span class="st">&quot;gray22&quot;</span>) <span class="sc">+</span></span>
<span id="cb253-7"><a href="chm_sens_test.html#cb253-7" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fl">0.5</span>, <span class="at">color =</span> <span class="st">&quot;gray22&quot;</span>) <span class="sc">+</span></span>
<span id="cb253-8"><a href="chm_sens_test.html#cb253-8" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fl">0.75</span>, <span class="at">color =</span> <span class="st">&quot;gray44&quot;</span>) <span class="sc">+</span></span>
<span id="cb253-9"><a href="chm_sens_test.html#cb253-9" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fl">0.75</span>, <span class="at">color =</span> <span class="st">&quot;gray44&quot;</span>) <span class="sc">+</span></span>
<span id="cb253-10"><a href="chm_sens_test.html#cb253-10" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fl">0.9</span>, <span class="at">color =</span> <span class="st">&quot;gray66&quot;</span>) <span class="sc">+</span></span>
<span id="cb253-11"><a href="chm_sens_test.html#cb253-11" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fl">0.9</span>, <span class="at">color =</span> <span class="st">&quot;gray66&quot;</span>) <span class="sc">+</span></span>
<span id="cb253-12"><a href="chm_sens_test.html#cb253-12" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb253-13"><a href="chm_sens_test.html#cb253-13" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_colour_viridis_d</span>(<span class="at">direction =</span> <span class="sc">-</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb253-14"><a href="chm_sens_test.html#cb253-14" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_x_continuous</span>(</span>
<span id="cb253-15"><a href="chm_sens_test.html#cb253-15" tabindex="-1"></a>    <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">percent_format</span>(<span class="at">accuracy =</span> <span class="dv">1</span>)</span>
<span id="cb253-16"><a href="chm_sens_test.html#cb253-16" tabindex="-1"></a>    , <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)</span>
<span id="cb253-17"><a href="chm_sens_test.html#cb253-17" tabindex="-1"></a>  ) <span class="sc">+</span>  </span>
<span id="cb253-18"><a href="chm_sens_test.html#cb253-18" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_y_continuous</span>(</span>
<span id="cb253-19"><a href="chm_sens_test.html#cb253-19" tabindex="-1"></a>    <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">percent_format</span>(<span class="at">accuracy =</span> <span class="dv">1</span>)</span>
<span id="cb253-20"><a href="chm_sens_test.html#cb253-20" tabindex="-1"></a>    , <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)</span>
<span id="cb253-21"><a href="chm_sens_test.html#cb253-21" tabindex="-1"></a>  ) <span class="sc">+</span>  </span>
<span id="cb253-22"><a href="chm_sens_test.html#cb253-22" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb253-23"><a href="chm_sens_test.html#cb253-23" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;Percentile F-Score&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Percentile MAPE (mean)&quot;</span></span>
<span id="cb253-24"><a href="chm_sens_test.html#cb253-24" tabindex="-1"></a>    , <span class="at">color =</span> <span class="st">&quot;&quot;</span></span>
<span id="cb253-25"><a href="chm_sens_test.html#cb253-25" tabindex="-1"></a>    , <span class="at">subtitle =</span> <span class="st">&quot;Structural Data Only&quot;</span></span>
<span id="cb253-26"><a href="chm_sens_test.html#cb253-26" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb253-27"><a href="chm_sens_test.html#cb253-27" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb253-28"><a href="chm_sens_test.html#cb253-28" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb253-29"><a href="chm_sens_test.html#cb253-29" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span></span>
<span id="cb253-30"><a href="chm_sens_test.html#cb253-30" tabindex="-1"></a>    , <span class="at">legend.text =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>)</span>
<span id="cb253-31"><a href="chm_sens_test.html#cb253-31" tabindex="-1"></a>    , <span class="at">strip.text =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb253-32"><a href="chm_sens_test.html#cb253-32" tabindex="-1"></a>    , <span class="at">axis.text =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">7</span>)</span>
<span id="cb253-33"><a href="chm_sens_test.html#cb253-33" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb253-34"><a href="chm_sens_test.html#cb253-34" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">guides</span>(</span>
<span id="cb253-35"><a href="chm_sens_test.html#cb253-35" tabindex="-1"></a>    <span class="at">color =</span> ggplot2<span class="sc">::</span><span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">shape =</span> <span class="dv">15</span>, <span class="at">linetype =</span> <span class="dv">0</span>, <span class="at">size =</span> <span class="dv">5</span>, <span class="at">alpha =</span> <span class="dv">1</span>))</span>
<span id="cb253-36"><a href="chm_sens_test.html#cb253-36" tabindex="-1"></a>    , <span class="at">shape =</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb253-37"><a href="chm_sens_test.html#cb253-37" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-223-1.png" width="1008" /></p>
<div id="top-1.0" class="section level5 hasAnchor" number="8.5.3.1.1">
<h5><span class="header-section-number">8.5.3.1.1</span> Top 1.0%<a href="chm_sens_test.html#top-1.0" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>let’s check out the parameter settings of the top 1.0% (n=59) from all 5,880 combinations tested. these are “votes” for the parameter setting based on the combinations that achieved the best balance between both detection and quantification accuracy.</p>
<div class="sourceCode" id="cb254"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb254-1"><a href="chm_sens_test.html#cb254-1" tabindex="-1"></a>pal_param <span class="ot">&lt;-</span> viridis<span class="sc">::</span><span class="fu">cividis</span>(<span class="at">n=</span><span class="dv">6</span>, <span class="at">alpha =</span> <span class="fl">0.9</span>)</span>
<span id="cb254-2"><a href="chm_sens_test.html#cb254-2" tabindex="-1"></a>param_combos_ranked <span class="sc">%&gt;%</span></span>
<span id="cb254-3"><a href="chm_sens_test.html#cb254-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(is_top_overall) <span class="sc">%&gt;%</span> </span>
<span id="cb254-4"><a href="chm_sens_test.html#cb254-4" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;f_score&quot;</span>), max_ht_m,max_area_m2,convexity_pct,circle_fit_iou_pct,chm_res_m) <span class="sc">%&gt;%</span> </span>
<span id="cb254-5"><a href="chm_sens_test.html#cb254-5" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(</span>
<span id="cb254-6"><a href="chm_sens_test.html#cb254-6" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">c</span>(max_ht_m,max_area_m2,convexity_pct,circle_fit_iou_pct,chm_res_m)</span>
<span id="cb254-7"><a href="chm_sens_test.html#cb254-7" tabindex="-1"></a>    , <span class="at">names_to =</span> <span class="st">&quot;metric&quot;</span></span>
<span id="cb254-8"><a href="chm_sens_test.html#cb254-8" tabindex="-1"></a>    , <span class="at">values_to =</span> <span class="st">&quot;value&quot;</span></span>
<span id="cb254-9"><a href="chm_sens_test.html#cb254-9" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb254-10"><a href="chm_sens_test.html#cb254-10" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">count</span>(metric, value) <span class="sc">%&gt;%</span> </span>
<span id="cb254-11"><a href="chm_sens_test.html#cb254-11" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(metric) <span class="sc">%&gt;%</span> </span>
<span id="cb254-12"><a href="chm_sens_test.html#cb254-12" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb254-13"><a href="chm_sens_test.html#cb254-13" tabindex="-1"></a>    <span class="at">pct=</span>n<span class="sc">/</span><span class="fu">sum</span>(n)</span>
<span id="cb254-14"><a href="chm_sens_test.html#cb254-14" tabindex="-1"></a>    , <span class="at">lab =</span> <span class="fu">paste0</span>(scales<span class="sc">::</span><span class="fu">percent</span>(pct,<span class="at">accuracy=</span><span class="fl">0.1</span>), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">n=&quot;</span>, scales<span class="sc">::</span><span class="fu">comma</span>(n,<span class="at">accuracy=</span><span class="dv">1</span>))</span>
<span id="cb254-15"><a href="chm_sens_test.html#cb254-15" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb254-16"><a href="chm_sens_test.html#cb254-16" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(</span>
<span id="cb254-17"><a href="chm_sens_test.html#cb254-17" tabindex="-1"></a>    <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">factor</span>(value), <span class="at">y=</span>pct, <span class="at">label=</span>lab, <span class="at">fill =</span> metric)</span>
<span id="cb254-18"><a href="chm_sens_test.html#cb254-18" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb254-19"><a href="chm_sens_test.html#cb254-19" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_col</span>(<span class="at">width =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb254-20"><a href="chm_sens_test.html#cb254-20" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_text</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">size =</span> <span class="fl">2.5</span>, <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb254-21"><a href="chm_sens_test.html#cb254-21" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">facet_wrap</span>(<span class="at">facets =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(metric), <span class="at">ncol=</span><span class="dv">2</span>, <span class="at">scales =</span> <span class="st">&quot;free_x&quot;</span>) <span class="sc">+</span></span>
<span id="cb254-22"><a href="chm_sens_test.html#cb254-22" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_y_continuous</span>(</span>
<span id="cb254-23"><a href="chm_sens_test.html#cb254-23" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="at">by=</span><span class="fl">0.2</span>)</span>
<span id="cb254-24"><a href="chm_sens_test.html#cb254-24" tabindex="-1"></a>    , <span class="at">labels =</span> scales<span class="sc">::</span>percent</span>
<span id="cb254-25"><a href="chm_sens_test.html#cb254-25" tabindex="-1"></a>    , <span class="at">expand =</span> ggplot2<span class="sc">::</span><span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">0.2</span>))</span>
<span id="cb254-26"><a href="chm_sens_test.html#cb254-26" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb254-27"><a href="chm_sens_test.html#cb254-27" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_fill_manual</span>(<span class="at">values =</span> pal_param[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>]) <span class="sc">+</span></span>
<span id="cb254-28"><a href="chm_sens_test.html#cb254-28" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb254-29"><a href="chm_sens_test.html#cb254-29" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;parameter setting&quot;</span>, <span class="at">y =</span> <span class="st">&quot;&quot;</span></span>
<span id="cb254-30"><a href="chm_sens_test.html#cb254-30" tabindex="-1"></a>    , <span class="at">fill =</span> <span class="st">&quot;&quot;</span></span>
<span id="cb254-31"><a href="chm_sens_test.html#cb254-31" tabindex="-1"></a>    , <span class="at">subtitle =</span> <span class="fu">paste0</span>(</span>
<span id="cb254-32"><a href="chm_sens_test.html#cb254-32" tabindex="-1"></a>      <span class="st">&quot;Structural Data Only&quot;</span></span>
<span id="cb254-33"><a href="chm_sens_test.html#cb254-33" tabindex="-1"></a>       , <span class="st">&quot;</span><span class="sc">\n</span><span class="st">parameter settings of top &quot;</span></span>
<span id="cb254-34"><a href="chm_sens_test.html#cb254-34" tabindex="-1"></a>       , scales<span class="sc">::</span><span class="fu">percent</span>(pct_th_top,<span class="at">accuracy=</span><span class="fl">0.1</span>)</span>
<span id="cb254-35"><a href="chm_sens_test.html#cb254-35" tabindex="-1"></a>       , <span class="st">&quot; (n=&quot;</span></span>
<span id="cb254-36"><a href="chm_sens_test.html#cb254-36" tabindex="-1"></a>       , scales<span class="sc">::</span><span class="fu">comma</span>(n_combos_top_overall, <span class="at">accuracy =</span> <span class="dv">1</span>)</span>
<span id="cb254-37"><a href="chm_sens_test.html#cb254-37" tabindex="-1"></a>       , <span class="st">&quot;) &quot;</span></span>
<span id="cb254-38"><a href="chm_sens_test.html#cb254-38" tabindex="-1"></a>       , <span class="st">&quot;overall parameter combinations tested</span><span class="sc">\n</span><span class="st">based on both detection and quantification accuracy&quot;</span></span>
<span id="cb254-39"><a href="chm_sens_test.html#cb254-39" tabindex="-1"></a>    )</span>
<span id="cb254-40"><a href="chm_sens_test.html#cb254-40" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb254-41"><a href="chm_sens_test.html#cb254-41" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb254-42"><a href="chm_sens_test.html#cb254-42" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb254-43"><a href="chm_sens_test.html#cb254-43" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb254-44"><a href="chm_sens_test.html#cb254-44" tabindex="-1"></a>    , <span class="at">strip.text =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb254-45"><a href="chm_sens_test.html#cb254-45" tabindex="-1"></a>    , <span class="at">axis.text.y =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">6</span>)</span>
<span id="cb254-46"><a href="chm_sens_test.html#cb254-46" tabindex="-1"></a>    , <span class="at">axis.text.x =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>)</span>
<span id="cb254-47"><a href="chm_sens_test.html#cb254-47" tabindex="-1"></a>    , <span class="at">plot.subtitle =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>)</span>
<span id="cb254-48"><a href="chm_sens_test.html#cb254-48" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-224-1.png" width="1008" /></p>
<p>these results indicate that the finer resolution CHM data is preferable for detecting and quantifying slash piles from aerial point cloud data using our methodology. Given our study site, there is a single <code>max_ht_m</code> setting that best fits the data collected at this site. The remaining structural parameters tested (<code>max_area_m2</code>, <code>convexity_pct</code>, <code>circle_fit_iou_pct</code>) can yield good results over a broad setting range but it is important to remember that the influence of these settings is dependent on the value of the other parameters. That is, the effect of one parameter (e.g., <code>convexity_pct</code>) on the accuracy metrics changes depending on the value of another parameter (e.g., <code>circle_fit_iou_pct</code>).</p>
<p>what is the expected <em>detection</em> accuracy of the top 1.0% (n=59) combinations tested?</p>
<div class="sourceCode" id="cb255"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb255-1"><a href="chm_sens_test.html#cb255-1" tabindex="-1"></a><span class="fu">plt_detection_dist</span>(</span>
<span id="cb255-2"><a href="chm_sens_test.html#cb255-2" tabindex="-1"></a>  <span class="at">df =</span> param_combos_ranked <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(is_top_overall) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">!</span>tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;_pct_rank_&quot;</span>))</span>
<span id="cb255-3"><a href="chm_sens_test.html#cb255-3" tabindex="-1"></a>  , <span class="fu">paste0</span>(</span>
<span id="cb255-4"><a href="chm_sens_test.html#cb255-4" tabindex="-1"></a>    <span class="st">&quot;Structural Data Only&quot;</span></span>
<span id="cb255-5"><a href="chm_sens_test.html#cb255-5" tabindex="-1"></a>    , <span class="st">&quot;</span><span class="sc">\n</span><span class="st">distribution of pile detection metrics for top &quot;</span></span>
<span id="cb255-6"><a href="chm_sens_test.html#cb255-6" tabindex="-1"></a>    , scales<span class="sc">::</span><span class="fu">percent</span>(pct_th_top,<span class="at">accuracy=</span><span class="fl">0.1</span>)</span>
<span id="cb255-7"><a href="chm_sens_test.html#cb255-7" tabindex="-1"></a>    , <span class="st">&quot; (n=&quot;</span></span>
<span id="cb255-8"><a href="chm_sens_test.html#cb255-8" tabindex="-1"></a>    , scales<span class="sc">::</span><span class="fu">comma</span>(n_combos_top_overall, <span class="at">accuracy =</span> <span class="dv">1</span>)</span>
<span id="cb255-9"><a href="chm_sens_test.html#cb255-9" tabindex="-1"></a>    , <span class="st">&quot;) &quot;</span></span>
<span id="cb255-10"><a href="chm_sens_test.html#cb255-10" tabindex="-1"></a>    , <span class="st">&quot;overall parameter combinations tested</span><span class="sc">\n</span><span class="st">based on both detection and quantification accuracy&quot;</span></span>
<span id="cb255-11"><a href="chm_sens_test.html#cb255-11" tabindex="-1"></a>  )</span>
<span id="cb255-12"><a href="chm_sens_test.html#cb255-12" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-225-1.png" width="1008" /></p>
<p>These results are promising for our detection methodology when given structural data only (i.e. CHM data but no spectral data). Using the structural data alone, the best performing parameterization settings of those tested achieved an F-score (balanced detection accuracy) of approximately 77.1% with a detection rate (recall) of approximately 71.1%</p>
<p>what is the expected <em>quantification</em> accuracy of the top 1.0% (n=59) combinations tested?</p>
<div class="sourceCode" id="cb256"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb256-1"><a href="chm_sens_test.html#cb256-1" tabindex="-1"></a><span class="co"># plot it</span></span>
<span id="cb256-2"><a href="chm_sens_test.html#cb256-2" tabindex="-1"></a><span class="fu">plt_form_quantification_dist</span>(</span>
<span id="cb256-3"><a href="chm_sens_test.html#cb256-3" tabindex="-1"></a>  <span class="at">df =</span> param_combos_ranked <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(is_top_overall) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">!</span>tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;_pct_rank_&quot;</span>))</span>
<span id="cb256-4"><a href="chm_sens_test.html#cb256-4" tabindex="-1"></a>  , <span class="fu">paste0</span>(</span>
<span id="cb256-5"><a href="chm_sens_test.html#cb256-5" tabindex="-1"></a>    <span class="st">&quot;Structural Data Only&quot;</span></span>
<span id="cb256-6"><a href="chm_sens_test.html#cb256-6" tabindex="-1"></a>    , <span class="st">&quot;</span><span class="sc">\n</span><span class="st">distribution of pile form quantification metrics for the top &quot;</span></span>
<span id="cb256-7"><a href="chm_sens_test.html#cb256-7" tabindex="-1"></a>    , scales<span class="sc">::</span><span class="fu">percent</span>(pct_th_top,<span class="at">accuracy=</span><span class="fl">0.1</span>)</span>
<span id="cb256-8"><a href="chm_sens_test.html#cb256-8" tabindex="-1"></a>    , <span class="st">&quot; (n=&quot;</span></span>
<span id="cb256-9"><a href="chm_sens_test.html#cb256-9" tabindex="-1"></a>    , scales<span class="sc">::</span><span class="fu">comma</span>(n_combos_top_overall, <span class="at">accuracy =</span> <span class="dv">1</span>)</span>
<span id="cb256-10"><a href="chm_sens_test.html#cb256-10" tabindex="-1"></a>    , <span class="st">&quot;) &quot;</span></span>
<span id="cb256-11"><a href="chm_sens_test.html#cb256-11" tabindex="-1"></a>    , <span class="st">&quot;overall parameter combinations tested</span><span class="sc">\n</span><span class="st">based on both detection and quantification accuracy&quot;</span></span>
<span id="cb256-12"><a href="chm_sens_test.html#cb256-12" tabindex="-1"></a>  )</span>
<span id="cb256-13"><a href="chm_sens_test.html#cb256-13" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-226-1.png" width="1008" /></p>
<p>These results are just as promising as the detection accuracy results and indicate that when given structural data only (i.e. CHM data but no spectral data) the methodology can accurately quantify slash pile height and diameter with sub-meter (i.e. &lt; 1m) accuracy when compared with field-measured values. Over the range of parameter settings tested, the methodology also performs well at determining the pile footprint when compared with the image-annotated perimeters as indicated by the error in pile area.</p>
</div>
<div id="top-12-settings" class="section level5 hasAnchor" number="8.5.3.1.2">
<h5><span class="header-section-number">8.5.3.1.2</span> Top 12 settings<a href="chm_sens_test.html#top-12-settings" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>Let’s focus on the top 12 parameter settings tested to highlight the pile detection and form quantification accuracies achieved by these settings</p>
<div class="sourceCode" id="cb257"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb257-1"><a href="chm_sens_test.html#cb257-1" tabindex="-1"></a><span class="co"># pal_temp %&gt;% scales::show_col()</span></span>
<span id="cb257-2"><a href="chm_sens_test.html#cb257-2" tabindex="-1"></a><span class="co"># filter and reshape</span></span>
<span id="cb257-3"><a href="chm_sens_test.html#cb257-3" tabindex="-1"></a>param_combos_ranked <span class="sc">%&gt;%</span> </span>
<span id="cb257-4"><a href="chm_sens_test.html#cb257-4" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(is_final_selection) <span class="sc">%&gt;%</span> </span>
<span id="cb257-5"><a href="chm_sens_test.html#cb257-5" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">!</span>tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;_pct_rank_&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb257-6"><a href="chm_sens_test.html#cb257-6" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb257-7"><a href="chm_sens_test.html#cb257-7" tabindex="-1"></a>    max_ht_m,max_area_m2,convexity_pct,circle_fit_iou_pct,chm_res_m</span>
<span id="cb257-8"><a href="chm_sens_test.html#cb257-8" tabindex="-1"></a>    , ovrall_lab</span>
<span id="cb257-9"><a href="chm_sens_test.html#cb257-9" tabindex="-1"></a>    <span class="co"># detection</span></span>
<span id="cb257-10"><a href="chm_sens_test.html#cb257-10" tabindex="-1"></a>    , f_score, recall, precision</span>
<span id="cb257-11"><a href="chm_sens_test.html#cb257-11" tabindex="-1"></a>    <span class="co"># quantification</span></span>
<span id="cb257-12"><a href="chm_sens_test.html#cb257-12" tabindex="-1"></a>    , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_rmse&quot;</span>)</span>
<span id="cb257-13"><a href="chm_sens_test.html#cb257-13" tabindex="-1"></a>    , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_rrmse&quot;</span>)</span>
<span id="cb257-14"><a href="chm_sens_test.html#cb257-14" tabindex="-1"></a>    , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_mean&quot;</span>)</span>
<span id="cb257-15"><a href="chm_sens_test.html#cb257-15" tabindex="-1"></a>    , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_mape&quot;</span>)</span>
<span id="cb257-16"><a href="chm_sens_test.html#cb257-16" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb257-17"><a href="chm_sens_test.html#cb257-17" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(</span>
<span id="cb257-18"><a href="chm_sens_test.html#cb257-18" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">c</span>(</span>
<span id="cb257-19"><a href="chm_sens_test.html#cb257-19" tabindex="-1"></a>      f_score, recall, precision</span>
<span id="cb257-20"><a href="chm_sens_test.html#cb257-20" tabindex="-1"></a>      , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_rmse&quot;</span>)</span>
<span id="cb257-21"><a href="chm_sens_test.html#cb257-21" tabindex="-1"></a>      , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_rrmse&quot;</span>)</span>
<span id="cb257-22"><a href="chm_sens_test.html#cb257-22" tabindex="-1"></a>      , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_mean&quot;</span>)</span>
<span id="cb257-23"><a href="chm_sens_test.html#cb257-23" tabindex="-1"></a>      , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_mape&quot;</span>)</span>
<span id="cb257-24"><a href="chm_sens_test.html#cb257-24" tabindex="-1"></a>    )</span>
<span id="cb257-25"><a href="chm_sens_test.html#cb257-25" tabindex="-1"></a>    , <span class="at">names_to =</span> <span class="st">&quot;metric&quot;</span></span>
<span id="cb257-26"><a href="chm_sens_test.html#cb257-26" tabindex="-1"></a>    , <span class="at">values_to =</span> <span class="st">&quot;value&quot;</span></span>
<span id="cb257-27"><a href="chm_sens_test.html#cb257-27" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb257-28"><a href="chm_sens_test.html#cb257-28" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb257-29"><a href="chm_sens_test.html#cb257-29" tabindex="-1"></a>    <span class="at">eval_metric =</span> stringr<span class="sc">::</span><span class="fu">str_extract</span>(metric, <span class="st">&quot;(_rmse|_rrmse|_mean|_mape|f_score|recall|precision)$&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb257-30"><a href="chm_sens_test.html#cb257-30" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_remove_all</span>(<span class="st">&quot;_&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb257-31"><a href="chm_sens_test.html#cb257-31" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_replace_all</span>(<span class="st">&quot;mean&quot;</span>,<span class="st">&quot;me&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb257-32"><a href="chm_sens_test.html#cb257-32" tabindex="-1"></a>      <span class="fu">toupper</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb257-33"><a href="chm_sens_test.html#cb257-33" tabindex="-1"></a>      <span class="fu">factor</span>(</span>
<span id="cb257-34"><a href="chm_sens_test.html#cb257-34" tabindex="-1"></a>        <span class="at">ordered =</span> T</span>
<span id="cb257-35"><a href="chm_sens_test.html#cb257-35" tabindex="-1"></a>        , <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;FSCORE&quot;</span>,<span class="st">&quot;RECALL&quot;</span>,<span class="st">&quot;PRECISION&quot;</span>, <span class="st">&quot;ME&quot;</span>,<span class="st">&quot;RMSE&quot;</span>,<span class="st">&quot;RRMSE&quot;</span>,<span class="st">&quot;MAPE&quot;</span>)</span>
<span id="cb257-36"><a href="chm_sens_test.html#cb257-36" tabindex="-1"></a>        , <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;F-score&quot;</span>,<span class="st">&quot;Recall&quot;</span>,<span class="st">&quot;Precision&quot;</span>, <span class="st">&quot;ME&quot;</span>,<span class="st">&quot;RMSE&quot;</span>,<span class="st">&quot;RRMSE&quot;</span>,<span class="st">&quot;MAPE&quot;</span>)</span>
<span id="cb257-37"><a href="chm_sens_test.html#cb257-37" tabindex="-1"></a>      )</span>
<span id="cb257-38"><a href="chm_sens_test.html#cb257-38" tabindex="-1"></a>    , <span class="at">pile_metric =</span> metric <span class="sc">%&gt;%</span> </span>
<span id="cb257-39"><a href="chm_sens_test.html#cb257-39" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_remove</span>(<span class="st">&quot;(_rmse|_rrmse|_mean|_mape)$&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb257-40"><a href="chm_sens_test.html#cb257-40" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_extract</span>(<span class="st">&quot;(paraboloid_volume|volume|area|height|diameter)&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb257-41"><a href="chm_sens_test.html#cb257-41" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">coalesce</span>(<span class="st">&quot;detection&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb257-42"><a href="chm_sens_test.html#cb257-42" tabindex="-1"></a>      <span class="fu">factor</span>(</span>
<span id="cb257-43"><a href="chm_sens_test.html#cb257-43" tabindex="-1"></a>        <span class="at">ordered =</span> T</span>
<span id="cb257-44"><a href="chm_sens_test.html#cb257-44" tabindex="-1"></a>        , <span class="at">levels =</span> <span class="fu">c</span>(</span>
<span id="cb257-45"><a href="chm_sens_test.html#cb257-45" tabindex="-1"></a>          <span class="st">&quot;detection&quot;</span></span>
<span id="cb257-46"><a href="chm_sens_test.html#cb257-46" tabindex="-1"></a>          , <span class="st">&quot;volume&quot;</span></span>
<span id="cb257-47"><a href="chm_sens_test.html#cb257-47" tabindex="-1"></a>          , <span class="st">&quot;paraboloid_volume&quot;</span></span>
<span id="cb257-48"><a href="chm_sens_test.html#cb257-48" tabindex="-1"></a>          , <span class="st">&quot;area&quot;</span></span>
<span id="cb257-49"><a href="chm_sens_test.html#cb257-49" tabindex="-1"></a>          , <span class="st">&quot;height&quot;</span></span>
<span id="cb257-50"><a href="chm_sens_test.html#cb257-50" tabindex="-1"></a>          , <span class="st">&quot;diameter&quot;</span></span>
<span id="cb257-51"><a href="chm_sens_test.html#cb257-51" tabindex="-1"></a>        )</span>
<span id="cb257-52"><a href="chm_sens_test.html#cb257-52" tabindex="-1"></a>        , <span class="at">labels =</span> <span class="fu">c</span>(</span>
<span id="cb257-53"><a href="chm_sens_test.html#cb257-53" tabindex="-1"></a>          <span class="st">&quot;Detection&quot;</span></span>
<span id="cb257-54"><a href="chm_sens_test.html#cb257-54" tabindex="-1"></a>          , <span class="st">&quot;Volume&quot;</span></span>
<span id="cb257-55"><a href="chm_sens_test.html#cb257-55" tabindex="-1"></a>          , <span class="st">&quot;Volume paraboloid&quot;</span></span>
<span id="cb257-56"><a href="chm_sens_test.html#cb257-56" tabindex="-1"></a>          , <span class="st">&quot;Area (m2)&quot;</span></span>
<span id="cb257-57"><a href="chm_sens_test.html#cb257-57" tabindex="-1"></a>          , <span class="st">&quot;Height (m)&quot;</span></span>
<span id="cb257-58"><a href="chm_sens_test.html#cb257-58" tabindex="-1"></a>          , <span class="st">&quot;Diameter (m)&quot;</span></span>
<span id="cb257-59"><a href="chm_sens_test.html#cb257-59" tabindex="-1"></a>        )</span>
<span id="cb257-60"><a href="chm_sens_test.html#cb257-60" tabindex="-1"></a>      )</span>
<span id="cb257-61"><a href="chm_sens_test.html#cb257-61" tabindex="-1"></a>    , <span class="at">value_lab =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb257-62"><a href="chm_sens_test.html#cb257-62" tabindex="-1"></a>        eval_metric <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;F-score&quot;</span>,<span class="st">&quot;Recall&quot;</span>,<span class="st">&quot;Precision&quot;</span>, <span class="st">&quot;RRMSE&quot;</span>, <span class="st">&quot;MAPE&quot;</span>) <span class="sc">~</span> scales<span class="sc">::</span><span class="fu">percent</span>(value,<span class="at">accuracy=</span><span class="fl">0.1</span>)</span>
<span id="cb257-63"><a href="chm_sens_test.html#cb257-63" tabindex="-1"></a>        , eval_metric <span class="sc">==</span> <span class="st">&quot;ME&quot;</span> <span class="sc">~</span> scales<span class="sc">::</span><span class="fu">comma</span>(value,<span class="at">accuracy=</span><span class="fl">0.01</span>)</span>
<span id="cb257-64"><a href="chm_sens_test.html#cb257-64" tabindex="-1"></a>        , T <span class="sc">~</span> scales<span class="sc">::</span><span class="fu">comma</span>(value,<span class="at">accuracy=</span><span class="fl">0.1</span>)</span>
<span id="cb257-65"><a href="chm_sens_test.html#cb257-65" tabindex="-1"></a>      )</span>
<span id="cb257-66"><a href="chm_sens_test.html#cb257-66" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb257-67"><a href="chm_sens_test.html#cb257-67" tabindex="-1"></a>  <span class="co"># make var for color</span></span>
<span id="cb257-68"><a href="chm_sens_test.html#cb257-68" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(pile_metric, eval_metric) <span class="sc">%&gt;%</span> </span>
<span id="cb257-69"><a href="chm_sens_test.html#cb257-69" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb257-70"><a href="chm_sens_test.html#cb257-70" tabindex="-1"></a>    <span class="co"># for ME, color by abs...for f-score,recall,precision color by -value so that higher means better...</span></span>
<span id="cb257-71"><a href="chm_sens_test.html#cb257-71" tabindex="-1"></a>      <span class="co"># ...since higher means worse for quantification accuracy metrics</span></span>
<span id="cb257-72"><a href="chm_sens_test.html#cb257-72" tabindex="-1"></a>    <span class="at">value_dir =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb257-73"><a href="chm_sens_test.html#cb257-73" tabindex="-1"></a>      eval_metric <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;ME&quot;</span>) <span class="sc">~</span> <span class="fu">abs</span>(value)</span>
<span id="cb257-74"><a href="chm_sens_test.html#cb257-74" tabindex="-1"></a>      , eval_metric <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;F-score&quot;</span>,<span class="st">&quot;Recall&quot;</span>,<span class="st">&quot;Precision&quot;</span>) <span class="sc">~</span> <span class="sc">-</span>value</span>
<span id="cb257-75"><a href="chm_sens_test.html#cb257-75" tabindex="-1"></a>      , T <span class="sc">~</span> value</span>
<span id="cb257-76"><a href="chm_sens_test.html#cb257-76" tabindex="-1"></a>    )</span>
<span id="cb257-77"><a href="chm_sens_test.html#cb257-77" tabindex="-1"></a>    , <span class="at">value_z =</span> (value_dir<span class="sc">-</span><span class="fu">mean</span>(value_dir,<span class="at">na.rm=</span>T))<span class="sc">/</span><span class="fu">sd</span>(value_dir,<span class="at">na.rm=</span>T) <span class="co"># this is the key to the different colors within facets</span></span>
<span id="cb257-78"><a href="chm_sens_test.html#cb257-78" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb257-79"><a href="chm_sens_test.html#cb257-79" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb257-80"><a href="chm_sens_test.html#cb257-80" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span>eval_metric <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;RRMSE&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb257-81"><a href="chm_sens_test.html#cb257-81" tabindex="-1"></a>  <span class="co"># View()</span></span>
<span id="cb257-82"><a href="chm_sens_test.html#cb257-82" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> eval_metric, <span class="at">y =</span> ovrall_lab)) <span class="sc">+</span> </span>
<span id="cb257-83"><a href="chm_sens_test.html#cb257-83" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_tile</span>(</span>
<span id="cb257-84"><a href="chm_sens_test.html#cb257-84" tabindex="-1"></a>    <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">fill =</span> pile_metric, <span class="at">alpha =</span> <span class="sc">-</span>value_z)</span>
<span id="cb257-85"><a href="chm_sens_test.html#cb257-85" tabindex="-1"></a>    , <span class="at">color =</span> <span class="st">&quot;gray&quot;</span></span>
<span id="cb257-86"><a href="chm_sens_test.html#cb257-86" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb257-87"><a href="chm_sens_test.html#cb257-87" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_text</span>(</span>
<span id="cb257-88"><a href="chm_sens_test.html#cb257-88" tabindex="-1"></a>    <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">label =</span> value_lab, <span class="at">fontface =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb257-89"><a href="chm_sens_test.html#cb257-89" tabindex="-1"></a>    , <span class="at">color =</span> <span class="st">&quot;white&quot;</span></span>
<span id="cb257-90"><a href="chm_sens_test.html#cb257-90" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb257-91"><a href="chm_sens_test.html#cb257-91" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">facet_grid</span>(<span class="at">cols =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(pile_metric), <span class="at">scales =</span> <span class="st">&quot;free_x&quot;</span>) <span class="sc">+</span> </span>
<span id="cb257-92"><a href="chm_sens_test.html#cb257-92" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_x_discrete</span>(<span class="at">position =</span> <span class="st">&quot;top&quot;</span>) <span class="sc">+</span></span>
<span id="cb257-93"><a href="chm_sens_test.html#cb257-93" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;gray33&quot;</span>, harrypotter<span class="sc">::</span><span class="fu">hp</span>(<span class="at">n=</span><span class="dv">3</span>,<span class="at">option =</span> <span class="st">&quot;hermionegranger&quot;</span>) )) <span class="sc">+</span></span>
<span id="cb257-94"><a href="chm_sens_test.html#cb257-94" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_alpha_binned</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="fl">0.55</span>, <span class="dv">1</span>)) <span class="sc">+</span> <span class="co"># this is the key to the different colors within facets</span></span>
<span id="cb257-95"><a href="chm_sens_test.html#cb257-95" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb257-96"><a href="chm_sens_test.html#cb257-96" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb257-97"><a href="chm_sens_test.html#cb257-97" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;&quot;</span></span>
<span id="cb257-98"><a href="chm_sens_test.html#cb257-98" tabindex="-1"></a>    , <span class="at">y =</span> <span class="st">&quot;max_ht_m : max_area_m2 : convexity_pct : circle_fit_iou_pct : chm_res_m&quot;</span></span>
<span id="cb257-99"><a href="chm_sens_test.html#cb257-99" tabindex="-1"></a>    , <span class="at">subtitle =</span> <span class="fu">paste0</span>(</span>
<span id="cb257-100"><a href="chm_sens_test.html#cb257-100" tabindex="-1"></a>       <span class="st">&quot;Structural Data Only&quot;</span></span>
<span id="cb257-101"><a href="chm_sens_test.html#cb257-101" tabindex="-1"></a>       , <span class="st">&quot;</span><span class="sc">\n</span><span class="st">pile detection and form quantification accuracy metrics for the top parameter settings tested&quot;</span></span>
<span id="cb257-102"><a href="chm_sens_test.html#cb257-102" tabindex="-1"></a>       <span class="co"># , scales::percent(1-pct_rank_th_top,accuracy=1)</span></span>
<span id="cb257-103"><a href="chm_sens_test.html#cb257-103" tabindex="-1"></a>       , <span class="st">&quot; (n=&quot;</span></span>
<span id="cb257-104"><a href="chm_sens_test.html#cb257-104" tabindex="-1"></a>       , scales<span class="sc">::</span><span class="fu">comma</span>(n_th_top,<span class="at">accuracy=</span><span class="dv">1</span>)</span>
<span id="cb257-105"><a href="chm_sens_test.html#cb257-105" tabindex="-1"></a>       , <span class="st">&quot;) &quot;</span></span>
<span id="cb257-106"><a href="chm_sens_test.html#cb257-106" tabindex="-1"></a>       , <span class="st">&quot;</span><span class="sc">\n</span><span class="st">based on both detection and quantification accuracy&quot;</span></span>
<span id="cb257-107"><a href="chm_sens_test.html#cb257-107" tabindex="-1"></a>      )</span>
<span id="cb257-108"><a href="chm_sens_test.html#cb257-108" tabindex="-1"></a>    , <span class="at">caption =</span> <span class="st">&quot;*darker colors indicate relatively higher accuracy values&quot;</span></span>
<span id="cb257-109"><a href="chm_sens_test.html#cb257-109" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb257-110"><a href="chm_sens_test.html#cb257-110" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb257-111"><a href="chm_sens_test.html#cb257-111" tabindex="-1"></a>    </span>
<span id="cb257-112"><a href="chm_sens_test.html#cb257-112" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb257-113"><a href="chm_sens_test.html#cb257-113" tabindex="-1"></a>    , <span class="at">panel.grid =</span> ggplot2<span class="sc">::</span><span class="fu">element_blank</span>()</span>
<span id="cb257-114"><a href="chm_sens_test.html#cb257-114" tabindex="-1"></a>    , <span class="at">strip.placement =</span> <span class="st">&quot;outside&quot;</span></span>
<span id="cb257-115"><a href="chm_sens_test.html#cb257-115" tabindex="-1"></a>    , <span class="at">strip.text.x =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb257-116"><a href="chm_sens_test.html#cb257-116" tabindex="-1"></a>    , <span class="at">axis.text.x =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">7</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb257-117"><a href="chm_sens_test.html#cb257-117" tabindex="-1"></a>    , <span class="at">axis.title.x =</span> ggplot2<span class="sc">::</span><span class="fu">element_blank</span>()</span>
<span id="cb257-118"><a href="chm_sens_test.html#cb257-118" tabindex="-1"></a>    , <span class="at">plot.subtitle =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>)</span>
<span id="cb257-119"><a href="chm_sens_test.html#cb257-119" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-227-1.png" width="1008" /></p>
<p>this plot allows for a simultaneous comparison of all metrics for pile detection and pile form quantification. it includes only the parameter combinations that achieved the best balanced accuracy, helping users identify the optimal settings by evaluating the trade-offs between detection and form quantification.</p>
<p>let’s table this</p>
<div class="sourceCode" id="cb258"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb258-1"><a href="chm_sens_test.html#cb258-1" tabindex="-1"></a>param_combos_ranked <span class="sc">%&gt;%</span> </span>
<span id="cb258-2"><a href="chm_sens_test.html#cb258-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(is_final_selection) <span class="sc">%&gt;%</span> </span>
<span id="cb258-3"><a href="chm_sens_test.html#cb258-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">!</span>tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;_pct_rank_&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb258-4"><a href="chm_sens_test.html#cb258-4" tabindex="-1"></a>  <span class="co"># first select to arrange eval_metric</span></span>
<span id="cb258-5"><a href="chm_sens_test.html#cb258-5" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb258-6"><a href="chm_sens_test.html#cb258-6" tabindex="-1"></a>    ovrall_lab</span>
<span id="cb258-7"><a href="chm_sens_test.html#cb258-7" tabindex="-1"></a>    , max_ht_m,max_area_m2,convexity_pct,circle_fit_iou_pct,chm_res_m</span>
<span id="cb258-8"><a href="chm_sens_test.html#cb258-8" tabindex="-1"></a>    <span class="co"># detection</span></span>
<span id="cb258-9"><a href="chm_sens_test.html#cb258-9" tabindex="-1"></a>    , f_score, recall, precision</span>
<span id="cb258-10"><a href="chm_sens_test.html#cb258-10" tabindex="-1"></a>    <span class="co"># quantification</span></span>
<span id="cb258-11"><a href="chm_sens_test.html#cb258-11" tabindex="-1"></a>    , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_mean&quot;</span>)</span>
<span id="cb258-12"><a href="chm_sens_test.html#cb258-12" tabindex="-1"></a>    , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_rmse&quot;</span>)</span>
<span id="cb258-13"><a href="chm_sens_test.html#cb258-13" tabindex="-1"></a>    <span class="co"># , tidyselect::ends_with(&quot;_rrmse&quot;)</span></span>
<span id="cb258-14"><a href="chm_sens_test.html#cb258-14" tabindex="-1"></a>    , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_mape&quot;</span>)</span>
<span id="cb258-15"><a href="chm_sens_test.html#cb258-15" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb258-16"><a href="chm_sens_test.html#cb258-16" tabindex="-1"></a>  <span class="co"># second select to arrange pile_metric</span></span>
<span id="cb258-17"><a href="chm_sens_test.html#cb258-17" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb258-18"><a href="chm_sens_test.html#cb258-18" tabindex="-1"></a>    ovrall_lab</span>
<span id="cb258-19"><a href="chm_sens_test.html#cb258-19" tabindex="-1"></a>    , max_ht_m,max_area_m2,convexity_pct,circle_fit_iou_pct,chm_res_m</span>
<span id="cb258-20"><a href="chm_sens_test.html#cb258-20" tabindex="-1"></a>    <span class="co"># detection</span></span>
<span id="cb258-21"><a href="chm_sens_test.html#cb258-21" tabindex="-1"></a>    , f_score, recall, precision</span>
<span id="cb258-22"><a href="chm_sens_test.html#cb258-22" tabindex="-1"></a>    <span class="co"># quantification</span></span>
<span id="cb258-23"><a href="chm_sens_test.html#cb258-23" tabindex="-1"></a>    , <span class="fu">c</span>(tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;volume&quot;</span>) <span class="sc">&amp;</span> <span class="sc">!</span>tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;paraboloid&quot;</span>))</span>
<span id="cb258-24"><a href="chm_sens_test.html#cb258-24" tabindex="-1"></a>    , tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;area&quot;</span>)</span>
<span id="cb258-25"><a href="chm_sens_test.html#cb258-25" tabindex="-1"></a>    , tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;height&quot;</span>)</span>
<span id="cb258-26"><a href="chm_sens_test.html#cb258-26" tabindex="-1"></a>    , tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;diameter&quot;</span>)</span>
<span id="cb258-27"><a href="chm_sens_test.html#cb258-27" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb258-28"><a href="chm_sens_test.html#cb258-28" tabindex="-1"></a>  <span class="co"># names()</span></span>
<span id="cb258-29"><a href="chm_sens_test.html#cb258-29" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb258-30"><a href="chm_sens_test.html#cb258-30" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">across</span>(</span>
<span id="cb258-31"><a href="chm_sens_test.html#cb258-31" tabindex="-1"></a>      <span class="at">.cols =</span> <span class="fu">c</span>(f_score, recall, precision, tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_mape&quot;</span>))</span>
<span id="cb258-32"><a href="chm_sens_test.html#cb258-32" tabindex="-1"></a>      , <span class="at">.fn =</span> <span class="sc">~</span> scales<span class="sc">::</span><span class="fu">percent</span>(.x, <span class="at">accuracy =</span> <span class="dv">1</span>)</span>
<span id="cb258-33"><a href="chm_sens_test.html#cb258-33" tabindex="-1"></a>    )</span>
<span id="cb258-34"><a href="chm_sens_test.html#cb258-34" tabindex="-1"></a>    , dplyr<span class="sc">::</span><span class="fu">across</span>(</span>
<span id="cb258-35"><a href="chm_sens_test.html#cb258-35" tabindex="-1"></a>      <span class="at">.cols =</span> <span class="fu">c</span>(tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_mean&quot;</span>))</span>
<span id="cb258-36"><a href="chm_sens_test.html#cb258-36" tabindex="-1"></a>      , <span class="at">.fn =</span> <span class="sc">~</span> scales<span class="sc">::</span><span class="fu">comma</span>(.x, <span class="at">accuracy =</span> <span class="fl">0.01</span>)</span>
<span id="cb258-37"><a href="chm_sens_test.html#cb258-37" tabindex="-1"></a>    )</span>
<span id="cb258-38"><a href="chm_sens_test.html#cb258-38" tabindex="-1"></a>    , dplyr<span class="sc">::</span><span class="fu">across</span>(</span>
<span id="cb258-39"><a href="chm_sens_test.html#cb258-39" tabindex="-1"></a>      <span class="at">.cols =</span> <span class="fu">c</span>(tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_rmse&quot;</span>))</span>
<span id="cb258-40"><a href="chm_sens_test.html#cb258-40" tabindex="-1"></a>      , <span class="at">.fn =</span> <span class="sc">~</span> scales<span class="sc">::</span><span class="fu">comma</span>(.x, <span class="at">accuracy =</span> <span class="fl">0.1</span>)</span>
<span id="cb258-41"><a href="chm_sens_test.html#cb258-41" tabindex="-1"></a>    )</span>
<span id="cb258-42"><a href="chm_sens_test.html#cb258-42" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb258-43"><a href="chm_sens_test.html#cb258-43" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">blank=</span> <span class="st">&quot;   &quot;</span> ) <span class="sc">%&gt;%</span> </span>
<span id="cb258-44"><a href="chm_sens_test.html#cb258-44" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">relocate</span>(blank, <span class="at">.before =</span> f_score) <span class="sc">%&gt;%</span> </span>
<span id="cb258-45"><a href="chm_sens_test.html#cb258-45" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(<span class="fu">desc</span>(ovrall_lab)) <span class="sc">%&gt;%</span> </span>
<span id="cb258-46"><a href="chm_sens_test.html#cb258-46" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kbl</span>(</span>
<span id="cb258-47"><a href="chm_sens_test.html#cb258-47" tabindex="-1"></a>    <span class="at">caption =</span> </span>
<span id="cb258-48"><a href="chm_sens_test.html#cb258-48" tabindex="-1"></a>      <span class="fu">paste0</span>(</span>
<span id="cb258-49"><a href="chm_sens_test.html#cb258-49" tabindex="-1"></a>       <span class="st">&quot;Structural Data Only&quot;</span></span>
<span id="cb258-50"><a href="chm_sens_test.html#cb258-50" tabindex="-1"></a>       , <span class="st">&quot;&lt;br&gt;pile detection and form quantification accuracy metrics for the top parameter settings tested&quot;</span></span>
<span id="cb258-51"><a href="chm_sens_test.html#cb258-51" tabindex="-1"></a>       <span class="co"># , scales::percent(1-pct_rank_th_top,accuracy=1)</span></span>
<span id="cb258-52"><a href="chm_sens_test.html#cb258-52" tabindex="-1"></a>       , <span class="st">&quot; (n=&quot;</span></span>
<span id="cb258-53"><a href="chm_sens_test.html#cb258-53" tabindex="-1"></a>       , scales<span class="sc">::</span><span class="fu">comma</span>(n_th_top,<span class="at">accuracy=</span><span class="dv">1</span>)</span>
<span id="cb258-54"><a href="chm_sens_test.html#cb258-54" tabindex="-1"></a>       , <span class="st">&quot;) &quot;</span></span>
<span id="cb258-55"><a href="chm_sens_test.html#cb258-55" tabindex="-1"></a>       , <span class="st">&quot;&lt;br&gt;based on both detection and quantification accuracy&quot;</span></span>
<span id="cb258-56"><a href="chm_sens_test.html#cb258-56" tabindex="-1"></a>      )</span>
<span id="cb258-57"><a href="chm_sens_test.html#cb258-57" tabindex="-1"></a>    , <span class="at">col.names =</span> <span class="fu">c</span>(</span>
<span id="cb258-58"><a href="chm_sens_test.html#cb258-58" tabindex="-1"></a>      <span class="st">&quot;&quot;</span></span>
<span id="cb258-59"><a href="chm_sens_test.html#cb258-59" tabindex="-1"></a>      ,<span class="st">&quot;max_ht_m&quot;</span>,<span class="st">&quot;max_area_m2&quot;</span>,<span class="st">&quot;convexity_pct&quot;</span>,<span class="st">&quot;circle_fit_iou_pct&quot;</span>,<span class="st">&quot;chm_res_m&quot;</span></span>
<span id="cb258-60"><a href="chm_sens_test.html#cb258-60" tabindex="-1"></a>      , <span class="st">&quot;   &quot;</span></span>
<span id="cb258-61"><a href="chm_sens_test.html#cb258-61" tabindex="-1"></a>      , <span class="st">&quot;F-score&quot;</span>, <span class="st">&quot;Recall&quot;</span>, <span class="st">&quot;Precision&quot;</span></span>
<span id="cb258-62"><a href="chm_sens_test.html#cb258-62" tabindex="-1"></a>      , <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;ME&quot;</span>,<span class="st">&quot;RMSE&quot;</span>,<span class="st">&quot;MAPE&quot;</span>), <span class="at">times =</span> <span class="dv">3</span>)</span>
<span id="cb258-63"><a href="chm_sens_test.html#cb258-63" tabindex="-1"></a>    )</span>
<span id="cb258-64"><a href="chm_sens_test.html#cb258-64" tabindex="-1"></a>    , <span class="at">escape =</span> F</span>
<span id="cb258-65"><a href="chm_sens_test.html#cb258-65" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb258-66"><a href="chm_sens_test.html#cb258-66" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kable_styling</span>(<span class="at">font_size =</span> <span class="dv">11</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb258-67"><a href="chm_sens_test.html#cb258-67" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">add_header_above</span>(<span class="fu">c</span>(</span>
<span id="cb258-68"><a href="chm_sens_test.html#cb258-68" tabindex="-1"></a>    <span class="st">&quot; &quot;</span><span class="ot">=</span><span class="dv">7</span></span>
<span id="cb258-69"><a href="chm_sens_test.html#cb258-69" tabindex="-1"></a>    , <span class="st">&quot;Detection&quot;</span> <span class="ot">=</span> <span class="dv">3</span></span>
<span id="cb258-70"><a href="chm_sens_test.html#cb258-70" tabindex="-1"></a>    , <span class="st">&quot;Area&quot;</span> <span class="ot">=</span> <span class="dv">3</span></span>
<span id="cb258-71"><a href="chm_sens_test.html#cb258-71" tabindex="-1"></a>    , <span class="st">&quot;Height&quot;</span> <span class="ot">=</span> <span class="dv">3</span></span>
<span id="cb258-72"><a href="chm_sens_test.html#cb258-72" tabindex="-1"></a>    , <span class="st">&quot;Diameter&quot;</span> <span class="ot">=</span> <span class="dv">3</span></span>
<span id="cb258-73"><a href="chm_sens_test.html#cb258-73" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb258-74"><a href="chm_sens_test.html#cb258-74" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">column_spec</span>(<span class="fu">seq</span>(<span class="dv">7</span>,<span class="dv">19</span>,<span class="at">by=</span><span class="dv">3</span>), <span class="at">border_right =</span> <span class="cn">TRUE</span>, <span class="at">include_thead =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb258-75"><a href="chm_sens_test.html#cb258-75" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">column_spec</span>(</span>
<span id="cb258-76"><a href="chm_sens_test.html#cb258-76" tabindex="-1"></a>    <span class="at">column =</span> <span class="dv">7</span><span class="sc">:</span><span class="dv">19</span></span>
<span id="cb258-77"><a href="chm_sens_test.html#cb258-77" tabindex="-1"></a>    , <span class="at">extra_css =</span> <span class="st">&quot;font-size: 10px;&quot;</span></span>
<span id="cb258-78"><a href="chm_sens_test.html#cb258-78" tabindex="-1"></a>    , <span class="at">include_thead =</span> T</span>
<span id="cb258-79"><a href="chm_sens_test.html#cb258-79" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb258-80"><a href="chm_sens_test.html#cb258-80" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">scroll_box</span>(<span class="at">width =</span> <span class="st">&quot;740px&quot;</span>) </span></code></pre></div>
<div style="border: 1px solid #ddd; padding: 5px; overflow-x: scroll; width:740px; ">
<table class="table" style="font-size: 11px; margin-left: auto; margin-right: auto;">
<caption style="font-size: initial !important;">
<span id="tab:unnamed-chunk-228">Table 8.1: </span>Structural Data Only<br>pile detection and form quantification accuracy metrics for the top parameter settings tested (n=12) <br>based on both detection and quantification accuracy
</caption>
<thead>
<tr>
<th style="empty-cells: hide;border-bottom:hidden;" colspan="7">
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="3">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Detection
</div>
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="3">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Area
</div>
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="3">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Height
</div>
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="3">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Diameter
</div>
</th>
</tr>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
max_ht_m
</th>
<th style="text-align:right;">
max_area_m2
</th>
<th style="text-align:right;">
convexity_pct
</th>
<th style="text-align:right;">
circle_fit_iou_pct
</th>
<th style="text-align:right;">
chm_res_m
</th>
<th style="text-align:left;border-right:1px solid;font-size: 10px;">
</th>
<th style="text-align:left;font-size: 10px;">
F-score
</th>
<th style="text-align:left;font-size: 10px;">
Recall
</th>
<th style="text-align:left;border-right:1px solid;font-size: 10px;">
Precision
</th>
<th style="text-align:left;font-size: 10px;">
ME
</th>
<th style="text-align:left;font-size: 10px;">
RMSE
</th>
<th style="text-align:left;border-right:1px solid;font-size: 10px;">
MAPE
</th>
<th style="text-align:left;font-size: 10px;">
ME
</th>
<th style="text-align:left;font-size: 10px;">
RMSE
</th>
<th style="text-align:left;border-right:1px solid;font-size: 10px;">
MAPE
</th>
<th style="text-align:left;font-size: 10px;">
ME
</th>
<th style="text-align:left;font-size: 10px;">
RMSE
</th>
<th style="text-align:left;border-right:1px solid;font-size: 10px;">
MAPE
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
2:10:0.8:0.05:0.1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
0.80
</td>
<td style="text-align:right;">
0.05
</td>
<td style="text-align:right;">
0.1
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
79%
</td>
<td style="text-align:left;font-size: 10px;">
78%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
80%
</td>
<td style="text-align:left;font-size: 10px;">
-0.50
</td>
<td style="text-align:left;font-size: 10px;">
1.0
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
11%
</td>
<td style="text-align:left;font-size: 10px;">
-0.20
</td>
<td style="text-align:left;font-size: 10px;">
0.3
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
13%
</td>
<td style="text-align:left;font-size: 10px;">
0.17
</td>
<td style="text-align:left;font-size: 10px;">
0.4
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
10%
</td>
</tr>
<tr>
<td style="text-align:left;">
2:20:0.8:0.05:0.1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
20
</td>
<td style="text-align:right;">
0.80
</td>
<td style="text-align:right;">
0.05
</td>
<td style="text-align:right;">
0.1
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
81%
</td>
<td style="text-align:left;font-size: 10px;">
82%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
80%
</td>
<td style="text-align:left;font-size: 10px;">
-0.60
</td>
<td style="text-align:left;font-size: 10px;">
1.7
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
11%
</td>
<td style="text-align:left;font-size: 10px;">
-0.24
</td>
<td style="text-align:left;font-size: 10px;">
0.4
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
13%
</td>
<td style="text-align:left;font-size: 10px;">
0.18
</td>
<td style="text-align:left;font-size: 10px;">
0.5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
11%
</td>
</tr>
<tr>
<td style="text-align:left;">
2:60:0.8:0.05:0.1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
60
</td>
<td style="text-align:right;">
0.80
</td>
<td style="text-align:right;">
0.05
</td>
<td style="text-align:right;">
0.1
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
81%
</td>
<td style="text-align:left;font-size: 10px;">
83%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
80%
</td>
<td style="text-align:left;font-size: 10px;">
-0.64
</td>
<td style="text-align:left;font-size: 10px;">
1.7
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
11%
</td>
<td style="text-align:left;font-size: 10px;">
-0.27
</td>
<td style="text-align:left;font-size: 10px;">
0.5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
14%
</td>
<td style="text-align:left;font-size: 10px;">
0.18
</td>
<td style="text-align:left;font-size: 10px;">
0.5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
11%
</td>
</tr>
<tr>
<td style="text-align:left;">
2:50:0.8:0.05:0.1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
50
</td>
<td style="text-align:right;">
0.80
</td>
<td style="text-align:right;">
0.05
</td>
<td style="text-align:right;">
0.1
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
81%
</td>
<td style="text-align:left;font-size: 10px;">
83%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
80%
</td>
<td style="text-align:left;font-size: 10px;">
-0.64
</td>
<td style="text-align:left;font-size: 10px;">
1.7
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
11%
</td>
<td style="text-align:left;font-size: 10px;">
-0.27
</td>
<td style="text-align:left;font-size: 10px;">
0.5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
14%
</td>
<td style="text-align:left;font-size: 10px;">
0.18
</td>
<td style="text-align:left;font-size: 10px;">
0.5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
11%
</td>
</tr>
<tr>
<td style="text-align:left;">
2:40:0.8:0.05:0.1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
40
</td>
<td style="text-align:right;">
0.80
</td>
<td style="text-align:right;">
0.05
</td>
<td style="text-align:right;">
0.1
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
81%
</td>
<td style="text-align:left;font-size: 10px;">
83%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
80%
</td>
<td style="text-align:left;font-size: 10px;">
-0.64
</td>
<td style="text-align:left;font-size: 10px;">
1.7
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
11%
</td>
<td style="text-align:left;font-size: 10px;">
-0.27
</td>
<td style="text-align:left;font-size: 10px;">
0.5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
14%
</td>
<td style="text-align:left;font-size: 10px;">
0.18
</td>
<td style="text-align:left;font-size: 10px;">
0.5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
11%
</td>
</tr>
<tr>
<td style="text-align:left;">
2:30:0.8:0.05:0.1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
30
</td>
<td style="text-align:right;">
0.80
</td>
<td style="text-align:right;">
0.05
</td>
<td style="text-align:right;">
0.1
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
81%
</td>
<td style="text-align:left;font-size: 10px;">
83%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
80%
</td>
<td style="text-align:left;font-size: 10px;">
-0.64
</td>
<td style="text-align:left;font-size: 10px;">
1.7
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
11%
</td>
<td style="text-align:left;font-size: 10px;">
-0.27
</td>
<td style="text-align:left;font-size: 10px;">
0.5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
14%
</td>
<td style="text-align:left;font-size: 10px;">
0.18
</td>
<td style="text-align:left;font-size: 10px;">
0.5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
11%
</td>
</tr>
<tr>
<td style="text-align:left;">
2:20:0.8:0.2:0.1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
20
</td>
<td style="text-align:right;">
0.80
</td>
<td style="text-align:right;">
0.20
</td>
<td style="text-align:right;">
0.1
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
80%
</td>
<td style="text-align:left;font-size: 10px;">
79%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
80%
</td>
<td style="text-align:left;font-size: 10px;">
-0.61
</td>
<td style="text-align:left;font-size: 10px;">
1.7
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
11%
</td>
<td style="text-align:left;font-size: 10px;">
-0.25
</td>
<td style="text-align:left;font-size: 10px;">
0.5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
14%
</td>
<td style="text-align:left;font-size: 10px;">
0.18
</td>
<td style="text-align:left;font-size: 10px;">
0.5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
11%
</td>
</tr>
<tr>
<td style="text-align:left;">
2:60:0.8:0.2:0.1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
60
</td>
<td style="text-align:right;">
0.80
</td>
<td style="text-align:right;">
0.20
</td>
<td style="text-align:right;">
0.1
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
80%
</td>
<td style="text-align:left;font-size: 10px;">
81%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
80%
</td>
<td style="text-align:left;font-size: 10px;">
-0.65
</td>
<td style="text-align:left;font-size: 10px;">
1.7
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
11%
</td>
<td style="text-align:left;font-size: 10px;">
-0.27
</td>
<td style="text-align:left;font-size: 10px;">
0.5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
14%
</td>
<td style="text-align:left;font-size: 10px;">
0.19
</td>
<td style="text-align:left;font-size: 10px;">
0.5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
11%
</td>
</tr>
<tr>
<td style="text-align:left;">
2:50:0.8:0.2:0.1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
50
</td>
<td style="text-align:right;">
0.80
</td>
<td style="text-align:right;">
0.20
</td>
<td style="text-align:right;">
0.1
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
80%
</td>
<td style="text-align:left;font-size: 10px;">
81%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
80%
</td>
<td style="text-align:left;font-size: 10px;">
-0.65
</td>
<td style="text-align:left;font-size: 10px;">
1.7
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
11%
</td>
<td style="text-align:left;font-size: 10px;">
-0.27
</td>
<td style="text-align:left;font-size: 10px;">
0.5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
14%
</td>
<td style="text-align:left;font-size: 10px;">
0.19
</td>
<td style="text-align:left;font-size: 10px;">
0.5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
11%
</td>
</tr>
<tr>
<td style="text-align:left;">
2:40:0.8:0.2:0.1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
40
</td>
<td style="text-align:right;">
0.80
</td>
<td style="text-align:right;">
0.20
</td>
<td style="text-align:right;">
0.1
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
80%
</td>
<td style="text-align:left;font-size: 10px;">
81%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
80%
</td>
<td style="text-align:left;font-size: 10px;">
-0.65
</td>
<td style="text-align:left;font-size: 10px;">
1.7
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
11%
</td>
<td style="text-align:left;font-size: 10px;">
-0.27
</td>
<td style="text-align:left;font-size: 10px;">
0.5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
14%
</td>
<td style="text-align:left;font-size: 10px;">
0.19
</td>
<td style="text-align:left;font-size: 10px;">
0.5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
11%
</td>
</tr>
<tr>
<td style="text-align:left;">
2:30:0.8:0.2:0.1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
30
</td>
<td style="text-align:right;">
0.80
</td>
<td style="text-align:right;">
0.20
</td>
<td style="text-align:right;">
0.1
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
80%
</td>
<td style="text-align:left;font-size: 10px;">
81%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
80%
</td>
<td style="text-align:left;font-size: 10px;">
-0.65
</td>
<td style="text-align:left;font-size: 10px;">
1.7
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
11%
</td>
<td style="text-align:left;font-size: 10px;">
-0.27
</td>
<td style="text-align:left;font-size: 10px;">
0.5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
14%
</td>
<td style="text-align:left;font-size: 10px;">
0.19
</td>
<td style="text-align:left;font-size: 10px;">
0.5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
11%
</td>
</tr>
<tr>
<td style="text-align:left;">
2:30:0.65:0.5:0.1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
30
</td>
<td style="text-align:right;">
0.65
</td>
<td style="text-align:right;">
0.50
</td>
<td style="text-align:right;">
0.1
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
75%
</td>
<td style="text-align:left;font-size: 10px;">
78%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
72%
</td>
<td style="text-align:left;font-size: 10px;">
-0.64
</td>
<td style="text-align:left;font-size: 10px;">
1.8
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
11%
</td>
<td style="text-align:left;font-size: 10px;">
-0.25
</td>
<td style="text-align:left;font-size: 10px;">
0.4
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
14%
</td>
<td style="text-align:left;font-size: 10px;">
0.19
</td>
<td style="text-align:left;font-size: 10px;">
0.5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
11%
</td>
</tr>
</tbody>
</table>
</div>
<p>what is the expected <em>detection</em> accuracy of the top 12 settings?</p>
<div class="sourceCode" id="cb259"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb259-1"><a href="chm_sens_test.html#cb259-1" tabindex="-1"></a><span class="fu">plt_detection_dist</span>(</span>
<span id="cb259-2"><a href="chm_sens_test.html#cb259-2" tabindex="-1"></a>  <span class="at">df =</span> param_combos_ranked <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(is_final_selection) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">!</span>tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;_pct_rank_&quot;</span>))</span>
<span id="cb259-3"><a href="chm_sens_test.html#cb259-3" tabindex="-1"></a>  , <span class="fu">paste0</span>(</span>
<span id="cb259-4"><a href="chm_sens_test.html#cb259-4" tabindex="-1"></a>    <span class="st">&quot;Structural Data Only&quot;</span></span>
<span id="cb259-5"><a href="chm_sens_test.html#cb259-5" tabindex="-1"></a>    , <span class="st">&quot;</span><span class="sc">\n</span><span class="st">distribution of pile detection metrics for the top parameter settings tested&quot;</span></span>
<span id="cb259-6"><a href="chm_sens_test.html#cb259-6" tabindex="-1"></a>    , <span class="st">&quot; (n=&quot;</span></span>
<span id="cb259-7"><a href="chm_sens_test.html#cb259-7" tabindex="-1"></a>    , scales<span class="sc">::</span><span class="fu">comma</span>(n_th_top,<span class="at">accuracy=</span><span class="dv">1</span>)</span>
<span id="cb259-8"><a href="chm_sens_test.html#cb259-8" tabindex="-1"></a>    , <span class="st">&quot;) &quot;</span></span>
<span id="cb259-9"><a href="chm_sens_test.html#cb259-9" tabindex="-1"></a>    , <span class="st">&quot;</span><span class="sc">\n</span><span class="st">based on both detection and quantification accuracy&quot;</span></span>
<span id="cb259-10"><a href="chm_sens_test.html#cb259-10" tabindex="-1"></a>  )</span>
<span id="cb259-11"><a href="chm_sens_test.html#cb259-11" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-229-1.png" width="1008" /></p>
<p>what is the expected <em>quantification</em> accuracy of the top 12 settings?</p>
<div class="sourceCode" id="cb260"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb260-1"><a href="chm_sens_test.html#cb260-1" tabindex="-1"></a><span class="co"># plot it</span></span>
<span id="cb260-2"><a href="chm_sens_test.html#cb260-2" tabindex="-1"></a><span class="fu">plt_form_quantification_dist</span>(</span>
<span id="cb260-3"><a href="chm_sens_test.html#cb260-3" tabindex="-1"></a>  <span class="at">df =</span> param_combos_ranked <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(is_final_selection) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">!</span>tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;_pct_rank_&quot;</span>))</span>
<span id="cb260-4"><a href="chm_sens_test.html#cb260-4" tabindex="-1"></a>  , <span class="fu">paste0</span>(</span>
<span id="cb260-5"><a href="chm_sens_test.html#cb260-5" tabindex="-1"></a>    <span class="st">&quot;Structural Data Only&quot;</span></span>
<span id="cb260-6"><a href="chm_sens_test.html#cb260-6" tabindex="-1"></a>    , <span class="st">&quot;</span><span class="sc">\n</span><span class="st">distribution of pile form quantification metrics for the top parameter settings tested&quot;</span></span>
<span id="cb260-7"><a href="chm_sens_test.html#cb260-7" tabindex="-1"></a>    , <span class="st">&quot; (n=&quot;</span></span>
<span id="cb260-8"><a href="chm_sens_test.html#cb260-8" tabindex="-1"></a>    , scales<span class="sc">::</span><span class="fu">comma</span>(n_th_top,<span class="at">accuracy=</span><span class="dv">1</span>)</span>
<span id="cb260-9"><a href="chm_sens_test.html#cb260-9" tabindex="-1"></a>    , <span class="st">&quot;) &quot;</span></span>
<span id="cb260-10"><a href="chm_sens_test.html#cb260-10" tabindex="-1"></a>    , <span class="st">&quot;</span><span class="sc">\n</span><span class="st">based on both detection and quantification accuracy&quot;</span></span>
<span id="cb260-11"><a href="chm_sens_test.html#cb260-11" tabindex="-1"></a>  )</span>
<span id="cb260-12"><a href="chm_sens_test.html#cb260-12" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-230-1.png" width="1008" /></p>
<p>finally, here are the combinations selected compared against all 5,880 combinations tested.</p>
<div class="sourceCode" id="cb261"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb261-1"><a href="chm_sens_test.html#cb261-1" tabindex="-1"></a>param_combos_ranked <span class="sc">%&gt;%</span> </span>
<span id="cb261-2"><a href="chm_sens_test.html#cb261-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb261-3"><a href="chm_sens_test.html#cb261-3" tabindex="-1"></a>    rn,max_ht_m,max_area_m2,convexity_pct,circle_fit_iou_pct</span>
<span id="cb261-4"><a href="chm_sens_test.html#cb261-4" tabindex="-1"></a>    , is_final_selection</span>
<span id="cb261-5"><a href="chm_sens_test.html#cb261-5" tabindex="-1"></a>    , f_score, precision, recall</span>
<span id="cb261-6"><a href="chm_sens_test.html#cb261-6" tabindex="-1"></a>    <span class="co"># quantification accuracy</span></span>
<span id="cb261-7"><a href="chm_sens_test.html#cb261-7" tabindex="-1"></a>    , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_mape&quot;</span>)</span>
<span id="cb261-8"><a href="chm_sens_test.html#cb261-8" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb261-9"><a href="chm_sens_test.html#cb261-9" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(</span>
<span id="cb261-10"><a href="chm_sens_test.html#cb261-10" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">c</span>(</span>
<span id="cb261-11"><a href="chm_sens_test.html#cb261-11" tabindex="-1"></a>      tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_mape&quot;</span>)</span>
<span id="cb261-12"><a href="chm_sens_test.html#cb261-12" tabindex="-1"></a>      <span class="co"># ,precision,recall</span></span>
<span id="cb261-13"><a href="chm_sens_test.html#cb261-13" tabindex="-1"></a>    )</span>
<span id="cb261-14"><a href="chm_sens_test.html#cb261-14" tabindex="-1"></a>    , <span class="at">names_to =</span> <span class="st">&quot;metric&quot;</span></span>
<span id="cb261-15"><a href="chm_sens_test.html#cb261-15" tabindex="-1"></a>    , <span class="at">values_to =</span> <span class="st">&quot;value&quot;</span></span>
<span id="cb261-16"><a href="chm_sens_test.html#cb261-16" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb261-17"><a href="chm_sens_test.html#cb261-17" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb261-18"><a href="chm_sens_test.html#cb261-18" tabindex="-1"></a>    <span class="at">eval_metric =</span> stringr<span class="sc">::</span><span class="fu">str_extract</span>(metric, <span class="st">&quot;(_rmse|_rrmse|_mean|_mape)$&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb261-19"><a href="chm_sens_test.html#cb261-19" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_remove_all</span>(<span class="st">&quot;_&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb261-20"><a href="chm_sens_test.html#cb261-20" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_replace_all</span>(<span class="st">&quot;mean&quot;</span>,<span class="st">&quot;me&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb261-21"><a href="chm_sens_test.html#cb261-21" tabindex="-1"></a>      <span class="fu">toupper</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb261-22"><a href="chm_sens_test.html#cb261-22" tabindex="-1"></a>      <span class="fu">factor</span>(</span>
<span id="cb261-23"><a href="chm_sens_test.html#cb261-23" tabindex="-1"></a>        <span class="at">ordered =</span> T</span>
<span id="cb261-24"><a href="chm_sens_test.html#cb261-24" tabindex="-1"></a>        , <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;ME&quot;</span>,<span class="st">&quot;RMSE&quot;</span>,<span class="st">&quot;RRMSE&quot;</span>,<span class="st">&quot;MAPE&quot;</span>)</span>
<span id="cb261-25"><a href="chm_sens_test.html#cb261-25" tabindex="-1"></a>      )</span>
<span id="cb261-26"><a href="chm_sens_test.html#cb261-26" tabindex="-1"></a>    , <span class="at">pile_metric =</span> metric <span class="sc">%&gt;%</span> </span>
<span id="cb261-27"><a href="chm_sens_test.html#cb261-27" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_remove</span>(<span class="st">&quot;(_rmse|_rrmse|_mean|_mape)$&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb261-28"><a href="chm_sens_test.html#cb261-28" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_extract</span>(<span class="st">&quot;(paraboloid_volume|volume|area|height|diameter|precision|recall)&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb261-29"><a href="chm_sens_test.html#cb261-29" tabindex="-1"></a>      <span class="fu">factor</span>(</span>
<span id="cb261-30"><a href="chm_sens_test.html#cb261-30" tabindex="-1"></a>        <span class="at">ordered =</span> T</span>
<span id="cb261-31"><a href="chm_sens_test.html#cb261-31" tabindex="-1"></a>        , <span class="at">levels =</span> <span class="fu">c</span>(</span>
<span id="cb261-32"><a href="chm_sens_test.html#cb261-32" tabindex="-1"></a>          <span class="st">&quot;volume&quot;</span></span>
<span id="cb261-33"><a href="chm_sens_test.html#cb261-33" tabindex="-1"></a>          , <span class="st">&quot;paraboloid_volume&quot;</span></span>
<span id="cb261-34"><a href="chm_sens_test.html#cb261-34" tabindex="-1"></a>          , <span class="st">&quot;area&quot;</span></span>
<span id="cb261-35"><a href="chm_sens_test.html#cb261-35" tabindex="-1"></a>          , <span class="st">&quot;height&quot;</span></span>
<span id="cb261-36"><a href="chm_sens_test.html#cb261-36" tabindex="-1"></a>          , <span class="st">&quot;diameter&quot;</span></span>
<span id="cb261-37"><a href="chm_sens_test.html#cb261-37" tabindex="-1"></a>          , <span class="st">&quot;recall&quot;</span></span>
<span id="cb261-38"><a href="chm_sens_test.html#cb261-38" tabindex="-1"></a>          , <span class="st">&quot;precision&quot;</span></span>
<span id="cb261-39"><a href="chm_sens_test.html#cb261-39" tabindex="-1"></a>        )</span>
<span id="cb261-40"><a href="chm_sens_test.html#cb261-40" tabindex="-1"></a>        , <span class="at">labels =</span> <span class="fu">c</span>(</span>
<span id="cb261-41"><a href="chm_sens_test.html#cb261-41" tabindex="-1"></a>          <span class="st">&quot;Volume&quot;</span></span>
<span id="cb261-42"><a href="chm_sens_test.html#cb261-42" tabindex="-1"></a>          , <span class="st">&quot;Volume paraboloid&quot;</span></span>
<span id="cb261-43"><a href="chm_sens_test.html#cb261-43" tabindex="-1"></a>          , <span class="st">&quot;Area (m2)&quot;</span></span>
<span id="cb261-44"><a href="chm_sens_test.html#cb261-44" tabindex="-1"></a>          , <span class="st">&quot;Height (m)&quot;</span></span>
<span id="cb261-45"><a href="chm_sens_test.html#cb261-45" tabindex="-1"></a>          , <span class="st">&quot;Diameter (m)&quot;</span></span>
<span id="cb261-46"><a href="chm_sens_test.html#cb261-46" tabindex="-1"></a>          , <span class="st">&quot;Recall&quot;</span></span>
<span id="cb261-47"><a href="chm_sens_test.html#cb261-47" tabindex="-1"></a>          , <span class="st">&quot;Precision&quot;</span></span>
<span id="cb261-48"><a href="chm_sens_test.html#cb261-48" tabindex="-1"></a>        )</span>
<span id="cb261-49"><a href="chm_sens_test.html#cb261-49" tabindex="-1"></a>      )</span>
<span id="cb261-50"><a href="chm_sens_test.html#cb261-50" tabindex="-1"></a>    , <span class="at">color_metric =</span> <span class="fu">ifelse</span>(is_final_selection, pile_metric, <span class="cn">NA</span>) <span class="sc">%&gt;%</span> <span class="fu">factor</span>()</span>
<span id="cb261-51"><a href="chm_sens_test.html#cb261-51" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb261-52"><a href="chm_sens_test.html#cb261-52" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(is_final_selection) <span class="sc">%&gt;%</span> </span>
<span id="cb261-53"><a href="chm_sens_test.html#cb261-53" tabindex="-1"></a>  <span class="co"># plot</span></span>
<span id="cb261-54"><a href="chm_sens_test.html#cb261-54" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> f_score, <span class="at">y =</span> value, <span class="at">color =</span> color_metric)) <span class="sc">+</span></span>
<span id="cb261-55"><a href="chm_sens_test.html#cb261-55" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb261-56"><a href="chm_sens_test.html#cb261-56" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">facet_wrap</span>(<span class="at">facets =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(pile_metric)) <span class="sc">+</span></span>
<span id="cb261-57"><a href="chm_sens_test.html#cb261-57" tabindex="-1"></a>  harrypotter<span class="sc">::</span><span class="fu">scale_color_hp_d</span>(<span class="at">option =</span> <span class="st">&quot;hermionegranger&quot;</span>, <span class="at">na.value =</span> <span class="st">&quot;gray88&quot;</span>) <span class="sc">+</span></span>
<span id="cb261-58"><a href="chm_sens_test.html#cb261-58" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_x_continuous</span>(</span>
<span id="cb261-59"><a href="chm_sens_test.html#cb261-59" tabindex="-1"></a>    <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">percent_format</span>(<span class="at">accuracy =</span> <span class="dv">1</span>)</span>
<span id="cb261-60"><a href="chm_sens_test.html#cb261-60" tabindex="-1"></a>    , <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)</span>
<span id="cb261-61"><a href="chm_sens_test.html#cb261-61" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb261-62"><a href="chm_sens_test.html#cb261-62" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_y_continuous</span>(</span>
<span id="cb261-63"><a href="chm_sens_test.html#cb261-63" tabindex="-1"></a>    <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">percent_format</span>(<span class="at">accuracy =</span> <span class="dv">1</span>)</span>
<span id="cb261-64"><a href="chm_sens_test.html#cb261-64" tabindex="-1"></a>    , <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="cn">NA</span>)</span>
<span id="cb261-65"><a href="chm_sens_test.html#cb261-65" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb261-66"><a href="chm_sens_test.html#cb261-66" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;F-Score&quot;</span>, <span class="at">y =</span> <span class="st">&quot;MAPE&quot;</span>, <span class="at">caption =</span> <span class="st">&quot;*records in gray not selected&quot;</span>) <span class="sc">+</span></span>
<span id="cb261-67"><a href="chm_sens_test.html#cb261-67" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb261-68"><a href="chm_sens_test.html#cb261-68" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb261-69"><a href="chm_sens_test.html#cb261-69" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb261-70"><a href="chm_sens_test.html#cb261-70" tabindex="-1"></a>    , <span class="at">strip.text =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb261-71"><a href="chm_sens_test.html#cb261-71" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-231-1.png" width="1008" /></p>
</div>
</div>
<div id="by-chm-resolution" class="section level4 hasAnchor" number="8.5.3.2">
<h4><span class="header-section-number">8.5.3.2</span> by CHM resolution<a href="chm_sens_test.html#by-chm-resolution" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>To select the best-performing parameter combinations of those tested, we will prioritize those that balance detection and quantification accuracy. From this group, we will then identify the settings that achieve the highest pile detection rates (recall). These recommendations are for users who are working with a CHM with a resolution in the range of those tested for this analysis or can aggregate (i.e. make more coarse) a CHM to a resolution tested for the purpose of either improving processing performance or enhancing pile detection and/or quantification accuracy based on the results shown here</p>
<p>we already created this data above (<code>param_combos_ranked</code>) using the F-Score and the average rank of the MAPE metrics across all form measurements (i.e. height, diameter, area) to determine the best overall list by CHM resolution</p>
<div id="top-2.0" class="section level5 hasAnchor" number="8.5.3.2.1">
<h5><span class="header-section-number">8.5.3.2.1</span> Top 2.0%<a href="chm_sens_test.html#top-2.0" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>let’s check out the parameter settings of the top 2.0% (n=23) from all 1,176 combinations tested by CHM resolution. these are “votes” for the parameter setting based on the combinations that achieved the best balance between both detection and quantification accuracy.</p>
<div class="sourceCode" id="cb262"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb262-1"><a href="chm_sens_test.html#cb262-1" tabindex="-1"></a>param_combos_ranked <span class="sc">%&gt;%</span></span>
<span id="cb262-2"><a href="chm_sens_test.html#cb262-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(is_top_chm) <span class="sc">%&gt;%</span> </span>
<span id="cb262-3"><a href="chm_sens_test.html#cb262-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;f_score&quot;</span>), max_ht_m,max_area_m2,convexity_pct,circle_fit_iou_pct,chm_res_m,chm_res_m_desc) <span class="sc">%&gt;%</span> </span>
<span id="cb262-4"><a href="chm_sens_test.html#cb262-4" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(</span>
<span id="cb262-5"><a href="chm_sens_test.html#cb262-5" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">c</span>(max_ht_m,max_area_m2,convexity_pct,circle_fit_iou_pct)</span>
<span id="cb262-6"><a href="chm_sens_test.html#cb262-6" tabindex="-1"></a>    , <span class="at">names_to =</span> <span class="st">&quot;metric&quot;</span></span>
<span id="cb262-7"><a href="chm_sens_test.html#cb262-7" tabindex="-1"></a>    , <span class="at">values_to =</span> <span class="st">&quot;value&quot;</span></span>
<span id="cb262-8"><a href="chm_sens_test.html#cb262-8" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb262-9"><a href="chm_sens_test.html#cb262-9" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">count</span>(chm_res_m,chm_res_m_desc, metric, value) <span class="sc">%&gt;%</span> </span>
<span id="cb262-10"><a href="chm_sens_test.html#cb262-10" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(chm_res_m,chm_res_m_desc, metric) <span class="sc">%&gt;%</span> </span>
<span id="cb262-11"><a href="chm_sens_test.html#cb262-11" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb262-12"><a href="chm_sens_test.html#cb262-12" tabindex="-1"></a>    <span class="at">pct=</span>n<span class="sc">/</span><span class="fu">sum</span>(n)</span>
<span id="cb262-13"><a href="chm_sens_test.html#cb262-13" tabindex="-1"></a>    , <span class="at">lab =</span> <span class="fu">paste0</span>(scales<span class="sc">::</span><span class="fu">percent</span>(pct,<span class="at">accuracy=</span><span class="fl">0.1</span>)) <span class="co">#, &quot;\nn=&quot;, scales::comma(n,accuracy=1))</span></span>
<span id="cb262-14"><a href="chm_sens_test.html#cb262-14" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb262-15"><a href="chm_sens_test.html#cb262-15" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(</span>
<span id="cb262-16"><a href="chm_sens_test.html#cb262-16" tabindex="-1"></a>    <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">factor</span>(value), <span class="at">y=</span>pct, <span class="at">label=</span>lab, <span class="at">fill =</span> metric)</span>
<span id="cb262-17"><a href="chm_sens_test.html#cb262-17" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb262-18"><a href="chm_sens_test.html#cb262-18" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_col</span>(<span class="at">width =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb262-19"><a href="chm_sens_test.html#cb262-19" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_text</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">size =</span> <span class="fl">2.2</span>, <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb262-20"><a href="chm_sens_test.html#cb262-20" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">facet_grid</span>(<span class="at">cols =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(metric), <span class="at">rows =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(chm_res_m_desc), <span class="at">scales =</span> <span class="st">&quot;free_x&quot;</span>) <span class="sc">+</span></span>
<span id="cb262-21"><a href="chm_sens_test.html#cb262-21" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_y_continuous</span>(</span>
<span id="cb262-22"><a href="chm_sens_test.html#cb262-22" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="at">by=</span><span class="fl">0.2</span>)</span>
<span id="cb262-23"><a href="chm_sens_test.html#cb262-23" tabindex="-1"></a>    , <span class="at">labels =</span> scales<span class="sc">::</span>percent</span>
<span id="cb262-24"><a href="chm_sens_test.html#cb262-24" tabindex="-1"></a>    , <span class="at">expand =</span> ggplot2<span class="sc">::</span><span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">0.2</span>))</span>
<span id="cb262-25"><a href="chm_sens_test.html#cb262-25" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb262-26"><a href="chm_sens_test.html#cb262-26" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_fill_manual</span>(<span class="at">values =</span> pal_param[<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>]) <span class="sc">+</span></span>
<span id="cb262-27"><a href="chm_sens_test.html#cb262-27" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb262-28"><a href="chm_sens_test.html#cb262-28" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;parameter setting&quot;</span>, <span class="at">y =</span> <span class="st">&quot;&quot;</span></span>
<span id="cb262-29"><a href="chm_sens_test.html#cb262-29" tabindex="-1"></a>    , <span class="at">fill =</span> <span class="st">&quot;&quot;</span></span>
<span id="cb262-30"><a href="chm_sens_test.html#cb262-30" tabindex="-1"></a>    , <span class="at">subtitle =</span> <span class="fu">paste0</span>(</span>
<span id="cb262-31"><a href="chm_sens_test.html#cb262-31" tabindex="-1"></a>      <span class="st">&quot;Structural Data Only&quot;</span></span>
<span id="cb262-32"><a href="chm_sens_test.html#cb262-32" tabindex="-1"></a>       , <span class="st">&quot;</span><span class="sc">\n</span><span class="st">parameter settings of top &quot;</span></span>
<span id="cb262-33"><a href="chm_sens_test.html#cb262-33" tabindex="-1"></a>       , scales<span class="sc">::</span><span class="fu">percent</span>(pct_th_top_chm,<span class="at">accuracy=</span><span class="fl">0.1</span>)</span>
<span id="cb262-34"><a href="chm_sens_test.html#cb262-34" tabindex="-1"></a>       , <span class="st">&quot; (n=&quot;</span></span>
<span id="cb262-35"><a href="chm_sens_test.html#cb262-35" tabindex="-1"></a>       , scales<span class="sc">::</span><span class="fu">comma</span>(n_combos_top_chm , <span class="at">accuracy =</span> <span class="dv">1</span>)</span>
<span id="cb262-36"><a href="chm_sens_test.html#cb262-36" tabindex="-1"></a>       , <span class="st">&quot;) &quot;</span></span>
<span id="cb262-37"><a href="chm_sens_test.html#cb262-37" tabindex="-1"></a>       , <span class="st">&quot;parameter combinations tested by CHM resolution</span><span class="sc">\n</span><span class="st">based on both detection and quantification accuracy&quot;</span></span>
<span id="cb262-38"><a href="chm_sens_test.html#cb262-38" tabindex="-1"></a>    )</span>
<span id="cb262-39"><a href="chm_sens_test.html#cb262-39" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb262-40"><a href="chm_sens_test.html#cb262-40" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb262-41"><a href="chm_sens_test.html#cb262-41" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb262-42"><a href="chm_sens_test.html#cb262-42" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb262-43"><a href="chm_sens_test.html#cb262-43" tabindex="-1"></a>    , <span class="at">strip.text.x =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb262-44"><a href="chm_sens_test.html#cb262-44" tabindex="-1"></a>    , <span class="at">strip.text.y =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">9</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb262-45"><a href="chm_sens_test.html#cb262-45" tabindex="-1"></a>    , <span class="at">axis.text.y =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">6</span>)</span>
<span id="cb262-46"><a href="chm_sens_test.html#cb262-46" tabindex="-1"></a>    , <span class="at">axis.text.x =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>)</span>
<span id="cb262-47"><a href="chm_sens_test.html#cb262-47" tabindex="-1"></a>    , <span class="at">plot.subtitle =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>)</span>
<span id="cb262-48"><a href="chm_sens_test.html#cb262-48" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-233-1.png" width="1008" /></p>
<p>what is the expected <em>detection</em> accuracy of the top 2.0% (n=23) combinations tested by CHM resolution?</p>
<div class="sourceCode" id="cb263"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb263-1"><a href="chm_sens_test.html#cb263-1" tabindex="-1"></a><span class="fu">plt_detection_dist2</span>(</span>
<span id="cb263-2"><a href="chm_sens_test.html#cb263-2" tabindex="-1"></a>  <span class="at">df =</span> param_combos_ranked <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(is_top_chm) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">!</span>tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;_pct_rank_&quot;</span>))</span>
<span id="cb263-3"><a href="chm_sens_test.html#cb263-3" tabindex="-1"></a>  , <span class="fu">paste0</span>(</span>
<span id="cb263-4"><a href="chm_sens_test.html#cb263-4" tabindex="-1"></a>    <span class="st">&quot;Structural Data Only&quot;</span></span>
<span id="cb263-5"><a href="chm_sens_test.html#cb263-5" tabindex="-1"></a>    , <span class="st">&quot;</span><span class="sc">\n</span><span class="st">distribution of pile detection metrics for top &quot;</span></span>
<span id="cb263-6"><a href="chm_sens_test.html#cb263-6" tabindex="-1"></a>    , scales<span class="sc">::</span><span class="fu">percent</span>(pct_th_top_chm,<span class="at">accuracy=</span><span class="fl">0.1</span>)</span>
<span id="cb263-7"><a href="chm_sens_test.html#cb263-7" tabindex="-1"></a>    , <span class="st">&quot; (n=&quot;</span></span>
<span id="cb263-8"><a href="chm_sens_test.html#cb263-8" tabindex="-1"></a>    , scales<span class="sc">::</span><span class="fu">comma</span>(n_combos_top_chm, <span class="at">accuracy=</span><span class="dv">1</span>)</span>
<span id="cb263-9"><a href="chm_sens_test.html#cb263-9" tabindex="-1"></a>    , <span class="st">&quot;) &quot;</span></span>
<span id="cb263-10"><a href="chm_sens_test.html#cb263-10" tabindex="-1"></a>    , <span class="st">&quot;parameter combinations tested by CHM resolution</span><span class="sc">\n</span><span class="st">based on both detection and quantification accuracy&quot;</span></span>
<span id="cb263-11"><a href="chm_sens_test.html#cb263-11" tabindex="-1"></a>  )</span>
<span id="cb263-12"><a href="chm_sens_test.html#cb263-12" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-234-1.png" width="1008" /></p>
<p>what is the expected <em>MAPE</em> of the top 2.0% (n=23) combinations tested by CHM resolution?</p>
<div class="sourceCode" id="cb264"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb264-1"><a href="chm_sens_test.html#cb264-1" tabindex="-1"></a><span class="co"># plot it</span></span>
<span id="cb264-2"><a href="chm_sens_test.html#cb264-2" tabindex="-1"></a><span class="fu">plt_form_quantification_dist2</span>(</span>
<span id="cb264-3"><a href="chm_sens_test.html#cb264-3" tabindex="-1"></a>  <span class="at">df =</span> param_combos_ranked <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(is_top_chm) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">!</span>tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;_pct_rank_&quot;</span>))</span>
<span id="cb264-4"><a href="chm_sens_test.html#cb264-4" tabindex="-1"></a>  , <span class="at">quant_metric =</span> <span class="st">&quot;mape&quot;</span></span>
<span id="cb264-5"><a href="chm_sens_test.html#cb264-5" tabindex="-1"></a>  , <span class="fu">paste0</span>(</span>
<span id="cb264-6"><a href="chm_sens_test.html#cb264-6" tabindex="-1"></a>    <span class="st">&quot;Structural Data Only&quot;</span></span>
<span id="cb264-7"><a href="chm_sens_test.html#cb264-7" tabindex="-1"></a>    , <span class="st">&quot;</span><span class="sc">\n</span><span class="st">distribution of pile form quantification metrics for the top &quot;</span></span>
<span id="cb264-8"><a href="chm_sens_test.html#cb264-8" tabindex="-1"></a>    , scales<span class="sc">::</span><span class="fu">percent</span>(pct_th_top_chm,<span class="at">accuracy=</span><span class="fl">0.1</span>)</span>
<span id="cb264-9"><a href="chm_sens_test.html#cb264-9" tabindex="-1"></a>    , <span class="st">&quot; (n=&quot;</span></span>
<span id="cb264-10"><a href="chm_sens_test.html#cb264-10" tabindex="-1"></a>    , scales<span class="sc">::</span><span class="fu">comma</span>(n_combos_top_chm, <span class="at">accuracy=</span><span class="dv">1</span>)</span>
<span id="cb264-11"><a href="chm_sens_test.html#cb264-11" tabindex="-1"></a>    , <span class="st">&quot;) &quot;</span></span>
<span id="cb264-12"><a href="chm_sens_test.html#cb264-12" tabindex="-1"></a>    , <span class="st">&quot;parameter combinations tested by CHM resolution</span><span class="sc">\n</span><span class="st">based on both detection and quantification accuracy&quot;</span></span>
<span id="cb264-13"><a href="chm_sens_test.html#cb264-13" tabindex="-1"></a>  )</span>
<span id="cb264-14"><a href="chm_sens_test.html#cb264-14" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-235-1.png" width="1008" /></p>
<p>what is the expected <em>Mean Error (ME)</em> of the top 2.0% (n=23) combinations tested by CHM resolution?</p>
<div class="sourceCode" id="cb265"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb265-1"><a href="chm_sens_test.html#cb265-1" tabindex="-1"></a><span class="co"># plot it</span></span>
<span id="cb265-2"><a href="chm_sens_test.html#cb265-2" tabindex="-1"></a><span class="fu">plt_form_quantification_dist2</span>(</span>
<span id="cb265-3"><a href="chm_sens_test.html#cb265-3" tabindex="-1"></a>  <span class="at">df =</span> param_combos_ranked <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(is_top_chm) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">!</span>tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;_pct_rank_&quot;</span>))</span>
<span id="cb265-4"><a href="chm_sens_test.html#cb265-4" tabindex="-1"></a>  , <span class="at">quant_metric =</span> <span class="st">&quot;mean&quot;</span></span>
<span id="cb265-5"><a href="chm_sens_test.html#cb265-5" tabindex="-1"></a>  , <span class="fu">paste0</span>(</span>
<span id="cb265-6"><a href="chm_sens_test.html#cb265-6" tabindex="-1"></a>    <span class="st">&quot;Structural Data Only&quot;</span></span>
<span id="cb265-7"><a href="chm_sens_test.html#cb265-7" tabindex="-1"></a>    , <span class="st">&quot;</span><span class="sc">\n</span><span class="st">distribution of pile form quantification metrics for the top &quot;</span></span>
<span id="cb265-8"><a href="chm_sens_test.html#cb265-8" tabindex="-1"></a>    , scales<span class="sc">::</span><span class="fu">percent</span>(pct_th_top_chm,<span class="at">accuracy=</span><span class="fl">0.1</span>)</span>
<span id="cb265-9"><a href="chm_sens_test.html#cb265-9" tabindex="-1"></a>    , <span class="st">&quot; (n=&quot;</span></span>
<span id="cb265-10"><a href="chm_sens_test.html#cb265-10" tabindex="-1"></a>    , scales<span class="sc">::</span><span class="fu">comma</span>(n_combos_top_chm, <span class="at">accuracy=</span><span class="dv">1</span>)</span>
<span id="cb265-11"><a href="chm_sens_test.html#cb265-11" tabindex="-1"></a>    , <span class="st">&quot;) &quot;</span></span>
<span id="cb265-12"><a href="chm_sens_test.html#cb265-12" tabindex="-1"></a>    , <span class="st">&quot;parameter combinations tested by CHM resolution</span><span class="sc">\n</span><span class="st">based on both detection and quantification accuracy&quot;</span></span>
<span id="cb265-13"><a href="chm_sens_test.html#cb265-13" tabindex="-1"></a>  )</span>
<span id="cb265-14"><a href="chm_sens_test.html#cb265-14" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-236-1.png" width="1008" /></p>
<p>what is the expected <em>RMSE</em> of the top 2.0% (n=23) combinations tested by CHM resolution?</p>
<div class="sourceCode" id="cb266"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb266-1"><a href="chm_sens_test.html#cb266-1" tabindex="-1"></a><span class="co"># plot it</span></span>
<span id="cb266-2"><a href="chm_sens_test.html#cb266-2" tabindex="-1"></a><span class="fu">plt_form_quantification_dist2</span>(</span>
<span id="cb266-3"><a href="chm_sens_test.html#cb266-3" tabindex="-1"></a>  <span class="at">df =</span> param_combos_ranked <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(is_top_chm) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">!</span>tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;_pct_rank_&quot;</span>))</span>
<span id="cb266-4"><a href="chm_sens_test.html#cb266-4" tabindex="-1"></a>  , <span class="at">quant_metric =</span> <span class="st">&quot;rmse&quot;</span></span>
<span id="cb266-5"><a href="chm_sens_test.html#cb266-5" tabindex="-1"></a>  , <span class="fu">paste0</span>(</span>
<span id="cb266-6"><a href="chm_sens_test.html#cb266-6" tabindex="-1"></a>    <span class="st">&quot;Structural Data Only&quot;</span></span>
<span id="cb266-7"><a href="chm_sens_test.html#cb266-7" tabindex="-1"></a>    , <span class="st">&quot;</span><span class="sc">\n</span><span class="st">distribution of pile form quantification metrics for the top &quot;</span></span>
<span id="cb266-8"><a href="chm_sens_test.html#cb266-8" tabindex="-1"></a>    , scales<span class="sc">::</span><span class="fu">percent</span>(pct_th_top_chm,<span class="at">accuracy=</span><span class="fl">0.1</span>)</span>
<span id="cb266-9"><a href="chm_sens_test.html#cb266-9" tabindex="-1"></a>    , <span class="st">&quot; (n=&quot;</span></span>
<span id="cb266-10"><a href="chm_sens_test.html#cb266-10" tabindex="-1"></a>    , scales<span class="sc">::</span><span class="fu">comma</span>(n_combos_top_chm, <span class="at">accuracy=</span><span class="dv">1</span>)</span>
<span id="cb266-11"><a href="chm_sens_test.html#cb266-11" tabindex="-1"></a>    , <span class="st">&quot;) &quot;</span></span>
<span id="cb266-12"><a href="chm_sens_test.html#cb266-12" tabindex="-1"></a>    , <span class="st">&quot;parameter combinations tested by CHM resolution</span><span class="sc">\n</span><span class="st">based on both detection and quantification accuracy&quot;</span></span>
<span id="cb266-13"><a href="chm_sens_test.html#cb266-13" tabindex="-1"></a>  )</span>
<span id="cb266-14"><a href="chm_sens_test.html#cb266-14" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-237-1.png" width="1008" /></p>
</div>
<div id="top-6-settings" class="section level5 hasAnchor" number="8.5.3.2.2">
<h5><span class="header-section-number">8.5.3.2.2</span> Top 6 settings<a href="chm_sens_test.html#top-6-settings" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>Let’s focus on the top 6 parameter settings tested by CHM resolution to highlight the pile detection and form quantification accuracies achieved by these settings</p>
<div class="sourceCode" id="cb267"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb267-1"><a href="chm_sens_test.html#cb267-1" tabindex="-1"></a><span class="co"># pal_temp %&gt;% scales::show_col()</span></span>
<span id="cb267-2"><a href="chm_sens_test.html#cb267-2" tabindex="-1"></a><span class="co"># filter and reshape</span></span>
<span id="cb267-3"><a href="chm_sens_test.html#cb267-3" tabindex="-1"></a>param_combos_ranked <span class="sc">%&gt;%</span> </span>
<span id="cb267-4"><a href="chm_sens_test.html#cb267-4" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(is_final_selection_chm) <span class="sc">%&gt;%</span> </span>
<span id="cb267-5"><a href="chm_sens_test.html#cb267-5" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">!</span>tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;_pct_rank_&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb267-6"><a href="chm_sens_test.html#cb267-6" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb267-7"><a href="chm_sens_test.html#cb267-7" tabindex="-1"></a>    max_ht_m,max_area_m2,convexity_pct,circle_fit_iou_pct,chm_res_m,chm_res_m_desc</span>
<span id="cb267-8"><a href="chm_sens_test.html#cb267-8" tabindex="-1"></a>    , chm_lab</span>
<span id="cb267-9"><a href="chm_sens_test.html#cb267-9" tabindex="-1"></a>    <span class="co"># detection</span></span>
<span id="cb267-10"><a href="chm_sens_test.html#cb267-10" tabindex="-1"></a>    , f_score, recall, precision</span>
<span id="cb267-11"><a href="chm_sens_test.html#cb267-11" tabindex="-1"></a>    <span class="co"># quantification</span></span>
<span id="cb267-12"><a href="chm_sens_test.html#cb267-12" tabindex="-1"></a>    , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_rmse&quot;</span>)</span>
<span id="cb267-13"><a href="chm_sens_test.html#cb267-13" tabindex="-1"></a>    , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_rrmse&quot;</span>)</span>
<span id="cb267-14"><a href="chm_sens_test.html#cb267-14" tabindex="-1"></a>    , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_mean&quot;</span>)</span>
<span id="cb267-15"><a href="chm_sens_test.html#cb267-15" tabindex="-1"></a>    , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_mape&quot;</span>)</span>
<span id="cb267-16"><a href="chm_sens_test.html#cb267-16" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb267-17"><a href="chm_sens_test.html#cb267-17" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(</span>
<span id="cb267-18"><a href="chm_sens_test.html#cb267-18" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">c</span>(</span>
<span id="cb267-19"><a href="chm_sens_test.html#cb267-19" tabindex="-1"></a>      f_score, recall, precision</span>
<span id="cb267-20"><a href="chm_sens_test.html#cb267-20" tabindex="-1"></a>      , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_rmse&quot;</span>)</span>
<span id="cb267-21"><a href="chm_sens_test.html#cb267-21" tabindex="-1"></a>      , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_rrmse&quot;</span>)</span>
<span id="cb267-22"><a href="chm_sens_test.html#cb267-22" tabindex="-1"></a>      , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_mean&quot;</span>)</span>
<span id="cb267-23"><a href="chm_sens_test.html#cb267-23" tabindex="-1"></a>      , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_mape&quot;</span>)</span>
<span id="cb267-24"><a href="chm_sens_test.html#cb267-24" tabindex="-1"></a>    )</span>
<span id="cb267-25"><a href="chm_sens_test.html#cb267-25" tabindex="-1"></a>    , <span class="at">names_to =</span> <span class="st">&quot;metric&quot;</span></span>
<span id="cb267-26"><a href="chm_sens_test.html#cb267-26" tabindex="-1"></a>    , <span class="at">values_to =</span> <span class="st">&quot;value&quot;</span></span>
<span id="cb267-27"><a href="chm_sens_test.html#cb267-27" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb267-28"><a href="chm_sens_test.html#cb267-28" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb267-29"><a href="chm_sens_test.html#cb267-29" tabindex="-1"></a>    <span class="at">eval_metric =</span> stringr<span class="sc">::</span><span class="fu">str_extract</span>(metric, <span class="st">&quot;(_rmse|_rrmse|_mean|_mape|f_score|recall|precision)$&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb267-30"><a href="chm_sens_test.html#cb267-30" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_remove_all</span>(<span class="st">&quot;_&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb267-31"><a href="chm_sens_test.html#cb267-31" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_replace_all</span>(<span class="st">&quot;mean&quot;</span>,<span class="st">&quot;me&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb267-32"><a href="chm_sens_test.html#cb267-32" tabindex="-1"></a>      <span class="fu">toupper</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb267-33"><a href="chm_sens_test.html#cb267-33" tabindex="-1"></a>      <span class="fu">factor</span>(</span>
<span id="cb267-34"><a href="chm_sens_test.html#cb267-34" tabindex="-1"></a>        <span class="at">ordered =</span> T</span>
<span id="cb267-35"><a href="chm_sens_test.html#cb267-35" tabindex="-1"></a>        , <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;FSCORE&quot;</span>,<span class="st">&quot;RECALL&quot;</span>,<span class="st">&quot;PRECISION&quot;</span>, <span class="st">&quot;ME&quot;</span>,<span class="st">&quot;RMSE&quot;</span>,<span class="st">&quot;RRMSE&quot;</span>,<span class="st">&quot;MAPE&quot;</span>)</span>
<span id="cb267-36"><a href="chm_sens_test.html#cb267-36" tabindex="-1"></a>        , <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;F-score&quot;</span>,<span class="st">&quot;Recall&quot;</span>,<span class="st">&quot;Precision&quot;</span>, <span class="st">&quot;ME&quot;</span>,<span class="st">&quot;RMSE&quot;</span>,<span class="st">&quot;RRMSE&quot;</span>,<span class="st">&quot;MAPE&quot;</span>)</span>
<span id="cb267-37"><a href="chm_sens_test.html#cb267-37" tabindex="-1"></a>      )</span>
<span id="cb267-38"><a href="chm_sens_test.html#cb267-38" tabindex="-1"></a>    , <span class="at">pile_metric =</span> metric <span class="sc">%&gt;%</span> </span>
<span id="cb267-39"><a href="chm_sens_test.html#cb267-39" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_remove</span>(<span class="st">&quot;(_rmse|_rrmse|_mean|_mape)$&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb267-40"><a href="chm_sens_test.html#cb267-40" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_extract</span>(<span class="st">&quot;(paraboloid_volume|volume|area|height|diameter)&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb267-41"><a href="chm_sens_test.html#cb267-41" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">coalesce</span>(<span class="st">&quot;detection&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb267-42"><a href="chm_sens_test.html#cb267-42" tabindex="-1"></a>      <span class="fu">factor</span>(</span>
<span id="cb267-43"><a href="chm_sens_test.html#cb267-43" tabindex="-1"></a>        <span class="at">ordered =</span> T</span>
<span id="cb267-44"><a href="chm_sens_test.html#cb267-44" tabindex="-1"></a>        , <span class="at">levels =</span> <span class="fu">c</span>(</span>
<span id="cb267-45"><a href="chm_sens_test.html#cb267-45" tabindex="-1"></a>          <span class="st">&quot;detection&quot;</span></span>
<span id="cb267-46"><a href="chm_sens_test.html#cb267-46" tabindex="-1"></a>          , <span class="st">&quot;volume&quot;</span></span>
<span id="cb267-47"><a href="chm_sens_test.html#cb267-47" tabindex="-1"></a>          , <span class="st">&quot;paraboloid_volume&quot;</span></span>
<span id="cb267-48"><a href="chm_sens_test.html#cb267-48" tabindex="-1"></a>          , <span class="st">&quot;area&quot;</span></span>
<span id="cb267-49"><a href="chm_sens_test.html#cb267-49" tabindex="-1"></a>          , <span class="st">&quot;height&quot;</span></span>
<span id="cb267-50"><a href="chm_sens_test.html#cb267-50" tabindex="-1"></a>          , <span class="st">&quot;diameter&quot;</span></span>
<span id="cb267-51"><a href="chm_sens_test.html#cb267-51" tabindex="-1"></a>        )</span>
<span id="cb267-52"><a href="chm_sens_test.html#cb267-52" tabindex="-1"></a>        , <span class="at">labels =</span> <span class="fu">c</span>(</span>
<span id="cb267-53"><a href="chm_sens_test.html#cb267-53" tabindex="-1"></a>          <span class="st">&quot;Detection&quot;</span></span>
<span id="cb267-54"><a href="chm_sens_test.html#cb267-54" tabindex="-1"></a>          , <span class="st">&quot;Volume&quot;</span></span>
<span id="cb267-55"><a href="chm_sens_test.html#cb267-55" tabindex="-1"></a>          , <span class="st">&quot;Volume paraboloid&quot;</span></span>
<span id="cb267-56"><a href="chm_sens_test.html#cb267-56" tabindex="-1"></a>          , <span class="st">&quot;Area (m2)&quot;</span></span>
<span id="cb267-57"><a href="chm_sens_test.html#cb267-57" tabindex="-1"></a>          , <span class="st">&quot;Height (m)&quot;</span></span>
<span id="cb267-58"><a href="chm_sens_test.html#cb267-58" tabindex="-1"></a>          , <span class="st">&quot;Diameter (m)&quot;</span></span>
<span id="cb267-59"><a href="chm_sens_test.html#cb267-59" tabindex="-1"></a>        )</span>
<span id="cb267-60"><a href="chm_sens_test.html#cb267-60" tabindex="-1"></a>      )</span>
<span id="cb267-61"><a href="chm_sens_test.html#cb267-61" tabindex="-1"></a>    , <span class="at">value_lab =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb267-62"><a href="chm_sens_test.html#cb267-62" tabindex="-1"></a>        eval_metric <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;F-score&quot;</span>,<span class="st">&quot;Recall&quot;</span>,<span class="st">&quot;Precision&quot;</span>, <span class="st">&quot;RRMSE&quot;</span>, <span class="st">&quot;MAPE&quot;</span>) <span class="sc">~</span> scales<span class="sc">::</span><span class="fu">percent</span>(value,<span class="at">accuracy=</span><span class="fl">0.1</span>)</span>
<span id="cb267-63"><a href="chm_sens_test.html#cb267-63" tabindex="-1"></a>        , eval_metric <span class="sc">==</span> <span class="st">&quot;ME&quot;</span> <span class="sc">~</span> scales<span class="sc">::</span><span class="fu">comma</span>(value,<span class="at">accuracy=</span><span class="fl">0.01</span>)</span>
<span id="cb267-64"><a href="chm_sens_test.html#cb267-64" tabindex="-1"></a>        , T <span class="sc">~</span> scales<span class="sc">::</span><span class="fu">comma</span>(value,<span class="at">accuracy=</span><span class="fl">0.1</span>)</span>
<span id="cb267-65"><a href="chm_sens_test.html#cb267-65" tabindex="-1"></a>      )</span>
<span id="cb267-66"><a href="chm_sens_test.html#cb267-66" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb267-67"><a href="chm_sens_test.html#cb267-67" tabindex="-1"></a>  <span class="co"># make var for color</span></span>
<span id="cb267-68"><a href="chm_sens_test.html#cb267-68" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(chm_res_m,chm_res_m_desc, pile_metric, eval_metric) <span class="sc">%&gt;%</span> </span>
<span id="cb267-69"><a href="chm_sens_test.html#cb267-69" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb267-70"><a href="chm_sens_test.html#cb267-70" tabindex="-1"></a>    <span class="co"># for ME, color by abs...for f-score,recall,precision color by -value so that higher means better...</span></span>
<span id="cb267-71"><a href="chm_sens_test.html#cb267-71" tabindex="-1"></a>      <span class="co"># ...since higher means worse for quantification accuracy metrics</span></span>
<span id="cb267-72"><a href="chm_sens_test.html#cb267-72" tabindex="-1"></a>    <span class="at">value_dir =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb267-73"><a href="chm_sens_test.html#cb267-73" tabindex="-1"></a>      eval_metric <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;ME&quot;</span>) <span class="sc">~</span> <span class="fu">abs</span>(value)</span>
<span id="cb267-74"><a href="chm_sens_test.html#cb267-74" tabindex="-1"></a>      , eval_metric <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;F-score&quot;</span>,<span class="st">&quot;Recall&quot;</span>,<span class="st">&quot;Precision&quot;</span>) <span class="sc">~</span> <span class="sc">-</span>value</span>
<span id="cb267-75"><a href="chm_sens_test.html#cb267-75" tabindex="-1"></a>      , T <span class="sc">~</span> value</span>
<span id="cb267-76"><a href="chm_sens_test.html#cb267-76" tabindex="-1"></a>    )</span>
<span id="cb267-77"><a href="chm_sens_test.html#cb267-77" tabindex="-1"></a>    , <span class="at">value_z =</span> (value_dir<span class="sc">-</span><span class="fu">mean</span>(value_dir,<span class="at">na.rm=</span>T))<span class="sc">/</span><span class="fu">sd</span>(value_dir,<span class="at">na.rm=</span>T) <span class="co"># this is the key to the different colors within facets</span></span>
<span id="cb267-78"><a href="chm_sens_test.html#cb267-78" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb267-79"><a href="chm_sens_test.html#cb267-79" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb267-80"><a href="chm_sens_test.html#cb267-80" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span>eval_metric <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;RRMSE&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb267-81"><a href="chm_sens_test.html#cb267-81" tabindex="-1"></a>  <span class="co"># View()</span></span>
<span id="cb267-82"><a href="chm_sens_test.html#cb267-82" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> eval_metric, <span class="at">y =</span> chm_lab)) <span class="sc">+</span> </span>
<span id="cb267-83"><a href="chm_sens_test.html#cb267-83" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_tile</span>(</span>
<span id="cb267-84"><a href="chm_sens_test.html#cb267-84" tabindex="-1"></a>    <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">fill =</span> pile_metric, <span class="at">alpha =</span> <span class="sc">-</span>value_z)</span>
<span id="cb267-85"><a href="chm_sens_test.html#cb267-85" tabindex="-1"></a>    , <span class="at">color =</span> <span class="st">&quot;gray&quot;</span></span>
<span id="cb267-86"><a href="chm_sens_test.html#cb267-86" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb267-87"><a href="chm_sens_test.html#cb267-87" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_text</span>(</span>
<span id="cb267-88"><a href="chm_sens_test.html#cb267-88" tabindex="-1"></a>    <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">label =</span> value_lab, <span class="at">fontface =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb267-89"><a href="chm_sens_test.html#cb267-89" tabindex="-1"></a>    , <span class="at">color =</span> <span class="st">&quot;white&quot;</span></span>
<span id="cb267-90"><a href="chm_sens_test.html#cb267-90" tabindex="-1"></a>    , <span class="at">size =</span> <span class="dv">3</span></span>
<span id="cb267-91"><a href="chm_sens_test.html#cb267-91" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb267-92"><a href="chm_sens_test.html#cb267-92" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">facet_grid</span>(<span class="at">cols =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(pile_metric), <span class="at">rows =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(chm_res_m_desc), <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>) <span class="sc">+</span> </span>
<span id="cb267-93"><a href="chm_sens_test.html#cb267-93" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_x_discrete</span>(<span class="at">position =</span> <span class="st">&quot;top&quot;</span>) <span class="sc">+</span></span>
<span id="cb267-94"><a href="chm_sens_test.html#cb267-94" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;gray33&quot;</span>, harrypotter<span class="sc">::</span><span class="fu">hp</span>(<span class="at">n=</span><span class="dv">3</span>,<span class="at">option =</span> <span class="st">&quot;hermionegranger&quot;</span>) )) <span class="sc">+</span></span>
<span id="cb267-95"><a href="chm_sens_test.html#cb267-95" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_alpha_binned</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="fl">0.55</span>, <span class="dv">1</span>)) <span class="sc">+</span> <span class="co"># this is the key to the different colors within facets</span></span>
<span id="cb267-96"><a href="chm_sens_test.html#cb267-96" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb267-97"><a href="chm_sens_test.html#cb267-97" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb267-98"><a href="chm_sens_test.html#cb267-98" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;&quot;</span></span>
<span id="cb267-99"><a href="chm_sens_test.html#cb267-99" tabindex="-1"></a>    , <span class="at">y =</span> <span class="st">&quot;max_ht_m : max_area_m2 : convexity_pct : circle_fit_iou_pct : chm_res_m&quot;</span></span>
<span id="cb267-100"><a href="chm_sens_test.html#cb267-100" tabindex="-1"></a>    , <span class="at">subtitle =</span> <span class="fu">paste0</span>(</span>
<span id="cb267-101"><a href="chm_sens_test.html#cb267-101" tabindex="-1"></a>       <span class="st">&quot;Structural Data Only&quot;</span></span>
<span id="cb267-102"><a href="chm_sens_test.html#cb267-102" tabindex="-1"></a>       , <span class="st">&quot;</span><span class="sc">\n</span><span class="st">pile detection and form quantification accuracy metrics for the top parameter settings tested&quot;</span></span>
<span id="cb267-103"><a href="chm_sens_test.html#cb267-103" tabindex="-1"></a>       <span class="co"># , scales::percent(1-pct_rank_th_top,accuracy=1)</span></span>
<span id="cb267-104"><a href="chm_sens_test.html#cb267-104" tabindex="-1"></a>       , <span class="st">&quot; (n=&quot;</span></span>
<span id="cb267-105"><a href="chm_sens_test.html#cb267-105" tabindex="-1"></a>       , scales<span class="sc">::</span><span class="fu">comma</span>(n_th_top_chm,<span class="at">accuracy=</span><span class="dv">1</span>)</span>
<span id="cb267-106"><a href="chm_sens_test.html#cb267-106" tabindex="-1"></a>       , <span class="st">&quot;) by CHM resolution&quot;</span></span>
<span id="cb267-107"><a href="chm_sens_test.html#cb267-107" tabindex="-1"></a>       , <span class="st">&quot;</span><span class="sc">\n</span><span class="st">based on both detection and quantification accuracy&quot;</span></span>
<span id="cb267-108"><a href="chm_sens_test.html#cb267-108" tabindex="-1"></a>      )</span>
<span id="cb267-109"><a href="chm_sens_test.html#cb267-109" tabindex="-1"></a>    , <span class="at">caption =</span> <span class="st">&quot;*darker colors indicate relatively higher accuracy values&quot;</span></span>
<span id="cb267-110"><a href="chm_sens_test.html#cb267-110" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb267-111"><a href="chm_sens_test.html#cb267-111" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb267-112"><a href="chm_sens_test.html#cb267-112" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb267-113"><a href="chm_sens_test.html#cb267-113" tabindex="-1"></a>    , <span class="at">panel.grid =</span> ggplot2<span class="sc">::</span><span class="fu">element_blank</span>()</span>
<span id="cb267-114"><a href="chm_sens_test.html#cb267-114" tabindex="-1"></a>    , <span class="at">strip.placement =</span> <span class="st">&quot;outside&quot;</span></span>
<span id="cb267-115"><a href="chm_sens_test.html#cb267-115" tabindex="-1"></a>    , <span class="at">strip.text.x =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb267-116"><a href="chm_sens_test.html#cb267-116" tabindex="-1"></a>    , <span class="at">strip.text.y =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">9</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb267-117"><a href="chm_sens_test.html#cb267-117" tabindex="-1"></a>    , <span class="at">axis.text.x =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">7</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb267-118"><a href="chm_sens_test.html#cb267-118" tabindex="-1"></a>    , <span class="at">axis.text.y =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">7</span>)</span>
<span id="cb267-119"><a href="chm_sens_test.html#cb267-119" tabindex="-1"></a>    , <span class="at">axis.title.x =</span> ggplot2<span class="sc">::</span><span class="fu">element_blank</span>()</span>
<span id="cb267-120"><a href="chm_sens_test.html#cb267-120" tabindex="-1"></a>    , <span class="at">plot.subtitle =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>)</span>
<span id="cb267-121"><a href="chm_sens_test.html#cb267-121" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-238-1.png" width="1008" /></p>
<p>this plot allows for a simultaneous comparison of all metrics for pile detection and pile form quantification. it includes only the parameter combinations of those tested that achieved the best balanced accuracy, helping users identify the optimal settings by evaluating the trade-offs between detection and form quantification.</p>
<p>let’s table this</p>
<div class="sourceCode" id="cb268"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb268-1"><a href="chm_sens_test.html#cb268-1" tabindex="-1"></a>param_combos_ranked <span class="sc">%&gt;%</span> </span>
<span id="cb268-2"><a href="chm_sens_test.html#cb268-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(is_final_selection_chm) <span class="sc">%&gt;%</span> </span>
<span id="cb268-3"><a href="chm_sens_test.html#cb268-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">!</span>tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;_pct_rank_&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb268-4"><a href="chm_sens_test.html#cb268-4" tabindex="-1"></a>  <span class="co"># first select to arrange eval_metric</span></span>
<span id="cb268-5"><a href="chm_sens_test.html#cb268-5" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb268-6"><a href="chm_sens_test.html#cb268-6" tabindex="-1"></a>    chm_lab, chm_res_m_desc</span>
<span id="cb268-7"><a href="chm_sens_test.html#cb268-7" tabindex="-1"></a>    , max_ht_m,max_area_m2,convexity_pct,circle_fit_iou_pct,chm_res_m</span>
<span id="cb268-8"><a href="chm_sens_test.html#cb268-8" tabindex="-1"></a>    <span class="co"># detection</span></span>
<span id="cb268-9"><a href="chm_sens_test.html#cb268-9" tabindex="-1"></a>    , f_score, recall, precision</span>
<span id="cb268-10"><a href="chm_sens_test.html#cb268-10" tabindex="-1"></a>    <span class="co"># quantification</span></span>
<span id="cb268-11"><a href="chm_sens_test.html#cb268-11" tabindex="-1"></a>    , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_mean&quot;</span>)</span>
<span id="cb268-12"><a href="chm_sens_test.html#cb268-12" tabindex="-1"></a>    , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_rmse&quot;</span>)</span>
<span id="cb268-13"><a href="chm_sens_test.html#cb268-13" tabindex="-1"></a>    <span class="co"># , tidyselect::ends_with(&quot;_rrmse&quot;)</span></span>
<span id="cb268-14"><a href="chm_sens_test.html#cb268-14" tabindex="-1"></a>    , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_mape&quot;</span>)</span>
<span id="cb268-15"><a href="chm_sens_test.html#cb268-15" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb268-16"><a href="chm_sens_test.html#cb268-16" tabindex="-1"></a>  <span class="co"># second select to arrange pile_metric</span></span>
<span id="cb268-17"><a href="chm_sens_test.html#cb268-17" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb268-18"><a href="chm_sens_test.html#cb268-18" tabindex="-1"></a>    chm_lab, chm_res_m_desc</span>
<span id="cb268-19"><a href="chm_sens_test.html#cb268-19" tabindex="-1"></a>    , max_ht_m,max_area_m2,convexity_pct,circle_fit_iou_pct,chm_res_m</span>
<span id="cb268-20"><a href="chm_sens_test.html#cb268-20" tabindex="-1"></a>    <span class="co"># detection</span></span>
<span id="cb268-21"><a href="chm_sens_test.html#cb268-21" tabindex="-1"></a>    , f_score, recall, precision</span>
<span id="cb268-22"><a href="chm_sens_test.html#cb268-22" tabindex="-1"></a>    <span class="co"># quantification</span></span>
<span id="cb268-23"><a href="chm_sens_test.html#cb268-23" tabindex="-1"></a>    , <span class="fu">c</span>(tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;volume&quot;</span>) <span class="sc">&amp;</span> <span class="sc">!</span>tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;paraboloid&quot;</span>))</span>
<span id="cb268-24"><a href="chm_sens_test.html#cb268-24" tabindex="-1"></a>    , tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;area&quot;</span>)</span>
<span id="cb268-25"><a href="chm_sens_test.html#cb268-25" tabindex="-1"></a>    , tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;height&quot;</span>)</span>
<span id="cb268-26"><a href="chm_sens_test.html#cb268-26" tabindex="-1"></a>    , tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;diameter&quot;</span>)</span>
<span id="cb268-27"><a href="chm_sens_test.html#cb268-27" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb268-28"><a href="chm_sens_test.html#cb268-28" tabindex="-1"></a>  <span class="co"># names()</span></span>
<span id="cb268-29"><a href="chm_sens_test.html#cb268-29" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb268-30"><a href="chm_sens_test.html#cb268-30" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">across</span>(</span>
<span id="cb268-31"><a href="chm_sens_test.html#cb268-31" tabindex="-1"></a>      <span class="at">.cols =</span> <span class="fu">c</span>(f_score, recall, precision, tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_mape&quot;</span>))</span>
<span id="cb268-32"><a href="chm_sens_test.html#cb268-32" tabindex="-1"></a>      , <span class="at">.fn =</span> <span class="sc">~</span> scales<span class="sc">::</span><span class="fu">percent</span>(.x, <span class="at">accuracy =</span> <span class="dv">1</span>)</span>
<span id="cb268-33"><a href="chm_sens_test.html#cb268-33" tabindex="-1"></a>    )</span>
<span id="cb268-34"><a href="chm_sens_test.html#cb268-34" tabindex="-1"></a>    , dplyr<span class="sc">::</span><span class="fu">across</span>(</span>
<span id="cb268-35"><a href="chm_sens_test.html#cb268-35" tabindex="-1"></a>      <span class="at">.cols =</span> <span class="fu">c</span>(tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_mean&quot;</span>))</span>
<span id="cb268-36"><a href="chm_sens_test.html#cb268-36" tabindex="-1"></a>      , <span class="at">.fn =</span> <span class="sc">~</span> scales<span class="sc">::</span><span class="fu">comma</span>(.x, <span class="at">accuracy =</span> <span class="fl">0.01</span>)</span>
<span id="cb268-37"><a href="chm_sens_test.html#cb268-37" tabindex="-1"></a>    )</span>
<span id="cb268-38"><a href="chm_sens_test.html#cb268-38" tabindex="-1"></a>    , dplyr<span class="sc">::</span><span class="fu">across</span>(</span>
<span id="cb268-39"><a href="chm_sens_test.html#cb268-39" tabindex="-1"></a>      <span class="at">.cols =</span> <span class="fu">c</span>(tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_rmse&quot;</span>))</span>
<span id="cb268-40"><a href="chm_sens_test.html#cb268-40" tabindex="-1"></a>      , <span class="at">.fn =</span> <span class="sc">~</span> scales<span class="sc">::</span><span class="fu">comma</span>(.x, <span class="at">accuracy =</span> <span class="fl">0.1</span>)</span>
<span id="cb268-41"><a href="chm_sens_test.html#cb268-41" tabindex="-1"></a>    )</span>
<span id="cb268-42"><a href="chm_sens_test.html#cb268-42" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb268-43"><a href="chm_sens_test.html#cb268-43" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">blank=</span> <span class="st">&quot;   &quot;</span> ) <span class="sc">%&gt;%</span> </span>
<span id="cb268-44"><a href="chm_sens_test.html#cb268-44" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">relocate</span>(blank, <span class="at">.before =</span> f_score) <span class="sc">%&gt;%</span> </span>
<span id="cb268-45"><a href="chm_sens_test.html#cb268-45" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(chm_res_m, <span class="fu">desc</span>(chm_lab)) <span class="sc">%&gt;%</span> </span>
<span id="cb268-46"><a href="chm_sens_test.html#cb268-46" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>chm_res_m) <span class="sc">%&gt;%</span> </span>
<span id="cb268-47"><a href="chm_sens_test.html#cb268-47" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">relocate</span>(chm_res_m_desc) <span class="sc">%&gt;%</span> </span>
<span id="cb268-48"><a href="chm_sens_test.html#cb268-48" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kbl</span>(</span>
<span id="cb268-49"><a href="chm_sens_test.html#cb268-49" tabindex="-1"></a>    <span class="at">caption =</span> </span>
<span id="cb268-50"><a href="chm_sens_test.html#cb268-50" tabindex="-1"></a>      <span class="fu">paste0</span>(</span>
<span id="cb268-51"><a href="chm_sens_test.html#cb268-51" tabindex="-1"></a>       <span class="st">&quot;Structural Data Only&quot;</span></span>
<span id="cb268-52"><a href="chm_sens_test.html#cb268-52" tabindex="-1"></a>       , <span class="st">&quot;&lt;br&gt;pile detection and form quantification accuracy metrics for the top parameter settings tested&quot;</span></span>
<span id="cb268-53"><a href="chm_sens_test.html#cb268-53" tabindex="-1"></a>       <span class="co"># , scales::percent(1-pct_rank_th_top,accuracy=1)</span></span>
<span id="cb268-54"><a href="chm_sens_test.html#cb268-54" tabindex="-1"></a>       , <span class="st">&quot; (n=&quot;</span></span>
<span id="cb268-55"><a href="chm_sens_test.html#cb268-55" tabindex="-1"></a>       , scales<span class="sc">::</span><span class="fu">comma</span>(n_th_top_chm,<span class="at">accuracy=</span><span class="dv">1</span>)</span>
<span id="cb268-56"><a href="chm_sens_test.html#cb268-56" tabindex="-1"></a>       , <span class="st">&quot;) by CHM resolution &quot;</span></span>
<span id="cb268-57"><a href="chm_sens_test.html#cb268-57" tabindex="-1"></a>       , <span class="st">&quot;&lt;br&gt;based on both detection and quantification accuracy&quot;</span></span>
<span id="cb268-58"><a href="chm_sens_test.html#cb268-58" tabindex="-1"></a>      )</span>
<span id="cb268-59"><a href="chm_sens_test.html#cb268-59" tabindex="-1"></a>    , <span class="at">col.names =</span> <span class="fu">c</span>(</span>
<span id="cb268-60"><a href="chm_sens_test.html#cb268-60" tabindex="-1"></a>      <span class="st">&quot;.&quot;</span>, <span class="st">&quot;&quot;</span></span>
<span id="cb268-61"><a href="chm_sens_test.html#cb268-61" tabindex="-1"></a>      ,<span class="st">&quot;max_ht_m&quot;</span>,<span class="st">&quot;max_area_m2&quot;</span>,<span class="st">&quot;convexity_pct&quot;</span>,<span class="st">&quot;circle_fit_iou_pct&quot;</span></span>
<span id="cb268-62"><a href="chm_sens_test.html#cb268-62" tabindex="-1"></a>      , <span class="st">&quot;   &quot;</span></span>
<span id="cb268-63"><a href="chm_sens_test.html#cb268-63" tabindex="-1"></a>      , <span class="st">&quot;F-score&quot;</span>, <span class="st">&quot;Recall&quot;</span>, <span class="st">&quot;Precision&quot;</span></span>
<span id="cb268-64"><a href="chm_sens_test.html#cb268-64" tabindex="-1"></a>      , <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;ME&quot;</span>,<span class="st">&quot;RMSE&quot;</span>,<span class="st">&quot;MAPE&quot;</span>), <span class="at">times =</span> <span class="dv">3</span>)</span>
<span id="cb268-65"><a href="chm_sens_test.html#cb268-65" tabindex="-1"></a>    )</span>
<span id="cb268-66"><a href="chm_sens_test.html#cb268-66" tabindex="-1"></a>    , <span class="at">escape =</span> F</span>
<span id="cb268-67"><a href="chm_sens_test.html#cb268-67" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb268-68"><a href="chm_sens_test.html#cb268-68" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kable_styling</span>(<span class="at">font_size =</span> <span class="dv">11</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb268-69"><a href="chm_sens_test.html#cb268-69" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">add_header_above</span>(<span class="fu">c</span>(</span>
<span id="cb268-70"><a href="chm_sens_test.html#cb268-70" tabindex="-1"></a>    <span class="st">&quot; &quot;</span><span class="ot">=</span><span class="dv">7</span></span>
<span id="cb268-71"><a href="chm_sens_test.html#cb268-71" tabindex="-1"></a>    , <span class="st">&quot;Detection&quot;</span> <span class="ot">=</span> <span class="dv">3</span></span>
<span id="cb268-72"><a href="chm_sens_test.html#cb268-72" tabindex="-1"></a>    <span class="co"># , &quot;Volume&quot; = 3</span></span>
<span id="cb268-73"><a href="chm_sens_test.html#cb268-73" tabindex="-1"></a>    , <span class="st">&quot;Area&quot;</span> <span class="ot">=</span> <span class="dv">3</span></span>
<span id="cb268-74"><a href="chm_sens_test.html#cb268-74" tabindex="-1"></a>    , <span class="st">&quot;Height&quot;</span> <span class="ot">=</span> <span class="dv">3</span></span>
<span id="cb268-75"><a href="chm_sens_test.html#cb268-75" tabindex="-1"></a>    , <span class="st">&quot;Diameter&quot;</span> <span class="ot">=</span> <span class="dv">3</span></span>
<span id="cb268-76"><a href="chm_sens_test.html#cb268-76" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb268-77"><a href="chm_sens_test.html#cb268-77" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">column_spec</span>(<span class="fu">seq</span>(<span class="dv">7</span>,<span class="dv">19</span>,<span class="at">by=</span><span class="dv">3</span>), <span class="at">border_right =</span> <span class="cn">TRUE</span>, <span class="at">include_thead =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb268-78"><a href="chm_sens_test.html#cb268-78" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">column_spec</span>(</span>
<span id="cb268-79"><a href="chm_sens_test.html#cb268-79" tabindex="-1"></a>    <span class="at">column =</span> <span class="dv">7</span><span class="sc">:</span><span class="dv">19</span></span>
<span id="cb268-80"><a href="chm_sens_test.html#cb268-80" tabindex="-1"></a>    , <span class="at">extra_css =</span> <span class="st">&quot;font-size: 10px;&quot;</span></span>
<span id="cb268-81"><a href="chm_sens_test.html#cb268-81" tabindex="-1"></a>    , <span class="at">include_thead =</span> T</span>
<span id="cb268-82"><a href="chm_sens_test.html#cb268-82" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb268-83"><a href="chm_sens_test.html#cb268-83" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">collapse_rows</span>(<span class="at">columns =</span> <span class="dv">1</span>, <span class="at">valign =</span> <span class="st">&quot;top&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb268-84"><a href="chm_sens_test.html#cb268-84" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">scroll_box</span>(<span class="at">width =</span> <span class="st">&quot;740px&quot;</span>) </span></code></pre></div>
<div style="border: 1px solid #ddd; padding: 5px; overflow-x: scroll; width:740px; ">
<table class="table" style="font-size: 11px; margin-left: auto; margin-right: auto;">
<caption style="font-size: initial !important;">
<span id="tab:unnamed-chunk-240">Table 8.2: </span>Structural Data Only<br>pile detection and form quantification accuracy metrics for the top parameter settings tested (n=6) by CHM resolution <br>based on both detection and quantification accuracy
</caption>
<thead>
<tr>
<th style="empty-cells: hide;border-bottom:hidden;" colspan="7">
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="3">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Detection
</div>
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="3">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Area
</div>
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="3">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Height
</div>
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="3">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Diameter
</div>
</th>
</tr>
<tr>
<th style="text-align:left;">
.
</th>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
max_ht_m
</th>
<th style="text-align:right;">
max_area_m2
</th>
<th style="text-align:right;">
convexity_pct
</th>
<th style="text-align:right;">
circle_fit_iou_pct
</th>
<th style="text-align:left;border-right:1px solid;font-size: 10px;">
</th>
<th style="text-align:left;font-size: 10px;">
F-score
</th>
<th style="text-align:left;font-size: 10px;">
Recall
</th>
<th style="text-align:left;border-right:1px solid;font-size: 10px;">
Precision
</th>
<th style="text-align:left;font-size: 10px;">
ME
</th>
<th style="text-align:left;font-size: 10px;">
RMSE
</th>
<th style="text-align:left;border-right:1px solid;font-size: 10px;">
MAPE
</th>
<th style="text-align:left;font-size: 10px;">
ME
</th>
<th style="text-align:left;font-size: 10px;">
RMSE
</th>
<th style="text-align:left;border-right:1px solid;font-size: 10px;">
MAPE
</th>
<th style="text-align:left;font-size: 10px;">
ME
</th>
<th style="text-align:left;font-size: 10px;">
RMSE
</th>
<th style="text-align:left;border-right:1px solid;font-size: 10px;">
MAPE
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="6">
0.1m CHM
</td>
<td style="text-align:left;">
2:10:0.8:0.05:0.1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
0.80
</td>
<td style="text-align:right;">
0.05
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
79%
</td>
<td style="text-align:left;font-size: 10px;">
78%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
80%
</td>
<td style="text-align:left;font-size: 10px;">
-0.50
</td>
<td style="text-align:left;font-size: 10px;">
1.0
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
11%
</td>
<td style="text-align:left;font-size: 10px;">
-0.20
</td>
<td style="text-align:left;font-size: 10px;">
0.3
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
13%
</td>
<td style="text-align:left;font-size: 10px;">
0.17
</td>
<td style="text-align:left;font-size: 10px;">
0.4
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
10%
</td>
</tr>
<tr>
<td style="text-align:left;">
3:10:0.8:0.35:0.1
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
0.80
</td>
<td style="text-align:right;">
0.35
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
77%
</td>
<td style="text-align:left;font-size: 10px;">
79%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
75%
</td>
<td style="text-align:left;font-size: 10px;">
-0.46
</td>
<td style="text-align:left;font-size: 10px;">
0.9
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
11%
</td>
<td style="text-align:left;font-size: 10px;">
-0.02
</td>
<td style="text-align:left;font-size: 10px;">
0.4
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
17%
</td>
<td style="text-align:left;font-size: 10px;">
0.17
</td>
<td style="text-align:left;font-size: 10px;">
0.4
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
10%
</td>
</tr>
<tr>
<td style="text-align:left;">
5:60:0.8:0.65:0.1
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
60
</td>
<td style="text-align:right;">
0.80
</td>
<td style="text-align:right;">
0.65
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
76%
</td>
<td style="text-align:left;font-size: 10px;">
90%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
66%
</td>
<td style="text-align:left;font-size: 10px;">
-0.80
</td>
<td style="text-align:left;font-size: 10px;">
2.1
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
10%
</td>
<td style="text-align:left;font-size: 10px;">
-0.10
</td>
<td style="text-align:left;font-size: 10px;">
0.6
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
18%
</td>
<td style="text-align:left;font-size: 10px;">
0.21
</td>
<td style="text-align:left;font-size: 10px;">
0.5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
10%
</td>
</tr>
<tr>
<td style="text-align:left;">
5:50:0.8:0.65:0.1
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
50
</td>
<td style="text-align:right;">
0.80
</td>
<td style="text-align:right;">
0.65
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
76%
</td>
<td style="text-align:left;font-size: 10px;">
90%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
66%
</td>
<td style="text-align:left;font-size: 10px;">
-0.80
</td>
<td style="text-align:left;font-size: 10px;">
2.1
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
10%
</td>
<td style="text-align:left;font-size: 10px;">
-0.10
</td>
<td style="text-align:left;font-size: 10px;">
0.6
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
18%
</td>
<td style="text-align:left;font-size: 10px;">
0.21
</td>
<td style="text-align:left;font-size: 10px;">
0.5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
10%
</td>
</tr>
<tr>
<td style="text-align:left;">
5:40:0.8:0.65:0.1
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
40
</td>
<td style="text-align:right;">
0.80
</td>
<td style="text-align:right;">
0.65
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
75%
</td>
<td style="text-align:left;font-size: 10px;">
88%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
66%
</td>
<td style="text-align:left;font-size: 10px;">
-0.63
</td>
<td style="text-align:left;font-size: 10px;">
1.7
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
10%
</td>
<td style="text-align:left;font-size: 10px;">
-0.05
</td>
<td style="text-align:left;font-size: 10px;">
0.6
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
18%
</td>
<td style="text-align:left;font-size: 10px;">
0.21
</td>
<td style="text-align:left;font-size: 10px;">
0.5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
10%
</td>
</tr>
<tr>
<td style="text-align:left;">
3:10:0.8:0.5:0.1
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
0.80
</td>
<td style="text-align:right;">
0.50
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
77%
</td>
<td style="text-align:left;font-size: 10px;">
77%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
78%
</td>
<td style="text-align:left;font-size: 10px;">
-0.46
</td>
<td style="text-align:left;font-size: 10px;">
0.9
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
11%
</td>
<td style="text-align:left;font-size: 10px;">
-0.02
</td>
<td style="text-align:left;font-size: 10px;">
0.4
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
17%
</td>
<td style="text-align:left;font-size: 10px;">
0.17
</td>
<td style="text-align:left;font-size: 10px;">
0.4
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
10%
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="6">
0.2m CHM
</td>
<td style="text-align:left;">
2:10:0.8:0.05:0.2
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
0.80
</td>
<td style="text-align:right;">
0.05
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
70%
</td>
<td style="text-align:left;font-size: 10px;">
74%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
66%
</td>
<td style="text-align:left;font-size: 10px;">
0.53
</td>
<td style="text-align:left;font-size: 10px;">
1.0
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
12%
</td>
<td style="text-align:left;font-size: 10px;">
-0.22
</td>
<td style="text-align:left;font-size: 10px;">
0.3
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
13%
</td>
<td style="text-align:left;font-size: 10px;">
0.43
</td>
<td style="text-align:left;font-size: 10px;">
0.6
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
16%
</td>
</tr>
<tr>
<td style="text-align:left;">
2:10:0.8:0.2:0.2
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
0.80
</td>
<td style="text-align:right;">
0.20
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
68%
</td>
<td style="text-align:left;font-size: 10px;">
69%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
67%
</td>
<td style="text-align:left;font-size: 10px;">
0.52
</td>
<td style="text-align:left;font-size: 10px;">
1.0
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
12%
</td>
<td style="text-align:left;font-size: 10px;">
-0.23
</td>
<td style="text-align:left;font-size: 10px;">
0.3
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
14%
</td>
<td style="text-align:left;font-size: 10px;">
0.42
</td>
<td style="text-align:left;font-size: 10px;">
0.6
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
16%
</td>
</tr>
<tr>
<td style="text-align:left;">
3:10:0.8:0.65:0.2
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
0.80
</td>
<td style="text-align:right;">
0.65
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
73%
</td>
<td style="text-align:left;font-size: 10px;">
68%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
80%
</td>
<td style="text-align:left;font-size: 10px;">
0.62
</td>
<td style="text-align:left;font-size: 10px;">
1.0
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
13%
</td>
<td style="text-align:left;font-size: 10px;">
0.00
</td>
<td style="text-align:left;font-size: 10px;">
0.4
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
17%
</td>
<td style="text-align:left;font-size: 10px;">
0.46
</td>
<td style="text-align:left;font-size: 10px;">
0.6
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
17%
</td>
</tr>
<tr>
<td style="text-align:left;">
3:10:0.35:0.65:0.2
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
0.35
</td>
<td style="text-align:right;">
0.65
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
73%
</td>
<td style="text-align:left;font-size: 10px;">
68%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
79%
</td>
<td style="text-align:left;font-size: 10px;">
0.62
</td>
<td style="text-align:left;font-size: 10px;">
1.0
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
13%
</td>
<td style="text-align:left;font-size: 10px;">
0.00
</td>
<td style="text-align:left;font-size: 10px;">
0.4
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
17%
</td>
<td style="text-align:left;font-size: 10px;">
0.46
</td>
<td style="text-align:left;font-size: 10px;">
0.6
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
17%
</td>
</tr>
<tr>
<td style="text-align:left;">
3:10:0.2:0.65:0.2
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
0.20
</td>
<td style="text-align:right;">
0.65
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
73%
</td>
<td style="text-align:left;font-size: 10px;">
68%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
79%
</td>
<td style="text-align:left;font-size: 10px;">
0.62
</td>
<td style="text-align:left;font-size: 10px;">
1.0
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
13%
</td>
<td style="text-align:left;font-size: 10px;">
0.00
</td>
<td style="text-align:left;font-size: 10px;">
0.4
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
17%
</td>
<td style="text-align:left;font-size: 10px;">
0.46
</td>
<td style="text-align:left;font-size: 10px;">
0.6
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
17%
</td>
</tr>
<tr>
<td style="text-align:left;">
3:10:0.05:0.65:0.2
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
0.05
</td>
<td style="text-align:right;">
0.65
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
73%
</td>
<td style="text-align:left;font-size: 10px;">
68%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
79%
</td>
<td style="text-align:left;font-size: 10px;">
0.62
</td>
<td style="text-align:left;font-size: 10px;">
1.0
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
13%
</td>
<td style="text-align:left;font-size: 10px;">
0.00
</td>
<td style="text-align:left;font-size: 10px;">
0.4
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
17%
</td>
<td style="text-align:left;font-size: 10px;">
0.46
</td>
<td style="text-align:left;font-size: 10px;">
0.6
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
17%
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="6">
0.3m CHM
</td>
<td style="text-align:left;">
3:10:0.8:0.65:0.3
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
0.80
</td>
<td style="text-align:right;">
0.65
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
65%
</td>
<td style="text-align:left;font-size: 10px;">
67%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
63%
</td>
<td style="text-align:left;font-size: 10px;">
1.40
</td>
<td style="text-align:left;font-size: 10px;">
1.7
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
23%
</td>
<td style="text-align:left;font-size: 10px;">
-0.02
</td>
<td style="text-align:left;font-size: 10px;">
0.4
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
16%
</td>
<td style="text-align:left;font-size: 10px;">
0.64
</td>
<td style="text-align:left;font-size: 10px;">
0.7
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
23%
</td>
</tr>
<tr>
<td style="text-align:left;">
3:10:0.65:0.65:0.3
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
0.65
</td>
<td style="text-align:right;">
0.65
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
65%
</td>
<td style="text-align:left;font-size: 10px;">
67%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
62%
</td>
<td style="text-align:left;font-size: 10px;">
1.40
</td>
<td style="text-align:left;font-size: 10px;">
1.7
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
23%
</td>
<td style="text-align:left;font-size: 10px;">
-0.02
</td>
<td style="text-align:left;font-size: 10px;">
0.4
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
16%
</td>
<td style="text-align:left;font-size: 10px;">
0.64
</td>
<td style="text-align:left;font-size: 10px;">
0.7
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
23%
</td>
</tr>
<tr>
<td style="text-align:left;">
3:10:0.5:0.65:0.3
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
0.50
</td>
<td style="text-align:right;">
0.65
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
65%
</td>
<td style="text-align:left;font-size: 10px;">
67%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
62%
</td>
<td style="text-align:left;font-size: 10px;">
1.40
</td>
<td style="text-align:left;font-size: 10px;">
1.7
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
23%
</td>
<td style="text-align:left;font-size: 10px;">
-0.02
</td>
<td style="text-align:left;font-size: 10px;">
0.4
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
16%
</td>
<td style="text-align:left;font-size: 10px;">
0.64
</td>
<td style="text-align:left;font-size: 10px;">
0.7
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
23%
</td>
</tr>
<tr>
<td style="text-align:left;">
3:10:0.35:0.65:0.3
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
0.35
</td>
<td style="text-align:right;">
0.65
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
65%
</td>
<td style="text-align:left;font-size: 10px;">
67%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
62%
</td>
<td style="text-align:left;font-size: 10px;">
1.40
</td>
<td style="text-align:left;font-size: 10px;">
1.7
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
23%
</td>
<td style="text-align:left;font-size: 10px;">
-0.02
</td>
<td style="text-align:left;font-size: 10px;">
0.4
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
16%
</td>
<td style="text-align:left;font-size: 10px;">
0.64
</td>
<td style="text-align:left;font-size: 10px;">
0.7
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
23%
</td>
</tr>
<tr>
<td style="text-align:left;">
3:10:0.2:0.65:0.3
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
0.20
</td>
<td style="text-align:right;">
0.65
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
65%
</td>
<td style="text-align:left;font-size: 10px;">
67%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
62%
</td>
<td style="text-align:left;font-size: 10px;">
1.40
</td>
<td style="text-align:left;font-size: 10px;">
1.7
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
23%
</td>
<td style="text-align:left;font-size: 10px;">
-0.02
</td>
<td style="text-align:left;font-size: 10px;">
0.4
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
16%
</td>
<td style="text-align:left;font-size: 10px;">
0.64
</td>
<td style="text-align:left;font-size: 10px;">
0.7
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
23%
</td>
</tr>
<tr>
<td style="text-align:left;">
3:10:0.05:0.65:0.3
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
0.05
</td>
<td style="text-align:right;">
0.65
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
65%
</td>
<td style="text-align:left;font-size: 10px;">
67%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
62%
</td>
<td style="text-align:left;font-size: 10px;">
1.40
</td>
<td style="text-align:left;font-size: 10px;">
1.7
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
23%
</td>
<td style="text-align:left;font-size: 10px;">
-0.02
</td>
<td style="text-align:left;font-size: 10px;">
0.4
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
16%
</td>
<td style="text-align:left;font-size: 10px;">
0.64
</td>
<td style="text-align:left;font-size: 10px;">
0.7
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
23%
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="6">
0.4m CHM
</td>
<td style="text-align:left;">
2:20:0.8:0.05:0.4
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
20
</td>
<td style="text-align:right;">
0.80
</td>
<td style="text-align:right;">
0.05
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
55%
</td>
<td style="text-align:left;font-size: 10px;">
79%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
42%
</td>
<td style="text-align:left;font-size: 10px;">
2.43
</td>
<td style="text-align:left;font-size: 10px;">
3.1
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
37%
</td>
<td style="text-align:left;font-size: 10px;">
-0.24
</td>
<td style="text-align:left;font-size: 10px;">
0.4
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
14%
</td>
<td style="text-align:left;font-size: 10px;">
1.02
</td>
<td style="text-align:left;font-size: 10px;">
1.1
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
34%
</td>
</tr>
<tr>
<td style="text-align:left;">
2:60:0.8:0.05:0.4
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
60
</td>
<td style="text-align:right;">
0.80
</td>
<td style="text-align:right;">
0.05
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
56%
</td>
<td style="text-align:left;font-size: 10px;">
81%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
42%
</td>
<td style="text-align:left;font-size: 10px;">
2.48
</td>
<td style="text-align:left;font-size: 10px;">
3.1
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
37%
</td>
<td style="text-align:left;font-size: 10px;">
-0.29
</td>
<td style="text-align:left;font-size: 10px;">
0.5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
15%
</td>
<td style="text-align:left;font-size: 10px;">
1.01
</td>
<td style="text-align:left;font-size: 10px;">
1.1
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
34%
</td>
</tr>
<tr>
<td style="text-align:left;">
2:50:0.8:0.05:0.4
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
50
</td>
<td style="text-align:right;">
0.80
</td>
<td style="text-align:right;">
0.05
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
56%
</td>
<td style="text-align:left;font-size: 10px;">
81%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
42%
</td>
<td style="text-align:left;font-size: 10px;">
2.48
</td>
<td style="text-align:left;font-size: 10px;">
3.1
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
37%
</td>
<td style="text-align:left;font-size: 10px;">
-0.29
</td>
<td style="text-align:left;font-size: 10px;">
0.5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
15%
</td>
<td style="text-align:left;font-size: 10px;">
1.01
</td>
<td style="text-align:left;font-size: 10px;">
1.1
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
34%
</td>
</tr>
<tr>
<td style="text-align:left;">
2:40:0.8:0.05:0.4
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
40
</td>
<td style="text-align:right;">
0.80
</td>
<td style="text-align:right;">
0.05
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
56%
</td>
<td style="text-align:left;font-size: 10px;">
81%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
42%
</td>
<td style="text-align:left;font-size: 10px;">
2.48
</td>
<td style="text-align:left;font-size: 10px;">
3.1
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
37%
</td>
<td style="text-align:left;font-size: 10px;">
-0.29
</td>
<td style="text-align:left;font-size: 10px;">
0.5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
15%
</td>
<td style="text-align:left;font-size: 10px;">
1.01
</td>
<td style="text-align:left;font-size: 10px;">
1.1
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
34%
</td>
</tr>
<tr>
<td style="text-align:left;">
2:30:0.8:0.05:0.4
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
30
</td>
<td style="text-align:right;">
0.80
</td>
<td style="text-align:right;">
0.05
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
56%
</td>
<td style="text-align:left;font-size: 10px;">
81%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
42%
</td>
<td style="text-align:left;font-size: 10px;">
2.48
</td>
<td style="text-align:left;font-size: 10px;">
3.1
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
37%
</td>
<td style="text-align:left;font-size: 10px;">
-0.29
</td>
<td style="text-align:left;font-size: 10px;">
0.5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
15%
</td>
<td style="text-align:left;font-size: 10px;">
1.01
</td>
<td style="text-align:left;font-size: 10px;">
1.1
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
34%
</td>
</tr>
<tr>
<td style="text-align:left;">
2:30:0.8:0.2:0.4
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
30
</td>
<td style="text-align:right;">
0.80
</td>
<td style="text-align:right;">
0.20
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
54%
</td>
<td style="text-align:left;font-size: 10px;">
75%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
42%
</td>
<td style="text-align:left;font-size: 10px;">
2.50
</td>
<td style="text-align:left;font-size: 10px;">
3.2
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
37%
</td>
<td style="text-align:left;font-size: 10px;">
-0.31
</td>
<td style="text-align:left;font-size: 10px;">
0.5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
15%
</td>
<td style="text-align:left;font-size: 10px;">
1.01
</td>
<td style="text-align:left;font-size: 10px;">
1.1
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
34%
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="6">
0.5m CHM
</td>
<td style="text-align:left;">
2:60:0.8:0.65:0.5
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
60
</td>
<td style="text-align:right;">
0.80
</td>
<td style="text-align:right;">
0.65
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
42%
</td>
<td style="text-align:left;font-size: 10px;">
34%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
54%
</td>
<td style="text-align:left;font-size: 10px;">
3.33
</td>
<td style="text-align:left;font-size: 10px;">
4.0
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
49%
</td>
<td style="text-align:left;font-size: 10px;">
-0.34
</td>
<td style="text-align:left;font-size: 10px;">
0.6
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
17%
</td>
<td style="text-align:left;font-size: 10px;">
1.20
</td>
<td style="text-align:left;font-size: 10px;">
1.3
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
39%
</td>
</tr>
<tr>
<td style="text-align:left;">
2:50:0.8:0.65:0.5
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
50
</td>
<td style="text-align:right;">
0.80
</td>
<td style="text-align:right;">
0.65
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
42%
</td>
<td style="text-align:left;font-size: 10px;">
34%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
54%
</td>
<td style="text-align:left;font-size: 10px;">
3.33
</td>
<td style="text-align:left;font-size: 10px;">
4.0
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
49%
</td>
<td style="text-align:left;font-size: 10px;">
-0.34
</td>
<td style="text-align:left;font-size: 10px;">
0.6
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
17%
</td>
<td style="text-align:left;font-size: 10px;">
1.20
</td>
<td style="text-align:left;font-size: 10px;">
1.3
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
39%
</td>
</tr>
<tr>
<td style="text-align:left;">
2:40:0.8:0.65:0.5
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
40
</td>
<td style="text-align:right;">
0.80
</td>
<td style="text-align:right;">
0.65
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
42%
</td>
<td style="text-align:left;font-size: 10px;">
34%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
54%
</td>
<td style="text-align:left;font-size: 10px;">
3.33
</td>
<td style="text-align:left;font-size: 10px;">
4.0
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
49%
</td>
<td style="text-align:left;font-size: 10px;">
-0.34
</td>
<td style="text-align:left;font-size: 10px;">
0.6
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
17%
</td>
<td style="text-align:left;font-size: 10px;">
1.20
</td>
<td style="text-align:left;font-size: 10px;">
1.3
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
39%
</td>
</tr>
<tr>
<td style="text-align:left;">
2:30:0.8:0.65:0.5
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
30
</td>
<td style="text-align:right;">
0.80
</td>
<td style="text-align:right;">
0.65
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
42%
</td>
<td style="text-align:left;font-size: 10px;">
34%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
54%
</td>
<td style="text-align:left;font-size: 10px;">
3.33
</td>
<td style="text-align:left;font-size: 10px;">
4.0
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
49%
</td>
<td style="text-align:left;font-size: 10px;">
-0.34
</td>
<td style="text-align:left;font-size: 10px;">
0.6
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
17%
</td>
<td style="text-align:left;font-size: 10px;">
1.20
</td>
<td style="text-align:left;font-size: 10px;">
1.3
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
39%
</td>
</tr>
<tr>
<td style="text-align:left;">
2:30:0.2:0.65:0.5
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
30
</td>
<td style="text-align:right;">
0.20
</td>
<td style="text-align:right;">
0.65
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
41%
</td>
<td style="text-align:left;font-size: 10px;">
34%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
53%
</td>
<td style="text-align:left;font-size: 10px;">
3.33
</td>
<td style="text-align:left;font-size: 10px;">
4.0
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
49%
</td>
<td style="text-align:left;font-size: 10px;">
-0.34
</td>
<td style="text-align:left;font-size: 10px;">
0.6
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
17%
</td>
<td style="text-align:left;font-size: 10px;">
1.20
</td>
<td style="text-align:left;font-size: 10px;">
1.3
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
39%
</td>
</tr>
<tr>
<td style="text-align:left;">
2:30:0.05:0.65:0.5
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
30
</td>
<td style="text-align:right;">
0.05
</td>
<td style="text-align:right;">
0.65
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
41%
</td>
<td style="text-align:left;font-size: 10px;">
34%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
53%
</td>
<td style="text-align:left;font-size: 10px;">
3.33
</td>
<td style="text-align:left;font-size: 10px;">
4.0
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
49%
</td>
<td style="text-align:left;font-size: 10px;">
-0.34
</td>
<td style="text-align:left;font-size: 10px;">
0.6
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
17%
</td>
<td style="text-align:left;font-size: 10px;">
1.20
</td>
<td style="text-align:left;font-size: 10px;">
1.3
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
39%
</td>
</tr>
</tbody>
</table>
</div>
<p>what is the expected <em>detection</em> accuracy of the top 6 settings by CHM resolution?</p>
<div class="sourceCode" id="cb269"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb269-1"><a href="chm_sens_test.html#cb269-1" tabindex="-1"></a><span class="fu">plt_detection_dist2</span>(</span>
<span id="cb269-2"><a href="chm_sens_test.html#cb269-2" tabindex="-1"></a>  <span class="at">df =</span> param_combos_ranked <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(is_final_selection_chm) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">!</span>tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;_pct_rank_&quot;</span>))</span>
<span id="cb269-3"><a href="chm_sens_test.html#cb269-3" tabindex="-1"></a>  , <span class="fu">paste0</span>(</span>
<span id="cb269-4"><a href="chm_sens_test.html#cb269-4" tabindex="-1"></a>    <span class="st">&quot;Structural Data Only&quot;</span></span>
<span id="cb269-5"><a href="chm_sens_test.html#cb269-5" tabindex="-1"></a>    , <span class="st">&quot;</span><span class="sc">\n</span><span class="st">distribution of pile detection metrics for the top parameter settings tested&quot;</span></span>
<span id="cb269-6"><a href="chm_sens_test.html#cb269-6" tabindex="-1"></a>    , <span class="st">&quot; (n=&quot;</span></span>
<span id="cb269-7"><a href="chm_sens_test.html#cb269-7" tabindex="-1"></a>    , scales<span class="sc">::</span><span class="fu">comma</span>(n_th_top_chm,<span class="at">accuracy=</span><span class="dv">1</span>)</span>
<span id="cb269-8"><a href="chm_sens_test.html#cb269-8" tabindex="-1"></a>    , <span class="st">&quot;) by CHM resolution&quot;</span></span>
<span id="cb269-9"><a href="chm_sens_test.html#cb269-9" tabindex="-1"></a>    , <span class="st">&quot;</span><span class="sc">\n</span><span class="st">based on both detection and quantification accuracy&quot;</span></span>
<span id="cb269-10"><a href="chm_sens_test.html#cb269-10" tabindex="-1"></a>  )</span>
<span id="cb269-11"><a href="chm_sens_test.html#cb269-11" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-241-1.png" width="1008" /></p>
<p>what is the expected <em>MAPE</em> of the top 6 settings by CHM resolution?</p>
<div class="sourceCode" id="cb270"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb270-1"><a href="chm_sens_test.html#cb270-1" tabindex="-1"></a><span class="co"># plot it</span></span>
<span id="cb270-2"><a href="chm_sens_test.html#cb270-2" tabindex="-1"></a><span class="fu">plt_form_quantification_dist2</span>(</span>
<span id="cb270-3"><a href="chm_sens_test.html#cb270-3" tabindex="-1"></a>  <span class="at">df =</span> param_combos_ranked <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(is_final_selection_chm) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">!</span>tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;_pct_rank_&quot;</span>))</span>
<span id="cb270-4"><a href="chm_sens_test.html#cb270-4" tabindex="-1"></a>  , <span class="at">quant_metric =</span> <span class="st">&quot;mape&quot;</span></span>
<span id="cb270-5"><a href="chm_sens_test.html#cb270-5" tabindex="-1"></a>  , <span class="fu">paste0</span>(</span>
<span id="cb270-6"><a href="chm_sens_test.html#cb270-6" tabindex="-1"></a>    <span class="st">&quot;Structural Data Only&quot;</span></span>
<span id="cb270-7"><a href="chm_sens_test.html#cb270-7" tabindex="-1"></a>    , <span class="st">&quot;</span><span class="sc">\n</span><span class="st">distribution of pile form quantification metrics for the top parameter settings tested&quot;</span></span>
<span id="cb270-8"><a href="chm_sens_test.html#cb270-8" tabindex="-1"></a>    , <span class="st">&quot; (n=&quot;</span></span>
<span id="cb270-9"><a href="chm_sens_test.html#cb270-9" tabindex="-1"></a>    , scales<span class="sc">::</span><span class="fu">comma</span>(n_th_top_chm,<span class="at">accuracy=</span><span class="dv">1</span>)</span>
<span id="cb270-10"><a href="chm_sens_test.html#cb270-10" tabindex="-1"></a>    , <span class="st">&quot;) by CHM resolution&quot;</span></span>
<span id="cb270-11"><a href="chm_sens_test.html#cb270-11" tabindex="-1"></a>    , <span class="st">&quot;</span><span class="sc">\n</span><span class="st">based on both detection and quantification accuracy&quot;</span></span>
<span id="cb270-12"><a href="chm_sens_test.html#cb270-12" tabindex="-1"></a>  )</span>
<span id="cb270-13"><a href="chm_sens_test.html#cb270-13" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-242-1.png" width="1008" /></p>
<p>what is the expected <em>Mean Error (ME)</em> of the top 6 settings by CHM resolution?</p>
<div class="sourceCode" id="cb271"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb271-1"><a href="chm_sens_test.html#cb271-1" tabindex="-1"></a><span class="co"># plot it</span></span>
<span id="cb271-2"><a href="chm_sens_test.html#cb271-2" tabindex="-1"></a><span class="fu">plt_form_quantification_dist2</span>(</span>
<span id="cb271-3"><a href="chm_sens_test.html#cb271-3" tabindex="-1"></a>  <span class="at">df =</span> param_combos_ranked <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(is_final_selection_chm) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">!</span>tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;_pct_rank_&quot;</span>))</span>
<span id="cb271-4"><a href="chm_sens_test.html#cb271-4" tabindex="-1"></a>  , <span class="at">quant_metric =</span> <span class="st">&quot;mean&quot;</span></span>
<span id="cb271-5"><a href="chm_sens_test.html#cb271-5" tabindex="-1"></a>  , <span class="fu">paste0</span>(</span>
<span id="cb271-6"><a href="chm_sens_test.html#cb271-6" tabindex="-1"></a>    <span class="st">&quot;Structural Data Only&quot;</span></span>
<span id="cb271-7"><a href="chm_sens_test.html#cb271-7" tabindex="-1"></a>    , <span class="st">&quot;</span><span class="sc">\n</span><span class="st">distribution of pile form quantification metrics for the top parameter settings tested&quot;</span></span>
<span id="cb271-8"><a href="chm_sens_test.html#cb271-8" tabindex="-1"></a>    , <span class="st">&quot; (n=&quot;</span></span>
<span id="cb271-9"><a href="chm_sens_test.html#cb271-9" tabindex="-1"></a>    , scales<span class="sc">::</span><span class="fu">comma</span>(n_th_top_chm,<span class="at">accuracy=</span><span class="dv">1</span>)</span>
<span id="cb271-10"><a href="chm_sens_test.html#cb271-10" tabindex="-1"></a>    , <span class="st">&quot;) by CHM resolution&quot;</span></span>
<span id="cb271-11"><a href="chm_sens_test.html#cb271-11" tabindex="-1"></a>    , <span class="st">&quot;</span><span class="sc">\n</span><span class="st">based on both detection and quantification accuracy&quot;</span></span>
<span id="cb271-12"><a href="chm_sens_test.html#cb271-12" tabindex="-1"></a>  )</span>
<span id="cb271-13"><a href="chm_sens_test.html#cb271-13" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-243-1.png" width="1008" /></p>
<p>what is the expected <em>RMSE</em> of the top 6 settings by CHM resolution?</p>
<div class="sourceCode" id="cb272"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb272-1"><a href="chm_sens_test.html#cb272-1" tabindex="-1"></a><span class="co"># plot it</span></span>
<span id="cb272-2"><a href="chm_sens_test.html#cb272-2" tabindex="-1"></a><span class="fu">plt_form_quantification_dist2</span>(</span>
<span id="cb272-3"><a href="chm_sens_test.html#cb272-3" tabindex="-1"></a>  <span class="at">df =</span> param_combos_ranked <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(is_final_selection_chm) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">!</span>tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;_pct_rank_&quot;</span>))</span>
<span id="cb272-4"><a href="chm_sens_test.html#cb272-4" tabindex="-1"></a>  , <span class="at">quant_metric =</span> <span class="st">&quot;rmse&quot;</span></span>
<span id="cb272-5"><a href="chm_sens_test.html#cb272-5" tabindex="-1"></a>  , <span class="fu">paste0</span>(</span>
<span id="cb272-6"><a href="chm_sens_test.html#cb272-6" tabindex="-1"></a>    <span class="st">&quot;Structural Data Only&quot;</span></span>
<span id="cb272-7"><a href="chm_sens_test.html#cb272-7" tabindex="-1"></a>    , <span class="st">&quot;</span><span class="sc">\n</span><span class="st">distribution of pile form quantification metrics for the top parameter settings tested&quot;</span></span>
<span id="cb272-8"><a href="chm_sens_test.html#cb272-8" tabindex="-1"></a>    , <span class="st">&quot; (n=&quot;</span></span>
<span id="cb272-9"><a href="chm_sens_test.html#cb272-9" tabindex="-1"></a>    , scales<span class="sc">::</span><span class="fu">comma</span>(n_th_top_chm,<span class="at">accuracy=</span><span class="dv">1</span>)</span>
<span id="cb272-10"><a href="chm_sens_test.html#cb272-10" tabindex="-1"></a>    , <span class="st">&quot;) by CHM resolution&quot;</span></span>
<span id="cb272-11"><a href="chm_sens_test.html#cb272-11" tabindex="-1"></a>    , <span class="st">&quot;</span><span class="sc">\n</span><span class="st">based on both detection and quantification accuracy&quot;</span></span>
<span id="cb272-12"><a href="chm_sens_test.html#cb272-12" tabindex="-1"></a>  )</span>
<span id="cb272-13"><a href="chm_sens_test.html#cb272-13" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-244-1.png" width="1008" /></p>
</div>
</div>
</div>
</div>
<div id="data-fusion-sensitivity-testing" class="section level2 hasAnchor" number="8.6">
<h2><span class="header-section-number">8.6</span> Data Fusion: Sensitivity Testing<a href="chm_sens_test.html#data-fusion-sensitivity-testing" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>let’s look at the sensitivity testing results for the <a href="data_fusion.html#data_fusion">data fusion approach</a> approach that uses both a CHM generated from aerial point cloud data (for structural information) and RGB imagery</p>
<p>we tested a total of 7,056 combinations per CHM resolution and an overall total of 35,280 combinations</p>
<div id="main-effects-pile-detection" class="section level3 hasAnchor" number="8.6.1">
<h3><span class="header-section-number">8.6.1</span> Main Effects: pile detection<a href="chm_sens_test.html#main-effects-pile-detection" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>what is the detection accuracy across all parameter combinations tested for each CHM resolution?</p>
<div class="sourceCode" id="cb273"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb273-1"><a href="chm_sens_test.html#cb273-1" tabindex="-1"></a><span class="co"># plot it</span></span>
<span id="cb273-2"><a href="chm_sens_test.html#cb273-2" tabindex="-1"></a><span class="fu">plt_detection_dist2</span>(</span>
<span id="cb273-3"><a href="chm_sens_test.html#cb273-3" tabindex="-1"></a>  <span class="at">df =</span> param_combos_spectral_gt_agg</span>
<span id="cb273-4"><a href="chm_sens_test.html#cb273-4" tabindex="-1"></a>  , <span class="fu">paste0</span>(</span>
<span id="cb273-5"><a href="chm_sens_test.html#cb273-5" tabindex="-1"></a>     <span class="st">&quot;Data Fusion&quot;</span></span>
<span id="cb273-6"><a href="chm_sens_test.html#cb273-6" tabindex="-1"></a>      , <span class="st">&quot;</span><span class="sc">\n</span><span class="st">distribution of pile detection accuracy metrics for all&quot;</span></span>
<span id="cb273-7"><a href="chm_sens_test.html#cb273-7" tabindex="-1"></a>     , <span class="st">&quot; (n=&quot;</span></span>
<span id="cb273-8"><a href="chm_sens_test.html#cb273-8" tabindex="-1"></a>     , scales<span class="sc">::</span><span class="fu">comma</span>(n_combos_tested_spectral_chm, <span class="at">accuracy =</span> <span class="dv">1</span>)</span>
<span id="cb273-9"><a href="chm_sens_test.html#cb273-9" tabindex="-1"></a>     , <span class="st">&quot;) &quot;</span></span>
<span id="cb273-10"><a href="chm_sens_test.html#cb273-10" tabindex="-1"></a>     , <span class="st">&quot;parameter combinations tested by CHM resolution&quot;</span></span>
<span id="cb273-11"><a href="chm_sens_test.html#cb273-11" tabindex="-1"></a>    )</span>
<span id="cb273-12"><a href="chm_sens_test.html#cb273-12" tabindex="-1"></a>  , <span class="at">show_rug =</span> F</span>
<span id="cb273-13"><a href="chm_sens_test.html#cb273-13" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-246-1.png" width="1008" /></p>
<p>collapsing across all other parameters, what is the main effect of each individual parameter, including the <code>spectral_weight</code> parameter from the data fusion approach, or CHM resolution?</p>
<div class="sourceCode" id="cb274"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb274-1"><a href="chm_sens_test.html#cb274-1" tabindex="-1"></a>param_combos_spectral_gt_agg <span class="sc">%&gt;%</span> </span>
<span id="cb274-2"><a href="chm_sens_test.html#cb274-2" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(</span>
<span id="cb274-3"><a href="chm_sens_test.html#cb274-3" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">c</span>(precision,recall,f_score)</span>
<span id="cb274-4"><a href="chm_sens_test.html#cb274-4" tabindex="-1"></a>    , <span class="at">names_to =</span> <span class="st">&quot;metric&quot;</span></span>
<span id="cb274-5"><a href="chm_sens_test.html#cb274-5" tabindex="-1"></a>    , <span class="at">values_to =</span> <span class="st">&quot;value&quot;</span></span>
<span id="cb274-6"><a href="chm_sens_test.html#cb274-6" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb274-7"><a href="chm_sens_test.html#cb274-7" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(</span>
<span id="cb274-8"><a href="chm_sens_test.html#cb274-8" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">c</span>(max_ht_m,max_area_m2,convexity_pct,circle_fit_iou_pct,chm_res_m,spectral_weight)</span>
<span id="cb274-9"><a href="chm_sens_test.html#cb274-9" tabindex="-1"></a>    , <span class="at">names_to =</span> <span class="st">&quot;param&quot;</span></span>
<span id="cb274-10"><a href="chm_sens_test.html#cb274-10" tabindex="-1"></a>    , <span class="at">values_to =</span> <span class="st">&quot;param_value&quot;</span></span>
<span id="cb274-11"><a href="chm_sens_test.html#cb274-11" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb274-12"><a href="chm_sens_test.html#cb274-12" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(param, param_value, metric) <span class="sc">%&gt;%</span></span>
<span id="cb274-13"><a href="chm_sens_test.html#cb274-13" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(</span>
<span id="cb274-14"><a href="chm_sens_test.html#cb274-14" tabindex="-1"></a>    <span class="at">median =</span> <span class="fu">median</span>(value,<span class="at">na.rm=</span>T)</span>
<span id="cb274-15"><a href="chm_sens_test.html#cb274-15" tabindex="-1"></a>    , <span class="at">q25 =</span> stats<span class="sc">::</span><span class="fu">quantile</span>(value,<span class="at">na.rm=</span>T,<span class="at">probs =</span> <span class="fl">0.25</span>)</span>
<span id="cb274-16"><a href="chm_sens_test.html#cb274-16" tabindex="-1"></a>    , <span class="at">q75 =</span> stats<span class="sc">::</span><span class="fu">quantile</span>(value,<span class="at">na.rm=</span>T,<span class="at">probs =</span> <span class="fl">0.75</span>)</span>
<span id="cb274-17"><a href="chm_sens_test.html#cb274-17" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb274-18"><a href="chm_sens_test.html#cb274-18" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb274-19"><a href="chm_sens_test.html#cb274-19" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb274-20"><a href="chm_sens_test.html#cb274-20" tabindex="-1"></a>    <span class="at">param =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb274-21"><a href="chm_sens_test.html#cb274-21" tabindex="-1"></a>        param <span class="sc">==</span> <span class="st">&quot;spectral_weight&quot;</span> <span class="sc">~</span> <span class="dv">1</span></span>
<span id="cb274-22"><a href="chm_sens_test.html#cb274-22" tabindex="-1"></a>        , param <span class="sc">==</span> <span class="st">&quot;chm_res_m&quot;</span> <span class="sc">~</span> <span class="dv">2</span></span>
<span id="cb274-23"><a href="chm_sens_test.html#cb274-23" tabindex="-1"></a>        , param <span class="sc">==</span> <span class="st">&quot;max_ht_m&quot;</span> <span class="sc">~</span> <span class="dv">3</span></span>
<span id="cb274-24"><a href="chm_sens_test.html#cb274-24" tabindex="-1"></a>        , param <span class="sc">==</span> <span class="st">&quot;min_area_m2&quot;</span> <span class="sc">~</span> <span class="dv">4</span></span>
<span id="cb274-25"><a href="chm_sens_test.html#cb274-25" tabindex="-1"></a>        , param <span class="sc">==</span> <span class="st">&quot;max_area_m2&quot;</span> <span class="sc">~</span> <span class="dv">5</span></span>
<span id="cb274-26"><a href="chm_sens_test.html#cb274-26" tabindex="-1"></a>        , param <span class="sc">==</span> <span class="st">&quot;convexity_pct&quot;</span> <span class="sc">~</span> <span class="dv">6</span></span>
<span id="cb274-27"><a href="chm_sens_test.html#cb274-27" tabindex="-1"></a>        , param <span class="sc">==</span> <span class="st">&quot;circle_fit_iou_pct&quot;</span> <span class="sc">~</span> <span class="dv">7</span></span>
<span id="cb274-28"><a href="chm_sens_test.html#cb274-28" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span> </span>
<span id="cb274-29"><a href="chm_sens_test.html#cb274-29" tabindex="-1"></a>      <span class="fu">factor</span>(</span>
<span id="cb274-30"><a href="chm_sens_test.html#cb274-30" tabindex="-1"></a>        <span class="at">ordered =</span> T</span>
<span id="cb274-31"><a href="chm_sens_test.html#cb274-31" tabindex="-1"></a>        , <span class="at">levels =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">7</span></span>
<span id="cb274-32"><a href="chm_sens_test.html#cb274-32" tabindex="-1"></a>        , <span class="at">labels =</span> <span class="fu">c</span>(</span>
<span id="cb274-33"><a href="chm_sens_test.html#cb274-33" tabindex="-1"></a>          <span class="st">&quot;spectral_weight&quot;</span></span>
<span id="cb274-34"><a href="chm_sens_test.html#cb274-34" tabindex="-1"></a>          , <span class="st">&quot;CHM resolution (m)&quot;</span></span>
<span id="cb274-35"><a href="chm_sens_test.html#cb274-35" tabindex="-1"></a>          , <span class="st">&quot;max_ht_m&quot;</span></span>
<span id="cb274-36"><a href="chm_sens_test.html#cb274-36" tabindex="-1"></a>          , <span class="st">&quot;min_area_m2&quot;</span></span>
<span id="cb274-37"><a href="chm_sens_test.html#cb274-37" tabindex="-1"></a>          , <span class="st">&quot;max_area_m2&quot;</span></span>
<span id="cb274-38"><a href="chm_sens_test.html#cb274-38" tabindex="-1"></a>          , <span class="st">&quot;convexity_pct&quot;</span></span>
<span id="cb274-39"><a href="chm_sens_test.html#cb274-39" tabindex="-1"></a>          , <span class="st">&quot;circle_fit_iou_pct&quot;</span></span>
<span id="cb274-40"><a href="chm_sens_test.html#cb274-40" tabindex="-1"></a>        )</span>
<span id="cb274-41"><a href="chm_sens_test.html#cb274-41" tabindex="-1"></a>      )</span>
<span id="cb274-42"><a href="chm_sens_test.html#cb274-42" tabindex="-1"></a>    , <span class="at">metric =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb274-43"><a href="chm_sens_test.html#cb274-43" tabindex="-1"></a>        metric <span class="sc">==</span> <span class="st">&quot;f_score&quot;</span> <span class="sc">~</span> <span class="dv">1</span></span>
<span id="cb274-44"><a href="chm_sens_test.html#cb274-44" tabindex="-1"></a>        , metric <span class="sc">==</span> <span class="st">&quot;recall&quot;</span> <span class="sc">~</span> <span class="dv">2</span></span>
<span id="cb274-45"><a href="chm_sens_test.html#cb274-45" tabindex="-1"></a>        , metric <span class="sc">==</span> <span class="st">&quot;precision&quot;</span> <span class="sc">~</span> <span class="dv">3</span></span>
<span id="cb274-46"><a href="chm_sens_test.html#cb274-46" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span> </span>
<span id="cb274-47"><a href="chm_sens_test.html#cb274-47" tabindex="-1"></a>      <span class="fu">factor</span>(</span>
<span id="cb274-48"><a href="chm_sens_test.html#cb274-48" tabindex="-1"></a>        <span class="at">ordered =</span> T</span>
<span id="cb274-49"><a href="chm_sens_test.html#cb274-49" tabindex="-1"></a>        , <span class="at">levels =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span></span>
<span id="cb274-50"><a href="chm_sens_test.html#cb274-50" tabindex="-1"></a>        , <span class="at">labels =</span> <span class="fu">c</span>(</span>
<span id="cb274-51"><a href="chm_sens_test.html#cb274-51" tabindex="-1"></a>          <span class="st">&quot;F-score&quot;</span></span>
<span id="cb274-52"><a href="chm_sens_test.html#cb274-52" tabindex="-1"></a>          , <span class="st">&quot;Recall&quot;</span></span>
<span id="cb274-53"><a href="chm_sens_test.html#cb274-53" tabindex="-1"></a>          , <span class="st">&quot;Precision&quot;</span></span>
<span id="cb274-54"><a href="chm_sens_test.html#cb274-54" tabindex="-1"></a>        )</span>
<span id="cb274-55"><a href="chm_sens_test.html#cb274-55" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span> </span>
<span id="cb274-56"><a href="chm_sens_test.html#cb274-56" tabindex="-1"></a>      forcats<span class="sc">::</span><span class="fu">fct_rev</span>()</span>
<span id="cb274-57"><a href="chm_sens_test.html#cb274-57" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb274-58"><a href="chm_sens_test.html#cb274-58" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(</span>
<span id="cb274-59"><a href="chm_sens_test.html#cb274-59" tabindex="-1"></a>    <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">y =</span> median, <span class="at">x =</span> param_value, <span class="at">color =</span> metric, <span class="at">fill =</span> metric, <span class="at">group =</span> metric, <span class="at">shape =</span> metric)</span>
<span id="cb274-60"><a href="chm_sens_test.html#cb274-60" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb274-61"><a href="chm_sens_test.html#cb274-61" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_ribbon</span>(</span>
<span id="cb274-62"><a href="chm_sens_test.html#cb274-62" tabindex="-1"></a>    <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">ymin =</span> q25, <span class="at">ymax =</span> q75)</span>
<span id="cb274-63"><a href="chm_sens_test.html#cb274-63" tabindex="-1"></a>    , <span class="at">alpha =</span> <span class="fl">0.2</span>, <span class="at">color =</span> <span class="cn">NA</span></span>
<span id="cb274-64"><a href="chm_sens_test.html#cb274-64" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb274-65"><a href="chm_sens_test.html#cb274-65" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_line</span>(<span class="at">lwd =</span> <span class="fl">1.5</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb274-66"><a href="chm_sens_test.html#cb274-66" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb274-67"><a href="chm_sens_test.html#cb274-67" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">facet_wrap</span>(<span class="at">facets =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(param), <span class="at">scales =</span> <span class="st">&quot;free_x&quot;</span>) <span class="sc">+</span></span>
<span id="cb274-68"><a href="chm_sens_test.html#cb274-68" tabindex="-1"></a>  <span class="co"># ggplot2::scale_color_viridis_d(begin = 0.2, end = 0.8) +</span></span>
<span id="cb274-69"><a href="chm_sens_test.html#cb274-69" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">rev</span>(pal_eval_metric)) <span class="sc">+</span></span>
<span id="cb274-70"><a href="chm_sens_test.html#cb274-70" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">rev</span>(pal_eval_metric)) <span class="sc">+</span></span>
<span id="cb274-71"><a href="chm_sens_test.html#cb274-71" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">labels =</span> scales<span class="sc">::</span>percent, <span class="at">breaks =</span> scales<span class="sc">::</span><span class="fu">breaks_extended</span>(<span class="dv">10</span>)) <span class="sc">+</span></span>
<span id="cb274-72"><a href="chm_sens_test.html#cb274-72" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;&quot;</span>, <span class="at">y =</span> <span class="st">&quot;median value&quot;</span>, <span class="at">color =</span> <span class="st">&quot;&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;&quot;</span>) <span class="sc">+</span></span>
<span id="cb274-73"><a href="chm_sens_test.html#cb274-73" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb274-74"><a href="chm_sens_test.html#cb274-74" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb274-75"><a href="chm_sens_test.html#cb274-75" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;top&quot;</span></span>
<span id="cb274-76"><a href="chm_sens_test.html#cb274-76" tabindex="-1"></a>    , <span class="at">strip.text =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb274-77"><a href="chm_sens_test.html#cb274-77" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb274-78"><a href="chm_sens_test.html#cb274-78" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">guides</span>(</span>
<span id="cb274-79"><a href="chm_sens_test.html#cb274-79" tabindex="-1"></a>    <span class="at">color =</span> ggplot2<span class="sc">::</span><span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">shape =</span> <span class="dv">15</span>, <span class="at">linetype =</span> <span class="dv">0</span>, <span class="at">size =</span> <span class="dv">5</span>, <span class="at">alpha =</span> <span class="dv">1</span>))</span>
<span id="cb274-80"><a href="chm_sens_test.html#cb274-80" tabindex="-1"></a>    , <span class="at">shape =</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb274-81"><a href="chm_sens_test.html#cb274-81" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-247-1.png" width="1008" /></p>
<p>based on these main effect aggregated results, the influence of the parameters specific to the structural detection of slash piles remained the same as when tested without the spectral data. with respect to the <code>spectral_weight</code> parameter included in the data fusion approach:</p>
<ul>
<li>increasing the <code>spectral_weight</code> (where “5” requires all spectral index thresholds to be met) had minimal impact on metrics until a value of “3”, at which point F-score and precision both saw slight improvements. at a <code>spectral_weight</code> of “4”, the F-score significantly improved due to a substantial increase in precision. setting <code>spectral_weight</code> to “5” resulted in a slight drop in recall (detection rate) and a proportionally inverse increase in precision, leading to an additional increase in F-score.</li>
</ul>
</div>
<div id="main-effects-form-quantification" class="section level3 hasAnchor" number="8.6.2">
<h3><span class="header-section-number">8.6.2</span> Main Effects: form quantification<a href="chm_sens_test.html#main-effects-form-quantification" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>let’s check out the the ability of the method to properly extract the form of the piles by looking at the quantification accuracy metrics where:</p>
<ul>
<li><strong>Mean Error (ME)</strong> represents the direction of bias (over or under-prediction) in the original units</li>
<li><strong>RMSE</strong> represents the typical magnitude of error in the original units, with a stronger penalty for large errors</li>
<li><strong>MAPE</strong> represents the typical magnitude of error as a percentage, allowing for scale-independent comparisons</li>
</ul>
<p>we expect that the spectral data does not alter the quantification of slash pile form. this is because spectral information is used solely to filter candidate piles, meaning it neither reshapes existing ones nor introduces new detections.</p>
<p>let’s average across all other factors to look at the main effect by parameter for the <strong>MAPE</strong> metrics quantifying the pile form accuracy</p>
<div class="sourceCode" id="cb275"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb275-1"><a href="chm_sens_test.html#cb275-1" tabindex="-1"></a>param_combos_spectral_gt_agg <span class="sc">%&gt;%</span> </span>
<span id="cb275-2"><a href="chm_sens_test.html#cb275-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb275-3"><a href="chm_sens_test.html#cb275-3" tabindex="-1"></a>    spectral_weight</span>
<span id="cb275-4"><a href="chm_sens_test.html#cb275-4" tabindex="-1"></a>    , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_mape&quot;</span>)</span>
<span id="cb275-5"><a href="chm_sens_test.html#cb275-5" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb275-6"><a href="chm_sens_test.html#cb275-6" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(</span>
<span id="cb275-7"><a href="chm_sens_test.html#cb275-7" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">c</span>(tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_mape&quot;</span>))</span>
<span id="cb275-8"><a href="chm_sens_test.html#cb275-8" tabindex="-1"></a>    , <span class="at">names_to =</span> <span class="st">&quot;metric&quot;</span></span>
<span id="cb275-9"><a href="chm_sens_test.html#cb275-9" tabindex="-1"></a>    , <span class="at">values_to =</span> <span class="st">&quot;value&quot;</span></span>
<span id="cb275-10"><a href="chm_sens_test.html#cb275-10" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb275-11"><a href="chm_sens_test.html#cb275-11" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(</span>
<span id="cb275-12"><a href="chm_sens_test.html#cb275-12" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">c</span>(spectral_weight)</span>
<span id="cb275-13"><a href="chm_sens_test.html#cb275-13" tabindex="-1"></a>    , <span class="at">names_to =</span> <span class="st">&quot;param&quot;</span></span>
<span id="cb275-14"><a href="chm_sens_test.html#cb275-14" tabindex="-1"></a>    , <span class="at">values_to =</span> <span class="st">&quot;param_value&quot;</span></span>
<span id="cb275-15"><a href="chm_sens_test.html#cb275-15" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb275-16"><a href="chm_sens_test.html#cb275-16" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(param, param_value, metric) <span class="sc">%&gt;%</span></span>
<span id="cb275-17"><a href="chm_sens_test.html#cb275-17" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(</span>
<span id="cb275-18"><a href="chm_sens_test.html#cb275-18" tabindex="-1"></a>    <span class="at">median =</span> <span class="fu">median</span>(value,<span class="at">na.rm=</span>T)</span>
<span id="cb275-19"><a href="chm_sens_test.html#cb275-19" tabindex="-1"></a>    , <span class="at">q25 =</span> stats<span class="sc">::</span><span class="fu">quantile</span>(value,<span class="at">na.rm=</span>T,<span class="at">probs =</span> <span class="fl">0.25</span>)</span>
<span id="cb275-20"><a href="chm_sens_test.html#cb275-20" tabindex="-1"></a>    , <span class="at">q75 =</span> stats<span class="sc">::</span><span class="fu">quantile</span>(value,<span class="at">na.rm=</span>T,<span class="at">probs =</span> <span class="fl">0.75</span>)</span>
<span id="cb275-21"><a href="chm_sens_test.html#cb275-21" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb275-22"><a href="chm_sens_test.html#cb275-22" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb275-23"><a href="chm_sens_test.html#cb275-23" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb275-24"><a href="chm_sens_test.html#cb275-24" tabindex="-1"></a>    <span class="at">metric =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb275-25"><a href="chm_sens_test.html#cb275-25" tabindex="-1"></a>        metric <span class="sc">==</span> <span class="st">&quot;f_score&quot;</span> <span class="sc">~</span> <span class="dv">1</span></span>
<span id="cb275-26"><a href="chm_sens_test.html#cb275-26" tabindex="-1"></a>        , metric <span class="sc">==</span> <span class="st">&quot;recall&quot;</span> <span class="sc">~</span> <span class="dv">2</span></span>
<span id="cb275-27"><a href="chm_sens_test.html#cb275-27" tabindex="-1"></a>        , metric <span class="sc">==</span> <span class="st">&quot;precision&quot;</span> <span class="sc">~</span> <span class="dv">3</span></span>
<span id="cb275-28"><a href="chm_sens_test.html#cb275-28" tabindex="-1"></a>        <span class="co"># rmse</span></span>
<span id="cb275-29"><a href="chm_sens_test.html#cb275-29" tabindex="-1"></a>        , metric <span class="sc">==</span> <span class="st">&quot;pct_diff_volume_field_mape&quot;</span> <span class="sc">~</span> <span class="dv">4</span></span>
<span id="cb275-30"><a href="chm_sens_test.html#cb275-30" tabindex="-1"></a>        , metric <span class="sc">==</span> <span class="st">&quot;pct_diff_paraboloid_volume_field_mape&quot;</span> <span class="sc">~</span> <span class="dv">5</span></span>
<span id="cb275-31"><a href="chm_sens_test.html#cb275-31" tabindex="-1"></a>        , metric <span class="sc">==</span> <span class="st">&quot;pct_diff_area_m2_mape&quot;</span> <span class="sc">~</span> <span class="dv">6</span></span>
<span id="cb275-32"><a href="chm_sens_test.html#cb275-32" tabindex="-1"></a>        , metric <span class="sc">==</span> <span class="st">&quot;pct_diff_height_m_mape&quot;</span> <span class="sc">~</span> <span class="dv">7</span></span>
<span id="cb275-33"><a href="chm_sens_test.html#cb275-33" tabindex="-1"></a>        , metric <span class="sc">==</span> <span class="st">&quot;pct_diff_diameter_m_mape&quot;</span> <span class="sc">~</span> <span class="dv">8</span></span>
<span id="cb275-34"><a href="chm_sens_test.html#cb275-34" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span> </span>
<span id="cb275-35"><a href="chm_sens_test.html#cb275-35" tabindex="-1"></a>      <span class="fu">factor</span>(</span>
<span id="cb275-36"><a href="chm_sens_test.html#cb275-36" tabindex="-1"></a>        <span class="at">ordered =</span> T</span>
<span id="cb275-37"><a href="chm_sens_test.html#cb275-37" tabindex="-1"></a>        , <span class="at">levels =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">8</span></span>
<span id="cb275-38"><a href="chm_sens_test.html#cb275-38" tabindex="-1"></a>        , <span class="at">labels =</span> <span class="fu">c</span>(</span>
<span id="cb275-39"><a href="chm_sens_test.html#cb275-39" tabindex="-1"></a>          <span class="st">&quot;F-score&quot;</span></span>
<span id="cb275-40"><a href="chm_sens_test.html#cb275-40" tabindex="-1"></a>          , <span class="st">&quot;Recall&quot;</span></span>
<span id="cb275-41"><a href="chm_sens_test.html#cb275-41" tabindex="-1"></a>          , <span class="st">&quot;Precision&quot;</span></span>
<span id="cb275-42"><a href="chm_sens_test.html#cb275-42" tabindex="-1"></a>          , <span class="st">&quot;MAPE: Volume irregular (%)&quot;</span></span>
<span id="cb275-43"><a href="chm_sens_test.html#cb275-43" tabindex="-1"></a>          , <span class="st">&quot;MAPE: Volume paraboloid (%)&quot;</span></span>
<span id="cb275-44"><a href="chm_sens_test.html#cb275-44" tabindex="-1"></a>          , <span class="st">&quot;MAPE: Area (%)&quot;</span></span>
<span id="cb275-45"><a href="chm_sens_test.html#cb275-45" tabindex="-1"></a>          , <span class="st">&quot;MAPE: Height (%)&quot;</span></span>
<span id="cb275-46"><a href="chm_sens_test.html#cb275-46" tabindex="-1"></a>          , <span class="st">&quot;MAPE: Diameter (%)&quot;</span></span>
<span id="cb275-47"><a href="chm_sens_test.html#cb275-47" tabindex="-1"></a>        )</span>
<span id="cb275-48"><a href="chm_sens_test.html#cb275-48" tabindex="-1"></a>      )</span>
<span id="cb275-49"><a href="chm_sens_test.html#cb275-49" tabindex="-1"></a>    <span class="co"># , param_value = factor(x = param_value, labels = levels(param_combos_spectral_gt$spectral_weight_desc))</span></span>
<span id="cb275-50"><a href="chm_sens_test.html#cb275-50" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb275-51"><a href="chm_sens_test.html#cb275-51" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(</span>
<span id="cb275-52"><a href="chm_sens_test.html#cb275-52" tabindex="-1"></a>    <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">y =</span> median, <span class="at">x =</span> param_value, <span class="at">color =</span> metric, <span class="at">fill =</span> metric, <span class="at">group =</span> metric, <span class="at">shape =</span> metric)</span>
<span id="cb275-53"><a href="chm_sens_test.html#cb275-53" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb275-54"><a href="chm_sens_test.html#cb275-54" tabindex="-1"></a>  <span class="co"># ggplot2::geom_ribbon(</span></span>
<span id="cb275-55"><a href="chm_sens_test.html#cb275-55" tabindex="-1"></a>  <span class="co">#   mapping = ggplot2::aes(ymin = q25, ymax = q75)</span></span>
<span id="cb275-56"><a href="chm_sens_test.html#cb275-56" tabindex="-1"></a>  <span class="co">#   , alpha = 0.2, color = NA</span></span>
<span id="cb275-57"><a href="chm_sens_test.html#cb275-57" tabindex="-1"></a>  <span class="co"># ) +</span></span>
<span id="cb275-58"><a href="chm_sens_test.html#cb275-58" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_line</span>(<span class="at">lwd =</span> <span class="fl">1.5</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb275-59"><a href="chm_sens_test.html#cb275-59" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb275-60"><a href="chm_sens_test.html#cb275-60" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">facet_wrap</span>(<span class="at">facets =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(param), <span class="at">scales =</span> <span class="st">&quot;free_x&quot;</span>) <span class="sc">+</span></span>
<span id="cb275-61"><a href="chm_sens_test.html#cb275-61" tabindex="-1"></a>  harrypotter<span class="sc">::</span><span class="fu">scale_fill_hp_d</span>(<span class="at">option =</span> <span class="st">&quot;hermionegranger&quot;</span>) <span class="sc">+</span></span>
<span id="cb275-62"><a href="chm_sens_test.html#cb275-62" tabindex="-1"></a>  harrypotter<span class="sc">::</span><span class="fu">scale_color_hp_d</span>(<span class="at">option =</span> <span class="st">&quot;hermionegranger&quot;</span>) <span class="sc">+</span></span>
<span id="cb275-63"><a href="chm_sens_test.html#cb275-63" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_shape_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="dv">15</span>,<span class="dv">16</span>,<span class="dv">17</span>,<span class="dv">18</span>,<span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb275-64"><a href="chm_sens_test.html#cb275-64" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">labels =</span> scales<span class="sc">::</span>percent, <span class="at">breaks =</span> scales<span class="sc">::</span><span class="fu">breaks_extended</span>(<span class="dv">10</span>)) <span class="sc">+</span></span>
<span id="cb275-65"><a href="chm_sens_test.html#cb275-65" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;&quot;</span>, <span class="at">y =</span> <span class="st">&quot;median value&quot;</span>, <span class="at">color =</span> <span class="st">&quot;&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;&quot;</span>) <span class="sc">+</span></span>
<span id="cb275-66"><a href="chm_sens_test.html#cb275-66" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb275-67"><a href="chm_sens_test.html#cb275-67" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb275-68"><a href="chm_sens_test.html#cb275-68" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;top&quot;</span></span>
<span id="cb275-69"><a href="chm_sens_test.html#cb275-69" tabindex="-1"></a>    , <span class="at">strip.text =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb275-70"><a href="chm_sens_test.html#cb275-70" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb275-71"><a href="chm_sens_test.html#cb275-71" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">guides</span>(</span>
<span id="cb275-72"><a href="chm_sens_test.html#cb275-72" tabindex="-1"></a>    <span class="at">color =</span> ggplot2<span class="sc">::</span><span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">shape =</span> <span class="dv">15</span>, <span class="at">linetype =</span> <span class="dv">0</span>, <span class="at">size =</span> <span class="dv">5</span>, <span class="at">alpha =</span> <span class="dv">1</span>))</span>
<span id="cb275-73"><a href="chm_sens_test.html#cb275-73" tabindex="-1"></a>    , <span class="at">shape =</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb275-74"><a href="chm_sens_test.html#cb275-74" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-248-1.png" width="1008" /></p>
<p>this is exactly what we expected to happen</p>
</div>
<div id="balanced_acc_assess" class="section level3 hasAnchor" number="8.6.3">
<h3><span class="header-section-number">8.6.3</span> Top settings<a href="chm_sens_test.html#balanced_acc_assess" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Of those tested, let’s identify the best-performing parameter combinations that not only balance detection and quantification accuracy but also achieve the highest recall rates. we’ll select these by choosing any combination whose recall rate is at least one standard deviation above the average for this top group. if no combinations meet this criterion, we will instead select the top 10 combinations based on their recall rates.</p>
<div id="overall-across-chm-resolution-1" class="section level4 hasAnchor" number="8.6.3.1">
<h4><span class="header-section-number">8.6.3.1</span> Overall (across CHM resolution)<a href="chm_sens_test.html#overall-across-chm-resolution-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>To select the best-performing parameter combinations of those tested, we will prioritize those that balance detection and quantification accuracy. From this group, we will then identify the settings that achieve the highest pile detection rates (recall). We emphasize that these recommendations are for users who can generate a CHM from the original point cloud. This is critical because creating a new CHM at the desired resolution is a fundamentally different process than simply disaggregating an existing, coarser raster.</p>
<p>we’ll use the F-Score and the average rank of the MAPE metrics across all form measurements (i.e. height, diameter, area, volume) to determine the best overall list</p>
<div class="sourceCode" id="cb276"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb276-1"><a href="chm_sens_test.html#cb276-1" tabindex="-1"></a><span class="co"># param_combos_spectral_gt_agg %&gt;% nrow()</span></span>
<span id="cb276-2"><a href="chm_sens_test.html#cb276-2" tabindex="-1"></a><span class="co"># param_combos_spectral_gt_agg %&gt;% </span></span>
<span id="cb276-3"><a href="chm_sens_test.html#cb276-3" tabindex="-1"></a><span class="co">#   dplyr::filter(</span></span>
<span id="cb276-4"><a href="chm_sens_test.html#cb276-4" tabindex="-1"></a><span class="co">#     dplyr::if_any(</span></span>
<span id="cb276-5"><a href="chm_sens_test.html#cb276-5" tabindex="-1"></a><span class="co">#       tidyselect::ends_with(&quot;_mape&quot;)</span></span>
<span id="cb276-6"><a href="chm_sens_test.html#cb276-6" tabindex="-1"></a><span class="co">#       , is.na</span></span>
<span id="cb276-7"><a href="chm_sens_test.html#cb276-7" tabindex="-1"></a><span class="co">#     )</span></span>
<span id="cb276-8"><a href="chm_sens_test.html#cb276-8" tabindex="-1"></a><span class="co">#   ) %&gt;% </span></span>
<span id="cb276-9"><a href="chm_sens_test.html#cb276-9" tabindex="-1"></a><span class="co">#   View()</span></span>
<span id="cb276-10"><a href="chm_sens_test.html#cb276-10" tabindex="-1"></a>  </span>
<span id="cb276-11"><a href="chm_sens_test.html#cb276-11" tabindex="-1"></a>param_combos_spectral_ranked <span class="ot">&lt;-</span></span>
<span id="cb276-12"><a href="chm_sens_test.html#cb276-12" tabindex="-1"></a>  param_combos_spectral_gt_agg <span class="sc">%&gt;%</span></span>
<span id="cb276-13"><a href="chm_sens_test.html#cb276-13" tabindex="-1"></a>  <span class="do">##########</span></span>
<span id="cb276-14"><a href="chm_sens_test.html#cb276-14" tabindex="-1"></a>  <span class="co"># first. find overall top combinations irrespective of CHM res</span></span>
<span id="cb276-15"><a href="chm_sens_test.html#cb276-15" tabindex="-1"></a>  <span class="do">##########</span></span>
<span id="cb276-16"><a href="chm_sens_test.html#cb276-16" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb276-17"><a href="chm_sens_test.html#cb276-17" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb276-18"><a href="chm_sens_test.html#cb276-18" tabindex="-1"></a>    <span class="co"># label combining params</span></span>
<span id="cb276-19"><a href="chm_sens_test.html#cb276-19" tabindex="-1"></a>    <span class="at">lab =</span> stringr<span class="sc">::</span><span class="fu">str_c</span>(max_ht_m,max_area_m2,convexity_pct,circle_fit_iou_pct,chm_res_m,spectral_weight, <span class="at">sep =</span> <span class="st">&quot;:&quot;</span>)</span>
<span id="cb276-20"><a href="chm_sens_test.html#cb276-20" tabindex="-1"></a>    , dplyr<span class="sc">::</span><span class="fu">across</span>(</span>
<span id="cb276-21"><a href="chm_sens_test.html#cb276-21" tabindex="-1"></a>      <span class="at">.cols =</span> <span class="fu">c</span>(tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_mape&quot;</span>))</span>
<span id="cb276-22"><a href="chm_sens_test.html#cb276-22" tabindex="-1"></a>      , <span class="at">.fn =</span> <span class="sc">~</span>dplyr<span class="sc">::</span><span class="fu">percent_rank</span>(<span class="sc">-</span>.x)</span>
<span id="cb276-23"><a href="chm_sens_test.html#cb276-23" tabindex="-1"></a>      , <span class="at">.names =</span> <span class="st">&quot;ovrall_pct_rank_quant_{.col}&quot;</span></span>
<span id="cb276-24"><a href="chm_sens_test.html#cb276-24" tabindex="-1"></a>    )</span>
<span id="cb276-25"><a href="chm_sens_test.html#cb276-25" tabindex="-1"></a>    , dplyr<span class="sc">::</span><span class="fu">across</span>(</span>
<span id="cb276-26"><a href="chm_sens_test.html#cb276-26" tabindex="-1"></a>      <span class="at">.cols =</span> <span class="fu">c</span>(f_score)</span>
<span id="cb276-27"><a href="chm_sens_test.html#cb276-27" tabindex="-1"></a>      <span class="co"># .cols = c(f_score,recall)</span></span>
<span id="cb276-28"><a href="chm_sens_test.html#cb276-28" tabindex="-1"></a>      , <span class="at">.fn =</span> <span class="sc">~</span>dplyr<span class="sc">::</span><span class="fu">percent_rank</span>(.x)</span>
<span id="cb276-29"><a href="chm_sens_test.html#cb276-29" tabindex="-1"></a>      , <span class="at">.names =</span> <span class="st">&quot;ovrall_pct_rank_det_{.col}&quot;</span></span>
<span id="cb276-30"><a href="chm_sens_test.html#cb276-30" tabindex="-1"></a>    )</span>
<span id="cb276-31"><a href="chm_sens_test.html#cb276-31" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb276-32"><a href="chm_sens_test.html#cb276-32" tabindex="-1"></a>  <span class="do">##########</span></span>
<span id="cb276-33"><a href="chm_sens_test.html#cb276-33" tabindex="-1"></a>  <span class="co"># second. find top combinations by CHM res</span></span>
<span id="cb276-34"><a href="chm_sens_test.html#cb276-34" tabindex="-1"></a>  <span class="do">##########</span></span>
<span id="cb276-35"><a href="chm_sens_test.html#cb276-35" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(chm_res_m) <span class="sc">%&gt;%</span> </span>
<span id="cb276-36"><a href="chm_sens_test.html#cb276-36" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb276-37"><a href="chm_sens_test.html#cb276-37" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">across</span>(</span>
<span id="cb276-38"><a href="chm_sens_test.html#cb276-38" tabindex="-1"></a>      <span class="at">.cols =</span> <span class="fu">c</span>(tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_mape&quot;</span>) <span class="sc">&amp;</span> <span class="sc">!</span>tidyselect<span class="sc">::</span><span class="fu">starts_with</span>(<span class="st">&quot;ovrall_pct_rank_&quot;</span>))</span>
<span id="cb276-39"><a href="chm_sens_test.html#cb276-39" tabindex="-1"></a>      , <span class="at">.fn =</span> <span class="sc">~</span>dplyr<span class="sc">::</span><span class="fu">percent_rank</span>(<span class="sc">-</span>.x)</span>
<span id="cb276-40"><a href="chm_sens_test.html#cb276-40" tabindex="-1"></a>      , <span class="at">.names =</span> <span class="st">&quot;chm_pct_rank_quant_{.col}&quot;</span></span>
<span id="cb276-41"><a href="chm_sens_test.html#cb276-41" tabindex="-1"></a>    )</span>
<span id="cb276-42"><a href="chm_sens_test.html#cb276-42" tabindex="-1"></a>    , dplyr<span class="sc">::</span><span class="fu">across</span>(</span>
<span id="cb276-43"><a href="chm_sens_test.html#cb276-43" tabindex="-1"></a>      <span class="at">.cols =</span> <span class="fu">c</span>(f_score)</span>
<span id="cb276-44"><a href="chm_sens_test.html#cb276-44" tabindex="-1"></a>      <span class="co"># .cols = c(f_score,recall)</span></span>
<span id="cb276-45"><a href="chm_sens_test.html#cb276-45" tabindex="-1"></a>      , <span class="at">.fn =</span> <span class="sc">~</span>dplyr<span class="sc">::</span><span class="fu">percent_rank</span>(.x)</span>
<span id="cb276-46"><a href="chm_sens_test.html#cb276-46" tabindex="-1"></a>      , <span class="at">.names =</span> <span class="st">&quot;chm_pct_rank_det_{.col}&quot;</span></span>
<span id="cb276-47"><a href="chm_sens_test.html#cb276-47" tabindex="-1"></a>    )</span>
<span id="cb276-48"><a href="chm_sens_test.html#cb276-48" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb276-49"><a href="chm_sens_test.html#cb276-49" tabindex="-1"></a>  <span class="co"># now get the max of these pct ranks by row</span></span>
<span id="cb276-50"><a href="chm_sens_test.html#cb276-50" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rowwise</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb276-51"><a href="chm_sens_test.html#cb276-51" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb276-52"><a href="chm_sens_test.html#cb276-52" tabindex="-1"></a>    <span class="at">ovrall_pct_rank_quant_mean =</span> <span class="fu">mean</span>(</span>
<span id="cb276-53"><a href="chm_sens_test.html#cb276-53" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">c_across</span>(</span>
<span id="cb276-54"><a href="chm_sens_test.html#cb276-54" tabindex="-1"></a>        tidyselect<span class="sc">::</span><span class="fu">starts_with</span>(<span class="st">&quot;ovrall_pct_rank_quant_&quot;</span>)</span>
<span id="cb276-55"><a href="chm_sens_test.html#cb276-55" tabindex="-1"></a>      )</span>
<span id="cb276-56"><a href="chm_sens_test.html#cb276-56" tabindex="-1"></a>      , <span class="at">na.rm =</span> T</span>
<span id="cb276-57"><a href="chm_sens_test.html#cb276-57" tabindex="-1"></a>    )</span>
<span id="cb276-58"><a href="chm_sens_test.html#cb276-58" tabindex="-1"></a>    , <span class="at">ovrall_pct_rank_det_mean =</span> <span class="fu">mean</span>(</span>
<span id="cb276-59"><a href="chm_sens_test.html#cb276-59" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">c_across</span>(</span>
<span id="cb276-60"><a href="chm_sens_test.html#cb276-60" tabindex="-1"></a>        tidyselect<span class="sc">::</span><span class="fu">starts_with</span>(<span class="st">&quot;ovrall_pct_rank_det_&quot;</span>)</span>
<span id="cb276-61"><a href="chm_sens_test.html#cb276-61" tabindex="-1"></a>      )</span>
<span id="cb276-62"><a href="chm_sens_test.html#cb276-62" tabindex="-1"></a>      , <span class="at">na.rm =</span> T</span>
<span id="cb276-63"><a href="chm_sens_test.html#cb276-63" tabindex="-1"></a>    )</span>
<span id="cb276-64"><a href="chm_sens_test.html#cb276-64" tabindex="-1"></a>    , <span class="at">chm_pct_rank_quant_mean =</span> <span class="fu">mean</span>(</span>
<span id="cb276-65"><a href="chm_sens_test.html#cb276-65" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">c_across</span>(</span>
<span id="cb276-66"><a href="chm_sens_test.html#cb276-66" tabindex="-1"></a>        tidyselect<span class="sc">::</span><span class="fu">starts_with</span>(<span class="st">&quot;chm_pct_rank_quant_&quot;</span>)</span>
<span id="cb276-67"><a href="chm_sens_test.html#cb276-67" tabindex="-1"></a>      )</span>
<span id="cb276-68"><a href="chm_sens_test.html#cb276-68" tabindex="-1"></a>      , <span class="at">na.rm =</span> T</span>
<span id="cb276-69"><a href="chm_sens_test.html#cb276-69" tabindex="-1"></a>    )</span>
<span id="cb276-70"><a href="chm_sens_test.html#cb276-70" tabindex="-1"></a>    , <span class="at">chm_pct_rank_det_mean =</span> <span class="fu">mean</span>(</span>
<span id="cb276-71"><a href="chm_sens_test.html#cb276-71" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">c_across</span>(</span>
<span id="cb276-72"><a href="chm_sens_test.html#cb276-72" tabindex="-1"></a>        tidyselect<span class="sc">::</span><span class="fu">starts_with</span>(<span class="st">&quot;chm_pct_rank_det_&quot;</span>)</span>
<span id="cb276-73"><a href="chm_sens_test.html#cb276-73" tabindex="-1"></a>      )</span>
<span id="cb276-74"><a href="chm_sens_test.html#cb276-74" tabindex="-1"></a>      , <span class="at">na.rm =</span> T</span>
<span id="cb276-75"><a href="chm_sens_test.html#cb276-75" tabindex="-1"></a>    )</span>
<span id="cb276-76"><a href="chm_sens_test.html#cb276-76" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb276-77"><a href="chm_sens_test.html#cb276-77" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb276-78"><a href="chm_sens_test.html#cb276-78" tabindex="-1"></a>  <span class="co"># fill na values</span></span>
<span id="cb276-79"><a href="chm_sens_test.html#cb276-79" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb276-80"><a href="chm_sens_test.html#cb276-80" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">across</span>(</span>
<span id="cb276-81"><a href="chm_sens_test.html#cb276-81" tabindex="-1"></a>      <span class="at">.cols =</span> <span class="fu">c</span>(ovrall_pct_rank_det_mean, ovrall_pct_rank_quant_mean, chm_pct_rank_det_mean, chm_pct_rank_quant_mean)</span>
<span id="cb276-82"><a href="chm_sens_test.html#cb276-82" tabindex="-1"></a>      , <span class="at">.fn =</span> <span class="sc">~</span><span class="fu">ifelse</span>(<span class="fu">is.na</span>(.x),<span class="dv">0</span>,.x)</span>
<span id="cb276-83"><a href="chm_sens_test.html#cb276-83" tabindex="-1"></a>    )</span>
<span id="cb276-84"><a href="chm_sens_test.html#cb276-84" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb276-85"><a href="chm_sens_test.html#cb276-85" tabindex="-1"></a>  <span class="co"># dplyr::select(ovrall_pct_rank_det_mean, ovrall_pct_rank_quant_mean) %&gt;% summary()</span></span>
<span id="cb276-86"><a href="chm_sens_test.html#cb276-86" tabindex="-1"></a>  <span class="co"># now make quadrant var</span></span>
<span id="cb276-87"><a href="chm_sens_test.html#cb276-87" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb276-88"><a href="chm_sens_test.html#cb276-88" tabindex="-1"></a>    <span class="co"># groupings for the quadrant plot</span></span>
<span id="cb276-89"><a href="chm_sens_test.html#cb276-89" tabindex="-1"></a>    <span class="at">ovrall_accuracy_grp =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb276-90"><a href="chm_sens_test.html#cb276-90" tabindex="-1"></a>        ovrall_pct_rank_det_mean<span class="sc">&gt;=</span><span class="fl">0.95</span> <span class="sc">&amp;</span> ovrall_pct_rank_quant_mean<span class="sc">&gt;=</span><span class="fl">0.95</span> <span class="sc">~</span> <span class="dv">1</span></span>
<span id="cb276-91"><a href="chm_sens_test.html#cb276-91" tabindex="-1"></a>        , ovrall_pct_rank_det_mean<span class="sc">&gt;=</span><span class="fl">0.90</span> <span class="sc">&amp;</span> ovrall_pct_rank_quant_mean<span class="sc">&gt;=</span><span class="fl">0.90</span> <span class="sc">~</span> <span class="dv">2</span></span>
<span id="cb276-92"><a href="chm_sens_test.html#cb276-92" tabindex="-1"></a>        , ovrall_pct_rank_det_mean<span class="sc">&gt;=</span><span class="fl">0.75</span> <span class="sc">&amp;</span> ovrall_pct_rank_quant_mean<span class="sc">&gt;=</span><span class="fl">0.75</span> <span class="sc">~</span> <span class="dv">3</span></span>
<span id="cb276-93"><a href="chm_sens_test.html#cb276-93" tabindex="-1"></a>        , ovrall_pct_rank_det_mean<span class="sc">&gt;=</span><span class="fl">0.50</span> <span class="sc">&amp;</span> ovrall_pct_rank_quant_mean<span class="sc">&gt;=</span><span class="fl">0.50</span> <span class="sc">~</span> <span class="dv">4</span></span>
<span id="cb276-94"><a href="chm_sens_test.html#cb276-94" tabindex="-1"></a>        , ovrall_pct_rank_det_mean<span class="sc">&gt;=</span><span class="fl">0.50</span> <span class="sc">&amp;</span> ovrall_pct_rank_quant_mean<span class="sc">&lt;</span><span class="fl">0.50</span> <span class="sc">~</span> <span class="dv">5</span></span>
<span id="cb276-95"><a href="chm_sens_test.html#cb276-95" tabindex="-1"></a>        , ovrall_pct_rank_det_mean<span class="sc">&lt;</span><span class="fl">0.50</span> <span class="sc">&amp;</span> ovrall_pct_rank_quant_mean<span class="sc">&gt;=</span><span class="fl">0.50</span> <span class="sc">~</span> <span class="dv">6</span></span>
<span id="cb276-96"><a href="chm_sens_test.html#cb276-96" tabindex="-1"></a>        , T <span class="sc">~</span> <span class="dv">7</span></span>
<span id="cb276-97"><a href="chm_sens_test.html#cb276-97" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span> </span>
<span id="cb276-98"><a href="chm_sens_test.html#cb276-98" tabindex="-1"></a>      <span class="fu">factor</span>(</span>
<span id="cb276-99"><a href="chm_sens_test.html#cb276-99" tabindex="-1"></a>        <span class="at">ordered =</span> T</span>
<span id="cb276-100"><a href="chm_sens_test.html#cb276-100" tabindex="-1"></a>        , <span class="at">levels =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">7</span></span>
<span id="cb276-101"><a href="chm_sens_test.html#cb276-101" tabindex="-1"></a>        , <span class="at">labels =</span> <span class="fu">c</span>(</span>
<span id="cb276-102"><a href="chm_sens_test.html#cb276-102" tabindex="-1"></a>          <span class="st">&quot;top 5% detection &amp; quantification&quot;</span> <span class="co"># ovrall_pct_rank_mean&gt;=0.95 &amp; ovrall_pct_rank_f_score&gt;=0.95 ~ 1</span></span>
<span id="cb276-103"><a href="chm_sens_test.html#cb276-103" tabindex="-1"></a>          , <span class="st">&quot;top 10% detection &amp; quantification&quot;</span> <span class="co"># ovrall_pct_rank_mean&gt;=0.90 &amp; ovrall_pct_rank_f_score&gt;=0.90 ~ 2</span></span>
<span id="cb276-104"><a href="chm_sens_test.html#cb276-104" tabindex="-1"></a>          , <span class="st">&quot;top 25% detection &amp; quantification&quot;</span> <span class="co"># ovrall_pct_rank_mean&gt;=0.75 &amp; ovrall_pct_rank_f_score&gt;=0.75 ~ 3</span></span>
<span id="cb276-105"><a href="chm_sens_test.html#cb276-105" tabindex="-1"></a>          , <span class="st">&quot;top 50% detection &amp; quantification&quot;</span> <span class="co"># ovrall_pct_rank_mean&gt;=0.50 &amp; ovrall_pct_rank_f_score&gt;=0.50 ~ 4</span></span>
<span id="cb276-106"><a href="chm_sens_test.html#cb276-106" tabindex="-1"></a>          , <span class="st">&quot;top 50% quantification&quot;</span> <span class="co"># ovrall_pct_rank_mean&gt;=0.50 &amp; ovrall_pct_rank_f_score&lt;0.50 ~ 5</span></span>
<span id="cb276-107"><a href="chm_sens_test.html#cb276-107" tabindex="-1"></a>          , <span class="st">&quot;top 50% detection&quot;</span> <span class="co"># ovrall_pct_rank_mean&lt;0.50 &amp; ovrall_pct_rank_f_score&gt;=0.50 ~ 6</span></span>
<span id="cb276-108"><a href="chm_sens_test.html#cb276-108" tabindex="-1"></a>          , <span class="st">&quot;bottom 50% detection &amp; quantification&quot;</span></span>
<span id="cb276-109"><a href="chm_sens_test.html#cb276-109" tabindex="-1"></a>        )</span>
<span id="cb276-110"><a href="chm_sens_test.html#cb276-110" tabindex="-1"></a>      )</span>
<span id="cb276-111"><a href="chm_sens_test.html#cb276-111" tabindex="-1"></a>    , <span class="at">chm_accuracy_grp =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb276-112"><a href="chm_sens_test.html#cb276-112" tabindex="-1"></a>        chm_pct_rank_det_mean<span class="sc">&gt;=</span><span class="fl">0.95</span> <span class="sc">&amp;</span> chm_pct_rank_quant_mean<span class="sc">&gt;=</span><span class="fl">0.95</span> <span class="sc">~</span> <span class="dv">1</span></span>
<span id="cb276-113"><a href="chm_sens_test.html#cb276-113" tabindex="-1"></a>        , chm_pct_rank_det_mean<span class="sc">&gt;=</span><span class="fl">0.90</span> <span class="sc">&amp;</span> chm_pct_rank_quant_mean<span class="sc">&gt;=</span><span class="fl">0.90</span> <span class="sc">~</span> <span class="dv">2</span></span>
<span id="cb276-114"><a href="chm_sens_test.html#cb276-114" tabindex="-1"></a>        , chm_pct_rank_det_mean<span class="sc">&gt;=</span><span class="fl">0.75</span> <span class="sc">&amp;</span> chm_pct_rank_quant_mean<span class="sc">&gt;=</span><span class="fl">0.75</span> <span class="sc">~</span> <span class="dv">3</span></span>
<span id="cb276-115"><a href="chm_sens_test.html#cb276-115" tabindex="-1"></a>        , chm_pct_rank_det_mean<span class="sc">&gt;=</span><span class="fl">0.50</span> <span class="sc">&amp;</span> chm_pct_rank_quant_mean<span class="sc">&gt;=</span><span class="fl">0.50</span> <span class="sc">~</span> <span class="dv">4</span></span>
<span id="cb276-116"><a href="chm_sens_test.html#cb276-116" tabindex="-1"></a>        , chm_pct_rank_det_mean<span class="sc">&gt;=</span><span class="fl">0.50</span> <span class="sc">&amp;</span> chm_pct_rank_quant_mean<span class="sc">&lt;</span><span class="fl">0.50</span> <span class="sc">~</span> <span class="dv">5</span></span>
<span id="cb276-117"><a href="chm_sens_test.html#cb276-117" tabindex="-1"></a>        , chm_pct_rank_det_mean<span class="sc">&lt;</span><span class="fl">0.50</span> <span class="sc">&amp;</span> chm_pct_rank_quant_mean<span class="sc">&gt;=</span><span class="fl">0.50</span> <span class="sc">~</span> <span class="dv">6</span></span>
<span id="cb276-118"><a href="chm_sens_test.html#cb276-118" tabindex="-1"></a>        , T <span class="sc">~</span> <span class="dv">7</span></span>
<span id="cb276-119"><a href="chm_sens_test.html#cb276-119" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span> </span>
<span id="cb276-120"><a href="chm_sens_test.html#cb276-120" tabindex="-1"></a>      <span class="fu">factor</span>(</span>
<span id="cb276-121"><a href="chm_sens_test.html#cb276-121" tabindex="-1"></a>        <span class="at">ordered =</span> T</span>
<span id="cb276-122"><a href="chm_sens_test.html#cb276-122" tabindex="-1"></a>        , <span class="at">levels =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">7</span></span>
<span id="cb276-123"><a href="chm_sens_test.html#cb276-123" tabindex="-1"></a>        , <span class="at">labels =</span> <span class="fu">c</span>(</span>
<span id="cb276-124"><a href="chm_sens_test.html#cb276-124" tabindex="-1"></a>          <span class="st">&quot;top 5% detection &amp; quantification&quot;</span> <span class="co"># chm_pct_rank_mean&gt;=0.95 &amp; chm_pct_rank_f_score&gt;=0.95 ~ 1</span></span>
<span id="cb276-125"><a href="chm_sens_test.html#cb276-125" tabindex="-1"></a>          , <span class="st">&quot;top 10% detection &amp; quantification&quot;</span> <span class="co"># chm_pct_rank_mean&gt;=0.90 &amp; chm_pct_rank_f_score&gt;=0.90 ~ 2</span></span>
<span id="cb276-126"><a href="chm_sens_test.html#cb276-126" tabindex="-1"></a>          , <span class="st">&quot;top 25% detection &amp; quantification&quot;</span> <span class="co"># chm_pct_rank_mean&gt;=0.75 &amp; chm_pct_rank_f_score&gt;=0.75 ~ 3</span></span>
<span id="cb276-127"><a href="chm_sens_test.html#cb276-127" tabindex="-1"></a>          , <span class="st">&quot;top 50% detection &amp; quantification&quot;</span> <span class="co"># chm_pct_rank_mean&gt;=0.50 &amp; chm_pct_rank_f_score&gt;=0.50 ~ 4</span></span>
<span id="cb276-128"><a href="chm_sens_test.html#cb276-128" tabindex="-1"></a>          , <span class="st">&quot;top 50% quantification&quot;</span> <span class="co"># chm_pct_rank_mean&gt;=0.50 &amp; chm_pct_rank_f_score&lt;0.50 ~ 5</span></span>
<span id="cb276-129"><a href="chm_sens_test.html#cb276-129" tabindex="-1"></a>          , <span class="st">&quot;top 50% detection&quot;</span> <span class="co"># chm_pct_rank_mean&lt;0.50 &amp; chm_pct_rank_f_score&gt;=0.50 ~ 6</span></span>
<span id="cb276-130"><a href="chm_sens_test.html#cb276-130" tabindex="-1"></a>          , <span class="st">&quot;bottom 50% detection &amp; quantification&quot;</span></span>
<span id="cb276-131"><a href="chm_sens_test.html#cb276-131" tabindex="-1"></a>        )</span>
<span id="cb276-132"><a href="chm_sens_test.html#cb276-132" tabindex="-1"></a>      )</span>
<span id="cb276-133"><a href="chm_sens_test.html#cb276-133" tabindex="-1"></a>    , </span>
<span id="cb276-134"><a href="chm_sens_test.html#cb276-134" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb276-135"><a href="chm_sens_test.html#cb276-135" tabindex="-1"></a>  <span class="do">##########</span></span>
<span id="cb276-136"><a href="chm_sens_test.html#cb276-136" tabindex="-1"></a>  <span class="co"># first. find overall top combinations irrespective of CHM res</span></span>
<span id="cb276-137"><a href="chm_sens_test.html#cb276-137" tabindex="-1"></a>  <span class="do">##########</span></span>
<span id="cb276-138"><a href="chm_sens_test.html#cb276-138" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb276-139"><a href="chm_sens_test.html#cb276-139" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb276-140"><a href="chm_sens_test.html#cb276-140" tabindex="-1"></a>    <span class="at">ovrall_balanced_pct_rank =</span> dplyr<span class="sc">::</span><span class="fu">percent_rank</span>( (ovrall_pct_rank_det_mean<span class="sc">+</span>ovrall_pct_rank_quant_mean)<span class="sc">/</span><span class="dv">2</span> ) <span class="co"># equally weight quant and detection</span></span>
<span id="cb276-141"><a href="chm_sens_test.html#cb276-141" tabindex="-1"></a>    , <span class="at">ovrall_lab =</span> forcats<span class="sc">::</span><span class="fu">fct_reorder</span>(lab, ovrall_balanced_pct_rank)</span>
<span id="cb276-142"><a href="chm_sens_test.html#cb276-142" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb276-143"><a href="chm_sens_test.html#cb276-143" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(<span class="fu">desc</span>(ovrall_balanced_pct_rank),<span class="fu">desc</span>(ovrall_pct_rank_det_mean),<span class="fu">desc</span>(ovrall_pct_rank_quant_mean)) <span class="sc">%&gt;%</span> </span>
<span id="cb276-144"><a href="chm_sens_test.html#cb276-144" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb276-145"><a href="chm_sens_test.html#cb276-145" tabindex="-1"></a>    <span class="at">ovrall_balanced_rank =</span> dplyr<span class="sc">::</span><span class="fu">row_number</span>()</span>
<span id="cb276-146"><a href="chm_sens_test.html#cb276-146" tabindex="-1"></a>    <span class="co"># is_top_overall = using rows in case not all combos resulted in piles and/or </span></span>
<span id="cb276-147"><a href="chm_sens_test.html#cb276-147" tabindex="-1"></a>      <span class="co"># there are many ties in the data leading to no records with a percent rank &lt;= pct_th_top (e.g. many tied at 98%)</span></span>
<span id="cb276-148"><a href="chm_sens_test.html#cb276-148" tabindex="-1"></a>    , <span class="at">is_top_overall =</span> dplyr<span class="sc">::</span><span class="fu">row_number</span>()<span class="sc">&lt;=</span>(n_combos_tested_spectral<span class="sc">*</span>pct_th_top)</span>
<span id="cb276-149"><a href="chm_sens_test.html#cb276-149" tabindex="-1"></a>      <span class="co"># ovrall_balanced_pct_rank&gt;=(1-pct_th_top)</span></span>
<span id="cb276-150"><a href="chm_sens_test.html#cb276-150" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb276-151"><a href="chm_sens_test.html#cb276-151" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(<span class="fu">desc</span>(is_top_overall),<span class="fu">desc</span>(recall),<span class="fu">desc</span>(ovrall_pct_rank_det_mean),<span class="fu">desc</span>(ovrall_pct_rank_quant_mean),ovrall_balanced_rank) <span class="sc">%&gt;%</span> </span>
<span id="cb276-152"><a href="chm_sens_test.html#cb276-152" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">is_final_selection =</span> is_top_overall <span class="sc">&amp;</span> dplyr<span class="sc">::</span><span class="fu">row_number</span>()<span class="sc">&lt;=</span>n_th_top) <span class="sc">%&gt;%</span> </span>
<span id="cb276-153"><a href="chm_sens_test.html#cb276-153" tabindex="-1"></a>  <span class="do">##########</span></span>
<span id="cb276-154"><a href="chm_sens_test.html#cb276-154" tabindex="-1"></a>  <span class="co"># second. find top combinations by CHM res</span></span>
<span id="cb276-155"><a href="chm_sens_test.html#cb276-155" tabindex="-1"></a>  <span class="do">##########</span></span>
<span id="cb276-156"><a href="chm_sens_test.html#cb276-156" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(chm_res_m) <span class="sc">%&gt;%</span> </span>
<span id="cb276-157"><a href="chm_sens_test.html#cb276-157" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb276-158"><a href="chm_sens_test.html#cb276-158" tabindex="-1"></a>    <span class="at">chm_balanced_pct_rank =</span> dplyr<span class="sc">::</span><span class="fu">percent_rank</span>( (chm_pct_rank_det_mean<span class="sc">+</span>chm_pct_rank_quant_mean)<span class="sc">/</span><span class="dv">2</span> ) <span class="co"># equally weight quant and detection</span></span>
<span id="cb276-159"><a href="chm_sens_test.html#cb276-159" tabindex="-1"></a>    , <span class="at">chm_lab =</span> forcats<span class="sc">::</span><span class="fu">fct_reorder</span>(lab, chm_balanced_pct_rank)</span>
<span id="cb276-160"><a href="chm_sens_test.html#cb276-160" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb276-161"><a href="chm_sens_test.html#cb276-161" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(chm_res_m,<span class="fu">desc</span>(chm_balanced_pct_rank),<span class="fu">desc</span>(chm_pct_rank_det_mean),<span class="fu">desc</span>(chm_pct_rank_quant_mean),ovrall_balanced_rank) <span class="sc">%&gt;%</span> </span>
<span id="cb276-162"><a href="chm_sens_test.html#cb276-162" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb276-163"><a href="chm_sens_test.html#cb276-163" tabindex="-1"></a>    <span class="at">chm_balanced_rank =</span> dplyr<span class="sc">::</span><span class="fu">row_number</span>()</span>
<span id="cb276-164"><a href="chm_sens_test.html#cb276-164" tabindex="-1"></a>    <span class="co"># is_top_chm = using rows in case not all combos resulted in piles and/or </span></span>
<span id="cb276-165"><a href="chm_sens_test.html#cb276-165" tabindex="-1"></a>      <span class="co"># there are many ties in the data leading to no records with a percent rank &lt;= pct_th_top (e.g. many tied at 98%)</span></span>
<span id="cb276-166"><a href="chm_sens_test.html#cb276-166" tabindex="-1"></a>    , <span class="at">is_top_chm =</span> dplyr<span class="sc">::</span><span class="fu">row_number</span>()<span class="sc">&lt;=</span>n_combos_top_spectral_chm <span class="co"># double it so we look at more than 14??</span></span>
<span id="cb276-167"><a href="chm_sens_test.html#cb276-167" tabindex="-1"></a>      <span class="co"># chm_balanced_pct_rank&gt;=(1-pct_th_top)</span></span>
<span id="cb276-168"><a href="chm_sens_test.html#cb276-168" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb276-169"><a href="chm_sens_test.html#cb276-169" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(chm_res_m,<span class="fu">desc</span>(is_top_chm),<span class="fu">desc</span>(recall),<span class="fu">desc</span>(chm_pct_rank_det_mean),<span class="fu">desc</span>(chm_pct_rank_quant_mean),ovrall_balanced_rank) <span class="sc">%&gt;%</span> </span>
<span id="cb276-170"><a href="chm_sens_test.html#cb276-170" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">is_final_selection_chm =</span> is_top_chm <span class="sc">&amp;</span> dplyr<span class="sc">::</span><span class="fu">row_number</span>()<span class="sc">&lt;=</span>n_th_top_chm) <span class="sc">%&gt;%</span> <span class="co"># half it because it&#39;s going to be a lot to show in our facet ggplot</span></span>
<span id="cb276-171"><a href="chm_sens_test.html#cb276-171" tabindex="-1"></a>  <span class="do">##### clean up</span></span>
<span id="cb276-172"><a href="chm_sens_test.html#cb276-172" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb276-173"><a href="chm_sens_test.html#cb276-173" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(</span>
<span id="cb276-174"><a href="chm_sens_test.html#cb276-174" tabindex="-1"></a>    <span class="fu">c</span>(tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_mape&quot;</span>) <span class="sc">&amp;</span> tidyselect<span class="sc">::</span><span class="fu">starts_with</span>(<span class="st">&quot;ovrall_pct_rank_&quot;</span>))</span>
<span id="cb276-175"><a href="chm_sens_test.html#cb276-175" tabindex="-1"></a>    , <span class="fu">c</span>(tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_mape&quot;</span>) <span class="sc">&amp;</span> tidyselect<span class="sc">::</span><span class="fu">starts_with</span>(<span class="st">&quot;chm_pct_rank_&quot;</span>))</span>
<span id="cb276-176"><a href="chm_sens_test.html#cb276-176" tabindex="-1"></a>    , <span class="fu">c</span>(tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_f_score&quot;</span>) <span class="sc">&amp;</span> tidyselect<span class="sc">::</span><span class="fu">starts_with</span>(<span class="st">&quot;ovrall_pct_rank_&quot;</span>))</span>
<span id="cb276-177"><a href="chm_sens_test.html#cb276-177" tabindex="-1"></a>    , <span class="fu">c</span>(tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_f_score&quot;</span>) <span class="sc">&amp;</span> tidyselect<span class="sc">::</span><span class="fu">starts_with</span>(<span class="st">&quot;chm_pct_rank_&quot;</span>))</span>
<span id="cb276-178"><a href="chm_sens_test.html#cb276-178" tabindex="-1"></a>  ))</span>
<span id="cb276-179"><a href="chm_sens_test.html#cb276-179" tabindex="-1"></a><span class="co"># huh?</span></span>
<span id="cb276-180"><a href="chm_sens_test.html#cb276-180" tabindex="-1"></a><span class="co"># param_combos_spectral_ranked %&gt;% dplyr::glimpse()</span></span>
<span id="cb276-181"><a href="chm_sens_test.html#cb276-181" tabindex="-1"></a><span class="co"># param_combos_spectral_ranked %&gt;% dplyr::count(is_final_selection)</span></span></code></pre></div>
<p>to determine the combinations of those tested that achieved the best balance between both detection and quantification accuracy, we’re selecting the parameter combinations that are in the upper-right of the quadrant plot. That is, the parameter combinations that performed best at both pile detection accuracy and pile form quantification accuracy</p>
<div class="sourceCode" id="cb277"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb277-1"><a href="chm_sens_test.html#cb277-1" tabindex="-1"></a><span class="co"># plot</span></span>
<span id="cb277-2"><a href="chm_sens_test.html#cb277-2" tabindex="-1"></a>param_combos_spectral_ranked <span class="sc">%&gt;%</span>   </span>
<span id="cb277-3"><a href="chm_sens_test.html#cb277-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">slice_sample</span>(<span class="at">prop =</span> (<span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb277-4"><a href="chm_sens_test.html#cb277-4" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(</span>
<span id="cb277-5"><a href="chm_sens_test.html#cb277-5" tabindex="-1"></a>    <span class="at">mapping=</span>ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> ovrall_pct_rank_det_mean, <span class="at">y =</span> ovrall_pct_rank_quant_mean, <span class="at">color =</span> ovrall_accuracy_grp)</span>
<span id="cb277-6"><a href="chm_sens_test.html#cb277-6" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb277-7"><a href="chm_sens_test.html#cb277-7" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fl">0.5</span>, <span class="at">color =</span> <span class="st">&quot;gray22&quot;</span>) <span class="sc">+</span></span>
<span id="cb277-8"><a href="chm_sens_test.html#cb277-8" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fl">0.5</span>, <span class="at">color =</span> <span class="st">&quot;gray22&quot;</span>) <span class="sc">+</span></span>
<span id="cb277-9"><a href="chm_sens_test.html#cb277-9" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fl">0.75</span>, <span class="at">color =</span> <span class="st">&quot;gray44&quot;</span>) <span class="sc">+</span></span>
<span id="cb277-10"><a href="chm_sens_test.html#cb277-10" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fl">0.75</span>, <span class="at">color =</span> <span class="st">&quot;gray44&quot;</span>) <span class="sc">+</span></span>
<span id="cb277-11"><a href="chm_sens_test.html#cb277-11" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fl">0.9</span>, <span class="at">color =</span> <span class="st">&quot;gray66&quot;</span>) <span class="sc">+</span></span>
<span id="cb277-12"><a href="chm_sens_test.html#cb277-12" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fl">0.9</span>, <span class="at">color =</span> <span class="st">&quot;gray66&quot;</span>) <span class="sc">+</span></span>
<span id="cb277-13"><a href="chm_sens_test.html#cb277-13" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb277-14"><a href="chm_sens_test.html#cb277-14" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_colour_viridis_d</span>(<span class="at">direction =</span> <span class="sc">-</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb277-15"><a href="chm_sens_test.html#cb277-15" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_x_continuous</span>(</span>
<span id="cb277-16"><a href="chm_sens_test.html#cb277-16" tabindex="-1"></a>    <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">percent_format</span>(<span class="at">accuracy =</span> <span class="dv">1</span>)</span>
<span id="cb277-17"><a href="chm_sens_test.html#cb277-17" tabindex="-1"></a>    , <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)</span>
<span id="cb277-18"><a href="chm_sens_test.html#cb277-18" tabindex="-1"></a>  ) <span class="sc">+</span>  </span>
<span id="cb277-19"><a href="chm_sens_test.html#cb277-19" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_y_continuous</span>(</span>
<span id="cb277-20"><a href="chm_sens_test.html#cb277-20" tabindex="-1"></a>    <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">percent_format</span>(<span class="at">accuracy =</span> <span class="dv">1</span>)</span>
<span id="cb277-21"><a href="chm_sens_test.html#cb277-21" tabindex="-1"></a>    , <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)</span>
<span id="cb277-22"><a href="chm_sens_test.html#cb277-22" tabindex="-1"></a>  ) <span class="sc">+</span>  </span>
<span id="cb277-23"><a href="chm_sens_test.html#cb277-23" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb277-24"><a href="chm_sens_test.html#cb277-24" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;Percentile F-Score&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Percentile MAPE (mean)&quot;</span></span>
<span id="cb277-25"><a href="chm_sens_test.html#cb277-25" tabindex="-1"></a>    , <span class="at">color =</span> <span class="st">&quot;&quot;</span></span>
<span id="cb277-26"><a href="chm_sens_test.html#cb277-26" tabindex="-1"></a>    , <span class="at">subtitle =</span> <span class="st">&quot;Data Fusion&quot;</span></span>
<span id="cb277-27"><a href="chm_sens_test.html#cb277-27" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb277-28"><a href="chm_sens_test.html#cb277-28" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb277-29"><a href="chm_sens_test.html#cb277-29" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb277-30"><a href="chm_sens_test.html#cb277-30" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span></span>
<span id="cb277-31"><a href="chm_sens_test.html#cb277-31" tabindex="-1"></a>    , <span class="at">legend.text =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>)</span>
<span id="cb277-32"><a href="chm_sens_test.html#cb277-32" tabindex="-1"></a>    , <span class="at">strip.text =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb277-33"><a href="chm_sens_test.html#cb277-33" tabindex="-1"></a>    , <span class="at">axis.text =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">7</span>)</span>
<span id="cb277-34"><a href="chm_sens_test.html#cb277-34" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb277-35"><a href="chm_sens_test.html#cb277-35" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">guides</span>(</span>
<span id="cb277-36"><a href="chm_sens_test.html#cb277-36" tabindex="-1"></a>    <span class="at">color =</span> ggplot2<span class="sc">::</span><span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">shape =</span> <span class="dv">15</span>, <span class="at">linetype =</span> <span class="dv">0</span>, <span class="at">size =</span> <span class="dv">5</span>, <span class="at">alpha =</span> <span class="dv">1</span>))</span>
<span id="cb277-37"><a href="chm_sens_test.html#cb277-37" tabindex="-1"></a>    , <span class="at">shape =</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb277-38"><a href="chm_sens_test.html#cb277-38" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-251-1.png" width="1008" /></p>
<div id="top-1.0-1" class="section level5 hasAnchor" number="8.6.3.1.1">
<h5><span class="header-section-number">8.6.3.1.1</span> Top 1.0%<a href="chm_sens_test.html#top-1.0-1" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>let’s check out the parameter settings of the top 1.0% (n=352) from all 35,280 combinations tested. these are “votes” for the parameter setting based on the combinations that achieved the best balance between both detection and quantification accuracy.</p>
<div class="sourceCode" id="cb278"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb278-1"><a href="chm_sens_test.html#cb278-1" tabindex="-1"></a>param_combos_spectral_ranked <span class="sc">%&gt;%</span></span>
<span id="cb278-2"><a href="chm_sens_test.html#cb278-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(is_top_overall) <span class="sc">%&gt;%</span> </span>
<span id="cb278-3"><a href="chm_sens_test.html#cb278-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;f_score&quot;</span>), max_ht_m,max_area_m2,convexity_pct,circle_fit_iou_pct,chm_res_m,spectral_weight) <span class="sc">%&gt;%</span> </span>
<span id="cb278-4"><a href="chm_sens_test.html#cb278-4" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(</span>
<span id="cb278-5"><a href="chm_sens_test.html#cb278-5" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">c</span>(max_ht_m,max_area_m2,convexity_pct,circle_fit_iou_pct,chm_res_m,spectral_weight)</span>
<span id="cb278-6"><a href="chm_sens_test.html#cb278-6" tabindex="-1"></a>    , <span class="at">names_to =</span> <span class="st">&quot;metric&quot;</span></span>
<span id="cb278-7"><a href="chm_sens_test.html#cb278-7" tabindex="-1"></a>    , <span class="at">values_to =</span> <span class="st">&quot;value&quot;</span></span>
<span id="cb278-8"><a href="chm_sens_test.html#cb278-8" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb278-9"><a href="chm_sens_test.html#cb278-9" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">count</span>(metric, value) <span class="sc">%&gt;%</span> </span>
<span id="cb278-10"><a href="chm_sens_test.html#cb278-10" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(metric) <span class="sc">%&gt;%</span> </span>
<span id="cb278-11"><a href="chm_sens_test.html#cb278-11" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb278-12"><a href="chm_sens_test.html#cb278-12" tabindex="-1"></a>    <span class="at">pct=</span>n<span class="sc">/</span><span class="fu">sum</span>(n)</span>
<span id="cb278-13"><a href="chm_sens_test.html#cb278-13" tabindex="-1"></a>    , <span class="at">lab =</span> <span class="fu">paste0</span>(scales<span class="sc">::</span><span class="fu">percent</span>(pct,<span class="at">accuracy=</span><span class="fl">0.1</span>), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">n=&quot;</span>, scales<span class="sc">::</span><span class="fu">comma</span>(n,<span class="at">accuracy=</span><span class="dv">1</span>))</span>
<span id="cb278-14"><a href="chm_sens_test.html#cb278-14" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb278-15"><a href="chm_sens_test.html#cb278-15" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(</span>
<span id="cb278-16"><a href="chm_sens_test.html#cb278-16" tabindex="-1"></a>    <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">factor</span>(value), <span class="at">y=</span>pct, <span class="at">label=</span>lab, <span class="at">fill =</span> metric)</span>
<span id="cb278-17"><a href="chm_sens_test.html#cb278-17" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb278-18"><a href="chm_sens_test.html#cb278-18" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_col</span>(<span class="at">width =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb278-19"><a href="chm_sens_test.html#cb278-19" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_text</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">size =</span> <span class="fl">2.5</span>, <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb278-20"><a href="chm_sens_test.html#cb278-20" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">facet_wrap</span>(<span class="at">facets =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(metric), <span class="at">ncol=</span><span class="dv">2</span>, <span class="at">scales =</span> <span class="st">&quot;free_x&quot;</span>) <span class="sc">+</span></span>
<span id="cb278-21"><a href="chm_sens_test.html#cb278-21" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_y_continuous</span>(</span>
<span id="cb278-22"><a href="chm_sens_test.html#cb278-22" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="at">by=</span><span class="fl">0.2</span>)</span>
<span id="cb278-23"><a href="chm_sens_test.html#cb278-23" tabindex="-1"></a>    , <span class="at">labels =</span> scales<span class="sc">::</span>percent</span>
<span id="cb278-24"><a href="chm_sens_test.html#cb278-24" tabindex="-1"></a>    , <span class="at">expand =</span> ggplot2<span class="sc">::</span><span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">0.2</span>))</span>
<span id="cb278-25"><a href="chm_sens_test.html#cb278-25" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb278-26"><a href="chm_sens_test.html#cb278-26" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_fill_manual</span>(<span class="at">values =</span> pal_param[<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>]) <span class="sc">+</span></span>
<span id="cb278-27"><a href="chm_sens_test.html#cb278-27" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb278-28"><a href="chm_sens_test.html#cb278-28" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;parameter setting&quot;</span>, <span class="at">y =</span> <span class="st">&quot;&quot;</span></span>
<span id="cb278-29"><a href="chm_sens_test.html#cb278-29" tabindex="-1"></a>    , <span class="at">fill =</span> <span class="st">&quot;&quot;</span></span>
<span id="cb278-30"><a href="chm_sens_test.html#cb278-30" tabindex="-1"></a>    , <span class="at">subtitle =</span> <span class="fu">paste0</span>(</span>
<span id="cb278-31"><a href="chm_sens_test.html#cb278-31" tabindex="-1"></a>      <span class="st">&quot;Data Fusion&quot;</span></span>
<span id="cb278-32"><a href="chm_sens_test.html#cb278-32" tabindex="-1"></a>       , <span class="st">&quot;</span><span class="sc">\n</span><span class="st">parameter settings of top &quot;</span></span>
<span id="cb278-33"><a href="chm_sens_test.html#cb278-33" tabindex="-1"></a>       , scales<span class="sc">::</span><span class="fu">percent</span>(pct_th_top,<span class="at">accuracy=</span><span class="fl">0.1</span>)</span>
<span id="cb278-34"><a href="chm_sens_test.html#cb278-34" tabindex="-1"></a>       , <span class="st">&quot; (n=&quot;</span></span>
<span id="cb278-35"><a href="chm_sens_test.html#cb278-35" tabindex="-1"></a>       , scales<span class="sc">::</span><span class="fu">comma</span>(<span class="fu">sum</span>(param_combos_spectral_ranked<span class="sc">$</span>is_top_overall), <span class="at">accuracy =</span> <span class="dv">1</span>)</span>
<span id="cb278-36"><a href="chm_sens_test.html#cb278-36" tabindex="-1"></a>       , <span class="st">&quot;) &quot;</span></span>
<span id="cb278-37"><a href="chm_sens_test.html#cb278-37" tabindex="-1"></a>       , <span class="st">&quot;overall parameter combinations</span><span class="sc">\n</span><span class="st">based on both detection and quantification accuracy&quot;</span></span>
<span id="cb278-38"><a href="chm_sens_test.html#cb278-38" tabindex="-1"></a>    )</span>
<span id="cb278-39"><a href="chm_sens_test.html#cb278-39" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb278-40"><a href="chm_sens_test.html#cb278-40" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb278-41"><a href="chm_sens_test.html#cb278-41" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb278-42"><a href="chm_sens_test.html#cb278-42" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb278-43"><a href="chm_sens_test.html#cb278-43" tabindex="-1"></a>    , <span class="at">strip.text =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb278-44"><a href="chm_sens_test.html#cb278-44" tabindex="-1"></a>    , <span class="at">axis.text.y =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">6</span>)</span>
<span id="cb278-45"><a href="chm_sens_test.html#cb278-45" tabindex="-1"></a>    , <span class="at">axis.text.x =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>)</span>
<span id="cb278-46"><a href="chm_sens_test.html#cb278-46" tabindex="-1"></a>    , <span class="at">plot.subtitle =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>)</span>
<span id="cb278-47"><a href="chm_sens_test.html#cb278-47" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-252-1.png" width="1008" /></p>
<p>what is the expected <em>detection</em> accuracy of the top 1.0% (n=352) combinations tested?</p>
<div class="sourceCode" id="cb279"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb279-1"><a href="chm_sens_test.html#cb279-1" tabindex="-1"></a><span class="fu">plt_detection_dist</span>(</span>
<span id="cb279-2"><a href="chm_sens_test.html#cb279-2" tabindex="-1"></a>  <span class="at">df =</span> param_combos_spectral_ranked <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(is_top_overall) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">!</span>tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;_pct_rank_&quot;</span>))</span>
<span id="cb279-3"><a href="chm_sens_test.html#cb279-3" tabindex="-1"></a>  , <span class="fu">paste0</span>(</span>
<span id="cb279-4"><a href="chm_sens_test.html#cb279-4" tabindex="-1"></a>    <span class="st">&quot;Data Fusion&quot;</span></span>
<span id="cb279-5"><a href="chm_sens_test.html#cb279-5" tabindex="-1"></a>    , <span class="st">&quot;</span><span class="sc">\n</span><span class="st">distribution of pile detection metrics for top &quot;</span></span>
<span id="cb279-6"><a href="chm_sens_test.html#cb279-6" tabindex="-1"></a>    , scales<span class="sc">::</span><span class="fu">percent</span>(pct_th_top,<span class="at">accuracy=</span><span class="fl">0.1</span>)</span>
<span id="cb279-7"><a href="chm_sens_test.html#cb279-7" tabindex="-1"></a>    , <span class="st">&quot; (n=&quot;</span></span>
<span id="cb279-8"><a href="chm_sens_test.html#cb279-8" tabindex="-1"></a>    , scales<span class="sc">::</span><span class="fu">comma</span>(<span class="fu">sum</span>(param_combos_spectral_ranked<span class="sc">$</span>is_top_overall), <span class="at">accuracy =</span> <span class="dv">1</span>)</span>
<span id="cb279-9"><a href="chm_sens_test.html#cb279-9" tabindex="-1"></a>    , <span class="st">&quot;) &quot;</span></span>
<span id="cb279-10"><a href="chm_sens_test.html#cb279-10" tabindex="-1"></a>    , <span class="st">&quot;overall parameter combinations</span><span class="sc">\n</span><span class="st">based on both detection and quantification accuracy&quot;</span></span>
<span id="cb279-11"><a href="chm_sens_test.html#cb279-11" tabindex="-1"></a>  )</span>
<span id="cb279-12"><a href="chm_sens_test.html#cb279-12" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-253-1.png" width="1008" /></p>
<p>what is the expected <em>quantification</em> accuracy of the top 1.0% (n=352) combinations tested?</p>
<div class="sourceCode" id="cb280"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb280-1"><a href="chm_sens_test.html#cb280-1" tabindex="-1"></a><span class="co"># plot it</span></span>
<span id="cb280-2"><a href="chm_sens_test.html#cb280-2" tabindex="-1"></a><span class="fu">plt_form_quantification_dist</span>(</span>
<span id="cb280-3"><a href="chm_sens_test.html#cb280-3" tabindex="-1"></a>  <span class="at">df =</span> param_combos_spectral_ranked <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(is_top_overall) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">!</span>tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;_pct_rank_&quot;</span>))</span>
<span id="cb280-4"><a href="chm_sens_test.html#cb280-4" tabindex="-1"></a>  , <span class="fu">paste0</span>(</span>
<span id="cb280-5"><a href="chm_sens_test.html#cb280-5" tabindex="-1"></a>    <span class="st">&quot;Structural Data Only&quot;</span></span>
<span id="cb280-6"><a href="chm_sens_test.html#cb280-6" tabindex="-1"></a>    , <span class="st">&quot;</span><span class="sc">\n</span><span class="st">distribution of pile form quantification metrics for the top &quot;</span></span>
<span id="cb280-7"><a href="chm_sens_test.html#cb280-7" tabindex="-1"></a>    , scales<span class="sc">::</span><span class="fu">percent</span>(pct_th_top,<span class="at">accuracy=</span><span class="fl">0.1</span>)</span>
<span id="cb280-8"><a href="chm_sens_test.html#cb280-8" tabindex="-1"></a>    , <span class="st">&quot; (n=&quot;</span></span>
<span id="cb280-9"><a href="chm_sens_test.html#cb280-9" tabindex="-1"></a>    , scales<span class="sc">::</span><span class="fu">comma</span>(<span class="fu">sum</span>(param_combos_spectral_ranked<span class="sc">$</span>is_top_overall), <span class="at">accuracy =</span> <span class="dv">1</span>)</span>
<span id="cb280-10"><a href="chm_sens_test.html#cb280-10" tabindex="-1"></a>    , <span class="st">&quot;) &quot;</span></span>
<span id="cb280-11"><a href="chm_sens_test.html#cb280-11" tabindex="-1"></a>    , <span class="st">&quot;overall parameter combinations</span><span class="sc">\n</span><span class="st">based on both detection and quantification accuracy&quot;</span></span>
<span id="cb280-12"><a href="chm_sens_test.html#cb280-12" tabindex="-1"></a>  )</span>
<span id="cb280-13"><a href="chm_sens_test.html#cb280-13" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-254-1.png" width="1008" /></p>
</div>
<div id="top-12-settings-1" class="section level5 hasAnchor" number="8.6.3.1.2">
<h5><span class="header-section-number">8.6.3.1.2</span> Top 12 settings<a href="chm_sens_test.html#top-12-settings-1" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>Let’s focus on the top 12 parameter settings tested to highlight the pile detection and form quantification accuracies achieved by these settings</p>
<div class="sourceCode" id="cb281"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb281-1"><a href="chm_sens_test.html#cb281-1" tabindex="-1"></a><span class="co"># pal_temp %&gt;% scales::show_col()</span></span>
<span id="cb281-2"><a href="chm_sens_test.html#cb281-2" tabindex="-1"></a><span class="co"># filter and reshape</span></span>
<span id="cb281-3"><a href="chm_sens_test.html#cb281-3" tabindex="-1"></a>param_combos_spectral_ranked <span class="sc">%&gt;%</span> </span>
<span id="cb281-4"><a href="chm_sens_test.html#cb281-4" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(is_final_selection) <span class="sc">%&gt;%</span> </span>
<span id="cb281-5"><a href="chm_sens_test.html#cb281-5" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">!</span>tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;_pct_rank_&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb281-6"><a href="chm_sens_test.html#cb281-6" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb281-7"><a href="chm_sens_test.html#cb281-7" tabindex="-1"></a>    max_ht_m,max_area_m2,convexity_pct,circle_fit_iou_pct,chm_res_m,spectral_weight</span>
<span id="cb281-8"><a href="chm_sens_test.html#cb281-8" tabindex="-1"></a>    , ovrall_lab</span>
<span id="cb281-9"><a href="chm_sens_test.html#cb281-9" tabindex="-1"></a>    <span class="co"># detection</span></span>
<span id="cb281-10"><a href="chm_sens_test.html#cb281-10" tabindex="-1"></a>    , f_score, recall, precision</span>
<span id="cb281-11"><a href="chm_sens_test.html#cb281-11" tabindex="-1"></a>    <span class="co"># quantification</span></span>
<span id="cb281-12"><a href="chm_sens_test.html#cb281-12" tabindex="-1"></a>    , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_rmse&quot;</span>)</span>
<span id="cb281-13"><a href="chm_sens_test.html#cb281-13" tabindex="-1"></a>    , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_rrmse&quot;</span>)</span>
<span id="cb281-14"><a href="chm_sens_test.html#cb281-14" tabindex="-1"></a>    , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_mean&quot;</span>)</span>
<span id="cb281-15"><a href="chm_sens_test.html#cb281-15" tabindex="-1"></a>    , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_mape&quot;</span>)</span>
<span id="cb281-16"><a href="chm_sens_test.html#cb281-16" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb281-17"><a href="chm_sens_test.html#cb281-17" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(</span>
<span id="cb281-18"><a href="chm_sens_test.html#cb281-18" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">c</span>(</span>
<span id="cb281-19"><a href="chm_sens_test.html#cb281-19" tabindex="-1"></a>      f_score, recall, precision</span>
<span id="cb281-20"><a href="chm_sens_test.html#cb281-20" tabindex="-1"></a>      , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_rmse&quot;</span>)</span>
<span id="cb281-21"><a href="chm_sens_test.html#cb281-21" tabindex="-1"></a>      , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_rrmse&quot;</span>)</span>
<span id="cb281-22"><a href="chm_sens_test.html#cb281-22" tabindex="-1"></a>      , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_mean&quot;</span>)</span>
<span id="cb281-23"><a href="chm_sens_test.html#cb281-23" tabindex="-1"></a>      , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_mape&quot;</span>)</span>
<span id="cb281-24"><a href="chm_sens_test.html#cb281-24" tabindex="-1"></a>    )</span>
<span id="cb281-25"><a href="chm_sens_test.html#cb281-25" tabindex="-1"></a>    , <span class="at">names_to =</span> <span class="st">&quot;metric&quot;</span></span>
<span id="cb281-26"><a href="chm_sens_test.html#cb281-26" tabindex="-1"></a>    , <span class="at">values_to =</span> <span class="st">&quot;value&quot;</span></span>
<span id="cb281-27"><a href="chm_sens_test.html#cb281-27" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb281-28"><a href="chm_sens_test.html#cb281-28" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb281-29"><a href="chm_sens_test.html#cb281-29" tabindex="-1"></a>    <span class="at">eval_metric =</span> stringr<span class="sc">::</span><span class="fu">str_extract</span>(metric, <span class="st">&quot;(_rmse|_rrmse|_mean|_mape|f_score|recall|precision)$&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb281-30"><a href="chm_sens_test.html#cb281-30" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_remove_all</span>(<span class="st">&quot;_&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb281-31"><a href="chm_sens_test.html#cb281-31" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_replace_all</span>(<span class="st">&quot;mean&quot;</span>,<span class="st">&quot;me&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb281-32"><a href="chm_sens_test.html#cb281-32" tabindex="-1"></a>      <span class="fu">toupper</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb281-33"><a href="chm_sens_test.html#cb281-33" tabindex="-1"></a>      <span class="fu">factor</span>(</span>
<span id="cb281-34"><a href="chm_sens_test.html#cb281-34" tabindex="-1"></a>        <span class="at">ordered =</span> T</span>
<span id="cb281-35"><a href="chm_sens_test.html#cb281-35" tabindex="-1"></a>        , <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;FSCORE&quot;</span>,<span class="st">&quot;RECALL&quot;</span>,<span class="st">&quot;PRECISION&quot;</span>, <span class="st">&quot;ME&quot;</span>,<span class="st">&quot;RMSE&quot;</span>,<span class="st">&quot;RRMSE&quot;</span>,<span class="st">&quot;MAPE&quot;</span>)</span>
<span id="cb281-36"><a href="chm_sens_test.html#cb281-36" tabindex="-1"></a>        , <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;F-score&quot;</span>,<span class="st">&quot;Recall&quot;</span>,<span class="st">&quot;Precision&quot;</span>, <span class="st">&quot;ME&quot;</span>,<span class="st">&quot;RMSE&quot;</span>,<span class="st">&quot;RRMSE&quot;</span>,<span class="st">&quot;MAPE&quot;</span>)</span>
<span id="cb281-37"><a href="chm_sens_test.html#cb281-37" tabindex="-1"></a>      )</span>
<span id="cb281-38"><a href="chm_sens_test.html#cb281-38" tabindex="-1"></a>    , <span class="at">pile_metric =</span> metric <span class="sc">%&gt;%</span> </span>
<span id="cb281-39"><a href="chm_sens_test.html#cb281-39" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_remove</span>(<span class="st">&quot;(_rmse|_rrmse|_mean|_mape)$&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb281-40"><a href="chm_sens_test.html#cb281-40" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_extract</span>(<span class="st">&quot;(paraboloid_volume|volume|area|height|diameter)&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb281-41"><a href="chm_sens_test.html#cb281-41" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">coalesce</span>(<span class="st">&quot;detection&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb281-42"><a href="chm_sens_test.html#cb281-42" tabindex="-1"></a>      <span class="fu">factor</span>(</span>
<span id="cb281-43"><a href="chm_sens_test.html#cb281-43" tabindex="-1"></a>        <span class="at">ordered =</span> T</span>
<span id="cb281-44"><a href="chm_sens_test.html#cb281-44" tabindex="-1"></a>        , <span class="at">levels =</span> <span class="fu">c</span>(</span>
<span id="cb281-45"><a href="chm_sens_test.html#cb281-45" tabindex="-1"></a>          <span class="st">&quot;detection&quot;</span></span>
<span id="cb281-46"><a href="chm_sens_test.html#cb281-46" tabindex="-1"></a>          , <span class="st">&quot;volume&quot;</span></span>
<span id="cb281-47"><a href="chm_sens_test.html#cb281-47" tabindex="-1"></a>          , <span class="st">&quot;paraboloid_volume&quot;</span></span>
<span id="cb281-48"><a href="chm_sens_test.html#cb281-48" tabindex="-1"></a>          , <span class="st">&quot;area&quot;</span></span>
<span id="cb281-49"><a href="chm_sens_test.html#cb281-49" tabindex="-1"></a>          , <span class="st">&quot;height&quot;</span></span>
<span id="cb281-50"><a href="chm_sens_test.html#cb281-50" tabindex="-1"></a>          , <span class="st">&quot;diameter&quot;</span></span>
<span id="cb281-51"><a href="chm_sens_test.html#cb281-51" tabindex="-1"></a>        )</span>
<span id="cb281-52"><a href="chm_sens_test.html#cb281-52" tabindex="-1"></a>        , <span class="at">labels =</span> <span class="fu">c</span>(</span>
<span id="cb281-53"><a href="chm_sens_test.html#cb281-53" tabindex="-1"></a>          <span class="st">&quot;Detection&quot;</span></span>
<span id="cb281-54"><a href="chm_sens_test.html#cb281-54" tabindex="-1"></a>          , <span class="st">&quot;Volume&quot;</span></span>
<span id="cb281-55"><a href="chm_sens_test.html#cb281-55" tabindex="-1"></a>          , <span class="st">&quot;Volume paraboloid&quot;</span></span>
<span id="cb281-56"><a href="chm_sens_test.html#cb281-56" tabindex="-1"></a>          , <span class="st">&quot;Area (m2)&quot;</span></span>
<span id="cb281-57"><a href="chm_sens_test.html#cb281-57" tabindex="-1"></a>          , <span class="st">&quot;Height (m)&quot;</span></span>
<span id="cb281-58"><a href="chm_sens_test.html#cb281-58" tabindex="-1"></a>          , <span class="st">&quot;Diameter (m)&quot;</span></span>
<span id="cb281-59"><a href="chm_sens_test.html#cb281-59" tabindex="-1"></a>        )</span>
<span id="cb281-60"><a href="chm_sens_test.html#cb281-60" tabindex="-1"></a>      )</span>
<span id="cb281-61"><a href="chm_sens_test.html#cb281-61" tabindex="-1"></a>    , <span class="at">value_lab =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb281-62"><a href="chm_sens_test.html#cb281-62" tabindex="-1"></a>        eval_metric <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;F-score&quot;</span>,<span class="st">&quot;Recall&quot;</span>,<span class="st">&quot;Precision&quot;</span>, <span class="st">&quot;RRMSE&quot;</span>, <span class="st">&quot;MAPE&quot;</span>) <span class="sc">~</span> scales<span class="sc">::</span><span class="fu">percent</span>(value,<span class="at">accuracy=</span><span class="fl">0.1</span>)</span>
<span id="cb281-63"><a href="chm_sens_test.html#cb281-63" tabindex="-1"></a>        , eval_metric <span class="sc">==</span> <span class="st">&quot;ME&quot;</span> <span class="sc">~</span> scales<span class="sc">::</span><span class="fu">comma</span>(value,<span class="at">accuracy=</span><span class="fl">0.01</span>)</span>
<span id="cb281-64"><a href="chm_sens_test.html#cb281-64" tabindex="-1"></a>        , T <span class="sc">~</span> scales<span class="sc">::</span><span class="fu">comma</span>(value,<span class="at">accuracy=</span><span class="fl">0.1</span>)</span>
<span id="cb281-65"><a href="chm_sens_test.html#cb281-65" tabindex="-1"></a>      )</span>
<span id="cb281-66"><a href="chm_sens_test.html#cb281-66" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb281-67"><a href="chm_sens_test.html#cb281-67" tabindex="-1"></a>  <span class="co"># make var for color</span></span>
<span id="cb281-68"><a href="chm_sens_test.html#cb281-68" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(pile_metric, eval_metric) <span class="sc">%&gt;%</span> </span>
<span id="cb281-69"><a href="chm_sens_test.html#cb281-69" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb281-70"><a href="chm_sens_test.html#cb281-70" tabindex="-1"></a>    <span class="co"># for ME, color by abs...for f-score,recall,precision color by -value so that higher means better...</span></span>
<span id="cb281-71"><a href="chm_sens_test.html#cb281-71" tabindex="-1"></a>      <span class="co"># ...since higher means worse for quantification accuracy metrics</span></span>
<span id="cb281-72"><a href="chm_sens_test.html#cb281-72" tabindex="-1"></a>    <span class="at">value_dir =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb281-73"><a href="chm_sens_test.html#cb281-73" tabindex="-1"></a>      eval_metric <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;ME&quot;</span>) <span class="sc">~</span> <span class="fu">abs</span>(value)</span>
<span id="cb281-74"><a href="chm_sens_test.html#cb281-74" tabindex="-1"></a>      , eval_metric <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;F-score&quot;</span>,<span class="st">&quot;Recall&quot;</span>,<span class="st">&quot;Precision&quot;</span>) <span class="sc">~</span> <span class="sc">-</span>value</span>
<span id="cb281-75"><a href="chm_sens_test.html#cb281-75" tabindex="-1"></a>      , T <span class="sc">~</span> value</span>
<span id="cb281-76"><a href="chm_sens_test.html#cb281-76" tabindex="-1"></a>    )</span>
<span id="cb281-77"><a href="chm_sens_test.html#cb281-77" tabindex="-1"></a>    , <span class="at">value_z =</span> (value_dir<span class="sc">-</span><span class="fu">mean</span>(value_dir,<span class="at">na.rm=</span>T))<span class="sc">/</span><span class="fu">sd</span>(value_dir,<span class="at">na.rm=</span>T) <span class="co"># this is the key to the different colors within facets</span></span>
<span id="cb281-78"><a href="chm_sens_test.html#cb281-78" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb281-79"><a href="chm_sens_test.html#cb281-79" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb281-80"><a href="chm_sens_test.html#cb281-80" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span>eval_metric <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;RRMSE&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb281-81"><a href="chm_sens_test.html#cb281-81" tabindex="-1"></a>  <span class="co"># View()</span></span>
<span id="cb281-82"><a href="chm_sens_test.html#cb281-82" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> eval_metric, <span class="at">y =</span> ovrall_lab)) <span class="sc">+</span> </span>
<span id="cb281-83"><a href="chm_sens_test.html#cb281-83" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_tile</span>(</span>
<span id="cb281-84"><a href="chm_sens_test.html#cb281-84" tabindex="-1"></a>    <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">fill =</span> pile_metric, <span class="at">alpha =</span> <span class="sc">-</span>value_z)</span>
<span id="cb281-85"><a href="chm_sens_test.html#cb281-85" tabindex="-1"></a>    , <span class="at">color =</span> <span class="st">&quot;gray&quot;</span></span>
<span id="cb281-86"><a href="chm_sens_test.html#cb281-86" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb281-87"><a href="chm_sens_test.html#cb281-87" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_text</span>(</span>
<span id="cb281-88"><a href="chm_sens_test.html#cb281-88" tabindex="-1"></a>    <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">label =</span> value_lab, <span class="at">fontface =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb281-89"><a href="chm_sens_test.html#cb281-89" tabindex="-1"></a>    , <span class="at">color =</span> <span class="st">&quot;white&quot;</span></span>
<span id="cb281-90"><a href="chm_sens_test.html#cb281-90" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb281-91"><a href="chm_sens_test.html#cb281-91" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">facet_grid</span>(<span class="at">cols =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(pile_metric), <span class="at">scales =</span> <span class="st">&quot;free_x&quot;</span>) <span class="sc">+</span> </span>
<span id="cb281-92"><a href="chm_sens_test.html#cb281-92" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_x_discrete</span>(<span class="at">position =</span> <span class="st">&quot;top&quot;</span>) <span class="sc">+</span></span>
<span id="cb281-93"><a href="chm_sens_test.html#cb281-93" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;gray33&quot;</span>, harrypotter<span class="sc">::</span><span class="fu">hp</span>(<span class="at">n=</span><span class="dv">3</span>,<span class="at">option =</span> <span class="st">&quot;hermionegranger&quot;</span>) )) <span class="sc">+</span></span>
<span id="cb281-94"><a href="chm_sens_test.html#cb281-94" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_alpha_binned</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="fl">0.55</span>, <span class="dv">1</span>)) <span class="sc">+</span> <span class="co"># this is the key to the different colors within facets</span></span>
<span id="cb281-95"><a href="chm_sens_test.html#cb281-95" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb281-96"><a href="chm_sens_test.html#cb281-96" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb281-97"><a href="chm_sens_test.html#cb281-97" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;&quot;</span></span>
<span id="cb281-98"><a href="chm_sens_test.html#cb281-98" tabindex="-1"></a>    , <span class="at">y =</span> <span class="st">&quot;max_ht_m : max_area_m2 : convexity_pct : circle_fit_iou_pct : chm_res_m : spectral_weight&quot;</span></span>
<span id="cb281-99"><a href="chm_sens_test.html#cb281-99" tabindex="-1"></a>    , <span class="at">subtitle =</span> <span class="fu">paste0</span>(</span>
<span id="cb281-100"><a href="chm_sens_test.html#cb281-100" tabindex="-1"></a>       <span class="st">&quot;Data Fusion&quot;</span></span>
<span id="cb281-101"><a href="chm_sens_test.html#cb281-101" tabindex="-1"></a>       , <span class="st">&quot;</span><span class="sc">\n</span><span class="st">pile detection and form quantification accuracy metrics for the top parameter settings tested&quot;</span></span>
<span id="cb281-102"><a href="chm_sens_test.html#cb281-102" tabindex="-1"></a>       <span class="co"># , scales::percent(1-pct_rank_th_top,accuracy=1)</span></span>
<span id="cb281-103"><a href="chm_sens_test.html#cb281-103" tabindex="-1"></a>       , <span class="st">&quot; (n=&quot;</span></span>
<span id="cb281-104"><a href="chm_sens_test.html#cb281-104" tabindex="-1"></a>       , scales<span class="sc">::</span><span class="fu">comma</span>(n_th_top,<span class="at">accuracy=</span><span class="dv">1</span>)</span>
<span id="cb281-105"><a href="chm_sens_test.html#cb281-105" tabindex="-1"></a>       , <span class="st">&quot;) &quot;</span></span>
<span id="cb281-106"><a href="chm_sens_test.html#cb281-106" tabindex="-1"></a>       , <span class="st">&quot;</span><span class="sc">\n</span><span class="st">based on both detection and quantification accuracy&quot;</span></span>
<span id="cb281-107"><a href="chm_sens_test.html#cb281-107" tabindex="-1"></a>      )</span>
<span id="cb281-108"><a href="chm_sens_test.html#cb281-108" tabindex="-1"></a>    , <span class="at">caption =</span> <span class="st">&quot;*darker colors indicate relatively higher accuracy values&quot;</span></span>
<span id="cb281-109"><a href="chm_sens_test.html#cb281-109" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb281-110"><a href="chm_sens_test.html#cb281-110" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb281-111"><a href="chm_sens_test.html#cb281-111" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb281-112"><a href="chm_sens_test.html#cb281-112" tabindex="-1"></a>    , <span class="at">panel.grid =</span> ggplot2<span class="sc">::</span><span class="fu">element_blank</span>()</span>
<span id="cb281-113"><a href="chm_sens_test.html#cb281-113" tabindex="-1"></a>    , <span class="at">strip.placement =</span> <span class="st">&quot;outside&quot;</span></span>
<span id="cb281-114"><a href="chm_sens_test.html#cb281-114" tabindex="-1"></a>    , <span class="at">strip.text.x =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb281-115"><a href="chm_sens_test.html#cb281-115" tabindex="-1"></a>    , <span class="at">axis.text.x =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">7</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb281-116"><a href="chm_sens_test.html#cb281-116" tabindex="-1"></a>    , <span class="at">axis.title.x =</span> ggplot2<span class="sc">::</span><span class="fu">element_blank</span>()</span>
<span id="cb281-117"><a href="chm_sens_test.html#cb281-117" tabindex="-1"></a>    , <span class="at">plot.subtitle =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>)</span>
<span id="cb281-118"><a href="chm_sens_test.html#cb281-118" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-255-1.png" width="1008" /></p>
<p>this plot allows for a simultaneous comparison of all metrics for pile detection and pile form quantification. it includes only the parameter combinations that achieved the best balanced accuracy, helping users identify the optimal settings by evaluating the trade-offs between detection and form quantification.</p>
<p>let’s table this</p>
<div class="sourceCode" id="cb282"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb282-1"><a href="chm_sens_test.html#cb282-1" tabindex="-1"></a>param_combos_spectral_ranked <span class="sc">%&gt;%</span> </span>
<span id="cb282-2"><a href="chm_sens_test.html#cb282-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(is_final_selection) <span class="sc">%&gt;%</span> </span>
<span id="cb282-3"><a href="chm_sens_test.html#cb282-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">!</span>tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;_pct_rank_&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb282-4"><a href="chm_sens_test.html#cb282-4" tabindex="-1"></a>  <span class="co"># first select to arrange eval_metric</span></span>
<span id="cb282-5"><a href="chm_sens_test.html#cb282-5" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb282-6"><a href="chm_sens_test.html#cb282-6" tabindex="-1"></a>    ovrall_lab</span>
<span id="cb282-7"><a href="chm_sens_test.html#cb282-7" tabindex="-1"></a>    , max_ht_m,max_area_m2,convexity_pct,circle_fit_iou_pct,chm_res_m,spectral_weight</span>
<span id="cb282-8"><a href="chm_sens_test.html#cb282-8" tabindex="-1"></a>    <span class="co"># detection</span></span>
<span id="cb282-9"><a href="chm_sens_test.html#cb282-9" tabindex="-1"></a>    , f_score, recall, precision</span>
<span id="cb282-10"><a href="chm_sens_test.html#cb282-10" tabindex="-1"></a>    <span class="co"># quantification</span></span>
<span id="cb282-11"><a href="chm_sens_test.html#cb282-11" tabindex="-1"></a>    , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_mean&quot;</span>)</span>
<span id="cb282-12"><a href="chm_sens_test.html#cb282-12" tabindex="-1"></a>    , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_rmse&quot;</span>)</span>
<span id="cb282-13"><a href="chm_sens_test.html#cb282-13" tabindex="-1"></a>    <span class="co"># , tidyselect::ends_with(&quot;_rrmse&quot;)</span></span>
<span id="cb282-14"><a href="chm_sens_test.html#cb282-14" tabindex="-1"></a>    , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_mape&quot;</span>)</span>
<span id="cb282-15"><a href="chm_sens_test.html#cb282-15" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb282-16"><a href="chm_sens_test.html#cb282-16" tabindex="-1"></a>  <span class="co"># second select to arrange pile_metric</span></span>
<span id="cb282-17"><a href="chm_sens_test.html#cb282-17" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb282-18"><a href="chm_sens_test.html#cb282-18" tabindex="-1"></a>    ovrall_lab</span>
<span id="cb282-19"><a href="chm_sens_test.html#cb282-19" tabindex="-1"></a>    , max_ht_m,max_area_m2,convexity_pct,circle_fit_iou_pct,chm_res_m,spectral_weight</span>
<span id="cb282-20"><a href="chm_sens_test.html#cb282-20" tabindex="-1"></a>    <span class="co"># detection</span></span>
<span id="cb282-21"><a href="chm_sens_test.html#cb282-21" tabindex="-1"></a>    , f_score, recall, precision</span>
<span id="cb282-22"><a href="chm_sens_test.html#cb282-22" tabindex="-1"></a>    <span class="co"># quantification</span></span>
<span id="cb282-23"><a href="chm_sens_test.html#cb282-23" tabindex="-1"></a>    , <span class="fu">c</span>(tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;volume&quot;</span>) <span class="sc">&amp;</span> <span class="sc">!</span>tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;paraboloid&quot;</span>))</span>
<span id="cb282-24"><a href="chm_sens_test.html#cb282-24" tabindex="-1"></a>    , tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;area&quot;</span>)</span>
<span id="cb282-25"><a href="chm_sens_test.html#cb282-25" tabindex="-1"></a>    , tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;height&quot;</span>)</span>
<span id="cb282-26"><a href="chm_sens_test.html#cb282-26" tabindex="-1"></a>    , tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;diameter&quot;</span>)</span>
<span id="cb282-27"><a href="chm_sens_test.html#cb282-27" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb282-28"><a href="chm_sens_test.html#cb282-28" tabindex="-1"></a>  <span class="co"># names()</span></span>
<span id="cb282-29"><a href="chm_sens_test.html#cb282-29" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb282-30"><a href="chm_sens_test.html#cb282-30" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">across</span>(</span>
<span id="cb282-31"><a href="chm_sens_test.html#cb282-31" tabindex="-1"></a>      <span class="at">.cols =</span> <span class="fu">c</span>(f_score, recall, precision, tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_mape&quot;</span>))</span>
<span id="cb282-32"><a href="chm_sens_test.html#cb282-32" tabindex="-1"></a>      , <span class="at">.fn =</span> <span class="sc">~</span> scales<span class="sc">::</span><span class="fu">percent</span>(.x, <span class="at">accuracy =</span> <span class="dv">1</span>)</span>
<span id="cb282-33"><a href="chm_sens_test.html#cb282-33" tabindex="-1"></a>    )</span>
<span id="cb282-34"><a href="chm_sens_test.html#cb282-34" tabindex="-1"></a>    , dplyr<span class="sc">::</span><span class="fu">across</span>(</span>
<span id="cb282-35"><a href="chm_sens_test.html#cb282-35" tabindex="-1"></a>      <span class="at">.cols =</span> <span class="fu">c</span>(tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_mean&quot;</span>))</span>
<span id="cb282-36"><a href="chm_sens_test.html#cb282-36" tabindex="-1"></a>      , <span class="at">.fn =</span> <span class="sc">~</span> scales<span class="sc">::</span><span class="fu">comma</span>(.x, <span class="at">accuracy =</span> <span class="fl">0.01</span>)</span>
<span id="cb282-37"><a href="chm_sens_test.html#cb282-37" tabindex="-1"></a>    )</span>
<span id="cb282-38"><a href="chm_sens_test.html#cb282-38" tabindex="-1"></a>    , dplyr<span class="sc">::</span><span class="fu">across</span>(</span>
<span id="cb282-39"><a href="chm_sens_test.html#cb282-39" tabindex="-1"></a>      <span class="at">.cols =</span> <span class="fu">c</span>(tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_rmse&quot;</span>))</span>
<span id="cb282-40"><a href="chm_sens_test.html#cb282-40" tabindex="-1"></a>      , <span class="at">.fn =</span> <span class="sc">~</span> scales<span class="sc">::</span><span class="fu">comma</span>(.x, <span class="at">accuracy =</span> <span class="fl">0.1</span>)</span>
<span id="cb282-41"><a href="chm_sens_test.html#cb282-41" tabindex="-1"></a>    )</span>
<span id="cb282-42"><a href="chm_sens_test.html#cb282-42" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb282-43"><a href="chm_sens_test.html#cb282-43" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">blank=</span> <span class="st">&quot;   &quot;</span> ) <span class="sc">%&gt;%</span> </span>
<span id="cb282-44"><a href="chm_sens_test.html#cb282-44" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">relocate</span>(blank, <span class="at">.before =</span> f_score) <span class="sc">%&gt;%</span> </span>
<span id="cb282-45"><a href="chm_sens_test.html#cb282-45" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(<span class="fu">desc</span>(ovrall_lab)) <span class="sc">%&gt;%</span> </span>
<span id="cb282-46"><a href="chm_sens_test.html#cb282-46" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kbl</span>(</span>
<span id="cb282-47"><a href="chm_sens_test.html#cb282-47" tabindex="-1"></a>    <span class="at">caption =</span> </span>
<span id="cb282-48"><a href="chm_sens_test.html#cb282-48" tabindex="-1"></a>      <span class="fu">paste0</span>(</span>
<span id="cb282-49"><a href="chm_sens_test.html#cb282-49" tabindex="-1"></a>       <span class="st">&quot;Data Fusion&quot;</span></span>
<span id="cb282-50"><a href="chm_sens_test.html#cb282-50" tabindex="-1"></a>       , <span class="st">&quot;&lt;br&gt;pile detection and form quantification accuracy metrics for the top parameter settings tested&quot;</span></span>
<span id="cb282-51"><a href="chm_sens_test.html#cb282-51" tabindex="-1"></a>       <span class="co"># , scales::percent(1-pct_rank_th_top,accuracy=1)</span></span>
<span id="cb282-52"><a href="chm_sens_test.html#cb282-52" tabindex="-1"></a>       , <span class="st">&quot; (n=&quot;</span></span>
<span id="cb282-53"><a href="chm_sens_test.html#cb282-53" tabindex="-1"></a>       , scales<span class="sc">::</span><span class="fu">comma</span>(n_th_top,<span class="at">accuracy=</span><span class="dv">1</span>)</span>
<span id="cb282-54"><a href="chm_sens_test.html#cb282-54" tabindex="-1"></a>       , <span class="st">&quot;) &quot;</span></span>
<span id="cb282-55"><a href="chm_sens_test.html#cb282-55" tabindex="-1"></a>       , <span class="st">&quot;&lt;br&gt;based on both detection and quantification accuracy&quot;</span></span>
<span id="cb282-56"><a href="chm_sens_test.html#cb282-56" tabindex="-1"></a>      )</span>
<span id="cb282-57"><a href="chm_sens_test.html#cb282-57" tabindex="-1"></a>    , <span class="at">col.names =</span> <span class="fu">c</span>(</span>
<span id="cb282-58"><a href="chm_sens_test.html#cb282-58" tabindex="-1"></a>      <span class="st">&quot;&quot;</span></span>
<span id="cb282-59"><a href="chm_sens_test.html#cb282-59" tabindex="-1"></a>      ,<span class="st">&quot;max_ht_m&quot;</span>,<span class="st">&quot;max_area_m2&quot;</span>,<span class="st">&quot;convexity_pct&quot;</span>,<span class="st">&quot;circle_fit_iou_pct&quot;</span>,<span class="st">&quot;chm_res_m&quot;</span>,<span class="st">&quot;spectral_weight&quot;</span></span>
<span id="cb282-60"><a href="chm_sens_test.html#cb282-60" tabindex="-1"></a>      , <span class="st">&quot;   &quot;</span></span>
<span id="cb282-61"><a href="chm_sens_test.html#cb282-61" tabindex="-1"></a>      , <span class="st">&quot;F-score&quot;</span>, <span class="st">&quot;Recall&quot;</span>, <span class="st">&quot;Precision&quot;</span></span>
<span id="cb282-62"><a href="chm_sens_test.html#cb282-62" tabindex="-1"></a>      , <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;ME&quot;</span>,<span class="st">&quot;RMSE&quot;</span>,<span class="st">&quot;MAPE&quot;</span>), <span class="at">times =</span> <span class="dv">3</span>)</span>
<span id="cb282-63"><a href="chm_sens_test.html#cb282-63" tabindex="-1"></a>    )</span>
<span id="cb282-64"><a href="chm_sens_test.html#cb282-64" tabindex="-1"></a>    , <span class="at">escape =</span> F</span>
<span id="cb282-65"><a href="chm_sens_test.html#cb282-65" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb282-66"><a href="chm_sens_test.html#cb282-66" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kable_styling</span>(<span class="at">font_size =</span> <span class="dv">11</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb282-67"><a href="chm_sens_test.html#cb282-67" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">add_header_above</span>(<span class="fu">c</span>(</span>
<span id="cb282-68"><a href="chm_sens_test.html#cb282-68" tabindex="-1"></a>    <span class="st">&quot; &quot;</span><span class="ot">=</span><span class="dv">8</span></span>
<span id="cb282-69"><a href="chm_sens_test.html#cb282-69" tabindex="-1"></a>    , <span class="st">&quot;Detection&quot;</span> <span class="ot">=</span> <span class="dv">3</span></span>
<span id="cb282-70"><a href="chm_sens_test.html#cb282-70" tabindex="-1"></a>    <span class="co"># , &quot;Volume&quot; = 3</span></span>
<span id="cb282-71"><a href="chm_sens_test.html#cb282-71" tabindex="-1"></a>    , <span class="st">&quot;Area&quot;</span> <span class="ot">=</span> <span class="dv">3</span></span>
<span id="cb282-72"><a href="chm_sens_test.html#cb282-72" tabindex="-1"></a>    , <span class="st">&quot;Height&quot;</span> <span class="ot">=</span> <span class="dv">3</span></span>
<span id="cb282-73"><a href="chm_sens_test.html#cb282-73" tabindex="-1"></a>    , <span class="st">&quot;Diameter&quot;</span> <span class="ot">=</span> <span class="dv">3</span></span>
<span id="cb282-74"><a href="chm_sens_test.html#cb282-74" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb282-75"><a href="chm_sens_test.html#cb282-75" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">column_spec</span>(<span class="fu">seq</span>(<span class="dv">8</span>,<span class="dv">20</span>,<span class="at">by=</span><span class="dv">3</span>), <span class="at">border_right =</span> <span class="cn">TRUE</span>, <span class="at">include_thead =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb282-76"><a href="chm_sens_test.html#cb282-76" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">column_spec</span>(</span>
<span id="cb282-77"><a href="chm_sens_test.html#cb282-77" tabindex="-1"></a>    <span class="at">column =</span> <span class="dv">8</span><span class="sc">:</span><span class="dv">20</span></span>
<span id="cb282-78"><a href="chm_sens_test.html#cb282-78" tabindex="-1"></a>    , <span class="at">extra_css =</span> <span class="st">&quot;font-size: 10px;&quot;</span></span>
<span id="cb282-79"><a href="chm_sens_test.html#cb282-79" tabindex="-1"></a>    , <span class="at">include_thead =</span> T</span>
<span id="cb282-80"><a href="chm_sens_test.html#cb282-80" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb282-81"><a href="chm_sens_test.html#cb282-81" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">scroll_box</span>(<span class="at">width =</span> <span class="st">&quot;740px&quot;</span>) </span></code></pre></div>
<div style="border: 1px solid #ddd; padding: 5px; overflow-x: scroll; width:740px; ">
<table class="table" style="font-size: 11px; margin-left: auto; margin-right: auto;">
<caption style="font-size: initial !important;">
<span id="tab:unnamed-chunk-256">Table 8.3: </span>Data Fusion<br>pile detection and form quantification accuracy metrics for the top parameter settings tested (n=12) <br>based on both detection and quantification accuracy
</caption>
<thead>
<tr>
<th style="empty-cells: hide;border-bottom:hidden;" colspan="8">
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="3">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Detection
</div>
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="3">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Area
</div>
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="3">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Height
</div>
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="3">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Diameter
</div>
</th>
</tr>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
max_ht_m
</th>
<th style="text-align:right;">
max_area_m2
</th>
<th style="text-align:right;">
convexity_pct
</th>
<th style="text-align:right;">
circle_fit_iou_pct
</th>
<th style="text-align:right;">
chm_res_m
</th>
<th style="text-align:right;">
spectral_weight
</th>
<th style="text-align:left;border-right:1px solid;font-size: 10px;">
</th>
<th style="text-align:left;font-size: 10px;">
F-score
</th>
<th style="text-align:left;font-size: 10px;">
Recall
</th>
<th style="text-align:left;border-right:1px solid;font-size: 10px;">
Precision
</th>
<th style="text-align:left;font-size: 10px;">
ME
</th>
<th style="text-align:left;font-size: 10px;">
RMSE
</th>
<th style="text-align:left;border-right:1px solid;font-size: 10px;">
MAPE
</th>
<th style="text-align:left;font-size: 10px;">
ME
</th>
<th style="text-align:left;font-size: 10px;">
RMSE
</th>
<th style="text-align:left;border-right:1px solid;font-size: 10px;">
MAPE
</th>
<th style="text-align:left;font-size: 10px;">
ME
</th>
<th style="text-align:left;font-size: 10px;">
RMSE
</th>
<th style="text-align:left;border-right:1px solid;font-size: 10px;">
MAPE
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
5:60:0.8:0.65:0.1:4
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
60
</td>
<td style="text-align:right;">
0.80
</td>
<td style="text-align:right;">
0.65
</td>
<td style="text-align:right;">
0.1
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
89%
</td>
<td style="text-align:left;font-size: 10px;">
90%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
88%
</td>
<td style="text-align:left;font-size: 10px;">
-0.80
</td>
<td style="text-align:left;font-size: 10px;">
2.1
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
10%
</td>
<td style="text-align:left;font-size: 10px;">
-0.10
</td>
<td style="text-align:left;font-size: 10px;">
0.6
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
18%
</td>
<td style="text-align:left;font-size: 10px;">
0.21
</td>
<td style="text-align:left;font-size: 10px;">
0.5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
10%
</td>
</tr>
<tr>
<td style="text-align:left;">
5:50:0.8:0.65:0.1:4
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
50
</td>
<td style="text-align:right;">
0.80
</td>
<td style="text-align:right;">
0.65
</td>
<td style="text-align:right;">
0.1
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
89%
</td>
<td style="text-align:left;font-size: 10px;">
90%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
88%
</td>
<td style="text-align:left;font-size: 10px;">
-0.80
</td>
<td style="text-align:left;font-size: 10px;">
2.1
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
10%
</td>
<td style="text-align:left;font-size: 10px;">
-0.10
</td>
<td style="text-align:left;font-size: 10px;">
0.6
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
18%
</td>
<td style="text-align:left;font-size: 10px;">
0.21
</td>
<td style="text-align:left;font-size: 10px;">
0.5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
10%
</td>
</tr>
<tr>
<td style="text-align:left;">
5:60:0.65:0.65:0.1:4
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
60
</td>
<td style="text-align:right;">
0.65
</td>
<td style="text-align:right;">
0.65
</td>
<td style="text-align:right;">
0.1
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
89%
</td>
<td style="text-align:left;font-size: 10px;">
91%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
87%
</td>
<td style="text-align:left;font-size: 10px;">
-0.81
</td>
<td style="text-align:left;font-size: 10px;">
2.1
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
10%
</td>
<td style="text-align:left;font-size: 10px;">
-0.09
</td>
<td style="text-align:left;font-size: 10px;">
0.6
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
18%
</td>
<td style="text-align:left;font-size: 10px;">
0.21
</td>
<td style="text-align:left;font-size: 10px;">
0.5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
10%
</td>
</tr>
<tr>
<td style="text-align:left;">
5:60:0.5:0.65:0.1:4
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
60
</td>
<td style="text-align:right;">
0.50
</td>
<td style="text-align:right;">
0.65
</td>
<td style="text-align:right;">
0.1
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
89%
</td>
<td style="text-align:left;font-size: 10px;">
91%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
87%
</td>
<td style="text-align:left;font-size: 10px;">
-0.81
</td>
<td style="text-align:left;font-size: 10px;">
2.1
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
10%
</td>
<td style="text-align:left;font-size: 10px;">
-0.09
</td>
<td style="text-align:left;font-size: 10px;">
0.6
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
18%
</td>
<td style="text-align:left;font-size: 10px;">
0.21
</td>
<td style="text-align:left;font-size: 10px;">
0.5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
10%
</td>
</tr>
<tr>
<td style="text-align:left;">
5:60:0.35:0.65:0.1:4
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
60
</td>
<td style="text-align:right;">
0.35
</td>
<td style="text-align:right;">
0.65
</td>
<td style="text-align:right;">
0.1
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
89%
</td>
<td style="text-align:left;font-size: 10px;">
91%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
87%
</td>
<td style="text-align:left;font-size: 10px;">
-0.81
</td>
<td style="text-align:left;font-size: 10px;">
2.1
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
10%
</td>
<td style="text-align:left;font-size: 10px;">
-0.09
</td>
<td style="text-align:left;font-size: 10px;">
0.6
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
18%
</td>
<td style="text-align:left;font-size: 10px;">
0.21
</td>
<td style="text-align:left;font-size: 10px;">
0.5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
10%
</td>
</tr>
<tr>
<td style="text-align:left;">
5:60:0.2:0.65:0.1:4
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
60
</td>
<td style="text-align:right;">
0.20
</td>
<td style="text-align:right;">
0.65
</td>
<td style="text-align:right;">
0.1
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
89%
</td>
<td style="text-align:left;font-size: 10px;">
91%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
87%
</td>
<td style="text-align:left;font-size: 10px;">
-0.81
</td>
<td style="text-align:left;font-size: 10px;">
2.1
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
10%
</td>
<td style="text-align:left;font-size: 10px;">
-0.09
</td>
<td style="text-align:left;font-size: 10px;">
0.6
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
18%
</td>
<td style="text-align:left;font-size: 10px;">
0.21
</td>
<td style="text-align:left;font-size: 10px;">
0.5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
10%
</td>
</tr>
<tr>
<td style="text-align:left;">
5:60:0.05:0.65:0.1:4
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
60
</td>
<td style="text-align:right;">
0.05
</td>
<td style="text-align:right;">
0.65
</td>
<td style="text-align:right;">
0.1
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
89%
</td>
<td style="text-align:left;font-size: 10px;">
91%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
87%
</td>
<td style="text-align:left;font-size: 10px;">
-0.81
</td>
<td style="text-align:left;font-size: 10px;">
2.1
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
10%
</td>
<td style="text-align:left;font-size: 10px;">
-0.09
</td>
<td style="text-align:left;font-size: 10px;">
0.6
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
18%
</td>
<td style="text-align:left;font-size: 10px;">
0.21
</td>
<td style="text-align:left;font-size: 10px;">
0.5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
10%
</td>
</tr>
<tr>
<td style="text-align:left;">
5:50:0.65:0.65:0.1:4
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
50
</td>
<td style="text-align:right;">
0.65
</td>
<td style="text-align:right;">
0.65
</td>
<td style="text-align:right;">
0.1
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
89%
</td>
<td style="text-align:left;font-size: 10px;">
91%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
87%
</td>
<td style="text-align:left;font-size: 10px;">
-0.81
</td>
<td style="text-align:left;font-size: 10px;">
2.1
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
10%
</td>
<td style="text-align:left;font-size: 10px;">
-0.09
</td>
<td style="text-align:left;font-size: 10px;">
0.6
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
18%
</td>
<td style="text-align:left;font-size: 10px;">
0.21
</td>
<td style="text-align:left;font-size: 10px;">
0.5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
10%
</td>
</tr>
<tr>
<td style="text-align:left;">
5:50:0.5:0.65:0.1:4
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
50
</td>
<td style="text-align:right;">
0.50
</td>
<td style="text-align:right;">
0.65
</td>
<td style="text-align:right;">
0.1
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
89%
</td>
<td style="text-align:left;font-size: 10px;">
91%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
87%
</td>
<td style="text-align:left;font-size: 10px;">
-0.81
</td>
<td style="text-align:left;font-size: 10px;">
2.1
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
10%
</td>
<td style="text-align:left;font-size: 10px;">
-0.09
</td>
<td style="text-align:left;font-size: 10px;">
0.6
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
18%
</td>
<td style="text-align:left;font-size: 10px;">
0.21
</td>
<td style="text-align:left;font-size: 10px;">
0.5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
10%
</td>
</tr>
<tr>
<td style="text-align:left;">
5:50:0.35:0.65:0.1:4
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
50
</td>
<td style="text-align:right;">
0.35
</td>
<td style="text-align:right;">
0.65
</td>
<td style="text-align:right;">
0.1
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
89%
</td>
<td style="text-align:left;font-size: 10px;">
91%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
87%
</td>
<td style="text-align:left;font-size: 10px;">
-0.81
</td>
<td style="text-align:left;font-size: 10px;">
2.1
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
10%
</td>
<td style="text-align:left;font-size: 10px;">
-0.09
</td>
<td style="text-align:left;font-size: 10px;">
0.6
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
18%
</td>
<td style="text-align:left;font-size: 10px;">
0.21
</td>
<td style="text-align:left;font-size: 10px;">
0.5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
10%
</td>
</tr>
<tr>
<td style="text-align:left;">
5:50:0.2:0.65:0.1:4
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
50
</td>
<td style="text-align:right;">
0.20
</td>
<td style="text-align:right;">
0.65
</td>
<td style="text-align:right;">
0.1
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
89%
</td>
<td style="text-align:left;font-size: 10px;">
91%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
87%
</td>
<td style="text-align:left;font-size: 10px;">
-0.81
</td>
<td style="text-align:left;font-size: 10px;">
2.1
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
10%
</td>
<td style="text-align:left;font-size: 10px;">
-0.09
</td>
<td style="text-align:left;font-size: 10px;">
0.6
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
18%
</td>
<td style="text-align:left;font-size: 10px;">
0.21
</td>
<td style="text-align:left;font-size: 10px;">
0.5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
10%
</td>
</tr>
<tr>
<td style="text-align:left;">
5:50:0.05:0.65:0.1:4
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
50
</td>
<td style="text-align:right;">
0.05
</td>
<td style="text-align:right;">
0.65
</td>
<td style="text-align:right;">
0.1
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
89%
</td>
<td style="text-align:left;font-size: 10px;">
91%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
87%
</td>
<td style="text-align:left;font-size: 10px;">
-0.81
</td>
<td style="text-align:left;font-size: 10px;">
2.1
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
10%
</td>
<td style="text-align:left;font-size: 10px;">
-0.09
</td>
<td style="text-align:left;font-size: 10px;">
0.6
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
18%
</td>
<td style="text-align:left;font-size: 10px;">
0.21
</td>
<td style="text-align:left;font-size: 10px;">
0.5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
10%
</td>
</tr>
</tbody>
</table>
</div>
<p>what is the expected <em>detection</em> accuracy of the top 12 settings?</p>
<div class="sourceCode" id="cb283"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb283-1"><a href="chm_sens_test.html#cb283-1" tabindex="-1"></a><span class="fu">plt_detection_dist</span>(</span>
<span id="cb283-2"><a href="chm_sens_test.html#cb283-2" tabindex="-1"></a>  <span class="at">df =</span> param_combos_spectral_ranked <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(is_final_selection) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">!</span>tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;_pct_rank_&quot;</span>))</span>
<span id="cb283-3"><a href="chm_sens_test.html#cb283-3" tabindex="-1"></a>  , <span class="fu">paste0</span>(</span>
<span id="cb283-4"><a href="chm_sens_test.html#cb283-4" tabindex="-1"></a>    <span class="st">&quot;Data Fusion&quot;</span></span>
<span id="cb283-5"><a href="chm_sens_test.html#cb283-5" tabindex="-1"></a>    , <span class="st">&quot;</span><span class="sc">\n</span><span class="st">distribution of pile detection metrics for the top parameter settings tested&quot;</span></span>
<span id="cb283-6"><a href="chm_sens_test.html#cb283-6" tabindex="-1"></a>    , <span class="st">&quot; (n=&quot;</span></span>
<span id="cb283-7"><a href="chm_sens_test.html#cb283-7" tabindex="-1"></a>    , scales<span class="sc">::</span><span class="fu">comma</span>(n_th_top,<span class="at">accuracy=</span><span class="dv">1</span>)</span>
<span id="cb283-8"><a href="chm_sens_test.html#cb283-8" tabindex="-1"></a>    , <span class="st">&quot;) &quot;</span></span>
<span id="cb283-9"><a href="chm_sens_test.html#cb283-9" tabindex="-1"></a>    , <span class="st">&quot;</span><span class="sc">\n</span><span class="st">based on both detection and quantification accuracy&quot;</span></span>
<span id="cb283-10"><a href="chm_sens_test.html#cb283-10" tabindex="-1"></a>  )</span>
<span id="cb283-11"><a href="chm_sens_test.html#cb283-11" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-257-1.png" width="1008" /></p>
<p>what is the expected <em>quantification</em> accuracy of the top 12 settings?</p>
<div class="sourceCode" id="cb284"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb284-1"><a href="chm_sens_test.html#cb284-1" tabindex="-1"></a><span class="co"># plot it</span></span>
<span id="cb284-2"><a href="chm_sens_test.html#cb284-2" tabindex="-1"></a><span class="fu">plt_form_quantification_dist</span>(</span>
<span id="cb284-3"><a href="chm_sens_test.html#cb284-3" tabindex="-1"></a>  <span class="at">df =</span> param_combos_spectral_ranked <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(is_final_selection) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">!</span>tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;_pct_rank_&quot;</span>))</span>
<span id="cb284-4"><a href="chm_sens_test.html#cb284-4" tabindex="-1"></a>  , <span class="fu">paste0</span>(</span>
<span id="cb284-5"><a href="chm_sens_test.html#cb284-5" tabindex="-1"></a>    <span class="st">&quot;Data Fusion&quot;</span></span>
<span id="cb284-6"><a href="chm_sens_test.html#cb284-6" tabindex="-1"></a>    , <span class="st">&quot;</span><span class="sc">\n</span><span class="st">distribution of pile form quantification metrics for the top parameter settings tested&quot;</span></span>
<span id="cb284-7"><a href="chm_sens_test.html#cb284-7" tabindex="-1"></a>    , <span class="st">&quot; (n=&quot;</span></span>
<span id="cb284-8"><a href="chm_sens_test.html#cb284-8" tabindex="-1"></a>    , scales<span class="sc">::</span><span class="fu">comma</span>(n_th_top,<span class="at">accuracy=</span><span class="dv">1</span>)</span>
<span id="cb284-9"><a href="chm_sens_test.html#cb284-9" tabindex="-1"></a>    , <span class="st">&quot;) &quot;</span></span>
<span id="cb284-10"><a href="chm_sens_test.html#cb284-10" tabindex="-1"></a>    , <span class="st">&quot;</span><span class="sc">\n</span><span class="st">based on both detection and quantification accuracy&quot;</span></span>
<span id="cb284-11"><a href="chm_sens_test.html#cb284-11" tabindex="-1"></a>  )</span>
<span id="cb284-12"><a href="chm_sens_test.html#cb284-12" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-258-1.png" width="1008" /></p>
<p>finally, here are the combinations selected compared against all 35,280 combinations tested.</p>
<div class="sourceCode" id="cb285"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb285-1"><a href="chm_sens_test.html#cb285-1" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(</span>
<span id="cb285-2"><a href="chm_sens_test.html#cb285-2" tabindex="-1"></a>  param_combos_spectral_ranked <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(is_final_selection)</span>
<span id="cb285-3"><a href="chm_sens_test.html#cb285-3" tabindex="-1"></a>  , param_combos_spectral_ranked <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span>is_final_selection) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">slice_sample</span>(<span class="at">prop =</span> (<span class="dv">1</span><span class="sc">/</span><span class="dv">6</span>))</span>
<span id="cb285-4"><a href="chm_sens_test.html#cb285-4" tabindex="-1"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb285-5"><a href="chm_sens_test.html#cb285-5" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb285-6"><a href="chm_sens_test.html#cb285-6" tabindex="-1"></a>    rn,max_ht_m,max_area_m2,convexity_pct,circle_fit_iou_pct</span>
<span id="cb285-7"><a href="chm_sens_test.html#cb285-7" tabindex="-1"></a>    , is_final_selection</span>
<span id="cb285-8"><a href="chm_sens_test.html#cb285-8" tabindex="-1"></a>    , f_score, precision, recall</span>
<span id="cb285-9"><a href="chm_sens_test.html#cb285-9" tabindex="-1"></a>    <span class="co"># quantification accuracy</span></span>
<span id="cb285-10"><a href="chm_sens_test.html#cb285-10" tabindex="-1"></a>    , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_mape&quot;</span>)</span>
<span id="cb285-11"><a href="chm_sens_test.html#cb285-11" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb285-12"><a href="chm_sens_test.html#cb285-12" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(</span>
<span id="cb285-13"><a href="chm_sens_test.html#cb285-13" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">c</span>(</span>
<span id="cb285-14"><a href="chm_sens_test.html#cb285-14" tabindex="-1"></a>      tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_mape&quot;</span>)</span>
<span id="cb285-15"><a href="chm_sens_test.html#cb285-15" tabindex="-1"></a>      <span class="co"># ,precision,recall</span></span>
<span id="cb285-16"><a href="chm_sens_test.html#cb285-16" tabindex="-1"></a>    )</span>
<span id="cb285-17"><a href="chm_sens_test.html#cb285-17" tabindex="-1"></a>    , <span class="at">names_to =</span> <span class="st">&quot;metric&quot;</span></span>
<span id="cb285-18"><a href="chm_sens_test.html#cb285-18" tabindex="-1"></a>    , <span class="at">values_to =</span> <span class="st">&quot;value&quot;</span></span>
<span id="cb285-19"><a href="chm_sens_test.html#cb285-19" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb285-20"><a href="chm_sens_test.html#cb285-20" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb285-21"><a href="chm_sens_test.html#cb285-21" tabindex="-1"></a>    <span class="at">eval_metric =</span> stringr<span class="sc">::</span><span class="fu">str_extract</span>(metric, <span class="st">&quot;(_rmse|_rrmse|_mean|_mape)$&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb285-22"><a href="chm_sens_test.html#cb285-22" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_remove_all</span>(<span class="st">&quot;_&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb285-23"><a href="chm_sens_test.html#cb285-23" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_replace_all</span>(<span class="st">&quot;mean&quot;</span>,<span class="st">&quot;me&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb285-24"><a href="chm_sens_test.html#cb285-24" tabindex="-1"></a>      <span class="fu">toupper</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb285-25"><a href="chm_sens_test.html#cb285-25" tabindex="-1"></a>      <span class="fu">factor</span>(</span>
<span id="cb285-26"><a href="chm_sens_test.html#cb285-26" tabindex="-1"></a>        <span class="at">ordered =</span> T</span>
<span id="cb285-27"><a href="chm_sens_test.html#cb285-27" tabindex="-1"></a>        , <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;ME&quot;</span>,<span class="st">&quot;RMSE&quot;</span>,<span class="st">&quot;RRMSE&quot;</span>,<span class="st">&quot;MAPE&quot;</span>)</span>
<span id="cb285-28"><a href="chm_sens_test.html#cb285-28" tabindex="-1"></a>      )</span>
<span id="cb285-29"><a href="chm_sens_test.html#cb285-29" tabindex="-1"></a>    , <span class="at">pile_metric =</span> metric <span class="sc">%&gt;%</span> </span>
<span id="cb285-30"><a href="chm_sens_test.html#cb285-30" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_remove</span>(<span class="st">&quot;(_rmse|_rrmse|_mean|_mape)$&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb285-31"><a href="chm_sens_test.html#cb285-31" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_extract</span>(<span class="st">&quot;(paraboloid_volume|volume|area|height|diameter|precision|recall)&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb285-32"><a href="chm_sens_test.html#cb285-32" tabindex="-1"></a>      <span class="fu">factor</span>(</span>
<span id="cb285-33"><a href="chm_sens_test.html#cb285-33" tabindex="-1"></a>        <span class="at">ordered =</span> T</span>
<span id="cb285-34"><a href="chm_sens_test.html#cb285-34" tabindex="-1"></a>        , <span class="at">levels =</span> <span class="fu">c</span>(</span>
<span id="cb285-35"><a href="chm_sens_test.html#cb285-35" tabindex="-1"></a>          <span class="st">&quot;volume&quot;</span></span>
<span id="cb285-36"><a href="chm_sens_test.html#cb285-36" tabindex="-1"></a>          , <span class="st">&quot;paraboloid_volume&quot;</span></span>
<span id="cb285-37"><a href="chm_sens_test.html#cb285-37" tabindex="-1"></a>          , <span class="st">&quot;area&quot;</span></span>
<span id="cb285-38"><a href="chm_sens_test.html#cb285-38" tabindex="-1"></a>          , <span class="st">&quot;height&quot;</span></span>
<span id="cb285-39"><a href="chm_sens_test.html#cb285-39" tabindex="-1"></a>          , <span class="st">&quot;diameter&quot;</span></span>
<span id="cb285-40"><a href="chm_sens_test.html#cb285-40" tabindex="-1"></a>          , <span class="st">&quot;recall&quot;</span></span>
<span id="cb285-41"><a href="chm_sens_test.html#cb285-41" tabindex="-1"></a>          , <span class="st">&quot;precision&quot;</span></span>
<span id="cb285-42"><a href="chm_sens_test.html#cb285-42" tabindex="-1"></a>        )</span>
<span id="cb285-43"><a href="chm_sens_test.html#cb285-43" tabindex="-1"></a>        , <span class="at">labels =</span> <span class="fu">c</span>(</span>
<span id="cb285-44"><a href="chm_sens_test.html#cb285-44" tabindex="-1"></a>          <span class="st">&quot;Volume&quot;</span></span>
<span id="cb285-45"><a href="chm_sens_test.html#cb285-45" tabindex="-1"></a>          , <span class="st">&quot;Volume paraboloid&quot;</span></span>
<span id="cb285-46"><a href="chm_sens_test.html#cb285-46" tabindex="-1"></a>          , <span class="st">&quot;Area (m2)&quot;</span></span>
<span id="cb285-47"><a href="chm_sens_test.html#cb285-47" tabindex="-1"></a>          , <span class="st">&quot;Height (m)&quot;</span></span>
<span id="cb285-48"><a href="chm_sens_test.html#cb285-48" tabindex="-1"></a>          , <span class="st">&quot;Diameter (m)&quot;</span></span>
<span id="cb285-49"><a href="chm_sens_test.html#cb285-49" tabindex="-1"></a>          , <span class="st">&quot;Recall&quot;</span></span>
<span id="cb285-50"><a href="chm_sens_test.html#cb285-50" tabindex="-1"></a>          , <span class="st">&quot;Precision&quot;</span></span>
<span id="cb285-51"><a href="chm_sens_test.html#cb285-51" tabindex="-1"></a>        )</span>
<span id="cb285-52"><a href="chm_sens_test.html#cb285-52" tabindex="-1"></a>      )</span>
<span id="cb285-53"><a href="chm_sens_test.html#cb285-53" tabindex="-1"></a>    , <span class="at">color_metric =</span> <span class="fu">ifelse</span>(is_final_selection, pile_metric, <span class="cn">NA</span>) <span class="sc">%&gt;%</span> <span class="fu">factor</span>()</span>
<span id="cb285-54"><a href="chm_sens_test.html#cb285-54" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb285-55"><a href="chm_sens_test.html#cb285-55" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(is_final_selection) <span class="sc">%&gt;%</span> </span>
<span id="cb285-56"><a href="chm_sens_test.html#cb285-56" tabindex="-1"></a>  <span class="co"># plot</span></span>
<span id="cb285-57"><a href="chm_sens_test.html#cb285-57" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> f_score, <span class="at">y =</span> value, <span class="at">color =</span> color_metric)) <span class="sc">+</span></span>
<span id="cb285-58"><a href="chm_sens_test.html#cb285-58" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb285-59"><a href="chm_sens_test.html#cb285-59" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">facet_wrap</span>(<span class="at">facets =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(pile_metric)) <span class="sc">+</span></span>
<span id="cb285-60"><a href="chm_sens_test.html#cb285-60" tabindex="-1"></a>  harrypotter<span class="sc">::</span><span class="fu">scale_color_hp_d</span>(<span class="at">option =</span> <span class="st">&quot;hermionegranger&quot;</span>, <span class="at">na.value =</span> <span class="st">&quot;gray88&quot;</span>) <span class="sc">+</span></span>
<span id="cb285-61"><a href="chm_sens_test.html#cb285-61" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_x_continuous</span>(</span>
<span id="cb285-62"><a href="chm_sens_test.html#cb285-62" tabindex="-1"></a>    <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">percent_format</span>(<span class="at">accuracy =</span> <span class="dv">1</span>)</span>
<span id="cb285-63"><a href="chm_sens_test.html#cb285-63" tabindex="-1"></a>    , <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)</span>
<span id="cb285-64"><a href="chm_sens_test.html#cb285-64" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb285-65"><a href="chm_sens_test.html#cb285-65" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_y_continuous</span>(</span>
<span id="cb285-66"><a href="chm_sens_test.html#cb285-66" tabindex="-1"></a>    <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">percent_format</span>(<span class="at">accuracy =</span> <span class="dv">1</span>)</span>
<span id="cb285-67"><a href="chm_sens_test.html#cb285-67" tabindex="-1"></a>    , <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="cn">NA</span>)</span>
<span id="cb285-68"><a href="chm_sens_test.html#cb285-68" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb285-69"><a href="chm_sens_test.html#cb285-69" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;F-Score&quot;</span>, <span class="at">y =</span> <span class="st">&quot;MAPE&quot;</span>, <span class="at">caption =</span> <span class="st">&quot;*records in gray not selected&quot;</span>) <span class="sc">+</span></span>
<span id="cb285-70"><a href="chm_sens_test.html#cb285-70" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb285-71"><a href="chm_sens_test.html#cb285-71" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb285-72"><a href="chm_sens_test.html#cb285-72" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb285-73"><a href="chm_sens_test.html#cb285-73" tabindex="-1"></a>    , <span class="at">strip.text =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb285-74"><a href="chm_sens_test.html#cb285-74" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-259-1.png" width="1008" /></p>
</div>
</div>
<div id="by-chm-resolution-1" class="section level4 hasAnchor" number="8.6.3.2">
<h4><span class="header-section-number">8.6.3.2</span> by CHM resolution<a href="chm_sens_test.html#by-chm-resolution-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>To select the best-performing parameter combinations of those tested by CHM resolution, we will prioritize those that balance detection and quantification accuracy. From this group, we will then identify the settings that achieve the highest pile detection rates (recall). These recommendations are for users who are working with a CHM with a resolution in the range of those tested for this analysis or can aggregate (i.e. make more coarse) a CHM to a resolution tested for the purpose of either improving processing performance or enhancing pile detection and/or quantification accuracy based on the results shown here</p>
<p>we already created this data above (<code>param_combos_ranked</code>) using the F-Score and the average rank of the MAPE metrics across all form measurements (i.e. height, diameter, area, volume) to determine the best overall list of those tested by CHM resolution</p>
<div id="top-2.0-1" class="section level5 hasAnchor" number="8.6.3.2.1">
<h5><span class="header-section-number">8.6.3.2.1</span> Top 2.0%<a href="chm_sens_test.html#top-2.0-1" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>Of those tested, let’s check out the parameter settings of the top 2.0% (n=141) from all 7,056 combinations tested by CHM resolution. these are “votes” for the parameter setting based on the combinations that achieved the best balance between both detection and quantification accuracy.</p>
<div class="sourceCode" id="cb286"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb286-1"><a href="chm_sens_test.html#cb286-1" tabindex="-1"></a>param_combos_spectral_ranked <span class="sc">%&gt;%</span></span>
<span id="cb286-2"><a href="chm_sens_test.html#cb286-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(is_top_chm) <span class="sc">%&gt;%</span> </span>
<span id="cb286-3"><a href="chm_sens_test.html#cb286-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;f_score&quot;</span>), max_ht_m,max_area_m2,convexity_pct,circle_fit_iou_pct,chm_res_m,chm_res_m_desc,spectral_weight) <span class="sc">%&gt;%</span> </span>
<span id="cb286-4"><a href="chm_sens_test.html#cb286-4" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(</span>
<span id="cb286-5"><a href="chm_sens_test.html#cb286-5" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">c</span>(max_ht_m,max_area_m2,convexity_pct,circle_fit_iou_pct,spectral_weight)</span>
<span id="cb286-6"><a href="chm_sens_test.html#cb286-6" tabindex="-1"></a>    , <span class="at">names_to =</span> <span class="st">&quot;metric&quot;</span></span>
<span id="cb286-7"><a href="chm_sens_test.html#cb286-7" tabindex="-1"></a>    , <span class="at">values_to =</span> <span class="st">&quot;value&quot;</span></span>
<span id="cb286-8"><a href="chm_sens_test.html#cb286-8" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb286-9"><a href="chm_sens_test.html#cb286-9" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">count</span>(chm_res_m,chm_res_m_desc, metric, value) <span class="sc">%&gt;%</span> </span>
<span id="cb286-10"><a href="chm_sens_test.html#cb286-10" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(chm_res_m,chm_res_m_desc, metric) <span class="sc">%&gt;%</span> </span>
<span id="cb286-11"><a href="chm_sens_test.html#cb286-11" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb286-12"><a href="chm_sens_test.html#cb286-12" tabindex="-1"></a>    <span class="at">pct=</span>n<span class="sc">/</span><span class="fu">sum</span>(n)</span>
<span id="cb286-13"><a href="chm_sens_test.html#cb286-13" tabindex="-1"></a>    , <span class="at">lab =</span> <span class="fu">paste0</span>(scales<span class="sc">::</span><span class="fu">percent</span>(pct,<span class="at">accuracy=</span><span class="fl">0.1</span>)) <span class="co">#, &quot;\nn=&quot;, scales::comma(n,accuracy=1))</span></span>
<span id="cb286-14"><a href="chm_sens_test.html#cb286-14" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb286-15"><a href="chm_sens_test.html#cb286-15" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(</span>
<span id="cb286-16"><a href="chm_sens_test.html#cb286-16" tabindex="-1"></a>    <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">factor</span>(value), <span class="at">y=</span>pct, <span class="at">label=</span>lab, <span class="at">fill =</span> metric)</span>
<span id="cb286-17"><a href="chm_sens_test.html#cb286-17" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb286-18"><a href="chm_sens_test.html#cb286-18" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_col</span>(<span class="at">width =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb286-19"><a href="chm_sens_test.html#cb286-19" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_text</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">size =</span> <span class="fl">2.2</span>, <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb286-20"><a href="chm_sens_test.html#cb286-20" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">facet_grid</span>(<span class="at">cols =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(metric), <span class="at">rows =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(chm_res_m_desc), <span class="at">scales =</span> <span class="st">&quot;free_x&quot;</span>) <span class="sc">+</span></span>
<span id="cb286-21"><a href="chm_sens_test.html#cb286-21" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_y_continuous</span>(</span>
<span id="cb286-22"><a href="chm_sens_test.html#cb286-22" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="at">by=</span><span class="fl">0.2</span>)</span>
<span id="cb286-23"><a href="chm_sens_test.html#cb286-23" tabindex="-1"></a>    , <span class="at">labels =</span> scales<span class="sc">::</span>percent</span>
<span id="cb286-24"><a href="chm_sens_test.html#cb286-24" tabindex="-1"></a>    , <span class="at">expand =</span> ggplot2<span class="sc">::</span><span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">0.2</span>))</span>
<span id="cb286-25"><a href="chm_sens_test.html#cb286-25" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb286-26"><a href="chm_sens_test.html#cb286-26" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_fill_manual</span>(<span class="at">values =</span> pal_param[<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>,<span class="dv">6</span>)]) <span class="sc">+</span></span>
<span id="cb286-27"><a href="chm_sens_test.html#cb286-27" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb286-28"><a href="chm_sens_test.html#cb286-28" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;parameter setting&quot;</span>, <span class="at">y =</span> <span class="st">&quot;&quot;</span></span>
<span id="cb286-29"><a href="chm_sens_test.html#cb286-29" tabindex="-1"></a>    , <span class="at">fill =</span> <span class="st">&quot;&quot;</span></span>
<span id="cb286-30"><a href="chm_sens_test.html#cb286-30" tabindex="-1"></a>    , <span class="at">subtitle =</span> <span class="fu">paste0</span>(</span>
<span id="cb286-31"><a href="chm_sens_test.html#cb286-31" tabindex="-1"></a>      <span class="st">&quot;Data Fusion&quot;</span></span>
<span id="cb286-32"><a href="chm_sens_test.html#cb286-32" tabindex="-1"></a>       , <span class="st">&quot;</span><span class="sc">\n</span><span class="st">parameter settings of top &quot;</span></span>
<span id="cb286-33"><a href="chm_sens_test.html#cb286-33" tabindex="-1"></a>       , scales<span class="sc">::</span><span class="fu">percent</span>(pct_th_top_chm,<span class="at">accuracy=</span><span class="fl">0.1</span>)</span>
<span id="cb286-34"><a href="chm_sens_test.html#cb286-34" tabindex="-1"></a>       , <span class="st">&quot; (n=&quot;</span></span>
<span id="cb286-35"><a href="chm_sens_test.html#cb286-35" tabindex="-1"></a>       , scales<span class="sc">::</span><span class="fu">comma</span>(n_combos_top_spectral_chm , <span class="at">accuracy =</span> <span class="dv">1</span>)</span>
<span id="cb286-36"><a href="chm_sens_test.html#cb286-36" tabindex="-1"></a>       , <span class="st">&quot;) &quot;</span></span>
<span id="cb286-37"><a href="chm_sens_test.html#cb286-37" tabindex="-1"></a>       , <span class="st">&quot;parameter combinations tested by CHM resolution</span><span class="sc">\n</span><span class="st">based on both detection and quantification accuracy&quot;</span></span>
<span id="cb286-38"><a href="chm_sens_test.html#cb286-38" tabindex="-1"></a>    )</span>
<span id="cb286-39"><a href="chm_sens_test.html#cb286-39" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb286-40"><a href="chm_sens_test.html#cb286-40" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb286-41"><a href="chm_sens_test.html#cb286-41" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb286-42"><a href="chm_sens_test.html#cb286-42" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb286-43"><a href="chm_sens_test.html#cb286-43" tabindex="-1"></a>    , <span class="at">strip.text.x =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb286-44"><a href="chm_sens_test.html#cb286-44" tabindex="-1"></a>    , <span class="at">strip.text.y =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">9</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb286-45"><a href="chm_sens_test.html#cb286-45" tabindex="-1"></a>    , <span class="at">axis.text.y =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">6</span>)</span>
<span id="cb286-46"><a href="chm_sens_test.html#cb286-46" tabindex="-1"></a>    , <span class="at">axis.text.x =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>)</span>
<span id="cb286-47"><a href="chm_sens_test.html#cb286-47" tabindex="-1"></a>    , <span class="at">plot.subtitle =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>)</span>
<span id="cb286-48"><a href="chm_sens_test.html#cb286-48" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-261-1.png" width="1008" /></p>
<p>an interesting finding here is that as CHM resolution becomes more coarse, the importance of the spectral data increases (i.e. <code>spectral_weight</code>) for accurately detecting and representing pile form</p>
<p>what is the expected <em>detection</em> accuracy of the top 2.0% (n=141) combinations tested by CHM resolution?</p>
<div class="sourceCode" id="cb287"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb287-1"><a href="chm_sens_test.html#cb287-1" tabindex="-1"></a><span class="fu">plt_detection_dist2</span>(</span>
<span id="cb287-2"><a href="chm_sens_test.html#cb287-2" tabindex="-1"></a>  <span class="at">df =</span> param_combos_spectral_ranked <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(is_top_chm) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">!</span>tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;_pct_rank_&quot;</span>))</span>
<span id="cb287-3"><a href="chm_sens_test.html#cb287-3" tabindex="-1"></a>  , <span class="fu">paste0</span>(</span>
<span id="cb287-4"><a href="chm_sens_test.html#cb287-4" tabindex="-1"></a>    <span class="st">&quot;Data Fusion&quot;</span></span>
<span id="cb287-5"><a href="chm_sens_test.html#cb287-5" tabindex="-1"></a>    , <span class="st">&quot;</span><span class="sc">\n</span><span class="st">distribution of pile detection metrics for top &quot;</span></span>
<span id="cb287-6"><a href="chm_sens_test.html#cb287-6" tabindex="-1"></a>    , scales<span class="sc">::</span><span class="fu">percent</span>(pct_th_top_chm,<span class="at">accuracy=</span><span class="fl">0.1</span>)</span>
<span id="cb287-7"><a href="chm_sens_test.html#cb287-7" tabindex="-1"></a>    , <span class="st">&quot; (n=&quot;</span></span>
<span id="cb287-8"><a href="chm_sens_test.html#cb287-8" tabindex="-1"></a>    , scales<span class="sc">::</span><span class="fu">comma</span>(n_combos_top_spectral_chm, <span class="at">accuracy=</span><span class="dv">1</span>)</span>
<span id="cb287-9"><a href="chm_sens_test.html#cb287-9" tabindex="-1"></a>    , <span class="st">&quot;) &quot;</span></span>
<span id="cb287-10"><a href="chm_sens_test.html#cb287-10" tabindex="-1"></a>    , <span class="st">&quot;parameter combinations tested by CHM resolution</span><span class="sc">\n</span><span class="st">based on both detection and quantification accuracy&quot;</span></span>
<span id="cb287-11"><a href="chm_sens_test.html#cb287-11" tabindex="-1"></a>  )</span>
<span id="cb287-12"><a href="chm_sens_test.html#cb287-12" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-262-1.png" width="1008" /></p>
<p>what is the expected <em>MAPE</em> of the top 2.0% (n=141) combinations tested by CHM resolution?</p>
<div class="sourceCode" id="cb288"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb288-1"><a href="chm_sens_test.html#cb288-1" tabindex="-1"></a><span class="co"># plot it</span></span>
<span id="cb288-2"><a href="chm_sens_test.html#cb288-2" tabindex="-1"></a><span class="fu">plt_form_quantification_dist2</span>(</span>
<span id="cb288-3"><a href="chm_sens_test.html#cb288-3" tabindex="-1"></a>  <span class="at">df =</span> param_combos_spectral_ranked <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(is_top_chm) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">!</span>tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;_pct_rank_&quot;</span>))</span>
<span id="cb288-4"><a href="chm_sens_test.html#cb288-4" tabindex="-1"></a>  , <span class="at">quant_metric =</span> <span class="st">&quot;mape&quot;</span></span>
<span id="cb288-5"><a href="chm_sens_test.html#cb288-5" tabindex="-1"></a>  , <span class="fu">paste0</span>(</span>
<span id="cb288-6"><a href="chm_sens_test.html#cb288-6" tabindex="-1"></a>    <span class="st">&quot;Data Fusion&quot;</span></span>
<span id="cb288-7"><a href="chm_sens_test.html#cb288-7" tabindex="-1"></a>    , <span class="st">&quot;</span><span class="sc">\n</span><span class="st">distribution of pile form quantification metrics for the top &quot;</span></span>
<span id="cb288-8"><a href="chm_sens_test.html#cb288-8" tabindex="-1"></a>    , scales<span class="sc">::</span><span class="fu">percent</span>(pct_th_top_chm,<span class="at">accuracy=</span><span class="fl">0.1</span>)</span>
<span id="cb288-9"><a href="chm_sens_test.html#cb288-9" tabindex="-1"></a>    , <span class="st">&quot; (n=&quot;</span></span>
<span id="cb288-10"><a href="chm_sens_test.html#cb288-10" tabindex="-1"></a>    , scales<span class="sc">::</span><span class="fu">comma</span>(n_combos_top_spectral_chm, <span class="at">accuracy=</span><span class="dv">1</span>)</span>
<span id="cb288-11"><a href="chm_sens_test.html#cb288-11" tabindex="-1"></a>    , <span class="st">&quot;) &quot;</span></span>
<span id="cb288-12"><a href="chm_sens_test.html#cb288-12" tabindex="-1"></a>    , <span class="st">&quot;parameter combinations tested by CHM resolution</span><span class="sc">\n</span><span class="st">based on both detection and quantification accuracy&quot;</span></span>
<span id="cb288-13"><a href="chm_sens_test.html#cb288-13" tabindex="-1"></a>  )</span>
<span id="cb288-14"><a href="chm_sens_test.html#cb288-14" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-263-1.png" width="1008" /></p>
<p>what is the expected <em>Mean Error (ME)</em> of the top 2.0% (n=141) combinations tested by CHM resolution?</p>
<div class="sourceCode" id="cb289"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb289-1"><a href="chm_sens_test.html#cb289-1" tabindex="-1"></a><span class="co"># plot it</span></span>
<span id="cb289-2"><a href="chm_sens_test.html#cb289-2" tabindex="-1"></a><span class="fu">plt_form_quantification_dist2</span>(</span>
<span id="cb289-3"><a href="chm_sens_test.html#cb289-3" tabindex="-1"></a>  <span class="at">df =</span> param_combos_spectral_ranked <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(is_top_chm) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">!</span>tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;_pct_rank_&quot;</span>))</span>
<span id="cb289-4"><a href="chm_sens_test.html#cb289-4" tabindex="-1"></a>  , <span class="at">quant_metric =</span> <span class="st">&quot;mean&quot;</span></span>
<span id="cb289-5"><a href="chm_sens_test.html#cb289-5" tabindex="-1"></a>  , <span class="fu">paste0</span>(</span>
<span id="cb289-6"><a href="chm_sens_test.html#cb289-6" tabindex="-1"></a>    <span class="st">&quot;Data Fusion&quot;</span></span>
<span id="cb289-7"><a href="chm_sens_test.html#cb289-7" tabindex="-1"></a>    , <span class="st">&quot;</span><span class="sc">\n</span><span class="st">distribution of pile form quantification metrics for the top &quot;</span></span>
<span id="cb289-8"><a href="chm_sens_test.html#cb289-8" tabindex="-1"></a>    , scales<span class="sc">::</span><span class="fu">percent</span>(pct_th_top_chm,<span class="at">accuracy=</span><span class="fl">0.1</span>)</span>
<span id="cb289-9"><a href="chm_sens_test.html#cb289-9" tabindex="-1"></a>    , <span class="st">&quot; (n=&quot;</span></span>
<span id="cb289-10"><a href="chm_sens_test.html#cb289-10" tabindex="-1"></a>    , scales<span class="sc">::</span><span class="fu">comma</span>(n_combos_top_spectral_chm, <span class="at">accuracy=</span><span class="dv">1</span>)</span>
<span id="cb289-11"><a href="chm_sens_test.html#cb289-11" tabindex="-1"></a>    , <span class="st">&quot;) &quot;</span></span>
<span id="cb289-12"><a href="chm_sens_test.html#cb289-12" tabindex="-1"></a>    , <span class="st">&quot;parameter combinations tested by CHM resolution</span><span class="sc">\n</span><span class="st">based on both detection and quantification accuracy&quot;</span></span>
<span id="cb289-13"><a href="chm_sens_test.html#cb289-13" tabindex="-1"></a>  )</span>
<span id="cb289-14"><a href="chm_sens_test.html#cb289-14" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-264-1.png" width="1008" /></p>
<p>what is the expected <em>RMSE</em> of the top 2.0% (n=141) combinations tested by CHM resolution?</p>
<div class="sourceCode" id="cb290"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb290-1"><a href="chm_sens_test.html#cb290-1" tabindex="-1"></a><span class="co"># plot it</span></span>
<span id="cb290-2"><a href="chm_sens_test.html#cb290-2" tabindex="-1"></a><span class="fu">plt_form_quantification_dist2</span>(</span>
<span id="cb290-3"><a href="chm_sens_test.html#cb290-3" tabindex="-1"></a>  <span class="at">df =</span> param_combos_spectral_ranked <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(is_top_chm) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">!</span>tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;_pct_rank_&quot;</span>))</span>
<span id="cb290-4"><a href="chm_sens_test.html#cb290-4" tabindex="-1"></a>  , <span class="at">quant_metric =</span> <span class="st">&quot;rmse&quot;</span></span>
<span id="cb290-5"><a href="chm_sens_test.html#cb290-5" tabindex="-1"></a>  , <span class="fu">paste0</span>(</span>
<span id="cb290-6"><a href="chm_sens_test.html#cb290-6" tabindex="-1"></a>    <span class="st">&quot;Data Fusion&quot;</span></span>
<span id="cb290-7"><a href="chm_sens_test.html#cb290-7" tabindex="-1"></a>    , <span class="st">&quot;</span><span class="sc">\n</span><span class="st">distribution of pile form quantification metrics for the top &quot;</span></span>
<span id="cb290-8"><a href="chm_sens_test.html#cb290-8" tabindex="-1"></a>    , scales<span class="sc">::</span><span class="fu">percent</span>(pct_th_top_chm,<span class="at">accuracy=</span><span class="fl">0.1</span>)</span>
<span id="cb290-9"><a href="chm_sens_test.html#cb290-9" tabindex="-1"></a>    , <span class="st">&quot; (n=&quot;</span></span>
<span id="cb290-10"><a href="chm_sens_test.html#cb290-10" tabindex="-1"></a>    , scales<span class="sc">::</span><span class="fu">comma</span>(n_combos_top_spectral_chm, <span class="at">accuracy=</span><span class="dv">1</span>)</span>
<span id="cb290-11"><a href="chm_sens_test.html#cb290-11" tabindex="-1"></a>    , <span class="st">&quot;) &quot;</span></span>
<span id="cb290-12"><a href="chm_sens_test.html#cb290-12" tabindex="-1"></a>    , <span class="st">&quot;parameter combinations tested by CHM resolution</span><span class="sc">\n</span><span class="st">based on both detection and quantification accuracy&quot;</span></span>
<span id="cb290-13"><a href="chm_sens_test.html#cb290-13" tabindex="-1"></a>  )</span>
<span id="cb290-14"><a href="chm_sens_test.html#cb290-14" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-265-1.png" width="1008" /></p>
</div>
<div id="final-6-settings" class="section level5 hasAnchor" number="8.6.3.2.2">
<h5><span class="header-section-number">8.6.3.2.2</span> Final 6 settings<a href="chm_sens_test.html#final-6-settings" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<div class="sourceCode" id="cb291"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb291-1"><a href="chm_sens_test.html#cb291-1" tabindex="-1"></a><span class="co"># pal_temp %&gt;% scales::show_col()</span></span>
<span id="cb291-2"><a href="chm_sens_test.html#cb291-2" tabindex="-1"></a><span class="co"># filter and reshape</span></span>
<span id="cb291-3"><a href="chm_sens_test.html#cb291-3" tabindex="-1"></a>param_combos_spectral_ranked <span class="sc">%&gt;%</span> </span>
<span id="cb291-4"><a href="chm_sens_test.html#cb291-4" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(is_final_selection_chm) <span class="sc">%&gt;%</span> </span>
<span id="cb291-5"><a href="chm_sens_test.html#cb291-5" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">!</span>tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;_pct_rank_&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb291-6"><a href="chm_sens_test.html#cb291-6" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb291-7"><a href="chm_sens_test.html#cb291-7" tabindex="-1"></a>    max_ht_m,max_area_m2,convexity_pct,circle_fit_iou_pct,chm_res_m,chm_res_m_desc,spectral_weight</span>
<span id="cb291-8"><a href="chm_sens_test.html#cb291-8" tabindex="-1"></a>    , chm_lab</span>
<span id="cb291-9"><a href="chm_sens_test.html#cb291-9" tabindex="-1"></a>    <span class="co"># detection</span></span>
<span id="cb291-10"><a href="chm_sens_test.html#cb291-10" tabindex="-1"></a>    , f_score, recall, precision</span>
<span id="cb291-11"><a href="chm_sens_test.html#cb291-11" tabindex="-1"></a>    <span class="co"># quantification</span></span>
<span id="cb291-12"><a href="chm_sens_test.html#cb291-12" tabindex="-1"></a>    , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_rmse&quot;</span>)</span>
<span id="cb291-13"><a href="chm_sens_test.html#cb291-13" tabindex="-1"></a>    , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_rrmse&quot;</span>)</span>
<span id="cb291-14"><a href="chm_sens_test.html#cb291-14" tabindex="-1"></a>    , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_mean&quot;</span>)</span>
<span id="cb291-15"><a href="chm_sens_test.html#cb291-15" tabindex="-1"></a>    , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_mape&quot;</span>)</span>
<span id="cb291-16"><a href="chm_sens_test.html#cb291-16" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb291-17"><a href="chm_sens_test.html#cb291-17" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(</span>
<span id="cb291-18"><a href="chm_sens_test.html#cb291-18" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">c</span>(</span>
<span id="cb291-19"><a href="chm_sens_test.html#cb291-19" tabindex="-1"></a>      f_score, recall, precision</span>
<span id="cb291-20"><a href="chm_sens_test.html#cb291-20" tabindex="-1"></a>      , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_rmse&quot;</span>)</span>
<span id="cb291-21"><a href="chm_sens_test.html#cb291-21" tabindex="-1"></a>      , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_rrmse&quot;</span>)</span>
<span id="cb291-22"><a href="chm_sens_test.html#cb291-22" tabindex="-1"></a>      , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_mean&quot;</span>)</span>
<span id="cb291-23"><a href="chm_sens_test.html#cb291-23" tabindex="-1"></a>      , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_mape&quot;</span>)</span>
<span id="cb291-24"><a href="chm_sens_test.html#cb291-24" tabindex="-1"></a>    )</span>
<span id="cb291-25"><a href="chm_sens_test.html#cb291-25" tabindex="-1"></a>    , <span class="at">names_to =</span> <span class="st">&quot;metric&quot;</span></span>
<span id="cb291-26"><a href="chm_sens_test.html#cb291-26" tabindex="-1"></a>    , <span class="at">values_to =</span> <span class="st">&quot;value&quot;</span></span>
<span id="cb291-27"><a href="chm_sens_test.html#cb291-27" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb291-28"><a href="chm_sens_test.html#cb291-28" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb291-29"><a href="chm_sens_test.html#cb291-29" tabindex="-1"></a>    <span class="at">eval_metric =</span> stringr<span class="sc">::</span><span class="fu">str_extract</span>(metric, <span class="st">&quot;(_rmse|_rrmse|_mean|_mape|f_score|recall|precision)$&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb291-30"><a href="chm_sens_test.html#cb291-30" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_remove_all</span>(<span class="st">&quot;_&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb291-31"><a href="chm_sens_test.html#cb291-31" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_replace_all</span>(<span class="st">&quot;mean&quot;</span>,<span class="st">&quot;me&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb291-32"><a href="chm_sens_test.html#cb291-32" tabindex="-1"></a>      <span class="fu">toupper</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb291-33"><a href="chm_sens_test.html#cb291-33" tabindex="-1"></a>      <span class="fu">factor</span>(</span>
<span id="cb291-34"><a href="chm_sens_test.html#cb291-34" tabindex="-1"></a>        <span class="at">ordered =</span> T</span>
<span id="cb291-35"><a href="chm_sens_test.html#cb291-35" tabindex="-1"></a>        , <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;FSCORE&quot;</span>,<span class="st">&quot;RECALL&quot;</span>,<span class="st">&quot;PRECISION&quot;</span>, <span class="st">&quot;ME&quot;</span>,<span class="st">&quot;RMSE&quot;</span>,<span class="st">&quot;RRMSE&quot;</span>,<span class="st">&quot;MAPE&quot;</span>)</span>
<span id="cb291-36"><a href="chm_sens_test.html#cb291-36" tabindex="-1"></a>        , <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;F-score&quot;</span>,<span class="st">&quot;Recall&quot;</span>,<span class="st">&quot;Precision&quot;</span>, <span class="st">&quot;ME&quot;</span>,<span class="st">&quot;RMSE&quot;</span>,<span class="st">&quot;RRMSE&quot;</span>,<span class="st">&quot;MAPE&quot;</span>)</span>
<span id="cb291-37"><a href="chm_sens_test.html#cb291-37" tabindex="-1"></a>      )</span>
<span id="cb291-38"><a href="chm_sens_test.html#cb291-38" tabindex="-1"></a>    , <span class="at">pile_metric =</span> metric <span class="sc">%&gt;%</span> </span>
<span id="cb291-39"><a href="chm_sens_test.html#cb291-39" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_remove</span>(<span class="st">&quot;(_rmse|_rrmse|_mean|_mape)$&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb291-40"><a href="chm_sens_test.html#cb291-40" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_extract</span>(<span class="st">&quot;(paraboloid_volume|volume|area|height|diameter)&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb291-41"><a href="chm_sens_test.html#cb291-41" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">coalesce</span>(<span class="st">&quot;detection&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb291-42"><a href="chm_sens_test.html#cb291-42" tabindex="-1"></a>      <span class="fu">factor</span>(</span>
<span id="cb291-43"><a href="chm_sens_test.html#cb291-43" tabindex="-1"></a>        <span class="at">ordered =</span> T</span>
<span id="cb291-44"><a href="chm_sens_test.html#cb291-44" tabindex="-1"></a>        , <span class="at">levels =</span> <span class="fu">c</span>(</span>
<span id="cb291-45"><a href="chm_sens_test.html#cb291-45" tabindex="-1"></a>          <span class="st">&quot;detection&quot;</span></span>
<span id="cb291-46"><a href="chm_sens_test.html#cb291-46" tabindex="-1"></a>          , <span class="st">&quot;volume&quot;</span></span>
<span id="cb291-47"><a href="chm_sens_test.html#cb291-47" tabindex="-1"></a>          , <span class="st">&quot;paraboloid_volume&quot;</span></span>
<span id="cb291-48"><a href="chm_sens_test.html#cb291-48" tabindex="-1"></a>          , <span class="st">&quot;area&quot;</span></span>
<span id="cb291-49"><a href="chm_sens_test.html#cb291-49" tabindex="-1"></a>          , <span class="st">&quot;height&quot;</span></span>
<span id="cb291-50"><a href="chm_sens_test.html#cb291-50" tabindex="-1"></a>          , <span class="st">&quot;diameter&quot;</span></span>
<span id="cb291-51"><a href="chm_sens_test.html#cb291-51" tabindex="-1"></a>        )</span>
<span id="cb291-52"><a href="chm_sens_test.html#cb291-52" tabindex="-1"></a>        , <span class="at">labels =</span> <span class="fu">c</span>(</span>
<span id="cb291-53"><a href="chm_sens_test.html#cb291-53" tabindex="-1"></a>          <span class="st">&quot;Detection&quot;</span></span>
<span id="cb291-54"><a href="chm_sens_test.html#cb291-54" tabindex="-1"></a>          , <span class="st">&quot;Volume&quot;</span></span>
<span id="cb291-55"><a href="chm_sens_test.html#cb291-55" tabindex="-1"></a>          , <span class="st">&quot;Volume paraboloid&quot;</span></span>
<span id="cb291-56"><a href="chm_sens_test.html#cb291-56" tabindex="-1"></a>          , <span class="st">&quot;Area (m2)&quot;</span></span>
<span id="cb291-57"><a href="chm_sens_test.html#cb291-57" tabindex="-1"></a>          , <span class="st">&quot;Height (m)&quot;</span></span>
<span id="cb291-58"><a href="chm_sens_test.html#cb291-58" tabindex="-1"></a>          , <span class="st">&quot;Diameter (m)&quot;</span></span>
<span id="cb291-59"><a href="chm_sens_test.html#cb291-59" tabindex="-1"></a>        )</span>
<span id="cb291-60"><a href="chm_sens_test.html#cb291-60" tabindex="-1"></a>      )</span>
<span id="cb291-61"><a href="chm_sens_test.html#cb291-61" tabindex="-1"></a>    , <span class="at">value_lab =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb291-62"><a href="chm_sens_test.html#cb291-62" tabindex="-1"></a>        eval_metric <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;F-score&quot;</span>,<span class="st">&quot;Recall&quot;</span>,<span class="st">&quot;Precision&quot;</span>, <span class="st">&quot;RRMSE&quot;</span>, <span class="st">&quot;MAPE&quot;</span>) <span class="sc">~</span> scales<span class="sc">::</span><span class="fu">percent</span>(value,<span class="at">accuracy=</span><span class="fl">0.1</span>)</span>
<span id="cb291-63"><a href="chm_sens_test.html#cb291-63" tabindex="-1"></a>        , eval_metric <span class="sc">==</span> <span class="st">&quot;ME&quot;</span> <span class="sc">~</span> scales<span class="sc">::</span><span class="fu">comma</span>(value,<span class="at">accuracy=</span><span class="fl">0.01</span>)</span>
<span id="cb291-64"><a href="chm_sens_test.html#cb291-64" tabindex="-1"></a>        , T <span class="sc">~</span> scales<span class="sc">::</span><span class="fu">comma</span>(value,<span class="at">accuracy=</span><span class="fl">0.1</span>)</span>
<span id="cb291-65"><a href="chm_sens_test.html#cb291-65" tabindex="-1"></a>      )</span>
<span id="cb291-66"><a href="chm_sens_test.html#cb291-66" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb291-67"><a href="chm_sens_test.html#cb291-67" tabindex="-1"></a>  <span class="co"># make var for color</span></span>
<span id="cb291-68"><a href="chm_sens_test.html#cb291-68" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(chm_res_m,chm_res_m_desc, pile_metric, eval_metric) <span class="sc">%&gt;%</span> </span>
<span id="cb291-69"><a href="chm_sens_test.html#cb291-69" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb291-70"><a href="chm_sens_test.html#cb291-70" tabindex="-1"></a>    <span class="co"># for ME, color by abs...for f-score,recall,precision color by -value so that higher means better...</span></span>
<span id="cb291-71"><a href="chm_sens_test.html#cb291-71" tabindex="-1"></a>      <span class="co"># ...since higher means worse for quantification accuracy metrics</span></span>
<span id="cb291-72"><a href="chm_sens_test.html#cb291-72" tabindex="-1"></a>    <span class="at">value_dir =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb291-73"><a href="chm_sens_test.html#cb291-73" tabindex="-1"></a>      eval_metric <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;ME&quot;</span>) <span class="sc">~</span> <span class="fu">abs</span>(value)</span>
<span id="cb291-74"><a href="chm_sens_test.html#cb291-74" tabindex="-1"></a>      , eval_metric <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;F-score&quot;</span>,<span class="st">&quot;Recall&quot;</span>,<span class="st">&quot;Precision&quot;</span>) <span class="sc">~</span> <span class="sc">-</span>value</span>
<span id="cb291-75"><a href="chm_sens_test.html#cb291-75" tabindex="-1"></a>      , T <span class="sc">~</span> value</span>
<span id="cb291-76"><a href="chm_sens_test.html#cb291-76" tabindex="-1"></a>    )</span>
<span id="cb291-77"><a href="chm_sens_test.html#cb291-77" tabindex="-1"></a>    , <span class="at">value_z =</span> (value_dir<span class="sc">-</span><span class="fu">mean</span>(value_dir,<span class="at">na.rm=</span>T))<span class="sc">/</span><span class="fu">sd</span>(value_dir,<span class="at">na.rm=</span>T) <span class="co"># this is the key to the different colors within facets</span></span>
<span id="cb291-78"><a href="chm_sens_test.html#cb291-78" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb291-79"><a href="chm_sens_test.html#cb291-79" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb291-80"><a href="chm_sens_test.html#cb291-80" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span>eval_metric <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;RRMSE&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb291-81"><a href="chm_sens_test.html#cb291-81" tabindex="-1"></a>  <span class="co"># View()</span></span>
<span id="cb291-82"><a href="chm_sens_test.html#cb291-82" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> eval_metric, <span class="at">y =</span> chm_lab)) <span class="sc">+</span> </span>
<span id="cb291-83"><a href="chm_sens_test.html#cb291-83" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_tile</span>(</span>
<span id="cb291-84"><a href="chm_sens_test.html#cb291-84" tabindex="-1"></a>    <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">fill =</span> pile_metric, <span class="at">alpha =</span> <span class="sc">-</span>value_z)</span>
<span id="cb291-85"><a href="chm_sens_test.html#cb291-85" tabindex="-1"></a>    , <span class="at">color =</span> <span class="st">&quot;gray&quot;</span></span>
<span id="cb291-86"><a href="chm_sens_test.html#cb291-86" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb291-87"><a href="chm_sens_test.html#cb291-87" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_text</span>(</span>
<span id="cb291-88"><a href="chm_sens_test.html#cb291-88" tabindex="-1"></a>    <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">label =</span> value_lab, <span class="at">fontface =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb291-89"><a href="chm_sens_test.html#cb291-89" tabindex="-1"></a>    , <span class="at">color =</span> <span class="st">&quot;white&quot;</span></span>
<span id="cb291-90"><a href="chm_sens_test.html#cb291-90" tabindex="-1"></a>    , <span class="at">size =</span> <span class="dv">3</span></span>
<span id="cb291-91"><a href="chm_sens_test.html#cb291-91" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb291-92"><a href="chm_sens_test.html#cb291-92" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">facet_grid</span>(<span class="at">cols =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(pile_metric), <span class="at">rows =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(chm_res_m_desc), <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>) <span class="sc">+</span> </span>
<span id="cb291-93"><a href="chm_sens_test.html#cb291-93" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_x_discrete</span>(<span class="at">position =</span> <span class="st">&quot;top&quot;</span>) <span class="sc">+</span></span>
<span id="cb291-94"><a href="chm_sens_test.html#cb291-94" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;gray33&quot;</span>, harrypotter<span class="sc">::</span><span class="fu">hp</span>(<span class="at">n=</span><span class="dv">3</span>,<span class="at">option =</span> <span class="st">&quot;hermionegranger&quot;</span>) )) <span class="sc">+</span></span>
<span id="cb291-95"><a href="chm_sens_test.html#cb291-95" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_alpha_binned</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="fl">0.55</span>, <span class="dv">1</span>)) <span class="sc">+</span> <span class="co"># this is the key to the different colors within facets</span></span>
<span id="cb291-96"><a href="chm_sens_test.html#cb291-96" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb291-97"><a href="chm_sens_test.html#cb291-97" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb291-98"><a href="chm_sens_test.html#cb291-98" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;&quot;</span></span>
<span id="cb291-99"><a href="chm_sens_test.html#cb291-99" tabindex="-1"></a>    , <span class="at">y =</span> <span class="st">&quot;max_ht_m : max_area_m2 : convexity_pct : circle_fit_iou_pct : chm_res_m : spectral_weight&quot;</span></span>
<span id="cb291-100"><a href="chm_sens_test.html#cb291-100" tabindex="-1"></a>    , <span class="at">subtitle =</span> <span class="fu">paste0</span>(</span>
<span id="cb291-101"><a href="chm_sens_test.html#cb291-101" tabindex="-1"></a>       <span class="st">&quot;Data Fusion&quot;</span></span>
<span id="cb291-102"><a href="chm_sens_test.html#cb291-102" tabindex="-1"></a>       , <span class="st">&quot;</span><span class="sc">\n</span><span class="st">pile detection and form quantification accuracy metrics for the top parameter settings tested&quot;</span></span>
<span id="cb291-103"><a href="chm_sens_test.html#cb291-103" tabindex="-1"></a>       <span class="co"># , scales::percent(1-pct_rank_th_top,accuracy=1)</span></span>
<span id="cb291-104"><a href="chm_sens_test.html#cb291-104" tabindex="-1"></a>       , <span class="st">&quot; (n=&quot;</span></span>
<span id="cb291-105"><a href="chm_sens_test.html#cb291-105" tabindex="-1"></a>       , scales<span class="sc">::</span><span class="fu">comma</span>(n_th_top_chm,<span class="at">accuracy=</span><span class="dv">1</span>)</span>
<span id="cb291-106"><a href="chm_sens_test.html#cb291-106" tabindex="-1"></a>       , <span class="st">&quot;) by CHM resolution&quot;</span></span>
<span id="cb291-107"><a href="chm_sens_test.html#cb291-107" tabindex="-1"></a>       , <span class="st">&quot;</span><span class="sc">\n</span><span class="st">based on both detection and quantification accuracy&quot;</span></span>
<span id="cb291-108"><a href="chm_sens_test.html#cb291-108" tabindex="-1"></a>      )</span>
<span id="cb291-109"><a href="chm_sens_test.html#cb291-109" tabindex="-1"></a>    , <span class="at">caption =</span> <span class="st">&quot;*darker colors indicate relatively higher accuracy values&quot;</span></span>
<span id="cb291-110"><a href="chm_sens_test.html#cb291-110" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb291-111"><a href="chm_sens_test.html#cb291-111" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb291-112"><a href="chm_sens_test.html#cb291-112" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb291-113"><a href="chm_sens_test.html#cb291-113" tabindex="-1"></a>    , <span class="at">panel.grid =</span> ggplot2<span class="sc">::</span><span class="fu">element_blank</span>()</span>
<span id="cb291-114"><a href="chm_sens_test.html#cb291-114" tabindex="-1"></a>    , <span class="at">strip.placement =</span> <span class="st">&quot;outside&quot;</span></span>
<span id="cb291-115"><a href="chm_sens_test.html#cb291-115" tabindex="-1"></a>    , <span class="at">strip.text.x =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb291-116"><a href="chm_sens_test.html#cb291-116" tabindex="-1"></a>    , <span class="at">strip.text.y =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">9</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb291-117"><a href="chm_sens_test.html#cb291-117" tabindex="-1"></a>    , <span class="at">axis.text.x =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">7</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb291-118"><a href="chm_sens_test.html#cb291-118" tabindex="-1"></a>    , <span class="at">axis.text.y =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">7</span>)</span>
<span id="cb291-119"><a href="chm_sens_test.html#cb291-119" tabindex="-1"></a>    , <span class="at">axis.title.x =</span> ggplot2<span class="sc">::</span><span class="fu">element_blank</span>()</span>
<span id="cb291-120"><a href="chm_sens_test.html#cb291-120" tabindex="-1"></a>    , <span class="at">plot.subtitle =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>)</span>
<span id="cb291-121"><a href="chm_sens_test.html#cb291-121" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-266-1.png" width="1008" /></p>
<p>this plot allows for a simultaneous comparison of all metrics for pile detection and pile form quantification. it includes only the parameter combinations that achieved the best balanced accuracy, helping users identify the optimal settings by evaluating the trade-offs between detection and form quantification.</p>
<p>let’s table this</p>
<div class="sourceCode" id="cb292"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb292-1"><a href="chm_sens_test.html#cb292-1" tabindex="-1"></a>param_combos_spectral_ranked <span class="sc">%&gt;%</span> </span>
<span id="cb292-2"><a href="chm_sens_test.html#cb292-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(is_final_selection_chm) <span class="sc">%&gt;%</span> </span>
<span id="cb292-3"><a href="chm_sens_test.html#cb292-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">!</span>tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;_pct_rank_&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb292-4"><a href="chm_sens_test.html#cb292-4" tabindex="-1"></a>  <span class="co"># first select to arrange eval_metric</span></span>
<span id="cb292-5"><a href="chm_sens_test.html#cb292-5" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb292-6"><a href="chm_sens_test.html#cb292-6" tabindex="-1"></a>    chm_lab, chm_res_m_desc</span>
<span id="cb292-7"><a href="chm_sens_test.html#cb292-7" tabindex="-1"></a>    , max_ht_m,max_area_m2,convexity_pct,circle_fit_iou_pct,chm_res_m,spectral_weight</span>
<span id="cb292-8"><a href="chm_sens_test.html#cb292-8" tabindex="-1"></a>    <span class="co"># detection</span></span>
<span id="cb292-9"><a href="chm_sens_test.html#cb292-9" tabindex="-1"></a>    , f_score, recall, precision</span>
<span id="cb292-10"><a href="chm_sens_test.html#cb292-10" tabindex="-1"></a>    <span class="co"># quantification</span></span>
<span id="cb292-11"><a href="chm_sens_test.html#cb292-11" tabindex="-1"></a>    , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_mean&quot;</span>)</span>
<span id="cb292-12"><a href="chm_sens_test.html#cb292-12" tabindex="-1"></a>    , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_rmse&quot;</span>)</span>
<span id="cb292-13"><a href="chm_sens_test.html#cb292-13" tabindex="-1"></a>    <span class="co"># , tidyselect::ends_with(&quot;_rrmse&quot;)</span></span>
<span id="cb292-14"><a href="chm_sens_test.html#cb292-14" tabindex="-1"></a>    , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_mape&quot;</span>)</span>
<span id="cb292-15"><a href="chm_sens_test.html#cb292-15" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb292-16"><a href="chm_sens_test.html#cb292-16" tabindex="-1"></a>  <span class="co"># second select to arrange pile_metric</span></span>
<span id="cb292-17"><a href="chm_sens_test.html#cb292-17" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb292-18"><a href="chm_sens_test.html#cb292-18" tabindex="-1"></a>    chm_lab, chm_res_m_desc</span>
<span id="cb292-19"><a href="chm_sens_test.html#cb292-19" tabindex="-1"></a>    , max_ht_m,max_area_m2,convexity_pct,circle_fit_iou_pct,chm_res_m,spectral_weight</span>
<span id="cb292-20"><a href="chm_sens_test.html#cb292-20" tabindex="-1"></a>    <span class="co"># detection</span></span>
<span id="cb292-21"><a href="chm_sens_test.html#cb292-21" tabindex="-1"></a>    , f_score, recall, precision</span>
<span id="cb292-22"><a href="chm_sens_test.html#cb292-22" tabindex="-1"></a>    <span class="co"># quantification</span></span>
<span id="cb292-23"><a href="chm_sens_test.html#cb292-23" tabindex="-1"></a>    , <span class="fu">c</span>(tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;volume&quot;</span>) <span class="sc">&amp;</span> <span class="sc">!</span>tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;paraboloid&quot;</span>))</span>
<span id="cb292-24"><a href="chm_sens_test.html#cb292-24" tabindex="-1"></a>    , tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;area&quot;</span>)</span>
<span id="cb292-25"><a href="chm_sens_test.html#cb292-25" tabindex="-1"></a>    , tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;height&quot;</span>)</span>
<span id="cb292-26"><a href="chm_sens_test.html#cb292-26" tabindex="-1"></a>    , tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;diameter&quot;</span>)</span>
<span id="cb292-27"><a href="chm_sens_test.html#cb292-27" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb292-28"><a href="chm_sens_test.html#cb292-28" tabindex="-1"></a>  <span class="co"># names()</span></span>
<span id="cb292-29"><a href="chm_sens_test.html#cb292-29" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb292-30"><a href="chm_sens_test.html#cb292-30" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">across</span>(</span>
<span id="cb292-31"><a href="chm_sens_test.html#cb292-31" tabindex="-1"></a>      <span class="at">.cols =</span> <span class="fu">c</span>(f_score, recall, precision, tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_mape&quot;</span>))</span>
<span id="cb292-32"><a href="chm_sens_test.html#cb292-32" tabindex="-1"></a>      , <span class="at">.fn =</span> <span class="sc">~</span> scales<span class="sc">::</span><span class="fu">percent</span>(.x, <span class="at">accuracy =</span> <span class="dv">1</span>)</span>
<span id="cb292-33"><a href="chm_sens_test.html#cb292-33" tabindex="-1"></a>    )</span>
<span id="cb292-34"><a href="chm_sens_test.html#cb292-34" tabindex="-1"></a>    , dplyr<span class="sc">::</span><span class="fu">across</span>(</span>
<span id="cb292-35"><a href="chm_sens_test.html#cb292-35" tabindex="-1"></a>      <span class="at">.cols =</span> <span class="fu">c</span>(tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_mean&quot;</span>))</span>
<span id="cb292-36"><a href="chm_sens_test.html#cb292-36" tabindex="-1"></a>      , <span class="at">.fn =</span> <span class="sc">~</span> scales<span class="sc">::</span><span class="fu">comma</span>(.x, <span class="at">accuracy =</span> <span class="fl">0.01</span>)</span>
<span id="cb292-37"><a href="chm_sens_test.html#cb292-37" tabindex="-1"></a>    )</span>
<span id="cb292-38"><a href="chm_sens_test.html#cb292-38" tabindex="-1"></a>    , dplyr<span class="sc">::</span><span class="fu">across</span>(</span>
<span id="cb292-39"><a href="chm_sens_test.html#cb292-39" tabindex="-1"></a>      <span class="at">.cols =</span> <span class="fu">c</span>(tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_rmse&quot;</span>))</span>
<span id="cb292-40"><a href="chm_sens_test.html#cb292-40" tabindex="-1"></a>      , <span class="at">.fn =</span> <span class="sc">~</span> scales<span class="sc">::</span><span class="fu">comma</span>(.x, <span class="at">accuracy =</span> <span class="fl">0.1</span>)</span>
<span id="cb292-41"><a href="chm_sens_test.html#cb292-41" tabindex="-1"></a>    )</span>
<span id="cb292-42"><a href="chm_sens_test.html#cb292-42" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb292-43"><a href="chm_sens_test.html#cb292-43" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">blank=</span> <span class="st">&quot;   &quot;</span> ) <span class="sc">%&gt;%</span> </span>
<span id="cb292-44"><a href="chm_sens_test.html#cb292-44" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">relocate</span>(blank, <span class="at">.before =</span> f_score) <span class="sc">%&gt;%</span> </span>
<span id="cb292-45"><a href="chm_sens_test.html#cb292-45" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(chm_res_m, <span class="fu">desc</span>(chm_lab)) <span class="sc">%&gt;%</span> </span>
<span id="cb292-46"><a href="chm_sens_test.html#cb292-46" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>chm_res_m) <span class="sc">%&gt;%</span> </span>
<span id="cb292-47"><a href="chm_sens_test.html#cb292-47" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">relocate</span>(chm_res_m_desc) <span class="sc">%&gt;%</span> </span>
<span id="cb292-48"><a href="chm_sens_test.html#cb292-48" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kbl</span>(</span>
<span id="cb292-49"><a href="chm_sens_test.html#cb292-49" tabindex="-1"></a>    <span class="at">caption =</span> </span>
<span id="cb292-50"><a href="chm_sens_test.html#cb292-50" tabindex="-1"></a>      <span class="fu">paste0</span>(</span>
<span id="cb292-51"><a href="chm_sens_test.html#cb292-51" tabindex="-1"></a>       <span class="st">&quot;Data Fusion&quot;</span></span>
<span id="cb292-52"><a href="chm_sens_test.html#cb292-52" tabindex="-1"></a>       , <span class="st">&quot;&lt;br&gt;pile detection and form quantification accuracy metrics for the top parameter settings tested&quot;</span></span>
<span id="cb292-53"><a href="chm_sens_test.html#cb292-53" tabindex="-1"></a>       <span class="co"># , scales::percent(1-pct_rank_th_top,accuracy=1)</span></span>
<span id="cb292-54"><a href="chm_sens_test.html#cb292-54" tabindex="-1"></a>       , <span class="st">&quot; (n=&quot;</span></span>
<span id="cb292-55"><a href="chm_sens_test.html#cb292-55" tabindex="-1"></a>       , scales<span class="sc">::</span><span class="fu">comma</span>(n_th_top_chm,<span class="at">accuracy=</span><span class="dv">1</span>)</span>
<span id="cb292-56"><a href="chm_sens_test.html#cb292-56" tabindex="-1"></a>       , <span class="st">&quot;) by CHM resolution &quot;</span></span>
<span id="cb292-57"><a href="chm_sens_test.html#cb292-57" tabindex="-1"></a>       , <span class="st">&quot;&lt;br&gt;based on both detection and quantification accuracy&quot;</span></span>
<span id="cb292-58"><a href="chm_sens_test.html#cb292-58" tabindex="-1"></a>      )</span>
<span id="cb292-59"><a href="chm_sens_test.html#cb292-59" tabindex="-1"></a>    , <span class="at">col.names =</span> <span class="fu">c</span>(</span>
<span id="cb292-60"><a href="chm_sens_test.html#cb292-60" tabindex="-1"></a>      <span class="st">&quot;.&quot;</span>, <span class="st">&quot;&quot;</span></span>
<span id="cb292-61"><a href="chm_sens_test.html#cb292-61" tabindex="-1"></a>      ,<span class="st">&quot;max_ht_m&quot;</span>,<span class="st">&quot;max_area_m2&quot;</span>,<span class="st">&quot;convexity_pct&quot;</span>,<span class="st">&quot;circle_fit_iou_pct&quot;</span>,<span class="st">&quot;spectral_weight&quot;</span></span>
<span id="cb292-62"><a href="chm_sens_test.html#cb292-62" tabindex="-1"></a>      , <span class="st">&quot;   &quot;</span></span>
<span id="cb292-63"><a href="chm_sens_test.html#cb292-63" tabindex="-1"></a>      , <span class="st">&quot;F-score&quot;</span>, <span class="st">&quot;Recall&quot;</span>, <span class="st">&quot;Precision&quot;</span></span>
<span id="cb292-64"><a href="chm_sens_test.html#cb292-64" tabindex="-1"></a>      , <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;ME&quot;</span>,<span class="st">&quot;RMSE&quot;</span>,<span class="st">&quot;MAPE&quot;</span>), <span class="at">times =</span> <span class="dv">3</span>)</span>
<span id="cb292-65"><a href="chm_sens_test.html#cb292-65" tabindex="-1"></a>    )</span>
<span id="cb292-66"><a href="chm_sens_test.html#cb292-66" tabindex="-1"></a>    , <span class="at">escape =</span> F</span>
<span id="cb292-67"><a href="chm_sens_test.html#cb292-67" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb292-68"><a href="chm_sens_test.html#cb292-68" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kable_styling</span>(<span class="at">font_size =</span> <span class="dv">11</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb292-69"><a href="chm_sens_test.html#cb292-69" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">add_header_above</span>(<span class="fu">c</span>(</span>
<span id="cb292-70"><a href="chm_sens_test.html#cb292-70" tabindex="-1"></a>    <span class="st">&quot; &quot;</span><span class="ot">=</span><span class="dv">8</span></span>
<span id="cb292-71"><a href="chm_sens_test.html#cb292-71" tabindex="-1"></a>    , <span class="st">&quot;Detection&quot;</span> <span class="ot">=</span> <span class="dv">3</span></span>
<span id="cb292-72"><a href="chm_sens_test.html#cb292-72" tabindex="-1"></a>    <span class="co"># , &quot;Volume&quot; = 3</span></span>
<span id="cb292-73"><a href="chm_sens_test.html#cb292-73" tabindex="-1"></a>    , <span class="st">&quot;Area&quot;</span> <span class="ot">=</span> <span class="dv">3</span></span>
<span id="cb292-74"><a href="chm_sens_test.html#cb292-74" tabindex="-1"></a>    , <span class="st">&quot;Height&quot;</span> <span class="ot">=</span> <span class="dv">3</span></span>
<span id="cb292-75"><a href="chm_sens_test.html#cb292-75" tabindex="-1"></a>    , <span class="st">&quot;Diameter&quot;</span> <span class="ot">=</span> <span class="dv">3</span></span>
<span id="cb292-76"><a href="chm_sens_test.html#cb292-76" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb292-77"><a href="chm_sens_test.html#cb292-77" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">column_spec</span>(<span class="fu">seq</span>(<span class="dv">8</span>,<span class="dv">20</span>,<span class="at">by=</span><span class="dv">3</span>), <span class="at">border_right =</span> <span class="cn">TRUE</span>, <span class="at">include_thead =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb292-78"><a href="chm_sens_test.html#cb292-78" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">column_spec</span>(</span>
<span id="cb292-79"><a href="chm_sens_test.html#cb292-79" tabindex="-1"></a>    <span class="at">column =</span> <span class="dv">8</span><span class="sc">:</span><span class="dv">20</span></span>
<span id="cb292-80"><a href="chm_sens_test.html#cb292-80" tabindex="-1"></a>    , <span class="at">extra_css =</span> <span class="st">&quot;font-size: 10px;&quot;</span></span>
<span id="cb292-81"><a href="chm_sens_test.html#cb292-81" tabindex="-1"></a>    , <span class="at">include_thead =</span> T</span>
<span id="cb292-82"><a href="chm_sens_test.html#cb292-82" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb292-83"><a href="chm_sens_test.html#cb292-83" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">collapse_rows</span>(<span class="at">columns =</span> <span class="dv">1</span>, <span class="at">valign =</span> <span class="st">&quot;top&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb292-84"><a href="chm_sens_test.html#cb292-84" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">scroll_box</span>(<span class="at">width =</span> <span class="st">&quot;740px&quot;</span>) </span></code></pre></div>
<div style="border: 1px solid #ddd; padding: 5px; overflow-x: scroll; width:740px; ">
<table class="table" style="font-size: 11px; margin-left: auto; margin-right: auto;">
<caption style="font-size: initial !important;">
<span id="tab:unnamed-chunk-268">Table 8.4: </span>Data Fusion<br>pile detection and form quantification accuracy metrics for the top parameter settings tested (n=6) by CHM resolution <br>based on both detection and quantification accuracy
</caption>
<thead>
<tr>
<th style="empty-cells: hide;border-bottom:hidden;" colspan="8">
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="3">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Detection
</div>
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="3">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Area
</div>
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="3">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Height
</div>
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="3">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Diameter
</div>
</th>
</tr>
<tr>
<th style="text-align:left;">
.
</th>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
max_ht_m
</th>
<th style="text-align:right;">
max_area_m2
</th>
<th style="text-align:right;">
convexity_pct
</th>
<th style="text-align:right;">
circle_fit_iou_pct
</th>
<th style="text-align:right;">
spectral_weight
</th>
<th style="text-align:left;border-right:1px solid;font-size: 10px;">
</th>
<th style="text-align:left;font-size: 10px;">
F-score
</th>
<th style="text-align:left;font-size: 10px;">
Recall
</th>
<th style="text-align:left;border-right:1px solid;font-size: 10px;">
Precision
</th>
<th style="text-align:left;font-size: 10px;">
ME
</th>
<th style="text-align:left;font-size: 10px;">
RMSE
</th>
<th style="text-align:left;border-right:1px solid;font-size: 10px;">
MAPE
</th>
<th style="text-align:left;font-size: 10px;">
ME
</th>
<th style="text-align:left;font-size: 10px;">
RMSE
</th>
<th style="text-align:left;border-right:1px solid;font-size: 10px;">
MAPE
</th>
<th style="text-align:left;font-size: 10px;">
ME
</th>
<th style="text-align:left;font-size: 10px;">
RMSE
</th>
<th style="text-align:left;border-right:1px solid;font-size: 10px;">
MAPE
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="6">
0.1m CHM
</td>
<td style="text-align:left;">
5:50:0.65:0.65:0.1:4
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
50
</td>
<td style="text-align:right;">
0.65
</td>
<td style="text-align:right;">
0.65
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
89%
</td>
<td style="text-align:left;font-size: 10px;">
91%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
87%
</td>
<td style="text-align:left;font-size: 10px;">
-0.81
</td>
<td style="text-align:left;font-size: 10px;">
2.1
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
10%
</td>
<td style="text-align:left;font-size: 10px;">
-0.09
</td>
<td style="text-align:left;font-size: 10px;">
0.6
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
18%
</td>
<td style="text-align:left;font-size: 10px;">
0.21
</td>
<td style="text-align:left;font-size: 10px;">
0.5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
10%
</td>
</tr>
<tr>
<td style="text-align:left;">
5:50:0.5:0.65:0.1:4
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
50
</td>
<td style="text-align:right;">
0.50
</td>
<td style="text-align:right;">
0.65
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
89%
</td>
<td style="text-align:left;font-size: 10px;">
91%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
87%
</td>
<td style="text-align:left;font-size: 10px;">
-0.81
</td>
<td style="text-align:left;font-size: 10px;">
2.1
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
10%
</td>
<td style="text-align:left;font-size: 10px;">
-0.09
</td>
<td style="text-align:left;font-size: 10px;">
0.6
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
18%
</td>
<td style="text-align:left;font-size: 10px;">
0.21
</td>
<td style="text-align:left;font-size: 10px;">
0.5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
10%
</td>
</tr>
<tr>
<td style="text-align:left;">
5:50:0.35:0.65:0.1:4
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
50
</td>
<td style="text-align:right;">
0.35
</td>
<td style="text-align:right;">
0.65
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
89%
</td>
<td style="text-align:left;font-size: 10px;">
91%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
87%
</td>
<td style="text-align:left;font-size: 10px;">
-0.81
</td>
<td style="text-align:left;font-size: 10px;">
2.1
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
10%
</td>
<td style="text-align:left;font-size: 10px;">
-0.09
</td>
<td style="text-align:left;font-size: 10px;">
0.6
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
18%
</td>
<td style="text-align:left;font-size: 10px;">
0.21
</td>
<td style="text-align:left;font-size: 10px;">
0.5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
10%
</td>
</tr>
<tr>
<td style="text-align:left;">
5:50:0.2:0.65:0.1:4
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
50
</td>
<td style="text-align:right;">
0.20
</td>
<td style="text-align:right;">
0.65
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
89%
</td>
<td style="text-align:left;font-size: 10px;">
91%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
87%
</td>
<td style="text-align:left;font-size: 10px;">
-0.81
</td>
<td style="text-align:left;font-size: 10px;">
2.1
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
10%
</td>
<td style="text-align:left;font-size: 10px;">
-0.09
</td>
<td style="text-align:left;font-size: 10px;">
0.6
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
18%
</td>
<td style="text-align:left;font-size: 10px;">
0.21
</td>
<td style="text-align:left;font-size: 10px;">
0.5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
10%
</td>
</tr>
<tr>
<td style="text-align:left;">
5:50:0.05:0.65:0.1:4
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
50
</td>
<td style="text-align:right;">
0.05
</td>
<td style="text-align:right;">
0.65
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
89%
</td>
<td style="text-align:left;font-size: 10px;">
91%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
87%
</td>
<td style="text-align:left;font-size: 10px;">
-0.81
</td>
<td style="text-align:left;font-size: 10px;">
2.1
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
10%
</td>
<td style="text-align:left;font-size: 10px;">
-0.09
</td>
<td style="text-align:left;font-size: 10px;">
0.6
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
18%
</td>
<td style="text-align:left;font-size: 10px;">
0.21
</td>
<td style="text-align:left;font-size: 10px;">
0.5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
10%
</td>
</tr>
<tr>
<td style="text-align:left;">
5:40:0.8:0.5:0.1:4
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
40
</td>
<td style="text-align:right;">
0.80
</td>
<td style="text-align:right;">
0.50
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
87%
</td>
<td style="text-align:left;font-size: 10px;">
92%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
83%
</td>
<td style="text-align:left;font-size: 10px;">
-0.66
</td>
<td style="text-align:left;font-size: 10px;">
1.7
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
11%
</td>
<td style="text-align:left;font-size: 10px;">
-0.06
</td>
<td style="text-align:left;font-size: 10px;">
0.6
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
19%
</td>
<td style="text-align:left;font-size: 10px;">
0.19
</td>
<td style="text-align:left;font-size: 10px;">
0.5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
10%
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="6">
0.2m CHM
</td>
<td style="text-align:left;">
2:60:0.8:0.05:0.2:4
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
60
</td>
<td style="text-align:right;">
0.80
</td>
<td style="text-align:right;">
0.05
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
80%
</td>
<td style="text-align:left;font-size: 10px;">
84%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
76%
</td>
<td style="text-align:left;font-size: 10px;">
0.53
</td>
<td style="text-align:left;font-size: 10px;">
1.7
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
13%
</td>
<td style="text-align:left;font-size: 10px;">
-0.27
</td>
<td style="text-align:left;font-size: 10px;">
0.5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
14%
</td>
<td style="text-align:left;font-size: 10px;">
0.48
</td>
<td style="text-align:left;font-size: 10px;">
0.7
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
18%
</td>
</tr>
<tr>
<td style="text-align:left;">
2:50:0.8:0.05:0.2:4
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
50
</td>
<td style="text-align:right;">
0.80
</td>
<td style="text-align:right;">
0.05
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
80%
</td>
<td style="text-align:left;font-size: 10px;">
84%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
76%
</td>
<td style="text-align:left;font-size: 10px;">
0.53
</td>
<td style="text-align:left;font-size: 10px;">
1.7
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
13%
</td>
<td style="text-align:left;font-size: 10px;">
-0.27
</td>
<td style="text-align:left;font-size: 10px;">
0.5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
14%
</td>
<td style="text-align:left;font-size: 10px;">
0.48
</td>
<td style="text-align:left;font-size: 10px;">
0.7
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
18%
</td>
</tr>
<tr>
<td style="text-align:left;">
2:40:0.8:0.05:0.2:4
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
40
</td>
<td style="text-align:right;">
0.80
</td>
<td style="text-align:right;">
0.05
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
80%
</td>
<td style="text-align:left;font-size: 10px;">
84%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
76%
</td>
<td style="text-align:left;font-size: 10px;">
0.53
</td>
<td style="text-align:left;font-size: 10px;">
1.7
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
13%
</td>
<td style="text-align:left;font-size: 10px;">
-0.27
</td>
<td style="text-align:left;font-size: 10px;">
0.5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
14%
</td>
<td style="text-align:left;font-size: 10px;">
0.48
</td>
<td style="text-align:left;font-size: 10px;">
0.7
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
18%
</td>
</tr>
<tr>
<td style="text-align:left;">
2:30:0.8:0.05:0.2:4
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
30
</td>
<td style="text-align:right;">
0.80
</td>
<td style="text-align:right;">
0.05
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
80%
</td>
<td style="text-align:left;font-size: 10px;">
84%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
76%
</td>
<td style="text-align:left;font-size: 10px;">
0.53
</td>
<td style="text-align:left;font-size: 10px;">
1.7
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
13%
</td>
<td style="text-align:left;font-size: 10px;">
-0.27
</td>
<td style="text-align:left;font-size: 10px;">
0.5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
14%
</td>
<td style="text-align:left;font-size: 10px;">
0.48
</td>
<td style="text-align:left;font-size: 10px;">
0.7
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
18%
</td>
</tr>
<tr>
<td style="text-align:left;">
2:40:0.8:0.05:0.2:3
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
40
</td>
<td style="text-align:right;">
0.80
</td>
<td style="text-align:right;">
0.05
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
76%
</td>
<td style="text-align:left;font-size: 10px;">
84%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
70%
</td>
<td style="text-align:left;font-size: 10px;">
0.53
</td>
<td style="text-align:left;font-size: 10px;">
1.7
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
13%
</td>
<td style="text-align:left;font-size: 10px;">
-0.27
</td>
<td style="text-align:left;font-size: 10px;">
0.5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
14%
</td>
<td style="text-align:left;font-size: 10px;">
0.48
</td>
<td style="text-align:left;font-size: 10px;">
0.7
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
18%
</td>
</tr>
<tr>
<td style="text-align:left;">
2:30:0.8:0.05:0.2:3
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
30
</td>
<td style="text-align:right;">
0.80
</td>
<td style="text-align:right;">
0.05
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
76%
</td>
<td style="text-align:left;font-size: 10px;">
84%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
70%
</td>
<td style="text-align:left;font-size: 10px;">
0.53
</td>
<td style="text-align:left;font-size: 10px;">
1.7
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
13%
</td>
<td style="text-align:left;font-size: 10px;">
-0.27
</td>
<td style="text-align:left;font-size: 10px;">
0.5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
14%
</td>
<td style="text-align:left;font-size: 10px;">
0.48
</td>
<td style="text-align:left;font-size: 10px;">
0.7
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
18%
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="6">
0.3m CHM
</td>
<td style="text-align:left;">
5:60:0.8:0.65:0.3:5
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
60
</td>
<td style="text-align:right;">
0.80
</td>
<td style="text-align:right;">
0.65
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
80%
</td>
<td style="text-align:left;font-size: 10px;">
78%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
82%
</td>
<td style="text-align:left;font-size: 10px;">
1.59
</td>
<td style="text-align:left;font-size: 10px;">
2.2
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
22%
</td>
<td style="text-align:left;font-size: 10px;">
-0.14
</td>
<td style="text-align:left;font-size: 10px;">
0.7
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
18%
</td>
<td style="text-align:left;font-size: 10px;">
0.74
</td>
<td style="text-align:left;font-size: 10px;">
0.8
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
24%
</td>
</tr>
<tr>
<td style="text-align:left;">
5:60:0.65:0.65:0.3:5
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
60
</td>
<td style="text-align:right;">
0.65
</td>
<td style="text-align:right;">
0.65
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
80%
</td>
<td style="text-align:left;font-size: 10px;">
78%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
82%
</td>
<td style="text-align:left;font-size: 10px;">
1.59
</td>
<td style="text-align:left;font-size: 10px;">
2.2
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
22%
</td>
<td style="text-align:left;font-size: 10px;">
-0.14
</td>
<td style="text-align:left;font-size: 10px;">
0.7
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
18%
</td>
<td style="text-align:left;font-size: 10px;">
0.74
</td>
<td style="text-align:left;font-size: 10px;">
0.8
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
24%
</td>
</tr>
<tr>
<td style="text-align:left;">
5:60:0.5:0.65:0.3:5
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
60
</td>
<td style="text-align:right;">
0.50
</td>
<td style="text-align:right;">
0.65
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
80%
</td>
<td style="text-align:left;font-size: 10px;">
78%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
82%
</td>
<td style="text-align:left;font-size: 10px;">
1.59
</td>
<td style="text-align:left;font-size: 10px;">
2.2
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
22%
</td>
<td style="text-align:left;font-size: 10px;">
-0.14
</td>
<td style="text-align:left;font-size: 10px;">
0.7
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
18%
</td>
<td style="text-align:left;font-size: 10px;">
0.74
</td>
<td style="text-align:left;font-size: 10px;">
0.8
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
24%
</td>
</tr>
<tr>
<td style="text-align:left;">
5:60:0.35:0.65:0.3:5
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
60
</td>
<td style="text-align:right;">
0.35
</td>
<td style="text-align:right;">
0.65
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
80%
</td>
<td style="text-align:left;font-size: 10px;">
78%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
82%
</td>
<td style="text-align:left;font-size: 10px;">
1.59
</td>
<td style="text-align:left;font-size: 10px;">
2.2
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
22%
</td>
<td style="text-align:left;font-size: 10px;">
-0.14
</td>
<td style="text-align:left;font-size: 10px;">
0.7
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
18%
</td>
<td style="text-align:left;font-size: 10px;">
0.74
</td>
<td style="text-align:left;font-size: 10px;">
0.8
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
24%
</td>
</tr>
<tr>
<td style="text-align:left;">
5:60:0.2:0.65:0.3:5
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
60
</td>
<td style="text-align:right;">
0.20
</td>
<td style="text-align:right;">
0.65
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
80%
</td>
<td style="text-align:left;font-size: 10px;">
78%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
82%
</td>
<td style="text-align:left;font-size: 10px;">
1.59
</td>
<td style="text-align:left;font-size: 10px;">
2.2
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
22%
</td>
<td style="text-align:left;font-size: 10px;">
-0.14
</td>
<td style="text-align:left;font-size: 10px;">
0.7
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
18%
</td>
<td style="text-align:left;font-size: 10px;">
0.74
</td>
<td style="text-align:left;font-size: 10px;">
0.8
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
24%
</td>
</tr>
<tr>
<td style="text-align:left;">
5:60:0.05:0.65:0.3:5
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
60
</td>
<td style="text-align:right;">
0.05
</td>
<td style="text-align:right;">
0.65
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
80%
</td>
<td style="text-align:left;font-size: 10px;">
78%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
82%
</td>
<td style="text-align:left;font-size: 10px;">
1.59
</td>
<td style="text-align:left;font-size: 10px;">
2.2
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
22%
</td>
<td style="text-align:left;font-size: 10px;">
-0.14
</td>
<td style="text-align:left;font-size: 10px;">
0.7
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
18%
</td>
<td style="text-align:left;font-size: 10px;">
0.74
</td>
<td style="text-align:left;font-size: 10px;">
0.8
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
24%
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="6">
0.4m CHM
</td>
<td style="text-align:left;">
2:40:0.8:0.05:0.4:4
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
40
</td>
<td style="text-align:right;">
0.80
</td>
<td style="text-align:right;">
0.05
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
63%
</td>
<td style="text-align:left;font-size: 10px;">
81%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
52%
</td>
<td style="text-align:left;font-size: 10px;">
2.48
</td>
<td style="text-align:left;font-size: 10px;">
3.1
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
37%
</td>
<td style="text-align:left;font-size: 10px;">
-0.29
</td>
<td style="text-align:left;font-size: 10px;">
0.5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
15%
</td>
<td style="text-align:left;font-size: 10px;">
1.01
</td>
<td style="text-align:left;font-size: 10px;">
1.1
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
34%
</td>
</tr>
<tr>
<td style="text-align:left;">
2:30:0.8:0.05:0.4:4
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
30
</td>
<td style="text-align:right;">
0.80
</td>
<td style="text-align:right;">
0.05
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
63%
</td>
<td style="text-align:left;font-size: 10px;">
81%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
52%
</td>
<td style="text-align:left;font-size: 10px;">
2.48
</td>
<td style="text-align:left;font-size: 10px;">
3.1
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
37%
</td>
<td style="text-align:left;font-size: 10px;">
-0.29
</td>
<td style="text-align:left;font-size: 10px;">
0.5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
15%
</td>
<td style="text-align:left;font-size: 10px;">
1.01
</td>
<td style="text-align:left;font-size: 10px;">
1.1
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
34%
</td>
</tr>
<tr>
<td style="text-align:left;">
2:20:0.5:0.05:0.4:5
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
20
</td>
<td style="text-align:right;">
0.50
</td>
<td style="text-align:right;">
0.05
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
70%
</td>
<td style="text-align:left;font-size: 10px;">
81%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
62%
</td>
<td style="text-align:left;font-size: 10px;">
1.77
</td>
<td style="text-align:left;font-size: 10px;">
5.6
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
38%
</td>
<td style="text-align:left;font-size: 10px;">
-0.30
</td>
<td style="text-align:left;font-size: 10px;">
0.5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
15%
</td>
<td style="text-align:left;font-size: 10px;">
0.96
</td>
<td style="text-align:left;font-size: 10px;">
1.2
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
35%
</td>
</tr>
<tr>
<td style="text-align:left;">
2:20:0.35:0.05:0.4:5
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
20
</td>
<td style="text-align:right;">
0.35
</td>
<td style="text-align:right;">
0.05
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
70%
</td>
<td style="text-align:left;font-size: 10px;">
81%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
62%
</td>
<td style="text-align:left;font-size: 10px;">
1.77
</td>
<td style="text-align:left;font-size: 10px;">
5.6
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
38%
</td>
<td style="text-align:left;font-size: 10px;">
-0.30
</td>
<td style="text-align:left;font-size: 10px;">
0.5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
15%
</td>
<td style="text-align:left;font-size: 10px;">
0.96
</td>
<td style="text-align:left;font-size: 10px;">
1.2
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
35%
</td>
</tr>
<tr>
<td style="text-align:left;">
2:20:0.2:0.05:0.4:5
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
20
</td>
<td style="text-align:right;">
0.20
</td>
<td style="text-align:right;">
0.05
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
70%
</td>
<td style="text-align:left;font-size: 10px;">
81%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
62%
</td>
<td style="text-align:left;font-size: 10px;">
1.77
</td>
<td style="text-align:left;font-size: 10px;">
5.6
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
38%
</td>
<td style="text-align:left;font-size: 10px;">
-0.30
</td>
<td style="text-align:left;font-size: 10px;">
0.5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
15%
</td>
<td style="text-align:left;font-size: 10px;">
0.96
</td>
<td style="text-align:left;font-size: 10px;">
1.2
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
35%
</td>
</tr>
<tr>
<td style="text-align:left;">
2:20:0.05:0.05:0.4:5
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
20
</td>
<td style="text-align:right;">
0.05
</td>
<td style="text-align:right;">
0.05
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
70%
</td>
<td style="text-align:left;font-size: 10px;">
81%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
62%
</td>
<td style="text-align:left;font-size: 10px;">
1.77
</td>
<td style="text-align:left;font-size: 10px;">
5.6
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
38%
</td>
<td style="text-align:left;font-size: 10px;">
-0.30
</td>
<td style="text-align:left;font-size: 10px;">
0.5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
15%
</td>
<td style="text-align:left;font-size: 10px;">
0.96
</td>
<td style="text-align:left;font-size: 10px;">
1.2
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
35%
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="6">
0.5m CHM
</td>
<td style="text-align:left;">
3:60:0.5:0.35:0.5:5
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
60
</td>
<td style="text-align:right;">
0.50
</td>
<td style="text-align:right;">
0.35
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
64%
</td>
<td style="text-align:left;font-size: 10px;">
83%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
51%
</td>
<td style="text-align:left;font-size: 10px;">
3.67
</td>
<td style="text-align:left;font-size: 10px;">
4.4
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
50%
</td>
<td style="text-align:left;font-size: 10px;">
-0.11
</td>
<td style="text-align:left;font-size: 10px;">
0.8
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
21%
</td>
<td style="text-align:left;font-size: 10px;">
1.30
</td>
<td style="text-align:left;font-size: 10px;">
1.4
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
41%
</td>
</tr>
<tr>
<td style="text-align:left;">
3:60:0.35:0.35:0.5:5
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
60
</td>
<td style="text-align:right;">
0.35
</td>
<td style="text-align:right;">
0.35
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
64%
</td>
<td style="text-align:left;font-size: 10px;">
83%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
51%
</td>
<td style="text-align:left;font-size: 10px;">
3.67
</td>
<td style="text-align:left;font-size: 10px;">
4.4
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
50%
</td>
<td style="text-align:left;font-size: 10px;">
-0.11
</td>
<td style="text-align:left;font-size: 10px;">
0.8
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
21%
</td>
<td style="text-align:left;font-size: 10px;">
1.30
</td>
<td style="text-align:left;font-size: 10px;">
1.4
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
41%
</td>
</tr>
<tr>
<td style="text-align:left;">
3:60:0.2:0.35:0.5:5
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
60
</td>
<td style="text-align:right;">
0.20
</td>
<td style="text-align:right;">
0.35
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
64%
</td>
<td style="text-align:left;font-size: 10px;">
83%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
51%
</td>
<td style="text-align:left;font-size: 10px;">
3.67
</td>
<td style="text-align:left;font-size: 10px;">
4.4
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
50%
</td>
<td style="text-align:left;font-size: 10px;">
-0.11
</td>
<td style="text-align:left;font-size: 10px;">
0.8
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
21%
</td>
<td style="text-align:left;font-size: 10px;">
1.30
</td>
<td style="text-align:left;font-size: 10px;">
1.4
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
41%
</td>
</tr>
<tr>
<td style="text-align:left;">
3:60:0.05:0.35:0.5:5
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
60
</td>
<td style="text-align:right;">
0.05
</td>
<td style="text-align:right;">
0.35
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
64%
</td>
<td style="text-align:left;font-size: 10px;">
83%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
51%
</td>
<td style="text-align:left;font-size: 10px;">
3.67
</td>
<td style="text-align:left;font-size: 10px;">
4.4
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
50%
</td>
<td style="text-align:left;font-size: 10px;">
-0.11
</td>
<td style="text-align:left;font-size: 10px;">
0.8
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
21%
</td>
<td style="text-align:left;font-size: 10px;">
1.30
</td>
<td style="text-align:left;font-size: 10px;">
1.4
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
41%
</td>
</tr>
<tr>
<td style="text-align:left;">
3:60:0.65:0.35:0.5:5
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
60
</td>
<td style="text-align:right;">
0.65
</td>
<td style="text-align:right;">
0.35
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
63%
</td>
<td style="text-align:left;font-size: 10px;">
83%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
51%
</td>
<td style="text-align:left;font-size: 10px;">
3.67
</td>
<td style="text-align:left;font-size: 10px;">
4.4
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
50%
</td>
<td style="text-align:left;font-size: 10px;">
-0.11
</td>
<td style="text-align:left;font-size: 10px;">
0.8
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
21%
</td>
<td style="text-align:left;font-size: 10px;">
1.30
</td>
<td style="text-align:left;font-size: 10px;">
1.4
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
41%
</td>
</tr>
<tr>
<td style="text-align:left;">
3:60:0.8:0.05:0.5:5
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
60
</td>
<td style="text-align:right;">
0.80
</td>
<td style="text-align:right;">
0.05
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
</td>
<td style="text-align:left;font-size: 10px;">
64%
</td>
<td style="text-align:left;font-size: 10px;">
87%
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
50%
</td>
<td style="text-align:left;font-size: 10px;">
3.78
</td>
<td style="text-align:left;font-size: 10px;">
4.4
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
50%
</td>
<td style="text-align:left;font-size: 10px;">
-0.11
</td>
<td style="text-align:left;font-size: 10px;">
0.7
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
20%
</td>
<td style="text-align:left;font-size: 10px;">
1.33
</td>
<td style="text-align:left;font-size: 10px;">
1.4
</td>
<td style="text-align:left;border-right:1px solid;font-size: 10px;">
42%
</td>
</tr>
</tbody>
</table>
</div>
<p>what is the expected <em>detection</em> accuracy of the top 6 settings by CHM resolution?</p>
<div class="sourceCode" id="cb293"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb293-1"><a href="chm_sens_test.html#cb293-1" tabindex="-1"></a><span class="fu">plt_detection_dist2</span>(</span>
<span id="cb293-2"><a href="chm_sens_test.html#cb293-2" tabindex="-1"></a>  <span class="at">df =</span> param_combos_spectral_ranked <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(is_final_selection_chm) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">!</span>tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;_pct_rank_&quot;</span>))</span>
<span id="cb293-3"><a href="chm_sens_test.html#cb293-3" tabindex="-1"></a>  , <span class="fu">paste0</span>(</span>
<span id="cb293-4"><a href="chm_sens_test.html#cb293-4" tabindex="-1"></a>    <span class="st">&quot;Data Fusion&quot;</span></span>
<span id="cb293-5"><a href="chm_sens_test.html#cb293-5" tabindex="-1"></a>    , <span class="st">&quot;</span><span class="sc">\n</span><span class="st">distribution of pile detection metrics for the top parameter settings tested&quot;</span></span>
<span id="cb293-6"><a href="chm_sens_test.html#cb293-6" tabindex="-1"></a>    , <span class="st">&quot; (n=&quot;</span></span>
<span id="cb293-7"><a href="chm_sens_test.html#cb293-7" tabindex="-1"></a>    , scales<span class="sc">::</span><span class="fu">comma</span>(n_th_top_chm,<span class="at">accuracy=</span><span class="dv">1</span>)</span>
<span id="cb293-8"><a href="chm_sens_test.html#cb293-8" tabindex="-1"></a>    , <span class="st">&quot;) by CHM resolution&quot;</span></span>
<span id="cb293-9"><a href="chm_sens_test.html#cb293-9" tabindex="-1"></a>    , <span class="st">&quot;</span><span class="sc">\n</span><span class="st">based on both detection and quantification accuracy&quot;</span></span>
<span id="cb293-10"><a href="chm_sens_test.html#cb293-10" tabindex="-1"></a>  )</span>
<span id="cb293-11"><a href="chm_sens_test.html#cb293-11" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-269-1.png" width="1008" /></p>
<p>what is the expected <em>MAPE</em> of the top 6 settings by CHM resolution?</p>
<div class="sourceCode" id="cb294"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb294-1"><a href="chm_sens_test.html#cb294-1" tabindex="-1"></a><span class="co"># plot it</span></span>
<span id="cb294-2"><a href="chm_sens_test.html#cb294-2" tabindex="-1"></a><span class="fu">plt_form_quantification_dist2</span>(</span>
<span id="cb294-3"><a href="chm_sens_test.html#cb294-3" tabindex="-1"></a>  <span class="at">df =</span> param_combos_spectral_ranked <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(is_final_selection_chm) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">!</span>tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;_pct_rank_&quot;</span>))</span>
<span id="cb294-4"><a href="chm_sens_test.html#cb294-4" tabindex="-1"></a>  , <span class="at">quant_metric =</span> <span class="st">&quot;mape&quot;</span></span>
<span id="cb294-5"><a href="chm_sens_test.html#cb294-5" tabindex="-1"></a>  , <span class="fu">paste0</span>(</span>
<span id="cb294-6"><a href="chm_sens_test.html#cb294-6" tabindex="-1"></a>    <span class="st">&quot;Data Fusion&quot;</span></span>
<span id="cb294-7"><a href="chm_sens_test.html#cb294-7" tabindex="-1"></a>    , <span class="st">&quot;</span><span class="sc">\n</span><span class="st">distribution of pile form quantification metrics for the top parameter settings tested&quot;</span></span>
<span id="cb294-8"><a href="chm_sens_test.html#cb294-8" tabindex="-1"></a>    , <span class="st">&quot; (n=&quot;</span></span>
<span id="cb294-9"><a href="chm_sens_test.html#cb294-9" tabindex="-1"></a>    , scales<span class="sc">::</span><span class="fu">comma</span>(n_th_top_chm,<span class="at">accuracy=</span><span class="dv">1</span>)</span>
<span id="cb294-10"><a href="chm_sens_test.html#cb294-10" tabindex="-1"></a>    , <span class="st">&quot;) by CHM resolution&quot;</span></span>
<span id="cb294-11"><a href="chm_sens_test.html#cb294-11" tabindex="-1"></a>    , <span class="st">&quot;</span><span class="sc">\n</span><span class="st">based on both detection and quantification accuracy&quot;</span></span>
<span id="cb294-12"><a href="chm_sens_test.html#cb294-12" tabindex="-1"></a>  )</span>
<span id="cb294-13"><a href="chm_sens_test.html#cb294-13" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-270-1.png" width="1008" /></p>
<p>what is the expected <em>Mean Error (ME)</em> of the top 6 settings by CHM resolution?</p>
<div class="sourceCode" id="cb295"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb295-1"><a href="chm_sens_test.html#cb295-1" tabindex="-1"></a><span class="co"># plot it</span></span>
<span id="cb295-2"><a href="chm_sens_test.html#cb295-2" tabindex="-1"></a><span class="fu">plt_form_quantification_dist2</span>(</span>
<span id="cb295-3"><a href="chm_sens_test.html#cb295-3" tabindex="-1"></a>  <span class="at">df =</span> param_combos_spectral_ranked <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(is_final_selection_chm) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">!</span>tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;_pct_rank_&quot;</span>))</span>
<span id="cb295-4"><a href="chm_sens_test.html#cb295-4" tabindex="-1"></a>  , <span class="at">quant_metric =</span> <span class="st">&quot;mean&quot;</span></span>
<span id="cb295-5"><a href="chm_sens_test.html#cb295-5" tabindex="-1"></a>  , <span class="fu">paste0</span>(</span>
<span id="cb295-6"><a href="chm_sens_test.html#cb295-6" tabindex="-1"></a>    <span class="st">&quot;Data Fusion&quot;</span></span>
<span id="cb295-7"><a href="chm_sens_test.html#cb295-7" tabindex="-1"></a>    , <span class="st">&quot;</span><span class="sc">\n</span><span class="st">distribution of pile form quantification metrics for the top parameter settings tested&quot;</span></span>
<span id="cb295-8"><a href="chm_sens_test.html#cb295-8" tabindex="-1"></a>    , <span class="st">&quot; (n=&quot;</span></span>
<span id="cb295-9"><a href="chm_sens_test.html#cb295-9" tabindex="-1"></a>    , scales<span class="sc">::</span><span class="fu">comma</span>(n_th_top_chm,<span class="at">accuracy=</span><span class="dv">1</span>)</span>
<span id="cb295-10"><a href="chm_sens_test.html#cb295-10" tabindex="-1"></a>    , <span class="st">&quot;) by CHM resolution&quot;</span></span>
<span id="cb295-11"><a href="chm_sens_test.html#cb295-11" tabindex="-1"></a>    , <span class="st">&quot;</span><span class="sc">\n</span><span class="st">based on both detection and quantification accuracy&quot;</span></span>
<span id="cb295-12"><a href="chm_sens_test.html#cb295-12" tabindex="-1"></a>  )</span>
<span id="cb295-13"><a href="chm_sens_test.html#cb295-13" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-271-1.png" width="1008" /></p>
<p>what is the expected <em>RMSE</em> of the top 6 settings by CHM resolution?</p>
<div class="sourceCode" id="cb296"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb296-1"><a href="chm_sens_test.html#cb296-1" tabindex="-1"></a><span class="co"># plot it</span></span>
<span id="cb296-2"><a href="chm_sens_test.html#cb296-2" tabindex="-1"></a><span class="fu">plt_form_quantification_dist2</span>(</span>
<span id="cb296-3"><a href="chm_sens_test.html#cb296-3" tabindex="-1"></a>  <span class="at">df =</span> param_combos_spectral_ranked <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(is_final_selection_chm) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">!</span>tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;_pct_rank_&quot;</span>))</span>
<span id="cb296-4"><a href="chm_sens_test.html#cb296-4" tabindex="-1"></a>  , <span class="at">quant_metric =</span> <span class="st">&quot;rmse&quot;</span></span>
<span id="cb296-5"><a href="chm_sens_test.html#cb296-5" tabindex="-1"></a>  , <span class="fu">paste0</span>(</span>
<span id="cb296-6"><a href="chm_sens_test.html#cb296-6" tabindex="-1"></a>    <span class="st">&quot;Data Fusion&quot;</span></span>
<span id="cb296-7"><a href="chm_sens_test.html#cb296-7" tabindex="-1"></a>    , <span class="st">&quot;</span><span class="sc">\n</span><span class="st">distribution of pile form quantification metrics for the top parameter settings tested&quot;</span></span>
<span id="cb296-8"><a href="chm_sens_test.html#cb296-8" tabindex="-1"></a>    , <span class="st">&quot; (n=&quot;</span></span>
<span id="cb296-9"><a href="chm_sens_test.html#cb296-9" tabindex="-1"></a>    , scales<span class="sc">::</span><span class="fu">comma</span>(n_th_top_chm,<span class="at">accuracy=</span><span class="dv">1</span>)</span>
<span id="cb296-10"><a href="chm_sens_test.html#cb296-10" tabindex="-1"></a>    , <span class="st">&quot;) by CHM resolution&quot;</span></span>
<span id="cb296-11"><a href="chm_sens_test.html#cb296-11" tabindex="-1"></a>    , <span class="st">&quot;</span><span class="sc">\n</span><span class="st">based on both detection and quantification accuracy&quot;</span></span>
<span id="cb296-12"><a href="chm_sens_test.html#cb296-12" tabindex="-1"></a>  )</span>
<span id="cb296-13"><a href="chm_sens_test.html#cb296-13" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-272-1.png" width="1008" /></p>
</div>
</div>
</div>
</div>
<div id="save-the-data" class="section level2 hasAnchor" number="8.7">
<h2><span class="header-section-number">8.7</span> save the data<a href="chm_sens_test.html#save-the-data" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>let’s save the data for potential future use</p>
<div class="sourceCode" id="cb297"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb297-1"><a href="chm_sens_test.html#cb297-1" tabindex="-1"></a>param_combos_ranked <span class="sc">%&gt;%</span> readr<span class="sc">::</span><span class="fu">write_csv</span>(<span class="fu">file.path</span>(<span class="st">&quot;../data&quot;</span>, <span class="st">&quot;param_combos_ranked.csv&quot;</span>), <span class="at">append =</span> F, <span class="at">progress =</span> F)</span>
<span id="cb297-2"><a href="chm_sens_test.html#cb297-2" tabindex="-1"></a>param_combos_spectral_ranked <span class="sc">%&gt;%</span> readr<span class="sc">::</span><span class="fu">write_csv</span>(<span class="fu">file.path</span>(<span class="st">&quot;../data&quot;</span>, <span class="st">&quot;param_combos_spectral_ranked.csv&quot;</span>), <span class="at">append =</span> F, <span class="at">progress =</span> F)</span></code></pre></div>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="wshed_params_test.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="stats_method.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
  "sharing": {
    "github": false,
    "facebook": true,
    "twitter": true,
    "linkedin": false,
    "weibo": false,
    "instapaper": false,
    "vk": false,
    "whatsapp": false,
    "all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
  },
  "fontsettings": {
    "theme": "white",
    "family": "sans",
    "size": 2
  },
  "edit": {
    "link": null,
    "text": null
  },
  "history": {
    "link": null,
    "text": null
  },
  "view": {
    "link": null,
    "text": null
  },
  "download": null,
  "search": {
    "engine": "fuse",
    "options": null
  },
  "toc": {
    "collapse": "subsection"
  }
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
