<!DOCTYPE html>
<html lang="en-US" xml:lang="en-US">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Section 9 Statistical Testing of Method Settings | Aerial Imagery and Point Cloud Data for Slash Pile Quantification</title>
  <meta name="description" content="Using the bookdown package to write a book of data exploration. The output format for this example is bookdown::gitbook." />
  <meta name="generator" content="bookdown 0.34 and GitBook 2.6.7" />

  <meta property="og:title" content="Section 9 Statistical Testing of Method Settings | Aerial Imagery and Point Cloud Data for Slash Pile Quantification" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="Using the bookdown package to write a book of data exploration. The output format for this example is bookdown::gitbook." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Section 9 Statistical Testing of Method Settings | Aerial Imagery and Point Cloud Data for Slash Pile Quantification" />
  
  <meta name="twitter:description" content="Using the bookdown package to write a book of data exploration. The output format for this example is bookdown::gitbook." />
  

<meta name="author" content="George Woolsey" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="chm_sens_test.html"/>
<link rel="next" href="method-validation-pinyon-juniper.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<link href="libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet" />
<script src="libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/proj4-2.6.2/proj4.min.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.2.2/leaflet.js"></script>
<script src="libs/leaflet-providers-2.0.0/leaflet-providers_2.0.0.js"></script>
<script src="libs/leaflet-providers-plugin-2.2.2/leaflet-providers-plugin.js"></script>
<script src="libs/clipboard-0.0.1/setClipboardText.js"></script>
<link href="libs/mapviewCSS-0.0.1/mapview-popup.css" rel="stylesheet" />
<link href="libs/mapviewCSS-0.0.1/mapview.css" rel="stylesheet" />
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<link href="libs/bsTable-3.3.7/bootstrapTable.min.css" rel="stylesheet" />
<script src="libs/bsTable-3.3.7/bootstrapTable.js"></script>
<script src="libs/. - 1_d2f159-1/data_stars_1b1597e.txt"></script>
<script src="libs/joda-0.0.1/joda.js"></script>
<script src="libs/joda-0.0.1/addImageQuery-bindings.js"></script>
<script src="libs/HomeButton-0.0.1/home-button.js"></script>
<script src="libs/HomeButton-0.0.1/easy-button-src.min.js"></script>
<link href="libs/study sites-CSS-0.0.1/study sites_home-button.css" rel="stylesheet" />
<script type="text/javascript">

// toggle visibility of R source blocks in R Markdown output
function toggle_R() {
  var x = document.getElementsByClassName('r');
  if (x.length == 0) return;
  function toggle_vis(o) {
    var d = o.style.display;
    o.style.display = (d == 'block' || d == '') ? 'none':'block';
  }

  for (i = 0; i < x.length; i++) {
    var y = x[i];
    if (y.tagName.toLowerCase() === 'pre') toggle_vis(y);
  }

    var elem = document.getElementById("myButton1");
    if (elem.value === "Hide Code") elem.value = "Show Code";
    else elem.value = "Hide Code";
}

document.write('<input onclick="toggle_R();" type="button" value="Hide Code" id="myButton1" style="position: absolute; top: 10%; right: 2%; z-index: 200"></input>')

</script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#objective"><i class="fa fa-check"></i><b>1.1</b> Objective</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#data_desc"><i class="fa fa-check"></i><b>1.2</b> Data</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#analysis-plan"><i class="fa fa-check"></i><b>1.3</b> Analysis Plan</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="training-data.html"><a href="training-data.html"><i class="fa fa-check"></i><b>2</b> Training Data</a>
<ul>
<li class="chapter" data-level="2.1" data-path="training-data.html"><a href="training-data.html#site-introduction"><i class="fa fa-check"></i><b>2.1</b> Site Introduction</a></li>
<li class="chapter" data-level="2.2" data-path="training-data.html"><a href="training-data.html#slash-pile-vector-data"><i class="fa fa-check"></i><b>2.2</b> Slash Pile Vector Data</a></li>
<li class="chapter" data-level="2.3" data-path="training-data.html"><a href="training-data.html#rgb-orthomosaic"><i class="fa fa-check"></i><b>2.3</b> RGB orthomosaic</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="training-data.html"><a href="training-data.html#example-ratio-based-index"><i class="fa fa-check"></i><b>2.3.1</b> Example ratio-based index</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="training-data.html"><a href="training-data.html#study-area-imagery"><i class="fa fa-check"></i><b>2.4</b> Study area imagery</a></li>
<li class="chapter" data-level="2.5" data-path="training-data.html"><a href="training-data.html#point-cloud-data"><i class="fa fa-check"></i><b>2.5</b> Point Cloud Data</a></li>
<li class="chapter" data-level="2.6" data-path="training-data.html"><a href="training-data.html#check-out-one-pile"><i class="fa fa-check"></i><b>2.6</b> Check out one pile</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="method-evaluation.html"><a href="method-evaluation.html"><i class="fa fa-check"></i><b>3</b> Method Evaluation</a>
<ul>
<li class="chapter" data-level="3.1" data-path="method-evaluation.html"><a href="method-evaluation.html#iou_match"><i class="fa fa-check"></i><b>3.1</b> Instance Matching</a></li>
<li class="chapter" data-level="3.2" data-path="method-evaluation.html"><a href="method-evaluation.html#detect_metrics_form"><i class="fa fa-check"></i><b>3.2</b> Detection Accuracy Metrics</a></li>
<li class="chapter" data-level="3.3" data-path="method-evaluation.html"><a href="method-evaluation.html#quant_metrics_form"><i class="fa fa-check"></i><b>3.3</b> Quantification Accuracy Metrics</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="ptcld_process.html"><a href="ptcld_process.html"><i class="fa fa-check"></i><b>4</b> Point Cloud Processing and Pile Segmentation</a>
<ul>
<li class="chapter" data-level="4.1" data-path="ptcld_process.html"><a href="ptcld_process.html#process-raw-point-cloud"><i class="fa fa-check"></i><b>4.1</b> Process Raw Point Cloud</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="ptcld_process.html"><a href="ptcld_process.html#dtm-and-chm-piles"><i class="fa fa-check"></i><b>4.1.1</b> DTM and CHM + piles</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="raster_watershed.html"><a href="raster_watershed.html"><i class="fa fa-check"></i><b>5</b> Structural Detection from CHM</a>
<ul>
<li class="chapter" data-level="5.1" data-path="raster_watershed.html"><a href="raster_watershed.html#method-demonstration"><i class="fa fa-check"></i><b>5.1</b> Method Demonstration</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="raster_watershed.html"><a href="raster_watershed.html#geometric-filtering-irregularity-filtering"><i class="fa fa-check"></i><b>5.1.1</b> Geometric filtering: Irregularity Filtering</a></li>
<li class="chapter" data-level="5.1.2" data-path="raster_watershed.html"><a href="raster_watershed.html#area-filtering"><i class="fa fa-check"></i><b>5.1.2</b> Area Filtering</a></li>
<li class="chapter" data-level="5.1.3" data-path="raster_watershed.html"><a href="raster_watershed.html#geometric-filtering-circularity-filtering"><i class="fa fa-check"></i><b>5.1.3</b> Geometric filtering: Circularity Filtering</a></li>
<li class="chapter" data-level="5.1.4" data-path="raster_watershed.html"><a href="raster_watershed.html#area-and-volume-from-chm"><i class="fa fa-check"></i><b>5.1.4</b> Area and Volume from CHM</a></li>
<li class="chapter" data-level="5.1.5" data-path="raster_watershed.html"><a href="raster_watershed.html#shape-refinement"><i class="fa fa-check"></i><b>5.1.5</b> Shape Refinement</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="raster_watershed.html"><a href="raster_watershed.html#instance-matching"><i class="fa fa-check"></i><b>5.2</b> Instance Matching</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="raster_watershed.html"><a href="raster_watershed.html#example-area"><i class="fa fa-check"></i><b>5.2.1</b> Example Area</a></li>
<li class="chapter" data-level="5.2.2" data-path="raster_watershed.html"><a href="raster_watershed.html#full-study-area"><i class="fa fa-check"></i><b>5.2.2</b> Full Study Area</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="raster_watershed.html"><a href="raster_watershed.html#slash_pile_detect_watershed"><i class="fa fa-check"></i><b>5.3</b> Watershed Pile Detection Function</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="data_fusion.html"><a href="data_fusion.html"><i class="fa fa-check"></i><b>6</b> Data Fusion</a>
<ul>
<li class="chapter" data-level="6.1" data-path="data_fusion.html"><a href="data_fusion.html#rgb-indices"><i class="fa fa-check"></i><b>6.1</b> RGB Indices</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="data_fusion.html"><a href="data_fusion.html#spectral-index-functions"><i class="fa fa-check"></i><b>6.1.1</b> Spectral Index Functions</a></li>
<li class="chapter" data-level="6.1.2" data-path="data_fusion.html"><a href="data_fusion.html#spectral-index-of-polygons"><i class="fa fa-check"></i><b>6.1.2</b> Spectral Index of Polygons</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="data_fusion.html"><a href="data_fusion.html#ground-truth-pile-spectral-summary"><i class="fa fa-check"></i><b>6.2</b> Ground Truth Pile Spectral Summary</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="data_fusion.html"><a href="data_fusion.html#voting-system"><i class="fa fa-check"></i><b>6.2.1</b> Voting System</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="data_fusion.html"><a href="data_fusion.html#polygon_spectral_filtering"><i class="fa fa-check"></i><b>6.3</b> Candidate Polygon Spectral Filtering Function</a></li>
<li class="chapter" data-level="6.4" data-path="data_fusion.html"><a href="data_fusion.html#data-fusion-example"><i class="fa fa-check"></i><b>6.4</b> Data Fusion Example</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="data_fusion.html"><a href="data_fusion.html#instance-matching-1"><i class="fa fa-check"></i><b>6.4.1</b> Instance Matching</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="wshed_params_test.html"><a href="wshed_params_test.html"><i class="fa fa-check"></i><b>7</b> Sensitivity Testing Method</a>
<ul>
<li class="chapter" data-level="7.1" data-path="wshed_params_test.html"><a href="wshed_params_test.html#all_the_combos"><i class="fa fa-check"></i><b>7.1</b> Workflow over parameter combinations</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="wshed_params_test.html"><a href="wshed_params_test.html#test-workflow"><i class="fa fa-check"></i><b>7.1.1</b> Test Workflow</a></li>
<li class="chapter" data-level="7.1.2" data-path="wshed_params_test.html"><a href="wshed_params_test.html#test-instance-matching"><i class="fa fa-check"></i><b>7.1.2</b> Test Instance Matching</a></li>
<li class="chapter" data-level="7.1.3" data-path="wshed_params_test.html"><a href="wshed_params_test.html#test-accuracy"><i class="fa fa-check"></i><b>7.1.3</b> Test Accuracy</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="chm_sens_test.html"><a href="chm_sens_test.html"><i class="fa fa-check"></i><b>8</b> Sensitivity Testing Results</a>
<ul>
<li class="chapter" data-level="8.1" data-path="chm_sens_test.html"><a href="chm_sens_test.html#process-raw-point-cloud-1"><i class="fa fa-check"></i><b>8.1</b> Process Raw Point Cloud</a></li>
<li class="chapter" data-level="8.2" data-path="chm_sens_test.html"><a href="chm_sens_test.html#structural-only-parameter-testing"><i class="fa fa-check"></i><b>8.2</b> Structural Only: Parameter Testing</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="chm_sens_test.html"><a href="chm_sens_test.html#validation-over-parameter-combinations"><i class="fa fa-check"></i><b>8.2.1</b> Validation over parameter combinations</a></li>
<li class="chapter" data-level="8.2.2" data-path="chm_sens_test.html"><a href="chm_sens_test.html#aggregate-validation-metrics-to-parameter-combination"><i class="fa fa-check"></i><b>8.2.2</b> Aggregate Validation Metrics to Parameter Combination</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="chm_sens_test.html"><a href="chm_sens_test.html#data-fusion-parameter-testing"><i class="fa fa-check"></i><b>8.3</b> Data Fusion: Parameter Testing</a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="chm_sens_test.html"><a href="chm_sens_test.html#aggregate-validation-metrics-to-parameter-combination-1"><i class="fa fa-check"></i><b>8.3.1</b> Aggregate Validation Metrics to Parameter Combination</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="chm_sens_test.html"><a href="chm_sens_test.html#read-data-for-analysis"><i class="fa fa-check"></i><b>8.4</b> Read Data for Analysis</a>
<ul>
<li class="chapter" data-level="8.4.1" data-path="chm_sens_test.html"><a href="chm_sens_test.html#structural-only"><i class="fa fa-check"></i><b>8.4.1</b> Structural Only</a></li>
<li class="chapter" data-level="8.4.2" data-path="chm_sens_test.html"><a href="chm_sens_test.html#data-fusion"><i class="fa fa-check"></i><b>8.4.2</b> Data Fusion</a></li>
</ul></li>
<li class="chapter" data-level="8.5" data-path="chm_sens_test.html"><a href="chm_sens_test.html#allthetests"><i class="fa fa-check"></i><b>8.5</b> Structural Only: Sensitivity Testing</a>
<ul>
<li class="chapter" data-level="8.5.1" data-path="chm_sens_test.html"><a href="chm_sens_test.html#detect_trends"><i class="fa fa-check"></i><b>8.5.1</b> Main Effects: pile detection</a></li>
<li class="chapter" data-level="8.5.2" data-path="chm_sens_test.html"><a href="chm_sens_test.html#quant_trends"><i class="fa fa-check"></i><b>8.5.2</b> Main Effects: form quantification</a></li>
<li class="chapter" data-level="8.5.3" data-path="chm_sens_test.html"><a href="chm_sens_test.html#best-settings"><i class="fa fa-check"></i><b>8.5.3</b> Best settings</a></li>
</ul></li>
<li class="chapter" data-level="8.6" data-path="chm_sens_test.html"><a href="chm_sens_test.html#data-fusion-sensitivity-testing"><i class="fa fa-check"></i><b>8.6</b> Data Fusion: Sensitivity Testing</a>
<ul>
<li class="chapter" data-level="8.6.1" data-path="chm_sens_test.html"><a href="chm_sens_test.html#main-effects-pile-detection"><i class="fa fa-check"></i><b>8.6.1</b> Main Effects: pile detection</a></li>
<li class="chapter" data-level="8.6.2" data-path="chm_sens_test.html"><a href="chm_sens_test.html#main-effects-form-quantification"><i class="fa fa-check"></i><b>8.6.2</b> Main Effects: form quantification</a></li>
<li class="chapter" data-level="8.6.3" data-path="chm_sens_test.html"><a href="chm_sens_test.html#balanced_acc_assess"><i class="fa fa-check"></i><b>8.6.3</b> Top settings</a></li>
</ul></li>
<li class="chapter" data-level="8.7" data-path="chm_sens_test.html"><a href="chm_sens_test.html#save-the-data"><i class="fa fa-check"></i><b>8.7</b> save the data</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="stats_method.html"><a href="stats_method.html"><i class="fa fa-check"></i><b>9</b> Statistical Testing of Method Settings</a>
<ul>
<li class="chapter" data-level="9.1" data-path="stats_method.html"><a href="stats_method.html#bayesian-glm---f-score"><i class="fa fa-check"></i><b>9.1</b> Bayesian GLM - F-score</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="stats_method.html"><a href="stats_method.html#model-selection"><i class="fa fa-check"></i><b>9.1.1</b> Model selection</a></li>
<li class="chapter" data-level="9.1.2" data-path="stats_method.html"><a href="stats_method.html#modeling"><i class="fa fa-check"></i><b>9.1.2</b> Modeling</a></li>
<li class="chapter" data-level="9.1.3" data-path="stats_method.html"><a href="stats_method.html#posterior-predictive-checks"><i class="fa fa-check"></i><b>9.1.3</b> Posterior Predictive Checks</a></li>
<li class="chapter" data-level="9.1.4" data-path="stats_method.html"><a href="stats_method.html#conditional-effects"><i class="fa fa-check"></i><b>9.1.4</b> Conditional Effects</a></li>
<li class="chapter" data-level="9.1.5" data-path="stats_method.html"><a href="stats_method.html#f_score_epred"><i class="fa fa-check"></i><b>9.1.5</b> Posterior Predictive Expectation</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="stats_method.html"><a href="stats_method.html#mod_diam_mape"><i class="fa fa-check"></i><b>9.2</b> Bayesian GLM - Diameter MAPE</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="stats_method.html"><a href="stats_method.html#model-selection-1"><i class="fa fa-check"></i><b>9.2.1</b> Model selection</a></li>
<li class="chapter" data-level="9.2.2" data-path="stats_method.html"><a href="stats_method.html#mod_diam_mape2"><i class="fa fa-check"></i><b>9.2.2</b> Modeling</a></li>
<li class="chapter" data-level="9.2.3" data-path="stats_method.html"><a href="stats_method.html#posterior-predictive-checks-1"><i class="fa fa-check"></i><b>9.2.3</b> Posterior Predictive Checks</a></li>
<li class="chapter" data-level="9.2.4" data-path="stats_method.html"><a href="stats_method.html#conditional-effects-1"><i class="fa fa-check"></i><b>9.2.4</b> Conditional Effects</a></li>
<li class="chapter" data-level="9.2.5" data-path="stats_method.html"><a href="stats_method.html#posterior-predictive-expectation"><i class="fa fa-check"></i><b>9.2.5</b> Posterior Predictive Expectation</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="stats_method.html"><a href="stats_method.html#bayesian-glm---height-mape"><i class="fa fa-check"></i><b>9.3</b> Bayesian GLM - Height MAPE</a>
<ul>
<li class="chapter" data-level="9.3.1" data-path="stats_method.html"><a href="stats_method.html#model-selection-2"><i class="fa fa-check"></i><b>9.3.1</b> Model selection</a></li>
<li class="chapter" data-level="9.3.2" data-path="stats_method.html"><a href="stats_method.html#modeling-1"><i class="fa fa-check"></i><b>9.3.2</b> Modeling</a></li>
<li class="chapter" data-level="9.3.3" data-path="stats_method.html"><a href="stats_method.html#posterior-predictive-checks-2"><i class="fa fa-check"></i><b>9.3.3</b> Posterior Predictive Checks</a></li>
<li class="chapter" data-level="9.3.4" data-path="stats_method.html"><a href="stats_method.html#conditional-effects-2"><i class="fa fa-check"></i><b>9.3.4</b> Conditional Effects</a></li>
<li class="chapter" data-level="9.3.5" data-path="stats_method.html"><a href="stats_method.html#posterior-predictive-expectation-1"><i class="fa fa-check"></i><b>9.3.5</b> Posterior Predictive Expectation</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="stats_method.html"><a href="stats_method.html#hey_balanced_acc"><i class="fa fa-check"></i><b>9.4</b> Balanced Accuracy Bayesian Optimization</a>
<ul>
<li class="chapter" data-level="9.4.1" data-path="stats_method.html"><a href="stats_method.html#balanced-accuracy-selection"><i class="fa fa-check"></i><b>9.4.1</b> Balanced Accuracy Selection</a></li>
<li class="chapter" data-level="9.4.2" data-path="stats_method.html"><a href="stats_method.html#overall-across-chm-resolution-2"><i class="fa fa-check"></i><b>9.4.2</b> Overall (across CHM resolution)</a></li>
<li class="chapter" data-level="9.4.3" data-path="stats_method.html"><a href="stats_method.html#by-chm-resolution-2"><i class="fa fa-check"></i><b>9.4.3</b> by CHM resolution</a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="stats_method.html"><a href="stats_method.html#training_detect_final"><i class="fa fa-check"></i><b>9.5</b> Balanced Accuracy Validation</a>
<ul>
<li class="chapter" data-level="9.5.1" data-path="stats_method.html"><a href="stats_method.html#detection"><i class="fa fa-check"></i><b>9.5.1</b> Detection</a></li>
<li class="chapter" data-level="9.5.2" data-path="stats_method.html"><a href="stats_method.html#instance-match-accuracy-assessment"><i class="fa fa-check"></i><b>9.5.2</b> Instance Match &amp; Accuracy Assessment</a></li>
<li class="chapter" data-level="9.5.3" data-path="stats_method.html"><a href="stats_method.html#training_detect_final_volcomp"><i class="fa fa-check"></i><b>9.5.3</b> Volume Comparison</a></li>
<li class="chapter" data-level="9.5.4" data-path="stats_method.html"><a href="stats_method.html#stand-level-aggregation"><i class="fa fa-check"></i><b>9.5.4</b> Stand-level Aggregation</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="method-validation-pinyon-juniper.html"><a href="method-validation-pinyon-juniper.html"><i class="fa fa-check"></i><b>10</b> Method Validation: Pinyon-Juniper</a>
<ul>
<li class="chapter" data-level="10.1" data-path="method-validation-pinyon-juniper.html"><a href="method-validation-pinyon-juniper.html#site-introduction-1"><i class="fa fa-check"></i><b>10.1</b> Site Introduction</a></li>
<li class="chapter" data-level="10.2" data-path="method-validation-pinyon-juniper.html"><a href="method-validation-pinyon-juniper.html#data-processing"><i class="fa fa-check"></i><b>10.2</b> Data Processing</a>
<ul>
<li class="chapter" data-level="10.2.1" data-path="method-validation-pinyon-juniper.html"><a href="method-validation-pinyon-juniper.html#vector-data"><i class="fa fa-check"></i><b>10.2.1</b> Vector Data</a></li>
<li class="chapter" data-level="10.2.2" data-path="method-validation-pinyon-juniper.html"><a href="method-validation-pinyon-juniper.html#rgb-data"><i class="fa fa-check"></i><b>10.2.2</b> RGB Data</a></li>
<li class="chapter" data-level="10.2.3" data-path="method-validation-pinyon-juniper.html"><a href="method-validation-pinyon-juniper.html#process-raw-point-cloud-2"><i class="fa fa-check"></i><b>10.2.3</b> Process Raw Point Cloud</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="method-validation-pinyon-juniper.html"><a href="method-validation-pinyon-juniper.html#pj_detect_fusion"><i class="fa fa-check"></i><b>10.3</b> Pile Detection: Data Fusion</a>
<ul>
<li class="chapter" data-level="10.3.1" data-path="method-validation-pinyon-juniper.html"><a href="method-validation-pinyon-juniper.html#structural-candidate-segments"><i class="fa fa-check"></i><b>10.3.1</b> Structural Candidate Segments</a></li>
<li class="chapter" data-level="10.3.2" data-path="method-validation-pinyon-juniper.html"><a href="method-validation-pinyon-juniper.html#accuracy-of-these-structural-settings"><i class="fa fa-check"></i><b>10.3.2</b> Accuracy of these structural settings</a></li>
<li class="chapter" data-level="10.3.3" data-path="method-validation-pinyon-juniper.html"><a href="method-validation-pinyon-juniper.html#spect_filtering_final_pj"><i class="fa fa-check"></i><b>10.3.3</b> Spectral Filtering of Candidate Segments</a></li>
<li class="chapter" data-level="10.3.4" data-path="method-validation-pinyon-juniper.html"><a href="method-validation-pinyon-juniper.html#detection-and-quantification-accuracy"><i class="fa fa-check"></i><b>10.3.4</b> Detection and Quantification Accuracy</a></li>
<li class="chapter" data-level="10.3.5" data-path="method-validation-pinyon-juniper.html"><a href="method-validation-pinyon-juniper.html#validation_detect_final_volcomp"><i class="fa fa-check"></i><b>10.3.5</b> Volume Comparison</a></li>
<li class="chapter" data-level="10.3.6" data-path="method-validation-pinyon-juniper.html"><a href="method-validation-pinyon-juniper.html#stand-level-aggregation-1"><i class="fa fa-check"></i><b>10.3.6</b> Stand-level Aggregation</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="method-validation-pinyon-juniper.html"><a href="method-validation-pinyon-juniper.html#pj_detect_struct"><i class="fa fa-check"></i><b>10.4</b> Pile Detection: Structural Only</a>
<ul>
<li class="chapter" data-level="10.4.1" data-path="method-validation-pinyon-juniper.html"><a href="method-validation-pinyon-juniper.html#structural-detection"><i class="fa fa-check"></i><b>10.4.1</b> Structural Detection</a></li>
<li class="chapter" data-level="10.4.2" data-path="method-validation-pinyon-juniper.html"><a href="method-validation-pinyon-juniper.html#detection-and-quantification-accuracy-1"><i class="fa fa-check"></i><b>10.4.2</b> Detection and Quantification Accuracy</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11" data-path="method-validation-bhef-machine-piles.html"><a href="method-validation-bhef-machine-piles.html"><i class="fa fa-check"></i><b>11</b> Method Validation: BHEF Machine Piles</a>
<ul>
<li class="chapter" data-level="11.1" data-path="method-validation-bhef-machine-piles.html"><a href="method-validation-bhef-machine-piles.html#site-introduction-2"><i class="fa fa-check"></i><b>11.1</b> Site Introduction</a></li>
<li class="chapter" data-level="11.2" data-path="method-validation-bhef-machine-piles.html"><a href="method-validation-bhef-machine-piles.html#data-processing-1"><i class="fa fa-check"></i><b>11.2</b> Data Processing</a>
<ul>
<li class="chapter" data-level="11.2.1" data-path="method-validation-bhef-machine-piles.html"><a href="method-validation-bhef-machine-piles.html#rgb-data-1"><i class="fa fa-check"></i><b>11.2.1</b> RGB Data</a></li>
<li class="chapter" data-level="11.2.2" data-path="method-validation-bhef-machine-piles.html"><a href="method-validation-bhef-machine-piles.html#process-raw-point-cloud-3"><i class="fa fa-check"></i><b>11.2.2</b> Process Raw Point Cloud</a></li>
<li class="chapter" data-level="11.2.3" data-path="method-validation-bhef-machine-piles.html"><a href="method-validation-bhef-machine-piles.html#vector-data-1"><i class="fa fa-check"></i><b>11.2.3</b> Vector Data</a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="method-validation-bhef-machine-piles.html"><a href="method-validation-bhef-machine-piles.html#bhef_detect_fusion"><i class="fa fa-check"></i><b>11.3</b> Pile Detection: Data Fusion</a>
<ul>
<li class="chapter" data-level="11.3.1" data-path="method-validation-bhef-machine-piles.html"><a href="method-validation-bhef-machine-piles.html#structural-candidate-segments-1"><i class="fa fa-check"></i><b>11.3.1</b> Structural Candidate Segments</a></li>
<li class="chapter" data-level="11.3.2" data-path="method-validation-bhef-machine-piles.html"><a href="method-validation-bhef-machine-piles.html#accuracy-of-these-structural-settings-1"><i class="fa fa-check"></i><b>11.3.2</b> Accuracy of these structural settings</a></li>
<li class="chapter" data-level="11.3.3" data-path="method-validation-bhef-machine-piles.html"><a href="method-validation-bhef-machine-piles.html#spect_filtering_final_bhef"><i class="fa fa-check"></i><b>11.3.3</b> Spectral Filtering of Candidate Segments</a></li>
<li class="chapter" data-level="11.3.4" data-path="method-validation-bhef-machine-piles.html"><a href="method-validation-bhef-machine-piles.html#detection-and-quantification-accuracy-2"><i class="fa fa-check"></i><b>11.3.4</b> Detection and Quantification Accuracy</a></li>
<li class="chapter" data-level="11.3.5" data-path="method-validation-bhef-machine-piles.html"><a href="method-validation-bhef-machine-piles.html#stand-level-aggregation-2"><i class="fa fa-check"></i><b>11.3.5</b> Stand-level Aggregation</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="12" data-path="method-validation-arnf-machine-piles.html"><a href="method-validation-arnf-machine-piles.html"><i class="fa fa-check"></i><b>12</b> Method Validation: ARNF Machine Piles</a>
<ul>
<li class="chapter" data-level="12.1" data-path="method-validation-arnf-machine-piles.html"><a href="method-validation-arnf-machine-piles.html#site-introduction-3"><i class="fa fa-check"></i><b>12.1</b> Site Introduction</a></li>
<li class="chapter" data-level="12.2" data-path="method-validation-arnf-machine-piles.html"><a href="method-validation-arnf-machine-piles.html#data-processing-2"><i class="fa fa-check"></i><b>12.2</b> Data Processing</a>
<ul>
<li class="chapter" data-level="12.2.1" data-path="method-validation-arnf-machine-piles.html"><a href="method-validation-arnf-machine-piles.html#process-raw-point-cloud-4"><i class="fa fa-check"></i><b>12.2.1</b> Process Raw Point Cloud</a></li>
<li class="chapter" data-level="12.2.2" data-path="method-validation-arnf-machine-piles.html"><a href="method-validation-arnf-machine-piles.html#vector-data-2"><i class="fa fa-check"></i><b>12.2.2</b> Vector Data</a></li>
<li class="chapter" data-level="12.2.3" data-path="method-validation-arnf-machine-piles.html"><a href="method-validation-arnf-machine-piles.html#rgb-data-2"><i class="fa fa-check"></i><b>12.2.3</b> RGB Data</a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="method-validation-arnf-machine-piles.html"><a href="method-validation-arnf-machine-piles.html#arnf_detect_fusion"><i class="fa fa-check"></i><b>12.3</b> Pile Detection: Data Fusion</a>
<ul>
<li class="chapter" data-level="12.3.1" data-path="method-validation-arnf-machine-piles.html"><a href="method-validation-arnf-machine-piles.html#structural-candidate-segments-2"><i class="fa fa-check"></i><b>12.3.1</b> Structural Candidate Segments</a></li>
<li class="chapter" data-level="12.3.2" data-path="method-validation-arnf-machine-piles.html"><a href="method-validation-arnf-machine-piles.html#accuracy-of-these-structural-settings-2"><i class="fa fa-check"></i><b>12.3.2</b> Accuracy of these structural settings</a></li>
<li class="chapter" data-level="12.3.3" data-path="method-validation-bhef-machine-piles.html"><a href="method-validation-bhef-machine-piles.html#spect_filtering_final_bhef"><i class="fa fa-check"></i><b>12.3.3</b> Spectral Filtering of Candidate Segments</a></li>
<li class="chapter" data-level="12.3.4" data-path="method-validation-arnf-machine-piles.html"><a href="method-validation-arnf-machine-piles.html#detection-and-quantification-accuracy-3"><i class="fa fa-check"></i><b>12.3.4</b> Detection and Quantification Accuracy</a></li>
<li class="chapter" data-level="12.3.5" data-path="method-validation-arnf-machine-piles.html"><a href="method-validation-arnf-machine-piles.html#stand-level-aggregation-3"><i class="fa fa-check"></i><b>12.3.5</b> Stand-level Aggregation</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="13" data-path="validation_summary.html"><a href="validation_summary.html"><i class="fa fa-check"></i><b>13</b> Method Validation: Summary</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Aerial Imagery and Point Cloud Data for Slash Pile Quantification</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="stats_method" class="section level1 hasAnchor" number="9">
<h1><span class="header-section-number">Section 9</span> Statistical Testing of Method Settings<a href="stats_method.html#stats_method" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>In this prior <a href="chm_sens_test.html#allthetests">section</a> we performed sensitivity testing of our slash pile detection method using multiple CHM raster resolutions and ended up testing tens of thousands of possible parameterizations and input data combinations. using the tested parameter and data input combinations, we’re going build statistical models to quantify the influence of these parameters and input data on pile detection and quantification accuracy. we’ll utilize a Bayesian modelling framework which will allow us to probabilistically quantify parameter influence while accounting for uncertainty.</p>
<p>here are some of the hypotheses about the slash pile detection methodology that we’ll be exploring:</p>
<ol style="list-style-type: decimal">
<li>does CHM resolution influences detection and quantification accuracy?</li>
<li>does the effect of CHM resolution change based on the inclusion of spectral data versus using only structural data?</li>
<li>does the use of spectral data have a meaningful impact on detection and quantification accuracy</li>
</ol>
<p>our analysis data set will be the <code>param_combos_spectral_ranked</code> data which includes accuracy measurements at the parameter combination level using both structural data only as well as structural and spectral data in our data fusion approach. in this data, a row is unique by the full set of parameters and input data tested: <code>max_ht_m</code>, <code>max_area_m2</code>, <code>convexity_pct</code>, <code>circle_fit_iou_pct</code>, <code>chm_res_m</code>, <code>spectral_weight</code>. there are four structural parameters: <code>max_ht_m</code>, <code>max_area_m2</code>, <code>convexity_pct</code>, <code>circle_fit_iou_pct</code> which are used to determine candidate slash piles from the CHM data alone, and the <code>chm_res_m</code> and <code>spectral_weight</code> parameters represent the input data with <code>spectral_weight</code> classifying if spectral data was not used (i.e. <code>spectral_weight</code> = 0), or if spectral data was used, what the weighting of that spectral data was on a 1-5 scale where the number represents the number of individual spectral index thresholds that must be met for a candidate pile detected from the structural data to be kept. for example, a value of “5” requires that all spectral criteria be met and will result in more candidate piles being filtered out than a value of “3”. See <a href="data_fusion.html#data_fusion">this section</a> for full details on the data fusion approach.</p>
<p>we’ll read in the sensitivity test result data which includes point estimates of detection and form quantification accuracy if it’s not already in memory</p>
<div class="sourceCode" id="cb298"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb298-1"><a href="stats_method.html#cb298-1" tabindex="-1"></a><span class="cf">if</span>( <span class="fu">length</span>(<span class="fu">ls</span>()[<span class="fu">grep</span>(<span class="st">&quot;param_combos_ranked&quot;</span>,<span class="fu">ls</span>())])<span class="sc">!=</span><span class="dv">1</span> ){</span>
<span id="cb298-2"><a href="stats_method.html#cb298-2" tabindex="-1"></a>  param_combos_ranked <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(<span class="fu">file.path</span>(<span class="st">&quot;../data&quot;</span>, <span class="st">&quot;param_combos_ranked.csv&quot;</span>), <span class="at">progress =</span> F, <span class="at">show_col_types =</span> F)</span>
<span id="cb298-3"><a href="stats_method.html#cb298-3" tabindex="-1"></a>}</span>
<span id="cb298-4"><a href="stats_method.html#cb298-4" tabindex="-1"></a><span class="cf">if</span>( <span class="fu">length</span>(<span class="fu">ls</span>()[<span class="fu">grep</span>(<span class="st">&quot;param_combos_spectral_ranked&quot;</span>,<span class="fu">ls</span>())])<span class="sc">!=</span><span class="dv">1</span> ){</span>
<span id="cb298-5"><a href="stats_method.html#cb298-5" tabindex="-1"></a>  param_combos_spectral_ranked <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(<span class="fu">file.path</span>(<span class="st">&quot;../data&quot;</span>, <span class="st">&quot;param_combos_spectral_ranked.csv&quot;</span>), <span class="at">progress =</span> F, <span class="at">show_col_types =</span> F)</span>
<span id="cb298-6"><a href="stats_method.html#cb298-6" tabindex="-1"></a>}</span>
<span id="cb298-7"><a href="stats_method.html#cb298-7" tabindex="-1"></a><span class="co"># convert spectral weight to factor for modelling</span></span>
<span id="cb298-8"><a href="stats_method.html#cb298-8" tabindex="-1"></a>param_combos_spectral_ranked <span class="ot">&lt;-</span> param_combos_spectral_ranked <span class="sc">%&gt;%</span> </span>
<span id="cb298-9"><a href="stats_method.html#cb298-9" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb298-10"><a href="stats_method.html#cb298-10" tabindex="-1"></a>    <span class="at">spectral_weight =</span> <span class="fu">factor</span>(spectral_weight)</span>
<span id="cb298-11"><a href="stats_method.html#cb298-11" tabindex="-1"></a>    <span class="co"># replace 0 F-score with very small positive to run GLM models</span></span>
<span id="cb298-12"><a href="stats_method.html#cb298-12" tabindex="-1"></a>    , <span class="at">f_score =</span> <span class="fu">ifelse</span>(f_score<span class="sc">==</span><span class="dv">0</span>,<span class="fl">1e-4</span>,f_score)</span>
<span id="cb298-13"><a href="stats_method.html#cb298-13" tabindex="-1"></a>  )</span>
<span id="cb298-14"><a href="stats_method.html#cb298-14" tabindex="-1"></a></span>
<span id="cb298-15"><a href="stats_method.html#cb298-15" tabindex="-1"></a><span class="co"># check out this data</span></span>
<span id="cb298-16"><a href="stats_method.html#cb298-16" tabindex="-1"></a>param_combos_spectral_ranked <span class="sc">%&gt;%</span> </span>
<span id="cb298-17"><a href="stats_method.html#cb298-17" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb298-18"><a href="stats_method.html#cb298-18" tabindex="-1"></a>    max_ht_m, max_area_m2, convexity_pct, circle_fit_iou_pct, chm_res_m</span>
<span id="cb298-19"><a href="stats_method.html#cb298-19" tabindex="-1"></a>    , spectral_weight, spectral_weight_fact</span>
<span id="cb298-20"><a href="stats_method.html#cb298-20" tabindex="-1"></a>    , f_score, precision, recall</span>
<span id="cb298-21"><a href="stats_method.html#cb298-21" tabindex="-1"></a>    , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_mape&quot;</span>)</span>
<span id="cb298-22"><a href="stats_method.html#cb298-22" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb298-23"><a href="stats_method.html#cb298-23" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">glimpse</span>()</span></code></pre></div>
<pre><code>## Rows: 35,280
## Columns: 13
## $ max_ht_m                 &lt;dbl&gt; 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 4, 4, …
## $ max_area_m2              &lt;dbl&gt; 40, 50, 50, 50, 50, 50, 60, 60, 60, 60, 60, 5…
## $ convexity_pct            &lt;dbl&gt; 0.80, 0.05, 0.20, 0.35, 0.50, 0.65, 0.05, 0.2…
## $ circle_fit_iou_pct       &lt;dbl&gt; 0.50, 0.65, 0.65, 0.65, 0.65, 0.65, 0.65, 0.6…
## $ chm_res_m                &lt;dbl&gt; 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, …
## $ spectral_weight          &lt;fct&gt; 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, …
## $ spectral_weight_fact     &lt;fct&gt; structural+spectral, structural+spectral, str…
## $ f_score                  &lt;dbl&gt; 0.8740157, 0.8870968, 0.8870968, 0.8870968, 0…
## $ precision                &lt;dbl&gt; 0.8345865, 0.8661417, 0.8661417, 0.8661417, 0…
## $ recall                   &lt;dbl&gt; 0.9173554, 0.9090909, 0.9090909, 0.9090909, 0…
## $ pct_diff_area_m2_mape    &lt;dbl&gt; 0.1063683, 0.1013882, 0.1013882, 0.1013882, 0…
## $ pct_diff_diameter_m_mape &lt;dbl&gt; 0.10231758, 0.09905328, 0.09905328, 0.0990532…
## $ pct_diff_height_m_mape   &lt;dbl&gt; 0.1851636, 0.1822841, 0.1822841, 0.1822841, 0…</code></pre>
<p>a row is unique by the full set of parameters tested: <code>max_ht_m</code>, <code>max_area_m2</code>, <code>convexity_pct</code>, <code>circle_fit_iou_pct</code>, <code>chm_res_m</code>, <code>spectral_weight</code></p>
<div class="sourceCode" id="cb300"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb300-1"><a href="stats_method.html#cb300-1" tabindex="-1"></a><span class="co"># a row is unique by max_ht_m, max_area_m2, convexity_pct, circle_fit_iou_pct, chm_res_m, and spectral_weight</span></span>
<span id="cb300-2"><a href="stats_method.html#cb300-2" tabindex="-1"></a><span class="fu">identical</span>(</span>
<span id="cb300-3"><a href="stats_method.html#cb300-3" tabindex="-1"></a>  param_combos_spectral_ranked <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">distinct</span>(max_ht_m, max_area_m2, convexity_pct, circle_fit_iou_pct, chm_res_m, spectral_weight) <span class="sc">%&gt;%</span> <span class="fu">nrow</span>()</span>
<span id="cb300-4"><a href="stats_method.html#cb300-4" tabindex="-1"></a>  , param_combos_spectral_ranked <span class="sc">%&gt;%</span> <span class="fu">nrow</span>()</span>
<span id="cb300-5"><a href="stats_method.html#cb300-5" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>here are the number of records which returned valid predicted slash pile polygons by CHM resolution and data input setting (i.e. structural only versus data fusion). the number of records for the data fusion approach (“structural+spectral”) should be roughly five times the number of records as the structural only approach because we tested five different settings of the <code>structural_weight</code> parameter from the lowest weighting of the spectral data of “1” (only one spectral index threshold must be met) to the highest weighting of spectral data “5” (all spectral index thresholds must be met)</p>
<div class="sourceCode" id="cb302"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb302-1"><a href="stats_method.html#cb302-1" tabindex="-1"></a>param_combos_spectral_ranked <span class="sc">%&gt;%</span> </span>
<span id="cb302-2"><a href="stats_method.html#cb302-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">count</span>(chm_res_m_desc,spectral_weight_fact) <span class="sc">%&gt;%</span> </span>
<span id="cb302-3"><a href="stats_method.html#cb302-3" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x=</span>n,<span class="at">y=</span>spectral_weight_fact, <span class="at">color =</span> spectral_weight_fact, <span class="at">fill =</span> spectral_weight_fact)) <span class="sc">+</span></span>
<span id="cb302-4"><a href="stats_method.html#cb302-4" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">geom_col</span>(<span class="at">width =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb302-5"><a href="stats_method.html#cb302-5" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">geom_text</span>(</span>
<span id="cb302-6"><a href="stats_method.html#cb302-6" tabindex="-1"></a>      <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">label=</span>scales<span class="sc">::</span><span class="fu">comma</span>(n)) </span>
<span id="cb302-7"><a href="stats_method.html#cb302-7" tabindex="-1"></a>      , <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">size =</span> <span class="dv">3</span></span>
<span id="cb302-8"><a href="stats_method.html#cb302-8" tabindex="-1"></a>      , <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">0.1</span></span>
<span id="cb302-9"><a href="stats_method.html#cb302-9" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb302-10"><a href="stats_method.html#cb302-10" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">facet_grid</span>(<span class="at">rows =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(chm_res_m_desc)) <span class="sc">+</span></span>
<span id="cb302-11"><a href="stats_method.html#cb302-11" tabindex="-1"></a>    harrypotter<span class="sc">::</span><span class="fu">scale_fill_hp_d</span>(<span class="at">option =</span> <span class="st">&quot;slytherin&quot;</span>) <span class="sc">+</span></span>
<span id="cb302-12"><a href="stats_method.html#cb302-12" tabindex="-1"></a>    harrypotter<span class="sc">::</span><span class="fu">scale_color_hp_d</span>(<span class="at">option =</span> <span class="st">&quot;slytherin&quot;</span>) <span class="sc">+</span></span>
<span id="cb302-13"><a href="stats_method.html#cb302-13" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">scale_x_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>comma, <span class="at">expand =</span> ggplot2<span class="sc">::</span><span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="dv">0</span>,.<span class="dv">1</span>))) <span class="sc">+</span></span>
<span id="cb302-14"><a href="stats_method.html#cb302-14" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">y=</span><span class="st">&quot;&quot;</span>) <span class="sc">+</span></span>
<span id="cb302-15"><a href="stats_method.html#cb302-15" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb302-16"><a href="stats_method.html#cb302-16" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb302-17"><a href="stats_method.html#cb302-17" tabindex="-1"></a>      <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb302-18"><a href="stats_method.html#cb302-18" tabindex="-1"></a>      , <span class="at">strip.text.y =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">9</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb302-19"><a href="stats_method.html#cb302-19" tabindex="-1"></a>    )</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-278-1.png" width="1008" /></p>
<div id="bayesian-glm---f-score" class="section level2 hasAnchor" number="9.1">
<h2><span class="header-section-number">9.1</span> Bayesian GLM - F-score<a href="stats_method.html#bayesian-glm---f-score" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>given that our data contains only one observation per parameter combination, we’re going to use a Bayesian Beta generalized linear model (GLM) to ensure a statistically sound approach and interpretable relationships between each parameter and the dependent variable (e.g. F-score). our model will treat the parameters as a mix of continuous and nominal variables, preventing model saturation (where the model has as many parameters to estimate as data points, so the data perfectly explains the model). A Bayesian hierarchical model would not be appropriate for this structure, since it is designed for datasets with nested or grouped observations (e.g. if we had evaluated the method across different plots or study sites).</p>
<p>Our Bayesian Beta regression models the F-score with a Beta distribution because it is a proportion between 0 and 1, which ensures that the predictions and uncertainty estimates are always within the valid range. We’re treating the four structural parameters (e.g. <code>max_ht_m</code> and <code>circle_fit_iou_pct</code>) and the CHM resolution (<code>chm_res_m</code>) as metric (i.e., continuous) variables, as this is statistically sound for our data and allows for a continuous interpretation where the model coefficient will represent the change in F-score for a one-unit change in the parameter value. The <code>spectral_weight</code> parameter, however, will be treated as nominal to capture its discrete effects without assuming a linear relationship.</p>
<div id="model-selection" class="section level3 hasAnchor" number="9.1.1">
<h3><span class="header-section-number">9.1.1</span> Model selection<a href="stats_method.html#model-selection" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>we’re going to use a sub-sample of the data to perform model testing. our objective is to construct the model such that it faithfully represents the data.</p>
<p>we reviewed the main effect parameter trends against F-score <a href="chm_sens_test.html#detect_trends">here</a> and used these to guide our model design. we’ll follow Kurz <a href="https://bookdown.org/content/3686/18.html">2025</a> and compare our models with the LOO information criterion</p>
<blockquote>
<p>Like other information criteria, the LOO values aren’t of interest in and of themselves. However, the values of one model’s LOO relative to that of another is of great interest. We generally prefer models with lower estimates.</p>
</blockquote>
<div class="sourceCode" id="cb303"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb303-1"><a href="stats_method.html#cb303-1" tabindex="-1"></a><span class="co"># subsample data</span></span>
<span id="cb303-2"><a href="stats_method.html#cb303-2" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">222</span>)</span>
<span id="cb303-3"><a href="stats_method.html#cb303-3" tabindex="-1"></a>ms_df_temp <span class="ot">&lt;-</span> param_combos_spectral_ranked <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">slice_sample</span>(<span class="at">prop =</span> <span class="fl">0.11</span>)</span>
<span id="cb303-4"><a href="stats_method.html#cb303-4" tabindex="-1"></a><span class="co"># mcmc setup</span></span>
<span id="cb303-5"><a href="stats_method.html#cb303-5" tabindex="-1"></a>iter_temp <span class="ot">&lt;-</span> <span class="dv">2444</span></span>
<span id="cb303-6"><a href="stats_method.html#cb303-6" tabindex="-1"></a>warmup_temp <span class="ot">&lt;-</span> <span class="dv">1222</span></span>
<span id="cb303-7"><a href="stats_method.html#cb303-7" tabindex="-1"></a>chains_temp <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb303-8"><a href="stats_method.html#cb303-8" tabindex="-1"></a><span class="do">####################################################################</span></span>
<span id="cb303-9"><a href="stats_method.html#cb303-9" tabindex="-1"></a><span class="co"># base model with form selected based on main effect trends</span></span>
<span id="cb303-10"><a href="stats_method.html#cb303-10" tabindex="-1"></a><span class="do">####################################################################</span></span>
<span id="cb303-11"><a href="stats_method.html#cb303-11" tabindex="-1"></a>fscore_mod1_temp <span class="ot">&lt;-</span> brms<span class="sc">::</span><span class="fu">brm</span>(</span>
<span id="cb303-12"><a href="stats_method.html#cb303-12" tabindex="-1"></a>  <span class="at">formula =</span> f_score <span class="sc">~</span> </span>
<span id="cb303-13"><a href="stats_method.html#cb303-13" tabindex="-1"></a>    <span class="dv">0</span> <span class="sc">+</span> <span class="co"># no intercept to allow all values of spectral_weight to be shown instead of set as the baseline </span></span>
<span id="cb303-14"><a href="stats_method.html#cb303-14" tabindex="-1"></a>    max_ht_m <span class="sc">+</span> max_area_m2 <span class="sc">+</span> convexity_pct <span class="sc">+</span> </span>
<span id="cb303-15"><a href="stats_method.html#cb303-15" tabindex="-1"></a>    circle_fit_iou_pct <span class="sc">+</span> <span class="fu">I</span>(circle_fit_iou_pct<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb303-16"><a href="stats_method.html#cb303-16" tabindex="-1"></a>    chm_res_m <span class="sc">+</span> spectral_weight <span class="sc">+</span> chm_res_m<span class="sc">:</span>spectral_weight</span>
<span id="cb303-17"><a href="stats_method.html#cb303-17" tabindex="-1"></a>  , <span class="at">data =</span> ms_df_temp</span>
<span id="cb303-18"><a href="stats_method.html#cb303-18" tabindex="-1"></a>  , <span class="at">family =</span> <span class="fu">Beta</span>(<span class="at">link =</span> <span class="st">&quot;logit&quot;</span>)</span>
<span id="cb303-19"><a href="stats_method.html#cb303-19" tabindex="-1"></a>  <span class="co"># mcmc</span></span>
<span id="cb303-20"><a href="stats_method.html#cb303-20" tabindex="-1"></a>  , <span class="at">iter =</span> iter_temp, <span class="at">warmup =</span> warmup_temp</span>
<span id="cb303-21"><a href="stats_method.html#cb303-21" tabindex="-1"></a>  , <span class="at">chains =</span> chains_temp</span>
<span id="cb303-22"><a href="stats_method.html#cb303-22" tabindex="-1"></a>  <span class="co"># , control = list(adapt_delta = 0.999, max_treedepth = 13)</span></span>
<span id="cb303-23"><a href="stats_method.html#cb303-23" tabindex="-1"></a>  , <span class="at">cores =</span> lasR<span class="sc">::</span><span class="fu">half_cores</span>()</span>
<span id="cb303-24"><a href="stats_method.html#cb303-24" tabindex="-1"></a>  , <span class="at">file =</span> <span class="fu">paste0</span>(<span class="st">&quot;../data/&quot;</span>, <span class="st">&quot;fscore_mod1_temp&quot;</span>)</span>
<span id="cb303-25"><a href="stats_method.html#cb303-25" tabindex="-1"></a>)</span>
<span id="cb303-26"><a href="stats_method.html#cb303-26" tabindex="-1"></a>fscore_mod1_temp <span class="ot">&lt;-</span> brms<span class="sc">::</span><span class="fu">add_criterion</span>(fscore_mod1_temp, <span class="at">criterion =</span> <span class="st">&quot;loo&quot;</span>)</span>
<span id="cb303-27"><a href="stats_method.html#cb303-27" tabindex="-1"></a><span class="do">####################################################################</span></span>
<span id="cb303-28"><a href="stats_method.html#cb303-28" tabindex="-1"></a><span class="co"># allows slope and curvature of circle_fit_iou_pct to vary by chm_res_m and vice-versa</span></span>
<span id="cb303-29"><a href="stats_method.html#cb303-29" tabindex="-1"></a><span class="do">####################################################################</span></span>
<span id="cb303-30"><a href="stats_method.html#cb303-30" tabindex="-1"></a>fscore_mod2_temp <span class="ot">&lt;-</span> brms<span class="sc">::</span><span class="fu">brm</span>(</span>
<span id="cb303-31"><a href="stats_method.html#cb303-31" tabindex="-1"></a>  <span class="at">formula =</span> f_score <span class="sc">~</span> </span>
<span id="cb303-32"><a href="stats_method.html#cb303-32" tabindex="-1"></a>    <span class="dv">0</span> <span class="sc">+</span> <span class="co"># no intercept to allow all values of spectral_weight to be shown instead of set as the baseline </span></span>
<span id="cb303-33"><a href="stats_method.html#cb303-33" tabindex="-1"></a>    max_ht_m <span class="sc">+</span> max_area_m2 <span class="sc">+</span> convexity_pct <span class="sc">+</span> </span>
<span id="cb303-34"><a href="stats_method.html#cb303-34" tabindex="-1"></a>    circle_fit_iou_pct <span class="sc">+</span> <span class="fu">I</span>(circle_fit_iou_pct<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb303-35"><a href="stats_method.html#cb303-35" tabindex="-1"></a>    circle_fit_iou_pct<span class="sc">:</span>chm_res_m <span class="sc">+</span> <span class="co"># changed from base model</span></span>
<span id="cb303-36"><a href="stats_method.html#cb303-36" tabindex="-1"></a>    chm_res_m <span class="sc">+</span> spectral_weight <span class="sc">+</span> chm_res_m<span class="sc">:</span>spectral_weight</span>
<span id="cb303-37"><a href="stats_method.html#cb303-37" tabindex="-1"></a>  , <span class="at">data =</span> ms_df_temp</span>
<span id="cb303-38"><a href="stats_method.html#cb303-38" tabindex="-1"></a>  , <span class="at">family =</span> <span class="fu">Beta</span>(<span class="at">link =</span> <span class="st">&quot;logit&quot;</span>)</span>
<span id="cb303-39"><a href="stats_method.html#cb303-39" tabindex="-1"></a>  <span class="co"># mcmc</span></span>
<span id="cb303-40"><a href="stats_method.html#cb303-40" tabindex="-1"></a>  , <span class="at">iter =</span> iter_temp, <span class="at">warmup =</span> warmup_temp</span>
<span id="cb303-41"><a href="stats_method.html#cb303-41" tabindex="-1"></a>  , <span class="at">chains =</span> chains_temp</span>
<span id="cb303-42"><a href="stats_method.html#cb303-42" tabindex="-1"></a>  <span class="co"># , control = list(adapt_delta = 0.999, max_treedepth = 13)</span></span>
<span id="cb303-43"><a href="stats_method.html#cb303-43" tabindex="-1"></a>  , <span class="at">cores =</span> lasR<span class="sc">::</span><span class="fu">half_cores</span>()</span>
<span id="cb303-44"><a href="stats_method.html#cb303-44" tabindex="-1"></a>  , <span class="at">file =</span> <span class="fu">paste0</span>(<span class="st">&quot;../data/&quot;</span>, <span class="st">&quot;fscore_mod2_temp&quot;</span>)</span>
<span id="cb303-45"><a href="stats_method.html#cb303-45" tabindex="-1"></a>)</span>
<span id="cb303-46"><a href="stats_method.html#cb303-46" tabindex="-1"></a>fscore_mod2_temp <span class="ot">&lt;-</span> brms<span class="sc">::</span><span class="fu">add_criterion</span>(fscore_mod2_temp, <span class="at">criterion =</span> <span class="st">&quot;loo&quot;</span>)</span>
<span id="cb303-47"><a href="stats_method.html#cb303-47" tabindex="-1"></a><span class="do">####################################################################</span></span>
<span id="cb303-48"><a href="stats_method.html#cb303-48" tabindex="-1"></a><span class="co"># allows slope and curvature of circle_fit_iou_pct to vary by convexity_pct and vice-versa</span></span>
<span id="cb303-49"><a href="stats_method.html#cb303-49" tabindex="-1"></a><span class="do">####################################################################</span></span>
<span id="cb303-50"><a href="stats_method.html#cb303-50" tabindex="-1"></a>fscore_mod3_temp <span class="ot">&lt;-</span> brms<span class="sc">::</span><span class="fu">brm</span>(</span>
<span id="cb303-51"><a href="stats_method.html#cb303-51" tabindex="-1"></a>  <span class="at">formula =</span> f_score <span class="sc">~</span> </span>
<span id="cb303-52"><a href="stats_method.html#cb303-52" tabindex="-1"></a>    <span class="dv">0</span> <span class="sc">+</span> <span class="co"># no intercept to allow all values of spectral_weight to be shown instead of set as the baseline </span></span>
<span id="cb303-53"><a href="stats_method.html#cb303-53" tabindex="-1"></a>    max_ht_m <span class="sc">+</span> max_area_m2 <span class="sc">+</span> convexity_pct <span class="sc">+</span> </span>
<span id="cb303-54"><a href="stats_method.html#cb303-54" tabindex="-1"></a>    circle_fit_iou_pct <span class="sc">+</span> <span class="fu">I</span>(circle_fit_iou_pct<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb303-55"><a href="stats_method.html#cb303-55" tabindex="-1"></a>    circle_fit_iou_pct<span class="sc">:</span>convexity_pct <span class="sc">+</span> <span class="co"># changed from base model</span></span>
<span id="cb303-56"><a href="stats_method.html#cb303-56" tabindex="-1"></a>    chm_res_m <span class="sc">+</span> spectral_weight <span class="sc">+</span> chm_res_m<span class="sc">:</span>spectral_weight</span>
<span id="cb303-57"><a href="stats_method.html#cb303-57" tabindex="-1"></a>  , <span class="at">data =</span> ms_df_temp</span>
<span id="cb303-58"><a href="stats_method.html#cb303-58" tabindex="-1"></a>  , <span class="at">family =</span> <span class="fu">Beta</span>(<span class="at">link =</span> <span class="st">&quot;logit&quot;</span>)</span>
<span id="cb303-59"><a href="stats_method.html#cb303-59" tabindex="-1"></a>  <span class="co"># mcmc</span></span>
<span id="cb303-60"><a href="stats_method.html#cb303-60" tabindex="-1"></a>  , <span class="at">iter =</span> iter_temp, <span class="at">warmup =</span> warmup_temp</span>
<span id="cb303-61"><a href="stats_method.html#cb303-61" tabindex="-1"></a>  , <span class="at">chains =</span> chains_temp</span>
<span id="cb303-62"><a href="stats_method.html#cb303-62" tabindex="-1"></a>  <span class="co"># , control = list(adapt_delta = 0.999, max_treedepth = 13)</span></span>
<span id="cb303-63"><a href="stats_method.html#cb303-63" tabindex="-1"></a>  , <span class="at">cores =</span> lasR<span class="sc">::</span><span class="fu">half_cores</span>()</span>
<span id="cb303-64"><a href="stats_method.html#cb303-64" tabindex="-1"></a>  , <span class="at">file =</span> <span class="fu">paste0</span>(<span class="st">&quot;../data/&quot;</span>, <span class="st">&quot;fscore_mod3_temp&quot;</span>)</span>
<span id="cb303-65"><a href="stats_method.html#cb303-65" tabindex="-1"></a>)</span>
<span id="cb303-66"><a href="stats_method.html#cb303-66" tabindex="-1"></a>fscore_mod3_temp <span class="ot">&lt;-</span> brms<span class="sc">::</span><span class="fu">add_criterion</span>(fscore_mod3_temp, <span class="at">criterion =</span> <span class="st">&quot;loo&quot;</span>)</span>
<span id="cb303-67"><a href="stats_method.html#cb303-67" tabindex="-1"></a><span class="do">####################################################################</span></span>
<span id="cb303-68"><a href="stats_method.html#cb303-68" tabindex="-1"></a><span class="co"># a three-way interaction of circle_fit_iou_pct, convexity_pct and chm_res_m</span></span>
<span id="cb303-69"><a href="stats_method.html#cb303-69" tabindex="-1"></a><span class="do">####################################################################</span></span>
<span id="cb303-70"><a href="stats_method.html#cb303-70" tabindex="-1"></a>fscore_mod4_temp <span class="ot">&lt;-</span> brms<span class="sc">::</span><span class="fu">brm</span>(</span>
<span id="cb303-71"><a href="stats_method.html#cb303-71" tabindex="-1"></a>  <span class="at">formula =</span> f_score <span class="sc">~</span> </span>
<span id="cb303-72"><a href="stats_method.html#cb303-72" tabindex="-1"></a>    <span class="dv">0</span> <span class="sc">+</span> <span class="co"># no intercept to allow all values of spectral_weight to be shown instead of set as the baseline </span></span>
<span id="cb303-73"><a href="stats_method.html#cb303-73" tabindex="-1"></a>    max_ht_m <span class="sc">+</span> max_area_m2 <span class="sc">+</span> convexity_pct <span class="sc">+</span> </span>
<span id="cb303-74"><a href="stats_method.html#cb303-74" tabindex="-1"></a>    circle_fit_iou_pct <span class="sc">+</span> <span class="fu">I</span>(circle_fit_iou_pct<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb303-75"><a href="stats_method.html#cb303-75" tabindex="-1"></a>    circle_fit_iou_pct<span class="sc">:</span>convexity_pct <span class="sc">+</span> <span class="co"># changed from base model</span></span>
<span id="cb303-76"><a href="stats_method.html#cb303-76" tabindex="-1"></a>    circle_fit_iou_pct<span class="sc">:</span>chm_res_m <span class="sc">+</span> <span class="co"># changed from base model</span></span>
<span id="cb303-77"><a href="stats_method.html#cb303-77" tabindex="-1"></a>    convexity_pct<span class="sc">:</span>chm_res_m <span class="sc">+</span> <span class="co"># changed from base model</span></span>
<span id="cb303-78"><a href="stats_method.html#cb303-78" tabindex="-1"></a>    circle_fit_iou_pct<span class="sc">:</span>chm_res_m<span class="sc">:</span>convexity_pct <span class="sc">+</span> <span class="co"># changed from base model</span></span>
<span id="cb303-79"><a href="stats_method.html#cb303-79" tabindex="-1"></a>    chm_res_m <span class="sc">+</span> spectral_weight <span class="sc">+</span> chm_res_m<span class="sc">:</span>spectral_weight</span>
<span id="cb303-80"><a href="stats_method.html#cb303-80" tabindex="-1"></a>  , <span class="at">data =</span> ms_df_temp</span>
<span id="cb303-81"><a href="stats_method.html#cb303-81" tabindex="-1"></a>  , <span class="at">family =</span> <span class="fu">Beta</span>(<span class="at">link =</span> <span class="st">&quot;logit&quot;</span>)</span>
<span id="cb303-82"><a href="stats_method.html#cb303-82" tabindex="-1"></a>  <span class="co"># mcmc</span></span>
<span id="cb303-83"><a href="stats_method.html#cb303-83" tabindex="-1"></a>  , <span class="at">iter =</span> iter_temp, <span class="at">warmup =</span> warmup_temp</span>
<span id="cb303-84"><a href="stats_method.html#cb303-84" tabindex="-1"></a>  , <span class="at">chains =</span> chains_temp</span>
<span id="cb303-85"><a href="stats_method.html#cb303-85" tabindex="-1"></a>  <span class="co"># , control = list(adapt_delta = 0.999, max_treedepth = 13)</span></span>
<span id="cb303-86"><a href="stats_method.html#cb303-86" tabindex="-1"></a>  , <span class="at">cores =</span> lasR<span class="sc">::</span><span class="fu">half_cores</span>()</span>
<span id="cb303-87"><a href="stats_method.html#cb303-87" tabindex="-1"></a>  , <span class="at">file =</span> <span class="fu">paste0</span>(<span class="st">&quot;../data/&quot;</span>, <span class="st">&quot;fscore_mod4_temp&quot;</span>)</span>
<span id="cb303-88"><a href="stats_method.html#cb303-88" tabindex="-1"></a>)</span>
<span id="cb303-89"><a href="stats_method.html#cb303-89" tabindex="-1"></a>fscore_mod4_temp <span class="ot">&lt;-</span> brms<span class="sc">::</span><span class="fu">add_criterion</span>(fscore_mod4_temp, <span class="at">criterion =</span> <span class="st">&quot;loo&quot;</span>)</span>
<span id="cb303-90"><a href="stats_method.html#cb303-90" tabindex="-1"></a><span class="do">####################################################################</span></span>
<span id="cb303-91"><a href="stats_method.html#cb303-91" tabindex="-1"></a><span class="co"># a three-way interaction of circle_fit_iou_pct, convexity_pct and chm_res_m. quadratic convexity_pct</span></span>
<span id="cb303-92"><a href="stats_method.html#cb303-92" tabindex="-1"></a><span class="do">####################################################################</span></span>
<span id="cb303-93"><a href="stats_method.html#cb303-93" tabindex="-1"></a>fscore_mod5_temp <span class="ot">&lt;-</span> brms<span class="sc">::</span><span class="fu">brm</span>(</span>
<span id="cb303-94"><a href="stats_method.html#cb303-94" tabindex="-1"></a>  <span class="at">formula =</span> f_score <span class="sc">~</span> </span>
<span id="cb303-95"><a href="stats_method.html#cb303-95" tabindex="-1"></a>    <span class="dv">0</span> <span class="sc">+</span> <span class="co"># no intercept to allow all values of spectral_weight to be shown instead of set as the baseline </span></span>
<span id="cb303-96"><a href="stats_method.html#cb303-96" tabindex="-1"></a>    max_ht_m <span class="sc">+</span> max_area_m2 <span class="sc">+</span> </span>
<span id="cb303-97"><a href="stats_method.html#cb303-97" tabindex="-1"></a>    circle_fit_iou_pct <span class="sc">+</span> <span class="fu">I</span>(circle_fit_iou_pct<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb303-98"><a href="stats_method.html#cb303-98" tabindex="-1"></a>    convexity_pct <span class="sc">+</span> <span class="fu">I</span>(convexity_pct<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span>  <span class="co"># changed from base model</span></span>
<span id="cb303-99"><a href="stats_method.html#cb303-99" tabindex="-1"></a>    circle_fit_iou_pct<span class="sc">:</span>convexity_pct <span class="sc">+</span> <span class="co"># changed from base model</span></span>
<span id="cb303-100"><a href="stats_method.html#cb303-100" tabindex="-1"></a>    circle_fit_iou_pct<span class="sc">:</span>chm_res_m <span class="sc">+</span> <span class="co"># changed from base model</span></span>
<span id="cb303-101"><a href="stats_method.html#cb303-101" tabindex="-1"></a>    convexity_pct<span class="sc">:</span>chm_res_m <span class="sc">+</span> <span class="co"># changed from base model</span></span>
<span id="cb303-102"><a href="stats_method.html#cb303-102" tabindex="-1"></a>    circle_fit_iou_pct<span class="sc">:</span>chm_res_m<span class="sc">:</span>convexity_pct <span class="sc">+</span> <span class="co"># changed from base model</span></span>
<span id="cb303-103"><a href="stats_method.html#cb303-103" tabindex="-1"></a>    chm_res_m <span class="sc">+</span> spectral_weight <span class="sc">+</span> chm_res_m<span class="sc">:</span>spectral_weight</span>
<span id="cb303-104"><a href="stats_method.html#cb303-104" tabindex="-1"></a>  , <span class="at">data =</span> ms_df_temp</span>
<span id="cb303-105"><a href="stats_method.html#cb303-105" tabindex="-1"></a>  , <span class="at">family =</span> <span class="fu">Beta</span>(<span class="at">link =</span> <span class="st">&quot;logit&quot;</span>)</span>
<span id="cb303-106"><a href="stats_method.html#cb303-106" tabindex="-1"></a>  <span class="co"># mcmc</span></span>
<span id="cb303-107"><a href="stats_method.html#cb303-107" tabindex="-1"></a>  , <span class="at">iter =</span> iter_temp, <span class="at">warmup =</span> warmup_temp</span>
<span id="cb303-108"><a href="stats_method.html#cb303-108" tabindex="-1"></a>  , <span class="at">chains =</span> chains_temp</span>
<span id="cb303-109"><a href="stats_method.html#cb303-109" tabindex="-1"></a>  <span class="co"># , control = list(adapt_delta = 0.999, max_treedepth = 13)</span></span>
<span id="cb303-110"><a href="stats_method.html#cb303-110" tabindex="-1"></a>  , <span class="at">cores =</span> lasR<span class="sc">::</span><span class="fu">half_cores</span>()</span>
<span id="cb303-111"><a href="stats_method.html#cb303-111" tabindex="-1"></a>  , <span class="at">file =</span> <span class="fu">paste0</span>(<span class="st">&quot;../data/&quot;</span>, <span class="st">&quot;fscore_mod5_temp&quot;</span>)</span>
<span id="cb303-112"><a href="stats_method.html#cb303-112" tabindex="-1"></a>)</span>
<span id="cb303-113"><a href="stats_method.html#cb303-113" tabindex="-1"></a>fscore_mod5_temp <span class="ot">&lt;-</span> brms<span class="sc">::</span><span class="fu">add_criterion</span>(fscore_mod4_temp, <span class="at">criterion =</span> <span class="st">&quot;loo&quot;</span>)</span></code></pre></div>
<p>compare our models with the LOO information criterion. with the <code>brms::loo_compare()</code> function, we can compute a formal difference score between models with the output rank ordering the models such that the best fitting model appears on top. all models also receive a difference score relative to the best model and a standard error of the difference score</p>
<div class="sourceCode" id="cb304"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb304-1"><a href="stats_method.html#cb304-1" tabindex="-1"></a>brms<span class="sc">::</span><span class="fu">loo_compare</span>(fscore_mod1_temp, fscore_mod2_temp, fscore_mod3_temp, fscore_mod4_temp, fscore_mod5_temp) <span class="sc">%&gt;%</span> </span>
<span id="cb304-2"><a href="stats_method.html#cb304-2" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kbl</span>(<span class="at">caption =</span> <span class="st">&quot;F-score model selection with LOO information criterion&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb304-3"><a href="stats_method.html#cb304-3" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kable_styling</span>()</span></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-280">Table 9.1: </span>F-score model selection with LOO information criterion
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
elpd_diff
</th>
<th style="text-align:right;">
se_diff
</th>
<th style="text-align:right;">
elpd_loo
</th>
<th style="text-align:right;">
se_elpd_loo
</th>
<th style="text-align:right;">
p_loo
</th>
<th style="text-align:right;">
se_p_loo
</th>
<th style="text-align:right;">
looic
</th>
<th style="text-align:right;">
se_looic
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
fscore_mod4_temp
</td>
<td style="text-align:right;">
0.0000
</td>
<td style="text-align:right;">
0.00000
</td>
<td style="text-align:right;">
4254.854
</td>
<td style="text-align:right;">
139.8614
</td>
<td style="text-align:right;">
26.42988
</td>
<td style="text-align:right;">
1.441628
</td>
<td style="text-align:right;">
-8509.709
</td>
<td style="text-align:right;">
279.7227
</td>
</tr>
<tr>
<td style="text-align:left;">
fscore_mod5_temp
</td>
<td style="text-align:right;">
0.0000
</td>
<td style="text-align:right;">
0.00000
</td>
<td style="text-align:right;">
4254.854
</td>
<td style="text-align:right;">
139.8614
</td>
<td style="text-align:right;">
26.42988
</td>
<td style="text-align:right;">
1.441628
</td>
<td style="text-align:right;">
-8509.709
</td>
<td style="text-align:right;">
279.7227
</td>
</tr>
<tr>
<td style="text-align:left;">
fscore_mod3_temp
</td>
<td style="text-align:right;">
-216.3790
</td>
<td style="text-align:right;">
26.76322
</td>
<td style="text-align:right;">
4038.475
</td>
<td style="text-align:right;">
139.5926
</td>
<td style="text-align:right;">
27.71362
</td>
<td style="text-align:right;">
1.931427
</td>
<td style="text-align:right;">
-8076.951
</td>
<td style="text-align:right;">
279.1851
</td>
</tr>
<tr>
<td style="text-align:left;">
fscore_mod2_temp
</td>
<td style="text-align:right;">
-229.8413
</td>
<td style="text-align:right;">
28.35355
</td>
<td style="text-align:right;">
4025.013
</td>
<td style="text-align:right;">
138.5435
</td>
<td style="text-align:right;">
27.54291
</td>
<td style="text-align:right;">
1.893650
</td>
<td style="text-align:right;">
-8050.026
</td>
<td style="text-align:right;">
277.0871
</td>
</tr>
<tr>
<td style="text-align:left;">
fscore_mod1_temp
</td>
<td style="text-align:right;">
-234.9112
</td>
<td style="text-align:right;">
30.47721
</td>
<td style="text-align:right;">
4019.943
</td>
<td style="text-align:right;">
139.0671
</td>
<td style="text-align:right;">
27.27559
</td>
<td style="text-align:right;">
1.942107
</td>
<td style="text-align:right;">
-8039.886
</td>
<td style="text-align:right;">
278.1342
</td>
</tr>
</tbody>
</table>
<p>we can also look at the AIC-type model weights</p>
<div class="sourceCode" id="cb305"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb305-1"><a href="stats_method.html#cb305-1" tabindex="-1"></a>brms<span class="sc">::</span><span class="fu">model_weights</span>(fscore_mod1_temp, fscore_mod2_temp, fscore_mod3_temp, fscore_mod4_temp, fscore_mod5_temp) <span class="sc">%&gt;%</span> </span>
<span id="cb305-2"><a href="stats_method.html#cb305-2" tabindex="-1"></a>  <span class="fu">round</span>(<span class="at">digits =</span> <span class="dv">4</span>)</span></code></pre></div>
<p>we can also quickly look at the Bayeisan <span class="math inline">\(R^2\)</span> returned from the <code>brms::bayes_R2()</code> function</p>
<div class="sourceCode" id="cb306"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb306-1"><a href="stats_method.html#cb306-1" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(</span>
<span id="cb306-2"><a href="stats_method.html#cb306-2" tabindex="-1"></a>  brms<span class="sc">::</span><span class="fu">bayes_R2</span>(fscore_mod1_temp,<span class="at">summary=</span>F) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">mod =</span> <span class="st">&quot;fscore_mod1_temp&quot;</span>)</span>
<span id="cb306-3"><a href="stats_method.html#cb306-3" tabindex="-1"></a>  , brms<span class="sc">::</span><span class="fu">bayes_R2</span>(fscore_mod2_temp,<span class="at">summary=</span>F) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">mod =</span> <span class="st">&quot;fscore_mod2_temp&quot;</span>)</span>
<span id="cb306-4"><a href="stats_method.html#cb306-4" tabindex="-1"></a>  , brms<span class="sc">::</span><span class="fu">bayes_R2</span>(fscore_mod3_temp,<span class="at">summary=</span>F) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">mod =</span> <span class="st">&quot;fscore_mod3_temp&quot;</span>)</span>
<span id="cb306-5"><a href="stats_method.html#cb306-5" tabindex="-1"></a>  , brms<span class="sc">::</span><span class="fu">bayes_R2</span>(fscore_mod4_temp,<span class="at">summary=</span>F) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">mod =</span> <span class="st">&quot;fscore_mod4_temp&quot;</span>)</span>
<span id="cb306-6"><a href="stats_method.html#cb306-6" tabindex="-1"></a>  , brms<span class="sc">::</span><span class="fu">bayes_R2</span>(fscore_mod5_temp,<span class="at">summary=</span>F) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">mod =</span> <span class="st">&quot;fscore_mod5_temp&quot;</span>)</span>
<span id="cb306-7"><a href="stats_method.html#cb306-7" tabindex="-1"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb306-8"><a href="stats_method.html#cb306-8" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">mod =</span> <span class="fu">factor</span>(mod)) <span class="sc">%&gt;%</span> </span>
<span id="cb306-9"><a href="stats_method.html#cb306-9" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="at">mapping=</span>ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">y=</span>R2, <span class="at">x =</span> mod)) <span class="sc">+</span></span>
<span id="cb306-10"><a href="stats_method.html#cb306-10" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">stat_eye</span>(</span>
<span id="cb306-11"><a href="stats_method.html#cb306-11" tabindex="-1"></a>    <span class="at">point_interval =</span> median_hdi, <span class="at">.width =</span> .<span class="dv">95</span></span>
<span id="cb306-12"><a href="stats_method.html#cb306-12" tabindex="-1"></a>    , <span class="at">slab_alpha =</span> <span class="fl">0.95</span></span>
<span id="cb306-13"><a href="stats_method.html#cb306-13" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb306-14"><a href="stats_method.html#cb306-14" tabindex="-1"></a>  <span class="co"># ggplot2::facet_grid(cols = dplyr::vars(spectral_weight)) +</span></span>
<span id="cb306-15"><a href="stats_method.html#cb306-15" tabindex="-1"></a>  <span class="co"># ggplot2::scale_fill_manual(values = pal_chm_res_m) +</span></span>
<span id="cb306-16"><a href="stats_method.html#cb306-16" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Bayesian R-squared&quot;</span>) <span class="sc">+</span></span>
<span id="cb306-17"><a href="stats_method.html#cb306-17" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_light</span>()</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-282-1.png" width="1008" /></p>
<p>the more complex models were selected as the best. while our model evaluation indicated that the more parsimonious model with fewer parameters was comparable to the most complex model tested, we’ll the more complex model (<code>fscore_mod5_temp</code>) model for our based on the AIC-type model weights. because the selected model includes a quadratic term and multiple interactions parameter interpretation will be a challenge, so we will have to rely on plotting the modeled relationships rather than trying to interpret the coefficients.</p>
</div>
<div id="modeling" class="section level3 hasAnchor" number="9.1.2">
<h3><span class="header-section-number">9.1.2</span> Modeling<a href="stats_method.html#modeling" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>the four structural parameters (e.g. <code>max_ht_m</code> and <code>circle_fit_iou_pct</code>) and the CHM resolution (<code>chm_res_m</code>) as metric (i.e., continuous) variables. we include an interaction between <code>chm_res_m</code> and <code>spectral_weight</code> to directly compare the effect of CHM resolution with and without the use of spectral data.</p>
<p>we’ll generally follow Kurz (<a href="https://bookdown.org/content/3890/multivariate-linear-models.html">2023a</a>; <a href="https://bookdown.org/content/3890/interactions.html">2023b</a>; <a href="https://bookdown.org/content/3686/18.html">2025</a> for multiple linear regression model building using the <code>brms</code> Bayesian model framework based on <a href="https://xcelab.net/rm/">McElreath (2015, Ch. 5,7)</a> and <a href="https://sites.google.com/site/doingbayesiandataanalysis/">Kruschke (2015, Ch. 18)</a></p>
<p>the fully factored Bayesian statistical model that details the likelihood, linear model, and priors used is:</p>
<p><span class="math display">\[\begin{align*}
\text{F-score}_i \sim &amp; \operatorname{Beta}(\mu_{i}, \phi) \\
\operatorname{logit}(\mu_i) = &amp; (\beta_1 \cdot \text{max_ht_m}_i) + (\beta_2 \cdot \text{max_area_m2}_i) \\
&amp; + (\beta_3 \cdot \text{circle_fit_iou_pct}_i) + (\beta_4 \cdot (\text{circle_fit_iou_pct}_i)^2) \\
&amp; + (\beta_5 \cdot \text{convexity_pct}_i) + (\beta_6 \cdot (\text{convexity_pct}_i)^2) \\
&amp; + (\beta_7 \cdot \text{chm_res_m}_i) \\
&amp; + \sum_{j=0}^{5} \left( \beta_{8, j} \cdot \mathbf{I}(\text{spectral_weight}_i = j) \right) \\
&amp; + (\beta_9 \cdot \text{circle_fit_iou_pct}_i \cdot \text{convexity_pct}_i) \\
&amp; + (\beta_{10} \cdot \text{circle_fit_iou_pct}_i \cdot \text{chm_res_m}_i) \\
&amp; + (\beta_{11} \cdot \text{convexity_pct}_i \cdot \text{chm_res_m}_i) \\
&amp; + \sum_{j=0}^{5} \left( \beta_{12, j} \cdot \text{chm_res_m}_i \cdot \mathbf{I}(\text{spectral_weight}_i = j) \right) \\
&amp; + (\beta_{13} \cdot \text{circle_fit_iou_pct}_i \cdot \text{chm_res_m}_i \cdot \text{convexity_pct}_i) \\
\beta_k \sim &amp; \operatorname{Normal}(0, \sigma_k) \quad \text{for } k = 0, \dots, 13 \\
\sigma_k \sim &amp; \operatorname{Student T}(3,0,2.5) \quad \text{for } k = 0, \dots, 13 \\
\phi \sim &amp; \operatorname{Gamma}(0.01,0.01) \\
\end{align*}\]</span></p>
<p>where, <span class="math inline">\(i\)</span> represents a single observation in the dataset which corresponds to a specific combination of the six parameters (<code>max_ht_m</code>, <code>max_area_m2</code>, <code>convexity_pct</code>, <code>circle_fit_iou_pct</code>, <code>chm_res_m</code>, and <code>spectral_weight</code>) and its resulting F-score. Where <code>k</code> is used to index the different beta coefficients, which correspond to the intercept and the effects of each of the independent variables and their interactions and <code>j</code> denotes the specific level of the nominal (i.e. categorical) predictor <code>spectral_weight</code></p>
<p>let’s fit the model using the <code>brms</code> framework to fit Bayesian regression models using the Stan probabilistic programming language. if we want to set the prior for <span class="math inline">\(\beta_0\)</span> given a non-centered predictors, then we need to use the <code>0 + Intercept</code> syntax to fit the model (see Kurz <a href="https://solomonkurz.netlify.app/blog/2025-07-17-learn-stan-with-brms-part-iii/">2025</a> for full discussion), but we’ll just fit the model with the <code>brsm::brm()</code> default settings which automatically mean centers the predictors and also set the intercept to <code>0</code> so that we get explicit coefficient estimates for each level of our <code>spectral_weight</code> nominal variable which determines the intercept in this model</p>
<p>The table below details the terms used in our Bayesian GLM model defined in the <code>brms::brm()</code> call:</p>
<table>
<colgroup>
<col width="33%" />
<col width="33%" />
<col width="33%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Term in Formula</th>
<th align="left">Type of Effect</th>
<th align="left">Description of Relationship Tested</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><strong><code>0 +</code></strong></td>
<td align="left">Zero Intercept</td>
<td align="left">Specifies that the model is fit without a global intercept (baseline is determined by the combination of all factor levels).</td>
</tr>
<tr class="even">
<td align="left"><strong><code>max_ht_m</code></strong></td>
<td align="left">Main Effect (Linear)</td>
<td align="left">Tests the direct, isolated linear influence of the maximum pile height threshold on the F-score.</td>
</tr>
<tr class="odd">
<td align="left"><strong><code>max_area_m2</code></strong></td>
<td align="left">Main Effect (Linear)</td>
<td align="left">Tests the direct, isolated linear influence of the maximum pile area threshold on the F-score.</td>
</tr>
<tr class="even">
<td align="left"><strong><code>chm_res_m</code></strong></td>
<td align="left">Main Effect (Linear)</td>
<td align="left">Tests the direct, isolated linear influence of the input Canopy Height Model (CHM) resolution on the F-score.</td>
</tr>
<tr class="odd">
<td align="left"><strong><code>spectral_weight</code></strong></td>
<td align="left">Main Effect (Factor)</td>
<td align="left">The model estimates a separate coefficient for each of the six spectral weight levels (0 through 5). This coefficient represents the estimated mean F-score for that specific spectral weight level when all continuous variables are zero.</td>
</tr>
<tr class="even">
<td align="left"><strong><code>circle_fit_iou_pct</code></strong></td>
<td align="left">Main Effect (Linear)</td>
<td align="left">Tests the direct linear influence of the pile’s circular conformity threshold on the F-score.</td>
</tr>
<tr class="odd">
<td align="left"><strong><code>convexity_pct</code></strong></td>
<td align="left">Main Effect (Linear)</td>
<td align="left">Tests the direct linear influence of the pile’s boundary smoothness (convexity) threshold on the F-score.</td>
</tr>
<tr class="even">
<td align="left"><strong><code>I(circle_fit_iou_pct^2)</code></strong></td>
<td align="left">Nonlinear (Quadratic)</td>
<td align="left">Models a curved relationship where the F-score may peak or bottom out at an intermediate threshold for pile circularity.</td>
</tr>
<tr class="odd">
<td align="left"><strong><code>I(convexity_pct^2)</code></strong></td>
<td align="left">Nonlinear (Quadratic)</td>
<td align="left">Models a curved relationship where the F-score may peak or bottom out at an intermediate threshold for pile boundary smoothness.</td>
</tr>
<tr class="even">
<td align="left"><strong><code>circle_fit_iou_pct:convexity_pct</code></strong></td>
<td align="left">Two-Way Interaction</td>
<td align="left">Captures how the optimal balance between pile circular conformity and boundary smoothness changes for the F-score.</td>
</tr>
<tr class="odd">
<td align="left"><strong><code>chm_res_m:spectral_weight</code></strong></td>
<td align="left">Two-Way Interaction (Factor)</td>
<td align="left">Captures how the effect of CHM resolution on the F-score changes across each of the six spectral weighting levels.</td>
</tr>
<tr class="even">
<td align="left"><strong><code>circle_fit_iou_pct:chm_res_m</code></strong></td>
<td align="left">Two-Way Interaction</td>
<td align="left">Captures how the importance of the pile’s circular conformity threshold changes as the input data resolution changes.</td>
</tr>
<tr class="odd">
<td align="left"><strong><code>convexity_pct:chm_res_m</code></strong></td>
<td align="left">Two-Way Interaction</td>
<td align="left">Captures how the sensitivity to the pile boundary smoothness threshold changes with the input data resolution.</td>
</tr>
<tr class="even">
<td align="left"><strong><code>circle_fit_iou_pct:chm_res_m:convexity_pct</code></strong></td>
<td align="left">Three-Way Interaction</td>
<td align="left">The most complex term, showing how the combined effects of the circularity and convexity thresholds change simultaneously across different input CHM resolutions.</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb307"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb307-1"><a href="stats_method.html#cb307-1" tabindex="-1"></a>brms_f_score_mod <span class="ot">&lt;-</span> brms<span class="sc">::</span><span class="fu">brm</span>(</span>
<span id="cb307-2"><a href="stats_method.html#cb307-2" tabindex="-1"></a>  <span class="at">formula =</span> f_score <span class="sc">~</span> </span>
<span id="cb307-3"><a href="stats_method.html#cb307-3" tabindex="-1"></a>    <span class="dv">0</span> <span class="sc">+</span> <span class="co"># no intercept to allow all values of spectral_weight to be shown instead of set as the baseline </span></span>
<span id="cb307-4"><a href="stats_method.html#cb307-4" tabindex="-1"></a>    max_ht_m <span class="sc">+</span> max_area_m2 <span class="sc">+</span> </span>
<span id="cb307-5"><a href="stats_method.html#cb307-5" tabindex="-1"></a>    circle_fit_iou_pct <span class="sc">+</span> <span class="fu">I</span>(circle_fit_iou_pct<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb307-6"><a href="stats_method.html#cb307-6" tabindex="-1"></a>    convexity_pct <span class="sc">+</span> <span class="fu">I</span>(convexity_pct<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span>  <span class="co"># changed from base model</span></span>
<span id="cb307-7"><a href="stats_method.html#cb307-7" tabindex="-1"></a>    circle_fit_iou_pct<span class="sc">:</span>convexity_pct <span class="sc">+</span> <span class="co"># changed from base model</span></span>
<span id="cb307-8"><a href="stats_method.html#cb307-8" tabindex="-1"></a>    circle_fit_iou_pct<span class="sc">:</span>chm_res_m <span class="sc">+</span> <span class="co"># changed from base model</span></span>
<span id="cb307-9"><a href="stats_method.html#cb307-9" tabindex="-1"></a>    convexity_pct<span class="sc">:</span>chm_res_m <span class="sc">+</span> <span class="co"># changed from base model</span></span>
<span id="cb307-10"><a href="stats_method.html#cb307-10" tabindex="-1"></a>    circle_fit_iou_pct<span class="sc">:</span>chm_res_m<span class="sc">:</span>convexity_pct <span class="sc">+</span> <span class="co"># changed from base model</span></span>
<span id="cb307-11"><a href="stats_method.html#cb307-11" tabindex="-1"></a>    chm_res_m <span class="sc">+</span> spectral_weight <span class="sc">+</span> chm_res_m<span class="sc">:</span>spectral_weight</span>
<span id="cb307-12"><a href="stats_method.html#cb307-12" tabindex="-1"></a>  , <span class="at">data =</span> param_combos_spectral_ranked <span class="co"># %&gt;% dplyr::slice_sample(prop = 0.33)</span></span>
<span id="cb307-13"><a href="stats_method.html#cb307-13" tabindex="-1"></a>  , <span class="at">family =</span> <span class="fu">Beta</span>(<span class="at">link =</span> <span class="st">&quot;logit&quot;</span>)</span>
<span id="cb307-14"><a href="stats_method.html#cb307-14" tabindex="-1"></a>  <span class="co"># , prior = c(</span></span>
<span id="cb307-15"><a href="stats_method.html#cb307-15" tabindex="-1"></a>  <span class="co">#   brms::prior(student_t(3, 0, 5), class = &quot;b&quot;)</span></span>
<span id="cb307-16"><a href="stats_method.html#cb307-16" tabindex="-1"></a>  <span class="co">#   , brms::prior(gamma(0.01, 0.01), class = &quot;phi&quot;)</span></span>
<span id="cb307-17"><a href="stats_method.html#cb307-17" tabindex="-1"></a>  <span class="co"># )</span></span>
<span id="cb307-18"><a href="stats_method.html#cb307-18" tabindex="-1"></a>  <span class="co"># mcmc</span></span>
<span id="cb307-19"><a href="stats_method.html#cb307-19" tabindex="-1"></a>  , <span class="at">iter =</span> <span class="dv">14000</span>, <span class="at">warmup =</span> <span class="dv">7000</span></span>
<span id="cb307-20"><a href="stats_method.html#cb307-20" tabindex="-1"></a>  , <span class="at">chains =</span> <span class="dv">4</span></span>
<span id="cb307-21"><a href="stats_method.html#cb307-21" tabindex="-1"></a>  <span class="co"># , control = list(adapt_delta = 0.999, max_treedepth = 13)</span></span>
<span id="cb307-22"><a href="stats_method.html#cb307-22" tabindex="-1"></a>  , <span class="at">cores =</span> lasR<span class="sc">::</span><span class="fu">half_cores</span>()</span>
<span id="cb307-23"><a href="stats_method.html#cb307-23" tabindex="-1"></a>  , <span class="at">file =</span> <span class="fu">paste0</span>(<span class="st">&quot;../data/&quot;</span>, <span class="st">&quot;brms_f_score_mod&quot;</span>)</span>
<span id="cb307-24"><a href="stats_method.html#cb307-24" tabindex="-1"></a>)</span>
<span id="cb307-25"><a href="stats_method.html#cb307-25" tabindex="-1"></a><span class="co"># brms::make_stancode(brms_f_score_mod)</span></span>
<span id="cb307-26"><a href="stats_method.html#cb307-26" tabindex="-1"></a><span class="co"># brms::prior_summary(brms_f_score_mod)</span></span>
<span id="cb307-27"><a href="stats_method.html#cb307-27" tabindex="-1"></a><span class="co"># print(brms_f_score_mod)</span></span>
<span id="cb307-28"><a href="stats_method.html#cb307-28" tabindex="-1"></a><span class="co"># brms::neff_ratio(brms_f_score_mod)</span></span>
<span id="cb307-29"><a href="stats_method.html#cb307-29" tabindex="-1"></a><span class="co"># brms::rhat(brms_f_score_mod)</span></span>
<span id="cb307-30"><a href="stats_method.html#cb307-30" tabindex="-1"></a><span class="co"># brms::nuts_params(brms_f_score_mod)</span></span></code></pre></div>
<p>The <code>brms::brm</code> model summary</p>
<div class="sourceCode" id="cb308"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb308-1"><a href="stats_method.html#cb308-1" tabindex="-1"></a>brms_f_score_mod <span class="sc">%&gt;%</span> </span>
<span id="cb308-2"><a href="stats_method.html#cb308-2" tabindex="-1"></a>  brms<span class="sc">::</span><span class="fu">posterior_summary</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb308-3"><a href="stats_method.html#cb308-3" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb308-4"><a href="stats_method.html#cb308-4" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">&quot;parameter&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb308-5"><a href="stats_method.html#cb308-5" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename_with</span>(tolower) <span class="sc">%&gt;%</span> </span>
<span id="cb308-6"><a href="stats_method.html#cb308-6" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(</span>
<span id="cb308-7"><a href="stats_method.html#cb308-7" tabindex="-1"></a>    stringr<span class="sc">::</span><span class="fu">str_starts</span>(parameter, <span class="st">&quot;b_&quot;</span>) </span>
<span id="cb308-8"><a href="stats_method.html#cb308-8" tabindex="-1"></a>    <span class="sc">|</span> parameter <span class="sc">==</span> <span class="st">&quot;phi&quot;</span></span>
<span id="cb308-9"><a href="stats_method.html#cb308-9" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb308-10"><a href="stats_method.html#cb308-10" tabindex="-1"></a>  <span class="co"># dplyr::mutate(</span></span>
<span id="cb308-11"><a href="stats_method.html#cb308-11" tabindex="-1"></a>  <span class="co">#   dplyr::across(</span></span>
<span id="cb308-12"><a href="stats_method.html#cb308-12" tabindex="-1"></a>  <span class="co">#     dplyr::where(is.numeric)</span></span>
<span id="cb308-13"><a href="stats_method.html#cb308-13" tabindex="-1"></a>  <span class="co">#     , ~ dplyr::case_when(</span></span>
<span id="cb308-14"><a href="stats_method.html#cb308-14" tabindex="-1"></a>  <span class="co">#       stringr::str_ends(parameter,&quot;_pct&quot;) ~ .x*0.01 # convert to percentage point change</span></span>
<span id="cb308-15"><a href="stats_method.html#cb308-15" tabindex="-1"></a>  <span class="co">#       , T ~ .x</span></span>
<span id="cb308-16"><a href="stats_method.html#cb308-16" tabindex="-1"></a>  <span class="co">#     )</span></span>
<span id="cb308-17"><a href="stats_method.html#cb308-17" tabindex="-1"></a>  <span class="co">#   )</span></span>
<span id="cb308-18"><a href="stats_method.html#cb308-18" tabindex="-1"></a>  <span class="co"># ) %&gt;% </span></span>
<span id="cb308-19"><a href="stats_method.html#cb308-19" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kbl</span>(<span class="at">digits =</span> <span class="dv">3</span>, <span class="at">caption =</span> <span class="st">&quot;Bayesian model for F-score&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb308-20"><a href="stats_method.html#cb308-20" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kable_styling</span>()</span></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-287">Table 9.2: </span>Bayesian model for F-score
</caption>
<thead>
<tr>
<th style="text-align:left;">
parameter
</th>
<th style="text-align:right;">
estimate
</th>
<th style="text-align:right;">
est.error
</th>
<th style="text-align:right;">
q2.5
</th>
<th style="text-align:right;">
q97.5
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
b_max_ht_m
</td>
<td style="text-align:right;">
-0.033
</td>
<td style="text-align:right;">
0.004
</td>
<td style="text-align:right;">
-0.042
</td>
<td style="text-align:right;">
-0.025
</td>
</tr>
<tr>
<td style="text-align:left;">
b_max_area_m2
</td>
<td style="text-align:right;">
0.006
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
0.005
</td>
<td style="text-align:right;">
0.006
</td>
</tr>
<tr>
<td style="text-align:left;">
b_circle_fit_iou_pct
</td>
<td style="text-align:right;">
5.893
</td>
<td style="text-align:right;">
0.100
</td>
<td style="text-align:right;">
5.696
</td>
<td style="text-align:right;">
6.091
</td>
</tr>
<tr>
<td style="text-align:left;">
b_Icircle_fit_iou_pctE2
</td>
<td style="text-align:right;">
-9.792
</td>
<td style="text-align:right;">
0.066
</td>
<td style="text-align:right;">
-9.923
</td>
<td style="text-align:right;">
-9.662
</td>
</tr>
<tr>
<td style="text-align:left;">
b_convexity_pct
</td>
<td style="text-align:right;">
0.297
</td>
<td style="text-align:right;">
0.103
</td>
<td style="text-align:right;">
0.094
</td>
<td style="text-align:right;">
0.498
</td>
</tr>
<tr>
<td style="text-align:left;">
b_Iconvexity_pctE2
</td>
<td style="text-align:right;">
-5.165
</td>
<td style="text-align:right;">
0.065
</td>
<td style="text-align:right;">
-5.291
</td>
<td style="text-align:right;">
-5.037
</td>
</tr>
<tr>
<td style="text-align:left;">
b_chm_res_m
</td>
<td style="text-align:right;">
-6.767
</td>
<td style="text-align:right;">
0.159
</td>
<td style="text-align:right;">
-7.081
</td>
<td style="text-align:right;">
-6.456
</td>
</tr>
<tr>
<td style="text-align:left;">
b_spectral_weight0
</td>
<td style="text-align:right;">
0.897
</td>
<td style="text-align:right;">
0.057
</td>
<td style="text-align:right;">
0.786
</td>
<td style="text-align:right;">
1.010
</td>
</tr>
<tr>
<td style="text-align:left;">
b_spectral_weight1
</td>
<td style="text-align:right;">
0.896
</td>
<td style="text-align:right;">
0.057
</td>
<td style="text-align:right;">
0.785
</td>
<td style="text-align:right;">
1.008
</td>
</tr>
<tr>
<td style="text-align:left;">
b_spectral_weight2
</td>
<td style="text-align:right;">
0.896
</td>
<td style="text-align:right;">
0.057
</td>
<td style="text-align:right;">
0.786
</td>
<td style="text-align:right;">
1.009
</td>
</tr>
<tr>
<td style="text-align:left;">
b_spectral_weight3
</td>
<td style="text-align:right;">
0.925
</td>
<td style="text-align:right;">
0.057
</td>
<td style="text-align:right;">
0.814
</td>
<td style="text-align:right;">
1.038
</td>
</tr>
<tr>
<td style="text-align:left;">
b_spectral_weight4
</td>
<td style="text-align:right;">
1.209
</td>
<td style="text-align:right;">
0.056
</td>
<td style="text-align:right;">
1.099
</td>
<td style="text-align:right;">
1.320
</td>
</tr>
<tr>
<td style="text-align:left;">
b_spectral_weight5
</td>
<td style="text-align:right;">
1.083
</td>
<td style="text-align:right;">
0.056
</td>
<td style="text-align:right;">
0.973
</td>
<td style="text-align:right;">
1.195
</td>
</tr>
<tr>
<td style="text-align:left;">
b_circle_fit_iou_pct:convexity_pct
</td>
<td style="text-align:right;">
2.815
</td>
<td style="text-align:right;">
0.127
</td>
<td style="text-align:right;">
2.569
</td>
<td style="text-align:right;">
3.065
</td>
</tr>
<tr>
<td style="text-align:left;">
b_circle_fit_iou_pct:chm_res_m
</td>
<td style="text-align:right;">
2.690
</td>
<td style="text-align:right;">
0.230
</td>
<td style="text-align:right;">
2.240
</td>
<td style="text-align:right;">
3.141
</td>
</tr>
<tr>
<td style="text-align:left;">
b_convexity_pct:chm_res_m
</td>
<td style="text-align:right;">
10.563
</td>
<td style="text-align:right;">
0.232
</td>
<td style="text-align:right;">
10.105
</td>
<td style="text-align:right;">
11.020
</td>
</tr>
<tr>
<td style="text-align:left;">
b_chm_res_m:spectral_weight1
</td>
<td style="text-align:right;">
0.001
</td>
<td style="text-align:right;">
0.120
</td>
<td style="text-align:right;">
-0.234
</td>
<td style="text-align:right;">
0.237
</td>
</tr>
<tr>
<td style="text-align:left;">
b_chm_res_m:spectral_weight2
</td>
<td style="text-align:right;">
0.001
</td>
<td style="text-align:right;">
0.121
</td>
<td style="text-align:right;">
-0.236
</td>
<td style="text-align:right;">
0.238
</td>
</tr>
<tr>
<td style="text-align:left;">
b_chm_res_m:spectral_weight3
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
0.120
</td>
<td style="text-align:right;">
-0.235
</td>
<td style="text-align:right;">
0.236
</td>
</tr>
<tr>
<td style="text-align:left;">
b_chm_res_m:spectral_weight4
</td>
<td style="text-align:right;">
-0.263
</td>
<td style="text-align:right;">
0.117
</td>
<td style="text-align:right;">
-0.491
</td>
<td style="text-align:right;">
-0.033
</td>
</tr>
<tr>
<td style="text-align:left;">
b_chm_res_m:spectral_weight5
</td>
<td style="text-align:right;">
0.628
</td>
<td style="text-align:right;">
0.115
</td>
<td style="text-align:right;">
0.403
</td>
<td style="text-align:right;">
0.853
</td>
</tr>
<tr>
<td style="text-align:left;">
b_circle_fit_iou_pct:convexity_pct:chm_res_m
</td>
<td style="text-align:right;">
-6.991
</td>
<td style="text-align:right;">
0.407
</td>
<td style="text-align:right;">
-7.789
</td>
<td style="text-align:right;">
-6.188
</td>
</tr>
<tr>
<td style="text-align:left;">
phi
</td>
<td style="text-align:right;">
4.170
</td>
<td style="text-align:right;">
0.031
</td>
<td style="text-align:right;">
4.110
</td>
<td style="text-align:right;">
4.230
</td>
</tr>
</tbody>
</table>
<p>note the quadratic coefficients ending in <code>E2</code>, Kruschke (2015) provides some insight on how to interpret:</p>
<blockquote>
<p>A quadratic has the form <span class="math inline">\(y = \beta_{0} + \beta_{1}x + \beta_{2}x^{2}\)</span>. When <span class="math inline">\(\beta_{2}\)</span> is zero, the form reduces to a line. Therefore, this extended model can produce any fit that the linear model can. When <span class="math inline">\(\beta_{2}\)</span> is positive, a plot of the curve is a parabola that opens upward. When <span class="math inline">\(\beta_{2}\)</span> is negative, the curve is a parabola that opens downward. We have no reason to think that the curvature in the family-income data is exactly a parabola, but the quadratic trend might describe the data much better than a line alone. (p. 496)</p>
</blockquote>
</div>
<div id="posterior-predictive-checks" class="section level3 hasAnchor" number="9.1.3">
<h3><span class="header-section-number">9.1.3</span> Posterior Predictive Checks<a href="stats_method.html#posterior-predictive-checks" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Markov chain Monte Carlo (MCMC) simulations were conducted using the brms package (Bürkner 2017) to estimate posterior predictive distributions of the parameters of interest. We ran 4 chains of 14,000 iterations with the first 7,000 discarded as burn-in. Trace-plots were utilized to visually assess model convergence.</p>
<p>check the trace plots for problems with convergence of the Markov chains</p>
<div class="sourceCode" id="cb309"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb309-1"><a href="stats_method.html#cb309-1" tabindex="-1"></a><span class="fu">plot</span>(brms_f_score_mod)</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-288-1.png" width="1008" /><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-288-2.png" width="1008" /><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-288-3.png" width="1008" /><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-288-4.png" width="1008" /><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-288-5.png" width="1008" /></p>
<p>Sufficient convergence was checked with <span class="math inline">\(\hat{R}\)</span> values near 1 (<a href="https://scholar.google.com/scholar?cluster=14209404114665352991&amp;hl=en&amp;as_sdt=0,6">Brooks &amp; Gelman, 1998</a>).</p>
<p>in the plot below, <span class="math inline">\(\hat{R}\)</span> values are colored using different shades (lighter is better). The chosen thresholds are somewhat arbitrary, but can be useful guidelines in practice (<a href="https://mc-stan.org/bayesplot/reference/MCMC-diagnostics.html">Gabry and Mahr 2025</a>):</p>
<ul>
<li>light: below 1.05 (good)</li>
<li>mid: between 1.05 and 1.1 (ok)</li>
<li>dark: above 1.1 (too high)</li>
</ul>
<p>check our <span class="math inline">\(\hat{R}\)</span> values</p>
<div class="sourceCode" id="cb310"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb310-1"><a href="stats_method.html#cb310-1" tabindex="-1"></a>brms<span class="sc">::</span><span class="fu">mcmc_plot</span>(brms_f_score_mod, <span class="at">type =</span> <span class="st">&quot;rhat_hist&quot;</span>) <span class="sc">+</span></span>
<span id="cb310-2"><a href="stats_method.html#cb310-2" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> scales<span class="sc">::</span><span class="fu">breaks_extended</span>(<span class="at">n =</span> <span class="dv">6</span>)) <span class="sc">+</span></span>
<span id="cb310-3"><a href="stats_method.html#cb310-3" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb310-4"><a href="stats_method.html#cb310-4" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb310-5"><a href="stats_method.html#cb310-5" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;top&quot;</span>, <span class="at">legend.direction =</span> <span class="st">&quot;horizontal&quot;</span></span>
<span id="cb310-6"><a href="stats_method.html#cb310-6" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-289-1.png" width="1008" /></p>
<p>and another check of our <span class="math inline">\(\hat{R}\)</span> values</p>
<div class="sourceCode" id="cb311"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb311-1"><a href="stats_method.html#cb311-1" tabindex="-1"></a><span class="co"># and another check of our $\hat{R}$ values</span></span>
<span id="cb311-2"><a href="stats_method.html#cb311-2" tabindex="-1"></a>brms_f_score_mod <span class="sc">%&gt;%</span> </span>
<span id="cb311-3"><a href="stats_method.html#cb311-3" tabindex="-1"></a>  brms<span class="sc">::</span><span class="fu">rhat</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb311-4"><a href="stats_method.html#cb311-4" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb311-5"><a href="stats_method.html#cb311-5" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">&quot;parameter&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb311-6"><a href="stats_method.html#cb311-6" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename_with</span>(tolower) <span class="sc">%&gt;%</span> </span>
<span id="cb311-7"><a href="stats_method.html#cb311-7" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">rhat =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb311-8"><a href="stats_method.html#cb311-8" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(</span>
<span id="cb311-9"><a href="stats_method.html#cb311-9" tabindex="-1"></a>    stringr<span class="sc">::</span><span class="fu">str_starts</span>(parameter, <span class="st">&quot;b_&quot;</span>) </span>
<span id="cb311-10"><a href="stats_method.html#cb311-10" tabindex="-1"></a>    <span class="sc">|</span> stringr<span class="sc">::</span><span class="fu">str_starts</span>(parameter, <span class="st">&quot;r_&quot;</span>) </span>
<span id="cb311-11"><a href="stats_method.html#cb311-11" tabindex="-1"></a>    <span class="sc">|</span> stringr<span class="sc">::</span><span class="fu">str_starts</span>(parameter, <span class="st">&quot;sd_&quot;</span>) </span>
<span id="cb311-12"><a href="stats_method.html#cb311-12" tabindex="-1"></a>    <span class="sc">|</span> parameter <span class="sc">==</span> <span class="st">&quot;phi&quot;</span></span>
<span id="cb311-13"><a href="stats_method.html#cb311-13" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb311-14"><a href="stats_method.html#cb311-14" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb311-15"><a href="stats_method.html#cb311-15" tabindex="-1"></a>    <span class="at">chk =</span> (rhat <span class="sc">&lt;=</span> <span class="dv">1</span><span class="sc">*</span><span class="fl">0.998</span> <span class="sc">|</span> rhat <span class="sc">&gt;=</span> <span class="dv">1</span><span class="sc">*</span><span class="fl">1.002</span>)</span>
<span id="cb311-16"><a href="stats_method.html#cb311-16" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb311-17"><a href="stats_method.html#cb311-17" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> rhat, <span class="at">y =</span> parameter, <span class="at">color =</span> chk, <span class="at">fill =</span> chk)) <span class="sc">+</span></span>
<span id="cb311-18"><a href="stats_method.html#cb311-18" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">1</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>, <span class="at">color =</span> <span class="st">&quot;gray44&quot;</span>, <span class="at">lwd =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb311-19"><a href="stats_method.html#cb311-19" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">1</span><span class="sc">*</span><span class="fl">0.998</span>, <span class="at">lwd =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb311-20"><a href="stats_method.html#cb311-20" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">1</span><span class="sc">*</span><span class="fl">1.002</span>, <span class="at">lwd =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb311-21"><a href="stats_method.html#cb311-21" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">1</span><span class="sc">*</span><span class="fl">0.999</span>, <span class="at">lwd =</span> <span class="fl">1.2</span>, <span class="at">color =</span> <span class="st">&quot;gray33&quot;</span>) <span class="sc">+</span></span>
<span id="cb311-22"><a href="stats_method.html#cb311-22" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">1</span><span class="sc">*</span><span class="fl">1.001</span>, <span class="at">lwd =</span> <span class="fl">1.2</span>, <span class="at">color =</span> <span class="st">&quot;gray33&quot;</span>) <span class="sc">+</span></span>
<span id="cb311-23"><a href="stats_method.html#cb311-23" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb311-24"><a href="stats_method.html#cb311-24" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;navy&quot;</span>, <span class="st">&quot;firebrick&quot;</span>)) <span class="sc">+</span></span>
<span id="cb311-25"><a href="stats_method.html#cb311-25" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;navy&quot;</span>, <span class="st">&quot;firebrick&quot;</span>)) <span class="sc">+</span></span>
<span id="cb311-26"><a href="stats_method.html#cb311-26" tabindex="-1"></a>  <span class="fu">scale_y_discrete</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb311-27"><a href="stats_method.html#cb311-27" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb311-28"><a href="stats_method.html#cb311-28" tabindex="-1"></a>    <span class="at">x =</span> latex2exp<span class="sc">::</span><span class="fu">TeX</span>(<span class="st">&quot;$</span><span class="sc">\\</span><span class="st">hat{R}$&quot;</span>)</span>
<span id="cb311-29"><a href="stats_method.html#cb311-29" tabindex="-1"></a>    , <span class="at">subtitle =</span> latex2exp<span class="sc">::</span><span class="fu">TeX</span>(<span class="st">&quot;MCMC chain convergence check for $</span><span class="sc">\\</span><span class="st">hat{R}$ values&quot;</span>)</span>
<span id="cb311-30"><a href="stats_method.html#cb311-30" tabindex="-1"></a>    , <span class="at">title =</span> <span class="st">&quot;F-Score&quot;</span></span>
<span id="cb311-31"><a href="stats_method.html#cb311-31" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb311-32"><a href="stats_method.html#cb311-32" tabindex="-1"></a>  <span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb311-33"><a href="stats_method.html#cb311-33" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb311-34"><a href="stats_method.html#cb311-34" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb311-35"><a href="stats_method.html#cb311-35" tabindex="-1"></a>    , <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">4</span>)</span>
<span id="cb311-36"><a href="stats_method.html#cb311-36" tabindex="-1"></a>    , <span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>()</span>
<span id="cb311-37"><a href="stats_method.html#cb311-37" tabindex="-1"></a>    , <span class="at">panel.grid.minor.x =</span> <span class="fu">element_blank</span>()</span>
<span id="cb311-38"><a href="stats_method.html#cb311-38" tabindex="-1"></a>    , <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>)</span>
<span id="cb311-39"><a href="stats_method.html#cb311-39" tabindex="-1"></a>    , <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">9</span>)</span>
<span id="cb311-40"><a href="stats_method.html#cb311-40" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-290-1.png" width="1008" /></p>
<p>The effective length of an MCMC chain is indicated by the effective sample size (ESS), which refers to the sample size of the MCMC chain <strong>not</strong> to the sample size of the data where acceptable values allow “for reasonably accurate and stable estimates of the limits of the 95% HDI…If accuracy of the HDI limits is not crucial for your application, then a smaller ESS may be sufficient” <a href="https://sites.google.com/site/doingbayesiandataanalysis/">(Kruschke 2015, p. 184)</a></p>
<p>Ratios of effective sample size (ESS) to total sample size with values are colored using different shades (lighter is better). A ratio close to “1” (no autocorrelation) is ideal, while a low ratio suggests the need for more samples or model re-parameterization. Efficiently mixing MCMC chains are important because they guarantee the resulting posterior samples accurately represent the true distribution of model parameters, which is necessary for reliable and precise estimation of parameter values and their associated uncertainties (credible intervals). The chosen thresholds are somewhat arbitrary, but can be useful guidelines in practice (<a href="https://mc-stan.org/bayesplot/reference/MCMC-diagnostics.html">Gabry and Mahr 2025</a>):</p>
<ul>
<li>light: between 0.5 and 1 (high)</li>
<li>mid: between 0.1 and 0.5 (good)</li>
<li>dark: below 0.1 (low)</li>
</ul>
<div class="sourceCode" id="cb312"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb312-1"><a href="stats_method.html#cb312-1" tabindex="-1"></a><span class="co"># and another effective sample size check</span></span>
<span id="cb312-2"><a href="stats_method.html#cb312-2" tabindex="-1"></a>brms<span class="sc">::</span><span class="fu">mcmc_plot</span>(brms_f_score_mod, <span class="at">type =</span> <span class="st">&quot;neff_hist&quot;</span>) <span class="sc">+</span></span>
<span id="cb312-3"><a href="stats_method.html#cb312-3" tabindex="-1"></a><span class="co"># brms::mcmc_plot(brms_f_score_mod, type = &quot;neff&quot;) +</span></span>
<span id="cb312-4"><a href="stats_method.html#cb312-4" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="cn">NA</span>), <span class="at">breaks =</span> scales<span class="sc">::</span><span class="fu">breaks_extended</span>(<span class="at">n =</span> <span class="dv">9</span>)) <span class="sc">+</span></span>
<span id="cb312-5"><a href="stats_method.html#cb312-5" tabindex="-1"></a>  <span class="co"># ggplot2::scale_color_discrete(drop = F) +</span></span>
<span id="cb312-6"><a href="stats_method.html#cb312-6" tabindex="-1"></a>  <span class="co"># ggplot2::scale_fill_discrete(drop = F) +</span></span>
<span id="cb312-7"><a href="stats_method.html#cb312-7" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb312-8"><a href="stats_method.html#cb312-8" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb312-9"><a href="stats_method.html#cb312-9" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;top&quot;</span>, <span class="at">legend.direction =</span> <span class="st">&quot;horizontal&quot;</span></span>
<span id="cb312-10"><a href="stats_method.html#cb312-10" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-291-1.png" width="1008" /></p>
<p>our observed range of ESS to Total Sample Size ratios (~0.2 to ~0.8) are generally considered good to excellent, indicating the MCMC chains are performing well and mixing efficiently</p>
<p>Posterior predictive checks were used to evaluate model goodness-of-fit by comparing data simulated from the model with the observed data used to estimate the model parameters (<a href="https://scholar.google.com/scholar?cluster=9228589188684720156&amp;hl=en&amp;as_sdt=0,6">Hobbs &amp; Hooten, 2015</a>). Calculating the proportion of MCMC iterations in which the test statistic (i.e., mean and sum of squares) from the simulated data and observed data are more extreme than one another provides the Bayesian p-value. Lack of fit is indicated by a value close to 0 or 1 while a value of 0.5 indicates perfect fit (<a href="https://scholar.google.com/scholar?cluster=9228589188684720156&amp;hl=en&amp;as_sdt=0,6">Hobbs &amp; Hooten, 2015</a>).</p>
<p>To learn more about this approach to posterior predictive checks, check out Gabry’s (2025) vignette, <a href="https://cran.r-project.org/web/packages/bayesplot/vignettes/graphical-ppcs.html">Graphical posterior predictive checks using the bayesplot package</a>.</p>
<p>posterior-predictive check to make sure the model does an okay job simulating data that resemble the sample data. our objective is to construct the model such that it faithfully represents the data.</p>
<div class="sourceCode" id="cb313"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb313-1"><a href="stats_method.html#cb313-1" tabindex="-1"></a><span class="co"># posterior predictive check</span></span>
<span id="cb313-2"><a href="stats_method.html#cb313-2" tabindex="-1"></a>brms<span class="sc">::</span><span class="fu">pp_check</span>(</span>
<span id="cb313-3"><a href="stats_method.html#cb313-3" tabindex="-1"></a>    brms_f_score_mod</span>
<span id="cb313-4"><a href="stats_method.html#cb313-4" tabindex="-1"></a>    , <span class="at">type =</span> <span class="st">&quot;dens_overlay&quot;</span></span>
<span id="cb313-5"><a href="stats_method.html#cb313-5" tabindex="-1"></a>    , <span class="at">ndraws =</span> <span class="dv">100</span></span>
<span id="cb313-6"><a href="stats_method.html#cb313-6" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb313-7"><a href="stats_method.html#cb313-7" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;posterior-predictive check (overlaid densities)&quot;</span>) <span class="sc">+</span></span>
<span id="cb313-8"><a href="stats_method.html#cb313-8" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb313-9"><a href="stats_method.html#cb313-9" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb313-10"><a href="stats_method.html#cb313-10" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb313-11"><a href="stats_method.html#cb313-11" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;top&quot;</span>, <span class="at">legend.direction =</span> <span class="st">&quot;horizontal&quot;</span></span>
<span id="cb313-12"><a href="stats_method.html#cb313-12" tabindex="-1"></a>    , <span class="at">legend.text =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>)</span>
<span id="cb313-13"><a href="stats_method.html#cb313-13" tabindex="-1"></a>    , <span class="at">plot.subtitle =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>)</span>
<span id="cb313-14"><a href="stats_method.html#cb313-14" tabindex="-1"></a>    , <span class="at">plot.title =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">9</span>)</span>
<span id="cb313-15"><a href="stats_method.html#cb313-15" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-293-1.png" width="1008" /></p>
<p>another way</p>
<div class="sourceCode" id="cb314"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb314-1"><a href="stats_method.html#cb314-1" tabindex="-1"></a>brms<span class="sc">::</span><span class="fu">pp_check</span>(brms_f_score_mod, <span class="at">type =</span> <span class="st">&quot;ecdf_overlay&quot;</span>, <span class="at">ndraws =</span> <span class="dv">100</span>) <span class="sc">+</span></span>
<span id="cb314-2"><a href="stats_method.html#cb314-2" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;posterior-predictive check (ECDF: empirical cumulative distribution function)&quot;</span>) <span class="sc">+</span> </span>
<span id="cb314-3"><a href="stats_method.html#cb314-3" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb314-4"><a href="stats_method.html#cb314-4" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb314-5"><a href="stats_method.html#cb314-5" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;top&quot;</span>, <span class="at">legend.direction =</span> <span class="st">&quot;horizontal&quot;</span></span>
<span id="cb314-6"><a href="stats_method.html#cb314-6" tabindex="-1"></a>    , <span class="at">legend.text =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>)</span>
<span id="cb314-7"><a href="stats_method.html#cb314-7" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-294-1.png" width="1008" /></p>
</div>
<div id="conditional-effects" class="section level3 hasAnchor" number="9.1.4">
<h3><span class="header-section-number">9.1.4</span> Conditional Effects<a href="stats_method.html#conditional-effects" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>first, lets look at densities of the posterior samples per parameter</p>
<div class="sourceCode" id="cb315"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb315-1"><a href="stats_method.html#cb315-1" tabindex="-1"></a>brms<span class="sc">::</span><span class="fu">mcmc_plot</span>(brms_f_score_mod, <span class="at">type =</span> <span class="st">&quot;dens&quot;</span>) <span class="sc">+</span></span>
<span id="cb315-2"><a href="stats_method.html#cb315-2" tabindex="-1"></a>  <span class="co"># ggplot2::theme_light() +</span></span>
<span id="cb315-3"><a href="stats_method.html#cb315-3" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb315-4"><a href="stats_method.html#cb315-4" tabindex="-1"></a>    <span class="at">strip.text =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="fl">7.5</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>)</span>
<span id="cb315-5"><a href="stats_method.html#cb315-5" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-296-1.png" width="1008" /></p>
<p>and we can look at the default coefficient plot that is commonly used in reporting coefficient “significance” in frequentist analysis</p>
<div class="sourceCode" id="cb316"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb316-1"><a href="stats_method.html#cb316-1" tabindex="-1"></a><span class="co"># easy way to get the default coeff plot</span></span>
<span id="cb316-2"><a href="stats_method.html#cb316-2" tabindex="-1"></a>brms<span class="sc">::</span><span class="fu">mcmc_plot</span>(brms_f_score_mod, <span class="at">type =</span> <span class="st">&quot;intervals&quot;</span>)</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-297-1.png" width="1008" /></p>
<p>Regarding interactions and polynomial models like this, <a href="https://xcelab.net/rm/">McElreath (2015)</a> notes:</p>
<blockquote>
<p>parameters are the linear and square components of the curve, respectively. But that doesn’t make them transparent. You have to plot these model fits to understand what they are saying. (p. 112-113)</p>
</blockquote>
<p>all of the interactions and the quadradic trend of this model combine to make these coefficients by themselves uninterpretable as the coefficients are only meaningful in the context of the other terms in the interaction or by adding the quadratic component</p>
<p>we can do this by checking for the main effects of the individual variables on F-score (averages across all other effects)</p>
<div class="sourceCode" id="cb317"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb317-1"><a href="stats_method.html#cb317-1" tabindex="-1"></a>brms<span class="sc">::</span><span class="fu">conditional_effects</span>(brms_f_score_mod)</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-299-1.png" width="1008" /><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-299-2.png" width="1008" /><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-299-3.png" width="1008" /><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-299-4.png" width="1008" /><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-299-5.png" width="1008" /><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-299-6.png" width="1008" /><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-299-7.png" width="1008" /><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-299-8.png" width="1008" /><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-299-9.png" width="1008" /><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-299-10.png" width="1008" /></p>
<div class="sourceCode" id="cb318"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb318-1"><a href="stats_method.html#cb318-1" tabindex="-1"></a><span class="do">### ggplot version</span></span>
<span id="cb318-2"><a href="stats_method.html#cb318-2" tabindex="-1"></a><span class="co"># brms::conditional_effects(brms_f_score_mod) %&gt;% </span></span>
<span id="cb318-3"><a href="stats_method.html#cb318-3" tabindex="-1"></a><span class="co">#   purrr::pluck(&quot;max_ht_m&quot;) %&gt;% </span></span>
<span id="cb318-4"><a href="stats_method.html#cb318-4" tabindex="-1"></a><span class="co">#   ggplot(aes(x = max_ht_m)) +</span></span>
<span id="cb318-5"><a href="stats_method.html#cb318-5" tabindex="-1"></a><span class="co">#   geom_ribbon(aes(ymin = lower__, ymax = upper__), fill = &quot;blue&quot;, alpha = 0.2) +</span></span>
<span id="cb318-6"><a href="stats_method.html#cb318-6" tabindex="-1"></a><span class="co">#   geom_line(aes(y = estimate__), color = &quot;blue&quot;) +</span></span>
<span id="cb318-7"><a href="stats_method.html#cb318-7" tabindex="-1"></a><span class="co">#   labs(</span></span>
<span id="cb318-8"><a href="stats_method.html#cb318-8" tabindex="-1"></a><span class="co">#     x = &quot;max_ht_m&quot;,</span></span>
<span id="cb318-9"><a href="stats_method.html#cb318-9" tabindex="-1"></a><span class="co">#     y = &quot;F-score&quot;,</span></span>
<span id="cb318-10"><a href="stats_method.html#cb318-10" tabindex="-1"></a><span class="co">#     title = &quot;Conditional Effects&quot;</span></span>
<span id="cb318-11"><a href="stats_method.html#cb318-11" tabindex="-1"></a><span class="co">#   )</span></span></code></pre></div>
</div>
<div id="f_score_epred" class="section level3 hasAnchor" number="9.1.5">
<h3><span class="header-section-number">9.1.5</span> Posterior Predictive Expectation<a href="stats_method.html#f_score_epred" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>we will test our hypotheses using the posterior distributions of the expected values (i.e., the posterior predictions of the mean) obtained via <code>tidybayes::add_epred_draws()</code>. our analysis will include two stages using parameter levels of the four structural parameters: <code>max_ht_m</code>, <code>max_area_m2</code>, <code>convexity_pct</code>, <code>circle_fit_iou_pct</code>. in practice, these values should be informed by the treatment and slash pile construction prescription implemented on the ground.</p>
<p>In the first stage, we will fix the <code>max_ht_m</code> and <code>max_area_m2</code> parameters at levels expected based on the treatment and slash pile construction prescription implemented on the ground. We will then explore the influence of the two geometric shape filtering parameters (<code>circle_fit_iou_pct</code> and <code>convexity_pct</code>) over different levels of the <code>spectral_weight</code> parameter and CHM resolution data.</p>
<p>In the second stage, we will fix all four structural parameters (<code>max_ht_m</code>, <code>max_area_m2</code>, <code>convexity_pct</code>, <code>circle_fit_iou_pct</code>) to explore the influence of the input data, which includes the presence or absence of spectral data and its weighting (i.e. <code>spectral_weight</code>) as well as the CHM resolution (<code>chm_res_m</code>). As in the first stage, the <code>max_ht_m</code>, <code>max_area_m2</code> parameters will be fixed at expected levels based on the slash pile construction prescription while the <code>convexity_pct</code>, <code>circle_fit_iou_pct</code> will be fixed at the optimal levels determined based on the Bayesian posterior predictive distribution of <a href="stats_method.html#f_score_epred">detection accuracy</a></p>
<div class="sourceCode" id="cb319"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb319-1"><a href="stats_method.html#cb319-1" tabindex="-1"></a><span class="co"># let&#39;s fix the structural parameters based on expectations from the prescription</span></span>
<span id="cb319-2"><a href="stats_method.html#cb319-2" tabindex="-1"></a>structural_params_settings <span class="ot">&lt;-</span> </span>
<span id="cb319-3"><a href="stats_method.html#cb319-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">tibble</span>(</span>
<span id="cb319-4"><a href="stats_method.html#cb319-4" tabindex="-1"></a>    <span class="at">max_ht_m =</span> <span class="fl">2.3</span></span>
<span id="cb319-5"><a href="stats_method.html#cb319-5" tabindex="-1"></a>    , <span class="at">max_area_m2 =</span> <span class="dv">46</span></span>
<span id="cb319-6"><a href="stats_method.html#cb319-6" tabindex="-1"></a>  )</span>
<span id="cb319-7"><a href="stats_method.html#cb319-7" tabindex="-1"></a>  <span class="co"># dplyr::bind_rows(</span></span>
<span id="cb319-8"><a href="stats_method.html#cb319-8" tabindex="-1"></a>  <span class="co">#   # structural only</span></span>
<span id="cb319-9"><a href="stats_method.html#cb319-9" tabindex="-1"></a>  <span class="co">#   param_combos_ranked %&gt;% dplyr::filter(is_top_overall) %&gt;% dplyr::select(max_ht_m,max_area_m2,convexity_pct,circle_fit_iou_pct) </span></span>
<span id="cb319-10"><a href="stats_method.html#cb319-10" tabindex="-1"></a>  <span class="co">#   # fusion</span></span>
<span id="cb319-11"><a href="stats_method.html#cb319-11" tabindex="-1"></a>  <span class="co">#   , param_combos_spectral_ranked %&gt;% </span></span>
<span id="cb319-12"><a href="stats_method.html#cb319-12" tabindex="-1"></a>  <span class="co">#     dplyr::ungroup() %&gt;% </span></span>
<span id="cb319-13"><a href="stats_method.html#cb319-13" tabindex="-1"></a>  <span class="co">#     dplyr::filter(is_top_overall &amp; spectral_weight!=0) %&gt;% </span></span>
<span id="cb319-14"><a href="stats_method.html#cb319-14" tabindex="-1"></a>  <span class="co">#     dplyr::arrange(ovrall_balanced_rank) %&gt;% # same number of records as structural only</span></span>
<span id="cb319-15"><a href="stats_method.html#cb319-15" tabindex="-1"></a>  <span class="co">#     dplyr::filter(dplyr::row_number()&lt;=sum(param_combos_ranked$is_top_overall)) %&gt;% </span></span>
<span id="cb319-16"><a href="stats_method.html#cb319-16" tabindex="-1"></a>  <span class="co">#     dplyr::select(max_ht_m,max_area_m2,convexity_pct,circle_fit_iou_pct)</span></span>
<span id="cb319-17"><a href="stats_method.html#cb319-17" tabindex="-1"></a>  <span class="co"># ) %&gt;% </span></span>
<span id="cb319-18"><a href="stats_method.html#cb319-18" tabindex="-1"></a>  <span class="co">#   tidyr::pivot_longer(</span></span>
<span id="cb319-19"><a href="stats_method.html#cb319-19" tabindex="-1"></a>  <span class="co">#     cols = dplyr::everything()</span></span>
<span id="cb319-20"><a href="stats_method.html#cb319-20" tabindex="-1"></a>  <span class="co">#     , names_to = &quot;metric&quot;</span></span>
<span id="cb319-21"><a href="stats_method.html#cb319-21" tabindex="-1"></a>  <span class="co">#     , values_to = &quot;value&quot;</span></span>
<span id="cb319-22"><a href="stats_method.html#cb319-22" tabindex="-1"></a>  <span class="co">#   ) %&gt;% </span></span>
<span id="cb319-23"><a href="stats_method.html#cb319-23" tabindex="-1"></a>  <span class="co">#   dplyr::count(metric, value) %&gt;% </span></span>
<span id="cb319-24"><a href="stats_method.html#cb319-24" tabindex="-1"></a>  <span class="co">#   dplyr::group_by(metric) %&gt;% </span></span>
<span id="cb319-25"><a href="stats_method.html#cb319-25" tabindex="-1"></a>  <span class="co">#   dplyr::arrange(metric,desc(n),value) %&gt;% </span></span>
<span id="cb319-26"><a href="stats_method.html#cb319-26" tabindex="-1"></a>  <span class="co">#   dplyr::slice(1) %&gt;% </span></span>
<span id="cb319-27"><a href="stats_method.html#cb319-27" tabindex="-1"></a>  <span class="co">#   dplyr::select(-n) %&gt;% </span></span>
<span id="cb319-28"><a href="stats_method.html#cb319-28" tabindex="-1"></a>  <span class="co">#   tidyr::pivot_wider(names_from = metric, values_from = value) %&gt;% </span></span>
<span id="cb319-29"><a href="stats_method.html#cb319-29" tabindex="-1"></a>  <span class="co">#   dplyr::mutate(is_top_overall = T) %&gt;% </span></span>
<span id="cb319-30"><a href="stats_method.html#cb319-30" tabindex="-1"></a>  <span class="co"># # we just need `max_ht_m`, `max_area_m2`</span></span>
<span id="cb319-31"><a href="stats_method.html#cb319-31" tabindex="-1"></a>  <span class="co"># dplyr::select(max_ht_m, max_area_m2)</span></span>
<span id="cb319-32"><a href="stats_method.html#cb319-32" tabindex="-1"></a>  </span>
<span id="cb319-33"><a href="stats_method.html#cb319-33" tabindex="-1"></a><span class="co"># huh?</span></span>
<span id="cb319-34"><a href="stats_method.html#cb319-34" tabindex="-1"></a>structural_params_settings <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">glimpse</span>()</span></code></pre></div>
<pre><code>## Rows: 1
## Columns: 2
## $ max_ht_m    &lt;dbl&gt; 2.3
## $ max_area_m2 &lt;dbl&gt; 46</code></pre>
<p>now we’ll get the posterior predictive draws but over a range of <code>circle_fit_iou_pct</code> and <code>convexity_pct</code> including the best setting</p>
<div class="sourceCode" id="cb321"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb321-1"><a href="stats_method.html#cb321-1" tabindex="-1"></a>seq_temp <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fl">0.05</span>, <span class="at">to =</span> <span class="fl">1.0</span>, <span class="at">by =</span> <span class="fl">0.1</span>)</span>
<span id="cb321-2"><a href="stats_method.html#cb321-2" tabindex="-1"></a>seq2_temp <span class="ot">&lt;-</span> seq_temp[<span class="fu">seq</span>(<span class="dv">1</span>, <span class="fu">length</span>(seq_temp), <span class="at">by =</span> <span class="dv">2</span>)] <span class="co"># get every other element</span></span>
<span id="cb321-3"><a href="stats_method.html#cb321-3" tabindex="-1"></a><span class="co"># draws</span></span>
<span id="cb321-4"><a href="stats_method.html#cb321-4" tabindex="-1"></a>draws_temp <span class="ot">&lt;-</span> </span>
<span id="cb321-5"><a href="stats_method.html#cb321-5" tabindex="-1"></a>  <span class="co"># get the draws for levels of </span></span>
<span id="cb321-6"><a href="stats_method.html#cb321-6" tabindex="-1"></a>  <span class="co"># spectral_weight circle_fit_iou_pct convexity_pct</span></span>
<span id="cb321-7"><a href="stats_method.html#cb321-7" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">crossing</span>(</span>
<span id="cb321-8"><a href="stats_method.html#cb321-8" tabindex="-1"></a>    param_combos_spectral_ranked <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">distinct</span>(spectral_weight)</span>
<span id="cb321-9"><a href="stats_method.html#cb321-9" tabindex="-1"></a>    , <span class="at">circle_fit_iou_pct =</span> seq_temp</span>
<span id="cb321-10"><a href="stats_method.html#cb321-10" tabindex="-1"></a>    , <span class="at">convexity_pct =</span> seq_temp</span>
<span id="cb321-11"><a href="stats_method.html#cb321-11" tabindex="-1"></a>    , <span class="at">chm_res_m =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fl">0.1</span>, <span class="at">to =</span> <span class="fl">1.0</span>, <span class="at">by =</span> <span class="fl">0.1</span>)</span>
<span id="cb321-12"><a href="stats_method.html#cb321-12" tabindex="-1"></a>    , <span class="at">max_ht_m =</span> structural_params_settings<span class="sc">$</span>max_ht_m</span>
<span id="cb321-13"><a href="stats_method.html#cb321-13" tabindex="-1"></a>    , <span class="at">max_area_m2 =</span> structural_params_settings<span class="sc">$</span>max_area_m2</span>
<span id="cb321-14"><a href="stats_method.html#cb321-14" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb321-15"><a href="stats_method.html#cb321-15" tabindex="-1"></a>  <span class="co"># dplyr::glimpse()</span></span>
<span id="cb321-16"><a href="stats_method.html#cb321-16" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">add_epred_draws</span>(brms_f_score_mod, <span class="at">ndraws =</span> <span class="dv">1111</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb321-17"><a href="stats_method.html#cb321-17" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">value =</span> .epred) <span class="sc">%&gt;%</span> </span>
<span id="cb321-18"><a href="stats_method.html#cb321-18" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb321-19"><a href="stats_method.html#cb321-19" tabindex="-1"></a>    <span class="at">is_seq =</span> (convexity_pct <span class="sc">%in%</span> seq_temp) <span class="sc">&amp;</span> (circle_fit_iou_pct <span class="sc">%in%</span> seq_temp)</span>
<span id="cb321-20"><a href="stats_method.html#cb321-20" tabindex="-1"></a>  )</span>
<span id="cb321-21"><a href="stats_method.html#cb321-21" tabindex="-1"></a><span class="co"># # huh?</span></span>
<span id="cb321-22"><a href="stats_method.html#cb321-22" tabindex="-1"></a>draws_temp <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">glimpse</span>()</span></code></pre></div>
<pre><code>## Rows: 6,666,000
## Columns: 12
## Groups: spectral_weight, circle_fit_iou_pct, convexity_pct, chm_res_m, max_ht_m, max_area_m2, .row [6,000]
## $ spectral_weight    &lt;fct&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, …
## $ circle_fit_iou_pct &lt;dbl&gt; 0.05, 0.05, 0.05, 0.05, 0.05, 0.05, 0.05, 0.05, 0.0…
## $ convexity_pct      &lt;dbl&gt; 0.05, 0.05, 0.05, 0.05, 0.05, 0.05, 0.05, 0.05, 0.0…
## $ chm_res_m          &lt;dbl&gt; 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0…
## $ max_ht_m           &lt;dbl&gt; 2.3, 2.3, 2.3, 2.3, 2.3, 2.3, 2.3, 2.3, 2.3, 2.3, 2…
## $ max_area_m2        &lt;dbl&gt; 46, 46, 46, 46, 46, 46, 46, 46, 46, 46, 46, 46, 46,…
## $ .row               &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, …
## $ .chain             &lt;int&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
## $ .iteration         &lt;int&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
## $ .draw              &lt;int&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, …
## $ value              &lt;dbl&gt; 0.6778712, 0.6924090, 0.6793626, 0.6784690, 0.69338…
## $ is_seq             &lt;lgl&gt; TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRU…</code></pre>
<div id="geometric-shape-regularity" class="section level4 hasAnchor" number="9.1.5.1">
<h4><span class="header-section-number">9.1.5.1</span> Geometric shape regularity<a href="stats_method.html#geometric-shape-regularity" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>let’s look at the influence of the parameters that control the geometric shape regularity filtering: <code>circle_fit_iou_pct</code> and <code>convexity_pct</code>. to do this, we will fix the <code>max_ht_m</code> and <code>max_area_m2</code> parameters at levels expected based on the treatment and slash pile construction prescription implemented on the ground.</p>
<p>In the first stage, we will fix the <code>max_ht_m</code> and <code>max_area_m2</code> parameters at levels expected based on the treatment and slash pile construction prescription implemented on the ground. We will then explore the influence of the two geometric shape filtering parameters (<code>circle_fit_iou_pct</code> and <code>convexity_pct</code>) over different levels of the <code>spectral_weight</code> parameter and CHM resolution data.</p>
<p>In the second stage, we will fix all four structural parameters (<code>max_ht_m</code>, <code>max_area_m2</code>, <code>convexity_pct</code>, <code>circle_fit_iou_pct</code>) to explore the influence of the input data, which includes the presence or absence of spectral data and its weighting (i.e. <code>spectral_weight</code>) as well as the CHM resolution (<code>chm_res_m</code>). As in the first stage, the <code>max_ht_m</code>, <code>max_area_m2</code> parameters will be fixed at expected levels based on the slash pile construction prescription while the <code>convexity_pct</code>, <code>circle_fit_iou_pct</code> will be fixed at the optimal levels determined based on the Bayesian posterior predictive distribution of <a href="stats_method.html#f_score_epred">detection accuracy</a></p>
<div id="circle_fit_iou_pct" class="section level5 hasAnchor" number="9.1.5.1.1">
<h5><span class="header-section-number">9.1.5.1.1</span> <code>circle_fit_iou_pct</code><a href="stats_method.html#circle_fit_iou_pct" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>we need to look at the influence of <code>circle_fit_iou_pct</code> in the context of the other terms in the interaction</p>
<div class="sourceCode" id="cb323"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb323-1"><a href="stats_method.html#cb323-1" tabindex="-1"></a>draws_temp <span class="sc">%&gt;%</span></span>
<span id="cb323-2"><a href="stats_method.html#cb323-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb323-3"><a href="stats_method.html#cb323-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(</span>
<span id="cb323-4"><a href="stats_method.html#cb323-4" tabindex="-1"></a>    is_seq</span>
<span id="cb323-5"><a href="stats_method.html#cb323-5" tabindex="-1"></a>    , chm_res_m <span class="sc">%in%</span> <span class="fu">seq</span>(<span class="fl">0.1</span>,<span class="fl">0.5</span>,<span class="at">by=</span><span class="fl">0.1</span>)</span>
<span id="cb323-6"><a href="stats_method.html#cb323-6" tabindex="-1"></a>    , convexity_pct <span class="sc">%in%</span> seq2_temp</span>
<span id="cb323-7"><a href="stats_method.html#cb323-7" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb323-8"><a href="stats_method.html#cb323-8" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">convexity_pct =</span> <span class="fu">factor</span>(convexity_pct, <span class="at">ordered =</span> T)) <span class="sc">%&gt;%</span> </span>
<span id="cb323-9"><a href="stats_method.html#cb323-9" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> circle_fit_iou_pct, <span class="at">y =</span> value, <span class="at">color =</span> convexity_pct)) <span class="sc">+</span></span>
<span id="cb323-10"><a href="stats_method.html#cb323-10" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">stat_lineribbon</span>(</span>
<span id="cb323-11"><a href="stats_method.html#cb323-11" tabindex="-1"></a>    <span class="at">point_interval =</span> <span class="st">&quot;median_hdi&quot;</span>, <span class="at">.width =</span> <span class="fu">c</span>(<span class="fl">0.95</span>)</span>
<span id="cb323-12"><a href="stats_method.html#cb323-12" tabindex="-1"></a>    , <span class="at">lwd =</span> <span class="fl">1.1</span>, <span class="at">fill =</span> <span class="cn">NA</span></span>
<span id="cb323-13"><a href="stats_method.html#cb323-13" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb323-14"><a href="stats_method.html#cb323-14" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">facet_grid</span>(<span class="at">cols =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(spectral_weight), <span class="at">rows =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(chm_res_m), <span class="at">labeller =</span> <span class="st">&quot;label_both&quot;</span>) <span class="sc">+</span></span>
<span id="cb323-15"><a href="stats_method.html#cb323-15" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_fill_brewer</span>(<span class="at">palette =</span> <span class="st">&quot;Greys&quot;</span>) <span class="sc">+</span></span>
<span id="cb323-16"><a href="stats_method.html#cb323-16" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_color_viridis_d</span>(<span class="at">option =</span> <span class="st">&quot;mako&quot;</span>, <span class="at">begin =</span> <span class="fl">0.6</span>, <span class="at">end =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb323-17"><a href="stats_method.html#cb323-17" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>percent) <span class="sc">+</span></span>
<span id="cb323-18"><a href="stats_method.html#cb323-18" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb323-19"><a href="stats_method.html#cb323-19" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;conditional effect of `circle_fit_iou_pct` on F-score&quot;</span></span>
<span id="cb323-20"><a href="stats_method.html#cb323-20" tabindex="-1"></a>    <span class="co"># , subtitle = &quot;Faceted by spectral_weight and chm_res_m&quot;</span></span>
<span id="cb323-21"><a href="stats_method.html#cb323-21" tabindex="-1"></a>    , <span class="at">x =</span> <span class="st">&quot;`circle_fit_iou_pct`&quot;</span></span>
<span id="cb323-22"><a href="stats_method.html#cb323-22" tabindex="-1"></a>    , <span class="at">y =</span> <span class="st">&quot;F-score&quot;</span></span>
<span id="cb323-23"><a href="stats_method.html#cb323-23" tabindex="-1"></a>    , <span class="at">color =</span> <span class="st">&quot;`convexity_pct`&quot;</span></span>
<span id="cb323-24"><a href="stats_method.html#cb323-24" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb323-25"><a href="stats_method.html#cb323-25" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb323-26"><a href="stats_method.html#cb323-26" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb323-27"><a href="stats_method.html#cb323-27" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;top&quot;</span></span>
<span id="cb323-28"><a href="stats_method.html#cb323-28" tabindex="-1"></a>    , <span class="at">strip.text.x =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb323-29"><a href="stats_method.html#cb323-29" tabindex="-1"></a>    , <span class="at">strip.text.y =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb323-30"><a href="stats_method.html#cb323-30" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb323-31"><a href="stats_method.html#cb323-31" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">guides</span>(</span>
<span id="cb323-32"><a href="stats_method.html#cb323-32" tabindex="-1"></a>    <span class="at">color =</span> ggplot2<span class="sc">::</span><span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">shape =</span> <span class="dv">15</span>, <span class="at">lwd =</span> <span class="dv">8</span>, <span class="at">fill =</span> <span class="cn">NA</span>))</span>
<span id="cb323-33"><a href="stats_method.html#cb323-33" tabindex="-1"></a>    , <span class="at">fill =</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb323-34"><a href="stats_method.html#cb323-34" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-305-1.png" width="1008" /></p>
<p>the non-linear relationship between the <code>circle_fit_iou_pct</code> parameter and the F-score is prominent, confirmed by the model’s quadratic coefficient. this trend is consistent across all levels of spectral_weight and CHM resolution. this figure also demonstrates how, within the optimal range of <code>circle_fit_iou_pct</code>, the intermediate values of the <code>convexity_pct</code> parameter seem to result in the best detection accuracy across CHM resolution levels. Across all CHM resolutions and spectral weighting levels, setting <code>circle_fit_iou_pct</code> too high (e.g &gt; 0.7) results in steep declines in detection accuracy.</p>
</div>
<div id="convexity_pct" class="section level5 hasAnchor" number="9.1.5.1.2">
<h5><span class="header-section-number">9.1.5.1.2</span> <code>convexity_pct</code><a href="stats_method.html#convexity_pct" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>we need to look at the influence of <code>convexity_pct</code> in the context of the other terms in the interaction</p>
<div class="sourceCode" id="cb324"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb324-1"><a href="stats_method.html#cb324-1" tabindex="-1"></a>draws_temp <span class="sc">%&gt;%</span></span>
<span id="cb324-2"><a href="stats_method.html#cb324-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb324-3"><a href="stats_method.html#cb324-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(</span>
<span id="cb324-4"><a href="stats_method.html#cb324-4" tabindex="-1"></a>    is_seq</span>
<span id="cb324-5"><a href="stats_method.html#cb324-5" tabindex="-1"></a>    , chm_res_m <span class="sc">%in%</span> <span class="fu">seq</span>(<span class="fl">0.1</span>,<span class="fl">0.5</span>,<span class="at">by=</span><span class="fl">0.1</span>)</span>
<span id="cb324-6"><a href="stats_method.html#cb324-6" tabindex="-1"></a>    , circle_fit_iou_pct <span class="sc">%in%</span> seq2_temp</span>
<span id="cb324-7"><a href="stats_method.html#cb324-7" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb324-8"><a href="stats_method.html#cb324-8" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">circle_fit_iou_pct =</span> <span class="fu">factor</span>(circle_fit_iou_pct, <span class="at">ordered =</span> T)) <span class="sc">%&gt;%</span> </span>
<span id="cb324-9"><a href="stats_method.html#cb324-9" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> convexity_pct, <span class="at">y =</span> value, <span class="at">color =</span> circle_fit_iou_pct)) <span class="sc">+</span></span>
<span id="cb324-10"><a href="stats_method.html#cb324-10" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">stat_lineribbon</span>(</span>
<span id="cb324-11"><a href="stats_method.html#cb324-11" tabindex="-1"></a>    <span class="at">point_interval =</span> <span class="st">&quot;median_hdi&quot;</span>, <span class="at">.width =</span> <span class="fu">c</span>(<span class="fl">0.5</span>,<span class="fl">0.95</span>)</span>
<span id="cb324-12"><a href="stats_method.html#cb324-12" tabindex="-1"></a>    , <span class="at">lwd =</span> <span class="fl">1.1</span></span>
<span id="cb324-13"><a href="stats_method.html#cb324-13" tabindex="-1"></a>    , <span class="at">fill =</span> <span class="cn">NA</span></span>
<span id="cb324-14"><a href="stats_method.html#cb324-14" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb324-15"><a href="stats_method.html#cb324-15" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">facet_grid</span>(<span class="at">cols =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(spectral_weight), <span class="at">rows =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(chm_res_m), <span class="at">labeller =</span> <span class="st">&quot;label_both&quot;</span>) <span class="sc">+</span></span>
<span id="cb324-16"><a href="stats_method.html#cb324-16" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_fill_brewer</span>(<span class="at">palette =</span> <span class="st">&quot;Greys&quot;</span>) <span class="sc">+</span></span>
<span id="cb324-17"><a href="stats_method.html#cb324-17" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_color_viridis_d</span>(<span class="at">option =</span> <span class="st">&quot;magma&quot;</span>, <span class="at">begin =</span> <span class="fl">0.5</span>, <span class="at">end =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb324-18"><a href="stats_method.html#cb324-18" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>percent) <span class="sc">+</span></span>
<span id="cb324-19"><a href="stats_method.html#cb324-19" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb324-20"><a href="stats_method.html#cb324-20" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;conditional effect of `convexity_pct` on F-score&quot;</span></span>
<span id="cb324-21"><a href="stats_method.html#cb324-21" tabindex="-1"></a>    <span class="co"># , subtitle = &quot;Faceted by spectral_weight and chm_res_m&quot;</span></span>
<span id="cb324-22"><a href="stats_method.html#cb324-22" tabindex="-1"></a>    , <span class="at">x =</span> <span class="st">&quot;`convexity_pct`&quot;</span></span>
<span id="cb324-23"><a href="stats_method.html#cb324-23" tabindex="-1"></a>    , <span class="at">y =</span> <span class="st">&quot;F-score&quot;</span></span>
<span id="cb324-24"><a href="stats_method.html#cb324-24" tabindex="-1"></a>    , <span class="at">color =</span> <span class="st">&quot;`circle_fit_iou_pct`&quot;</span></span>
<span id="cb324-25"><a href="stats_method.html#cb324-25" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb324-26"><a href="stats_method.html#cb324-26" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb324-27"><a href="stats_method.html#cb324-27" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb324-28"><a href="stats_method.html#cb324-28" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;top&quot;</span></span>
<span id="cb324-29"><a href="stats_method.html#cb324-29" tabindex="-1"></a>    , <span class="at">strip.text.x =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb324-30"><a href="stats_method.html#cb324-30" tabindex="-1"></a>    , <span class="at">strip.text.y =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb324-31"><a href="stats_method.html#cb324-31" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb324-32"><a href="stats_method.html#cb324-32" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">guides</span>(</span>
<span id="cb324-33"><a href="stats_method.html#cb324-33" tabindex="-1"></a>    <span class="at">color =</span> ggplot2<span class="sc">::</span><span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">shape =</span> <span class="dv">15</span>, <span class="at">lwd =</span> <span class="dv">8</span>, <span class="at">fill =</span> <span class="cn">NA</span>))</span>
<span id="cb324-34"><a href="stats_method.html#cb324-34" tabindex="-1"></a>    , <span class="at">fill =</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb324-35"><a href="stats_method.html#cb324-35" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-306-1.png" width="1008" /></p>
<p>As expected, the model shows that the influence of the <code>convexity_pct</code> parameter on the F-score is conditional on the <code>circle_fit_iou_pct</code> setting. When <code>circle_fit_iou_pct</code> is set too high (requiring nearly perfectly circular pile perimeters), <code>convexity_pct</code> has a minimal impact on the F-score. When <code>circle_fit_iou_pct</code> is set to an optimal value near its vertex (e.g., ~0.25-0.55), the range of <code>convexity_pct</code> values below 0.5 result in the best pile detection for finer resolution CHM data (e.g. &lt; 0.3 m) but for coarser resolution CHM data the optimal <code>convexity_pct</code> setting increases to ~0.37-0.62. Across all CHM resolutions and spectral weighting levels, setting <code>convexity_pct</code> too high (e.g &gt; 0.7) results in steep declines in detection accuracy.</p>
</div>
<div id="optimizing-geometric-filtering" class="section level5 hasAnchor" number="9.1.5.1.3">
<h5><span class="header-section-number">9.1.5.1.3</span> Optimizing geometric filtering<a href="stats_method.html#optimizing-geometric-filtering" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>Given the complexity of our model, which includes a non-linear link function and parameter interactions, calculating the optimal parameter values by solving for them algebraically from the model’s coefficients would be prone to error. instead, we can use a robust Bayesian approach that leverages the model’s posterior predictive distribution. This method is powerful because it inherently accounts for all sources of model uncertainty.</p>
<p>first, we’ll generate a large number of predictions across a fine grid of parameter values (e.g. in steps of 0.01) for each posterior draw of the model coefficients. we’ll generate a large number (e.g. 1000+) of posterior predictive draws for each combination of parameter values. for each posterior predictive draw, we’ll then identify the parameter combination that maximizes the F-score and we’ll be left with a posterior distribution of optimal parameter combinations.</p>
<p>this approach demonstrates a key advantage of the Bayesian framework, allowing us to ask complex questions and find the most probable optimal parameter combination while fully accounting for uncertainty.</p>
<div class="sourceCode" id="cb325"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb325-1"><a href="stats_method.html#cb325-1" tabindex="-1"></a><span class="co"># let&#39;s get the draws at a very granular level</span></span>
<span id="cb325-2"><a href="stats_method.html#cb325-2" tabindex="-1"></a>vertex_draws_temp <span class="ot">&lt;-</span> </span>
<span id="cb325-3"><a href="stats_method.html#cb325-3" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">crossing</span>(</span>
<span id="cb325-4"><a href="stats_method.html#cb325-4" tabindex="-1"></a>    param_combos_spectral_ranked <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">distinct</span>(spectral_weight, spectral_weight_fact)</span>
<span id="cb325-5"><a href="stats_method.html#cb325-5" tabindex="-1"></a>    , <span class="at">circle_fit_iou_pct =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fl">0.0</span>, <span class="at">to =</span> <span class="dv">1</span>, <span class="at">by =</span> <span class="fl">0.01</span>) <span class="co"># very granular to identify vertex</span></span>
<span id="cb325-6"><a href="stats_method.html#cb325-6" tabindex="-1"></a>    , <span class="at">convexity_pct =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fl">0.0</span>, <span class="at">to =</span> <span class="dv">1</span>, <span class="at">by =</span> <span class="fl">0.01</span>) <span class="co"># very granular to identify vertex</span></span>
<span id="cb325-7"><a href="stats_method.html#cb325-7" tabindex="-1"></a>    , <span class="at">chm_res_m =</span> <span class="fu">seq</span>(<span class="fl">0.1</span>,<span class="fl">0.5</span>,<span class="at">by=</span><span class="fl">0.1</span>)</span>
<span id="cb325-8"><a href="stats_method.html#cb325-8" tabindex="-1"></a>    , <span class="at">max_ht_m =</span> structural_params_settings<span class="sc">$</span>max_ht_m</span>
<span id="cb325-9"><a href="stats_method.html#cb325-9" tabindex="-1"></a>    , <span class="at">max_area_m2 =</span> structural_params_settings<span class="sc">$</span>max_area_m2</span>
<span id="cb325-10"><a href="stats_method.html#cb325-10" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb325-11"><a href="stats_method.html#cb325-11" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">add_epred_draws</span>(brms_f_score_mod, <span class="at">ndraws =</span> <span class="dv">1000</span>, <span class="at">value =</span> <span class="st">&quot;value&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb325-12"><a href="stats_method.html#cb325-12" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb325-13"><a href="stats_method.html#cb325-13" tabindex="-1"></a>  <span class="co"># for each draw, get the highest f-score by chm_res_m, spectral_weight</span></span>
<span id="cb325-14"><a href="stats_method.html#cb325-14" tabindex="-1"></a>  <span class="co"># which we&#39;ll use to identify the optimal circle_fit_iou_pct,convexity_pct settings</span></span>
<span id="cb325-15"><a href="stats_method.html#cb325-15" tabindex="-1"></a>  <span class="co"># these are essentially &quot;votes&quot; based on likelihood</span></span>
<span id="cb325-16"><a href="stats_method.html#cb325-16" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(</span>
<span id="cb325-17"><a href="stats_method.html#cb325-17" tabindex="-1"></a>    .draw</span>
<span id="cb325-18"><a href="stats_method.html#cb325-18" tabindex="-1"></a>    , chm_res_m, spectral_weight</span>
<span id="cb325-19"><a href="stats_method.html#cb325-19" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb325-20"><a href="stats_method.html#cb325-20" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(<span class="fu">desc</span>(value),circle_fit_iou_pct,convexity_pct) <span class="sc">%&gt;%</span> </span>
<span id="cb325-21"><a href="stats_method.html#cb325-21" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">slice</span>(<span class="dv">1</span>)</span>
<span id="cb325-22"><a href="stats_method.html#cb325-22" tabindex="-1"></a><span class="co"># vertex_draws_temp %&gt;% dplyr::glimpse() # this thing is huge</span></span></code></pre></div>
<p>plot the posterior distribution of optimal parameter setting for <code>circle_fit_iou_pct</code></p>
<div class="sourceCode" id="cb326"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb326-1"><a href="stats_method.html#cb326-1" tabindex="-1"></a>vertex_draws_temp <span class="sc">%&gt;%</span></span>
<span id="cb326-2"><a href="stats_method.html#cb326-2" tabindex="-1"></a>  <span class="co"># dplyr::filter(chm_res_m==0.4) %&gt;% </span></span>
<span id="cb326-3"><a href="stats_method.html#cb326-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb326-4"><a href="stats_method.html#cb326-4" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> circle_fit_iou_pct)) <span class="sc">+</span></span>
<span id="cb326-5"><a href="stats_method.html#cb326-5" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">stat_dotsinterval</span>(</span>
<span id="cb326-6"><a href="stats_method.html#cb326-6" tabindex="-1"></a>    <span class="at">point_interval =</span> <span class="st">&quot;median_hdci&quot;</span>, <span class="at">.width =</span> <span class="fu">c</span>(<span class="fl">0.95</span>)</span>
<span id="cb326-7"><a href="stats_method.html#cb326-7" tabindex="-1"></a>    , <span class="at">quantiles =</span> <span class="dv">100</span></span>
<span id="cb326-8"><a href="stats_method.html#cb326-8" tabindex="-1"></a>    , <span class="at">point_size =</span> <span class="dv">3</span> </span>
<span id="cb326-9"><a href="stats_method.html#cb326-9" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb326-10"><a href="stats_method.html#cb326-10" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">facet_grid</span>(</span>
<span id="cb326-11"><a href="stats_method.html#cb326-11" tabindex="-1"></a>    <span class="at">cols =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(spectral_weight)</span>
<span id="cb326-12"><a href="stats_method.html#cb326-12" tabindex="-1"></a>    , <span class="at">rows =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(chm_res_m)</span>
<span id="cb326-13"><a href="stats_method.html#cb326-13" tabindex="-1"></a>    , <span class="at">scales =</span> <span class="st">&quot;free_y&quot;</span></span>
<span id="cb326-14"><a href="stats_method.html#cb326-14" tabindex="-1"></a>    , <span class="at">labeller =</span> <span class="st">&quot;label_both&quot;</span></span>
<span id="cb326-15"><a href="stats_method.html#cb326-15" tabindex="-1"></a>    , <span class="at">axes =</span> <span class="st">&quot;all_x&quot;</span></span>
<span id="cb326-16"><a href="stats_method.html#cb326-16" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb326-17"><a href="stats_method.html#cb326-17" tabindex="-1"></a>  <span class="co"># ggplot2::scale_x_continuous(limits = c(0,1)) +</span></span>
<span id="cb326-18"><a href="stats_method.html#cb326-18" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> ggplot2<span class="sc">::</span><span class="fu">expansion</span>(<span class="at">mult =</span> <span class="dv">1</span>), <span class="at">breaks =</span> scales<span class="sc">::</span><span class="fu">breaks_extended</span>(<span class="dv">6</span>)) <span class="sc">+</span></span>
<span id="cb326-19"><a href="stats_method.html#cb326-19" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb326-20"><a href="stats_method.html#cb326-20" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb326-21"><a href="stats_method.html#cb326-21" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb326-22"><a href="stats_method.html#cb326-22" tabindex="-1"></a>    <span class="at">strip.text.x =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb326-23"><a href="stats_method.html#cb326-23" tabindex="-1"></a>    , <span class="at">strip.text.y =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb326-24"><a href="stats_method.html#cb326-24" tabindex="-1"></a>    , <span class="at">axis.text.x =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>)</span>
<span id="cb326-25"><a href="stats_method.html#cb326-25" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-308-1.png" width="1008" /></p>
<p>our model is very confident that the optimal <code>circle_fit_iou_pct</code> for maximizing detection accuracy is in a narrow range, just look at that x-axis scale</p>
<p>plot the posterior distribution of optimal parameter setting for <code>convexity_pct</code></p>
<div class="sourceCode" id="cb327"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb327-1"><a href="stats_method.html#cb327-1" tabindex="-1"></a>vertex_draws_temp <span class="sc">%&gt;%</span> </span>
<span id="cb327-2"><a href="stats_method.html#cb327-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb327-3"><a href="stats_method.html#cb327-3" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> convexity_pct)) <span class="sc">+</span></span>
<span id="cb327-4"><a href="stats_method.html#cb327-4" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">stat_dotsinterval</span>(</span>
<span id="cb327-5"><a href="stats_method.html#cb327-5" tabindex="-1"></a>    <span class="at">point_interval =</span> <span class="st">&quot;median_hdci&quot;</span>, <span class="at">.width =</span> <span class="fu">c</span>(<span class="fl">0.95</span>)</span>
<span id="cb327-6"><a href="stats_method.html#cb327-6" tabindex="-1"></a>    , <span class="at">quantiles =</span> <span class="dv">100</span></span>
<span id="cb327-7"><a href="stats_method.html#cb327-7" tabindex="-1"></a>    , <span class="at">point_size =</span> <span class="dv">3</span> </span>
<span id="cb327-8"><a href="stats_method.html#cb327-8" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb327-9"><a href="stats_method.html#cb327-9" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">facet_grid</span>(</span>
<span id="cb327-10"><a href="stats_method.html#cb327-10" tabindex="-1"></a>    <span class="at">cols =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(spectral_weight)</span>
<span id="cb327-11"><a href="stats_method.html#cb327-11" tabindex="-1"></a>    , <span class="at">rows =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(chm_res_m)</span>
<span id="cb327-12"><a href="stats_method.html#cb327-12" tabindex="-1"></a>    , <span class="at">scales =</span> <span class="st">&quot;free_y&quot;</span></span>
<span id="cb327-13"><a href="stats_method.html#cb327-13" tabindex="-1"></a>    , <span class="at">labeller =</span> <span class="st">&quot;label_both&quot;</span></span>
<span id="cb327-14"><a href="stats_method.html#cb327-14" tabindex="-1"></a>    , <span class="at">axes =</span> <span class="st">&quot;all_x&quot;</span></span>
<span id="cb327-15"><a href="stats_method.html#cb327-15" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb327-16"><a href="stats_method.html#cb327-16" tabindex="-1"></a>  <span class="co"># ggplot2::scale_x_continuous(limits = c(0,1)) +</span></span>
<span id="cb327-17"><a href="stats_method.html#cb327-17" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> ggplot2<span class="sc">::</span><span class="fu">expansion</span>(<span class="at">mult =</span> <span class="dv">1</span>), <span class="at">breaks =</span> scales<span class="sc">::</span><span class="fu">breaks_extended</span>(<span class="dv">6</span>)) <span class="sc">+</span></span>
<span id="cb327-18"><a href="stats_method.html#cb327-18" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb327-19"><a href="stats_method.html#cb327-19" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb327-20"><a href="stats_method.html#cb327-20" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb327-21"><a href="stats_method.html#cb327-21" tabindex="-1"></a>    <span class="at">strip.text.x =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb327-22"><a href="stats_method.html#cb327-22" tabindex="-1"></a>    , <span class="at">strip.text.y =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb327-23"><a href="stats_method.html#cb327-23" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-309-1.png" width="1008" /></p>
<p>when the <code>circle_fit_iou_pct</code> parameter is optimized, the influence of <code>convexity_pct</code> on detection accuracy is dependent on the CHM resolution. for coarser CHM data (&gt;0.3 m), the model’s predictions indicate with high certainty that the optimal <code>convexity_pct</code> is higher (i.e. requiring more smooth boundaries) than the optimal <code>convexity_pct</code> setting (i.e. requiring less smooth boundaries) for finer resoultion CHM data. this finding is consistent with our previous results and provides additional evidence that the smoothing effect of coarser resolution CHM data makes <code>convexity_pct</code> most effective at filtering irregular objects only when it is set to an intermediate level (e.g. ~0.5).</p>
<p>we can look at this another way, check it</p>
<div class="sourceCode" id="cb328"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb328-1"><a href="stats_method.html#cb328-1" tabindex="-1"></a>vertex_draws_temp <span class="sc">%&gt;%</span> </span>
<span id="cb328-2"><a href="stats_method.html#cb328-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb328-3"><a href="stats_method.html#cb328-3" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">y =</span> convexity_pct, <span class="at">x =</span> circle_fit_iou_pct)) <span class="sc">+</span></span>
<span id="cb328-4"><a href="stats_method.html#cb328-4" tabindex="-1"></a>  <span class="co"># geom_point(alpha=0.2) +</span></span>
<span id="cb328-5"><a href="stats_method.html#cb328-5" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_jitter</span>(<span class="at">alpha=</span><span class="fl">0.2</span>, <span class="at">height =</span> .<span class="dv">01</span>, <span class="at">width =</span> .<span class="dv">01</span>) <span class="sc">+</span></span>
<span id="cb328-6"><a href="stats_method.html#cb328-6" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">facet_grid</span>(</span>
<span id="cb328-7"><a href="stats_method.html#cb328-7" tabindex="-1"></a>    <span class="at">cols =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(spectral_weight)</span>
<span id="cb328-8"><a href="stats_method.html#cb328-8" tabindex="-1"></a>    , <span class="at">rows =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(chm_res_m)</span>
<span id="cb328-9"><a href="stats_method.html#cb328-9" tabindex="-1"></a>    <span class="co"># , scales = &quot;free_y&quot;</span></span>
<span id="cb328-10"><a href="stats_method.html#cb328-10" tabindex="-1"></a>    , <span class="at">labeller =</span> <span class="st">&quot;label_both&quot;</span></span>
<span id="cb328-11"><a href="stats_method.html#cb328-11" tabindex="-1"></a>    , <span class="at">axes =</span> <span class="st">&quot;all_x&quot;</span></span>
<span id="cb328-12"><a href="stats_method.html#cb328-12" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb328-13"><a href="stats_method.html#cb328-13" tabindex="-1"></a>  <span class="co"># ggplot2::scale_x_continuous(limits = c(0,1)) +</span></span>
<span id="cb328-14"><a href="stats_method.html#cb328-14" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> ggplot2<span class="sc">::</span><span class="fu">expansion</span>(<span class="at">mult =</span> <span class="dv">1</span>), <span class="at">breaks =</span> scales<span class="sc">::</span><span class="fu">breaks_extended</span>(<span class="dv">6</span>)) <span class="sc">+</span></span>
<span id="cb328-15"><a href="stats_method.html#cb328-15" tabindex="-1"></a>  <span class="co"># ggplot2::scale_y_continuous(NULL, breaks = NULL) +</span></span>
<span id="cb328-16"><a href="stats_method.html#cb328-16" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb328-17"><a href="stats_method.html#cb328-17" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb328-18"><a href="stats_method.html#cb328-18" tabindex="-1"></a>    <span class="at">strip.text.x =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb328-19"><a href="stats_method.html#cb328-19" tabindex="-1"></a>    , <span class="at">strip.text.y =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb328-20"><a href="stats_method.html#cb328-20" tabindex="-1"></a>    , <span class="at">axis.text =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>)</span>
<span id="cb328-21"><a href="stats_method.html#cb328-21" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-310-1.png" width="1008" /></p>
<p>note, in the plot above, we slightly “jitter” the points so that they are visible where they would otherwise be stacked on top of each other and only look like a few points instead of the 1000 draws from the posterior we used</p>
<p>let’s table the HDI of the optimal values</p>
<div class="sourceCode" id="cb329"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb329-1"><a href="stats_method.html#cb329-1" tabindex="-1"></a><span class="co"># summarize it</span></span>
<span id="cb329-2"><a href="stats_method.html#cb329-2" tabindex="-1"></a>table_vertex_draws_temp <span class="ot">&lt;-</span> vertex_draws_temp <span class="sc">%&gt;%</span> </span>
<span id="cb329-3"><a href="stats_method.html#cb329-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(</span>
<span id="cb329-4"><a href="stats_method.html#cb329-4" tabindex="-1"></a>    chm_res_m, spectral_weight</span>
<span id="cb329-5"><a href="stats_method.html#cb329-5" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb329-6"><a href="stats_method.html#cb329-6" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(</span>
<span id="cb329-7"><a href="stats_method.html#cb329-7" tabindex="-1"></a>    <span class="co"># get median_hdi</span></span>
<span id="cb329-8"><a href="stats_method.html#cb329-8" tabindex="-1"></a>    <span class="at">median_hdi_est_circle_fit_iou_pct =</span> tidybayes<span class="sc">::</span><span class="fu">median_hdci</span>(circle_fit_iou_pct)<span class="sc">$</span>y</span>
<span id="cb329-9"><a href="stats_method.html#cb329-9" tabindex="-1"></a>    , <span class="at">median_hdi_lower_circle_fit_iou_pct =</span> tidybayes<span class="sc">::</span><span class="fu">median_hdci</span>(circle_fit_iou_pct)<span class="sc">$</span>ymin</span>
<span id="cb329-10"><a href="stats_method.html#cb329-10" tabindex="-1"></a>    , <span class="at">median_hdi_upper_circle_fit_iou_pct =</span> tidybayes<span class="sc">::</span><span class="fu">median_hdci</span>(circle_fit_iou_pct)<span class="sc">$</span>ymax</span>
<span id="cb329-11"><a href="stats_method.html#cb329-11" tabindex="-1"></a>    <span class="co"># get median_hdi</span></span>
<span id="cb329-12"><a href="stats_method.html#cb329-12" tabindex="-1"></a>    , <span class="at">median_hdi_est_convexity_pct =</span> tidybayes<span class="sc">::</span><span class="fu">median_hdci</span>(convexity_pct)<span class="sc">$</span>y</span>
<span id="cb329-13"><a href="stats_method.html#cb329-13" tabindex="-1"></a>    , <span class="at">median_hdi_lower_convexity_pct =</span> tidybayes<span class="sc">::</span><span class="fu">median_hdci</span>(convexity_pct)<span class="sc">$</span>ymin</span>
<span id="cb329-14"><a href="stats_method.html#cb329-14" tabindex="-1"></a>    , <span class="at">median_hdi_upper_convexity_pct =</span> tidybayes<span class="sc">::</span><span class="fu">median_hdci</span>(convexity_pct)<span class="sc">$</span>ymax</span>
<span id="cb329-15"><a href="stats_method.html#cb329-15" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb329-16"><a href="stats_method.html#cb329-16" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() </span>
<span id="cb329-17"><a href="stats_method.html#cb329-17" tabindex="-1"></a><span class="co"># table it</span></span>
<span id="cb329-18"><a href="stats_method.html#cb329-18" tabindex="-1"></a>table_vertex_draws_temp <span class="sc">%&gt;%</span> </span>
<span id="cb329-19"><a href="stats_method.html#cb329-19" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kbl</span>(</span>
<span id="cb329-20"><a href="stats_method.html#cb329-20" tabindex="-1"></a>    <span class="at">digits =</span> <span class="dv">2</span></span>
<span id="cb329-21"><a href="stats_method.html#cb329-21" tabindex="-1"></a>    , <span class="at">caption =</span> <span class="st">&quot;&quot;</span></span>
<span id="cb329-22"><a href="stats_method.html#cb329-22" tabindex="-1"></a>    , <span class="at">col.names =</span> <span class="fu">c</span>(</span>
<span id="cb329-23"><a href="stats_method.html#cb329-23" tabindex="-1"></a>      <span class="st">&quot;CHM resolution&quot;</span>, <span class="st">&quot;spectral_weight&quot;</span></span>
<span id="cb329-24"><a href="stats_method.html#cb329-24" tabindex="-1"></a>      , <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;median&quot;</span>, <span class="st">&quot;HDI low&quot;</span>, <span class="st">&quot;HDI high&quot;</span>),<span class="dv">2</span>)</span>
<span id="cb329-25"><a href="stats_method.html#cb329-25" tabindex="-1"></a>    )</span>
<span id="cb329-26"><a href="stats_method.html#cb329-26" tabindex="-1"></a>    , <span class="at">escape =</span> F</span>
<span id="cb329-27"><a href="stats_method.html#cb329-27" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb329-28"><a href="stats_method.html#cb329-28" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kable_styling</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb329-29"><a href="stats_method.html#cb329-29" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">collapse_rows</span>(<span class="at">columns =</span> <span class="dv">1</span>, <span class="at">valign =</span> <span class="st">&quot;top&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb329-30"><a href="stats_method.html#cb329-30" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">add_header_above</span>(<span class="fu">c</span>(</span>
<span id="cb329-31"><a href="stats_method.html#cb329-31" tabindex="-1"></a>    <span class="st">&quot; &quot;</span><span class="ot">=</span><span class="dv">2</span></span>
<span id="cb329-32"><a href="stats_method.html#cb329-32" tabindex="-1"></a>    , <span class="st">&quot;circle_fit_iou_pct&quot;</span> <span class="ot">=</span> <span class="dv">3</span></span>
<span id="cb329-33"><a href="stats_method.html#cb329-33" tabindex="-1"></a>    , <span class="st">&quot;convexity_pct&quot;</span> <span class="ot">=</span> <span class="dv">3</span></span>
<span id="cb329-34"><a href="stats_method.html#cb329-34" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb329-35"><a href="stats_method.html#cb329-35" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">scroll_box</span>(<span class="at">height =</span> <span class="st">&quot;8in&quot;</span>)</span></code></pre></div>
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:8in; ">
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-311">Table 9.3: </span>
</caption>
<thead>
<tr>
<th style="empty-cells: hide;border-bottom:hidden;position: sticky; top:0; background-color: #FFFFFF;" colspan="2">
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; position: sticky; top:0; background-color: #FFFFFF;" colspan="3">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
circle_fit_iou_pct
</div>
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; position: sticky; top:0; background-color: #FFFFFF;" colspan="3">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
convexity_pct
</div>
</th>
</tr>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
CHM resolution
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
spectral_weight
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
median
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
HDI low
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
HDI high
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
median
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
HDI low
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
HDI high
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;vertical-align: top !important;" rowspan="6">
0.1
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:right;">
0.34
</td>
<td style="text-align:right;">
0.33
</td>
<td style="text-align:right;">
0.34
</td>
<td style="text-align:right;">
0.20
</td>
<td style="text-align:right;">
0.19
</td>
<td style="text-align:right;">
0.21
</td>
</tr>
<tr>
<td style="text-align:left;">
1
</td>
<td style="text-align:right;">
0.34
</td>
<td style="text-align:right;">
0.33
</td>
<td style="text-align:right;">
0.34
</td>
<td style="text-align:right;">
0.20
</td>
<td style="text-align:right;">
0.19
</td>
<td style="text-align:right;">
0.21
</td>
</tr>
<tr>
<td style="text-align:left;">
2
</td>
<td style="text-align:right;">
0.34
</td>
<td style="text-align:right;">
0.33
</td>
<td style="text-align:right;">
0.34
</td>
<td style="text-align:right;">
0.20
</td>
<td style="text-align:right;">
0.19
</td>
<td style="text-align:right;">
0.21
</td>
</tr>
<tr>
<td style="text-align:left;">
3
</td>
<td style="text-align:right;">
0.34
</td>
<td style="text-align:right;">
0.33
</td>
<td style="text-align:right;">
0.34
</td>
<td style="text-align:right;">
0.20
</td>
<td style="text-align:right;">
0.19
</td>
<td style="text-align:right;">
0.21
</td>
</tr>
<tr>
<td style="text-align:left;">
4
</td>
<td style="text-align:right;">
0.34
</td>
<td style="text-align:right;">
0.33
</td>
<td style="text-align:right;">
0.34
</td>
<td style="text-align:right;">
0.20
</td>
<td style="text-align:right;">
0.19
</td>
<td style="text-align:right;">
0.21
</td>
</tr>
<tr>
<td style="text-align:left;">
5
</td>
<td style="text-align:right;">
0.34
</td>
<td style="text-align:right;">
0.33
</td>
<td style="text-align:right;">
0.34
</td>
<td style="text-align:right;">
0.20
</td>
<td style="text-align:right;">
0.19
</td>
<td style="text-align:right;">
0.21
</td>
</tr>
<tr>
<td style="text-align:right;vertical-align: top !important;" rowspan="6">
0.2
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:right;">
0.35
</td>
<td style="text-align:right;">
0.35
</td>
<td style="text-align:right;">
0.35
</td>
<td style="text-align:right;">
0.28
</td>
<td style="text-align:right;">
0.28
</td>
<td style="text-align:right;">
0.29
</td>
</tr>
<tr>
<td style="text-align:left;">
1
</td>
<td style="text-align:right;">
0.35
</td>
<td style="text-align:right;">
0.35
</td>
<td style="text-align:right;">
0.35
</td>
<td style="text-align:right;">
0.28
</td>
<td style="text-align:right;">
0.28
</td>
<td style="text-align:right;">
0.29
</td>
</tr>
<tr>
<td style="text-align:left;">
2
</td>
<td style="text-align:right;">
0.35
</td>
<td style="text-align:right;">
0.35
</td>
<td style="text-align:right;">
0.35
</td>
<td style="text-align:right;">
0.28
</td>
<td style="text-align:right;">
0.28
</td>
<td style="text-align:right;">
0.29
</td>
</tr>
<tr>
<td style="text-align:left;">
3
</td>
<td style="text-align:right;">
0.35
</td>
<td style="text-align:right;">
0.35
</td>
<td style="text-align:right;">
0.35
</td>
<td style="text-align:right;">
0.28
</td>
<td style="text-align:right;">
0.28
</td>
<td style="text-align:right;">
0.29
</td>
</tr>
<tr>
<td style="text-align:left;">
4
</td>
<td style="text-align:right;">
0.35
</td>
<td style="text-align:right;">
0.35
</td>
<td style="text-align:right;">
0.35
</td>
<td style="text-align:right;">
0.28
</td>
<td style="text-align:right;">
0.28
</td>
<td style="text-align:right;">
0.29
</td>
</tr>
<tr>
<td style="text-align:left;">
5
</td>
<td style="text-align:right;">
0.35
</td>
<td style="text-align:right;">
0.35
</td>
<td style="text-align:right;">
0.35
</td>
<td style="text-align:right;">
0.28
</td>
<td style="text-align:right;">
0.28
</td>
<td style="text-align:right;">
0.29
</td>
</tr>
<tr>
<td style="text-align:right;vertical-align: top !important;" rowspan="6">
0.3
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:right;">
0.36
</td>
<td style="text-align:right;">
0.35
</td>
<td style="text-align:right;">
0.36
</td>
<td style="text-align:right;">
0.36
</td>
<td style="text-align:right;">
0.36
</td>
<td style="text-align:right;">
0.37
</td>
</tr>
<tr>
<td style="text-align:left;">
1
</td>
<td style="text-align:right;">
0.36
</td>
<td style="text-align:right;">
0.35
</td>
<td style="text-align:right;">
0.36
</td>
<td style="text-align:right;">
0.36
</td>
<td style="text-align:right;">
0.36
</td>
<td style="text-align:right;">
0.37
</td>
</tr>
<tr>
<td style="text-align:left;">
2
</td>
<td style="text-align:right;">
0.36
</td>
<td style="text-align:right;">
0.35
</td>
<td style="text-align:right;">
0.36
</td>
<td style="text-align:right;">
0.36
</td>
<td style="text-align:right;">
0.36
</td>
<td style="text-align:right;">
0.37
</td>
</tr>
<tr>
<td style="text-align:left;">
3
</td>
<td style="text-align:right;">
0.36
</td>
<td style="text-align:right;">
0.35
</td>
<td style="text-align:right;">
0.36
</td>
<td style="text-align:right;">
0.36
</td>
<td style="text-align:right;">
0.36
</td>
<td style="text-align:right;">
0.37
</td>
</tr>
<tr>
<td style="text-align:left;">
4
</td>
<td style="text-align:right;">
0.36
</td>
<td style="text-align:right;">
0.35
</td>
<td style="text-align:right;">
0.36
</td>
<td style="text-align:right;">
0.36
</td>
<td style="text-align:right;">
0.36
</td>
<td style="text-align:right;">
0.37
</td>
</tr>
<tr>
<td style="text-align:left;">
5
</td>
<td style="text-align:right;">
0.36
</td>
<td style="text-align:right;">
0.35
</td>
<td style="text-align:right;">
0.36
</td>
<td style="text-align:right;">
0.36
</td>
<td style="text-align:right;">
0.36
</td>
<td style="text-align:right;">
0.37
</td>
</tr>
<tr>
<td style="text-align:right;vertical-align: top !important;" rowspan="6">
0.4
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:right;">
0.36
</td>
<td style="text-align:right;">
0.35
</td>
<td style="text-align:right;">
0.36
</td>
<td style="text-align:right;">
0.44
</td>
<td style="text-align:right;">
0.43
</td>
<td style="text-align:right;">
0.44
</td>
</tr>
<tr>
<td style="text-align:left;">
1
</td>
<td style="text-align:right;">
0.36
</td>
<td style="text-align:right;">
0.35
</td>
<td style="text-align:right;">
0.36
</td>
<td style="text-align:right;">
0.44
</td>
<td style="text-align:right;">
0.43
</td>
<td style="text-align:right;">
0.44
</td>
</tr>
<tr>
<td style="text-align:left;">
2
</td>
<td style="text-align:right;">
0.36
</td>
<td style="text-align:right;">
0.35
</td>
<td style="text-align:right;">
0.36
</td>
<td style="text-align:right;">
0.44
</td>
<td style="text-align:right;">
0.43
</td>
<td style="text-align:right;">
0.44
</td>
</tr>
<tr>
<td style="text-align:left;">
3
</td>
<td style="text-align:right;">
0.36
</td>
<td style="text-align:right;">
0.35
</td>
<td style="text-align:right;">
0.36
</td>
<td style="text-align:right;">
0.44
</td>
<td style="text-align:right;">
0.43
</td>
<td style="text-align:right;">
0.44
</td>
</tr>
<tr>
<td style="text-align:left;">
4
</td>
<td style="text-align:right;">
0.36
</td>
<td style="text-align:right;">
0.35
</td>
<td style="text-align:right;">
0.36
</td>
<td style="text-align:right;">
0.44
</td>
<td style="text-align:right;">
0.43
</td>
<td style="text-align:right;">
0.44
</td>
</tr>
<tr>
<td style="text-align:left;">
5
</td>
<td style="text-align:right;">
0.36
</td>
<td style="text-align:right;">
0.35
</td>
<td style="text-align:right;">
0.36
</td>
<td style="text-align:right;">
0.44
</td>
<td style="text-align:right;">
0.43
</td>
<td style="text-align:right;">
0.44
</td>
</tr>
<tr>
<td style="text-align:right;vertical-align: top !important;" rowspan="6">
0.5
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:right;">
0.35
</td>
<td style="text-align:right;">
0.35
</td>
<td style="text-align:right;">
0.35
</td>
<td style="text-align:right;">
0.52
</td>
<td style="text-align:right;">
0.51
</td>
<td style="text-align:right;">
0.52
</td>
</tr>
<tr>
<td style="text-align:left;">
1
</td>
<td style="text-align:right;">
0.35
</td>
<td style="text-align:right;">
0.35
</td>
<td style="text-align:right;">
0.35
</td>
<td style="text-align:right;">
0.52
</td>
<td style="text-align:right;">
0.51
</td>
<td style="text-align:right;">
0.52
</td>
</tr>
<tr>
<td style="text-align:left;">
2
</td>
<td style="text-align:right;">
0.35
</td>
<td style="text-align:right;">
0.35
</td>
<td style="text-align:right;">
0.35
</td>
<td style="text-align:right;">
0.52
</td>
<td style="text-align:right;">
0.51
</td>
<td style="text-align:right;">
0.52
</td>
</tr>
<tr>
<td style="text-align:left;">
3
</td>
<td style="text-align:right;">
0.35
</td>
<td style="text-align:right;">
0.35
</td>
<td style="text-align:right;">
0.35
</td>
<td style="text-align:right;">
0.52
</td>
<td style="text-align:right;">
0.51
</td>
<td style="text-align:right;">
0.52
</td>
</tr>
<tr>
<td style="text-align:left;">
4
</td>
<td style="text-align:right;">
0.35
</td>
<td style="text-align:right;">
0.35
</td>
<td style="text-align:right;">
0.35
</td>
<td style="text-align:right;">
0.52
</td>
<td style="text-align:right;">
0.51
</td>
<td style="text-align:right;">
0.52
</td>
</tr>
<tr>
<td style="text-align:left;">
5
</td>
<td style="text-align:right;">
0.35
</td>
<td style="text-align:right;">
0.35
</td>
<td style="text-align:right;">
0.35
</td>
<td style="text-align:right;">
0.52
</td>
<td style="text-align:right;">
0.51
</td>
<td style="text-align:right;">
0.52
</td>
</tr>
</tbody>
</table>
</div>
<p>to fix our structural parameter levels so that we can continue to explore the influence of the input data, we’ll select the median of the optimal setting of <code>circle_fit_iou_pct</code> and <code>convexity_pct</code> by CHM resolution levels and spectral weighting. This will result in no one CHM resolution and spectral weighting combination using it’s optimal <code>circle_fit_iou_pct</code> and <code>convexity_pct</code> setting but will provide us with values in the plausible range of optimal settings that work across the CHM resolutions tested with empirical data.</p>
<div class="sourceCode" id="cb330"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb330-1"><a href="stats_method.html#cb330-1" tabindex="-1"></a>structural_params_settings <span class="ot">&lt;-</span> </span>
<span id="cb330-2"><a href="stats_method.html#cb330-2" tabindex="-1"></a>  vertex_draws_temp <span class="sc">%&gt;%</span> </span>
<span id="cb330-3"><a href="stats_method.html#cb330-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb330-4"><a href="stats_method.html#cb330-4" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(</span>
<span id="cb330-5"><a href="stats_method.html#cb330-5" tabindex="-1"></a>    <span class="co"># get median_hdi</span></span>
<span id="cb330-6"><a href="stats_method.html#cb330-6" tabindex="-1"></a>    <span class="at">circle_fit_iou_pct =</span> tidybayes<span class="sc">::</span><span class="fu">median_hdci</span>(circle_fit_iou_pct)<span class="sc">$</span>y</span>
<span id="cb330-7"><a href="stats_method.html#cb330-7" tabindex="-1"></a>    <span class="co"># , median_hdi_lower_circle_fit_iou_pct = tidybayes::median_hdci(circle_fit_iou_pct)$ymin</span></span>
<span id="cb330-8"><a href="stats_method.html#cb330-8" tabindex="-1"></a>    <span class="co"># , median_hdi_upper_circle_fit_iou_pct = tidybayes::median_hdci(circle_fit_iou_pct)$ymax</span></span>
<span id="cb330-9"><a href="stats_method.html#cb330-9" tabindex="-1"></a>    <span class="co"># get median_hdi</span></span>
<span id="cb330-10"><a href="stats_method.html#cb330-10" tabindex="-1"></a>    , <span class="at">convexity_pct =</span> tidybayes<span class="sc">::</span><span class="fu">median_hdci</span>(convexity_pct)<span class="sc">$</span>y</span>
<span id="cb330-11"><a href="stats_method.html#cb330-11" tabindex="-1"></a>    <span class="co"># , median_hdi_lower_convexity_pct = tidybayes::median_hdci(convexity_pct)$ymin</span></span>
<span id="cb330-12"><a href="stats_method.html#cb330-12" tabindex="-1"></a>    <span class="co"># , median_hdi_upper_convexity_pct = tidybayes::median_hdci(convexity_pct)$ymax</span></span>
<span id="cb330-13"><a href="stats_method.html#cb330-13" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb330-14"><a href="stats_method.html#cb330-14" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">bind_cols</span>(</span>
<span id="cb330-15"><a href="stats_method.html#cb330-15" tabindex="-1"></a>    structural_params_settings</span>
<span id="cb330-16"><a href="stats_method.html#cb330-16" tabindex="-1"></a>  )</span>
<span id="cb330-17"><a href="stats_method.html#cb330-17" tabindex="-1"></a><span class="co"># what?</span></span>
<span id="cb330-18"><a href="stats_method.html#cb330-18" tabindex="-1"></a>structural_params_settings <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">glimpse</span>()</span></code></pre></div>
<pre><code>## Rows: 1
## Columns: 4
## $ circle_fit_iou_pct &lt;dbl&gt; 0.35
## $ convexity_pct      &lt;dbl&gt; 0.36
## $ max_ht_m           &lt;dbl&gt; 2.3
## $ max_area_m2        &lt;dbl&gt; 46</code></pre>
</div>
</div>
<div id="in_dta_det_acc_pred" class="section level4 hasAnchor" number="9.1.5.2">
<h4><span class="header-section-number">9.1.5.2</span> Input data<a href="stats_method.html#in_dta_det_acc_pred" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>to explore the influence of the input data, which includes the presence or absence of spectral data and its weighting (i.e. <code>spectral_weight</code>) as well as the CHM resolution (<code>chm_res_m</code>), we will fix all four structural parameters (<code>max_ht_m</code>, <code>max_area_m2</code>, <code>convexity_pct</code>, <code>circle_fit_iou_pct</code>). the <code>max_ht_m</code>, <code>max_area_m2</code> parameters will be fixed at expected levels based on the slash pile construction prescription while the <code>convexity_pct</code>, <code>circle_fit_iou_pct</code> will be fixed at the optimal levels determined based on the Bayesian posterior predictive distribution of <a href="stats_method.html#f_score_epred">detection accuracy</a></p>
<p>we’ll make contrasts of the posterior predictions to probabilistically quantify the influence of the input data (e.g. inclusion of spectral data and it’s weighting and CHM resolution). before we do this we’re going to borrow code from (<a href="https://georgewoolsey.github.io/uas_sfm_tree_detection/stats_validation.html#beta_mod">Tinkham and Woolsey 2024</a>) to make and plot the Bayesian contrasts</p>
<div class="sourceCode" id="cb332"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb332-1"><a href="stats_method.html#cb332-1" tabindex="-1"></a><span class="do">############################################</span></span>
<span id="cb332-2"><a href="stats_method.html#cb332-2" tabindex="-1"></a><span class="co"># make the variables for the contrast</span></span>
<span id="cb332-3"><a href="stats_method.html#cb332-3" tabindex="-1"></a><span class="do">############################################</span></span>
<span id="cb332-4"><a href="stats_method.html#cb332-4" tabindex="-1"></a>make_contrast_vars <span class="ot">&lt;-</span> <span class="cf">function</span>(my_data){</span>
<span id="cb332-5"><a href="stats_method.html#cb332-5" tabindex="-1"></a>  my_data <span class="sc">%&gt;%</span></span>
<span id="cb332-6"><a href="stats_method.html#cb332-6" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb332-7"><a href="stats_method.html#cb332-7" tabindex="-1"></a>      <span class="co"># get median_hdi</span></span>
<span id="cb332-8"><a href="stats_method.html#cb332-8" tabindex="-1"></a>      <span class="at">median_hdi_est =</span> tidybayes<span class="sc">::</span><span class="fu">median_hdci</span>(value)<span class="sc">$</span>y</span>
<span id="cb332-9"><a href="stats_method.html#cb332-9" tabindex="-1"></a>      , <span class="at">median_hdi_lower =</span> tidybayes<span class="sc">::</span><span class="fu">median_hdci</span>(value)<span class="sc">$</span>ymin</span>
<span id="cb332-10"><a href="stats_method.html#cb332-10" tabindex="-1"></a>      , <span class="at">median_hdi_upper =</span> tidybayes<span class="sc">::</span><span class="fu">median_hdci</span>(value)<span class="sc">$</span>ymax</span>
<span id="cb332-11"><a href="stats_method.html#cb332-11" tabindex="-1"></a>      <span class="co"># check probability of contrast</span></span>
<span id="cb332-12"><a href="stats_method.html#cb332-12" tabindex="-1"></a>      , <span class="at">pr_gt_zero =</span> <span class="fu">mean</span>(value <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb332-13"><a href="stats_method.html#cb332-13" tabindex="-1"></a>          scales<span class="sc">::</span><span class="fu">percent</span>(<span class="at">accuracy =</span> <span class="dv">1</span>)</span>
<span id="cb332-14"><a href="stats_method.html#cb332-14" tabindex="-1"></a>      , <span class="at">pr_lt_zero =</span> <span class="fu">mean</span>(value <span class="sc">&lt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb332-15"><a href="stats_method.html#cb332-15" tabindex="-1"></a>          scales<span class="sc">::</span><span class="fu">percent</span>(<span class="at">accuracy =</span> <span class="dv">1</span>)</span>
<span id="cb332-16"><a href="stats_method.html#cb332-16" tabindex="-1"></a>      <span class="co"># check probability that this direction is true</span></span>
<span id="cb332-17"><a href="stats_method.html#cb332-17" tabindex="-1"></a>      , <span class="at">is_diff_dir =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb332-18"><a href="stats_method.html#cb332-18" tabindex="-1"></a>        median_hdi_est <span class="sc">&gt;=</span> <span class="dv">0</span> <span class="sc">~</span> value <span class="sc">&gt;</span> <span class="dv">0</span></span>
<span id="cb332-19"><a href="stats_method.html#cb332-19" tabindex="-1"></a>        , median_hdi_est <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">~</span> value <span class="sc">&lt;</span> <span class="dv">0</span></span>
<span id="cb332-20"><a href="stats_method.html#cb332-20" tabindex="-1"></a>      )</span>
<span id="cb332-21"><a href="stats_method.html#cb332-21" tabindex="-1"></a>      , <span class="at">pr_diff =</span> <span class="fu">mean</span>(is_diff_dir)</span>
<span id="cb332-22"><a href="stats_method.html#cb332-22" tabindex="-1"></a>      <span class="co"># make a label</span></span>
<span id="cb332-23"><a href="stats_method.html#cb332-23" tabindex="-1"></a>      , <span class="at">pr_diff_lab =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb332-24"><a href="stats_method.html#cb332-24" tabindex="-1"></a>          median_hdi_est <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="fu">paste0</span>(</span>
<span id="cb332-25"><a href="stats_method.html#cb332-25" tabindex="-1"></a>            <span class="st">&quot;Pr(&quot;</span></span>
<span id="cb332-26"><a href="stats_method.html#cb332-26" tabindex="-1"></a>            , stringr<span class="sc">::</span><span class="fu">word</span>(contrast, <span class="dv">1</span>, <span class="at">sep =</span> <span class="fu">fixed</span>(<span class="st">&quot;-&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb332-27"><a href="stats_method.html#cb332-27" tabindex="-1"></a>              stringr<span class="sc">::</span><span class="fu">str_squish</span>()</span>
<span id="cb332-28"><a href="stats_method.html#cb332-28" tabindex="-1"></a>            , <span class="st">&quot;&gt;&quot;</span></span>
<span id="cb332-29"><a href="stats_method.html#cb332-29" tabindex="-1"></a>            , stringr<span class="sc">::</span><span class="fu">word</span>(contrast, <span class="dv">2</span>, <span class="at">sep =</span> <span class="fu">fixed</span>(<span class="st">&quot;-&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb332-30"><a href="stats_method.html#cb332-30" tabindex="-1"></a>              stringr<span class="sc">::</span><span class="fu">str_squish</span>()</span>
<span id="cb332-31"><a href="stats_method.html#cb332-31" tabindex="-1"></a>            , <span class="st">&quot;)=&quot;</span></span>
<span id="cb332-32"><a href="stats_method.html#cb332-32" tabindex="-1"></a>            , pr_diff <span class="sc">%&gt;%</span> scales<span class="sc">::</span><span class="fu">percent</span>(<span class="at">accuracy =</span> <span class="dv">1</span>)</span>
<span id="cb332-33"><a href="stats_method.html#cb332-33" tabindex="-1"></a>          )</span>
<span id="cb332-34"><a href="stats_method.html#cb332-34" tabindex="-1"></a>          , median_hdi_est <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="fu">paste0</span>(</span>
<span id="cb332-35"><a href="stats_method.html#cb332-35" tabindex="-1"></a>            <span class="st">&quot;Pr(&quot;</span></span>
<span id="cb332-36"><a href="stats_method.html#cb332-36" tabindex="-1"></a>            , stringr<span class="sc">::</span><span class="fu">word</span>(contrast, <span class="dv">2</span>, <span class="at">sep =</span> <span class="fu">fixed</span>(<span class="st">&quot;-&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb332-37"><a href="stats_method.html#cb332-37" tabindex="-1"></a>              stringr<span class="sc">::</span><span class="fu">str_squish</span>()</span>
<span id="cb332-38"><a href="stats_method.html#cb332-38" tabindex="-1"></a>            , <span class="st">&quot;&gt;&quot;</span></span>
<span id="cb332-39"><a href="stats_method.html#cb332-39" tabindex="-1"></a>            , stringr<span class="sc">::</span><span class="fu">word</span>(contrast, <span class="dv">1</span>, <span class="at">sep =</span> <span class="fu">fixed</span>(<span class="st">&quot;-&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb332-40"><a href="stats_method.html#cb332-40" tabindex="-1"></a>              stringr<span class="sc">::</span><span class="fu">str_squish</span>()</span>
<span id="cb332-41"><a href="stats_method.html#cb332-41" tabindex="-1"></a>            , <span class="st">&quot;)=&quot;</span></span>
<span id="cb332-42"><a href="stats_method.html#cb332-42" tabindex="-1"></a>            , pr_diff <span class="sc">%&gt;%</span> scales<span class="sc">::</span><span class="fu">percent</span>(<span class="at">accuracy =</span> <span class="dv">1</span>)</span>
<span id="cb332-43"><a href="stats_method.html#cb332-43" tabindex="-1"></a>          )</span>
<span id="cb332-44"><a href="stats_method.html#cb332-44" tabindex="-1"></a>        )</span>
<span id="cb332-45"><a href="stats_method.html#cb332-45" tabindex="-1"></a>      <span class="co"># make a SMALLER label</span></span>
<span id="cb332-46"><a href="stats_method.html#cb332-46" tabindex="-1"></a>      , <span class="at">pr_diff_lab_sm =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb332-47"><a href="stats_method.html#cb332-47" tabindex="-1"></a>        median_hdi_est <span class="sc">&gt;=</span> <span class="dv">0</span> <span class="sc">~</span> <span class="fu">paste0</span>(</span>
<span id="cb332-48"><a href="stats_method.html#cb332-48" tabindex="-1"></a>          <span class="st">&quot;Pr(&gt;0)=&quot;</span></span>
<span id="cb332-49"><a href="stats_method.html#cb332-49" tabindex="-1"></a>          , pr_diff <span class="sc">%&gt;%</span> scales<span class="sc">::</span><span class="fu">percent</span>(<span class="at">accuracy =</span> <span class="dv">1</span>)</span>
<span id="cb332-50"><a href="stats_method.html#cb332-50" tabindex="-1"></a>        )</span>
<span id="cb332-51"><a href="stats_method.html#cb332-51" tabindex="-1"></a>        , median_hdi_est <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="fu">paste0</span>(</span>
<span id="cb332-52"><a href="stats_method.html#cb332-52" tabindex="-1"></a>          <span class="st">&quot;Pr(&lt;0)=&quot;</span></span>
<span id="cb332-53"><a href="stats_method.html#cb332-53" tabindex="-1"></a>          , pr_diff <span class="sc">%&gt;%</span> scales<span class="sc">::</span><span class="fu">percent</span>(<span class="at">accuracy =</span> <span class="dv">1</span>)</span>
<span id="cb332-54"><a href="stats_method.html#cb332-54" tabindex="-1"></a>        )</span>
<span id="cb332-55"><a href="stats_method.html#cb332-55" tabindex="-1"></a>      )</span>
<span id="cb332-56"><a href="stats_method.html#cb332-56" tabindex="-1"></a>      , <span class="at">pr_diff_lab_pos =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb332-57"><a href="stats_method.html#cb332-57" tabindex="-1"></a>        median_hdi_est <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">~</span> median_hdi_upper</span>
<span id="cb332-58"><a href="stats_method.html#cb332-58" tabindex="-1"></a>        , median_hdi_est <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">~</span> median_hdi_lower</span>
<span id="cb332-59"><a href="stats_method.html#cb332-59" tabindex="-1"></a>      ) <span class="sc">*</span> <span class="fl">1.075</span></span>
<span id="cb332-60"><a href="stats_method.html#cb332-60" tabindex="-1"></a>      , <span class="at">sig_level =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb332-61"><a href="stats_method.html#cb332-61" tabindex="-1"></a>        pr_diff <span class="sc">&gt;</span> <span class="fl">0.99</span> <span class="sc">~</span> <span class="dv">0</span></span>
<span id="cb332-62"><a href="stats_method.html#cb332-62" tabindex="-1"></a>        , pr_diff <span class="sc">&gt;</span> <span class="fl">0.95</span> <span class="sc">~</span> <span class="dv">1</span></span>
<span id="cb332-63"><a href="stats_method.html#cb332-63" tabindex="-1"></a>        , pr_diff <span class="sc">&gt;</span> <span class="fl">0.9</span> <span class="sc">~</span> <span class="dv">2</span></span>
<span id="cb332-64"><a href="stats_method.html#cb332-64" tabindex="-1"></a>        , pr_diff <span class="sc">&gt;</span> <span class="fl">0.8</span> <span class="sc">~</span> <span class="dv">3</span></span>
<span id="cb332-65"><a href="stats_method.html#cb332-65" tabindex="-1"></a>        , T <span class="sc">~</span> <span class="dv">4</span></span>
<span id="cb332-66"><a href="stats_method.html#cb332-66" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span> </span>
<span id="cb332-67"><a href="stats_method.html#cb332-67" tabindex="-1"></a>      <span class="fu">factor</span>(<span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">4</span>), <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;&gt;99%&quot;</span>,<span class="st">&quot;95%&quot;</span>,<span class="st">&quot;90%&quot;</span>,<span class="st">&quot;80%&quot;</span>,<span class="st">&quot;&lt;80%&quot;</span>), <span class="at">ordered =</span> T)</span>
<span id="cb332-68"><a href="stats_method.html#cb332-68" tabindex="-1"></a>    )</span>
<span id="cb332-69"><a href="stats_method.html#cb332-69" tabindex="-1"></a>}</span>
<span id="cb332-70"><a href="stats_method.html#cb332-70" tabindex="-1"></a></span>
<span id="cb332-71"><a href="stats_method.html#cb332-71" tabindex="-1"></a><span class="do">############################################</span></span>
<span id="cb332-72"><a href="stats_method.html#cb332-72" tabindex="-1"></a><span class="co"># plot the contrast</span></span>
<span id="cb332-73"><a href="stats_method.html#cb332-73" tabindex="-1"></a><span class="do">############################################</span></span>
<span id="cb332-74"><a href="stats_method.html#cb332-74" tabindex="-1"></a>plt_contrast <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb332-75"><a href="stats_method.html#cb332-75" tabindex="-1"></a>    my_data</span>
<span id="cb332-76"><a href="stats_method.html#cb332-76" tabindex="-1"></a>    , <span class="at">x =</span> <span class="st">&quot;value&quot;</span></span>
<span id="cb332-77"><a href="stats_method.html#cb332-77" tabindex="-1"></a>    , <span class="at">y =</span> <span class="st">&quot;contrast&quot;</span></span>
<span id="cb332-78"><a href="stats_method.html#cb332-78" tabindex="-1"></a>    , <span class="at">fill =</span> <span class="st">&quot;pr_diff&quot;</span></span>
<span id="cb332-79"><a href="stats_method.html#cb332-79" tabindex="-1"></a>    , <span class="at">label =</span> <span class="st">&quot;pr_diff_lab&quot;</span></span>
<span id="cb332-80"><a href="stats_method.html#cb332-80" tabindex="-1"></a>    , <span class="at">label_pos =</span> <span class="st">&quot;pr_diff_lab_pos&quot;</span></span>
<span id="cb332-81"><a href="stats_method.html#cb332-81" tabindex="-1"></a>    , <span class="at">label_size =</span> <span class="dv">3</span></span>
<span id="cb332-82"><a href="stats_method.html#cb332-82" tabindex="-1"></a>    , <span class="at">x_expand =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.1</span>)</span>
<span id="cb332-83"><a href="stats_method.html#cb332-83" tabindex="-1"></a>    , <span class="at">facet =</span> <span class="cn">NA</span></span>
<span id="cb332-84"><a href="stats_method.html#cb332-84" tabindex="-1"></a>    , <span class="at">y_axis_title =</span> <span class="st">&quot;&quot;</span></span>
<span id="cb332-85"><a href="stats_method.html#cb332-85" tabindex="-1"></a>    , <span class="at">x_axis_title =</span> <span class="st">&quot;difference&quot;</span></span>
<span id="cb332-86"><a href="stats_method.html#cb332-86" tabindex="-1"></a>    , <span class="at">caption_text =</span> <span class="st">&quot;&quot;</span> <span class="co"># form_temp</span></span>
<span id="cb332-87"><a href="stats_method.html#cb332-87" tabindex="-1"></a>    , <span class="at">annotate_size =</span> <span class="fl">2.2</span></span>
<span id="cb332-88"><a href="stats_method.html#cb332-88" tabindex="-1"></a>    , <span class="at">annotate_which =</span> <span class="st">&quot;both&quot;</span> <span class="co"># &quot;both&quot;, &quot;left&quot;, &quot;right&quot;</span></span>
<span id="cb332-89"><a href="stats_method.html#cb332-89" tabindex="-1"></a>    , <span class="at">include_zero =</span> T</span>
<span id="cb332-90"><a href="stats_method.html#cb332-90" tabindex="-1"></a>    ) {</span>
<span id="cb332-91"><a href="stats_method.html#cb332-91" tabindex="-1"></a>  <span class="co"># df for annotation</span></span>
<span id="cb332-92"><a href="stats_method.html#cb332-92" tabindex="-1"></a>  get_annotation_df <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb332-93"><a href="stats_method.html#cb332-93" tabindex="-1"></a>        <span class="at">my_text_list =</span> <span class="fu">c</span>(</span>
<span id="cb332-94"><a href="stats_method.html#cb332-94" tabindex="-1"></a>          <span class="st">&quot;Bottom Left (h0,v0)&quot;</span>,<span class="st">&quot;Top Left (h0,v1)&quot;</span></span>
<span id="cb332-95"><a href="stats_method.html#cb332-95" tabindex="-1"></a>          ,<span class="st">&quot;Bottom Right h1,v0&quot;</span>,<span class="st">&quot;Top Right h1,v1&quot;</span></span>
<span id="cb332-96"><a href="stats_method.html#cb332-96" tabindex="-1"></a>          )</span>
<span id="cb332-97"><a href="stats_method.html#cb332-97" tabindex="-1"></a>        , <span class="at">hjust =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>) <span class="co"># higher values = right, lower values = left </span></span>
<span id="cb332-98"><a href="stats_method.html#cb332-98" tabindex="-1"></a>        , <span class="at">vjust =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">1.3</span>,<span class="dv">0</span>,<span class="fl">1.3</span>) <span class="co"># higher values = down, lower values = up</span></span>
<span id="cb332-99"><a href="stats_method.html#cb332-99" tabindex="-1"></a>    ){</span>
<span id="cb332-100"><a href="stats_method.html#cb332-100" tabindex="-1"></a>      df <span class="ot">=</span> <span class="fu">data.frame</span>(</span>
<span id="cb332-101"><a href="stats_method.html#cb332-101" tabindex="-1"></a>        <span class="at">xpos =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="cn">Inf</span>,<span class="sc">-</span><span class="cn">Inf</span>,<span class="cn">Inf</span>,<span class="cn">Inf</span>)</span>
<span id="cb332-102"><a href="stats_method.html#cb332-102" tabindex="-1"></a>        , <span class="at">ypos =</span>  <span class="fu">c</span>(<span class="sc">-</span><span class="cn">Inf</span>, <span class="cn">Inf</span>,<span class="sc">-</span><span class="cn">Inf</span>,<span class="cn">Inf</span>)</span>
<span id="cb332-103"><a href="stats_method.html#cb332-103" tabindex="-1"></a>        , <span class="at">annotate_text =</span> my_text_list</span>
<span id="cb332-104"><a href="stats_method.html#cb332-104" tabindex="-1"></a>        , <span class="at">hjustvar =</span> hjust</span>
<span id="cb332-105"><a href="stats_method.html#cb332-105" tabindex="-1"></a>        , <span class="at">vjustvar =</span> vjust</span>
<span id="cb332-106"><a href="stats_method.html#cb332-106" tabindex="-1"></a>      )  </span>
<span id="cb332-107"><a href="stats_method.html#cb332-107" tabindex="-1"></a>      <span class="fu">return</span>(df)</span>
<span id="cb332-108"><a href="stats_method.html#cb332-108" tabindex="-1"></a>  }</span>
<span id="cb332-109"><a href="stats_method.html#cb332-109" tabindex="-1"></a>  </span>
<span id="cb332-110"><a href="stats_method.html#cb332-110" tabindex="-1"></a>  <span class="cf">if</span>(annotate_which<span class="sc">==</span><span class="st">&quot;left&quot;</span>){</span>
<span id="cb332-111"><a href="stats_method.html#cb332-111" tabindex="-1"></a>    text_list <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb332-112"><a href="stats_method.html#cb332-112" tabindex="-1"></a>      <span class="st">&quot;&quot;</span>,<span class="st">&quot;L.H.S. &lt; R.H.S.&quot;</span></span>
<span id="cb332-113"><a href="stats_method.html#cb332-113" tabindex="-1"></a>      ,<span class="st">&quot;&quot;</span>,<span class="st">&quot;&quot;</span></span>
<span id="cb332-114"><a href="stats_method.html#cb332-114" tabindex="-1"></a>    )</span>
<span id="cb332-115"><a href="stats_method.html#cb332-115" tabindex="-1"></a>  }<span class="cf">else</span> <span class="cf">if</span>(annotate_which<span class="sc">==</span><span class="st">&quot;right&quot;</span>){</span>
<span id="cb332-116"><a href="stats_method.html#cb332-116" tabindex="-1"></a>    text_list <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb332-117"><a href="stats_method.html#cb332-117" tabindex="-1"></a>      <span class="st">&quot;&quot;</span>,<span class="st">&quot;&quot;</span></span>
<span id="cb332-118"><a href="stats_method.html#cb332-118" tabindex="-1"></a>      ,<span class="st">&quot;&quot;</span>,<span class="st">&quot;L.H.S. &gt; R.H.S.&quot;</span></span>
<span id="cb332-119"><a href="stats_method.html#cb332-119" tabindex="-1"></a>    )</span>
<span id="cb332-120"><a href="stats_method.html#cb332-120" tabindex="-1"></a>  }<span class="cf">else</span>{</span>
<span id="cb332-121"><a href="stats_method.html#cb332-121" tabindex="-1"></a>    text_list <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb332-122"><a href="stats_method.html#cb332-122" tabindex="-1"></a>      <span class="st">&quot;&quot;</span>,<span class="st">&quot;L.H.S. &lt; R.H.S.&quot;</span></span>
<span id="cb332-123"><a href="stats_method.html#cb332-123" tabindex="-1"></a>      ,<span class="st">&quot;&quot;</span>,<span class="st">&quot;L.H.S. &gt; R.H.S.&quot;</span></span>
<span id="cb332-124"><a href="stats_method.html#cb332-124" tabindex="-1"></a>    )</span>
<span id="cb332-125"><a href="stats_method.html#cb332-125" tabindex="-1"></a>  }</span>
<span id="cb332-126"><a href="stats_method.html#cb332-126" tabindex="-1"></a>  </span>
<span id="cb332-127"><a href="stats_method.html#cb332-127" tabindex="-1"></a>  <span class="co"># plot base</span></span>
<span id="cb332-128"><a href="stats_method.html#cb332-128" tabindex="-1"></a>  plt <span class="ot">&lt;-</span>  </span>
<span id="cb332-129"><a href="stats_method.html#cb332-129" tabindex="-1"></a>    my_data <span class="sc">%&gt;%</span></span>
<span id="cb332-130"><a href="stats_method.html#cb332-130" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> .data[[x]], <span class="at">y =</span> .data[[y]])) </span>
<span id="cb332-131"><a href="stats_method.html#cb332-131" tabindex="-1"></a>  </span>
<span id="cb332-132"><a href="stats_method.html#cb332-132" tabindex="-1"></a>  <span class="cf">if</span>(include_zero){</span>
<span id="cb332-133"><a href="stats_method.html#cb332-133" tabindex="-1"></a>    plt <span class="ot">&lt;-</span> plt <span class="sc">+</span> <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">&quot;solid&quot;</span>, <span class="at">color =</span> <span class="st">&quot;gray33&quot;</span>, <span class="at">lwd =</span> <span class="fl">1.1</span>)</span>
<span id="cb332-134"><a href="stats_method.html#cb332-134" tabindex="-1"></a>  }</span>
<span id="cb332-135"><a href="stats_method.html#cb332-135" tabindex="-1"></a>  <span class="co"># plot meat</span></span>
<span id="cb332-136"><a href="stats_method.html#cb332-136" tabindex="-1"></a>  plt <span class="ot">&lt;-</span> plt <span class="sc">+</span></span>
<span id="cb332-137"><a href="stats_method.html#cb332-137" tabindex="-1"></a>      tidybayes<span class="sc">::</span><span class="fu">stat_halfeye</span>(</span>
<span id="cb332-138"><a href="stats_method.html#cb332-138" tabindex="-1"></a>        <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">fill =</span> .data[[fill]])</span>
<span id="cb332-139"><a href="stats_method.html#cb332-139" tabindex="-1"></a>        , <span class="at">point_interval =</span> median_hdi, <span class="at">.width =</span> <span class="fu">c</span>(<span class="fl">0.5</span>,<span class="fl">0.95</span>)</span>
<span id="cb332-140"><a href="stats_method.html#cb332-140" tabindex="-1"></a>        <span class="co"># , slab_fill = &quot;gray22&quot;, slab_alpha = 1</span></span>
<span id="cb332-141"><a href="stats_method.html#cb332-141" tabindex="-1"></a>        , <span class="at">interval_color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">point_color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">point_fill =</span> <span class="st">&quot;black&quot;</span></span>
<span id="cb332-142"><a href="stats_method.html#cb332-142" tabindex="-1"></a>        , <span class="at">point_size =</span> <span class="fl">0.9</span></span>
<span id="cb332-143"><a href="stats_method.html#cb332-143" tabindex="-1"></a>        , <span class="at">justification =</span> <span class="sc">-</span><span class="fl">0.01</span></span>
<span id="cb332-144"><a href="stats_method.html#cb332-144" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb332-145"><a href="stats_method.html#cb332-145" tabindex="-1"></a>      <span class="fu">geom_text</span>(</span>
<span id="cb332-146"><a href="stats_method.html#cb332-146" tabindex="-1"></a>        <span class="at">data =</span> <span class="fu">get_annotation_df</span>(</span>
<span id="cb332-147"><a href="stats_method.html#cb332-147" tabindex="-1"></a>          <span class="at">my_text_list =</span> text_list</span>
<span id="cb332-148"><a href="stats_method.html#cb332-148" tabindex="-1"></a>        )</span>
<span id="cb332-149"><a href="stats_method.html#cb332-149" tabindex="-1"></a>        , <span class="at">mapping =</span> <span class="fu">aes</span>(</span>
<span id="cb332-150"><a href="stats_method.html#cb332-150" tabindex="-1"></a>          <span class="at">x =</span> xpos, <span class="at">y =</span> ypos</span>
<span id="cb332-151"><a href="stats_method.html#cb332-151" tabindex="-1"></a>          , <span class="at">hjust =</span> hjustvar, <span class="at">vjust =</span> vjustvar</span>
<span id="cb332-152"><a href="stats_method.html#cb332-152" tabindex="-1"></a>          , <span class="at">label =</span> annotate_text</span>
<span id="cb332-153"><a href="stats_method.html#cb332-153" tabindex="-1"></a>          , <span class="at">fontface =</span> <span class="st">&quot;bold&quot;</span></span>
<span id="cb332-154"><a href="stats_method.html#cb332-154" tabindex="-1"></a>        )</span>
<span id="cb332-155"><a href="stats_method.html#cb332-155" tabindex="-1"></a>        , <span class="at">size =</span> annotate_size</span>
<span id="cb332-156"><a href="stats_method.html#cb332-156" tabindex="-1"></a>        , <span class="at">color =</span> <span class="st">&quot;gray30&quot;</span> <span class="co"># &quot;#2d2a4d&quot; #&quot;#204445&quot;</span></span>
<span id="cb332-157"><a href="stats_method.html#cb332-157" tabindex="-1"></a>      ) <span class="sc">+</span> </span>
<span id="cb332-158"><a href="stats_method.html#cb332-158" tabindex="-1"></a>      <span class="co"># scale_fill_fermenter(</span></span>
<span id="cb332-159"><a href="stats_method.html#cb332-159" tabindex="-1"></a>      <span class="co">#   n.breaks = 5 # 10 use 10 if can go full range 0-1</span></span>
<span id="cb332-160"><a href="stats_method.html#cb332-160" tabindex="-1"></a>      <span class="co">#   , palette = &quot;PuOr&quot; # &quot;RdYlBu&quot;</span></span>
<span id="cb332-161"><a href="stats_method.html#cb332-161" tabindex="-1"></a>      <span class="co">#   , direction = 1</span></span>
<span id="cb332-162"><a href="stats_method.html#cb332-162" tabindex="-1"></a>      <span class="co">#   , limits = c(0.5,1) # use c(0,1) if can go full range 0-1</span></span>
<span id="cb332-163"><a href="stats_method.html#cb332-163" tabindex="-1"></a>      <span class="co">#   , labels = scales::percent</span></span>
<span id="cb332-164"><a href="stats_method.html#cb332-164" tabindex="-1"></a>      <span class="co"># ) +</span></span>
<span id="cb332-165"><a href="stats_method.html#cb332-165" tabindex="-1"></a>      <span class="fu">scale_fill_stepsn</span>(</span>
<span id="cb332-166"><a href="stats_method.html#cb332-166" tabindex="-1"></a>        <span class="at">n.breaks =</span> <span class="dv">5</span> <span class="co"># 10 use 10 if can go full range 0-1</span></span>
<span id="cb332-167"><a href="stats_method.html#cb332-167" tabindex="-1"></a>        , <span class="at">colors =</span> harrypotter<span class="sc">::</span><span class="fu">hp</span>(<span class="at">n=</span><span class="dv">5</span>, <span class="at">option=</span><span class="st">&quot;ravenclaw&quot;</span>, <span class="at">direction =</span> <span class="sc">-</span><span class="dv">1</span>) <span class="co"># RColorBrewer::brewer.pal(11,&quot;PuOr&quot;)[c(3,4,8,10,11)]</span></span>
<span id="cb332-168"><a href="stats_method.html#cb332-168" tabindex="-1"></a>        , <span class="at">limits =</span> <span class="fu">c</span>(<span class="fl">0.5</span>,<span class="dv">1</span>) <span class="co"># use c(0,1) if can go full range 0-1</span></span>
<span id="cb332-169"><a href="stats_method.html#cb332-169" tabindex="-1"></a>        , <span class="at">labels =</span> scales<span class="sc">::</span>percent</span>
<span id="cb332-170"><a href="stats_method.html#cb332-170" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb332-171"><a href="stats_method.html#cb332-171" tabindex="-1"></a>      <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> x_expand)) <span class="sc">+</span></span>
<span id="cb332-172"><a href="stats_method.html#cb332-172" tabindex="-1"></a>      <span class="fu">labs</span>(</span>
<span id="cb332-173"><a href="stats_method.html#cb332-173" tabindex="-1"></a>        <span class="at">y =</span> y_axis_title</span>
<span id="cb332-174"><a href="stats_method.html#cb332-174" tabindex="-1"></a>        , <span class="at">x =</span> x_axis_title</span>
<span id="cb332-175"><a href="stats_method.html#cb332-175" tabindex="-1"></a>        , <span class="at">fill =</span> <span class="st">&quot;Pr(contrast)&quot;</span></span>
<span id="cb332-176"><a href="stats_method.html#cb332-176" tabindex="-1"></a>        , <span class="at">subtitle =</span> <span class="st">&quot;posterior predictive distribution of group constrasts with 95% &amp; 50% HDI&quot;</span></span>
<span id="cb332-177"><a href="stats_method.html#cb332-177" tabindex="-1"></a>        , <span class="at">caption =</span> caption_text</span>
<span id="cb332-178"><a href="stats_method.html#cb332-178" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb332-179"><a href="stats_method.html#cb332-179" tabindex="-1"></a>      <span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb332-180"><a href="stats_method.html#cb332-180" tabindex="-1"></a>      <span class="fu">theme</span>(</span>
<span id="cb332-181"><a href="stats_method.html#cb332-181" tabindex="-1"></a>        <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">7</span>)</span>
<span id="cb332-182"><a href="stats_method.html#cb332-182" tabindex="-1"></a>        , <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>)</span>
<span id="cb332-183"><a href="stats_method.html#cb332-183" tabindex="-1"></a>        , <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>, <span class="at">vjust =</span> <span class="fl">0.5</span>, <span class="at">hjust =</span> <span class="fl">1.05</span>)</span>
<span id="cb332-184"><a href="stats_method.html#cb332-184" tabindex="-1"></a>        , <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb332-185"><a href="stats_method.html#cb332-185" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb332-186"><a href="stats_method.html#cb332-186" tabindex="-1"></a>      <span class="fu">guides</span>(<span class="at">fill =</span> <span class="fu">guide_colorbar</span>(<span class="at">theme =</span> <span class="fu">theme</span>(</span>
<span id="cb332-187"><a href="stats_method.html#cb332-187" tabindex="-1"></a>        <span class="at">legend.key.width  =</span> <span class="fu">unit</span>(<span class="dv">1</span>, <span class="st">&quot;lines&quot;</span>),</span>
<span id="cb332-188"><a href="stats_method.html#cb332-188" tabindex="-1"></a>        <span class="at">legend.key.height =</span> <span class="fu">unit</span>(<span class="dv">12</span>, <span class="st">&quot;lines&quot;</span>)</span>
<span id="cb332-189"><a href="stats_method.html#cb332-189" tabindex="-1"></a>      )))</span>
<span id="cb332-190"><a href="stats_method.html#cb332-190" tabindex="-1"></a>  </span>
<span id="cb332-191"><a href="stats_method.html#cb332-191" tabindex="-1"></a>  <span class="co"># label or not</span></span>
<span id="cb332-192"><a href="stats_method.html#cb332-192" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.na</span>(label) <span class="sc">&amp;&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(label_pos) <span class="sc">&amp;&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(label_size)){</span>
<span id="cb332-193"><a href="stats_method.html#cb332-193" tabindex="-1"></a>    plt <span class="ot">&lt;-</span> plt <span class="sc">+</span></span>
<span id="cb332-194"><a href="stats_method.html#cb332-194" tabindex="-1"></a>      <span class="fu">geom_text</span>(</span>
<span id="cb332-195"><a href="stats_method.html#cb332-195" tabindex="-1"></a>          <span class="at">data =</span> my_data <span class="sc">%&gt;%</span></span>
<span id="cb332-196"><a href="stats_method.html#cb332-196" tabindex="-1"></a>            dplyr<span class="sc">::</span><span class="fu">filter</span>(pr_diff_lab_pos<span class="sc">&gt;=</span><span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb332-197"><a href="stats_method.html#cb332-197" tabindex="-1"></a>            dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb332-198"><a href="stats_method.html#cb332-198" tabindex="-1"></a>            dplyr<span class="sc">::</span><span class="fu">select</span>(tidyselect<span class="sc">::</span><span class="fu">all_of</span>(<span class="fu">c</span>(</span>
<span id="cb332-199"><a href="stats_method.html#cb332-199" tabindex="-1"></a>              y</span>
<span id="cb332-200"><a href="stats_method.html#cb332-200" tabindex="-1"></a>              , fill</span>
<span id="cb332-201"><a href="stats_method.html#cb332-201" tabindex="-1"></a>              , label</span>
<span id="cb332-202"><a href="stats_method.html#cb332-202" tabindex="-1"></a>              , label_pos</span>
<span id="cb332-203"><a href="stats_method.html#cb332-203" tabindex="-1"></a>              , facet</span>
<span id="cb332-204"><a href="stats_method.html#cb332-204" tabindex="-1"></a>            ))) <span class="sc">%&gt;%</span> </span>
<span id="cb332-205"><a href="stats_method.html#cb332-205" tabindex="-1"></a>            dplyr<span class="sc">::</span><span class="fu">distinct</span>()</span>
<span id="cb332-206"><a href="stats_method.html#cb332-206" tabindex="-1"></a>          , <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> .data[[label_pos]], <span class="at">label =</span> .data[[label]])</span>
<span id="cb332-207"><a href="stats_method.html#cb332-207" tabindex="-1"></a>          , <span class="at">vjust =</span> <span class="sc">-</span><span class="dv">1</span>, <span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">size =</span> label_size</span>
<span id="cb332-208"><a href="stats_method.html#cb332-208" tabindex="-1"></a>        ) <span class="sc">+</span></span>
<span id="cb332-209"><a href="stats_method.html#cb332-209" tabindex="-1"></a>        <span class="fu">geom_text</span>(</span>
<span id="cb332-210"><a href="stats_method.html#cb332-210" tabindex="-1"></a>          <span class="at">data =</span> my_data <span class="sc">%&gt;%</span></span>
<span id="cb332-211"><a href="stats_method.html#cb332-211" tabindex="-1"></a>            dplyr<span class="sc">::</span><span class="fu">filter</span>(pr_diff_lab_pos<span class="sc">&lt;</span><span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb332-212"><a href="stats_method.html#cb332-212" tabindex="-1"></a>            dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb332-213"><a href="stats_method.html#cb332-213" tabindex="-1"></a>            dplyr<span class="sc">::</span><span class="fu">select</span>(tidyselect<span class="sc">::</span><span class="fu">all_of</span>(<span class="fu">c</span>(</span>
<span id="cb332-214"><a href="stats_method.html#cb332-214" tabindex="-1"></a>              y</span>
<span id="cb332-215"><a href="stats_method.html#cb332-215" tabindex="-1"></a>              , fill</span>
<span id="cb332-216"><a href="stats_method.html#cb332-216" tabindex="-1"></a>              , label</span>
<span id="cb332-217"><a href="stats_method.html#cb332-217" tabindex="-1"></a>              , label_pos</span>
<span id="cb332-218"><a href="stats_method.html#cb332-218" tabindex="-1"></a>              , facet</span>
<span id="cb332-219"><a href="stats_method.html#cb332-219" tabindex="-1"></a>            ))) <span class="sc">%&gt;%</span> </span>
<span id="cb332-220"><a href="stats_method.html#cb332-220" tabindex="-1"></a>            dplyr<span class="sc">::</span><span class="fu">distinct</span>()</span>
<span id="cb332-221"><a href="stats_method.html#cb332-221" tabindex="-1"></a>          , <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> .data[[label_pos]], <span class="at">label =</span> .data[[label]])</span>
<span id="cb332-222"><a href="stats_method.html#cb332-222" tabindex="-1"></a>          , <span class="at">vjust =</span> <span class="sc">-</span><span class="dv">1</span>, <span class="at">hjust =</span> <span class="sc">+</span><span class="dv">1</span>, <span class="at">size =</span> label_size</span>
<span id="cb332-223"><a href="stats_method.html#cb332-223" tabindex="-1"></a>        )</span>
<span id="cb332-224"><a href="stats_method.html#cb332-224" tabindex="-1"></a>  }</span>
<span id="cb332-225"><a href="stats_method.html#cb332-225" tabindex="-1"></a>  </span>
<span id="cb332-226"><a href="stats_method.html#cb332-226" tabindex="-1"></a>  <span class="co"># return facet or not</span></span>
<span id="cb332-227"><a href="stats_method.html#cb332-227" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">max</span>(<span class="fu">is.na</span>(facet))<span class="sc">==</span><span class="dv">0</span>){</span>
<span id="cb332-228"><a href="stats_method.html#cb332-228" tabindex="-1"></a>    <span class="fu">return</span>(</span>
<span id="cb332-229"><a href="stats_method.html#cb332-229" tabindex="-1"></a>      plt <span class="sc">+</span></span>
<span id="cb332-230"><a href="stats_method.html#cb332-230" tabindex="-1"></a>        <span class="fu">facet_grid</span>(<span class="at">cols =</span> <span class="fu">vars</span>(.data[[facet]]))</span>
<span id="cb332-231"><a href="stats_method.html#cb332-231" tabindex="-1"></a>    )</span>
<span id="cb332-232"><a href="stats_method.html#cb332-232" tabindex="-1"></a>  }</span>
<span id="cb332-233"><a href="stats_method.html#cb332-233" tabindex="-1"></a>  <span class="cf">else</span>{<span class="fu">return</span>(plt)}</span>
<span id="cb332-234"><a href="stats_method.html#cb332-234" tabindex="-1"></a>}</span></code></pre></div>
<p>now get the posterior predictive draws</p>
<div class="sourceCode" id="cb333"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb333-1"><a href="stats_method.html#cb333-1" tabindex="-1"></a>draws_temp <span class="ot">&lt;-</span> </span>
<span id="cb333-2"><a href="stats_method.html#cb333-2" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">crossing</span>(</span>
<span id="cb333-3"><a href="stats_method.html#cb333-3" tabindex="-1"></a>    structural_params_settings</span>
<span id="cb333-4"><a href="stats_method.html#cb333-4" tabindex="-1"></a>    , param_combos_spectral_ranked <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">distinct</span>(spectral_weight_fact, spectral_weight)</span>
<span id="cb333-5"><a href="stats_method.html#cb333-5" tabindex="-1"></a>    , param_combos_spectral_ranked <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">distinct</span>(chm_res_m)</span>
<span id="cb333-6"><a href="stats_method.html#cb333-6" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb333-7"><a href="stats_method.html#cb333-7" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">add_epred_draws</span>(brms_f_score_mod, <span class="at">ndraws =</span> <span class="dv">1111</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb333-8"><a href="stats_method.html#cb333-8" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">value =</span> .epred)</span>
<span id="cb333-9"><a href="stats_method.html#cb333-9" tabindex="-1"></a><span class="co"># # huh?</span></span>
<span id="cb333-10"><a href="stats_method.html#cb333-10" tabindex="-1"></a>draws_temp <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">glimpse</span>()</span></code></pre></div>
<pre><code>## Rows: 33,330
## Columns: 12
## Groups: circle_fit_iou_pct, convexity_pct, max_ht_m, max_area_m2, spectral_weight_fact, spectral_weight, chm_res_m, .row [30]
## $ circle_fit_iou_pct   &lt;dbl&gt; 0.35, 0.35, 0.35, 0.35, 0.35, 0.35, 0.35, 0.35, 0…
## $ convexity_pct        &lt;dbl&gt; 0.36, 0.36, 0.36, 0.36, 0.36, 0.36, 0.36, 0.36, 0…
## $ max_ht_m             &lt;dbl&gt; 2.3, 2.3, 2.3, 2.3, 2.3, 2.3, 2.3, 2.3, 2.3, 2.3,…
## $ max_area_m2          &lt;dbl&gt; 46, 46, 46, 46, 46, 46, 46, 46, 46, 46, 46, 46, 4…
## $ spectral_weight_fact &lt;fct&gt; structural only, structural only, structural only…
## $ spectral_weight      &lt;fct&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…
## $ chm_res_m            &lt;dbl&gt; 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1,…
## $ .row                 &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1…
## $ .chain               &lt;int&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
## $ .iteration           &lt;int&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
## $ .draw                &lt;int&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15…
## $ value                &lt;dbl&gt; 0.8102877, 0.8088862, 0.8099895, 0.8118048, 0.811…</code></pre>
<div id="chm-resolution" class="section level5 hasAnchor" number="9.1.5.2.1">
<h5><span class="header-section-number">9.1.5.2.1</span> CHM resolution<a href="stats_method.html#chm-resolution" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>first, we’ll look at the impact of changing CHM resolution by the <code>spectral_weight</code> parameter where a value of “0” indicates no spectral data was used (i.e. structural only), the lowest weighting of the spectral data is “1” (only one spectral index threshold must be met), and the highest weighting of spectral data is “5” (all spectral index thresholds must be met).</p>
<p>our questions regarding CHM resolution were:</p>
<ul>
<li>question 1: <em>does CHM resolution influences detection accuracy?</em></li>
<li>question 2: <em>does the effect of CHM resolution change based on the inclusion of spectral data versus using only structural data?</em></li>
</ul>
<p>we can answer those questions using our model by considering the credible slope of the CHM resolution predictor as a function of the <code>spectral_weight</code> parameter (e.g. Kurz <a href="https://bookdown.org/content/3686/18.html">2025</a>; <a href="https://sites.google.com/site/doingbayesiandataanalysis/">Kruschke (2015, Ch. 18)</a>)</p>
<div class="sourceCode" id="cb335"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb335-1"><a href="stats_method.html#cb335-1" tabindex="-1"></a>pal_spectral_weight <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;gray77&quot;</span>, harrypotter<span class="sc">::</span><span class="fu">hp</span>(<span class="at">n=</span><span class="dv">5</span>, <span class="at">option =</span> <span class="st">&quot;gryffindor&quot;</span>, <span class="at">direction =</span> <span class="dv">1</span>)) <span class="co"># %&gt;%  scales::show_col()</span></span>
<span id="cb335-2"><a href="stats_method.html#cb335-2" tabindex="-1"></a><span class="co"># brms::posterior_summary(brms_f_score_mod)</span></span>
<span id="cb335-3"><a href="stats_method.html#cb335-3" tabindex="-1"></a>draws_temp <span class="sc">%&gt;%</span> </span>
<span id="cb335-4"><a href="stats_method.html#cb335-4" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> chm_res_m, <span class="at">y =</span> value, <span class="at">color =</span> spectral_weight)) <span class="sc">+</span></span>
<span id="cb335-5"><a href="stats_method.html#cb335-5" tabindex="-1"></a>  <span class="co"># tidybayes::stat_halfeye() +</span></span>
<span id="cb335-6"><a href="stats_method.html#cb335-6" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">stat_lineribbon</span>(<span class="at">point_interval =</span> <span class="st">&quot;median_hdi&quot;</span>, <span class="at">.width =</span> <span class="fu">c</span>(<span class="fl">0.95</span>)) <span class="sc">+</span></span>
<span id="cb335-7"><a href="stats_method.html#cb335-7" tabindex="-1"></a>  <span class="co"># ggplot2::facet_wrap(facets = dplyr::vars(spectral_weight))</span></span>
<span id="cb335-8"><a href="stats_method.html#cb335-8" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_fill_brewer</span>(<span class="at">palette =</span> <span class="st">&quot;Greys&quot;</span>) <span class="sc">+</span></span>
<span id="cb335-9"><a href="stats_method.html#cb335-9" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_color_manual</span>(<span class="at">values =</span> pal_spectral_weight) <span class="sc">+</span></span>
<span id="cb335-10"><a href="stats_method.html#cb335-10" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>percent) <span class="sc">+</span></span>
<span id="cb335-11"><a href="stats_method.html#cb335-11" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;CHM resolution&quot;</span>, <span class="at">y =</span> <span class="st">&quot;F-score&quot;</span>) <span class="sc">+</span></span>
<span id="cb335-12"><a href="stats_method.html#cb335-12" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb335-13"><a href="stats_method.html#cb335-13" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb335-14"><a href="stats_method.html#cb335-14" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;top&quot;</span></span>
<span id="cb335-15"><a href="stats_method.html#cb335-15" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb335-16"><a href="stats_method.html#cb335-16" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">guides</span>(</span>
<span id="cb335-17"><a href="stats_method.html#cb335-17" tabindex="-1"></a>    <span class="at">color =</span> ggplot2<span class="sc">::</span><span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">shape =</span> <span class="dv">15</span>, <span class="at">lwd =</span> <span class="dv">8</span>, <span class="at">fill =</span> <span class="cn">NA</span>))</span>
<span id="cb335-18"><a href="stats_method.html#cb335-18" tabindex="-1"></a>    , <span class="at">fill =</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb335-19"><a href="stats_method.html#cb335-19" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-316-1.png" width="1008" /></p>
<p>there are a few takeaways from this plot:</p>
<ul>
<li>including spectral data and setting the <code>spectral_weight</code> to “1”, “2”, or “3” appears to be not much different than not including spectral data at all (but we’ll probabilistically test this later on)</li>
<li>including spectral data and setting the <code>spectral_weight</code> to “4” yields a larger negative impact of decreasing CHM resolution on detection accuracy</li>
<li>including spectral data and setting the <code>spectral_weight</code> to “5” yields a smaller negative impact of decreasing CHM resolution on detection accuracy and beyond a CHM resolution of ~0.13 m, detection accuracy is maximized when setting the <code>spectral_weight</code> to “5”. this makes intuitive sense because as the structural information about slash piles becomes less fine grain (i.e. more coarse), we should put more weight into the spectral data for detecting slash piles</li>
</ul>
<p>all of this is to say that the impact of CHM resolution varies based on the <code>spectral_weight</code> setting and vice-versa</p>
<p>averaging across all other parameters to look at the main effect of including spectral data with the <code>spectral_weight</code> parameter, these results align with what we saw during our data summarization exploration: increasing the <code>spectral_weight</code> (where “5” requires all spectral index thresholds to be met) had minimal impact on metrics until a value of “3”, at which point F-score saw a minimal increase; at a <code>spectral_weight</code> of “4”, the F-score significantly improved, but at a value of “5” F-score was lower than not including the spectral data at all when CHM resolution was fine (e.g. &lt;0.3) but for coarse resolution CHM data the spectral data became more important for detection accuracy.</p>
<p>let’s test including predictions at CHM resolutions outside of the bounds of the data tested (e.g. &gt; 0.5 m resolution)</p>
<div class="sourceCode" id="cb336"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb336-1"><a href="stats_method.html#cb336-1" tabindex="-1"></a>tidyr<span class="sc">::</span><span class="fu">crossing</span>(</span>
<span id="cb336-2"><a href="stats_method.html#cb336-2" tabindex="-1"></a>    structural_params_settings</span>
<span id="cb336-3"><a href="stats_method.html#cb336-3" tabindex="-1"></a>    , param_combos_spectral_ranked <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">distinct</span>(spectral_weight_fact, spectral_weight)</span>
<span id="cb336-4"><a href="stats_method.html#cb336-4" tabindex="-1"></a>    , <span class="at">chm_res_m =</span> <span class="fu">seq</span>(<span class="fl">0.05</span>,<span class="dv">1</span>,<span class="at">by =</span> <span class="fl">0.05</span>)</span>
<span id="cb336-5"><a href="stats_method.html#cb336-5" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb336-6"><a href="stats_method.html#cb336-6" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">add_epred_draws</span>(brms_f_score_mod, <span class="at">ndraws =</span> <span class="dv">1111</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb336-7"><a href="stats_method.html#cb336-7" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">value =</span> .epred) <span class="sc">%&gt;%</span> </span>
<span id="cb336-8"><a href="stats_method.html#cb336-8" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> chm_res_m, <span class="at">y =</span> value, <span class="at">color =</span> spectral_weight)) <span class="sc">+</span></span>
<span id="cb336-9"><a href="stats_method.html#cb336-9" tabindex="-1"></a>  <span class="co"># tidybayes::stat_halfeye() +</span></span>
<span id="cb336-10"><a href="stats_method.html#cb336-10" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">stat_lineribbon</span>(<span class="at">point_interval =</span> <span class="st">&quot;median_hdi&quot;</span>, <span class="at">.width =</span> <span class="fu">c</span>(<span class="fl">0.95</span>)) <span class="sc">+</span></span>
<span id="cb336-11"><a href="stats_method.html#cb336-11" tabindex="-1"></a>  <span class="co"># ggplot2::facet_wrap(facets = dplyr::vars(spectral_weight))</span></span>
<span id="cb336-12"><a href="stats_method.html#cb336-12" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_fill_brewer</span>(<span class="at">palette =</span> <span class="st">&quot;Greys&quot;</span>) <span class="sc">+</span></span>
<span id="cb336-13"><a href="stats_method.html#cb336-13" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_color_manual</span>(<span class="at">values =</span> pal_spectral_weight) <span class="sc">+</span></span>
<span id="cb336-14"><a href="stats_method.html#cb336-14" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>percent) <span class="sc">+</span></span>
<span id="cb336-15"><a href="stats_method.html#cb336-15" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> scales<span class="sc">::</span><span class="fu">breaks_extended</span>(<span class="at">n=</span><span class="dv">8</span>)) <span class="sc">+</span></span>
<span id="cb336-16"><a href="stats_method.html#cb336-16" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;CHM resolution&quot;</span>, <span class="at">y =</span> <span class="st">&quot;F-score&quot;</span>) <span class="sc">+</span></span>
<span id="cb336-17"><a href="stats_method.html#cb336-17" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb336-18"><a href="stats_method.html#cb336-18" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb336-19"><a href="stats_method.html#cb336-19" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;top&quot;</span></span>
<span id="cb336-20"><a href="stats_method.html#cb336-20" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb336-21"><a href="stats_method.html#cb336-21" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">guides</span>(</span>
<span id="cb336-22"><a href="stats_method.html#cb336-22" tabindex="-1"></a>    <span class="at">color =</span> ggplot2<span class="sc">::</span><span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">shape =</span> <span class="dv">15</span>, <span class="at">lwd =</span> <span class="dv">8</span>, <span class="at">fill =</span> <span class="cn">NA</span>))</span>
<span id="cb336-23"><a href="stats_method.html#cb336-23" tabindex="-1"></a>    , <span class="at">fill =</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb336-24"><a href="stats_method.html#cb336-24" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-317-1.png" width="1008" /></p>
<p>even at the coarse CHM resolutions not represented in the data, the model is still confident that coarser resolution CHM data decreases detection accuracy</p>
<p>we can look at the posterior distributions of the expected F-score at different CHM resolution levels by the inclusion (or exclusion) of spectral data and it’s weighting</p>
<div class="sourceCode" id="cb337"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb337-1"><a href="stats_method.html#cb337-1" tabindex="-1"></a>draws_temp <span class="sc">%&gt;%</span> </span>
<span id="cb337-2"><a href="stats_method.html#cb337-2" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">y=</span>value, <span class="at">x=</span>chm_res_m)) <span class="sc">+</span></span>
<span id="cb337-3"><a href="stats_method.html#cb337-3" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">stat_eye</span>(</span>
<span id="cb337-4"><a href="stats_method.html#cb337-4" tabindex="-1"></a>    <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">fill =</span> spectral_weight)</span>
<span id="cb337-5"><a href="stats_method.html#cb337-5" tabindex="-1"></a>    , <span class="at">point_interval =</span> median_hdi, <span class="at">.width =</span> .<span class="dv">95</span></span>
<span id="cb337-6"><a href="stats_method.html#cb337-6" tabindex="-1"></a>    , <span class="at">slab_alpha =</span> <span class="fl">0.95</span></span>
<span id="cb337-7"><a href="stats_method.html#cb337-7" tabindex="-1"></a>    , <span class="at">interval_color =</span> <span class="st">&quot;gray44&quot;</span>, <span class="at">linewidth =</span> <span class="dv">1</span></span>
<span id="cb337-8"><a href="stats_method.html#cb337-8" tabindex="-1"></a>    , <span class="at">point_color =</span> <span class="st">&quot;gray44&quot;</span>, <span class="at">point_fill =</span> <span class="st">&quot;gray44&quot;</span>, <span class="at">point_size =</span> <span class="dv">1</span></span>
<span id="cb337-9"><a href="stats_method.html#cb337-9" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb337-10"><a href="stats_method.html#cb337-10" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">facet_grid</span>(<span class="at">cols =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(spectral_weight), <span class="at">labeller =</span> <span class="st">&quot;label_both&quot;</span>) <span class="sc">+</span></span>
<span id="cb337-11"><a href="stats_method.html#cb337-11" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_fill_manual</span>(<span class="at">values =</span> pal_spectral_weight) <span class="sc">+</span></span>
<span id="cb337-12"><a href="stats_method.html#cb337-12" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="cn">NA</span>), <span class="at">labels =</span> scales<span class="sc">::</span>percent, <span class="at">breaks =</span> scales<span class="sc">::</span><span class="fu">breaks_extended</span>(<span class="dv">16</span>)) <span class="sc">+</span></span>
<span id="cb337-13"><a href="stats_method.html#cb337-13" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;CHM resolution&quot;</span>, <span class="at">y =</span> <span class="st">&quot;F-score&quot;</span>) <span class="sc">+</span></span>
<span id="cb337-14"><a href="stats_method.html#cb337-14" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb337-15"><a href="stats_method.html#cb337-15" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb337-16"><a href="stats_method.html#cb337-16" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb337-17"><a href="stats_method.html#cb337-17" tabindex="-1"></a>    , <span class="at">strip.text =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb337-18"><a href="stats_method.html#cb337-18" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-318-1.png" width="1008" /></p>
<p>table that</p>
<div class="sourceCode" id="cb338"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb338-1"><a href="stats_method.html#cb338-1" tabindex="-1"></a>draws_temp <span class="sc">%&gt;%</span> </span>
<span id="cb338-2"><a href="stats_method.html#cb338-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">spectral_weight =</span> forcats<span class="sc">::</span><span class="fu">fct_relabel</span>(spectral_weight,<span class="sc">~</span><span class="fu">paste0</span>(<span class="st">&quot;spectral_weight: &quot;</span>, .x, <span class="at">recycle0 =</span> T))) <span class="sc">%&gt;%</span> </span>
<span id="cb338-3"><a href="stats_method.html#cb338-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(spectral_weight, chm_res_m) <span class="sc">%&gt;%</span></span>
<span id="cb338-4"><a href="stats_method.html#cb338-4" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(</span>
<span id="cb338-5"><a href="stats_method.html#cb338-5" tabindex="-1"></a>    <span class="co"># get median_hdi</span></span>
<span id="cb338-6"><a href="stats_method.html#cb338-6" tabindex="-1"></a>    <span class="at">median_hdi_est =</span> tidybayes<span class="sc">::</span><span class="fu">median_hdci</span>(value)<span class="sc">$</span>y</span>
<span id="cb338-7"><a href="stats_method.html#cb338-7" tabindex="-1"></a>    , <span class="at">median_hdi_lower =</span> tidybayes<span class="sc">::</span><span class="fu">median_hdci</span>(value)<span class="sc">$</span>ymin</span>
<span id="cb338-8"><a href="stats_method.html#cb338-8" tabindex="-1"></a>    , <span class="at">median_hdi_upper =</span> tidybayes<span class="sc">::</span><span class="fu">median_hdci</span>(value)<span class="sc">$</span>ymax</span>
<span id="cb338-9"><a href="stats_method.html#cb338-9" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb338-10"><a href="stats_method.html#cb338-10" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb338-11"><a href="stats_method.html#cb338-11" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(spectral_weight, chm_res_m) <span class="sc">%&gt;%</span> </span>
<span id="cb338-12"><a href="stats_method.html#cb338-12" tabindex="-1"></a>  <span class="co"># format pcts</span></span>
<span id="cb338-13"><a href="stats_method.html#cb338-13" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(dplyr<span class="sc">::</span><span class="fu">across</span>(</span>
<span id="cb338-14"><a href="stats_method.html#cb338-14" tabindex="-1"></a>    tidyselect<span class="sc">::</span><span class="fu">starts_with</span>(<span class="st">&quot;median_hdi_&quot;</span>)</span>
<span id="cb338-15"><a href="stats_method.html#cb338-15" tabindex="-1"></a>    , <span class="sc">~</span> scales<span class="sc">::</span><span class="fu">percent</span>(.x, <span class="at">accuracy =</span> <span class="fl">0.1</span>)</span>
<span id="cb338-16"><a href="stats_method.html#cb338-16" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb338-17"><a href="stats_method.html#cb338-17" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kbl</span>(</span>
<span id="cb338-18"><a href="stats_method.html#cb338-18" tabindex="-1"></a>    <span class="at">digits =</span> <span class="dv">2</span></span>
<span id="cb338-19"><a href="stats_method.html#cb338-19" tabindex="-1"></a>    , <span class="at">caption =</span> <span class="st">&quot;F-score&lt;br&gt;95% HDI of the posterior predictive distribution&quot;</span></span>
<span id="cb338-20"><a href="stats_method.html#cb338-20" tabindex="-1"></a>    , <span class="at">col.names =</span> <span class="fu">c</span>(</span>
<span id="cb338-21"><a href="stats_method.html#cb338-21" tabindex="-1"></a>      <span class="st">&quot;spectral_weight&quot;</span>, <span class="st">&quot;CHM resolution&quot;</span></span>
<span id="cb338-22"><a href="stats_method.html#cb338-22" tabindex="-1"></a>      , <span class="fu">c</span>(<span class="st">&quot;F-score&lt;br&gt;median&quot;</span>, <span class="st">&quot;HDI low&quot;</span>, <span class="st">&quot;HDI high&quot;</span>)</span>
<span id="cb338-23"><a href="stats_method.html#cb338-23" tabindex="-1"></a>    )</span>
<span id="cb338-24"><a href="stats_method.html#cb338-24" tabindex="-1"></a>    , <span class="at">escape =</span> F</span>
<span id="cb338-25"><a href="stats_method.html#cb338-25" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb338-26"><a href="stats_method.html#cb338-26" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kable_styling</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb338-27"><a href="stats_method.html#cb338-27" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">collapse_rows</span>(<span class="at">columns =</span> <span class="dv">1</span>, <span class="at">valign =</span> <span class="st">&quot;top&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb338-28"><a href="stats_method.html#cb338-28" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">scroll_box</span>(<span class="at">height =</span> <span class="st">&quot;8in&quot;</span>)</span></code></pre></div>
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:8in; ">
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-319">Table 9.4: </span>F-score<br>95% HDI of the posterior predictive distribution
</caption>
<thead>
<tr>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
spectral_weight
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
CHM resolution
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
F-score<br>median
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
HDI low
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
HDI high
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="5">
spectral_weight: 0
</td>
<td style="text-align:right;">
0.1
</td>
<td style="text-align:left;">
80.9%
</td>
<td style="text-align:left;">
80.2%
</td>
<td style="text-align:left;">
81.5%
</td>
</tr>
<tr>
<td style="text-align:right;">
0.2
</td>
<td style="text-align:left;">
76.0%
</td>
<td style="text-align:left;">
75.3%
</td>
<td style="text-align:left;">
76.6%
</td>
</tr>
<tr>
<td style="text-align:right;">
0.3
</td>
<td style="text-align:left;">
70.3%
</td>
<td style="text-align:left;">
69.7%
</td>
<td style="text-align:left;">
70.9%
</td>
</tr>
<tr>
<td style="text-align:right;">
0.4
</td>
<td style="text-align:left;">
63.9%
</td>
<td style="text-align:left;">
63.1%
</td>
<td style="text-align:left;">
64.7%
</td>
</tr>
<tr>
<td style="text-align:right;">
0.5
</td>
<td style="text-align:left;">
57.0%
</td>
<td style="text-align:left;">
55.8%
</td>
<td style="text-align:left;">
58.1%
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="5">
spectral_weight: 1
</td>
<td style="text-align:right;">
0.1
</td>
<td style="text-align:left;">
80.9%
</td>
<td style="text-align:left;">
80.2%
</td>
<td style="text-align:left;">
81.6%
</td>
</tr>
<tr>
<td style="text-align:right;">
0.2
</td>
<td style="text-align:left;">
76.0%
</td>
<td style="text-align:left;">
75.4%
</td>
<td style="text-align:left;">
76.7%
</td>
</tr>
<tr>
<td style="text-align:right;">
0.3
</td>
<td style="text-align:left;">
70.3%
</td>
<td style="text-align:left;">
69.7%
</td>
<td style="text-align:left;">
71.0%
</td>
</tr>
<tr>
<td style="text-align:right;">
0.4
</td>
<td style="text-align:left;">
63.9%
</td>
<td style="text-align:left;">
63.1%
</td>
<td style="text-align:left;">
64.7%
</td>
</tr>
<tr>
<td style="text-align:right;">
0.5
</td>
<td style="text-align:left;">
57.0%
</td>
<td style="text-align:left;">
55.9%
</td>
<td style="text-align:left;">
58.1%
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="5">
spectral_weight: 2
</td>
<td style="text-align:right;">
0.1
</td>
<td style="text-align:left;">
80.9%
</td>
<td style="text-align:left;">
80.2%
</td>
<td style="text-align:left;">
81.6%
</td>
</tr>
<tr>
<td style="text-align:right;">
0.2
</td>
<td style="text-align:left;">
76.0%
</td>
<td style="text-align:left;">
75.4%
</td>
<td style="text-align:left;">
76.7%
</td>
</tr>
<tr>
<td style="text-align:right;">
0.3
</td>
<td style="text-align:left;">
70.3%
</td>
<td style="text-align:left;">
69.6%
</td>
<td style="text-align:left;">
70.9%
</td>
</tr>
<tr>
<td style="text-align:right;">
0.4
</td>
<td style="text-align:left;">
63.9%
</td>
<td style="text-align:left;">
63.1%
</td>
<td style="text-align:left;">
64.8%
</td>
</tr>
<tr>
<td style="text-align:right;">
0.5
</td>
<td style="text-align:left;">
57.0%
</td>
<td style="text-align:left;">
55.8%
</td>
<td style="text-align:left;">
58.1%
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="5">
spectral_weight: 3
</td>
<td style="text-align:right;">
0.1
</td>
<td style="text-align:left;">
81.3%
</td>
<td style="text-align:left;">
80.7%
</td>
<td style="text-align:left;">
82.1%
</td>
</tr>
<tr>
<td style="text-align:right;">
0.2
</td>
<td style="text-align:left;">
76.5%
</td>
<td style="text-align:left;">
76.0%
</td>
<td style="text-align:left;">
77.3%
</td>
</tr>
<tr>
<td style="text-align:right;">
0.3
</td>
<td style="text-align:left;">
70.9%
</td>
<td style="text-align:left;">
70.3%
</td>
<td style="text-align:left;">
71.5%
</td>
</tr>
<tr>
<td style="text-align:right;">
0.4
</td>
<td style="text-align:left;">
64.6%
</td>
<td style="text-align:left;">
63.8%
</td>
<td style="text-align:left;">
65.4%
</td>
</tr>
<tr>
<td style="text-align:right;">
0.5
</td>
<td style="text-align:left;">
57.7%
</td>
<td style="text-align:left;">
56.4%
</td>
<td style="text-align:left;">
58.7%
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="5">
spectral_weight: 4
</td>
<td style="text-align:right;">
0.1
</td>
<td style="text-align:left;">
84.9%
</td>
<td style="text-align:left;">
84.3%
</td>
<td style="text-align:left;">
85.5%
</td>
</tr>
<tr>
<td style="text-align:right;">
0.2
</td>
<td style="text-align:left;">
80.4%
</td>
<td style="text-align:left;">
79.9%
</td>
<td style="text-align:left;">
80.9%
</td>
</tr>
<tr>
<td style="text-align:right;">
0.3
</td>
<td style="text-align:left;">
74.9%
</td>
<td style="text-align:left;">
74.4%
</td>
<td style="text-align:left;">
75.6%
</td>
</tr>
<tr>
<td style="text-align:right;">
0.4
</td>
<td style="text-align:left;">
68.5%
</td>
<td style="text-align:left;">
67.8%
</td>
<td style="text-align:left;">
69.3%
</td>
</tr>
<tr>
<td style="text-align:right;">
0.5
</td>
<td style="text-align:left;">
61.4%
</td>
<td style="text-align:left;">
60.2%
</td>
<td style="text-align:left;">
62.4%
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="5">
spectral_weight: 5
</td>
<td style="text-align:right;">
0.1
</td>
<td style="text-align:left;">
84.4%
</td>
<td style="text-align:left;">
84.0%
</td>
<td style="text-align:left;">
85.0%
</td>
</tr>
<tr>
<td style="text-align:right;">
0.2
</td>
<td style="text-align:left;">
81.2%
</td>
<td style="text-align:left;">
80.8%
</td>
<td style="text-align:left;">
81.7%
</td>
</tr>
<tr>
<td style="text-align:right;">
0.3
</td>
<td style="text-align:left;">
77.5%
</td>
<td style="text-align:left;">
77.0%
</td>
<td style="text-align:left;">
78.0%
</td>
</tr>
<tr>
<td style="text-align:right;">
0.4
</td>
<td style="text-align:left;">
73.3%
</td>
<td style="text-align:left;">
72.6%
</td>
<td style="text-align:left;">
73.9%
</td>
</tr>
<tr>
<td style="text-align:right;">
0.5
</td>
<td style="text-align:left;">
68.6%
</td>
<td style="text-align:left;">
67.6%
</td>
<td style="text-align:left;">
69.5%
</td>
</tr>
</tbody>
</table>
</div>
<p>now we’ll probabilistically test the hypothesis that coarser resolution CHM data results in lower detection accuracy and quantify by how much. we’ll look at the influence of CHM resolution based on the inclusion of spectral data (or exclusion) and it’s weighting determined by the <code>spectral_weight</code> parameter</p>
<div class="sourceCode" id="cb339"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb339-1"><a href="stats_method.html#cb339-1" tabindex="-1"></a>contrast_temp <span class="ot">&lt;-</span> </span>
<span id="cb339-2"><a href="stats_method.html#cb339-2" tabindex="-1"></a>  draws_temp <span class="sc">%&gt;%</span> </span>
<span id="cb339-3"><a href="stats_method.html#cb339-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(</span>
<span id="cb339-4"><a href="stats_method.html#cb339-4" tabindex="-1"></a>    <span class="fu">round</span>(chm_res_m,<span class="dv">2</span>) <span class="sc">==</span> <span class="fu">round</span>(chm_res_m,<span class="dv">1</span>) <span class="co"># let&#39;s just look at every 0.1 m (10 cm)</span></span>
<span id="cb339-5"><a href="stats_method.html#cb339-5" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb339-6"><a href="stats_method.html#cb339-6" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(spectral_weight) <span class="sc">%&gt;%</span> </span>
<span id="cb339-7"><a href="stats_method.html#cb339-7" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">compare_levels</span>(</span>
<span id="cb339-8"><a href="stats_method.html#cb339-8" tabindex="-1"></a>    value</span>
<span id="cb339-9"><a href="stats_method.html#cb339-9" tabindex="-1"></a>    , <span class="at">by =</span> chm_res_m</span>
<span id="cb339-10"><a href="stats_method.html#cb339-10" tabindex="-1"></a>    , <span class="at">comparison =</span> </span>
<span id="cb339-11"><a href="stats_method.html#cb339-11" tabindex="-1"></a>      <span class="co"># &quot;control&quot;</span></span>
<span id="cb339-12"><a href="stats_method.html#cb339-12" tabindex="-1"></a>      <span class="co"># tidybayes::emmeans_comparison(&quot;revpairwise&quot;) </span></span>
<span id="cb339-13"><a href="stats_method.html#cb339-13" tabindex="-1"></a>      <span class="st">&quot;pairwise&quot;</span></span>
<span id="cb339-14"><a href="stats_method.html#cb339-14" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb339-15"><a href="stats_method.html#cb339-15" tabindex="-1"></a>  <span class="co"># dplyr::glimpse()</span></span>
<span id="cb339-16"><a href="stats_method.html#cb339-16" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">contrast =</span> chm_res_m) <span class="sc">%&gt;%</span> </span>
<span id="cb339-17"><a href="stats_method.html#cb339-17" tabindex="-1"></a>  <span class="co"># group the data before calculating contrast variables %&gt;% </span></span>
<span id="cb339-18"><a href="stats_method.html#cb339-18" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(spectral_weight, contrast) <span class="sc">%&gt;%</span> </span>
<span id="cb339-19"><a href="stats_method.html#cb339-19" tabindex="-1"></a>  <span class="fu">make_contrast_vars</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb339-20"><a href="stats_method.html#cb339-20" tabindex="-1"></a>  <span class="co"># relabel the label for the facets</span></span>
<span id="cb339-21"><a href="stats_method.html#cb339-21" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">spectral_weight =</span> forcats<span class="sc">::</span><span class="fu">fct_relabel</span>(spectral_weight,<span class="sc">~</span><span class="fu">paste0</span>(<span class="st">&quot;spectral_weight: &quot;</span>, .x, <span class="at">recycle0 =</span> T)))</span>
<span id="cb339-22"><a href="stats_method.html#cb339-22" tabindex="-1"></a><span class="co"># huh?</span></span>
<span id="cb339-23"><a href="stats_method.html#cb339-23" tabindex="-1"></a><span class="co"># contrast_temp %&gt;% dplyr::glimpse()</span></span>
<span id="cb339-24"><a href="stats_method.html#cb339-24" tabindex="-1"></a></span>
<span id="cb339-25"><a href="stats_method.html#cb339-25" tabindex="-1"></a><span class="co"># plot it</span></span>
<span id="cb339-26"><a href="stats_method.html#cb339-26" tabindex="-1"></a><span class="fu">plt_contrast</span>(</span>
<span id="cb339-27"><a href="stats_method.html#cb339-27" tabindex="-1"></a>  contrast_temp</span>
<span id="cb339-28"><a href="stats_method.html#cb339-28" tabindex="-1"></a>  <span class="co"># , caption_text = form_temp</span></span>
<span id="cb339-29"><a href="stats_method.html#cb339-29" tabindex="-1"></a>  , <span class="at">y_axis_title =</span> <span class="st">&quot;CHM resolution contrast&quot;</span></span>
<span id="cb339-30"><a href="stats_method.html#cb339-30" tabindex="-1"></a>  , <span class="at">x_axis_title =</span> <span class="st">&quot;difference (F-score)&quot;</span></span>
<span id="cb339-31"><a href="stats_method.html#cb339-31" tabindex="-1"></a>  , <span class="at">facet =</span> <span class="st">&quot;spectral_weight&quot;</span></span>
<span id="cb339-32"><a href="stats_method.html#cb339-32" tabindex="-1"></a>  , <span class="at">label_size =</span> <span class="cn">NA</span></span>
<span id="cb339-33"><a href="stats_method.html#cb339-33" tabindex="-1"></a>  , <span class="at">x_expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">0.1</span>)</span>
<span id="cb339-34"><a href="stats_method.html#cb339-34" tabindex="-1"></a>  , <span class="at">annotate_which =</span> <span class="st">&quot;left&quot;</span></span>
<span id="cb339-35"><a href="stats_method.html#cb339-35" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb339-36"><a href="stats_method.html#cb339-36" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb339-37"><a href="stats_method.html#cb339-37" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">&quot;posterior predictive distribution of group constrasts with 95% &amp; 50% HDI</span><span class="sc">\n</span><span class="st">by `spectral_weight`&quot;</span></span>
<span id="cb339-38"><a href="stats_method.html#cb339-38" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-320-1.png" width="1008" /></p>
<p>let’s table it</p>
<div class="sourceCode" id="cb340"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb340-1"><a href="stats_method.html#cb340-1" tabindex="-1"></a>contrast_temp <span class="sc">%&gt;%</span> </span>
<span id="cb340-2"><a href="stats_method.html#cb340-2" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">distinct</span>(</span>
<span id="cb340-3"><a href="stats_method.html#cb340-3" tabindex="-1"></a>      spectral_weight, contrast</span>
<span id="cb340-4"><a href="stats_method.html#cb340-4" tabindex="-1"></a>      , median_hdi_est, median_hdi_lower, median_hdi_upper</span>
<span id="cb340-5"><a href="stats_method.html#cb340-5" tabindex="-1"></a>      , pr_lt_zero <span class="co"># , pr_gt_zero</span></span>
<span id="cb340-6"><a href="stats_method.html#cb340-6" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb340-7"><a href="stats_method.html#cb340-7" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">arrange</span>(spectral_weight, contrast) <span class="sc">%&gt;%</span> </span>
<span id="cb340-8"><a href="stats_method.html#cb340-8" tabindex="-1"></a>    <span class="co"># format pcts</span></span>
<span id="cb340-9"><a href="stats_method.html#cb340-9" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(dplyr<span class="sc">::</span><span class="fu">across</span>(</span>
<span id="cb340-10"><a href="stats_method.html#cb340-10" tabindex="-1"></a>      tidyselect<span class="sc">::</span><span class="fu">starts_with</span>(<span class="st">&quot;median_hdi_&quot;</span>)</span>
<span id="cb340-11"><a href="stats_method.html#cb340-11" tabindex="-1"></a>      , <span class="sc">~</span> scales<span class="sc">::</span><span class="fu">percent</span>(.x, <span class="at">accuracy =</span> <span class="fl">0.1</span>)</span>
<span id="cb340-12"><a href="stats_method.html#cb340-12" tabindex="-1"></a>    )) <span class="sc">%&gt;%</span> </span>
<span id="cb340-13"><a href="stats_method.html#cb340-13" tabindex="-1"></a>    kableExtra<span class="sc">::</span><span class="fu">kbl</span>(</span>
<span id="cb340-14"><a href="stats_method.html#cb340-14" tabindex="-1"></a>      <span class="at">digits =</span> <span class="dv">2</span></span>
<span id="cb340-15"><a href="stats_method.html#cb340-15" tabindex="-1"></a>      , <span class="at">caption =</span> <span class="st">&quot;brms::brm model: 95% HDI of the posterior predictive distribution of group constrasts&quot;</span></span>
<span id="cb340-16"><a href="stats_method.html#cb340-16" tabindex="-1"></a>      , <span class="at">col.names =</span> <span class="fu">c</span>(</span>
<span id="cb340-17"><a href="stats_method.html#cb340-17" tabindex="-1"></a>        <span class="st">&quot;spectral_weight&quot;</span>, <span class="st">&quot;CHM res. contrast&quot;</span></span>
<span id="cb340-18"><a href="stats_method.html#cb340-18" tabindex="-1"></a>        , <span class="st">&quot;difference (F-score)&quot;</span></span>
<span id="cb340-19"><a href="stats_method.html#cb340-19" tabindex="-1"></a>        , <span class="st">&quot;HDI low&quot;</span>, <span class="st">&quot;HDI high&quot;</span></span>
<span id="cb340-20"><a href="stats_method.html#cb340-20" tabindex="-1"></a>        , <span class="st">&quot;Pr(diff&lt;0)&quot;</span></span>
<span id="cb340-21"><a href="stats_method.html#cb340-21" tabindex="-1"></a>      )</span>
<span id="cb340-22"><a href="stats_method.html#cb340-22" tabindex="-1"></a>      , <span class="at">escape =</span> F</span>
<span id="cb340-23"><a href="stats_method.html#cb340-23" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb340-24"><a href="stats_method.html#cb340-24" tabindex="-1"></a>    kableExtra<span class="sc">::</span><span class="fu">kable_styling</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb340-25"><a href="stats_method.html#cb340-25" tabindex="-1"></a>    kableExtra<span class="sc">::</span><span class="fu">collapse_rows</span>(<span class="at">columns =</span> <span class="dv">1</span>, <span class="at">valign =</span> <span class="st">&quot;top&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb340-26"><a href="stats_method.html#cb340-26" tabindex="-1"></a>    kableExtra<span class="sc">::</span><span class="fu">scroll_box</span>(<span class="at">height =</span> <span class="st">&quot;8in&quot;</span>)</span></code></pre></div>
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:8in; ">
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-321">Table 9.5: </span>brms::brm model: 95% HDI of the posterior predictive distribution of group constrasts
</caption>
<thead>
<tr>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
spectral_weight
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
CHM res. contrast
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
difference (F-score)
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
HDI low
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
HDI high
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
Pr(diff&lt;0)
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="10">
spectral_weight: 0
</td>
<td style="text-align:left;">
0.2 - 0.1
</td>
<td style="text-align:left;">
-4.9%
</td>
<td style="text-align:left;">
-5.1%
</td>
<td style="text-align:left;">
-4.7%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
0.3 - 0.1
</td>
<td style="text-align:left;">
-10.6%
</td>
<td style="text-align:left;">
-11.2%
</td>
<td style="text-align:left;">
-10.0%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
0.3 - 0.2
</td>
<td style="text-align:left;">
-5.7%
</td>
<td style="text-align:left;">
-6.0%
</td>
<td style="text-align:left;">
-5.4%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
0.4 - 0.1
</td>
<td style="text-align:left;">
-17.0%
</td>
<td style="text-align:left;">
-17.9%
</td>
<td style="text-align:left;">
-16.0%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
0.4 - 0.2
</td>
<td style="text-align:left;">
-12.1%
</td>
<td style="text-align:left;">
-12.8%
</td>
<td style="text-align:left;">
-11.3%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
0.4 - 0.3
</td>
<td style="text-align:left;">
-6.4%
</td>
<td style="text-align:left;">
-6.8%
</td>
<td style="text-align:left;">
-6.0%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
0.5 - 0.1
</td>
<td style="text-align:left;">
-23.9%
</td>
<td style="text-align:left;">
-25.3%
</td>
<td style="text-align:left;">
-22.4%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
0.5 - 0.2
</td>
<td style="text-align:left;">
-19.0%
</td>
<td style="text-align:left;">
-20.2%
</td>
<td style="text-align:left;">
-17.8%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
0.5 - 0.3
</td>
<td style="text-align:left;">
-13.3%
</td>
<td style="text-align:left;">
-14.1%
</td>
<td style="text-align:left;">
-12.4%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
0.5 - 0.4
</td>
<td style="text-align:left;">
-6.9%
</td>
<td style="text-align:left;">
-7.3%
</td>
<td style="text-align:left;">
-6.4%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="10">
spectral_weight: 1
</td>
<td style="text-align:left;">
0.2 - 0.1
</td>
<td style="text-align:left;">
-4.9%
</td>
<td style="text-align:left;">
-5.1%
</td>
<td style="text-align:left;">
-4.6%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
0.3 - 0.1
</td>
<td style="text-align:left;">
-10.6%
</td>
<td style="text-align:left;">
-11.1%
</td>
<td style="text-align:left;">
-10.0%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
0.3 - 0.2
</td>
<td style="text-align:left;">
-5.7%
</td>
<td style="text-align:left;">
-6.0%
</td>
<td style="text-align:left;">
-5.3%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
0.4 - 0.1
</td>
<td style="text-align:left;">
-17.0%
</td>
<td style="text-align:left;">
-17.8%
</td>
<td style="text-align:left;">
-15.9%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
0.4 - 0.2
</td>
<td style="text-align:left;">
-12.1%
</td>
<td style="text-align:left;">
-12.8%
</td>
<td style="text-align:left;">
-11.3%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
0.4 - 0.3
</td>
<td style="text-align:left;">
-6.4%
</td>
<td style="text-align:left;">
-6.8%
</td>
<td style="text-align:left;">
-6.0%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
0.5 - 0.1
</td>
<td style="text-align:left;">
-23.9%
</td>
<td style="text-align:left;">
-25.2%
</td>
<td style="text-align:left;">
-22.4%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
0.5 - 0.2
</td>
<td style="text-align:left;">
-19.0%
</td>
<td style="text-align:left;">
-20.2%
</td>
<td style="text-align:left;">
-17.8%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
0.5 - 0.3
</td>
<td style="text-align:left;">
-13.3%
</td>
<td style="text-align:left;">
-14.1%
</td>
<td style="text-align:left;">
-12.4%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
0.5 - 0.4
</td>
<td style="text-align:left;">
-6.9%
</td>
<td style="text-align:left;">
-7.3%
</td>
<td style="text-align:left;">
-6.4%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="10">
spectral_weight: 2
</td>
<td style="text-align:left;">
0.2 - 0.1
</td>
<td style="text-align:left;">
-4.9%
</td>
<td style="text-align:left;">
-5.1%
</td>
<td style="text-align:left;">
-4.7%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
0.3 - 0.1
</td>
<td style="text-align:left;">
-10.6%
</td>
<td style="text-align:left;">
-11.1%
</td>
<td style="text-align:left;">
-10.0%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
0.3 - 0.2
</td>
<td style="text-align:left;">
-5.7%
</td>
<td style="text-align:left;">
-6.0%
</td>
<td style="text-align:left;">
-5.3%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
0.4 - 0.1
</td>
<td style="text-align:left;">
-17.0%
</td>
<td style="text-align:left;">
-17.9%
</td>
<td style="text-align:left;">
-16.0%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
0.4 - 0.2
</td>
<td style="text-align:left;">
-12.1%
</td>
<td style="text-align:left;">
-12.8%
</td>
<td style="text-align:left;">
-11.3%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
0.4 - 0.3
</td>
<td style="text-align:left;">
-6.4%
</td>
<td style="text-align:left;">
-6.8%
</td>
<td style="text-align:left;">
-6.0%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
0.5 - 0.1
</td>
<td style="text-align:left;">
-23.9%
</td>
<td style="text-align:left;">
-25.2%
</td>
<td style="text-align:left;">
-22.5%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
0.5 - 0.2
</td>
<td style="text-align:left;">
-19.0%
</td>
<td style="text-align:left;">
-20.1%
</td>
<td style="text-align:left;">
-17.8%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
0.5 - 0.3
</td>
<td style="text-align:left;">
-13.3%
</td>
<td style="text-align:left;">
-14.2%
</td>
<td style="text-align:left;">
-12.5%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
0.5 - 0.4
</td>
<td style="text-align:left;">
-6.9%
</td>
<td style="text-align:left;">
-7.4%
</td>
<td style="text-align:left;">
-6.5%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="10">
spectral_weight: 3
</td>
<td style="text-align:left;">
0.2 - 0.1
</td>
<td style="text-align:left;">
-4.8%
</td>
<td style="text-align:left;">
-5.1%
</td>
<td style="text-align:left;">
-4.6%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
0.3 - 0.1
</td>
<td style="text-align:left;">
-10.4%
</td>
<td style="text-align:left;">
-11.0%
</td>
<td style="text-align:left;">
-9.9%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
0.3 - 0.2
</td>
<td style="text-align:left;">
-5.6%
</td>
<td style="text-align:left;">
-6.0%
</td>
<td style="text-align:left;">
-5.3%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
0.4 - 0.1
</td>
<td style="text-align:left;">
-16.8%
</td>
<td style="text-align:left;">
-17.8%
</td>
<td style="text-align:left;">
-15.8%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
0.4 - 0.2
</td>
<td style="text-align:left;">
-12.0%
</td>
<td style="text-align:left;">
-12.7%
</td>
<td style="text-align:left;">
-11.2%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
0.4 - 0.3
</td>
<td style="text-align:left;">
-6.3%
</td>
<td style="text-align:left;">
-6.8%
</td>
<td style="text-align:left;">
-5.9%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
0.5 - 0.1
</td>
<td style="text-align:left;">
-23.7%
</td>
<td style="text-align:left;">
-25.2%
</td>
<td style="text-align:left;">
-22.2%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
0.5 - 0.2
</td>
<td style="text-align:left;">
-18.8%
</td>
<td style="text-align:left;">
-20.1%
</td>
<td style="text-align:left;">
-17.6%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
0.5 - 0.3
</td>
<td style="text-align:left;">
-13.2%
</td>
<td style="text-align:left;">
-14.1%
</td>
<td style="text-align:left;">
-12.4%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
0.5 - 0.4
</td>
<td style="text-align:left;">
-6.9%
</td>
<td style="text-align:left;">
-7.4%
</td>
<td style="text-align:left;">
-6.4%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="10">
spectral_weight: 4
</td>
<td style="text-align:left;">
0.2 - 0.1
</td>
<td style="text-align:left;">
-4.5%
</td>
<td style="text-align:left;">
-4.7%
</td>
<td style="text-align:left;">
-4.3%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
0.3 - 0.1
</td>
<td style="text-align:left;">
-10.0%
</td>
<td style="text-align:left;">
-10.5%
</td>
<td style="text-align:left;">
-9.5%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
0.3 - 0.2
</td>
<td style="text-align:left;">
-5.5%
</td>
<td style="text-align:left;">
-5.8%
</td>
<td style="text-align:left;">
-5.2%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
0.4 - 0.1
</td>
<td style="text-align:left;">
-16.4%
</td>
<td style="text-align:left;">
-17.2%
</td>
<td style="text-align:left;">
-15.5%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
0.4 - 0.2
</td>
<td style="text-align:left;">
-11.9%
</td>
<td style="text-align:left;">
-12.6%
</td>
<td style="text-align:left;">
-11.3%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
0.4 - 0.3
</td>
<td style="text-align:left;">
-6.4%
</td>
<td style="text-align:left;">
-6.8%
</td>
<td style="text-align:left;">
-6.0%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
0.5 - 0.1
</td>
<td style="text-align:left;">
-23.6%
</td>
<td style="text-align:left;">
-25.0%
</td>
<td style="text-align:left;">
-22.4%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
0.5 - 0.2
</td>
<td style="text-align:left;">
-19.0%
</td>
<td style="text-align:left;">
-20.1%
</td>
<td style="text-align:left;">
-17.9%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
0.5 - 0.3
</td>
<td style="text-align:left;">
-13.6%
</td>
<td style="text-align:left;">
-14.4%
</td>
<td style="text-align:left;">
-12.7%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
0.5 - 0.4
</td>
<td style="text-align:left;">
-7.2%
</td>
<td style="text-align:left;">
-7.6%
</td>
<td style="text-align:left;">
-6.7%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="10">
spectral_weight: 5
</td>
<td style="text-align:left;">
0.2 - 0.1
</td>
<td style="text-align:left;">
-3.2%
</td>
<td style="text-align:left;">
-3.4%
</td>
<td style="text-align:left;">
-3.0%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
0.3 - 0.1
</td>
<td style="text-align:left;">
-6.9%
</td>
<td style="text-align:left;">
-7.4%
</td>
<td style="text-align:left;">
-6.5%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
0.3 - 0.2
</td>
<td style="text-align:left;">
-3.7%
</td>
<td style="text-align:left;">
-4.0%
</td>
<td style="text-align:left;">
-3.4%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
0.4 - 0.1
</td>
<td style="text-align:left;">
-11.2%
</td>
<td style="text-align:left;">
-11.9%
</td>
<td style="text-align:left;">
-10.3%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
0.4 - 0.2
</td>
<td style="text-align:left;">
-7.9%
</td>
<td style="text-align:left;">
-8.5%
</td>
<td style="text-align:left;">
-7.3%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
0.4 - 0.3
</td>
<td style="text-align:left;">
-4.2%
</td>
<td style="text-align:left;">
-4.5%
</td>
<td style="text-align:left;">
-3.9%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
0.5 - 0.1
</td>
<td style="text-align:left;">
-15.9%
</td>
<td style="text-align:left;">
-17.0%
</td>
<td style="text-align:left;">
-14.6%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
0.5 - 0.2
</td>
<td style="text-align:left;">
-12.6%
</td>
<td style="text-align:left;">
-13.6%
</td>
<td style="text-align:left;">
-11.6%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
0.5 - 0.3
</td>
<td style="text-align:left;">
-8.9%
</td>
<td style="text-align:left;">
-9.6%
</td>
<td style="text-align:left;">
-8.1%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
0.5 - 0.4
</td>
<td style="text-align:left;">
-4.7%
</td>
<td style="text-align:left;">
-5.1%
</td>
<td style="text-align:left;">
-4.3%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
</tbody>
</table>
</div>
<p>it is clear from these contrasts that coarser CHM resolutions lead to a decrease in detection accuracy. without the inclusion of spectral data (i.e. <code>spectral_weight</code> = “0”), a 0.1 m increase in CHM resolution coarseness results in an approximate decrease in F-score of ~5-7 percentage points. for example, the expected F-score decreases from 72% to 66% when moving from a 0.2 m resolution CHM raster to a 0.3 m raster, respectively.</p>
<p>when spectral data is included, this trend of decreasing accuracy with coarser resolution persists, but there is a greater improvement in detection accuracy at coarser resolutions when making the resolution more granular. for example, when including spectral data and setting the <code>spectral_weight</code> parameter to “4” (i.e., requiring four spectral thresholds to be met), a shift from a 0.5 m resolution raster to a 0.3 m raster results in a substantial F-score increase of 14.5 percentage points, from 57% to 71%.</p>
</div>
<div id="spectral-data" class="section level5 hasAnchor" number="9.1.5.2.2">
<h5><span class="header-section-number">9.1.5.2.2</span> Spectral data<a href="stats_method.html#spectral-data" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>now we’ll look at the impact of including (or excluding) spectral data and the weighting of the <code>spectral_weight</code> parameter where a value of “0” indicates no spectral data was used (i.e. structural only), the lowest weighting of the spectral data is “1” (only one spectral index threshold must be met), and the highest weighting of spectral data is “5” (all spectral index thresholds must be met).</p>
<div class="sourceCode" id="cb341"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb341-1"><a href="stats_method.html#cb341-1" tabindex="-1"></a><span class="co"># viridis::rocket(5, begin = 0.9, end = 0.6) %&gt;% scales::show_col()</span></span>
<span id="cb341-2"><a href="stats_method.html#cb341-2" tabindex="-1"></a><span class="co"># brms::posterior_summary(brms_f_score_mod)</span></span>
<span id="cb341-3"><a href="stats_method.html#cb341-3" tabindex="-1"></a>draws_temp <span class="sc">%&gt;%</span> </span>
<span id="cb341-4"><a href="stats_method.html#cb341-4" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(</span>
<span id="cb341-5"><a href="stats_method.html#cb341-5" tabindex="-1"></a>    <span class="fu">round</span>(chm_res_m,<span class="dv">2</span>) <span class="sc">==</span> <span class="fu">round</span>(chm_res_m,<span class="dv">1</span>) <span class="co"># let&#39;s just look at every 0.1 m (10 cm)</span></span>
<span id="cb341-6"><a href="stats_method.html#cb341-6" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb341-7"><a href="stats_method.html#cb341-7" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> spectral_weight, <span class="at">y =</span> value, <span class="at">color =</span> <span class="fu">factor</span>(chm_res_m))) <span class="sc">+</span></span>
<span id="cb341-8"><a href="stats_method.html#cb341-8" tabindex="-1"></a>  <span class="co"># tidybayes::stat_halfeye() +</span></span>
<span id="cb341-9"><a href="stats_method.html#cb341-9" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">stat_lineribbon</span>(<span class="at">point_interval =</span> <span class="st">&quot;median_hdi&quot;</span>, <span class="at">.width =</span> <span class="fu">c</span>(<span class="fl">0.95</span>)) <span class="sc">+</span></span>
<span id="cb341-10"><a href="stats_method.html#cb341-10" tabindex="-1"></a>  <span class="co"># ggplot2::facet_wrap(facets = dplyr::vars(spectral_weight))</span></span>
<span id="cb341-11"><a href="stats_method.html#cb341-11" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_fill_brewer</span>(<span class="at">palette =</span> <span class="st">&quot;Greys&quot;</span>) <span class="sc">+</span></span>
<span id="cb341-12"><a href="stats_method.html#cb341-12" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_color_viridis_d</span>(<span class="at">option =</span> <span class="st">&quot;rocket&quot;</span>, <span class="at">begin =</span> <span class="fl">0.9</span>, <span class="at">end =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb341-13"><a href="stats_method.html#cb341-13" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>percent) <span class="sc">+</span></span>
<span id="cb341-14"><a href="stats_method.html#cb341-14" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;`spectral_weight`&quot;</span>, <span class="at">color =</span> <span class="st">&quot;CHM resolution&quot;</span>, <span class="at">y =</span> <span class="st">&quot;F-score&quot;</span>) <span class="sc">+</span></span>
<span id="cb341-15"><a href="stats_method.html#cb341-15" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb341-16"><a href="stats_method.html#cb341-16" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb341-17"><a href="stats_method.html#cb341-17" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;top&quot;</span></span>
<span id="cb341-18"><a href="stats_method.html#cb341-18" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb341-19"><a href="stats_method.html#cb341-19" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">guides</span>(</span>
<span id="cb341-20"><a href="stats_method.html#cb341-20" tabindex="-1"></a>    <span class="at">color =</span> ggplot2<span class="sc">::</span><span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">shape =</span> <span class="dv">15</span>, <span class="at">lwd =</span> <span class="dv">8</span>, <span class="at">fill =</span> <span class="cn">NA</span>))</span>
<span id="cb341-21"><a href="stats_method.html#cb341-21" tabindex="-1"></a>    , <span class="at">fill =</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb341-22"><a href="stats_method.html#cb341-22" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-322-1.png" width="1008" /></p>
<p>there are a few takeaways from this plot:</p>
<ul>
<li>setting the <code>spectral_weight</code> to “3”, “4”, or “5” improves detection accuracy across CHM resolution levels whereas values of “1” or “2” appear to be similar to including no spectral data at all</li>
<li>including spectral data and setting the <code>spectral_weight</code> to “5” results in a only a slight change in detection accuracy compared to a value of “4” for the finder resolution CHM data (e.g. 0.2 m or less) but beyond a CHM resolution of ~0.25 m detection accuracy is maximized when setting the <code>spectral_weight</code> to “5”. this makes intuitive sense because as the structural information about slash piles becomes less fine grain (i.e. more coarse), we should put more weight into the spectral data for detecting slash piles</li>
</ul>
<p>all of this is to say that the impact of <code>spectral_weight</code> varies based on the CHM resolution setting and vice-versa</p>
<p>we can look at the posterior distributions of the expected F-score at different <code>spectral_weight</code> settings by the input CHM resolution</p>
<div class="sourceCode" id="cb342"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb342-1"><a href="stats_method.html#cb342-1" tabindex="-1"></a>draws_temp <span class="sc">%&gt;%</span> </span>
<span id="cb342-2"><a href="stats_method.html#cb342-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(</span>
<span id="cb342-3"><a href="stats_method.html#cb342-3" tabindex="-1"></a>    <span class="fu">round</span>(chm_res_m,<span class="dv">2</span>) <span class="sc">==</span> <span class="fu">round</span>(chm_res_m,<span class="dv">1</span>) <span class="co"># let&#39;s just look at every 0.1 m (10 cm)</span></span>
<span id="cb342-4"><a href="stats_method.html#cb342-4" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb342-5"><a href="stats_method.html#cb342-5" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">chm_res_m =</span> chm_res_m <span class="sc">%&gt;%</span> <span class="fu">factor</span>() <span class="sc">%&gt;%</span> forcats<span class="sc">::</span><span class="fu">fct_relabel</span>(<span class="sc">~</span><span class="fu">paste0</span>(<span class="st">&quot;CHM resolution: &quot;</span>, .x, <span class="at">recycle0 =</span> T))) <span class="sc">%&gt;%</span> </span>
<span id="cb342-6"><a href="stats_method.html#cb342-6" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">y=</span>value, <span class="at">x=</span>spectral_weight)) <span class="sc">+</span></span>
<span id="cb342-7"><a href="stats_method.html#cb342-7" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">stat_eye</span>(</span>
<span id="cb342-8"><a href="stats_method.html#cb342-8" tabindex="-1"></a>    <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">fill =</span> chm_res_m)</span>
<span id="cb342-9"><a href="stats_method.html#cb342-9" tabindex="-1"></a>    , <span class="at">point_interval =</span> median_hdi, <span class="at">.width =</span> .<span class="dv">95</span></span>
<span id="cb342-10"><a href="stats_method.html#cb342-10" tabindex="-1"></a>    , <span class="at">slab_alpha =</span> <span class="fl">0.95</span></span>
<span id="cb342-11"><a href="stats_method.html#cb342-11" tabindex="-1"></a>    , <span class="at">interval_color =</span> <span class="st">&quot;gray44&quot;</span>, <span class="at">linewidth =</span> <span class="dv">1</span></span>
<span id="cb342-12"><a href="stats_method.html#cb342-12" tabindex="-1"></a>    , <span class="at">point_color =</span> <span class="st">&quot;gray44&quot;</span>, <span class="at">point_fill =</span> <span class="st">&quot;gray44&quot;</span>, <span class="at">point_size =</span> <span class="dv">1</span></span>
<span id="cb342-13"><a href="stats_method.html#cb342-13" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb342-14"><a href="stats_method.html#cb342-14" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">facet_grid</span>(<span class="at">cols =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(chm_res_m)) <span class="sc">+</span></span>
<span id="cb342-15"><a href="stats_method.html#cb342-15" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_fill_viridis_d</span>(<span class="at">option =</span> <span class="st">&quot;rocket&quot;</span>, <span class="at">begin =</span> <span class="fl">0.9</span>, <span class="at">end =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb342-16"><a href="stats_method.html#cb342-16" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="cn">NA</span>), <span class="at">labels =</span> scales<span class="sc">::</span>percent, <span class="at">breaks =</span> scales<span class="sc">::</span><span class="fu">breaks_extended</span>(<span class="dv">16</span>)) <span class="sc">+</span></span>
<span id="cb342-17"><a href="stats_method.html#cb342-17" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;`spectral_weight`&quot;</span>, <span class="at">y =</span> <span class="st">&quot;F-score&quot;</span>) <span class="sc">+</span></span>
<span id="cb342-18"><a href="stats_method.html#cb342-18" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb342-19"><a href="stats_method.html#cb342-19" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb342-20"><a href="stats_method.html#cb342-20" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb342-21"><a href="stats_method.html#cb342-21" tabindex="-1"></a>    , <span class="at">strip.text =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb342-22"><a href="stats_method.html#cb342-22" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-323-1.png" width="1008" /></p>
<p>we already saw this same data above in our CHM resolution testing, but we’ll table that again but this time grouping by CHM resolution</p>
<div class="sourceCode" id="cb343"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb343-1"><a href="stats_method.html#cb343-1" tabindex="-1"></a>draws_temp <span class="sc">%&gt;%</span> </span>
<span id="cb343-2"><a href="stats_method.html#cb343-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(</span>
<span id="cb343-3"><a href="stats_method.html#cb343-3" tabindex="-1"></a>    <span class="fu">round</span>(chm_res_m,<span class="dv">2</span>) <span class="sc">==</span> <span class="fu">round</span>(chm_res_m,<span class="dv">1</span>) <span class="co"># let&#39;s just look at every 0.1 m (10 cm)</span></span>
<span id="cb343-4"><a href="stats_method.html#cb343-4" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb343-5"><a href="stats_method.html#cb343-5" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">chm_res_m =</span> chm_res_m <span class="sc">%&gt;%</span> <span class="fu">factor</span>() <span class="sc">%&gt;%</span> forcats<span class="sc">::</span><span class="fu">fct_relabel</span>(<span class="sc">~</span><span class="fu">paste0</span>(<span class="st">&quot;CHM resolution: &quot;</span>, .x, <span class="at">recycle0 =</span> T))) <span class="sc">%&gt;%</span> </span>
<span id="cb343-6"><a href="stats_method.html#cb343-6" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(chm_res_m, spectral_weight) <span class="sc">%&gt;%</span></span>
<span id="cb343-7"><a href="stats_method.html#cb343-7" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(</span>
<span id="cb343-8"><a href="stats_method.html#cb343-8" tabindex="-1"></a>    <span class="co"># get median_hdi</span></span>
<span id="cb343-9"><a href="stats_method.html#cb343-9" tabindex="-1"></a>    <span class="at">median_hdi_est =</span> tidybayes<span class="sc">::</span><span class="fu">median_hdci</span>(value)<span class="sc">$</span>y</span>
<span id="cb343-10"><a href="stats_method.html#cb343-10" tabindex="-1"></a>    , <span class="at">median_hdi_lower =</span> tidybayes<span class="sc">::</span><span class="fu">median_hdci</span>(value)<span class="sc">$</span>ymin</span>
<span id="cb343-11"><a href="stats_method.html#cb343-11" tabindex="-1"></a>    , <span class="at">median_hdi_upper =</span> tidybayes<span class="sc">::</span><span class="fu">median_hdci</span>(value)<span class="sc">$</span>ymax</span>
<span id="cb343-12"><a href="stats_method.html#cb343-12" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb343-13"><a href="stats_method.html#cb343-13" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb343-14"><a href="stats_method.html#cb343-14" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(chm_res_m,spectral_weight) <span class="sc">%&gt;%</span> </span>
<span id="cb343-15"><a href="stats_method.html#cb343-15" tabindex="-1"></a>  <span class="co"># format pcts</span></span>
<span id="cb343-16"><a href="stats_method.html#cb343-16" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(dplyr<span class="sc">::</span><span class="fu">across</span>(</span>
<span id="cb343-17"><a href="stats_method.html#cb343-17" tabindex="-1"></a>    tidyselect<span class="sc">::</span><span class="fu">starts_with</span>(<span class="st">&quot;median_hdi_&quot;</span>)</span>
<span id="cb343-18"><a href="stats_method.html#cb343-18" tabindex="-1"></a>    , <span class="sc">~</span> scales<span class="sc">::</span><span class="fu">percent</span>(.x, <span class="at">accuracy =</span> <span class="fl">0.1</span>)</span>
<span id="cb343-19"><a href="stats_method.html#cb343-19" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb343-20"><a href="stats_method.html#cb343-20" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kbl</span>(</span>
<span id="cb343-21"><a href="stats_method.html#cb343-21" tabindex="-1"></a>    <span class="at">digits =</span> <span class="dv">2</span></span>
<span id="cb343-22"><a href="stats_method.html#cb343-22" tabindex="-1"></a>    , <span class="at">caption =</span> <span class="st">&quot;F-score&lt;br&gt;95% HDI of the posterior predictive distribution&quot;</span></span>
<span id="cb343-23"><a href="stats_method.html#cb343-23" tabindex="-1"></a>    , <span class="at">col.names =</span> <span class="fu">c</span>(</span>
<span id="cb343-24"><a href="stats_method.html#cb343-24" tabindex="-1"></a>      <span class="st">&quot;CHM resolution&quot;</span>, <span class="st">&quot;spectral_weight&quot;</span></span>
<span id="cb343-25"><a href="stats_method.html#cb343-25" tabindex="-1"></a>      , <span class="fu">c</span>(<span class="st">&quot;F-score&lt;br&gt;median&quot;</span>, <span class="st">&quot;HDI low&quot;</span>, <span class="st">&quot;HDI high&quot;</span>)</span>
<span id="cb343-26"><a href="stats_method.html#cb343-26" tabindex="-1"></a>    )</span>
<span id="cb343-27"><a href="stats_method.html#cb343-27" tabindex="-1"></a>    , <span class="at">escape =</span> F</span>
<span id="cb343-28"><a href="stats_method.html#cb343-28" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb343-29"><a href="stats_method.html#cb343-29" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kable_styling</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb343-30"><a href="stats_method.html#cb343-30" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">collapse_rows</span>(<span class="at">columns =</span> <span class="dv">1</span>, <span class="at">valign =</span> <span class="st">&quot;top&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb343-31"><a href="stats_method.html#cb343-31" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">scroll_box</span>(<span class="at">height =</span> <span class="st">&quot;8in&quot;</span>)</span></code></pre></div>
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:8in; ">
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-324">Table 9.6: </span>F-score<br>95% HDI of the posterior predictive distribution
</caption>
<thead>
<tr>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
CHM resolution
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
spectral_weight
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
F-score<br>median
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
HDI low
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
HDI high
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="6">
CHM resolution: 0.1
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
80.9%
</td>
<td style="text-align:left;">
80.2%
</td>
<td style="text-align:left;">
81.5%
</td>
</tr>
<tr>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
80.9%
</td>
<td style="text-align:left;">
80.2%
</td>
<td style="text-align:left;">
81.6%
</td>
</tr>
<tr>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
80.9%
</td>
<td style="text-align:left;">
80.2%
</td>
<td style="text-align:left;">
81.6%
</td>
</tr>
<tr>
<td style="text-align:left;">
3
</td>
<td style="text-align:left;">
81.3%
</td>
<td style="text-align:left;">
80.7%
</td>
<td style="text-align:left;">
82.1%
</td>
</tr>
<tr>
<td style="text-align:left;">
4
</td>
<td style="text-align:left;">
84.9%
</td>
<td style="text-align:left;">
84.3%
</td>
<td style="text-align:left;">
85.5%
</td>
</tr>
<tr>
<td style="text-align:left;">
5
</td>
<td style="text-align:left;">
84.4%
</td>
<td style="text-align:left;">
84.0%
</td>
<td style="text-align:left;">
85.0%
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="6">
CHM resolution: 0.2
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
76.0%
</td>
<td style="text-align:left;">
75.3%
</td>
<td style="text-align:left;">
76.6%
</td>
</tr>
<tr>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
76.0%
</td>
<td style="text-align:left;">
75.4%
</td>
<td style="text-align:left;">
76.7%
</td>
</tr>
<tr>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
76.0%
</td>
<td style="text-align:left;">
75.4%
</td>
<td style="text-align:left;">
76.7%
</td>
</tr>
<tr>
<td style="text-align:left;">
3
</td>
<td style="text-align:left;">
76.5%
</td>
<td style="text-align:left;">
76.0%
</td>
<td style="text-align:left;">
77.3%
</td>
</tr>
<tr>
<td style="text-align:left;">
4
</td>
<td style="text-align:left;">
80.4%
</td>
<td style="text-align:left;">
79.9%
</td>
<td style="text-align:left;">
80.9%
</td>
</tr>
<tr>
<td style="text-align:left;">
5
</td>
<td style="text-align:left;">
81.2%
</td>
<td style="text-align:left;">
80.8%
</td>
<td style="text-align:left;">
81.7%
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="6">
CHM resolution: 0.3
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
70.3%
</td>
<td style="text-align:left;">
69.7%
</td>
<td style="text-align:left;">
70.9%
</td>
</tr>
<tr>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
70.3%
</td>
<td style="text-align:left;">
69.7%
</td>
<td style="text-align:left;">
71.0%
</td>
</tr>
<tr>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
70.3%
</td>
<td style="text-align:left;">
69.6%
</td>
<td style="text-align:left;">
70.9%
</td>
</tr>
<tr>
<td style="text-align:left;">
3
</td>
<td style="text-align:left;">
70.9%
</td>
<td style="text-align:left;">
70.3%
</td>
<td style="text-align:left;">
71.5%
</td>
</tr>
<tr>
<td style="text-align:left;">
4
</td>
<td style="text-align:left;">
74.9%
</td>
<td style="text-align:left;">
74.4%
</td>
<td style="text-align:left;">
75.6%
</td>
</tr>
<tr>
<td style="text-align:left;">
5
</td>
<td style="text-align:left;">
77.5%
</td>
<td style="text-align:left;">
77.0%
</td>
<td style="text-align:left;">
78.0%
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="6">
CHM resolution: 0.4
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
63.9%
</td>
<td style="text-align:left;">
63.1%
</td>
<td style="text-align:left;">
64.7%
</td>
</tr>
<tr>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
63.9%
</td>
<td style="text-align:left;">
63.1%
</td>
<td style="text-align:left;">
64.7%
</td>
</tr>
<tr>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
63.9%
</td>
<td style="text-align:left;">
63.1%
</td>
<td style="text-align:left;">
64.8%
</td>
</tr>
<tr>
<td style="text-align:left;">
3
</td>
<td style="text-align:left;">
64.6%
</td>
<td style="text-align:left;">
63.8%
</td>
<td style="text-align:left;">
65.4%
</td>
</tr>
<tr>
<td style="text-align:left;">
4
</td>
<td style="text-align:left;">
68.5%
</td>
<td style="text-align:left;">
67.8%
</td>
<td style="text-align:left;">
69.3%
</td>
</tr>
<tr>
<td style="text-align:left;">
5
</td>
<td style="text-align:left;">
73.3%
</td>
<td style="text-align:left;">
72.6%
</td>
<td style="text-align:left;">
73.9%
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="6">
CHM resolution: 0.5
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
57.0%
</td>
<td style="text-align:left;">
55.8%
</td>
<td style="text-align:left;">
58.1%
</td>
</tr>
<tr>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
57.0%
</td>
<td style="text-align:left;">
55.9%
</td>
<td style="text-align:left;">
58.1%
</td>
</tr>
<tr>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
57.0%
</td>
<td style="text-align:left;">
55.8%
</td>
<td style="text-align:left;">
58.1%
</td>
</tr>
<tr>
<td style="text-align:left;">
3
</td>
<td style="text-align:left;">
57.7%
</td>
<td style="text-align:left;">
56.4%
</td>
<td style="text-align:left;">
58.7%
</td>
</tr>
<tr>
<td style="text-align:left;">
4
</td>
<td style="text-align:left;">
61.4%
</td>
<td style="text-align:left;">
60.2%
</td>
<td style="text-align:left;">
62.4%
</td>
</tr>
<tr>
<td style="text-align:left;">
5
</td>
<td style="text-align:left;">
68.6%
</td>
<td style="text-align:left;">
67.6%
</td>
<td style="text-align:left;">
69.5%
</td>
</tr>
</tbody>
</table>
</div>
<p>now we’ll probabilistically test the hypothesis that the inclusion of spectral data improves detection accuracy and quantify by how much. we’ll look at the influence of spectral data based on the CHM resolution</p>
<p>to actually compare the different levels of <code>spectral_weight</code>, we’ll use the MCMC draws to contrast the posterior predictions at different levels of the parameter (see below)</p>
<div class="sourceCode" id="cb344"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb344-1"><a href="stats_method.html#cb344-1" tabindex="-1"></a>contrast_temp <span class="ot">&lt;-</span> </span>
<span id="cb344-2"><a href="stats_method.html#cb344-2" tabindex="-1"></a>  draws_temp <span class="sc">%&gt;%</span> </span>
<span id="cb344-3"><a href="stats_method.html#cb344-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(</span>
<span id="cb344-4"><a href="stats_method.html#cb344-4" tabindex="-1"></a>    <span class="fu">round</span>(chm_res_m,<span class="dv">2</span>) <span class="sc">==</span> <span class="fu">round</span>(chm_res_m,<span class="dv">1</span>) <span class="co"># let&#39;s just look at every 0.1 m (10 cm)</span></span>
<span id="cb344-5"><a href="stats_method.html#cb344-5" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb344-6"><a href="stats_method.html#cb344-6" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(chm_res_m) <span class="sc">%&gt;%</span> </span>
<span id="cb344-7"><a href="stats_method.html#cb344-7" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">compare_levels</span>(</span>
<span id="cb344-8"><a href="stats_method.html#cb344-8" tabindex="-1"></a>    value</span>
<span id="cb344-9"><a href="stats_method.html#cb344-9" tabindex="-1"></a>    , <span class="at">by =</span> spectral_weight</span>
<span id="cb344-10"><a href="stats_method.html#cb344-10" tabindex="-1"></a>    , <span class="at">comparison =</span> </span>
<span id="cb344-11"><a href="stats_method.html#cb344-11" tabindex="-1"></a>      <span class="co"># tidybayes::emmeans_comparison(&quot;revpairwise&quot;) </span></span>
<span id="cb344-12"><a href="stats_method.html#cb344-12" tabindex="-1"></a>      <span class="st">&quot;pairwise&quot;</span></span>
<span id="cb344-13"><a href="stats_method.html#cb344-13" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb344-14"><a href="stats_method.html#cb344-14" tabindex="-1"></a>  <span class="co"># dplyr::glimpse()</span></span>
<span id="cb344-15"><a href="stats_method.html#cb344-15" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">contrast =</span> spectral_weight) <span class="sc">%&gt;%</span> </span>
<span id="cb344-16"><a href="stats_method.html#cb344-16" tabindex="-1"></a>  <span class="co"># group the data before calculating contrast variables %&gt;% </span></span>
<span id="cb344-17"><a href="stats_method.html#cb344-17" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(chm_res_m, contrast) <span class="sc">%&gt;%</span> </span>
<span id="cb344-18"><a href="stats_method.html#cb344-18" tabindex="-1"></a>  <span class="fu">make_contrast_vars</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb344-19"><a href="stats_method.html#cb344-19" tabindex="-1"></a>  <span class="co"># relabel the label for the facets</span></span>
<span id="cb344-20"><a href="stats_method.html#cb344-20" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">chm_res_m =</span> chm_res_m <span class="sc">%&gt;%</span> <span class="fu">factor</span>() <span class="sc">%&gt;%</span> forcats<span class="sc">::</span><span class="fu">fct_relabel</span>(<span class="sc">~</span><span class="fu">paste0</span>(<span class="st">&quot;CHM resolution: &quot;</span>, .x, <span class="at">recycle0 =</span> T)))</span>
<span id="cb344-21"><a href="stats_method.html#cb344-21" tabindex="-1"></a><span class="co"># huh?</span></span>
<span id="cb344-22"><a href="stats_method.html#cb344-22" tabindex="-1"></a><span class="co"># contrast_temp %&gt;% dplyr::glimpse()</span></span>
<span id="cb344-23"><a href="stats_method.html#cb344-23" tabindex="-1"></a></span>
<span id="cb344-24"><a href="stats_method.html#cb344-24" tabindex="-1"></a><span class="co"># plot it</span></span>
<span id="cb344-25"><a href="stats_method.html#cb344-25" tabindex="-1"></a><span class="fu">plt_contrast</span>(</span>
<span id="cb344-26"><a href="stats_method.html#cb344-26" tabindex="-1"></a>  contrast_temp</span>
<span id="cb344-27"><a href="stats_method.html#cb344-27" tabindex="-1"></a>  <span class="co"># , caption_text = form_temp</span></span>
<span id="cb344-28"><a href="stats_method.html#cb344-28" tabindex="-1"></a>  , <span class="at">y_axis_title =</span> <span class="st">&quot;`spectral_weight` contrast&quot;</span></span>
<span id="cb344-29"><a href="stats_method.html#cb344-29" tabindex="-1"></a>  , <span class="at">x_axis_title =</span> <span class="st">&quot;difference (F-score)&quot;</span></span>
<span id="cb344-30"><a href="stats_method.html#cb344-30" tabindex="-1"></a>  , <span class="at">facet =</span> <span class="st">&quot;chm_res_m&quot;</span></span>
<span id="cb344-31"><a href="stats_method.html#cb344-31" tabindex="-1"></a>  , <span class="at">label_size =</span> <span class="dv">2</span></span>
<span id="cb344-32"><a href="stats_method.html#cb344-32" tabindex="-1"></a>  , <span class="at">x_expand =</span> <span class="fu">c</span>(<span class="fl">0.5</span>,<span class="fl">0.5</span>)</span>
<span id="cb344-33"><a href="stats_method.html#cb344-33" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb344-34"><a href="stats_method.html#cb344-34" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb344-35"><a href="stats_method.html#cb344-35" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">&quot;posterior predictive distribution of group constrasts with 95% &amp; 50% HDI</span><span class="sc">\n</span><span class="st">by `chm_res_m`&quot;</span></span>
<span id="cb344-36"><a href="stats_method.html#cb344-36" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-325-1.png" width="1008" /></p>
<p>let’s table it</p>
<div class="sourceCode" id="cb345"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb345-1"><a href="stats_method.html#cb345-1" tabindex="-1"></a>contrast_temp <span class="sc">%&gt;%</span> </span>
<span id="cb345-2"><a href="stats_method.html#cb345-2" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">distinct</span>(</span>
<span id="cb345-3"><a href="stats_method.html#cb345-3" tabindex="-1"></a>      chm_res_m, contrast</span>
<span id="cb345-4"><a href="stats_method.html#cb345-4" tabindex="-1"></a>      , median_hdi_est, median_hdi_lower, median_hdi_upper</span>
<span id="cb345-5"><a href="stats_method.html#cb345-5" tabindex="-1"></a>      <span class="co"># , pr_lt_zero </span></span>
<span id="cb345-6"><a href="stats_method.html#cb345-6" tabindex="-1"></a>      , pr_gt_zero</span>
<span id="cb345-7"><a href="stats_method.html#cb345-7" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb345-8"><a href="stats_method.html#cb345-8" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">arrange</span>(chm_res_m, contrast) <span class="sc">%&gt;%</span> </span>
<span id="cb345-9"><a href="stats_method.html#cb345-9" tabindex="-1"></a>    <span class="co"># format pcts</span></span>
<span id="cb345-10"><a href="stats_method.html#cb345-10" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(dplyr<span class="sc">::</span><span class="fu">across</span>(</span>
<span id="cb345-11"><a href="stats_method.html#cb345-11" tabindex="-1"></a>      tidyselect<span class="sc">::</span><span class="fu">starts_with</span>(<span class="st">&quot;median_hdi_&quot;</span>)</span>
<span id="cb345-12"><a href="stats_method.html#cb345-12" tabindex="-1"></a>      , <span class="sc">~</span> scales<span class="sc">::</span><span class="fu">percent</span>(.x, <span class="at">accuracy =</span> <span class="fl">0.1</span>)</span>
<span id="cb345-13"><a href="stats_method.html#cb345-13" tabindex="-1"></a>    )) <span class="sc">%&gt;%</span> </span>
<span id="cb345-14"><a href="stats_method.html#cb345-14" tabindex="-1"></a>    kableExtra<span class="sc">::</span><span class="fu">kbl</span>(</span>
<span id="cb345-15"><a href="stats_method.html#cb345-15" tabindex="-1"></a>      <span class="at">digits =</span> <span class="dv">2</span></span>
<span id="cb345-16"><a href="stats_method.html#cb345-16" tabindex="-1"></a>      , <span class="at">caption =</span> <span class="st">&quot;brms::brm model: 95% HDI of the posterior predictive distribution of group constrasts&quot;</span></span>
<span id="cb345-17"><a href="stats_method.html#cb345-17" tabindex="-1"></a>      , <span class="at">col.names =</span> <span class="fu">c</span>(</span>
<span id="cb345-18"><a href="stats_method.html#cb345-18" tabindex="-1"></a>        <span class="st">&quot;CHM resolution&quot;</span>, <span class="st">&quot;spectral_weight&quot;</span></span>
<span id="cb345-19"><a href="stats_method.html#cb345-19" tabindex="-1"></a>        , <span class="st">&quot;difference (F-score)&quot;</span></span>
<span id="cb345-20"><a href="stats_method.html#cb345-20" tabindex="-1"></a>        , <span class="st">&quot;HDI low&quot;</span>, <span class="st">&quot;HDI high&quot;</span></span>
<span id="cb345-21"><a href="stats_method.html#cb345-21" tabindex="-1"></a>        <span class="co"># , &quot;Pr(diff&lt;0)&quot;</span></span>
<span id="cb345-22"><a href="stats_method.html#cb345-22" tabindex="-1"></a>        , <span class="st">&quot;Pr(diff&gt;0)&quot;</span></span>
<span id="cb345-23"><a href="stats_method.html#cb345-23" tabindex="-1"></a>      )</span>
<span id="cb345-24"><a href="stats_method.html#cb345-24" tabindex="-1"></a>      , <span class="at">escape =</span> F</span>
<span id="cb345-25"><a href="stats_method.html#cb345-25" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb345-26"><a href="stats_method.html#cb345-26" tabindex="-1"></a>    kableExtra<span class="sc">::</span><span class="fu">kable_styling</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb345-27"><a href="stats_method.html#cb345-27" tabindex="-1"></a>    kableExtra<span class="sc">::</span><span class="fu">collapse_rows</span>(<span class="at">columns =</span> <span class="dv">1</span>, <span class="at">valign =</span> <span class="st">&quot;top&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb345-28"><a href="stats_method.html#cb345-28" tabindex="-1"></a>    kableExtra<span class="sc">::</span><span class="fu">scroll_box</span>(<span class="at">height =</span> <span class="st">&quot;8in&quot;</span>)</span></code></pre></div>
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:8in; ">
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-326">Table 9.7: </span>brms::brm model: 95% HDI of the posterior predictive distribution of group constrasts
</caption>
<thead>
<tr>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
CHM resolution
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
spectral_weight
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
difference (F-score)
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
HDI low
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
HDI high
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
Pr(diff&gt;0)
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="15">
CHM resolution: 0.1
</td>
<td style="text-align:left;">
1 - 0
</td>
<td style="text-align:left;">
0.0%
</td>
<td style="text-align:left;">
-0.8%
</td>
<td style="text-align:left;">
0.9%
</td>
<td style="text-align:left;">
50%
</td>
</tr>
<tr>
<td style="text-align:left;">
2 - 0
</td>
<td style="text-align:left;">
0.0%
</td>
<td style="text-align:left;">
-0.9%
</td>
<td style="text-align:left;">
0.9%
</td>
<td style="text-align:left;">
49%
</td>
</tr>
<tr>
<td style="text-align:left;">
2 - 1
</td>
<td style="text-align:left;">
0.0%
</td>
<td style="text-align:left;">
-0.9%
</td>
<td style="text-align:left;">
0.8%
</td>
<td style="text-align:left;">
51%
</td>
</tr>
<tr>
<td style="text-align:left;">
3 - 0
</td>
<td style="text-align:left;">
0.5%
</td>
<td style="text-align:left;">
-0.5%
</td>
<td style="text-align:left;">
1.2%
</td>
<td style="text-align:left;">
84%
</td>
</tr>
<tr>
<td style="text-align:left;">
3 - 1
</td>
<td style="text-align:left;">
0.4%
</td>
<td style="text-align:left;">
-0.4%
</td>
<td style="text-align:left;">
1.4%
</td>
<td style="text-align:left;">
83%
</td>
</tr>
<tr>
<td style="text-align:left;">
3 - 2
</td>
<td style="text-align:left;">
0.4%
</td>
<td style="text-align:left;">
-0.4%
</td>
<td style="text-align:left;">
1.4%
</td>
<td style="text-align:left;">
84%
</td>
</tr>
<tr>
<td style="text-align:left;">
4 - 0
</td>
<td style="text-align:left;">
4.0%
</td>
<td style="text-align:left;">
3.2%
</td>
<td style="text-align:left;">
4.8%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
4 - 1
</td>
<td style="text-align:left;">
4.0%
</td>
<td style="text-align:left;">
3.2%
</td>
<td style="text-align:left;">
4.7%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
4 - 2
</td>
<td style="text-align:left;">
4.0%
</td>
<td style="text-align:left;">
3.3%
</td>
<td style="text-align:left;">
4.8%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
4 - 3
</td>
<td style="text-align:left;">
3.6%
</td>
<td style="text-align:left;">
2.8%
</td>
<td style="text-align:left;">
4.3%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
5 - 0
</td>
<td style="text-align:left;">
3.6%
</td>
<td style="text-align:left;">
2.8%
</td>
<td style="text-align:left;">
4.4%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
5 - 1
</td>
<td style="text-align:left;">
3.6%
</td>
<td style="text-align:left;">
2.8%
</td>
<td style="text-align:left;">
4.3%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
5 - 2
</td>
<td style="text-align:left;">
3.5%
</td>
<td style="text-align:left;">
2.9%
</td>
<td style="text-align:left;">
4.3%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
5 - 3
</td>
<td style="text-align:left;">
3.1%
</td>
<td style="text-align:left;">
2.3%
</td>
<td style="text-align:left;">
3.8%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
5 - 4
</td>
<td style="text-align:left;">
-0.5%
</td>
<td style="text-align:left;">
-1.2%
</td>
<td style="text-align:left;">
0.1%
</td>
<td style="text-align:left;">
9%
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="15">
CHM resolution: 0.2
</td>
<td style="text-align:left;">
1 - 0
</td>
<td style="text-align:left;">
0.0%
</td>
<td style="text-align:left;">
-0.7%
</td>
<td style="text-align:left;">
0.8%
</td>
<td style="text-align:left;">
52%
</td>
</tr>
<tr>
<td style="text-align:left;">
2 - 0
</td>
<td style="text-align:left;">
0.0%
</td>
<td style="text-align:left;">
-0.8%
</td>
<td style="text-align:left;">
0.7%
</td>
<td style="text-align:left;">
51%
</td>
</tr>
<tr>
<td style="text-align:left;">
2 - 1
</td>
<td style="text-align:left;">
0.0%
</td>
<td style="text-align:left;">
-0.8%
</td>
<td style="text-align:left;">
0.7%
</td>
<td style="text-align:left;">
50%
</td>
</tr>
<tr>
<td style="text-align:left;">
3 - 0
</td>
<td style="text-align:left;">
0.5%
</td>
<td style="text-align:left;">
-0.3%
</td>
<td style="text-align:left;">
1.2%
</td>
<td style="text-align:left;">
91%
</td>
</tr>
<tr>
<td style="text-align:left;">
3 - 1
</td>
<td style="text-align:left;">
0.5%
</td>
<td style="text-align:left;">
-0.2%
</td>
<td style="text-align:left;">
1.3%
</td>
<td style="text-align:left;">
90%
</td>
</tr>
<tr>
<td style="text-align:left;">
3 - 2
</td>
<td style="text-align:left;">
0.5%
</td>
<td style="text-align:left;">
-0.2%
</td>
<td style="text-align:left;">
1.3%
</td>
<td style="text-align:left;">
92%
</td>
</tr>
<tr>
<td style="text-align:left;">
4 - 0
</td>
<td style="text-align:left;">
4.4%
</td>
<td style="text-align:left;">
3.7%
</td>
<td style="text-align:left;">
5.0%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
4 - 1
</td>
<td style="text-align:left;">
4.4%
</td>
<td style="text-align:left;">
3.8%
</td>
<td style="text-align:left;">
5.1%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
4 - 2
</td>
<td style="text-align:left;">
4.4%
</td>
<td style="text-align:left;">
3.8%
</td>
<td style="text-align:left;">
5.1%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
4 - 3
</td>
<td style="text-align:left;">
3.9%
</td>
<td style="text-align:left;">
3.3%
</td>
<td style="text-align:left;">
4.6%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
5 - 0
</td>
<td style="text-align:left;">
5.2%
</td>
<td style="text-align:left;">
4.6%
</td>
<td style="text-align:left;">
5.9%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
5 - 1
</td>
<td style="text-align:left;">
5.2%
</td>
<td style="text-align:left;">
4.5%
</td>
<td style="text-align:left;">
5.8%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
5 - 2
</td>
<td style="text-align:left;">
5.2%
</td>
<td style="text-align:left;">
4.6%
</td>
<td style="text-align:left;">
5.9%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
5 - 3
</td>
<td style="text-align:left;">
4.7%
</td>
<td style="text-align:left;">
4.1%
</td>
<td style="text-align:left;">
5.3%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
5 - 4
</td>
<td style="text-align:left;">
0.8%
</td>
<td style="text-align:left;">
0.2%
</td>
<td style="text-align:left;">
1.4%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="15">
CHM resolution: 0.3
</td>
<td style="text-align:left;">
1 - 0
</td>
<td style="text-align:left;">
0.0%
</td>
<td style="text-align:left;">
-0.7%
</td>
<td style="text-align:left;">
0.8%
</td>
<td style="text-align:left;">
52%
</td>
</tr>
<tr>
<td style="text-align:left;">
2 - 0
</td>
<td style="text-align:left;">
0.0%
</td>
<td style="text-align:left;">
-0.7%
</td>
<td style="text-align:left;">
0.7%
</td>
<td style="text-align:left;">
50%
</td>
</tr>
<tr>
<td style="text-align:left;">
2 - 1
</td>
<td style="text-align:left;">
0.0%
</td>
<td style="text-align:left;">
-0.8%
</td>
<td style="text-align:left;">
0.7%
</td>
<td style="text-align:left;">
48%
</td>
</tr>
<tr>
<td style="text-align:left;">
3 - 0
</td>
<td style="text-align:left;">
0.6%
</td>
<td style="text-align:left;">
-0.2%
</td>
<td style="text-align:left;">
1.3%
</td>
<td style="text-align:left;">
94%
</td>
</tr>
<tr>
<td style="text-align:left;">
3 - 1
</td>
<td style="text-align:left;">
0.6%
</td>
<td style="text-align:left;">
-0.1%
</td>
<td style="text-align:left;">
1.3%
</td>
<td style="text-align:left;">
94%
</td>
</tr>
<tr>
<td style="text-align:left;">
3 - 2
</td>
<td style="text-align:left;">
0.6%
</td>
<td style="text-align:left;">
-0.2%
</td>
<td style="text-align:left;">
1.2%
</td>
<td style="text-align:left;">
95%
</td>
</tr>
<tr>
<td style="text-align:left;">
4 - 0
</td>
<td style="text-align:left;">
4.6%
</td>
<td style="text-align:left;">
4.0%
</td>
<td style="text-align:left;">
5.3%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
4 - 1
</td>
<td style="text-align:left;">
4.6%
</td>
<td style="text-align:left;">
4.0%
</td>
<td style="text-align:left;">
5.3%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
4 - 2
</td>
<td style="text-align:left;">
4.6%
</td>
<td style="text-align:left;">
4.0%
</td>
<td style="text-align:left;">
5.4%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
4 - 3
</td>
<td style="text-align:left;">
4.0%
</td>
<td style="text-align:left;">
3.4%
</td>
<td style="text-align:left;">
4.7%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
5 - 0
</td>
<td style="text-align:left;">
7.2%
</td>
<td style="text-align:left;">
6.6%
</td>
<td style="text-align:left;">
7.8%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
5 - 1
</td>
<td style="text-align:left;">
7.2%
</td>
<td style="text-align:left;">
6.6%
</td>
<td style="text-align:left;">
7.8%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
5 - 2
</td>
<td style="text-align:left;">
7.2%
</td>
<td style="text-align:left;">
6.6%
</td>
<td style="text-align:left;">
7.8%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
5 - 3
</td>
<td style="text-align:left;">
6.6%
</td>
<td style="text-align:left;">
6.0%
</td>
<td style="text-align:left;">
7.2%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
5 - 4
</td>
<td style="text-align:left;">
2.6%
</td>
<td style="text-align:left;">
1.9%
</td>
<td style="text-align:left;">
3.1%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="15">
CHM resolution: 0.4
</td>
<td style="text-align:left;">
1 - 0
</td>
<td style="text-align:left;">
0.0%
</td>
<td style="text-align:left;">
-0.9%
</td>
<td style="text-align:left;">
1.0%
</td>
<td style="text-align:left;">
52%
</td>
</tr>
<tr>
<td style="text-align:left;">
2 - 0
</td>
<td style="text-align:left;">
0.0%
</td>
<td style="text-align:left;">
-1.0%
</td>
<td style="text-align:left;">
0.9%
</td>
<td style="text-align:left;">
52%
</td>
</tr>
<tr>
<td style="text-align:left;">
2 - 1
</td>
<td style="text-align:left;">
0.0%
</td>
<td style="text-align:left;">
-1.0%
</td>
<td style="text-align:left;">
1.0%
</td>
<td style="text-align:left;">
48%
</td>
</tr>
<tr>
<td style="text-align:left;">
3 - 0
</td>
<td style="text-align:left;">
0.6%
</td>
<td style="text-align:left;">
-0.3%
</td>
<td style="text-align:left;">
1.6%
</td>
<td style="text-align:left;">
89%
</td>
</tr>
<tr>
<td style="text-align:left;">
3 - 1
</td>
<td style="text-align:left;">
0.6%
</td>
<td style="text-align:left;">
-0.3%
</td>
<td style="text-align:left;">
1.6%
</td>
<td style="text-align:left;">
89%
</td>
</tr>
<tr>
<td style="text-align:left;">
3 - 2
</td>
<td style="text-align:left;">
0.6%
</td>
<td style="text-align:left;">
-0.4%
</td>
<td style="text-align:left;">
1.7%
</td>
<td style="text-align:left;">
89%
</td>
</tr>
<tr>
<td style="text-align:left;">
4 - 0
</td>
<td style="text-align:left;">
4.6%
</td>
<td style="text-align:left;">
3.6%
</td>
<td style="text-align:left;">
5.5%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
4 - 1
</td>
<td style="text-align:left;">
4.6%
</td>
<td style="text-align:left;">
3.8%
</td>
<td style="text-align:left;">
5.6%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
4 - 2
</td>
<td style="text-align:left;">
4.6%
</td>
<td style="text-align:left;">
3.7%
</td>
<td style="text-align:left;">
5.6%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
4 - 3
</td>
<td style="text-align:left;">
4.0%
</td>
<td style="text-align:left;">
3.0%
</td>
<td style="text-align:left;">
4.9%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
5 - 0
</td>
<td style="text-align:left;">
9.4%
</td>
<td style="text-align:left;">
8.5%
</td>
<td style="text-align:left;">
10.3%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
5 - 1
</td>
<td style="text-align:left;">
9.3%
</td>
<td style="text-align:left;">
8.5%
</td>
<td style="text-align:left;">
10.1%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
5 - 2
</td>
<td style="text-align:left;">
9.3%
</td>
<td style="text-align:left;">
8.4%
</td>
<td style="text-align:left;">
10.2%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
5 - 3
</td>
<td style="text-align:left;">
8.7%
</td>
<td style="text-align:left;">
7.8%
</td>
<td style="text-align:left;">
9.6%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
5 - 4
</td>
<td style="text-align:left;">
4.7%
</td>
<td style="text-align:left;">
3.9%
</td>
<td style="text-align:left;">
5.5%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="15">
CHM resolution: 0.5
</td>
<td style="text-align:left;">
1 - 0
</td>
<td style="text-align:left;">
0.0%
</td>
<td style="text-align:left;">
-1.4%
</td>
<td style="text-align:left;">
1.5%
</td>
<td style="text-align:left;">
53%
</td>
</tr>
<tr>
<td style="text-align:left;">
2 - 0
</td>
<td style="text-align:left;">
0.0%
</td>
<td style="text-align:left;">
-1.5%
</td>
<td style="text-align:left;">
1.4%
</td>
<td style="text-align:left;">
51%
</td>
</tr>
<tr>
<td style="text-align:left;">
2 - 1
</td>
<td style="text-align:left;">
0.0%
</td>
<td style="text-align:left;">
-1.3%
</td>
<td style="text-align:left;">
1.5%
</td>
<td style="text-align:left;">
50%
</td>
</tr>
<tr>
<td style="text-align:left;">
3 - 0
</td>
<td style="text-align:left;">
0.7%
</td>
<td style="text-align:left;">
-0.8%
</td>
<td style="text-align:left;">
2.1%
</td>
<td style="text-align:left;">
81%
</td>
</tr>
<tr>
<td style="text-align:left;">
3 - 1
</td>
<td style="text-align:left;">
0.6%
</td>
<td style="text-align:left;">
-0.8%
</td>
<td style="text-align:left;">
2.1%
</td>
<td style="text-align:left;">
80%
</td>
</tr>
<tr>
<td style="text-align:left;">
3 - 2
</td>
<td style="text-align:left;">
0.6%
</td>
<td style="text-align:left;">
-0.7%
</td>
<td style="text-align:left;">
2.3%
</td>
<td style="text-align:left;">
80%
</td>
</tr>
<tr>
<td style="text-align:left;">
4 - 0
</td>
<td style="text-align:left;">
4.4%
</td>
<td style="text-align:left;">
2.8%
</td>
<td style="text-align:left;">
5.8%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
4 - 1
</td>
<td style="text-align:left;">
4.4%
</td>
<td style="text-align:left;">
3.0%
</td>
<td style="text-align:left;">
5.7%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
4 - 2
</td>
<td style="text-align:left;">
4.3%
</td>
<td style="text-align:left;">
2.9%
</td>
<td style="text-align:left;">
5.7%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
4 - 3
</td>
<td style="text-align:left;">
3.7%
</td>
<td style="text-align:left;">
2.2%
</td>
<td style="text-align:left;">
5.0%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
5 - 0
</td>
<td style="text-align:left;">
11.6%
</td>
<td style="text-align:left;">
10.3%
</td>
<td style="text-align:left;">
12.9%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
5 - 1
</td>
<td style="text-align:left;">
11.6%
</td>
<td style="text-align:left;">
10.5%
</td>
<td style="text-align:left;">
13.0%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
5 - 2
</td>
<td style="text-align:left;">
11.6%
</td>
<td style="text-align:left;">
10.3%
</td>
<td style="text-align:left;">
12.9%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
5 - 3
</td>
<td style="text-align:left;">
10.9%
</td>
<td style="text-align:left;">
9.7%
</td>
<td style="text-align:left;">
12.4%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
5 - 4
</td>
<td style="text-align:left;">
7.2%
</td>
<td style="text-align:left;">
6.0%
</td>
<td style="text-align:left;">
8.4%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
</tbody>
</table>
</div>
<p>We’ve previously observed that setting the <code>spectral_weight</code> to “1” or “2” appears to have minimal impact on detection accuracy, with improvements only becoming apparent at levels of “3,” “4,” or “5.” These contrasts allow us to evaluate those hypotheses probabilistically. At a 0.2m CHM resolution, for example, there is no evidence that including spectral data but setting <code>spectral_weight</code> to “1” is better or worse than not including it at all (<code>spectral_weight</code> = “0”). Although setting <code>spectral_weight</code> to “3” provides a highly certain improvement in detection accuracy (~90% probability) compared to not using any spectral data, the improvement is small, at less than one percentage point. The model indicates with high certainty (&gt;99% probability) that the optimal setting for 0.2m CHM data is <code>spectral_weight</code> = “5,” which improves F-score by 6 percentage points compared to not including spectral data at all.</p>
<p>For coarser CHM data (e.g., &gt;0.3m), we can be highly confident (&gt;99% probability) that <code>spectral_weight</code> set to “5” is the optimal setting for detection accuracy. At this setting, F-score is increased by 10 percentage points for 0.4m resolution rasters and by 12 percentage points for 0.5m resolution rasters when compared to not including spectral data at all.</p>
</div>
</div>
</div>
</div>
<div id="mod_diam_mape" class="section level2 hasAnchor" number="9.2">
<h2><span class="header-section-number">9.2</span> Bayesian GLM - Diameter MAPE<a href="stats_method.html#mod_diam_mape" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="model-selection-1" class="section level3 hasAnchor" number="9.2.1">
<h3><span class="header-section-number">9.2.1</span> Model selection<a href="stats_method.html#model-selection-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>we’re going to use a sub-sample of the data to perform model testing. our objective is to construct the model such that it faithfully represents the data.</p>
<p>we reviewed the main effect parameter trends against MAPE <a href="chm_sens_test.html#mape_trends">here</a> and used these to guide our model design. we’ll follow Kurz <a href="https://bookdown.org/content/3686/18.html">2025</a> and compare our models with the LOO information criterion</p>
<blockquote>
<p>Like other information criteria, the LOO values aren’t of interest in and of themselves. However, the values of one model’s LOO relative to that of another is of great interest. We generally prefer models with lower estimates.</p>
</blockquote>
<div class="sourceCode" id="cb346"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb346-1"><a href="stats_method.html#cb346-1" tabindex="-1"></a><span class="co"># subsample data</span></span>
<span id="cb346-2"><a href="stats_method.html#cb346-2" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">222</span>)</span>
<span id="cb346-3"><a href="stats_method.html#cb346-3" tabindex="-1"></a>ms_df_temp <span class="ot">&lt;-</span> param_combos_spectral_ranked <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">slice_sample</span>(<span class="at">prop =</span> <span class="fl">0.11</span>)</span>
<span id="cb346-4"><a href="stats_method.html#cb346-4" tabindex="-1"></a><span class="co"># mcmc setup</span></span>
<span id="cb346-5"><a href="stats_method.html#cb346-5" tabindex="-1"></a>iter_temp <span class="ot">&lt;-</span> <span class="dv">2444</span></span>
<span id="cb346-6"><a href="stats_method.html#cb346-6" tabindex="-1"></a>warmup_temp <span class="ot">&lt;-</span> <span class="dv">1222</span></span>
<span id="cb346-7"><a href="stats_method.html#cb346-7" tabindex="-1"></a>chains_temp <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb346-8"><a href="stats_method.html#cb346-8" tabindex="-1"></a><span class="do">####################################################################</span></span>
<span id="cb346-9"><a href="stats_method.html#cb346-9" tabindex="-1"></a><span class="co"># base model with form selected based on main effect trends</span></span>
<span id="cb346-10"><a href="stats_method.html#cb346-10" tabindex="-1"></a><span class="do">####################################################################</span></span>
<span id="cb346-11"><a href="stats_method.html#cb346-11" tabindex="-1"></a>diam_mape_mod1_temp <span class="ot">&lt;-</span> brms<span class="sc">::</span><span class="fu">brm</span>(</span>
<span id="cb346-12"><a href="stats_method.html#cb346-12" tabindex="-1"></a>  <span class="at">formula =</span> pct_diff_diameter_m_mape <span class="sc">~</span> </span>
<span id="cb346-13"><a href="stats_method.html#cb346-13" tabindex="-1"></a>    <span class="dv">0</span> <span class="sc">+</span> <span class="co"># no intercept to allow all values of spectral_weight to be shown instead of set as the baseline </span></span>
<span id="cb346-14"><a href="stats_method.html#cb346-14" tabindex="-1"></a>    max_ht_m <span class="sc">+</span> max_area_m2 <span class="sc">+</span> convexity_pct <span class="sc">+</span> circle_fit_iou_pct <span class="sc">+</span></span>
<span id="cb346-15"><a href="stats_method.html#cb346-15" tabindex="-1"></a>    chm_res_m <span class="sc">+</span></span>
<span id="cb346-16"><a href="stats_method.html#cb346-16" tabindex="-1"></a>    spectral_weight <span class="sc">+</span> chm_res_m<span class="sc">:</span>spectral_weight</span>
<span id="cb346-17"><a href="stats_method.html#cb346-17" tabindex="-1"></a>  , <span class="at">data =</span> ms_df_temp</span>
<span id="cb346-18"><a href="stats_method.html#cb346-18" tabindex="-1"></a>  , <span class="at">family =</span> <span class="fu">Gamma</span>(<span class="at">link =</span> <span class="st">&quot;log&quot;</span>)</span>
<span id="cb346-19"><a href="stats_method.html#cb346-19" tabindex="-1"></a>  <span class="co"># mcmc</span></span>
<span id="cb346-20"><a href="stats_method.html#cb346-20" tabindex="-1"></a>  , <span class="at">iter =</span> iter_temp, <span class="at">warmup =</span> warmup_temp</span>
<span id="cb346-21"><a href="stats_method.html#cb346-21" tabindex="-1"></a>  , <span class="at">chains =</span> chains_temp</span>
<span id="cb346-22"><a href="stats_method.html#cb346-22" tabindex="-1"></a>  <span class="co"># , control = list(adapt_delta = 0.999, max_treedepth = 13)</span></span>
<span id="cb346-23"><a href="stats_method.html#cb346-23" tabindex="-1"></a>  , <span class="at">cores =</span> lasR<span class="sc">::</span><span class="fu">half_cores</span>()</span>
<span id="cb346-24"><a href="stats_method.html#cb346-24" tabindex="-1"></a>  , <span class="at">file =</span> <span class="fu">paste0</span>(<span class="st">&quot;../data/&quot;</span>, <span class="st">&quot;diam_mape_mod1_temp&quot;</span>)</span>
<span id="cb346-25"><a href="stats_method.html#cb346-25" tabindex="-1"></a>)</span>
<span id="cb346-26"><a href="stats_method.html#cb346-26" tabindex="-1"></a>diam_mape_mod1_temp <span class="ot">&lt;-</span> brms<span class="sc">::</span><span class="fu">add_criterion</span>(diam_mape_mod1_temp, <span class="at">criterion =</span> <span class="st">&quot;loo&quot;</span>)</span>
<span id="cb346-27"><a href="stats_method.html#cb346-27" tabindex="-1"></a><span class="do">####################################################################</span></span>
<span id="cb346-28"><a href="stats_method.html#cb346-28" tabindex="-1"></a><span class="co"># allows slope and curvature of circle_fit_iou_pct to vary by chm_res_m and vice-versa</span></span>
<span id="cb346-29"><a href="stats_method.html#cb346-29" tabindex="-1"></a><span class="do">####################################################################</span></span>
<span id="cb346-30"><a href="stats_method.html#cb346-30" tabindex="-1"></a>diam_mape_mod2_temp <span class="ot">&lt;-</span> brms<span class="sc">::</span><span class="fu">brm</span>(</span>
<span id="cb346-31"><a href="stats_method.html#cb346-31" tabindex="-1"></a>  <span class="at">formula =</span> pct_diff_diameter_m_mape <span class="sc">~</span> </span>
<span id="cb346-32"><a href="stats_method.html#cb346-32" tabindex="-1"></a>    <span class="dv">0</span> <span class="sc">+</span> <span class="co"># no intercept to allow all values of spectral_weight to be shown instead of set as the baseline </span></span>
<span id="cb346-33"><a href="stats_method.html#cb346-33" tabindex="-1"></a>    max_ht_m <span class="sc">+</span> max_area_m2 <span class="sc">+</span> convexity_pct <span class="sc">+</span> </span>
<span id="cb346-34"><a href="stats_method.html#cb346-34" tabindex="-1"></a>    circle_fit_iou_pct <span class="sc">+</span> <span class="fu">I</span>(circle_fit_iou_pct<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> <span class="co"># changed from base model</span></span>
<span id="cb346-35"><a href="stats_method.html#cb346-35" tabindex="-1"></a>    chm_res_m <span class="sc">+</span></span>
<span id="cb346-36"><a href="stats_method.html#cb346-36" tabindex="-1"></a>    spectral_weight <span class="sc">+</span> chm_res_m<span class="sc">:</span>spectral_weight</span>
<span id="cb346-37"><a href="stats_method.html#cb346-37" tabindex="-1"></a>  , <span class="at">data =</span> ms_df_temp</span>
<span id="cb346-38"><a href="stats_method.html#cb346-38" tabindex="-1"></a>  , <span class="at">family =</span> <span class="fu">Gamma</span>(<span class="at">link =</span> <span class="st">&quot;log&quot;</span>)</span>
<span id="cb346-39"><a href="stats_method.html#cb346-39" tabindex="-1"></a>  <span class="co"># mcmc</span></span>
<span id="cb346-40"><a href="stats_method.html#cb346-40" tabindex="-1"></a>  , <span class="at">iter =</span> iter_temp, <span class="at">warmup =</span> warmup_temp</span>
<span id="cb346-41"><a href="stats_method.html#cb346-41" tabindex="-1"></a>  , <span class="at">chains =</span> chains_temp</span>
<span id="cb346-42"><a href="stats_method.html#cb346-42" tabindex="-1"></a>  <span class="co"># , control = list(adapt_delta = 0.999, max_treedepth = 13)</span></span>
<span id="cb346-43"><a href="stats_method.html#cb346-43" tabindex="-1"></a>  , <span class="at">cores =</span> lasR<span class="sc">::</span><span class="fu">half_cores</span>()</span>
<span id="cb346-44"><a href="stats_method.html#cb346-44" tabindex="-1"></a>  , <span class="at">file =</span> <span class="fu">paste0</span>(<span class="st">&quot;../data/&quot;</span>, <span class="st">&quot;diam_mape_mod2_temp&quot;</span>)</span>
<span id="cb346-45"><a href="stats_method.html#cb346-45" tabindex="-1"></a>)</span>
<span id="cb346-46"><a href="stats_method.html#cb346-46" tabindex="-1"></a>diam_mape_mod2_temp <span class="ot">&lt;-</span> brms<span class="sc">::</span><span class="fu">add_criterion</span>(diam_mape_mod2_temp, <span class="at">criterion =</span> <span class="st">&quot;loo&quot;</span>)</span>
<span id="cb346-47"><a href="stats_method.html#cb346-47" tabindex="-1"></a><span class="do">####################################################################</span></span>
<span id="cb346-48"><a href="stats_method.html#cb346-48" tabindex="-1"></a><span class="co"># allows slope and curvature of circle_fit_iou_pct to vary by convexity_pct and vice-versa</span></span>
<span id="cb346-49"><a href="stats_method.html#cb346-49" tabindex="-1"></a><span class="do">####################################################################</span></span>
<span id="cb346-50"><a href="stats_method.html#cb346-50" tabindex="-1"></a>diam_mape_mod3_temp <span class="ot">&lt;-</span> brms<span class="sc">::</span><span class="fu">brm</span>(</span>
<span id="cb346-51"><a href="stats_method.html#cb346-51" tabindex="-1"></a>  <span class="at">formula =</span> pct_diff_diameter_m_mape <span class="sc">~</span> </span>
<span id="cb346-52"><a href="stats_method.html#cb346-52" tabindex="-1"></a>    <span class="dv">0</span> <span class="sc">+</span> <span class="co"># no intercept to allow all values of spectral_weight to be shown instead of set as the baseline </span></span>
<span id="cb346-53"><a href="stats_method.html#cb346-53" tabindex="-1"></a>    max_ht_m <span class="sc">+</span> max_area_m2 <span class="sc">+</span> </span>
<span id="cb346-54"><a href="stats_method.html#cb346-54" tabindex="-1"></a>    convexity_pct <span class="sc">+</span> <span class="fu">I</span>(convexity_pct<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> <span class="co"># changed from base model</span></span>
<span id="cb346-55"><a href="stats_method.html#cb346-55" tabindex="-1"></a>    circle_fit_iou_pct <span class="sc">+</span> <span class="fu">I</span>(circle_fit_iou_pct<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> <span class="co"># changed from base model</span></span>
<span id="cb346-56"><a href="stats_method.html#cb346-56" tabindex="-1"></a>    convexity_pct<span class="sc">:</span>circle_fit_iou_pct <span class="sc">+</span> <span class="co"># changed from base model</span></span>
<span id="cb346-57"><a href="stats_method.html#cb346-57" tabindex="-1"></a>    chm_res_m <span class="sc">+</span></span>
<span id="cb346-58"><a href="stats_method.html#cb346-58" tabindex="-1"></a>    spectral_weight <span class="sc">+</span> chm_res_m<span class="sc">:</span>spectral_weight</span>
<span id="cb346-59"><a href="stats_method.html#cb346-59" tabindex="-1"></a>  , <span class="at">data =</span> ms_df_temp</span>
<span id="cb346-60"><a href="stats_method.html#cb346-60" tabindex="-1"></a>  , <span class="at">family =</span> <span class="fu">Gamma</span>(<span class="at">link =</span> <span class="st">&quot;log&quot;</span>)</span>
<span id="cb346-61"><a href="stats_method.html#cb346-61" tabindex="-1"></a>  <span class="co"># mcmc</span></span>
<span id="cb346-62"><a href="stats_method.html#cb346-62" tabindex="-1"></a>  , <span class="at">iter =</span> iter_temp, <span class="at">warmup =</span> warmup_temp</span>
<span id="cb346-63"><a href="stats_method.html#cb346-63" tabindex="-1"></a>  , <span class="at">chains =</span> chains_temp</span>
<span id="cb346-64"><a href="stats_method.html#cb346-64" tabindex="-1"></a>  <span class="co"># , control = list(adapt_delta = 0.999, max_treedepth = 13)</span></span>
<span id="cb346-65"><a href="stats_method.html#cb346-65" tabindex="-1"></a>  , <span class="at">cores =</span> lasR<span class="sc">::</span><span class="fu">half_cores</span>()</span>
<span id="cb346-66"><a href="stats_method.html#cb346-66" tabindex="-1"></a>  , <span class="at">file =</span> <span class="fu">paste0</span>(<span class="st">&quot;../data/&quot;</span>, <span class="st">&quot;diam_mape_mod3_temp&quot;</span>)</span>
<span id="cb346-67"><a href="stats_method.html#cb346-67" tabindex="-1"></a>)</span>
<span id="cb346-68"><a href="stats_method.html#cb346-68" tabindex="-1"></a>diam_mape_mod3_temp <span class="ot">&lt;-</span> brms<span class="sc">::</span><span class="fu">add_criterion</span>(diam_mape_mod3_temp, <span class="at">criterion =</span> <span class="st">&quot;loo&quot;</span>)</span>
<span id="cb346-69"><a href="stats_method.html#cb346-69" tabindex="-1"></a><span class="do">####################################################################</span></span>
<span id="cb346-70"><a href="stats_method.html#cb346-70" tabindex="-1"></a><span class="co"># a three-way interaction of circle_fit_iou_pct, convexity_pct and chm_res_m</span></span>
<span id="cb346-71"><a href="stats_method.html#cb346-71" tabindex="-1"></a><span class="do">####################################################################</span></span>
<span id="cb346-72"><a href="stats_method.html#cb346-72" tabindex="-1"></a>diam_mape_mod4_temp <span class="ot">&lt;-</span> brms<span class="sc">::</span><span class="fu">brm</span>(</span>
<span id="cb346-73"><a href="stats_method.html#cb346-73" tabindex="-1"></a>  <span class="at">formula =</span> pct_diff_diameter_m_mape <span class="sc">~</span> </span>
<span id="cb346-74"><a href="stats_method.html#cb346-74" tabindex="-1"></a>    <span class="dv">0</span> <span class="sc">+</span> <span class="co"># no intercept to allow all values of spectral_weight to be shown instead of set as the baseline </span></span>
<span id="cb346-75"><a href="stats_method.html#cb346-75" tabindex="-1"></a>    max_ht_m <span class="sc">+</span> max_area_m2 <span class="sc">+</span> </span>
<span id="cb346-76"><a href="stats_method.html#cb346-76" tabindex="-1"></a>    convexity_pct <span class="sc">+</span> <span class="fu">I</span>(convexity_pct<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> <span class="co"># changed from base model</span></span>
<span id="cb346-77"><a href="stats_method.html#cb346-77" tabindex="-1"></a>    circle_fit_iou_pct <span class="sc">+</span> <span class="fu">I</span>(circle_fit_iou_pct<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> <span class="co"># changed from base model</span></span>
<span id="cb346-78"><a href="stats_method.html#cb346-78" tabindex="-1"></a>    convexity_pct<span class="sc">:</span>circle_fit_iou_pct <span class="sc">+</span> <span class="co"># changed from base model</span></span>
<span id="cb346-79"><a href="stats_method.html#cb346-79" tabindex="-1"></a>    chm_res_m <span class="sc">+</span> <span class="fu">I</span>(chm_res_m<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> <span class="co"># changed from base model</span></span>
<span id="cb346-80"><a href="stats_method.html#cb346-80" tabindex="-1"></a>    spectral_weight <span class="sc">+</span> chm_res_m<span class="sc">:</span>spectral_weight</span>
<span id="cb346-81"><a href="stats_method.html#cb346-81" tabindex="-1"></a>  , <span class="at">data =</span> ms_df_temp</span>
<span id="cb346-82"><a href="stats_method.html#cb346-82" tabindex="-1"></a>  , <span class="at">family =</span> <span class="fu">Gamma</span>(<span class="at">link =</span> <span class="st">&quot;log&quot;</span>)</span>
<span id="cb346-83"><a href="stats_method.html#cb346-83" tabindex="-1"></a>  <span class="co"># mcmc</span></span>
<span id="cb346-84"><a href="stats_method.html#cb346-84" tabindex="-1"></a>  , <span class="at">iter =</span> iter_temp, <span class="at">warmup =</span> warmup_temp</span>
<span id="cb346-85"><a href="stats_method.html#cb346-85" tabindex="-1"></a>  , <span class="at">chains =</span> chains_temp</span>
<span id="cb346-86"><a href="stats_method.html#cb346-86" tabindex="-1"></a>  <span class="co"># , control = list(adapt_delta = 0.999, max_treedepth = 13)</span></span>
<span id="cb346-87"><a href="stats_method.html#cb346-87" tabindex="-1"></a>  , <span class="at">cores =</span> lasR<span class="sc">::</span><span class="fu">half_cores</span>()</span>
<span id="cb346-88"><a href="stats_method.html#cb346-88" tabindex="-1"></a>  , <span class="at">file =</span> <span class="fu">paste0</span>(<span class="st">&quot;../data/&quot;</span>, <span class="st">&quot;diam_mape_mod4_temp&quot;</span>)</span>
<span id="cb346-89"><a href="stats_method.html#cb346-89" tabindex="-1"></a>)</span>
<span id="cb346-90"><a href="stats_method.html#cb346-90" tabindex="-1"></a>diam_mape_mod4_temp <span class="ot">&lt;-</span> brms<span class="sc">::</span><span class="fu">add_criterion</span>(diam_mape_mod4_temp, <span class="at">criterion =</span> <span class="st">&quot;loo&quot;</span>)</span>
<span id="cb346-91"><a href="stats_method.html#cb346-91" tabindex="-1"></a><span class="do">####################################################################</span></span>
<span id="cb346-92"><a href="stats_method.html#cb346-92" tabindex="-1"></a><span class="co"># a three-way interaction of circle_fit_iou_pct, convexity_pct and chm_res_m</span></span>
<span id="cb346-93"><a href="stats_method.html#cb346-93" tabindex="-1"></a><span class="do">####################################################################</span></span>
<span id="cb346-94"><a href="stats_method.html#cb346-94" tabindex="-1"></a>diam_mape_mod5_temp <span class="ot">&lt;-</span> brms<span class="sc">::</span><span class="fu">brm</span>(</span>
<span id="cb346-95"><a href="stats_method.html#cb346-95" tabindex="-1"></a>  <span class="at">formula =</span> pct_diff_diameter_m_mape <span class="sc">~</span></span>
<span id="cb346-96"><a href="stats_method.html#cb346-96" tabindex="-1"></a>    <span class="dv">0</span> <span class="sc">+</span> <span class="co"># no intercept to allow all values of spectral_weight to be shown instead of set as the baseline </span></span>
<span id="cb346-97"><a href="stats_method.html#cb346-97" tabindex="-1"></a>    max_ht_m <span class="sc">+</span> max_area_m2 <span class="sc">+</span> </span>
<span id="cb346-98"><a href="stats_method.html#cb346-98" tabindex="-1"></a>    convexity_pct <span class="sc">+</span> <span class="fu">I</span>(convexity_pct<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> <span class="co"># changed from base model</span></span>
<span id="cb346-99"><a href="stats_method.html#cb346-99" tabindex="-1"></a>    circle_fit_iou_pct <span class="sc">+</span> <span class="fu">I</span>(circle_fit_iou_pct<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> <span class="co"># changed from base model</span></span>
<span id="cb346-100"><a href="stats_method.html#cb346-100" tabindex="-1"></a>    convexity_pct<span class="sc">:</span>circle_fit_iou_pct <span class="sc">+</span> <span class="co"># changed from base model</span></span>
<span id="cb346-101"><a href="stats_method.html#cb346-101" tabindex="-1"></a>    convexity_pct<span class="sc">:</span>chm_res_m <span class="sc">+</span> <span class="co"># changed from base model</span></span>
<span id="cb346-102"><a href="stats_method.html#cb346-102" tabindex="-1"></a>    circle_fit_iou_pct<span class="sc">:</span>chm_res_m <span class="sc">+</span> <span class="co"># changed from base model</span></span>
<span id="cb346-103"><a href="stats_method.html#cb346-103" tabindex="-1"></a>    convexity_pct<span class="sc">:</span>circle_fit_iou_pct<span class="sc">:</span>chm_res_m <span class="sc">+</span> <span class="co"># changed from base model</span></span>
<span id="cb346-104"><a href="stats_method.html#cb346-104" tabindex="-1"></a>    chm_res_m <span class="sc">+</span></span>
<span id="cb346-105"><a href="stats_method.html#cb346-105" tabindex="-1"></a>    spectral_weight <span class="sc">+</span> chm_res_m<span class="sc">:</span>spectral_weight</span>
<span id="cb346-106"><a href="stats_method.html#cb346-106" tabindex="-1"></a>  , <span class="at">data =</span> ms_df_temp</span>
<span id="cb346-107"><a href="stats_method.html#cb346-107" tabindex="-1"></a>  , <span class="at">family =</span> <span class="fu">Gamma</span>(<span class="at">link =</span> <span class="st">&quot;log&quot;</span>)</span>
<span id="cb346-108"><a href="stats_method.html#cb346-108" tabindex="-1"></a>  <span class="co"># mcmc</span></span>
<span id="cb346-109"><a href="stats_method.html#cb346-109" tabindex="-1"></a>  , <span class="at">iter =</span> iter_temp, <span class="at">warmup =</span> warmup_temp</span>
<span id="cb346-110"><a href="stats_method.html#cb346-110" tabindex="-1"></a>  , <span class="at">chains =</span> chains_temp</span>
<span id="cb346-111"><a href="stats_method.html#cb346-111" tabindex="-1"></a>  <span class="co"># , control = list(adapt_delta = 0.999, max_treedepth = 13)</span></span>
<span id="cb346-112"><a href="stats_method.html#cb346-112" tabindex="-1"></a>  , <span class="at">cores =</span> lasR<span class="sc">::</span><span class="fu">half_cores</span>()</span>
<span id="cb346-113"><a href="stats_method.html#cb346-113" tabindex="-1"></a>  , <span class="at">file =</span> <span class="fu">paste0</span>(<span class="st">&quot;../data/&quot;</span>, <span class="st">&quot;diam_mape_mod5_temp&quot;</span>)</span>
<span id="cb346-114"><a href="stats_method.html#cb346-114" tabindex="-1"></a>)</span>
<span id="cb346-115"><a href="stats_method.html#cb346-115" tabindex="-1"></a>diam_mape_mod5_temp <span class="ot">&lt;-</span> brms<span class="sc">::</span><span class="fu">add_criterion</span>(diam_mape_mod5_temp, <span class="at">criterion =</span> <span class="st">&quot;loo&quot;</span>)</span>
<span id="cb346-116"><a href="stats_method.html#cb346-116" tabindex="-1"></a><span class="do">####################################################################</span></span>
<span id="cb346-117"><a href="stats_method.html#cb346-117" tabindex="-1"></a><span class="co"># a three-way interaction of circle_fit_iou_pct, convexity_pct and chm_res_m</span></span>
<span id="cb346-118"><a href="stats_method.html#cb346-118" tabindex="-1"></a><span class="do">####################################################################</span></span>
<span id="cb346-119"><a href="stats_method.html#cb346-119" tabindex="-1"></a>diam_mape_mod6_temp <span class="ot">&lt;-</span> brms<span class="sc">::</span><span class="fu">brm</span>(</span>
<span id="cb346-120"><a href="stats_method.html#cb346-120" tabindex="-1"></a>  <span class="at">formula =</span> pct_diff_diameter_m_mape <span class="sc">~</span></span>
<span id="cb346-121"><a href="stats_method.html#cb346-121" tabindex="-1"></a>    <span class="dv">0</span> <span class="sc">+</span> <span class="co"># no intercept to allow all values of spectral_weight to be shown instead of set as the baseline </span></span>
<span id="cb346-122"><a href="stats_method.html#cb346-122" tabindex="-1"></a>    max_ht_m <span class="sc">+</span> max_area_m2 <span class="sc">+</span> </span>
<span id="cb346-123"><a href="stats_method.html#cb346-123" tabindex="-1"></a>    convexity_pct <span class="sc">+</span> <span class="fu">I</span>(convexity_pct<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> <span class="co"># changed from base model</span></span>
<span id="cb346-124"><a href="stats_method.html#cb346-124" tabindex="-1"></a>    circle_fit_iou_pct <span class="sc">+</span> <span class="fu">I</span>(circle_fit_iou_pct<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> <span class="co"># changed from base model</span></span>
<span id="cb346-125"><a href="stats_method.html#cb346-125" tabindex="-1"></a>    convexity_pct<span class="sc">:</span>circle_fit_iou_pct <span class="sc">+</span> <span class="co"># changed from base model</span></span>
<span id="cb346-126"><a href="stats_method.html#cb346-126" tabindex="-1"></a>    convexity_pct<span class="sc">:</span>chm_res_m <span class="sc">+</span> <span class="co"># changed from base model</span></span>
<span id="cb346-127"><a href="stats_method.html#cb346-127" tabindex="-1"></a>    circle_fit_iou_pct<span class="sc">:</span>chm_res_m <span class="sc">+</span> <span class="co"># changed from base model</span></span>
<span id="cb346-128"><a href="stats_method.html#cb346-128" tabindex="-1"></a>    convexity_pct<span class="sc">:</span>circle_fit_iou_pct<span class="sc">:</span>chm_res_m <span class="sc">+</span> <span class="co"># changed from base model</span></span>
<span id="cb346-129"><a href="stats_method.html#cb346-129" tabindex="-1"></a>    chm_res_m <span class="sc">+</span> <span class="fu">I</span>(chm_res_m<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> <span class="co"># changed from base model</span></span>
<span id="cb346-130"><a href="stats_method.html#cb346-130" tabindex="-1"></a>    spectral_weight <span class="sc">+</span> chm_res_m<span class="sc">:</span>spectral_weight</span>
<span id="cb346-131"><a href="stats_method.html#cb346-131" tabindex="-1"></a>  , <span class="at">data =</span> ms_df_temp</span>
<span id="cb346-132"><a href="stats_method.html#cb346-132" tabindex="-1"></a>  , <span class="at">family =</span> <span class="fu">Gamma</span>(<span class="at">link =</span> <span class="st">&quot;log&quot;</span>)</span>
<span id="cb346-133"><a href="stats_method.html#cb346-133" tabindex="-1"></a>  <span class="co"># mcmc</span></span>
<span id="cb346-134"><a href="stats_method.html#cb346-134" tabindex="-1"></a>  , <span class="at">iter =</span> iter_temp, <span class="at">warmup =</span> warmup_temp</span>
<span id="cb346-135"><a href="stats_method.html#cb346-135" tabindex="-1"></a>  , <span class="at">chains =</span> chains_temp</span>
<span id="cb346-136"><a href="stats_method.html#cb346-136" tabindex="-1"></a>  <span class="co"># , control = list(adapt_delta = 0.999, max_treedepth = 13)</span></span>
<span id="cb346-137"><a href="stats_method.html#cb346-137" tabindex="-1"></a>  , <span class="at">cores =</span> lasR<span class="sc">::</span><span class="fu">half_cores</span>()</span>
<span id="cb346-138"><a href="stats_method.html#cb346-138" tabindex="-1"></a>  , <span class="at">file =</span> <span class="fu">paste0</span>(<span class="st">&quot;../data/&quot;</span>, <span class="st">&quot;diam_mape_mod6_temp&quot;</span>)</span>
<span id="cb346-139"><a href="stats_method.html#cb346-139" tabindex="-1"></a>)</span>
<span id="cb346-140"><a href="stats_method.html#cb346-140" tabindex="-1"></a>diam_mape_mod6_temp <span class="ot">&lt;-</span> brms<span class="sc">::</span><span class="fu">add_criterion</span>(diam_mape_mod6_temp, <span class="at">criterion =</span> <span class="st">&quot;loo&quot;</span>)</span></code></pre></div>
<p>compare our models with the LOO information criterion. with the <code>brms::loo_compare()</code> function, we can compute a formal difference score between models with the output rank ordering the models such that the best fitting model appears on top. all models also receive a difference score relative to the best model and a standard error of the difference score</p>
<div class="sourceCode" id="cb347"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb347-1"><a href="stats_method.html#cb347-1" tabindex="-1"></a>brms<span class="sc">::</span><span class="fu">loo_compare</span>(</span>
<span id="cb347-2"><a href="stats_method.html#cb347-2" tabindex="-1"></a>  diam_mape_mod1_temp, diam_mape_mod2_temp, diam_mape_mod3_temp</span>
<span id="cb347-3"><a href="stats_method.html#cb347-3" tabindex="-1"></a>  , diam_mape_mod4_temp, diam_mape_mod5_temp, diam_mape_mod6_temp</span>
<span id="cb347-4"><a href="stats_method.html#cb347-4" tabindex="-1"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb347-5"><a href="stats_method.html#cb347-5" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kbl</span>(<span class="at">caption =</span> <span class="st">&quot;Diameter MAPE model selection with LOO information criterion&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb347-6"><a href="stats_method.html#cb347-6" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kable_styling</span>()</span></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-329">Table 9.8: </span>Diameter MAPE model selection with LOO information criterion
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
elpd_diff
</th>
<th style="text-align:right;">
se_diff
</th>
<th style="text-align:right;">
elpd_loo
</th>
<th style="text-align:right;">
se_elpd_loo
</th>
<th style="text-align:right;">
p_loo
</th>
<th style="text-align:right;">
se_p_loo
</th>
<th style="text-align:right;">
looic
</th>
<th style="text-align:right;">
se_looic
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
diam_mape_mod6_temp
</td>
<td style="text-align:right;">
0.00000
</td>
<td style="text-align:right;">
0.000000
</td>
<td style="text-align:right;">
4858.224
</td>
<td style="text-align:right;">
230.2337
</td>
<td style="text-align:right;">
50.45998
</td>
<td style="text-align:right;">
8.675364
</td>
<td style="text-align:right;">
-9716.447
</td>
<td style="text-align:right;">
460.4674
</td>
</tr>
<tr>
<td style="text-align:left;">
diam_mape_mod4_temp
</td>
<td style="text-align:right;">
-27.48832
</td>
<td style="text-align:right;">
9.248765
</td>
<td style="text-align:right;">
4830.735
</td>
<td style="text-align:right;">
230.5794
</td>
<td style="text-align:right;">
45.42794
</td>
<td style="text-align:right;">
7.940583
</td>
<td style="text-align:right;">
-9661.471
</td>
<td style="text-align:right;">
461.1589
</td>
</tr>
<tr>
<td style="text-align:left;">
diam_mape_mod5_temp
</td>
<td style="text-align:right;">
-209.19202
</td>
<td style="text-align:right;">
23.057174
</td>
<td style="text-align:right;">
4649.032
</td>
<td style="text-align:right;">
209.4472
</td>
<td style="text-align:right;">
43.45478
</td>
<td style="text-align:right;">
7.092683
</td>
<td style="text-align:right;">
-9298.063
</td>
<td style="text-align:right;">
418.8943
</td>
</tr>
<tr>
<td style="text-align:left;">
diam_mape_mod3_temp
</td>
<td style="text-align:right;">
-225.57831
</td>
<td style="text-align:right;">
23.411588
</td>
<td style="text-align:right;">
4632.645
</td>
<td style="text-align:right;">
210.1472
</td>
<td style="text-align:right;">
39.40540
</td>
<td style="text-align:right;">
6.586324
</td>
<td style="text-align:right;">
-9265.291
</td>
<td style="text-align:right;">
420.2943
</td>
</tr>
<tr>
<td style="text-align:left;">
diam_mape_mod2_temp
</td>
<td style="text-align:right;">
-241.68897
</td>
<td style="text-align:right;">
25.707239
</td>
<td style="text-align:right;">
4616.535
</td>
<td style="text-align:right;">
208.9627
</td>
<td style="text-align:right;">
39.61183
</td>
<td style="text-align:right;">
6.834882
</td>
<td style="text-align:right;">
-9233.070
</td>
<td style="text-align:right;">
417.9254
</td>
</tr>
<tr>
<td style="text-align:left;">
diam_mape_mod1_temp
</td>
<td style="text-align:right;">
-255.46016
</td>
<td style="text-align:right;">
25.441375
</td>
<td style="text-align:right;">
4602.764
</td>
<td style="text-align:right;">
209.4960
</td>
<td style="text-align:right;">
37.39897
</td>
<td style="text-align:right;">
6.526955
</td>
<td style="text-align:right;">
-9205.527
</td>
<td style="text-align:right;">
418.9920
</td>
</tr>
</tbody>
</table>
<p>we can also look at the AIC-type model weights</p>
<div class="sourceCode" id="cb348"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb348-1"><a href="stats_method.html#cb348-1" tabindex="-1"></a>brms<span class="sc">::</span><span class="fu">model_weights</span>(</span>
<span id="cb348-2"><a href="stats_method.html#cb348-2" tabindex="-1"></a>  diam_mape_mod1_temp, diam_mape_mod2_temp, diam_mape_mod3_temp</span>
<span id="cb348-3"><a href="stats_method.html#cb348-3" tabindex="-1"></a>  , diam_mape_mod4_temp, diam_mape_mod5_temp, diam_mape_mod6_temp</span>
<span id="cb348-4"><a href="stats_method.html#cb348-4" tabindex="-1"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb348-5"><a href="stats_method.html#cb348-5" tabindex="-1"></a>  <span class="fu">round</span>(<span class="at">digits =</span> <span class="dv">4</span>)</span></code></pre></div>
<p>we can also quickly look at the Bayeisan <span class="math inline">\(R^2\)</span> returned from the <code>brms::bayes_R2()</code> function</p>
<div class="sourceCode" id="cb349"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb349-1"><a href="stats_method.html#cb349-1" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(</span>
<span id="cb349-2"><a href="stats_method.html#cb349-2" tabindex="-1"></a>  brms<span class="sc">::</span><span class="fu">bayes_R2</span>(diam_mape_mod1_temp,<span class="at">summary=</span>F) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">mod =</span> <span class="st">&quot;diam_mape_mod1_temp&quot;</span>)</span>
<span id="cb349-3"><a href="stats_method.html#cb349-3" tabindex="-1"></a>  , brms<span class="sc">::</span><span class="fu">bayes_R2</span>(diam_mape_mod2_temp,<span class="at">summary=</span>F) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">mod =</span> <span class="st">&quot;diam_mape_mod2_temp&quot;</span>)</span>
<span id="cb349-4"><a href="stats_method.html#cb349-4" tabindex="-1"></a>  , brms<span class="sc">::</span><span class="fu">bayes_R2</span>(diam_mape_mod3_temp,<span class="at">summary=</span>F) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">mod =</span> <span class="st">&quot;diam_mape_mod3_temp&quot;</span>)</span>
<span id="cb349-5"><a href="stats_method.html#cb349-5" tabindex="-1"></a>  , brms<span class="sc">::</span><span class="fu">bayes_R2</span>(diam_mape_mod4_temp,<span class="at">summary=</span>F) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">mod =</span> <span class="st">&quot;diam_mape_mod4_temp&quot;</span>)</span>
<span id="cb349-6"><a href="stats_method.html#cb349-6" tabindex="-1"></a>  , brms<span class="sc">::</span><span class="fu">bayes_R2</span>(diam_mape_mod5_temp,<span class="at">summary=</span>F) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">mod =</span> <span class="st">&quot;diam_mape_mod5_temp&quot;</span>)</span>
<span id="cb349-7"><a href="stats_method.html#cb349-7" tabindex="-1"></a>  , brms<span class="sc">::</span><span class="fu">bayes_R2</span>(diam_mape_mod6_temp,<span class="at">summary=</span>F) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">mod =</span> <span class="st">&quot;diam_mape_mod6_temp&quot;</span>)</span>
<span id="cb349-8"><a href="stats_method.html#cb349-8" tabindex="-1"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb349-9"><a href="stats_method.html#cb349-9" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">mod =</span> <span class="fu">factor</span>(mod)) <span class="sc">%&gt;%</span> </span>
<span id="cb349-10"><a href="stats_method.html#cb349-10" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="at">mapping=</span>ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">y=</span>R2, <span class="at">x =</span> mod)) <span class="sc">+</span></span>
<span id="cb349-11"><a href="stats_method.html#cb349-11" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">stat_eye</span>(</span>
<span id="cb349-12"><a href="stats_method.html#cb349-12" tabindex="-1"></a>    <span class="at">point_interval =</span> median_hdi, <span class="at">.width =</span> .<span class="dv">95</span></span>
<span id="cb349-13"><a href="stats_method.html#cb349-13" tabindex="-1"></a>    , <span class="at">slab_alpha =</span> <span class="fl">0.95</span></span>
<span id="cb349-14"><a href="stats_method.html#cb349-14" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb349-15"><a href="stats_method.html#cb349-15" tabindex="-1"></a>  <span class="co"># ggplot2::facet_grid(cols = dplyr::vars(spectral_weight)) +</span></span>
<span id="cb349-16"><a href="stats_method.html#cb349-16" tabindex="-1"></a>  <span class="co"># ggplot2::scale_fill_manual(values = pal_chm_res_m) +</span></span>
<span id="cb349-17"><a href="stats_method.html#cb349-17" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Bayesian R-squared&quot;</span>) <span class="sc">+</span></span>
<span id="cb349-18"><a href="stats_method.html#cb349-18" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_light</span>()</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-331-1.png" width="1008" /></p>
<p>the more complex models were selected as the best. because the selected model includes quadratic terms and multiple interactions parameter interpretation will be a challenge, so we will have to rely on plotting the modeled relationships rather than trying to interpret the coefficients.</p>
</div>
<div id="mod_diam_mape2" class="section level3 hasAnchor" number="9.2.2">
<h3><span class="header-section-number">9.2.2</span> Modeling<a href="stats_method.html#mod_diam_mape2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>the selected MAPE model predicts diameter error using the four structural parameters (<code>max_ht_m</code>, <code>max_area_m2</code>, <code>convexity_pct</code>, <code>circle_fit_iou_pct</code>) and data properties representing the CHM resolution (<code>chm_res_m</code>) and the use of spectral data (<code>spectral_weight</code>). The model includes quadratic terms for both <code>chm_res_m</code> and <code>circle_fit_iou_pct</code> to allow for non-linear relationships between these parameters and MAPE.</p>
<p>To account for how different parameters influence each other, the model includes several interaction terms. The <code>circle_fit_iou_pct:chm_res_m</code> and the <code>circle_fit_iou_pct:convexity_pct</code> interactions were included to explore how the effect of the geometric filtering parameters varies with CHM resolution and with each other. In addition, the model includes <code>spectral_weight</code> as a main effect and in an interaction with <code>chm_res_m</code>. This means that the predicted MAPE can vary by the <code>spectral_weight</code> setting even when all other variables are zero (i.e. the intercept), effectively giving each level of <code>spectral_weight</code> its own unique intercept. Finally, the <code>chm_res_m:spectral_weight</code> interaction allows the effect of CHM resolution (i.e. its slope) on MAPE to vary across each <code>spectral_weight</code> setting.</p>
<p>the fully factored Bayesian statistical model that details the likelihood, linear model, and priors used is:</p>
<p><span class="math display">\[\begin{align*}
\text{MAPE}_i \sim &amp; \operatorname{Gamma}(\mu_i, \text{shape}) \\
\log(\mu_i) = &amp; (\beta_1 \cdot \text{max_ht_m}_i) + (\beta_2 \cdot \text{max_area_m2}_i) \\
&amp; + (\beta_3 \cdot \text{convexity_pct}_i) + (\beta_4 \cdot (\text{convexity_pct}_i)^2) \\
&amp; + (\beta_5 \cdot \text{circle_fit_iou_pct}_i) + (\beta_6 \cdot (\text{circle_fit_iou_pct}_i)^2) \\
&amp; + (\beta_7 \cdot \text{chm_res_m}_i) + (\beta_8 \cdot (\text{chm_res_m}_i)^2) \\
&amp; + \sum_{j=0}^{5} \left( \beta_{9, j} \cdot \mathbf{I}(\text{spectral_weight}_i = j) \right) \\
&amp; + (\beta_{10} \cdot \text{convexity_pct}_i \cdot \text{circle_fit_iou_pct}_i) \\
&amp; + (\beta_{11} \cdot \text{convexity_pct}_i \cdot \text{chm_res_m}_i) \\
&amp; + (\beta_{12} \cdot \text{circle_fit_iou_pct}_i \cdot \text{chm_res_m}_i) \\
&amp; + \sum_{j=0}^{5} \left( \beta_{13, j} \cdot \text{chm_res_m}_i \cdot \mathbf{I}(\text{spectral_weight}_i = j) \right) \\
&amp; + (\beta_{14} \cdot \text{convexity_pct}_i \cdot \text{circle_fit_iou_pct}_i \cdot \text{chm_res_m}_i) \\
\beta_k \sim &amp; \operatorname{Student-t}(3, 0, 10) \quad \text{for } k = 1, \dots, 14 \\
\text{shape} \sim &amp; \operatorname{Gamma}(0.01, 0.01)
\end{align*}\]</span></p>
<p>where, <span class="math inline">\(i\)</span> represents a single observation in the dataset which corresponds to a specific combination of the six parameters (, <code>max_ht_m</code>, <code>max_area_m2</code>, <code>convexity_pct</code>, <code>circle_fit_iou_pct</code>, <code>chm_res_m</code>, and <code>spectral_weight</code>) and its resulting MAPE. Where <code>k</code> is used to index the different beta coefficients, which correspond to the intercept and the effects of each of the independent variables and their interactions and <code>j</code> denotes the specific level of the nominal (i.e. categorical) predictor <code>spectral_weight</code></p>
<p>we reviewed the main effect parameter trends against MAPE <a href="chm_sens_test.html#mape_trends">here</a> and used these to guide our model design</p>
<p>The table below details the terms used in our Bayesian GLM model defined in the <code>brms::brm()</code> call:</p>
<table>
<colgroup>
<col width="33%" />
<col width="33%" />
<col width="33%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Term in Formula</th>
<th align="left">Type of Effect</th>
<th align="left">Description of Relationship Tested</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><strong><code>0 +</code></strong></td>
<td align="left">Zero Intercept</td>
<td align="left">Specifies that the model is fit without a global intercept. The effect of each factor level and the value of continuous variables at zero is estimated directly.</td>
</tr>
<tr class="even">
<td align="left"><strong><code>max_ht_m</code></strong></td>
<td align="left">Main Effect (Linear)</td>
<td align="left">Tests the direct linear influence of the maximum pile height threshold on MAPE.</td>
</tr>
<tr class="odd">
<td align="left"><strong><code>max_area_m2</code></strong></td>
<td align="left">Main Effect (Linear)</td>
<td align="left">Tests the direct linear influence of the maximum pile area threshold on MAPE.</td>
</tr>
<tr class="even">
<td align="left"><strong><code>chm_res_m</code></strong></td>
<td align="left">Main Effect (Linear)</td>
<td align="left">Tests the direct linear influence of the input CHM resolution on MAPE.</td>
</tr>
<tr class="odd">
<td align="left"><strong><code>I(chm_res_m^2)</code></strong></td>
<td align="left">Nonlinear (Quadratic)</td>
<td align="left">Models a curved relationship with CHM resolution, allowing MAPE to potentially decrease then increase (or vice versa) as resolution changes.</td>
</tr>
<tr class="even">
<td align="left"><strong><code>spectral_weight</code></strong></td>
<td align="left">Main Effect (Factor)</td>
<td align="left">The model estimates a coefficient for each of the six spectral weight levels (0 through 5), representing the estimated mean MAPE for that specific level when all continuous variables are zero.</td>
</tr>
<tr class="odd">
<td align="left"><strong><code>circle_fit_iou_pct</code></strong></td>
<td align="left">Main Effect (Linear)</td>
<td align="left">Tests the direct linear influence of the pile’s circular conformity threshold on MAPE.</td>
</tr>
<tr class="even">
<td align="left"><strong><code>convexity_pct</code></strong></td>
<td align="left">Main Effect (Linear)</td>
<td align="left">Tests the direct linear influence of the pile’s boundary smoothness (convexity) threshold on MAPE.</td>
</tr>
<tr class="odd">
<td align="left"><strong><code>I(circle_fit_iou_pct^2)</code></strong></td>
<td align="left">Nonlinear (Quadratic)</td>
<td align="left">Models a curved relationship where MAPE may peak or bottom out at an intermediate threshold for pile circularity.</td>
</tr>
<tr class="even">
<td align="left"><strong><code>I(convexity_pct^2)</code></strong></td>
<td align="left">Nonlinear (Quadratic)</td>
<td align="left">Models a curved relationship where MAPE may peak or bottom out at an intermediate threshold for pile boundary smoothness.</td>
</tr>
<tr class="odd">
<td align="left"><strong><code>convexity_pct:circle_fit_iou_pct</code></strong></td>
<td align="left">Two-Way Interaction</td>
<td align="left">Captures how the optimal balance between pile circular conformity and boundary smoothness changes for MAPE.</td>
</tr>
<tr class="even">
<td align="left"><strong><code>chm_res_m:spectral_weight</code></strong></td>
<td align="left">Two-Way Interaction (Factor)</td>
<td align="left">Captures how the effect of CHM resolution’s slope on MAPE changes across each of the six spectral weighting levels.</td>
</tr>
<tr class="odd">
<td align="left"><strong><code>convexity_pct:chm_res_m</code></strong></td>
<td align="left">Two-Way Interaction</td>
<td align="left">Captures how the sensitivity to the pile boundary smoothness threshold changes with the input data resolution.</td>
</tr>
<tr class="even">
<td align="left"><strong><code>circle_fit_iou_pct:chm_res_m</code></strong></td>
<td align="left">Two-Way Interaction</td>
<td align="left">Captures how the importance of the pile’s circular conformity threshold changes as the input data resolution changes.</td>
</tr>
<tr class="odd">
<td align="left"><strong><code>convexity_pct:circle_fit_iou_pct:chm_res_m</code></strong></td>
<td align="left">Three-Way Interaction</td>
<td align="left">Shows how the combined effects of the convexity and circularity thresholds change simultaneously across different input CHM resolutions.</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb350"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb350-1"><a href="stats_method.html#cb350-1" tabindex="-1"></a>brms_diam_mape_mod <span class="ot">&lt;-</span> brms<span class="sc">::</span><span class="fu">brm</span>(</span>
<span id="cb350-2"><a href="stats_method.html#cb350-2" tabindex="-1"></a>  <span class="at">formula =</span> pct_diff_diameter_m_mape <span class="sc">~</span></span>
<span id="cb350-3"><a href="stats_method.html#cb350-3" tabindex="-1"></a>    <span class="dv">0</span> <span class="sc">+</span> <span class="co"># no intercept to allow all values of spectral_weight to be shown instead of set as the baseline </span></span>
<span id="cb350-4"><a href="stats_method.html#cb350-4" tabindex="-1"></a>    max_ht_m <span class="sc">+</span> max_area_m2 <span class="sc">+</span> </span>
<span id="cb350-5"><a href="stats_method.html#cb350-5" tabindex="-1"></a>    convexity_pct <span class="sc">+</span> <span class="fu">I</span>(convexity_pct<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> <span class="co"># changed from base model</span></span>
<span id="cb350-6"><a href="stats_method.html#cb350-6" tabindex="-1"></a>    circle_fit_iou_pct <span class="sc">+</span> <span class="fu">I</span>(circle_fit_iou_pct<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> <span class="co"># changed from base model</span></span>
<span id="cb350-7"><a href="stats_method.html#cb350-7" tabindex="-1"></a>    convexity_pct<span class="sc">:</span>circle_fit_iou_pct <span class="sc">+</span> <span class="co"># changed from base model</span></span>
<span id="cb350-8"><a href="stats_method.html#cb350-8" tabindex="-1"></a>    convexity_pct<span class="sc">:</span>chm_res_m <span class="sc">+</span> <span class="co"># changed from base model</span></span>
<span id="cb350-9"><a href="stats_method.html#cb350-9" tabindex="-1"></a>    circle_fit_iou_pct<span class="sc">:</span>chm_res_m <span class="sc">+</span> <span class="co"># changed from base model</span></span>
<span id="cb350-10"><a href="stats_method.html#cb350-10" tabindex="-1"></a>    convexity_pct<span class="sc">:</span>circle_fit_iou_pct<span class="sc">:</span>chm_res_m <span class="sc">+</span> <span class="co"># changed from base model</span></span>
<span id="cb350-11"><a href="stats_method.html#cb350-11" tabindex="-1"></a>    chm_res_m <span class="sc">+</span> <span class="fu">I</span>(chm_res_m<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> <span class="co"># changed from base model</span></span>
<span id="cb350-12"><a href="stats_method.html#cb350-12" tabindex="-1"></a>    spectral_weight <span class="sc">+</span> chm_res_m<span class="sc">:</span>spectral_weight</span>
<span id="cb350-13"><a href="stats_method.html#cb350-13" tabindex="-1"></a>  , <span class="at">data =</span> param_combos_spectral_ranked <span class="co"># %&gt;% dplyr::slice_sample(prop = 0.33)</span></span>
<span id="cb350-14"><a href="stats_method.html#cb350-14" tabindex="-1"></a>  , <span class="at">family =</span> <span class="fu">Gamma</span>(<span class="at">link =</span> <span class="st">&quot;log&quot;</span>)</span>
<span id="cb350-15"><a href="stats_method.html#cb350-15" tabindex="-1"></a>  <span class="co"># mcmc</span></span>
<span id="cb350-16"><a href="stats_method.html#cb350-16" tabindex="-1"></a>  , <span class="at">iter =</span> <span class="dv">14000</span>, <span class="at">warmup =</span> <span class="dv">7000</span></span>
<span id="cb350-17"><a href="stats_method.html#cb350-17" tabindex="-1"></a>  , <span class="at">chains =</span> <span class="dv">4</span></span>
<span id="cb350-18"><a href="stats_method.html#cb350-18" tabindex="-1"></a>  <span class="co"># , control = list(adapt_delta = 0.999, max_treedepth = 13)</span></span>
<span id="cb350-19"><a href="stats_method.html#cb350-19" tabindex="-1"></a>  , <span class="at">cores =</span> lasR<span class="sc">::</span><span class="fu">half_cores</span>()</span>
<span id="cb350-20"><a href="stats_method.html#cb350-20" tabindex="-1"></a>  , <span class="at">file =</span> <span class="fu">paste0</span>(<span class="st">&quot;../data/&quot;</span>, <span class="st">&quot;brms_diam_mape_mod&quot;</span>)</span>
<span id="cb350-21"><a href="stats_method.html#cb350-21" tabindex="-1"></a>)</span>
<span id="cb350-22"><a href="stats_method.html#cb350-22" tabindex="-1"></a><span class="co"># brms::make_stancode(brms_diam_mape_mod)</span></span>
<span id="cb350-23"><a href="stats_method.html#cb350-23" tabindex="-1"></a><span class="co"># brms::prior_summary(brms_diam_mape_mod)</span></span>
<span id="cb350-24"><a href="stats_method.html#cb350-24" tabindex="-1"></a><span class="co"># print(brms_diam_mape_mod)</span></span>
<span id="cb350-25"><a href="stats_method.html#cb350-25" tabindex="-1"></a><span class="co"># brms::neff_ratio(brms_diam_mape_mod)</span></span>
<span id="cb350-26"><a href="stats_method.html#cb350-26" tabindex="-1"></a><span class="co"># brms::rhat(brms_diam_mape_mod)</span></span>
<span id="cb350-27"><a href="stats_method.html#cb350-27" tabindex="-1"></a><span class="co"># brms::nuts_params(brms_diam_mape_mod)</span></span></code></pre></div>
<p>The <code>brms::brm</code> model summary</p>
<div class="sourceCode" id="cb351"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb351-1"><a href="stats_method.html#cb351-1" tabindex="-1"></a>brms_diam_mape_mod <span class="sc">%&gt;%</span> </span>
<span id="cb351-2"><a href="stats_method.html#cb351-2" tabindex="-1"></a>  brms<span class="sc">::</span><span class="fu">posterior_summary</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb351-3"><a href="stats_method.html#cb351-3" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb351-4"><a href="stats_method.html#cb351-4" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">&quot;parameter&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb351-5"><a href="stats_method.html#cb351-5" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename_with</span>(tolower) <span class="sc">%&gt;%</span> </span>
<span id="cb351-6"><a href="stats_method.html#cb351-6" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(</span>
<span id="cb351-7"><a href="stats_method.html#cb351-7" tabindex="-1"></a>    stringr<span class="sc">::</span><span class="fu">str_starts</span>(parameter, <span class="st">&quot;b_&quot;</span>) </span>
<span id="cb351-8"><a href="stats_method.html#cb351-8" tabindex="-1"></a>    <span class="sc">|</span> parameter <span class="sc">==</span> <span class="st">&quot;phi&quot;</span></span>
<span id="cb351-9"><a href="stats_method.html#cb351-9" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb351-10"><a href="stats_method.html#cb351-10" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kbl</span>(<span class="at">digits =</span> <span class="dv">3</span>, <span class="at">caption =</span> <span class="st">&quot;Bayesian model for Diameter MAPE&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb351-11"><a href="stats_method.html#cb351-11" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kable_styling</span>()</span></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-334">Table 9.9: </span>Bayesian model for Diameter MAPE
</caption>
<thead>
<tr>
<th style="text-align:left;">
parameter
</th>
<th style="text-align:right;">
estimate
</th>
<th style="text-align:right;">
est.error
</th>
<th style="text-align:right;">
q2.5
</th>
<th style="text-align:right;">
q97.5
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
b_max_ht_m
</td>
<td style="text-align:right;">
0.008
</td>
<td style="text-align:right;">
0.001
</td>
<td style="text-align:right;">
0.005
</td>
<td style="text-align:right;">
0.010
</td>
</tr>
<tr>
<td style="text-align:left;">
b_max_area_m2
</td>
<td style="text-align:right;">
0.001
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
0.001
</td>
<td style="text-align:right;">
0.001
</td>
</tr>
<tr>
<td style="text-align:left;">
b_convexity_pct
</td>
<td style="text-align:right;">
0.182
</td>
<td style="text-align:right;">
0.027
</td>
<td style="text-align:right;">
0.130
</td>
<td style="text-align:right;">
0.234
</td>
</tr>
<tr>
<td style="text-align:left;">
b_Iconvexity_pctE2
</td>
<td style="text-align:right;">
-0.305
</td>
<td style="text-align:right;">
0.017
</td>
<td style="text-align:right;">
-0.339
</td>
<td style="text-align:right;">
-0.271
</td>
</tr>
<tr>
<td style="text-align:left;">
b_circle_fit_iou_pct
</td>
<td style="text-align:right;">
0.430
</td>
<td style="text-align:right;">
0.031
</td>
<td style="text-align:right;">
0.370
</td>
<td style="text-align:right;">
0.492
</td>
</tr>
<tr>
<td style="text-align:left;">
b_Icircle_fit_iou_pctE2
</td>
<td style="text-align:right;">
-0.481
</td>
<td style="text-align:right;">
0.023
</td>
<td style="text-align:right;">
-0.526
</td>
<td style="text-align:right;">
-0.436
</td>
</tr>
<tr>
<td style="text-align:left;">
b_chm_res_m
</td>
<td style="text-align:right;">
6.855
</td>
<td style="text-align:right;">
0.063
</td>
<td style="text-align:right;">
6.733
</td>
<td style="text-align:right;">
6.979
</td>
</tr>
<tr>
<td style="text-align:left;">
b_Ichm_res_mE2
</td>
<td style="text-align:right;">
-5.378
</td>
<td style="text-align:right;">
0.080
</td>
<td style="text-align:right;">
-5.534
</td>
<td style="text-align:right;">
-5.221
</td>
</tr>
<tr>
<td style="text-align:left;">
b_spectral_weight0
</td>
<td style="text-align:right;">
-2.967
</td>
<td style="text-align:right;">
0.016
</td>
<td style="text-align:right;">
-2.999
</td>
<td style="text-align:right;">
-2.936
</td>
</tr>
<tr>
<td style="text-align:left;">
b_spectral_weight1
</td>
<td style="text-align:right;">
-2.967
</td>
<td style="text-align:right;">
0.016
</td>
<td style="text-align:right;">
-2.998
</td>
<td style="text-align:right;">
-2.936
</td>
</tr>
<tr>
<td style="text-align:left;">
b_spectral_weight2
</td>
<td style="text-align:right;">
-2.967
</td>
<td style="text-align:right;">
0.016
</td>
<td style="text-align:right;">
-2.999
</td>
<td style="text-align:right;">
-2.936
</td>
</tr>
<tr>
<td style="text-align:left;">
b_spectral_weight3
</td>
<td style="text-align:right;">
-2.967
</td>
<td style="text-align:right;">
0.016
</td>
<td style="text-align:right;">
-2.999
</td>
<td style="text-align:right;">
-2.936
</td>
</tr>
<tr>
<td style="text-align:left;">
b_spectral_weight4
</td>
<td style="text-align:right;">
-2.967
</td>
<td style="text-align:right;">
0.016
</td>
<td style="text-align:right;">
-2.998
</td>
<td style="text-align:right;">
-2.936
</td>
</tr>
<tr>
<td style="text-align:left;">
b_spectral_weight5
</td>
<td style="text-align:right;">
-2.902
</td>
<td style="text-align:right;">
0.016
</td>
<td style="text-align:right;">
-2.933
</td>
<td style="text-align:right;">
-2.871
</td>
</tr>
<tr>
<td style="text-align:left;">
b_convexity_pct:circle_fit_iou_pct
</td>
<td style="text-align:right;">
-0.245
</td>
<td style="text-align:right;">
0.045
</td>
<td style="text-align:right;">
-0.334
</td>
<td style="text-align:right;">
-0.159
</td>
</tr>
<tr>
<td style="text-align:left;">
b_convexity_pct:chm_res_m
</td>
<td style="text-align:right;">
-0.135
</td>
<td style="text-align:right;">
0.064
</td>
<td style="text-align:right;">
-0.261
</td>
<td style="text-align:right;">
-0.011
</td>
</tr>
<tr>
<td style="text-align:left;">
b_circle_fit_iou_pct:chm_res_m
</td>
<td style="text-align:right;">
-0.924
</td>
<td style="text-align:right;">
0.072
</td>
<td style="text-align:right;">
-1.065
</td>
<td style="text-align:right;">
-0.783
</td>
</tr>
<tr>
<td style="text-align:left;">
b_chm_res_m:spectral_weight1
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
0.033
</td>
<td style="text-align:right;">
-0.064
</td>
<td style="text-align:right;">
0.065
</td>
</tr>
<tr>
<td style="text-align:left;">
b_chm_res_m:spectral_weight2
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
0.033
</td>
<td style="text-align:right;">
-0.064
</td>
<td style="text-align:right;">
0.064
</td>
</tr>
<tr>
<td style="text-align:left;">
b_chm_res_m:spectral_weight3
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
0.033
</td>
<td style="text-align:right;">
-0.064
</td>
<td style="text-align:right;">
0.064
</td>
</tr>
<tr>
<td style="text-align:left;">
b_chm_res_m:spectral_weight4
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
0.033
</td>
<td style="text-align:right;">
-0.064
</td>
<td style="text-align:right;">
0.065
</td>
</tr>
<tr>
<td style="text-align:left;">
b_chm_res_m:spectral_weight5
</td>
<td style="text-align:right;">
-0.114
</td>
<td style="text-align:right;">
0.033
</td>
<td style="text-align:right;">
-0.178
</td>
<td style="text-align:right;">
-0.049
</td>
</tr>
<tr>
<td style="text-align:left;">
b_convexity_pct:circle_fit_iou_pct:chm_res_m
</td>
<td style="text-align:right;">
1.372
</td>
<td style="text-align:right;">
0.131
</td>
<td style="text-align:right;">
1.117
</td>
<td style="text-align:right;">
1.631
</td>
</tr>
</tbody>
</table>
<p>note the quadratic coefficients ending in <code>E2</code>, Kruschke (2015) provides some insight on how to interpret:</p>
<blockquote>
<p>A quadratic has the form <span class="math inline">\(y = \beta_{0} + \beta_{1}x + \beta_{2}x^{2}\)</span>. When <span class="math inline">\(\beta_{2}\)</span> is zero, the form reduces to a line. Therefore, this extended model can produce any fit that the linear model can. When <span class="math inline">\(\beta_{2}\)</span> is positive, a plot of the curve is a parabola that opens upward. When <span class="math inline">\(\beta_{2}\)</span> is negative, the curve is a parabola that opens downward. We have no reason to think that the curvature in the family-income data is exactly a parabola, but the quadratic trend might describe the data much better than a line alone. (p. 496)</p>
</blockquote>
</div>
<div id="posterior-predictive-checks-1" class="section level3 hasAnchor" number="9.2.3">
<h3><span class="header-section-number">9.2.3</span> Posterior Predictive Checks<a href="stats_method.html#posterior-predictive-checks-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Markov chain Monte Carlo (MCMC) simulations were conducted using the brms package (Bürkner 2017) to estimate posterior predictive distributions of the parameters of interest. We ran 4 chains of 10,000 iterations with the first 5,000 discarded as burn-in. Trace-plots were utilized to visually assess model convergence.</p>
<p>check the trace plots for problems with convergence of the Markov chains</p>
<div class="sourceCode" id="cb352"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb352-1"><a href="stats_method.html#cb352-1" tabindex="-1"></a><span class="fu">plot</span>(brms_diam_mape_mod)</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-335-1.png" width="1008" /><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-335-2.png" width="1008" /><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-335-3.png" width="1008" /><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-335-4.png" width="1008" /><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-335-5.png" width="1008" /></p>
<p>Sufficient convergence was checked with <span class="math inline">\(\hat{R}\)</span> values near 1 (<a href="https://scholar.google.com/scholar?cluster=14209404114665352991&amp;hl=en&amp;as_sdt=0,6">Brooks &amp; Gelman, 1998</a>).</p>
<p>in the plot below, <span class="math inline">\(\hat{R}\)</span> values are colored using different shades (lighter is better). The chosen thresholds are somewhat arbitrary, but can be useful guidelines in practice (<a href="https://mc-stan.org/bayesplot/reference/MCMC-diagnostics.html">Gabry and Mahr 2025</a>):</p>
<ul>
<li>light: below 1.05 (good)</li>
<li>mid: between 1.05 and 1.1 (ok)</li>
<li>dark: above 1.1 (too high)</li>
</ul>
<p>check our <span class="math inline">\(\hat{R}\)</span> values</p>
<div class="sourceCode" id="cb353"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb353-1"><a href="stats_method.html#cb353-1" tabindex="-1"></a>brms<span class="sc">::</span><span class="fu">mcmc_plot</span>(brms_diam_mape_mod, <span class="at">type =</span> <span class="st">&quot;rhat_hist&quot;</span>) <span class="sc">+</span></span>
<span id="cb353-2"><a href="stats_method.html#cb353-2" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> scales<span class="sc">::</span><span class="fu">breaks_extended</span>(<span class="at">n =</span> <span class="dv">6</span>)) <span class="sc">+</span></span>
<span id="cb353-3"><a href="stats_method.html#cb353-3" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb353-4"><a href="stats_method.html#cb353-4" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb353-5"><a href="stats_method.html#cb353-5" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;top&quot;</span>, <span class="at">legend.direction =</span> <span class="st">&quot;horizontal&quot;</span></span>
<span id="cb353-6"><a href="stats_method.html#cb353-6" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-336-1.png" width="1008" /></p>
<p>The effective length of an MCMC chain is indicated by the effective sample size (ESS), which refers to the sample size of the MCMC chain <strong>not</strong> to the sample size of the data where acceptable values allow “for reasonably accurate and stable estimates of the limits of the 95% HDI…If accuracy of the HDI limits is not crucial for your application, then a smaller ESS may be sufficient” <a href="https://sites.google.com/site/doingbayesiandataanalysis/">(Kruschke 2015, p. 184)</a></p>
<p>Ratios of effective sample size (ESS) to total sample size with values are colored using different shades (lighter is better). A ratio close to “1” (no autocorrelation) is ideal, while a low ratio suggests the need for more samples or model re-parameterization. Efficiently mixing MCMC chains are important because they guarantee the resulting posterior samples accurately represent the true distribution of model parameters, which is necessary for reliable and precise estimation of parameter values and their associated uncertainties (credible intervals). The chosen thresholds are somewhat arbitrary, but can be useful guidelines in practice (<a href="https://mc-stan.org/bayesplot/reference/MCMC-diagnostics.html">Gabry and Mahr 2025</a>):</p>
<ul>
<li>light: between 0.5 and 1 (high)</li>
<li>mid: between 0.1 and 0.5 (good)</li>
<li>dark: below 0.1 (low)</li>
</ul>
<div class="sourceCode" id="cb354"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb354-1"><a href="stats_method.html#cb354-1" tabindex="-1"></a><span class="co"># and another effective sample size check</span></span>
<span id="cb354-2"><a href="stats_method.html#cb354-2" tabindex="-1"></a>brms<span class="sc">::</span><span class="fu">mcmc_plot</span>(brms_diam_mape_mod, <span class="at">type =</span> <span class="st">&quot;neff_hist&quot;</span>) <span class="sc">+</span></span>
<span id="cb354-3"><a href="stats_method.html#cb354-3" tabindex="-1"></a><span class="co"># brms::mcmc_plot(brms_diam_mape_mod, type = &quot;neff&quot;) +</span></span>
<span id="cb354-4"><a href="stats_method.html#cb354-4" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="cn">NA</span>), <span class="at">breaks =</span> scales<span class="sc">::</span><span class="fu">breaks_extended</span>(<span class="at">n =</span> <span class="dv">9</span>)) <span class="sc">+</span></span>
<span id="cb354-5"><a href="stats_method.html#cb354-5" tabindex="-1"></a>  <span class="co"># ggplot2::scale_color_discrete(drop = F) +</span></span>
<span id="cb354-6"><a href="stats_method.html#cb354-6" tabindex="-1"></a>  <span class="co"># ggplot2::scale_fill_discrete(drop = F) +</span></span>
<span id="cb354-7"><a href="stats_method.html#cb354-7" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb354-8"><a href="stats_method.html#cb354-8" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb354-9"><a href="stats_method.html#cb354-9" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;top&quot;</span>, <span class="at">legend.direction =</span> <span class="st">&quot;horizontal&quot;</span></span>
<span id="cb354-10"><a href="stats_method.html#cb354-10" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-337-1.png" width="1008" /></p>
<p>Posterior predictive checks were used to evaluate model goodness-of-fit by comparing data simulated from the model with the observed data used to estimate the model parameters (<a href="https://scholar.google.com/scholar?cluster=9228589188684720156&amp;hl=en&amp;as_sdt=0,6">Hobbs &amp; Hooten, 2015</a>). Calculating the proportion of MCMC iterations in which the test statistic (i.e., mean and sum of squares) from the simulated data and observed data are more extreme than one another provides the Bayesian p-value. Lack of fit is indicated by a value close to 0 or 1 while a value of 0.5 indicates perfect fit (<a href="https://scholar.google.com/scholar?cluster=9228589188684720156&amp;hl=en&amp;as_sdt=0,6">Hobbs &amp; Hooten, 2015</a>).</p>
<p>To learn more about this approach to posterior predictive checks, check out Gabry’s (2025) vignette, <a href="https://cran.r-project.org/web/packages/bayesplot/vignettes/graphical-ppcs.html">Graphical posterior predictive checks using the bayesplot package</a>.</p>
<p>posterior-predictive check to make sure the model does an okay job simulating data that resemble the sample data. our objective is to construct the model such that it faithfully represents the data.</p>
<div class="sourceCode" id="cb355"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb355-1"><a href="stats_method.html#cb355-1" tabindex="-1"></a><span class="co"># posterior predictive check</span></span>
<span id="cb355-2"><a href="stats_method.html#cb355-2" tabindex="-1"></a>brms<span class="sc">::</span><span class="fu">pp_check</span>(</span>
<span id="cb355-3"><a href="stats_method.html#cb355-3" tabindex="-1"></a>    brms_diam_mape_mod</span>
<span id="cb355-4"><a href="stats_method.html#cb355-4" tabindex="-1"></a>    , <span class="at">type =</span> <span class="st">&quot;dens_overlay&quot;</span></span>
<span id="cb355-5"><a href="stats_method.html#cb355-5" tabindex="-1"></a>    , <span class="at">ndraws =</span> <span class="dv">100</span></span>
<span id="cb355-6"><a href="stats_method.html#cb355-6" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb355-7"><a href="stats_method.html#cb355-7" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;posterior-predictive check (overlaid densities)&quot;</span>) <span class="sc">+</span></span>
<span id="cb355-8"><a href="stats_method.html#cb355-8" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb355-9"><a href="stats_method.html#cb355-9" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb355-10"><a href="stats_method.html#cb355-10" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb355-11"><a href="stats_method.html#cb355-11" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;top&quot;</span>, <span class="at">legend.direction =</span> <span class="st">&quot;horizontal&quot;</span></span>
<span id="cb355-12"><a href="stats_method.html#cb355-12" tabindex="-1"></a>    , <span class="at">legend.text =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>)</span>
<span id="cb355-13"><a href="stats_method.html#cb355-13" tabindex="-1"></a>    , <span class="at">plot.subtitle =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>)</span>
<span id="cb355-14"><a href="stats_method.html#cb355-14" tabindex="-1"></a>    , <span class="at">plot.title =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">9</span>)</span>
<span id="cb355-15"><a href="stats_method.html#cb355-15" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-338-1.png" width="1008" /></p>
<p>another way</p>
<div class="sourceCode" id="cb356"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb356-1"><a href="stats_method.html#cb356-1" tabindex="-1"></a>brms<span class="sc">::</span><span class="fu">pp_check</span>(brms_diam_mape_mod, <span class="at">type =</span> <span class="st">&quot;ecdf_overlay&quot;</span>, <span class="at">ndraws =</span> <span class="dv">100</span>) <span class="sc">+</span></span>
<span id="cb356-2"><a href="stats_method.html#cb356-2" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;posterior-predictive check (ECDF: empirical cumulative distribution function)&quot;</span>) <span class="sc">+</span> </span>
<span id="cb356-3"><a href="stats_method.html#cb356-3" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb356-4"><a href="stats_method.html#cb356-4" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb356-5"><a href="stats_method.html#cb356-5" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;top&quot;</span>, <span class="at">legend.direction =</span> <span class="st">&quot;horizontal&quot;</span></span>
<span id="cb356-6"><a href="stats_method.html#cb356-6" tabindex="-1"></a>    , <span class="at">legend.text =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>)</span>
<span id="cb356-7"><a href="stats_method.html#cb356-7" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-339-1.png" width="1008" /></p>
</div>
<div id="conditional-effects-1" class="section level3 hasAnchor" number="9.2.4">
<h3><span class="header-section-number">9.2.4</span> Conditional Effects<a href="stats_method.html#conditional-effects-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>first, lets look at densities of the posterior samples per parameter</p>
<div class="sourceCode" id="cb357"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb357-1"><a href="stats_method.html#cb357-1" tabindex="-1"></a>brms<span class="sc">::</span><span class="fu">mcmc_plot</span>(brms_diam_mape_mod, <span class="at">type =</span> <span class="st">&quot;dens&quot;</span>) <span class="sc">+</span></span>
<span id="cb357-2"><a href="stats_method.html#cb357-2" tabindex="-1"></a>  <span class="co"># ggplot2::theme_light() +</span></span>
<span id="cb357-3"><a href="stats_method.html#cb357-3" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb357-4"><a href="stats_method.html#cb357-4" tabindex="-1"></a>    <span class="at">strip.text =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="fl">7.5</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>)</span>
<span id="cb357-5"><a href="stats_method.html#cb357-5" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-341-1.png" width="1008" /></p>
<p>and we can look at the default coefficient plot that is commonly used in reporting coefficient “significance” in frequentist analysis</p>
<div class="sourceCode" id="cb358"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb358-1"><a href="stats_method.html#cb358-1" tabindex="-1"></a><span class="co"># easy way to get the default coeff plot</span></span>
<span id="cb358-2"><a href="stats_method.html#cb358-2" tabindex="-1"></a>brms<span class="sc">::</span><span class="fu">mcmc_plot</span>(brms_diam_mape_mod, <span class="at">variable =</span> <span class="st">&quot;</span><span class="sc">\\</span><span class="st">bb_&quot;</span>, <span class="at">regex =</span> T, <span class="at">type =</span> <span class="st">&quot;intervals&quot;</span>)</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-342-1.png" width="1008" /></p>
<p>Regarding interactions and polynomial models like the one we use, <a href="https://xcelab.net/rm/">McElreath (2015)</a> notes:</p>
<blockquote>
<p>parameters are the linear and square components of the curve, respectively. But that doesn’t make them transparent. You have to plot these model fits to understand what they are saying. (p. 112-113)</p>
</blockquote>
<p>all of the interactions and the quadradic trend of this model combine to make these coefficients by themselves uninterpretable as the coefficients are only meaningful in the context of the other terms in the interaction or by adding the quadratic component</p>
<p>we can do this by checking for the main effects of the individual variables on F-score (averages across all other effects)</p>
<div class="sourceCode" id="cb359"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb359-1"><a href="stats_method.html#cb359-1" tabindex="-1"></a>brms<span class="sc">::</span><span class="fu">conditional_effects</span>(brms_diam_mape_mod)</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-343-1.png" width="1008" /><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-343-2.png" width="1008" /><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-343-3.png" width="1008" /><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-343-4.png" width="1008" /><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-343-5.png" width="1008" /><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-343-6.png" width="1008" /><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-343-7.png" width="1008" /><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-343-8.png" width="1008" /><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-343-9.png" width="1008" /><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-343-10.png" width="1008" /></p>
</div>
<div id="posterior-predictive-expectation" class="section level3 hasAnchor" number="9.2.5">
<h3><span class="header-section-number">9.2.5</span> Posterior Predictive Expectation<a href="stats_method.html#posterior-predictive-expectation" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>we will test our hypotheses using the posterior distributions of the expected values (i.e., the posterior predictions of the mean) obtained via <code>tidybayes::add_epred_draws()</code>. our analysis will include two stages using parameter levels of the four structural parameters: <code>max_ht_m</code>, <code>max_area_m2</code>, <code>convexity_pct</code>, <code>circle_fit_iou_pct</code>. in practice, these values should be informed by the treatment prescription implemented on the ground.</p>
<p>In the first stage, we will fix the <code>max_ht_m</code> and <code>max_area_m2</code> parameters at levels expected based on the treatment and slash pile construction prescription implemented on the ground. We will then explore the influence of the two geometric shape filtering parameters (<code>circle_fit_iou_pct</code> and <code>convexity_pct</code>) over different levels of the <code>spectral_weight</code> parameter and CHM resolution data.</p>
<p>In the second stage, we will fix all four structural parameters (<code>max_ht_m</code>, <code>max_area_m2</code>, <code>convexity_pct</code>, <code>circle_fit_iou_pct</code>) to explore the influence of the input data, which includes the presence or absence of spectral data and its weighting (i.e. <code>spectral_weight</code>) as well as the CHM resolution (<code>chm_res_m</code>). As in the first stage, the <code>max_ht_m</code>, <code>max_area_m2</code> parameters will be fixed at expected levels based on the slash pile construction prescription while the <code>convexity_pct</code>, <code>circle_fit_iou_pct</code> are fixed at the optimal levels determined based on the Bayesian posterior predictive distribution of <a href="stats_method.html#f_score_epred">detection accuracy</a></p>
<p>as a reminder, here are those parameter levels</p>
<div class="sourceCode" id="cb360"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb360-1"><a href="stats_method.html#cb360-1" tabindex="-1"></a>structural_params_settings <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">glimpse</span>()</span></code></pre></div>
<pre><code>## Rows: 1
## Columns: 4
## $ circle_fit_iou_pct &lt;dbl&gt; 0.35
## $ convexity_pct      &lt;dbl&gt; 0.36
## $ max_ht_m           &lt;dbl&gt; 2.3
## $ max_area_m2        &lt;dbl&gt; 46</code></pre>
<p>now we’ll get the posterior predictive draws but over a range of <code>circle_fit_iou_pct</code> and <code>convexity_pct</code> including the best setting</p>
<div class="sourceCode" id="cb362"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb362-1"><a href="stats_method.html#cb362-1" tabindex="-1"></a>seq_temp <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fl">0.05</span>, <span class="at">to =</span> <span class="fl">1.0</span>, <span class="at">by =</span> <span class="fl">0.1</span>)</span>
<span id="cb362-2"><a href="stats_method.html#cb362-2" tabindex="-1"></a>seq2_temp <span class="ot">&lt;-</span> seq_temp[<span class="fu">seq</span>(<span class="dv">1</span>, <span class="fu">length</span>(seq_temp), <span class="at">by =</span> <span class="dv">2</span>)] <span class="co"># get every other element</span></span>
<span id="cb362-3"><a href="stats_method.html#cb362-3" tabindex="-1"></a><span class="co"># draws</span></span>
<span id="cb362-4"><a href="stats_method.html#cb362-4" tabindex="-1"></a>draws_temp <span class="ot">&lt;-</span> </span>
<span id="cb362-5"><a href="stats_method.html#cb362-5" tabindex="-1"></a>  <span class="co"># get the draws for levels of </span></span>
<span id="cb362-6"><a href="stats_method.html#cb362-6" tabindex="-1"></a>  <span class="co"># spectral_weight circle_fit_iou_pct convexity_pct</span></span>
<span id="cb362-7"><a href="stats_method.html#cb362-7" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">crossing</span>(</span>
<span id="cb362-8"><a href="stats_method.html#cb362-8" tabindex="-1"></a>    param_combos_spectral_ranked <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">distinct</span>(spectral_weight)</span>
<span id="cb362-9"><a href="stats_method.html#cb362-9" tabindex="-1"></a>    , <span class="at">circle_fit_iou_pct =</span> seq_temp <span class="sc">%&gt;%</span> <span class="fu">unique</span>()</span>
<span id="cb362-10"><a href="stats_method.html#cb362-10" tabindex="-1"></a>    , <span class="at">convexity_pct =</span> seq_temp <span class="sc">%&gt;%</span> <span class="fu">unique</span>()</span>
<span id="cb362-11"><a href="stats_method.html#cb362-11" tabindex="-1"></a>    , <span class="at">chm_res_m =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fl">0.1</span>, <span class="at">to =</span> <span class="fl">1.0</span>, <span class="at">by =</span> <span class="fl">0.1</span>)</span>
<span id="cb362-12"><a href="stats_method.html#cb362-12" tabindex="-1"></a>    , <span class="at">max_ht_m =</span> structural_params_settings<span class="sc">$</span>max_ht_m</span>
<span id="cb362-13"><a href="stats_method.html#cb362-13" tabindex="-1"></a>    , <span class="at">max_area_m2 =</span> structural_params_settings<span class="sc">$</span>max_area_m2</span>
<span id="cb362-14"><a href="stats_method.html#cb362-14" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb362-15"><a href="stats_method.html#cb362-15" tabindex="-1"></a>  <span class="co"># dplyr::glimpse()</span></span>
<span id="cb362-16"><a href="stats_method.html#cb362-16" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">add_epred_draws</span>(brms_diam_mape_mod, <span class="at">ndraws =</span> <span class="dv">1111</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb362-17"><a href="stats_method.html#cb362-17" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">value =</span> .epred) <span class="sc">%&gt;%</span> </span>
<span id="cb362-18"><a href="stats_method.html#cb362-18" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb362-19"><a href="stats_method.html#cb362-19" tabindex="-1"></a>    <span class="at">is_seq =</span> (convexity_pct <span class="sc">%in%</span> seq_temp) <span class="sc">&amp;</span> (circle_fit_iou_pct <span class="sc">%in%</span> seq_temp)</span>
<span id="cb362-20"><a href="stats_method.html#cb362-20" tabindex="-1"></a>  )</span>
<span id="cb362-21"><a href="stats_method.html#cb362-21" tabindex="-1"></a><span class="co"># # huh?</span></span>
<span id="cb362-22"><a href="stats_method.html#cb362-22" tabindex="-1"></a>draws_temp <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">glimpse</span>()</span></code></pre></div>
<pre><code>## Rows: 6,666,000
## Columns: 12
## Groups: spectral_weight, circle_fit_iou_pct, convexity_pct, chm_res_m, max_ht_m, max_area_m2, .row [6,000]
## $ spectral_weight    &lt;fct&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, …
## $ circle_fit_iou_pct &lt;dbl&gt; 0.05, 0.05, 0.05, 0.05, 0.05, 0.05, 0.05, 0.05, 0.0…
## $ convexity_pct      &lt;dbl&gt; 0.05, 0.05, 0.05, 0.05, 0.05, 0.05, 0.05, 0.05, 0.0…
## $ chm_res_m          &lt;dbl&gt; 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0…
## $ max_ht_m           &lt;dbl&gt; 2.3, 2.3, 2.3, 2.3, 2.3, 2.3, 2.3, 2.3, 2.3, 2.3, 2…
## $ max_area_m2        &lt;dbl&gt; 46, 46, 46, 46, 46, 46, 46, 46, 46, 46, 46, 46, 46,…
## $ .row               &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, …
## $ .chain             &lt;int&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
## $ .iteration         &lt;int&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
## $ .draw              &lt;int&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, …
## $ value              &lt;dbl&gt; 0.1045783, 0.1045749, 0.1026696, 0.1045097, 0.10403…
## $ is_seq             &lt;lgl&gt; TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRU…</code></pre>
<div id="geometric-shape-regularity-1" class="section level4 hasAnchor" number="9.2.5.1">
<h4><span class="header-section-number">9.2.5.1</span> Geometric shape regularity<a href="stats_method.html#geometric-shape-regularity-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>let’s look at the influence of the parameters that control the geometric shape regularity filtering: <code>circle_fit_iou_pct</code> and <code>convexity_pct</code>. to do this, we will fix the <code>max_ht_m</code> and <code>max_area_m2</code> parameters at levels expected based on the treatment and slash pile construction prescription implemented on the ground.</p>
<p>In the first stage, we will fix the <code>max_ht_m</code> and <code>max_area_m2</code> parameters at levels expected based on the treatment and slash pile construction prescription implemented on the ground. We will then explore the influence of the two geometric shape filtering parameters (<code>circle_fit_iou_pct</code> and <code>convexity_pct</code>) over different levels of the <code>spectral_weight</code> parameter and CHM resolution data.</p>
<p>In the second stage, we will fix all four structural parameters (<code>max_ht_m</code>, <code>max_area_m2</code>, <code>convexity_pct</code>, <code>circle_fit_iou_pct</code>) to explore the influence of the input data, which includes the presence or absence of spectral data and its weighting (i.e. <code>spectral_weight</code>) as well as the CHM resolution (<code>chm_res_m</code>). As in the first stage, the <code>max_ht_m</code>, <code>max_area_m2</code> parameters will be fixed at expected levels based on the slash pile construction prescription while the <code>convexity_pct</code>, <code>circle_fit_iou_pct</code> will be fixed at the optimal levels determined based on the Bayesian posterior predictive distribution of <a href="stats_method.html#f_score_epred">detection accuracy</a></p>
<div id="circle_fit_iou_pct-1" class="section level5 hasAnchor" number="9.2.5.1.1">
<h5><span class="header-section-number">9.2.5.1.1</span> <code>circle_fit_iou_pct</code><a href="stats_method.html#circle_fit_iou_pct-1" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>we need to look at the influence of <code>circle_fit_iou_pct</code> in the context of the other terms in the interaction</p>
<div class="sourceCode" id="cb364"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb364-1"><a href="stats_method.html#cb364-1" tabindex="-1"></a>draws_temp <span class="sc">%&gt;%</span></span>
<span id="cb364-2"><a href="stats_method.html#cb364-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb364-3"><a href="stats_method.html#cb364-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(</span>
<span id="cb364-4"><a href="stats_method.html#cb364-4" tabindex="-1"></a>    is_seq</span>
<span id="cb364-5"><a href="stats_method.html#cb364-5" tabindex="-1"></a>    , chm_res_m <span class="sc">%in%</span> <span class="fu">seq</span>(<span class="fl">0.1</span>,<span class="fl">0.5</span>,<span class="at">by=</span><span class="fl">0.2</span>)</span>
<span id="cb364-6"><a href="stats_method.html#cb364-6" tabindex="-1"></a>    , convexity_pct <span class="sc">%in%</span> seq2_temp</span>
<span id="cb364-7"><a href="stats_method.html#cb364-7" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb364-8"><a href="stats_method.html#cb364-8" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">convexity_pct =</span> <span class="fu">factor</span>(convexity_pct, <span class="at">ordered =</span> T)) <span class="sc">%&gt;%</span> </span>
<span id="cb364-9"><a href="stats_method.html#cb364-9" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> circle_fit_iou_pct, <span class="at">y =</span> value, <span class="at">color =</span> convexity_pct)) <span class="sc">+</span></span>
<span id="cb364-10"><a href="stats_method.html#cb364-10" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">stat_lineribbon</span>(</span>
<span id="cb364-11"><a href="stats_method.html#cb364-11" tabindex="-1"></a>    <span class="at">point_interval =</span> <span class="st">&quot;median_hdi&quot;</span>, <span class="at">.width =</span> <span class="fu">c</span>(<span class="fl">0.95</span>)</span>
<span id="cb364-12"><a href="stats_method.html#cb364-12" tabindex="-1"></a>    , <span class="at">lwd =</span> <span class="fl">1.1</span>, <span class="at">fill =</span> <span class="cn">NA</span></span>
<span id="cb364-13"><a href="stats_method.html#cb364-13" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb364-14"><a href="stats_method.html#cb364-14" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">facet_grid</span>(<span class="at">cols =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(spectral_weight), <span class="at">rows =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(chm_res_m), <span class="at">labeller =</span> <span class="st">&quot;label_both&quot;</span>, <span class="at">scales =</span> <span class="st">&quot;free_y&quot;</span>) <span class="sc">+</span></span>
<span id="cb364-15"><a href="stats_method.html#cb364-15" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_fill_brewer</span>(<span class="at">palette =</span> <span class="st">&quot;Greys&quot;</span>) <span class="sc">+</span></span>
<span id="cb364-16"><a href="stats_method.html#cb364-16" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_color_viridis_d</span>(<span class="at">option =</span> <span class="st">&quot;mako&quot;</span>, <span class="at">begin =</span> <span class="fl">0.6</span>, <span class="at">end =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb364-17"><a href="stats_method.html#cb364-17" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb364-18"><a href="stats_method.html#cb364-18" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>percent) <span class="sc">+</span></span>
<span id="cb364-19"><a href="stats_method.html#cb364-19" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb364-20"><a href="stats_method.html#cb364-20" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;conditional effect of `circle_fit_iou_pct` on Diameter MAPE&quot;</span></span>
<span id="cb364-21"><a href="stats_method.html#cb364-21" tabindex="-1"></a>    <span class="co"># , subtitle = &quot;Faceted by spectral_weight and chm_res_m&quot;</span></span>
<span id="cb364-22"><a href="stats_method.html#cb364-22" tabindex="-1"></a>    , <span class="at">x =</span> <span class="st">&quot;`circle_fit_iou_pct`&quot;</span></span>
<span id="cb364-23"><a href="stats_method.html#cb364-23" tabindex="-1"></a>    , <span class="at">y =</span> <span class="st">&quot;Diameter MAPE&quot;</span></span>
<span id="cb364-24"><a href="stats_method.html#cb364-24" tabindex="-1"></a>    , <span class="at">color =</span> <span class="st">&quot;`convexity_pct`&quot;</span></span>
<span id="cb364-25"><a href="stats_method.html#cb364-25" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb364-26"><a href="stats_method.html#cb364-26" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb364-27"><a href="stats_method.html#cb364-27" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb364-28"><a href="stats_method.html#cb364-28" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;top&quot;</span></span>
<span id="cb364-29"><a href="stats_method.html#cb364-29" tabindex="-1"></a>    , <span class="at">strip.text.x =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb364-30"><a href="stats_method.html#cb364-30" tabindex="-1"></a>    , <span class="at">strip.text.y =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb364-31"><a href="stats_method.html#cb364-31" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb364-32"><a href="stats_method.html#cb364-32" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">guides</span>(</span>
<span id="cb364-33"><a href="stats_method.html#cb364-33" tabindex="-1"></a>    <span class="at">color =</span> ggplot2<span class="sc">::</span><span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">shape =</span> <span class="dv">15</span>, <span class="at">lwd =</span> <span class="dv">8</span>, <span class="at">fill =</span> <span class="cn">NA</span>))</span>
<span id="cb364-34"><a href="stats_method.html#cb364-34" tabindex="-1"></a>    , <span class="at">fill =</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb364-35"><a href="stats_method.html#cb364-35" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-347-1.png" width="1008" /></p>
<p>For all of these faceted plots, take note of the narrow range of the y-axis (Predicted Diameter MAPE), which is particularly narrow for finer resolution CHM data (e.g., &lt;0.3m). The non-linear relationship between the <code>circle_fit_iou_pct</code> parameter and the Diameter MAPE is prominent, especially for coarser resolution CHM data. This is confirmed by the statistical model’s negative quadratic coefficient for the squared term of <code>circle_fit_iou_pct</code> (i.e., <code>I(circle_fit_iou_pct^2)</code>), which indicates a downward-opening parabolic shape. Across all CHM resolutions and irrespective of the <code>spectral_weight</code> setting, diameter quantification accuracy is highest (MAPE is lowest) at the highest values of the <code>circle_fit_iou_pct</code> parameter (e.g., greater than 0.6). This finding is intuitive: diameter error is calculated only for True Positive matches, and when a successful match is made between a prediction and a ground truth pile at these high circularity thresholds, it strongly suggests the predicted pile perimeter accurately conforms to the ground truth pile shape.</p>
<p>The influence of the <code>circle_fit_iou_pct</code> parameter on diameter accuracy is conditional on the <code>convexity_pct</code> parameter setting. The relationship between these parameters is most evident with coarser resolution CHM data (e.g., &gt;0.3m) and looking at cases when <code>convexity_pct</code> parameter is set low (e.g., less than 0.4) the best diameter quantification accuracy occurs when the <code>circle_fit_iou_pct</code> parameter is set high (e.g., greater than 0.5), and vice-versa. This effect occurs because both parameters function as geometric shape filters in the rules-based methodology. When the piles in the treatment area are generally uniform (e.g., mostly circular), the parameters become somewhat redundant. However, when pile shapes are heterogeneous, these two filtering parameters must be balanced to fine-tune the retention of objects. For instance, if piles are expected to be rectangular, the optimal setting would be to effectively disable the <code>circle_fit_iou_pct</code> filter (i.e., set it to ‘0’) and rely on the <code>convexity_pct</code> filter to retain objects with the expected perimeter regularity.</p>
<p>Finally, the <code>circle_fit_iou_pct</code> parameter has a smaller influence on diameter quantification accuracy with finer resolution CHM data (e.g., &lt;0.3m) and a larger influence on Diameter MAPE for coarser CHM data (e.g., &gt;0.3m). For the coarser CHM data, increasing values of the <code>circle_fit_iou_pct</code> parameter on the right side of the vertex increased diameter quantification accuracy (decreased MAPE) at an increasing rate as the parameter approached ‘1’.</p>
</div>
<div id="convexity_pct-1" class="section level5 hasAnchor" number="9.2.5.1.2">
<h5><span class="header-section-number">9.2.5.1.2</span> <code>convexity_pct</code><a href="stats_method.html#convexity_pct-1" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>we need to look at the influence of <code>convexity_pct</code> in the context of the other terms in the interaction</p>
<div class="sourceCode" id="cb365"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb365-1"><a href="stats_method.html#cb365-1" tabindex="-1"></a>draws_temp <span class="sc">%&gt;%</span></span>
<span id="cb365-2"><a href="stats_method.html#cb365-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb365-3"><a href="stats_method.html#cb365-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(</span>
<span id="cb365-4"><a href="stats_method.html#cb365-4" tabindex="-1"></a>    is_seq</span>
<span id="cb365-5"><a href="stats_method.html#cb365-5" tabindex="-1"></a>    , chm_res_m <span class="sc">%in%</span> <span class="fu">seq</span>(<span class="fl">0.1</span>,<span class="fl">0.5</span>,<span class="at">by=</span><span class="fl">0.2</span>)</span>
<span id="cb365-6"><a href="stats_method.html#cb365-6" tabindex="-1"></a>    , circle_fit_iou_pct <span class="sc">%in%</span> seq2_temp</span>
<span id="cb365-7"><a href="stats_method.html#cb365-7" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb365-8"><a href="stats_method.html#cb365-8" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">circle_fit_iou_pct =</span> <span class="fu">factor</span>(circle_fit_iou_pct, <span class="at">ordered =</span> T)) <span class="sc">%&gt;%</span> </span>
<span id="cb365-9"><a href="stats_method.html#cb365-9" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> convexity_pct, <span class="at">y =</span> value, <span class="at">color =</span> circle_fit_iou_pct)) <span class="sc">+</span></span>
<span id="cb365-10"><a href="stats_method.html#cb365-10" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">stat_lineribbon</span>(</span>
<span id="cb365-11"><a href="stats_method.html#cb365-11" tabindex="-1"></a>    <span class="at">point_interval =</span> <span class="st">&quot;median_hdi&quot;</span>, <span class="at">.width =</span> <span class="fu">c</span>(<span class="fl">0.95</span>)</span>
<span id="cb365-12"><a href="stats_method.html#cb365-12" tabindex="-1"></a>    , <span class="at">lwd =</span> <span class="fl">1.1</span></span>
<span id="cb365-13"><a href="stats_method.html#cb365-13" tabindex="-1"></a>    , <span class="at">fill =</span> <span class="cn">NA</span></span>
<span id="cb365-14"><a href="stats_method.html#cb365-14" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb365-15"><a href="stats_method.html#cb365-15" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">facet_grid</span>(<span class="at">cols =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(spectral_weight), <span class="at">rows =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(chm_res_m), <span class="at">labeller =</span> <span class="st">&quot;label_both&quot;</span>, <span class="at">scales =</span> <span class="st">&quot;free_y&quot;</span>) <span class="sc">+</span></span>
<span id="cb365-16"><a href="stats_method.html#cb365-16" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_fill_brewer</span>(<span class="at">palette =</span> <span class="st">&quot;Greys&quot;</span>) <span class="sc">+</span></span>
<span id="cb365-17"><a href="stats_method.html#cb365-17" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_color_viridis_d</span>(<span class="at">option =</span> <span class="st">&quot;magma&quot;</span>, <span class="at">begin =</span> <span class="fl">0.5</span>, <span class="at">end =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb365-18"><a href="stats_method.html#cb365-18" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb365-19"><a href="stats_method.html#cb365-19" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>percent) <span class="sc">+</span></span>
<span id="cb365-20"><a href="stats_method.html#cb365-20" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb365-21"><a href="stats_method.html#cb365-21" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;conditional effect of `convexity_pct` on Diameter MAPE&quot;</span></span>
<span id="cb365-22"><a href="stats_method.html#cb365-22" tabindex="-1"></a>    <span class="co"># , subtitle = &quot;Faceted by spectral_weight and chm_res_m&quot;</span></span>
<span id="cb365-23"><a href="stats_method.html#cb365-23" tabindex="-1"></a>    , <span class="at">x =</span> <span class="st">&quot;`convexity_pct`&quot;</span></span>
<span id="cb365-24"><a href="stats_method.html#cb365-24" tabindex="-1"></a>    , <span class="at">y =</span> <span class="st">&quot;Diameter MAPE&quot;</span></span>
<span id="cb365-25"><a href="stats_method.html#cb365-25" tabindex="-1"></a>    , <span class="at">color =</span> <span class="st">&quot;`circle_fit_iou_pct`&quot;</span></span>
<span id="cb365-26"><a href="stats_method.html#cb365-26" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb365-27"><a href="stats_method.html#cb365-27" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb365-28"><a href="stats_method.html#cb365-28" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb365-29"><a href="stats_method.html#cb365-29" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;top&quot;</span></span>
<span id="cb365-30"><a href="stats_method.html#cb365-30" tabindex="-1"></a>    , <span class="at">strip.text.x =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb365-31"><a href="stats_method.html#cb365-31" tabindex="-1"></a>    , <span class="at">strip.text.y =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb365-32"><a href="stats_method.html#cb365-32" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb365-33"><a href="stats_method.html#cb365-33" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">guides</span>(</span>
<span id="cb365-34"><a href="stats_method.html#cb365-34" tabindex="-1"></a>    <span class="at">color =</span> ggplot2<span class="sc">::</span><span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">shape =</span> <span class="dv">15</span>, <span class="at">lwd =</span> <span class="dv">8</span>, <span class="at">fill =</span> <span class="cn">NA</span>))</span>
<span id="cb365-35"><a href="stats_method.html#cb365-35" tabindex="-1"></a>    , <span class="at">fill =</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb365-36"><a href="stats_method.html#cb365-36" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-348-1.png" width="1008" /></p>
<p>The model shows that the influence of the <code>convexity_pct</code> parameter on the Diameter MAPE is conditional on the CHM resolution. The magnitude of this influence varies significantly: for finer resolution CHM data (e.g., less than 0.3m), the <code>convexity_pct</code> parameter has a minimal impact on the Diameter MAPE, as evidenced by the narrow range of the y-axis; conversely, its influence is considerably larger at coarser resolutions. Across all CHM resolutions tested, it is clear that the influence of the <code>circle_fit_iou_pct</code> parameter on diameter accuracy is conditional on the <code>convexity_pct</code> parameter setting. This relationship is most pronounced with coarser resolution CHM data (e.g., greater than 0.3m). For example, using 0.5m CHM data, the vertex of the downward-opening parabola (which indicates the largest diameter quantification error) shifts across the <code>convexity_pct</code> range: it is located at lower <code>convexity_pct</code> values (i.e., less than 0.5) when the <code>circle_fit_iou_pct</code> parameter is set low (e.g., less than 0.4), but shifts to higher <code>convexity_pct</code> values (i.e., greater than 0.6) when the <code>circle_fit_iou_pct</code> parameter is set high (e.g., greater than 0.6). This inverse relationship occurs because both parameters function as geometric shape filters in the rules-based methodology. For the test data, where piles generally exhibit regular, circular footprints, the two filters become somewhat redundant. Therefore, the lowest Diameter MAPE (highest accuracy) is achieved when the parameters are complementary: when <code>circle_fit_iou_pct</code> is high (near 1) and <code>convexity_pct</code> is low (near 0), or vice-versa. Additionally, if <code>circle_fit_iou_pct</code> is at an intermediate level (near 0.5), <code>convexity_pct</code> should be set either high or low to maintain diameter quantification accuracy. It is important to note though, that these relationships are specific to regularly shaped circular pile footprints; if pile bases are expected to be square or rectangular, the parameters should be rebalanced. For instance, in a scenario predicting rectangular piles, the optimal setting would be to effectively disable the <code>circle_fit_iou_pct</code> filter (set to ‘0’) and instead rely on the <code>convexity_pct</code> filter to enforce the expected shape regularity filtering.</p>
</div>
<div id="optimizing-geometric-filtering-1" class="section level5 hasAnchor" number="9.2.5.1.3">
<h5><span class="header-section-number">9.2.5.1.3</span> Optimizing geometric filtering<a href="stats_method.html#optimizing-geometric-filtering-1" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>Given the complexity of our model, which includes a non-linear link function and parameter interactions, calculating the optimal parameter values by solving for them algebraically from the model’s coefficients would be prone to error. instead, we can use a robust Bayesian approach that leverages the model’s posterior predictive distribution. This method is powerful because it inherently accounts for all sources of model uncertainty.</p>
<p>first, we’ll generate a large number of predictions across a fine grid of parameter values (e.g. in steps of 0.01) for each posterior draw of the model coefficients. we’ll generate a large number (e.g. 1000+) of posterior predictive draws for each combination of parameter values. for each posterior predictive draw, we’ll then identify the parameter combination that maximizes the Diameter MAPE and we’ll be left with a posterior distribution of optimal parameter combinations.</p>
<p>this approach demonstrates a key advantage of the Bayesian framework, allowing us to ask complex questions and find the most probable optimal parameter combination while fully accounting for uncertainty.</p>
<p>note, we only extract draws based on not using any spectral data (i.e. <code>spectral_weight</code> = 0) to save on plotting space and because we expect form quantification to only be minimally influenced by the inclusion of spectral data</p>
<div class="sourceCode" id="cb366"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb366-1"><a href="stats_method.html#cb366-1" tabindex="-1"></a><span class="co"># let&#39;s get the draws at a very granular level</span></span>
<span id="cb366-2"><a href="stats_method.html#cb366-2" tabindex="-1"></a>vertex_draws_temp <span class="ot">&lt;-</span> </span>
<span id="cb366-3"><a href="stats_method.html#cb366-3" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">crossing</span>(</span>
<span id="cb366-4"><a href="stats_method.html#cb366-4" tabindex="-1"></a>    param_combos_spectral_ranked <span class="sc">%&gt;%</span> </span>
<span id="cb366-5"><a href="stats_method.html#cb366-5" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">filter</span>(spectral_weight<span class="sc">==</span><span class="st">&quot;0&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb366-6"><a href="stats_method.html#cb366-6" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">distinct</span>(spectral_weight, spectral_weight_fact)</span>
<span id="cb366-7"><a href="stats_method.html#cb366-7" tabindex="-1"></a>    , <span class="at">circle_fit_iou_pct =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fl">0.0</span>, <span class="at">to =</span> <span class="dv">1</span>, <span class="at">by =</span> <span class="fl">0.01</span>) <span class="co"># very granular to identify vertex</span></span>
<span id="cb366-8"><a href="stats_method.html#cb366-8" tabindex="-1"></a>    , <span class="at">convexity_pct =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fl">0.0</span>, <span class="at">to =</span> <span class="dv">1</span>, <span class="at">by =</span> <span class="fl">0.02</span>) <span class="co"># very granular to identify vertex</span></span>
<span id="cb366-9"><a href="stats_method.html#cb366-9" tabindex="-1"></a>    , <span class="at">chm_res_m =</span> <span class="fu">seq</span>(<span class="fl">0.1</span>,<span class="fl">0.5</span>,<span class="at">by=</span><span class="fl">0.1</span>)</span>
<span id="cb366-10"><a href="stats_method.html#cb366-10" tabindex="-1"></a>    , <span class="at">max_ht_m =</span> structural_params_settings<span class="sc">$</span>max_ht_m</span>
<span id="cb366-11"><a href="stats_method.html#cb366-11" tabindex="-1"></a>    , <span class="at">max_area_m2 =</span> structural_params_settings<span class="sc">$</span>max_area_m2</span>
<span id="cb366-12"><a href="stats_method.html#cb366-12" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb366-13"><a href="stats_method.html#cb366-13" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">add_epred_draws</span>(brms_diam_mape_mod, <span class="at">ndraws =</span> <span class="dv">1000</span>, <span class="at">value =</span> <span class="st">&quot;value&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb366-14"><a href="stats_method.html#cb366-14" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb366-15"><a href="stats_method.html#cb366-15" tabindex="-1"></a>  <span class="co"># for each draw, get the highest Diameter MAPE by chm_res_m, spectral_weight</span></span>
<span id="cb366-16"><a href="stats_method.html#cb366-16" tabindex="-1"></a>  <span class="co"># which we&#39;ll use to identify the optimal circle_fit_iou_pct,convexity_pct settings</span></span>
<span id="cb366-17"><a href="stats_method.html#cb366-17" tabindex="-1"></a>  <span class="co"># these are essentially &quot;votes&quot; based on likelihood</span></span>
<span id="cb366-18"><a href="stats_method.html#cb366-18" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(</span>
<span id="cb366-19"><a href="stats_method.html#cb366-19" tabindex="-1"></a>    .draw</span>
<span id="cb366-20"><a href="stats_method.html#cb366-20" tabindex="-1"></a>    , chm_res_m, spectral_weight</span>
<span id="cb366-21"><a href="stats_method.html#cb366-21" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb366-22"><a href="stats_method.html#cb366-22" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(value,circle_fit_iou_pct,convexity_pct) <span class="sc">%&gt;%</span> <span class="co"># notice the ascending sort of value (mape) here to take the lowest </span></span>
<span id="cb366-23"><a href="stats_method.html#cb366-23" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">slice</span>(<span class="dv">1</span>)</span>
<span id="cb366-24"><a href="stats_method.html#cb366-24" tabindex="-1"></a><span class="co"># vertex_draws_temp %&gt;% dplyr::glimpse() # this thing is huge</span></span></code></pre></div>
<p>plot the posterior distribution of optimal parameter setting for <code>circle_fit_iou_pct</code></p>
<div class="sourceCode" id="cb367"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb367-1"><a href="stats_method.html#cb367-1" tabindex="-1"></a>vertex_draws_temp <span class="sc">%&gt;%</span></span>
<span id="cb367-2"><a href="stats_method.html#cb367-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(</span>
<span id="cb367-3"><a href="stats_method.html#cb367-3" tabindex="-1"></a>    chm_res_m <span class="sc">%in%</span> <span class="fu">seq</span>(<span class="fl">0.1</span>,<span class="fl">0.5</span>,<span class="at">by=</span><span class="fl">0.1</span>)</span>
<span id="cb367-4"><a href="stats_method.html#cb367-4" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb367-5"><a href="stats_method.html#cb367-5" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb367-6"><a href="stats_method.html#cb367-6" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> circle_fit_iou_pct)) <span class="sc">+</span></span>
<span id="cb367-7"><a href="stats_method.html#cb367-7" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">stat_dotsinterval</span>(</span>
<span id="cb367-8"><a href="stats_method.html#cb367-8" tabindex="-1"></a>    <span class="at">point_interval =</span> <span class="st">&quot;median_hdci&quot;</span>, <span class="at">.width =</span> <span class="fu">c</span>(<span class="fl">0.95</span>)</span>
<span id="cb367-9"><a href="stats_method.html#cb367-9" tabindex="-1"></a>    , <span class="at">quantiles =</span> <span class="dv">100</span></span>
<span id="cb367-10"><a href="stats_method.html#cb367-10" tabindex="-1"></a>    , <span class="at">point_size =</span> <span class="dv">3</span> </span>
<span id="cb367-11"><a href="stats_method.html#cb367-11" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb367-12"><a href="stats_method.html#cb367-12" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">facet_grid</span>(</span>
<span id="cb367-13"><a href="stats_method.html#cb367-13" tabindex="-1"></a>    <span class="at">cols =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(spectral_weight)</span>
<span id="cb367-14"><a href="stats_method.html#cb367-14" tabindex="-1"></a>    , <span class="at">rows =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(chm_res_m)</span>
<span id="cb367-15"><a href="stats_method.html#cb367-15" tabindex="-1"></a>    , <span class="at">scales =</span> <span class="st">&quot;free_y&quot;</span></span>
<span id="cb367-16"><a href="stats_method.html#cb367-16" tabindex="-1"></a>    , <span class="at">labeller =</span> <span class="st">&quot;label_both&quot;</span></span>
<span id="cb367-17"><a href="stats_method.html#cb367-17" tabindex="-1"></a>    , <span class="at">axes =</span> <span class="st">&quot;all_x&quot;</span></span>
<span id="cb367-18"><a href="stats_method.html#cb367-18" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb367-19"><a href="stats_method.html#cb367-19" tabindex="-1"></a>  <span class="co"># ggplot2::scale_x_continuous(limits = c(0,1)) +</span></span>
<span id="cb367-20"><a href="stats_method.html#cb367-20" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">breaks =</span> scales<span class="sc">::</span><span class="fu">breaks_extended</span>(<span class="dv">6</span>)) <span class="sc">+</span></span>
<span id="cb367-21"><a href="stats_method.html#cb367-21" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb367-22"><a href="stats_method.html#cb367-22" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb367-23"><a href="stats_method.html#cb367-23" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb367-24"><a href="stats_method.html#cb367-24" tabindex="-1"></a>    <span class="at">strip.text.x =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb367-25"><a href="stats_method.html#cb367-25" tabindex="-1"></a>    , <span class="at">strip.text.y =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb367-26"><a href="stats_method.html#cb367-26" tabindex="-1"></a>    , <span class="at">axis.text.x =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>)</span>
<span id="cb367-27"><a href="stats_method.html#cb367-27" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-350-1.png" width="1008" /></p>
<p>The optimal <code>circle_fit_iou_pct</code> setting for maximizing diameter quantification accuracy is predicted to be near it’s highest setting of ‘1’. This finding is likely not very applicable in real-world scenarios but it is intuitive: diameter error is calculated only for True Positive matches, and when a successful match is made between a prediction and a ground truth pile at these high circularity thresholds, it strongly suggests the predicted pile perimeter accurately conforms to the ground truth pile shape.</p>
<p>plot the posterior distribution of optimal parameter setting for <code>convexity_pct</code></p>
<div class="sourceCode" id="cb368"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb368-1"><a href="stats_method.html#cb368-1" tabindex="-1"></a>vertex_draws_temp <span class="sc">%&gt;%</span> </span>
<span id="cb368-2"><a href="stats_method.html#cb368-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(</span>
<span id="cb368-3"><a href="stats_method.html#cb368-3" tabindex="-1"></a>    chm_res_m <span class="sc">%in%</span> <span class="fu">seq</span>(<span class="fl">0.1</span>,<span class="fl">0.5</span>,<span class="at">by=</span><span class="fl">0.1</span>)</span>
<span id="cb368-4"><a href="stats_method.html#cb368-4" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb368-5"><a href="stats_method.html#cb368-5" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb368-6"><a href="stats_method.html#cb368-6" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> convexity_pct)) <span class="sc">+</span></span>
<span id="cb368-7"><a href="stats_method.html#cb368-7" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">stat_dotsinterval</span>(</span>
<span id="cb368-8"><a href="stats_method.html#cb368-8" tabindex="-1"></a>    <span class="at">point_interval =</span> <span class="st">&quot;median_hdci&quot;</span>, <span class="at">.width =</span> <span class="fu">c</span>(<span class="fl">0.95</span>)</span>
<span id="cb368-9"><a href="stats_method.html#cb368-9" tabindex="-1"></a>    , <span class="at">quantiles =</span> <span class="dv">100</span></span>
<span id="cb368-10"><a href="stats_method.html#cb368-10" tabindex="-1"></a>    , <span class="at">point_size =</span> <span class="dv">3</span> </span>
<span id="cb368-11"><a href="stats_method.html#cb368-11" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb368-12"><a href="stats_method.html#cb368-12" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">facet_grid</span>(</span>
<span id="cb368-13"><a href="stats_method.html#cb368-13" tabindex="-1"></a>    <span class="at">cols =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(spectral_weight)</span>
<span id="cb368-14"><a href="stats_method.html#cb368-14" tabindex="-1"></a>    , <span class="at">rows =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(chm_res_m)</span>
<span id="cb368-15"><a href="stats_method.html#cb368-15" tabindex="-1"></a>    , <span class="at">scales =</span> <span class="st">&quot;free_y&quot;</span></span>
<span id="cb368-16"><a href="stats_method.html#cb368-16" tabindex="-1"></a>    , <span class="at">labeller =</span> <span class="st">&quot;label_both&quot;</span></span>
<span id="cb368-17"><a href="stats_method.html#cb368-17" tabindex="-1"></a>    , <span class="at">axes =</span> <span class="st">&quot;all_x&quot;</span></span>
<span id="cb368-18"><a href="stats_method.html#cb368-18" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb368-19"><a href="stats_method.html#cb368-19" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">breaks =</span> scales<span class="sc">::</span><span class="fu">breaks_extended</span>(<span class="dv">6</span>)) <span class="sc">+</span></span>
<span id="cb368-20"><a href="stats_method.html#cb368-20" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb368-21"><a href="stats_method.html#cb368-21" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb368-22"><a href="stats_method.html#cb368-22" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb368-23"><a href="stats_method.html#cb368-23" tabindex="-1"></a>    <span class="at">strip.text.x =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb368-24"><a href="stats_method.html#cb368-24" tabindex="-1"></a>    , <span class="at">strip.text.y =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb368-25"><a href="stats_method.html#cb368-25" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-351-1.png" width="1008" /></p>
<p>when the <code>circle_fit_iou_pct</code> parameter is optimized (i.e. set near ‘1’), the influence of <code>convexity_pct</code> on form quantification accuracy is dependent on the CHM resolution. only for the finest resolution CHM data (i.e. 0.1m) tested, the model’s predictions indicate with high certainty that the optimal <code>convexity_pct</code> is its maximum value of ‘1’. for coarser resolution CHM data (e.g. 0.3m), the 95% HDI for the optimal <code>convexity_pct</code> spans the entire 0-1 range, indicating the model is not confident in any specific setting. an important distinction is that this finding of irrelavance for the <code>convexity_pct</code> parameter on diameter quantification is only for cases when <code>circle_fit_iou_pct</code> is already optimized, which, as shown above, was at a level near 1 for this coarser-resolution CHM data. at these higher <code>circle_fit_iou_pct</code> levels , the filtering for irregularly shaped objects is accomplished solely by the <code>circle_fit_iou_pct</code> parameter so the <code>convexity_pct</code> is less important for accurate quantification of predicted diameter. however, when the <code>circle_fit_iou_pct</code> parameter is <em>not</em> optimized or is turned off (e.g., set to 0), <code>convexity_pct</code> becomes a crucial parameter for filtering irregularly shaped objects.</p>
<p>we can look at this another way, check it</p>
<div class="sourceCode" id="cb369"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb369-1"><a href="stats_method.html#cb369-1" tabindex="-1"></a>vertex_draws_temp <span class="sc">%&gt;%</span> </span>
<span id="cb369-2"><a href="stats_method.html#cb369-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(</span>
<span id="cb369-3"><a href="stats_method.html#cb369-3" tabindex="-1"></a>    chm_res_m <span class="sc">%in%</span> <span class="fu">seq</span>(<span class="fl">0.1</span>,<span class="fl">0.5</span>,<span class="at">by=</span><span class="fl">0.1</span>)</span>
<span id="cb369-4"><a href="stats_method.html#cb369-4" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb369-5"><a href="stats_method.html#cb369-5" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb369-6"><a href="stats_method.html#cb369-6" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">y =</span> convexity_pct, <span class="at">x =</span> circle_fit_iou_pct)) <span class="sc">+</span></span>
<span id="cb369-7"><a href="stats_method.html#cb369-7" tabindex="-1"></a>  <span class="co"># geom_point(alpha=0.2) +</span></span>
<span id="cb369-8"><a href="stats_method.html#cb369-8" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_jitter</span>(<span class="at">alpha=</span><span class="fl">0.2</span>, <span class="at">height =</span> .<span class="dv">01</span>, <span class="at">width =</span> <span class="fl">0.0</span>) <span class="sc">+</span></span>
<span id="cb369-9"><a href="stats_method.html#cb369-9" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">facet_grid</span>(</span>
<span id="cb369-10"><a href="stats_method.html#cb369-10" tabindex="-1"></a>    <span class="at">cols =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(spectral_weight)</span>
<span id="cb369-11"><a href="stats_method.html#cb369-11" tabindex="-1"></a>    , <span class="at">rows =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(chm_res_m)</span>
<span id="cb369-12"><a href="stats_method.html#cb369-12" tabindex="-1"></a>    <span class="co"># , scales = &quot;free_y&quot;</span></span>
<span id="cb369-13"><a href="stats_method.html#cb369-13" tabindex="-1"></a>    , <span class="at">labeller =</span> <span class="st">&quot;label_both&quot;</span></span>
<span id="cb369-14"><a href="stats_method.html#cb369-14" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb369-15"><a href="stats_method.html#cb369-15" tabindex="-1"></a>  <span class="co"># ggplot2::scale_x_continuous(limits = c(0,1)) +</span></span>
<span id="cb369-16"><a href="stats_method.html#cb369-16" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb369-17"><a href="stats_method.html#cb369-17" tabindex="-1"></a>  <span class="co"># ggplot2::scale_y_continuous(NULL, breaks = NULL) +</span></span>
<span id="cb369-18"><a href="stats_method.html#cb369-18" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb369-19"><a href="stats_method.html#cb369-19" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb369-20"><a href="stats_method.html#cb369-20" tabindex="-1"></a>    <span class="at">strip.text.x =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb369-21"><a href="stats_method.html#cb369-21" tabindex="-1"></a>    , <span class="at">strip.text.y =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb369-22"><a href="stats_method.html#cb369-22" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-352-1.png" width="1008" /></p>
<p>note, in the plot above, we slightly “jitter” the points so that they are visible where they would otherwise be stacked on top of each other and only look like a few points instead of the 1000 draws from the posterior we used</p>
<p>let’s table the HDI of the optimal values</p>
<div class="sourceCode" id="cb370"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb370-1"><a href="stats_method.html#cb370-1" tabindex="-1"></a><span class="co"># summarize it</span></span>
<span id="cb370-2"><a href="stats_method.html#cb370-2" tabindex="-1"></a>vertex_draws_temp <span class="ot">&lt;-</span> </span>
<span id="cb370-3"><a href="stats_method.html#cb370-3" tabindex="-1"></a>  vertex_draws_temp <span class="sc">%&gt;%</span> </span>
<span id="cb370-4"><a href="stats_method.html#cb370-4" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(</span>
<span id="cb370-5"><a href="stats_method.html#cb370-5" tabindex="-1"></a>    chm_res_m, spectral_weight</span>
<span id="cb370-6"><a href="stats_method.html#cb370-6" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb370-7"><a href="stats_method.html#cb370-7" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(</span>
<span id="cb370-8"><a href="stats_method.html#cb370-8" tabindex="-1"></a>    <span class="co"># get median_hdi</span></span>
<span id="cb370-9"><a href="stats_method.html#cb370-9" tabindex="-1"></a>    <span class="at">median_hdi_est_circle_fit_iou_pct =</span> tidybayes<span class="sc">::</span><span class="fu">median_hdci</span>(circle_fit_iou_pct)<span class="sc">$</span>y</span>
<span id="cb370-10"><a href="stats_method.html#cb370-10" tabindex="-1"></a>    , <span class="at">median_hdi_lower_circle_fit_iou_pct =</span> tidybayes<span class="sc">::</span><span class="fu">median_hdci</span>(circle_fit_iou_pct)<span class="sc">$</span>ymin</span>
<span id="cb370-11"><a href="stats_method.html#cb370-11" tabindex="-1"></a>    , <span class="at">median_hdi_upper_circle_fit_iou_pct =</span> tidybayes<span class="sc">::</span><span class="fu">median_hdci</span>(circle_fit_iou_pct)<span class="sc">$</span>ymax</span>
<span id="cb370-12"><a href="stats_method.html#cb370-12" tabindex="-1"></a>    <span class="co"># get median_hdi</span></span>
<span id="cb370-13"><a href="stats_method.html#cb370-13" tabindex="-1"></a>    , <span class="at">median_hdi_est_convexity_pct =</span> tidybayes<span class="sc">::</span><span class="fu">median_hdci</span>(convexity_pct)<span class="sc">$</span>y</span>
<span id="cb370-14"><a href="stats_method.html#cb370-14" tabindex="-1"></a>    , <span class="at">median_hdi_lower_convexity_pct =</span> tidybayes<span class="sc">::</span><span class="fu">median_hdci</span>(convexity_pct)<span class="sc">$</span>ymin</span>
<span id="cb370-15"><a href="stats_method.html#cb370-15" tabindex="-1"></a>    , <span class="at">median_hdi_upper_convexity_pct =</span> tidybayes<span class="sc">::</span><span class="fu">median_hdci</span>(convexity_pct)<span class="sc">$</span>ymax</span>
<span id="cb370-16"><a href="stats_method.html#cb370-16" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb370-17"><a href="stats_method.html#cb370-17" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() </span>
<span id="cb370-18"><a href="stats_method.html#cb370-18" tabindex="-1"></a><span class="co"># table it</span></span>
<span id="cb370-19"><a href="stats_method.html#cb370-19" tabindex="-1"></a>vertex_draws_temp <span class="sc">%&gt;%</span> </span>
<span id="cb370-20"><a href="stats_method.html#cb370-20" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kbl</span>(</span>
<span id="cb370-21"><a href="stats_method.html#cb370-21" tabindex="-1"></a>    <span class="at">digits =</span> <span class="dv">2</span></span>
<span id="cb370-22"><a href="stats_method.html#cb370-22" tabindex="-1"></a>    , <span class="at">caption =</span> <span class="st">&quot;&quot;</span></span>
<span id="cb370-23"><a href="stats_method.html#cb370-23" tabindex="-1"></a>    , <span class="at">col.names =</span> <span class="fu">c</span>(</span>
<span id="cb370-24"><a href="stats_method.html#cb370-24" tabindex="-1"></a>      <span class="st">&quot;CHM resolution&quot;</span>, <span class="st">&quot;spectral_weight&quot;</span></span>
<span id="cb370-25"><a href="stats_method.html#cb370-25" tabindex="-1"></a>      , <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;median&quot;</span>, <span class="st">&quot;HDI low&quot;</span>, <span class="st">&quot;HDI high&quot;</span>),<span class="dv">2</span>)</span>
<span id="cb370-26"><a href="stats_method.html#cb370-26" tabindex="-1"></a>    )</span>
<span id="cb370-27"><a href="stats_method.html#cb370-27" tabindex="-1"></a>    , <span class="at">escape =</span> F</span>
<span id="cb370-28"><a href="stats_method.html#cb370-28" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb370-29"><a href="stats_method.html#cb370-29" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kable_styling</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb370-30"><a href="stats_method.html#cb370-30" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">collapse_rows</span>(<span class="at">columns =</span> <span class="dv">1</span>, <span class="at">valign =</span> <span class="st">&quot;top&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb370-31"><a href="stats_method.html#cb370-31" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">add_header_above</span>(<span class="fu">c</span>(</span>
<span id="cb370-32"><a href="stats_method.html#cb370-32" tabindex="-1"></a>    <span class="st">&quot; &quot;</span><span class="ot">=</span><span class="dv">2</span></span>
<span id="cb370-33"><a href="stats_method.html#cb370-33" tabindex="-1"></a>    , <span class="st">&quot;circle_fit_iou_pct&quot;</span> <span class="ot">=</span> <span class="dv">3</span></span>
<span id="cb370-34"><a href="stats_method.html#cb370-34" tabindex="-1"></a>    , <span class="st">&quot;convexity_pct&quot;</span> <span class="ot">=</span> <span class="dv">3</span></span>
<span id="cb370-35"><a href="stats_method.html#cb370-35" tabindex="-1"></a>  ))</span></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-353">Table 9.10: </span>
</caption>
<thead>
<tr>
<th style="empty-cells: hide;border-bottom:hidden;" colspan="2">
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="3">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
circle_fit_iou_pct
</div>
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="3">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
convexity_pct
</div>
</th>
</tr>
<tr>
<th style="text-align:right;">
CHM resolution
</th>
<th style="text-align:left;">
spectral_weight
</th>
<th style="text-align:right;">
median
</th>
<th style="text-align:right;">
HDI low
</th>
<th style="text-align:right;">
HDI high
</th>
<th style="text-align:right;">
median
</th>
<th style="text-align:right;">
HDI low
</th>
<th style="text-align:right;">
HDI high
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
0.1
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
0.2
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
0.3
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
0.4
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;">
0.5
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="input-data" class="section level4 hasAnchor" number="9.2.5.2">
<h4><span class="header-section-number">9.2.5.2</span> Input data<a href="stats_method.html#input-data" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>to explore the influence of the input data, which includes the presence or absence of spectral data and its weighting (i.e. <code>spectral_weight</code>) as well as the CHM resolution (<code>chm_res_m</code>), we will fix all four structural parameters (<code>max_ht_m</code>, <code>max_area_m2</code>, <code>convexity_pct</code>, <code>circle_fit_iou_pct</code>). the <code>max_ht_m</code>, <code>max_area_m2</code> parameters will be fixed at expected levels based on the slash pile construction prescription while the <code>convexity_pct</code>, <code>circle_fit_iou_pct</code> will be fixed at the optimal levels determined based on the Bayesian posterior predictive distribution of <a href="stats_method.html#f_score_epred">detection accuracy</a></p>
<p>we’ll make contrasts of the posterior predictions to probabilistically quantify the influence of the input data (e.g. inclusion of spectral data and it’s weighting and CHM resolution)</p>
<p>let’s get the posterior predictive draws</p>
<div class="sourceCode" id="cb371"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb371-1"><a href="stats_method.html#cb371-1" tabindex="-1"></a><span class="co"># structural_params_settings</span></span>
<span id="cb371-2"><a href="stats_method.html#cb371-2" tabindex="-1"></a>draws_temp <span class="ot">&lt;-</span> </span>
<span id="cb371-3"><a href="stats_method.html#cb371-3" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">crossing</span>(</span>
<span id="cb371-4"><a href="stats_method.html#cb371-4" tabindex="-1"></a>    structural_params_settings</span>
<span id="cb371-5"><a href="stats_method.html#cb371-5" tabindex="-1"></a>    , param_combos_spectral_ranked <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">distinct</span>(spectral_weight_fact, spectral_weight)</span>
<span id="cb371-6"><a href="stats_method.html#cb371-6" tabindex="-1"></a>    , param_combos_spectral_ranked <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">distinct</span>(chm_res_m)</span>
<span id="cb371-7"><a href="stats_method.html#cb371-7" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb371-8"><a href="stats_method.html#cb371-8" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">add_epred_draws</span>(brms_diam_mape_mod, <span class="at">ndraws =</span> <span class="dv">1111</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb371-9"><a href="stats_method.html#cb371-9" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">value =</span> .epred)</span>
<span id="cb371-10"><a href="stats_method.html#cb371-10" tabindex="-1"></a><span class="co"># # huh?</span></span>
<span id="cb371-11"><a href="stats_method.html#cb371-11" tabindex="-1"></a><span class="co"># draws_temp %&gt;% dplyr::glimpse()</span></span></code></pre></div>
<div id="chm-resolution-1" class="section level5 hasAnchor" number="9.2.5.2.1">
<h5><span class="header-section-number">9.2.5.2.1</span> CHM resolution<a href="stats_method.html#chm-resolution-1" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>first, we’ll look at the impact of changing CHM resolution by the <code>spectral_weight</code> parameter where a value of “0” indicates no spectral data was used (i.e. structural only), the lowest weighting of the spectral data is “1” (only one spectral index threshold must be met), and the highest weighting of spectral data is “5” (all spectral index thresholds must be met).</p>
<p>our questions regarding CHM resolution were:</p>
<ul>
<li>question 1: <em>does CHM resolution influence quantification accuracy?</em></li>
<li>question 2: <em>does the effect of CHM resolution change based on the inclusion of spectral data versus using only structural data?</em></li>
</ul>
<p>we can answer those questions using our model by considering the credible slope of the CHM resolution predictor as a function of the <code>spectral_weight</code> parameter (e.g. Kurz <a href="https://bookdown.org/content/3686/18.html">2025</a>; <a href="https://sites.google.com/site/doingbayesiandataanalysis/">Kruschke (2015, Ch. 18)</a>)</p>
<div class="sourceCode" id="cb372"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb372-1"><a href="stats_method.html#cb372-1" tabindex="-1"></a>draws_temp <span class="sc">%&gt;%</span> </span>
<span id="cb372-2"><a href="stats_method.html#cb372-2" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> chm_res_m, <span class="at">y =</span> value, <span class="at">color =</span> spectral_weight)) <span class="sc">+</span></span>
<span id="cb372-3"><a href="stats_method.html#cb372-3" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">stat_lineribbon</span>(<span class="at">point_interval =</span> <span class="st">&quot;median_hdi&quot;</span>, <span class="at">.width =</span> <span class="fu">c</span>(<span class="fl">0.95</span>)) <span class="sc">+</span></span>
<span id="cb372-4"><a href="stats_method.html#cb372-4" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_fill_brewer</span>(<span class="at">palette =</span> <span class="st">&quot;Greys&quot;</span>) <span class="sc">+</span></span>
<span id="cb372-5"><a href="stats_method.html#cb372-5" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_color_manual</span>(<span class="at">values =</span> pal_spectral_weight) <span class="sc">+</span></span>
<span id="cb372-6"><a href="stats_method.html#cb372-6" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>percent) <span class="sc">+</span></span>
<span id="cb372-7"><a href="stats_method.html#cb372-7" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;CHM resolution&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Diameter MAPE&quot;</span>) <span class="sc">+</span></span>
<span id="cb372-8"><a href="stats_method.html#cb372-8" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb372-9"><a href="stats_method.html#cb372-9" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb372-10"><a href="stats_method.html#cb372-10" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;top&quot;</span></span>
<span id="cb372-11"><a href="stats_method.html#cb372-11" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb372-12"><a href="stats_method.html#cb372-12" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">guides</span>(</span>
<span id="cb372-13"><a href="stats_method.html#cb372-13" tabindex="-1"></a>    <span class="at">color =</span> ggplot2<span class="sc">::</span><span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">shape =</span> <span class="dv">15</span>, <span class="at">lwd =</span> <span class="dv">8</span>, <span class="at">fill =</span> <span class="cn">NA</span>))</span>
<span id="cb372-14"><a href="stats_method.html#cb372-14" tabindex="-1"></a>    , <span class="at">fill =</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb372-15"><a href="stats_method.html#cb372-15" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-356-1.png" width="1008" /></p>
<p>the primary takeaway from this plot is that coarser resolution CHM data produces significantly worse diameter quantification accuracy (i.e. higher MAPE) irrespective of the inclusion of spectral data or it’s weighting. if the objective is to quantify slash pile form with any sort of accuracy, a CHM resolution of 0.2m or finer is needed. based on the vertex of the parabola, the optimal CHM resolution for accurately quantifying diameter is between 0.1m and 0.2m. remember that the inclusion of spectral data in the data fusion detection methodology does not alter candidate pile form nor add new piles, so we don’t expect much variability in quantification accuracy at a given CHM resolution based on the inclusion of spectral data. any changes in overall pile quantification accuracy (e.g. when aggregated to the stand level) from the inclusion of spectral data is a result of the spectral data filtering out candidate piles that would otherwise alter the overall, aggregated accuracy.</p>
<p>we can look at the posterior distributions of the expected Diameter MAPE at different CHM resolution levels by the inclusion (or exclusion) of spectral data and it’s weighting</p>
<div class="sourceCode" id="cb373"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb373-1"><a href="stats_method.html#cb373-1" tabindex="-1"></a>draws_temp <span class="sc">%&gt;%</span> </span>
<span id="cb373-2"><a href="stats_method.html#cb373-2" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">y=</span>value, <span class="at">x=</span>chm_res_m)) <span class="sc">+</span></span>
<span id="cb373-3"><a href="stats_method.html#cb373-3" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">stat_eye</span>(</span>
<span id="cb373-4"><a href="stats_method.html#cb373-4" tabindex="-1"></a>    <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">fill =</span> spectral_weight)</span>
<span id="cb373-5"><a href="stats_method.html#cb373-5" tabindex="-1"></a>    , <span class="at">point_interval =</span> median_hdi, <span class="at">.width =</span> .<span class="dv">95</span></span>
<span id="cb373-6"><a href="stats_method.html#cb373-6" tabindex="-1"></a>    , <span class="at">slab_alpha =</span> <span class="fl">0.95</span></span>
<span id="cb373-7"><a href="stats_method.html#cb373-7" tabindex="-1"></a>    , <span class="at">interval_color =</span> <span class="st">&quot;gray44&quot;</span>, <span class="at">linewidth =</span> <span class="dv">1</span></span>
<span id="cb373-8"><a href="stats_method.html#cb373-8" tabindex="-1"></a>    , <span class="at">point_color =</span> <span class="st">&quot;gray44&quot;</span>, <span class="at">point_fill =</span> <span class="st">&quot;gray44&quot;</span>, <span class="at">point_size =</span> <span class="dv">1</span></span>
<span id="cb373-9"><a href="stats_method.html#cb373-9" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb373-10"><a href="stats_method.html#cb373-10" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">facet_grid</span>(<span class="at">cols =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(spectral_weight), <span class="at">labeller =</span> <span class="st">&quot;label_both&quot;</span>) <span class="sc">+</span></span>
<span id="cb373-11"><a href="stats_method.html#cb373-11" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_fill_manual</span>(<span class="at">values =</span> pal_spectral_weight) <span class="sc">+</span></span>
<span id="cb373-12"><a href="stats_method.html#cb373-12" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>percent, <span class="at">breaks =</span> scales<span class="sc">::</span><span class="fu">breaks_extended</span>(<span class="dv">16</span>)) <span class="sc">+</span></span>
<span id="cb373-13"><a href="stats_method.html#cb373-13" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;CHM resolution&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Diameter MAPE&quot;</span>) <span class="sc">+</span></span>
<span id="cb373-14"><a href="stats_method.html#cb373-14" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb373-15"><a href="stats_method.html#cb373-15" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb373-16"><a href="stats_method.html#cb373-16" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb373-17"><a href="stats_method.html#cb373-17" tabindex="-1"></a>    , <span class="at">strip.text =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb373-18"><a href="stats_method.html#cb373-18" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-357-1.png" width="1008" /></p>
<p>those are some tight posterior distributions and HDI’s, meaning our model is very confident in the expected diameter accuracy at the CHM resolutions tested. put another way, the output from our pile detection methodology is consistent in terms of quantification of detected pile diameter and it’s error relative to field-measured values.</p>
<p>table that</p>
<div class="sourceCode" id="cb374"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb374-1"><a href="stats_method.html#cb374-1" tabindex="-1"></a>draws_temp <span class="sc">%&gt;%</span> </span>
<span id="cb374-2"><a href="stats_method.html#cb374-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">spectral_weight =</span> forcats<span class="sc">::</span><span class="fu">fct_relabel</span>(spectral_weight,<span class="sc">~</span><span class="fu">paste0</span>(<span class="st">&quot;spectral_weight: &quot;</span>, .x, <span class="at">recycle0 =</span> T))) <span class="sc">%&gt;%</span> </span>
<span id="cb374-3"><a href="stats_method.html#cb374-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(spectral_weight, chm_res_m) <span class="sc">%&gt;%</span></span>
<span id="cb374-4"><a href="stats_method.html#cb374-4" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(</span>
<span id="cb374-5"><a href="stats_method.html#cb374-5" tabindex="-1"></a>    <span class="co"># get median_hdi</span></span>
<span id="cb374-6"><a href="stats_method.html#cb374-6" tabindex="-1"></a>    <span class="at">median_hdi_est =</span> tidybayes<span class="sc">::</span><span class="fu">median_hdci</span>(value)<span class="sc">$</span>y</span>
<span id="cb374-7"><a href="stats_method.html#cb374-7" tabindex="-1"></a>    , <span class="at">median_hdi_lower =</span> tidybayes<span class="sc">::</span><span class="fu">median_hdci</span>(value)<span class="sc">$</span>ymin</span>
<span id="cb374-8"><a href="stats_method.html#cb374-8" tabindex="-1"></a>    , <span class="at">median_hdi_upper =</span> tidybayes<span class="sc">::</span><span class="fu">median_hdci</span>(value)<span class="sc">$</span>ymax</span>
<span id="cb374-9"><a href="stats_method.html#cb374-9" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb374-10"><a href="stats_method.html#cb374-10" tabindex="-1"></a>  <span class="co"># format pcts</span></span>
<span id="cb374-11"><a href="stats_method.html#cb374-11" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(dplyr<span class="sc">::</span><span class="fu">across</span>(</span>
<span id="cb374-12"><a href="stats_method.html#cb374-12" tabindex="-1"></a>    tidyselect<span class="sc">::</span><span class="fu">starts_with</span>(<span class="st">&quot;median_hdi_&quot;</span>)</span>
<span id="cb374-13"><a href="stats_method.html#cb374-13" tabindex="-1"></a>    , <span class="sc">~</span> scales<span class="sc">::</span><span class="fu">percent</span>(.x, <span class="at">accuracy =</span> <span class="fl">0.1</span>)</span>
<span id="cb374-14"><a href="stats_method.html#cb374-14" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb374-15"><a href="stats_method.html#cb374-15" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb374-16"><a href="stats_method.html#cb374-16" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(spectral_weight, chm_res_m) <span class="sc">%&gt;%</span> </span>
<span id="cb374-17"><a href="stats_method.html#cb374-17" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kbl</span>(</span>
<span id="cb374-18"><a href="stats_method.html#cb374-18" tabindex="-1"></a>    <span class="at">digits =</span> <span class="dv">2</span></span>
<span id="cb374-19"><a href="stats_method.html#cb374-19" tabindex="-1"></a>    , <span class="at">caption =</span> <span class="st">&quot;Diameter MAPE&lt;br&gt;95% HDI of the posterior predictive distribution&quot;</span></span>
<span id="cb374-20"><a href="stats_method.html#cb374-20" tabindex="-1"></a>    , <span class="at">col.names =</span> <span class="fu">c</span>(</span>
<span id="cb374-21"><a href="stats_method.html#cb374-21" tabindex="-1"></a>      <span class="st">&quot;spectral_weight&quot;</span>, <span class="st">&quot;CHM resolution&quot;</span></span>
<span id="cb374-22"><a href="stats_method.html#cb374-22" tabindex="-1"></a>      , <span class="fu">c</span>(<span class="st">&quot;Diameter MAPE&lt;br&gt;median&quot;</span>, <span class="st">&quot;HDI low&quot;</span>, <span class="st">&quot;HDI high&quot;</span>)</span>
<span id="cb374-23"><a href="stats_method.html#cb374-23" tabindex="-1"></a>    )</span>
<span id="cb374-24"><a href="stats_method.html#cb374-24" tabindex="-1"></a>    , <span class="at">escape =</span> F</span>
<span id="cb374-25"><a href="stats_method.html#cb374-25" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb374-26"><a href="stats_method.html#cb374-26" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kable_styling</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb374-27"><a href="stats_method.html#cb374-27" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">collapse_rows</span>(<span class="at">columns =</span> <span class="dv">1</span>, <span class="at">valign =</span> <span class="st">&quot;top&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb374-28"><a href="stats_method.html#cb374-28" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">scroll_box</span>(<span class="at">height =</span> <span class="st">&quot;8in&quot;</span>)</span></code></pre></div>
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:8in; ">
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-358">Table 9.11: </span>Diameter MAPE<br>95% HDI of the posterior predictive distribution
</caption>
<thead>
<tr>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
spectral_weight
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
CHM resolution
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
Diameter MAPE<br>median
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
HDI low
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
HDI high
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="5">
spectral_weight: 0
</td>
<td style="text-align:right;">
0.1
</td>
<td style="text-align:left;">
10.9%
</td>
<td style="text-align:left;">
10.8%
</td>
<td style="text-align:left;">
11.1%
</td>
</tr>
<tr>
<td style="text-align:right;">
0.2
</td>
<td style="text-align:left;">
18.1%
</td>
<td style="text-align:left;">
17.9%
</td>
<td style="text-align:left;">
18.3%
</td>
</tr>
<tr>
<td style="text-align:right;">
0.3
</td>
<td style="text-align:left;">
26.9%
</td>
<td style="text-align:left;">
26.7%
</td>
<td style="text-align:left;">
27.1%
</td>
</tr>
<tr>
<td style="text-align:right;">
0.4
</td>
<td style="text-align:left;">
35.9%
</td>
<td style="text-align:left;">
35.6%
</td>
<td style="text-align:left;">
36.2%
</td>
</tr>
<tr>
<td style="text-align:right;">
0.5
</td>
<td style="text-align:left;">
43.1%
</td>
<td style="text-align:left;">
42.6%
</td>
<td style="text-align:left;">
43.6%
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="5">
spectral_weight: 1
</td>
<td style="text-align:right;">
0.1
</td>
<td style="text-align:left;">
10.9%
</td>
<td style="text-align:left;">
10.8%
</td>
<td style="text-align:left;">
11.1%
</td>
</tr>
<tr>
<td style="text-align:right;">
0.2
</td>
<td style="text-align:left;">
18.1%
</td>
<td style="text-align:left;">
17.9%
</td>
<td style="text-align:left;">
18.3%
</td>
</tr>
<tr>
<td style="text-align:right;">
0.3
</td>
<td style="text-align:left;">
26.9%
</td>
<td style="text-align:left;">
26.7%
</td>
<td style="text-align:left;">
27.1%
</td>
</tr>
<tr>
<td style="text-align:right;">
0.4
</td>
<td style="text-align:left;">
35.9%
</td>
<td style="text-align:left;">
35.6%
</td>
<td style="text-align:left;">
36.2%
</td>
</tr>
<tr>
<td style="text-align:right;">
0.5
</td>
<td style="text-align:left;">
43.1%
</td>
<td style="text-align:left;">
42.6%
</td>
<td style="text-align:left;">
43.6%
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="5">
spectral_weight: 2
</td>
<td style="text-align:right;">
0.1
</td>
<td style="text-align:left;">
10.9%
</td>
<td style="text-align:left;">
10.8%
</td>
<td style="text-align:left;">
11.1%
</td>
</tr>
<tr>
<td style="text-align:right;">
0.2
</td>
<td style="text-align:left;">
18.1%
</td>
<td style="text-align:left;">
17.9%
</td>
<td style="text-align:left;">
18.3%
</td>
</tr>
<tr>
<td style="text-align:right;">
0.3
</td>
<td style="text-align:left;">
26.9%
</td>
<td style="text-align:left;">
26.7%
</td>
<td style="text-align:left;">
27.1%
</td>
</tr>
<tr>
<td style="text-align:right;">
0.4
</td>
<td style="text-align:left;">
35.9%
</td>
<td style="text-align:left;">
35.6%
</td>
<td style="text-align:left;">
36.2%
</td>
</tr>
<tr>
<td style="text-align:right;">
0.5
</td>
<td style="text-align:left;">
43.1%
</td>
<td style="text-align:left;">
42.5%
</td>
<td style="text-align:left;">
43.6%
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="5">
spectral_weight: 3
</td>
<td style="text-align:right;">
0.1
</td>
<td style="text-align:left;">
10.9%
</td>
<td style="text-align:left;">
10.8%
</td>
<td style="text-align:left;">
11.1%
</td>
</tr>
<tr>
<td style="text-align:right;">
0.2
</td>
<td style="text-align:left;">
18.1%
</td>
<td style="text-align:left;">
17.9%
</td>
<td style="text-align:left;">
18.3%
</td>
</tr>
<tr>
<td style="text-align:right;">
0.3
</td>
<td style="text-align:left;">
26.9%
</td>
<td style="text-align:left;">
26.7%
</td>
<td style="text-align:left;">
27.2%
</td>
</tr>
<tr>
<td style="text-align:right;">
0.4
</td>
<td style="text-align:left;">
35.9%
</td>
<td style="text-align:left;">
35.6%
</td>
<td style="text-align:left;">
36.3%
</td>
</tr>
<tr>
<td style="text-align:right;">
0.5
</td>
<td style="text-align:left;">
43.1%
</td>
<td style="text-align:left;">
42.6%
</td>
<td style="text-align:left;">
43.6%
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="5">
spectral_weight: 4
</td>
<td style="text-align:right;">
0.1
</td>
<td style="text-align:left;">
10.9%
</td>
<td style="text-align:left;">
10.8%
</td>
<td style="text-align:left;">
11.1%
</td>
</tr>
<tr>
<td style="text-align:right;">
0.2
</td>
<td style="text-align:left;">
18.1%
</td>
<td style="text-align:left;">
17.9%
</td>
<td style="text-align:left;">
18.3%
</td>
</tr>
<tr>
<td style="text-align:right;">
0.3
</td>
<td style="text-align:left;">
26.9%
</td>
<td style="text-align:left;">
26.7%
</td>
<td style="text-align:left;">
27.1%
</td>
</tr>
<tr>
<td style="text-align:right;">
0.4
</td>
<td style="text-align:left;">
35.9%
</td>
<td style="text-align:left;">
35.6%
</td>
<td style="text-align:left;">
36.3%
</td>
</tr>
<tr>
<td style="text-align:right;">
0.5
</td>
<td style="text-align:left;">
43.1%
</td>
<td style="text-align:left;">
42.5%
</td>
<td style="text-align:left;">
43.6%
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="5">
spectral_weight: 5
</td>
<td style="text-align:right;">
0.1
</td>
<td style="text-align:left;">
11.5%
</td>
<td style="text-align:left;">
11.4%
</td>
<td style="text-align:left;">
11.7%
</td>
</tr>
<tr>
<td style="text-align:right;">
0.2
</td>
<td style="text-align:left;">
18.9%
</td>
<td style="text-align:left;">
18.7%
</td>
<td style="text-align:left;">
19.0%
</td>
</tr>
<tr>
<td style="text-align:right;">
0.3
</td>
<td style="text-align:left;">
27.8%
</td>
<td style="text-align:left;">
27.5%
</td>
<td style="text-align:left;">
28.0%
</td>
</tr>
<tr>
<td style="text-align:right;">
0.4
</td>
<td style="text-align:left;">
36.6%
</td>
<td style="text-align:left;">
36.3%
</td>
<td style="text-align:left;">
37.0%
</td>
</tr>
<tr>
<td style="text-align:right;">
0.5
</td>
<td style="text-align:left;">
43.4%
</td>
<td style="text-align:left;">
42.9%
</td>
<td style="text-align:left;">
44.0%
</td>
</tr>
</tbody>
</table>
</div>
<p>now we’ll probabilistically test the hypothesis that coarser resolution CHM data results in lower diameter quantification accuracy and determine by how much. we’ll look at the influence of CHM resolution based on the inclusion of spectral data (or exclusion) and it’s weighting determined by the <code>spectral_weight</code> parameter</p>
<p>we’ll only make contrasts against the lowest CHM resolution tested which will be treated as a “control” in the <code>tidybayes::compare_levels()</code> call</p>
<div class="sourceCode" id="cb375"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb375-1"><a href="stats_method.html#cb375-1" tabindex="-1"></a>contrast_temp <span class="ot">&lt;-</span> </span>
<span id="cb375-2"><a href="stats_method.html#cb375-2" tabindex="-1"></a>  draws_temp <span class="sc">%&gt;%</span> </span>
<span id="cb375-3"><a href="stats_method.html#cb375-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(spectral_weight) <span class="sc">%&gt;%</span> </span>
<span id="cb375-4"><a href="stats_method.html#cb375-4" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">compare_levels</span>(</span>
<span id="cb375-5"><a href="stats_method.html#cb375-5" tabindex="-1"></a>    value</span>
<span id="cb375-6"><a href="stats_method.html#cb375-6" tabindex="-1"></a>    , <span class="at">by =</span> chm_res_m</span>
<span id="cb375-7"><a href="stats_method.html#cb375-7" tabindex="-1"></a>    , <span class="at">comparison =</span> </span>
<span id="cb375-8"><a href="stats_method.html#cb375-8" tabindex="-1"></a>      <span class="st">&quot;control&quot;</span></span>
<span id="cb375-9"><a href="stats_method.html#cb375-9" tabindex="-1"></a>      <span class="co"># tidybayes::emmeans_comparison(&quot;revpairwise&quot;) </span></span>
<span id="cb375-10"><a href="stats_method.html#cb375-10" tabindex="-1"></a>      <span class="co"># &quot;pairwise&quot;</span></span>
<span id="cb375-11"><a href="stats_method.html#cb375-11" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb375-12"><a href="stats_method.html#cb375-12" tabindex="-1"></a>  <span class="co"># dplyr::glimpse()</span></span>
<span id="cb375-13"><a href="stats_method.html#cb375-13" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">contrast =</span> chm_res_m) <span class="sc">%&gt;%</span> </span>
<span id="cb375-14"><a href="stats_method.html#cb375-14" tabindex="-1"></a>  <span class="co"># group the data before calculating contrast variables %&gt;% </span></span>
<span id="cb375-15"><a href="stats_method.html#cb375-15" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(spectral_weight, contrast) <span class="sc">%&gt;%</span> </span>
<span id="cb375-16"><a href="stats_method.html#cb375-16" tabindex="-1"></a>  <span class="fu">make_contrast_vars</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb375-17"><a href="stats_method.html#cb375-17" tabindex="-1"></a>  <span class="co"># relabel the label for the facets</span></span>
<span id="cb375-18"><a href="stats_method.html#cb375-18" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">spectral_weight =</span> forcats<span class="sc">::</span><span class="fu">fct_relabel</span>(spectral_weight,<span class="sc">~</span><span class="fu">paste0</span>(<span class="st">&quot;spectral_weight: &quot;</span>, .x, <span class="at">recycle0 =</span> T)))</span>
<span id="cb375-19"><a href="stats_method.html#cb375-19" tabindex="-1"></a><span class="co"># huh?</span></span>
<span id="cb375-20"><a href="stats_method.html#cb375-20" tabindex="-1"></a><span class="co"># contrast_temp %&gt;% dplyr::glimpse()</span></span>
<span id="cb375-21"><a href="stats_method.html#cb375-21" tabindex="-1"></a></span>
<span id="cb375-22"><a href="stats_method.html#cb375-22" tabindex="-1"></a><span class="co"># plot it</span></span>
<span id="cb375-23"><a href="stats_method.html#cb375-23" tabindex="-1"></a><span class="fu">plt_contrast</span>(</span>
<span id="cb375-24"><a href="stats_method.html#cb375-24" tabindex="-1"></a>  contrast_temp</span>
<span id="cb375-25"><a href="stats_method.html#cb375-25" tabindex="-1"></a>  <span class="co"># , caption_text = form_temp</span></span>
<span id="cb375-26"><a href="stats_method.html#cb375-26" tabindex="-1"></a>  , <span class="at">y_axis_title =</span> <span class="st">&quot;CHM resolution contrast&quot;</span></span>
<span id="cb375-27"><a href="stats_method.html#cb375-27" tabindex="-1"></a>  , <span class="at">x_axis_title =</span> <span class="st">&quot;difference (Diameter MAPE)&quot;</span></span>
<span id="cb375-28"><a href="stats_method.html#cb375-28" tabindex="-1"></a>  , <span class="at">facet =</span> <span class="st">&quot;spectral_weight&quot;</span></span>
<span id="cb375-29"><a href="stats_method.html#cb375-29" tabindex="-1"></a>  , <span class="at">label_size =</span> <span class="fl">2.5</span></span>
<span id="cb375-30"><a href="stats_method.html#cb375-30" tabindex="-1"></a>  , <span class="at">x_expand =</span> <span class="fu">c</span>(<span class="fl">0.1</span>,<span class="fl">0.6</span>)</span>
<span id="cb375-31"><a href="stats_method.html#cb375-31" tabindex="-1"></a>  <span class="co"># , annotate_which = &quot;right&quot;</span></span>
<span id="cb375-32"><a href="stats_method.html#cb375-32" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb375-33"><a href="stats_method.html#cb375-33" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb375-34"><a href="stats_method.html#cb375-34" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">&quot;posterior predictive distribution of group constrasts with 95% &amp; 50% HDI</span><span class="sc">\n</span><span class="st">by `spectral_weight`&quot;</span></span>
<span id="cb375-35"><a href="stats_method.html#cb375-35" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-359-1.png" width="1008" /></p>
<p>let’s table it</p>
<div class="sourceCode" id="cb376"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb376-1"><a href="stats_method.html#cb376-1" tabindex="-1"></a>contrast_temp <span class="sc">%&gt;%</span> </span>
<span id="cb376-2"><a href="stats_method.html#cb376-2" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">distinct</span>(</span>
<span id="cb376-3"><a href="stats_method.html#cb376-3" tabindex="-1"></a>      spectral_weight, contrast</span>
<span id="cb376-4"><a href="stats_method.html#cb376-4" tabindex="-1"></a>      , median_hdi_est, median_hdi_lower, median_hdi_upper</span>
<span id="cb376-5"><a href="stats_method.html#cb376-5" tabindex="-1"></a>      , pr_gt_zero <span class="co"># , pr_lt_zero</span></span>
<span id="cb376-6"><a href="stats_method.html#cb376-6" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb376-7"><a href="stats_method.html#cb376-7" tabindex="-1"></a>    <span class="co"># format pcts</span></span>
<span id="cb376-8"><a href="stats_method.html#cb376-8" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(dplyr<span class="sc">::</span><span class="fu">across</span>(</span>
<span id="cb376-9"><a href="stats_method.html#cb376-9" tabindex="-1"></a>      tidyselect<span class="sc">::</span><span class="fu">starts_with</span>(<span class="st">&quot;median_hdi_&quot;</span>)</span>
<span id="cb376-10"><a href="stats_method.html#cb376-10" tabindex="-1"></a>      , <span class="sc">~</span> scales<span class="sc">::</span><span class="fu">percent</span>(.x, <span class="at">accuracy =</span> <span class="fl">0.1</span>)</span>
<span id="cb376-11"><a href="stats_method.html#cb376-11" tabindex="-1"></a>    )) <span class="sc">%&gt;%</span> </span>
<span id="cb376-12"><a href="stats_method.html#cb376-12" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">arrange</span>(spectral_weight, contrast) <span class="sc">%&gt;%</span> </span>
<span id="cb376-13"><a href="stats_method.html#cb376-13" tabindex="-1"></a>    kableExtra<span class="sc">::</span><span class="fu">kbl</span>(</span>
<span id="cb376-14"><a href="stats_method.html#cb376-14" tabindex="-1"></a>      <span class="at">digits =</span> <span class="dv">2</span></span>
<span id="cb376-15"><a href="stats_method.html#cb376-15" tabindex="-1"></a>      , <span class="at">caption =</span> <span class="st">&quot;brms::brm model: 95% HDI of the posterior predictive distribution of group constrasts&quot;</span></span>
<span id="cb376-16"><a href="stats_method.html#cb376-16" tabindex="-1"></a>      , <span class="at">col.names =</span> <span class="fu">c</span>(</span>
<span id="cb376-17"><a href="stats_method.html#cb376-17" tabindex="-1"></a>        <span class="st">&quot;spectral_weight&quot;</span>, <span class="st">&quot;CHM res. contrast&quot;</span></span>
<span id="cb376-18"><a href="stats_method.html#cb376-18" tabindex="-1"></a>        , <span class="st">&quot;difference (Diameter MAPE)&quot;</span></span>
<span id="cb376-19"><a href="stats_method.html#cb376-19" tabindex="-1"></a>        , <span class="st">&quot;HDI low&quot;</span>, <span class="st">&quot;HDI high&quot;</span></span>
<span id="cb376-20"><a href="stats_method.html#cb376-20" tabindex="-1"></a>        , <span class="st">&quot;Pr(diff&gt;0)&quot;</span></span>
<span id="cb376-21"><a href="stats_method.html#cb376-21" tabindex="-1"></a>      )</span>
<span id="cb376-22"><a href="stats_method.html#cb376-22" tabindex="-1"></a>      , <span class="at">escape =</span> F</span>
<span id="cb376-23"><a href="stats_method.html#cb376-23" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb376-24"><a href="stats_method.html#cb376-24" tabindex="-1"></a>    kableExtra<span class="sc">::</span><span class="fu">kable_styling</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb376-25"><a href="stats_method.html#cb376-25" tabindex="-1"></a>    kableExtra<span class="sc">::</span><span class="fu">collapse_rows</span>(<span class="at">columns =</span> <span class="dv">1</span>, <span class="at">valign =</span> <span class="st">&quot;top&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb376-26"><a href="stats_method.html#cb376-26" tabindex="-1"></a>    kableExtra<span class="sc">::</span><span class="fu">scroll_box</span>(<span class="at">height =</span> <span class="st">&quot;8in&quot;</span>)</span></code></pre></div>
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:8in; ">
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-360">Table 9.12: </span>brms::brm model: 95% HDI of the posterior predictive distribution of group constrasts
</caption>
<thead>
<tr>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
spectral_weight
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
CHM res. contrast
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
difference (Diameter MAPE)
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
HDI low
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
HDI high
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
Pr(diff&gt;0)
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="4">
spectral_weight: 0
</td>
<td style="text-align:left;">
0.2 - 0.1
</td>
<td style="text-align:left;">
7.2%
</td>
<td style="text-align:left;">
7.1%
</td>
<td style="text-align:left;">
7.3%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
0.3 - 0.1
</td>
<td style="text-align:left;">
16.0%
</td>
<td style="text-align:left;">
15.8%
</td>
<td style="text-align:left;">
16.2%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
0.4 - 0.1
</td>
<td style="text-align:left;">
25.0%
</td>
<td style="text-align:left;">
24.6%
</td>
<td style="text-align:left;">
25.3%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
0.5 - 0.1
</td>
<td style="text-align:left;">
32.1%
</td>
<td style="text-align:left;">
31.6%
</td>
<td style="text-align:left;">
32.7%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="4">
spectral_weight: 1
</td>
<td style="text-align:left;">
0.2 - 0.1
</td>
<td style="text-align:left;">
7.2%
</td>
<td style="text-align:left;">
7.1%
</td>
<td style="text-align:left;">
7.3%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
0.3 - 0.1
</td>
<td style="text-align:left;">
16.0%
</td>
<td style="text-align:left;">
15.8%
</td>
<td style="text-align:left;">
16.2%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
0.4 - 0.1
</td>
<td style="text-align:left;">
25.0%
</td>
<td style="text-align:left;">
24.7%
</td>
<td style="text-align:left;">
25.3%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
0.5 - 0.1
</td>
<td style="text-align:left;">
32.2%
</td>
<td style="text-align:left;">
31.6%
</td>
<td style="text-align:left;">
32.8%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="4">
spectral_weight: 2
</td>
<td style="text-align:left;">
0.2 - 0.1
</td>
<td style="text-align:left;">
7.2%
</td>
<td style="text-align:left;">
7.1%
</td>
<td style="text-align:left;">
7.3%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
0.3 - 0.1
</td>
<td style="text-align:left;">
16.0%
</td>
<td style="text-align:left;">
15.8%
</td>
<td style="text-align:left;">
16.2%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
0.4 - 0.1
</td>
<td style="text-align:left;">
25.0%
</td>
<td style="text-align:left;">
24.6%
</td>
<td style="text-align:left;">
25.3%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
0.5 - 0.1
</td>
<td style="text-align:left;">
32.1%
</td>
<td style="text-align:left;">
31.5%
</td>
<td style="text-align:left;">
32.6%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="4">
spectral_weight: 3
</td>
<td style="text-align:left;">
0.2 - 0.1
</td>
<td style="text-align:left;">
7.2%
</td>
<td style="text-align:left;">
7.1%
</td>
<td style="text-align:left;">
7.2%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
0.3 - 0.1
</td>
<td style="text-align:left;">
16.0%
</td>
<td style="text-align:left;">
15.8%
</td>
<td style="text-align:left;">
16.2%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
0.4 - 0.1
</td>
<td style="text-align:left;">
25.0%
</td>
<td style="text-align:left;">
24.7%
</td>
<td style="text-align:left;">
25.4%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
0.5 - 0.1
</td>
<td style="text-align:left;">
32.2%
</td>
<td style="text-align:left;">
31.6%
</td>
<td style="text-align:left;">
32.7%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="4">
spectral_weight: 4
</td>
<td style="text-align:left;">
0.2 - 0.1
</td>
<td style="text-align:left;">
7.2%
</td>
<td style="text-align:left;">
7.1%
</td>
<td style="text-align:left;">
7.3%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
0.3 - 0.1
</td>
<td style="text-align:left;">
16.0%
</td>
<td style="text-align:left;">
15.8%
</td>
<td style="text-align:left;">
16.2%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
0.4 - 0.1
</td>
<td style="text-align:left;">
25.0%
</td>
<td style="text-align:left;">
24.7%
</td>
<td style="text-align:left;">
25.4%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
0.5 - 0.1
</td>
<td style="text-align:left;">
32.2%
</td>
<td style="text-align:left;">
31.6%
</td>
<td style="text-align:left;">
32.7%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="4">
spectral_weight: 5
</td>
<td style="text-align:left;">
0.2 - 0.1
</td>
<td style="text-align:left;">
7.3%
</td>
<td style="text-align:left;">
7.3%
</td>
<td style="text-align:left;">
7.4%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
0.3 - 0.1
</td>
<td style="text-align:left;">
16.2%
</td>
<td style="text-align:left;">
16.0%
</td>
<td style="text-align:left;">
16.4%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
0.4 - 0.1
</td>
<td style="text-align:left;">
25.1%
</td>
<td style="text-align:left;">
24.8%
</td>
<td style="text-align:left;">
25.5%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
0.5 - 0.1
</td>
<td style="text-align:left;">
31.9%
</td>
<td style="text-align:left;">
31.3%
</td>
<td style="text-align:left;">
32.5%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
</tbody>
</table>
</div>
<p>it is clear from these contrasts that coarser CHM resolutions lead to a decrease in diameter quantification accuracy and the pattern and difference in accuracy between resolution levels is consistent whether or not spectral data is included and it’s weighting if included. taking the method that does not use spectral data as an example (i.e. <code>spectral_weight</code> = 0), the lowest diameter MAPE of 10.6% was achieved using a 0.1m CHM and the diameter quantification accuracy decreased (MAPE increased) steadily as CHM resolution became more coarse with a 41.8% diameter MAPE expected fore the 0.5 m resolution data. we can be certain (&gt;99% probability) that there is a significant decrease in diameter quantification accuracy (i.e. increase in MAPE) for coarser resolution CHM data compared to finer resolution data.</p>
</div>
<div id="spectral-data-1" class="section level5 hasAnchor" number="9.2.5.2.2">
<h5><span class="header-section-number">9.2.5.2.2</span> Spectral data<a href="stats_method.html#spectral-data-1" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>now we’ll look at the impact of including (or excluding) spectral data and the weighting of the <code>spectral_weight</code> parameter where a value of “0” indicates no spectral data was used (i.e. structural only), the lowest weighting of the spectral data is “1” (only one spectral index threshold must be met), and the highest weighting of spectral data is “5” (all spectral index thresholds must be met).</p>
<p><em>Note</em>:
we expect that the spectral data does not significantly alter the quantification of slash pile form. this is because spectral information is used solely to filter candidate piles, meaning it neither reshapes existing ones nor introduces new detections.</p>
<div class="sourceCode" id="cb377"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb377-1"><a href="stats_method.html#cb377-1" tabindex="-1"></a><span class="co"># viridis::rocket(5, begin = 0.9, end = 0.6) %&gt;% scales::show_col()</span></span>
<span id="cb377-2"><a href="stats_method.html#cb377-2" tabindex="-1"></a><span class="co"># brms::posterior_summary(brms_diam_mape_mod)</span></span>
<span id="cb377-3"><a href="stats_method.html#cb377-3" tabindex="-1"></a>draws_temp <span class="sc">%&gt;%</span> </span>
<span id="cb377-4"><a href="stats_method.html#cb377-4" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(</span>
<span id="cb377-5"><a href="stats_method.html#cb377-5" tabindex="-1"></a>    <span class="fu">round</span>(chm_res_m,<span class="dv">2</span>) <span class="sc">==</span> <span class="fu">round</span>(chm_res_m,<span class="dv">1</span>) <span class="co"># let&#39;s just look at every 0.1 m (10 cm)</span></span>
<span id="cb377-6"><a href="stats_method.html#cb377-6" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb377-7"><a href="stats_method.html#cb377-7" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> spectral_weight, <span class="at">y =</span> value, <span class="at">color =</span> <span class="fu">factor</span>(chm_res_m))) <span class="sc">+</span></span>
<span id="cb377-8"><a href="stats_method.html#cb377-8" tabindex="-1"></a>  <span class="co"># tidybayes::stat_halfeye() +</span></span>
<span id="cb377-9"><a href="stats_method.html#cb377-9" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">stat_lineribbon</span>(<span class="at">point_interval =</span> <span class="st">&quot;median_hdi&quot;</span>, <span class="at">.width =</span> <span class="fu">c</span>(<span class="fl">0.95</span>)) <span class="sc">+</span></span>
<span id="cb377-10"><a href="stats_method.html#cb377-10" tabindex="-1"></a>  <span class="co"># ggplot2::facet_wrap(facets = dplyr::vars(spectral_weight))</span></span>
<span id="cb377-11"><a href="stats_method.html#cb377-11" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_fill_brewer</span>(<span class="at">palette =</span> <span class="st">&quot;Greys&quot;</span>) <span class="sc">+</span></span>
<span id="cb377-12"><a href="stats_method.html#cb377-12" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_color_viridis_d</span>(<span class="at">option =</span> <span class="st">&quot;rocket&quot;</span>, <span class="at">begin =</span> <span class="fl">0.9</span>, <span class="at">end =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb377-13"><a href="stats_method.html#cb377-13" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>percent) <span class="sc">+</span></span>
<span id="cb377-14"><a href="stats_method.html#cb377-14" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;`spectral_weight`&quot;</span>, <span class="at">color =</span> <span class="st">&quot;CHM resolution&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Diameter MAPE&quot;</span>) <span class="sc">+</span></span>
<span id="cb377-15"><a href="stats_method.html#cb377-15" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb377-16"><a href="stats_method.html#cb377-16" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb377-17"><a href="stats_method.html#cb377-17" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;top&quot;</span></span>
<span id="cb377-18"><a href="stats_method.html#cb377-18" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb377-19"><a href="stats_method.html#cb377-19" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">guides</span>(</span>
<span id="cb377-20"><a href="stats_method.html#cb377-20" tabindex="-1"></a>    <span class="at">color =</span> ggplot2<span class="sc">::</span><span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">shape =</span> <span class="dv">15</span>, <span class="at">lwd =</span> <span class="dv">8</span>, <span class="at">fill =</span> <span class="cn">NA</span>))</span>
<span id="cb377-21"><a href="stats_method.html#cb377-21" tabindex="-1"></a>    , <span class="at">fill =</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb377-22"><a href="stats_method.html#cb377-22" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-361-1.png" width="1008" /></p>
<p>while there is a slight decrease in diameter quantification accuracy (increase in MAPE) at the highest spectral weighting, the inclusion of spectral data and the setting of the <code>spectral_weight</code> parameter does not significantly alter the form quantification accuracy irrespective of the CHM resolution</p>
<p>we can look at the posterior distributions of the expected Diameter MAPE at different <code>spectral_weight</code> settings by the input CHM resolution</p>
<div class="sourceCode" id="cb378"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb378-1"><a href="stats_method.html#cb378-1" tabindex="-1"></a>draws_temp <span class="sc">%&gt;%</span> </span>
<span id="cb378-2"><a href="stats_method.html#cb378-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(</span>
<span id="cb378-3"><a href="stats_method.html#cb378-3" tabindex="-1"></a>    <span class="fu">round</span>(chm_res_m,<span class="dv">2</span>) <span class="sc">==</span> <span class="fu">round</span>(chm_res_m,<span class="dv">1</span>) <span class="co"># let&#39;s just look at every 0.1 m (10 cm)</span></span>
<span id="cb378-4"><a href="stats_method.html#cb378-4" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb378-5"><a href="stats_method.html#cb378-5" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">chm_res_m =</span> chm_res_m <span class="sc">%&gt;%</span> <span class="fu">factor</span>() <span class="sc">%&gt;%</span> forcats<span class="sc">::</span><span class="fu">fct_relabel</span>(<span class="sc">~</span><span class="fu">paste0</span>(<span class="st">&quot;CHM resolution: &quot;</span>, .x, <span class="at">recycle0 =</span> T))) <span class="sc">%&gt;%</span> </span>
<span id="cb378-6"><a href="stats_method.html#cb378-6" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">y=</span>value, <span class="at">x=</span>spectral_weight)) <span class="sc">+</span></span>
<span id="cb378-7"><a href="stats_method.html#cb378-7" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">stat_eye</span>(</span>
<span id="cb378-8"><a href="stats_method.html#cb378-8" tabindex="-1"></a>    <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">fill =</span> chm_res_m)</span>
<span id="cb378-9"><a href="stats_method.html#cb378-9" tabindex="-1"></a>    , <span class="at">point_interval =</span> median_hdi, <span class="at">.width =</span> .<span class="dv">95</span></span>
<span id="cb378-10"><a href="stats_method.html#cb378-10" tabindex="-1"></a>    , <span class="at">slab_alpha =</span> <span class="fl">0.95</span></span>
<span id="cb378-11"><a href="stats_method.html#cb378-11" tabindex="-1"></a>    , <span class="at">interval_color =</span> <span class="st">&quot;gray44&quot;</span>, <span class="at">linewidth =</span> <span class="dv">1</span></span>
<span id="cb378-12"><a href="stats_method.html#cb378-12" tabindex="-1"></a>    , <span class="at">point_color =</span> <span class="st">&quot;gray44&quot;</span>, <span class="at">point_fill =</span> <span class="st">&quot;gray44&quot;</span>, <span class="at">point_size =</span> <span class="dv">1</span></span>
<span id="cb378-13"><a href="stats_method.html#cb378-13" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb378-14"><a href="stats_method.html#cb378-14" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">facet_grid</span>(<span class="at">cols =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(chm_res_m)) <span class="sc">+</span></span>
<span id="cb378-15"><a href="stats_method.html#cb378-15" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_fill_viridis_d</span>(<span class="at">option =</span> <span class="st">&quot;rocket&quot;</span>, <span class="at">begin =</span> <span class="fl">0.9</span>, <span class="at">end =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb378-16"><a href="stats_method.html#cb378-16" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="cn">NA</span>), <span class="at">labels =</span> scales<span class="sc">::</span>percent, <span class="at">breaks =</span> scales<span class="sc">::</span><span class="fu">breaks_extended</span>(<span class="dv">16</span>)) <span class="sc">+</span></span>
<span id="cb378-17"><a href="stats_method.html#cb378-17" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;`spectral_weight`&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Diameter MAPE&quot;</span>) <span class="sc">+</span></span>
<span id="cb378-18"><a href="stats_method.html#cb378-18" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb378-19"><a href="stats_method.html#cb378-19" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb378-20"><a href="stats_method.html#cb378-20" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb378-21"><a href="stats_method.html#cb378-21" tabindex="-1"></a>    , <span class="at">strip.text =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb378-22"><a href="stats_method.html#cb378-22" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-362-1.png" width="1008" /></p>
<p>we already saw this same data above in our CHM resolution testing, but we’ll table that again but this time grouping by CHM resolution</p>
<div class="sourceCode" id="cb379"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb379-1"><a href="stats_method.html#cb379-1" tabindex="-1"></a>draws_temp <span class="sc">%&gt;%</span> </span>
<span id="cb379-2"><a href="stats_method.html#cb379-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(</span>
<span id="cb379-3"><a href="stats_method.html#cb379-3" tabindex="-1"></a>    <span class="fu">round</span>(chm_res_m,<span class="dv">2</span>) <span class="sc">==</span> <span class="fu">round</span>(chm_res_m,<span class="dv">1</span>) <span class="co"># let&#39;s just look at every 0.1 m (10 cm)</span></span>
<span id="cb379-4"><a href="stats_method.html#cb379-4" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb379-5"><a href="stats_method.html#cb379-5" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">chm_res_m =</span> chm_res_m <span class="sc">%&gt;%</span> <span class="fu">factor</span>() <span class="sc">%&gt;%</span> forcats<span class="sc">::</span><span class="fu">fct_relabel</span>(<span class="sc">~</span><span class="fu">paste0</span>(<span class="st">&quot;CHM resolution: &quot;</span>, .x, <span class="at">recycle0 =</span> T))) <span class="sc">%&gt;%</span> </span>
<span id="cb379-6"><a href="stats_method.html#cb379-6" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(chm_res_m, spectral_weight) <span class="sc">%&gt;%</span></span>
<span id="cb379-7"><a href="stats_method.html#cb379-7" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(</span>
<span id="cb379-8"><a href="stats_method.html#cb379-8" tabindex="-1"></a>    <span class="co"># get median_hdi</span></span>
<span id="cb379-9"><a href="stats_method.html#cb379-9" tabindex="-1"></a>    <span class="at">median_hdi_est =</span> tidybayes<span class="sc">::</span><span class="fu">median_hdci</span>(value)<span class="sc">$</span>y</span>
<span id="cb379-10"><a href="stats_method.html#cb379-10" tabindex="-1"></a>    , <span class="at">median_hdi_lower =</span> tidybayes<span class="sc">::</span><span class="fu">median_hdci</span>(value)<span class="sc">$</span>ymin</span>
<span id="cb379-11"><a href="stats_method.html#cb379-11" tabindex="-1"></a>    , <span class="at">median_hdi_upper =</span> tidybayes<span class="sc">::</span><span class="fu">median_hdci</span>(value)<span class="sc">$</span>ymax</span>
<span id="cb379-12"><a href="stats_method.html#cb379-12" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb379-13"><a href="stats_method.html#cb379-13" tabindex="-1"></a>  <span class="co"># format pcts</span></span>
<span id="cb379-14"><a href="stats_method.html#cb379-14" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(dplyr<span class="sc">::</span><span class="fu">across</span>(</span>
<span id="cb379-15"><a href="stats_method.html#cb379-15" tabindex="-1"></a>    tidyselect<span class="sc">::</span><span class="fu">starts_with</span>(<span class="st">&quot;median_hdi_&quot;</span>)</span>
<span id="cb379-16"><a href="stats_method.html#cb379-16" tabindex="-1"></a>    , <span class="sc">~</span> scales<span class="sc">::</span><span class="fu">percent</span>(.x, <span class="at">accuracy =</span> <span class="fl">0.1</span>)</span>
<span id="cb379-17"><a href="stats_method.html#cb379-17" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb379-18"><a href="stats_method.html#cb379-18" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb379-19"><a href="stats_method.html#cb379-19" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(chm_res_m,spectral_weight) <span class="sc">%&gt;%</span> </span>
<span id="cb379-20"><a href="stats_method.html#cb379-20" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kbl</span>(</span>
<span id="cb379-21"><a href="stats_method.html#cb379-21" tabindex="-1"></a>    <span class="at">digits =</span> <span class="dv">2</span></span>
<span id="cb379-22"><a href="stats_method.html#cb379-22" tabindex="-1"></a>    , <span class="at">caption =</span> <span class="st">&quot;Diameter MAPE&lt;br&gt;95% HDI of the posterior predictive distribution&quot;</span></span>
<span id="cb379-23"><a href="stats_method.html#cb379-23" tabindex="-1"></a>    , <span class="at">col.names =</span> <span class="fu">c</span>(</span>
<span id="cb379-24"><a href="stats_method.html#cb379-24" tabindex="-1"></a>      <span class="st">&quot;CHM resolution&quot;</span>, <span class="st">&quot;spectral_weight&quot;</span></span>
<span id="cb379-25"><a href="stats_method.html#cb379-25" tabindex="-1"></a>      , <span class="fu">c</span>(<span class="st">&quot;Diameter MAPE&lt;br&gt;median&quot;</span>, <span class="st">&quot;HDI low&quot;</span>, <span class="st">&quot;HDI high&quot;</span>)</span>
<span id="cb379-26"><a href="stats_method.html#cb379-26" tabindex="-1"></a>    )</span>
<span id="cb379-27"><a href="stats_method.html#cb379-27" tabindex="-1"></a>    , <span class="at">escape =</span> F</span>
<span id="cb379-28"><a href="stats_method.html#cb379-28" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb379-29"><a href="stats_method.html#cb379-29" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kable_styling</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb379-30"><a href="stats_method.html#cb379-30" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">collapse_rows</span>(<span class="at">columns =</span> <span class="dv">1</span>, <span class="at">valign =</span> <span class="st">&quot;top&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb379-31"><a href="stats_method.html#cb379-31" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">scroll_box</span>(<span class="at">height =</span> <span class="st">&quot;8in&quot;</span>)</span></code></pre></div>
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:8in; ">
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-363">Table 9.13: </span>Diameter MAPE<br>95% HDI of the posterior predictive distribution
</caption>
<thead>
<tr>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
CHM resolution
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
spectral_weight
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
Diameter MAPE<br>median
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
HDI low
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
HDI high
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="6">
CHM resolution: 0.1
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
10.9%
</td>
<td style="text-align:left;">
10.8%
</td>
<td style="text-align:left;">
11.1%
</td>
</tr>
<tr>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
10.9%
</td>
<td style="text-align:left;">
10.8%
</td>
<td style="text-align:left;">
11.1%
</td>
</tr>
<tr>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
10.9%
</td>
<td style="text-align:left;">
10.8%
</td>
<td style="text-align:left;">
11.1%
</td>
</tr>
<tr>
<td style="text-align:left;">
3
</td>
<td style="text-align:left;">
10.9%
</td>
<td style="text-align:left;">
10.8%
</td>
<td style="text-align:left;">
11.1%
</td>
</tr>
<tr>
<td style="text-align:left;">
4
</td>
<td style="text-align:left;">
10.9%
</td>
<td style="text-align:left;">
10.8%
</td>
<td style="text-align:left;">
11.1%
</td>
</tr>
<tr>
<td style="text-align:left;">
5
</td>
<td style="text-align:left;">
11.5%
</td>
<td style="text-align:left;">
11.4%
</td>
<td style="text-align:left;">
11.7%
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="6">
CHM resolution: 0.2
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
18.1%
</td>
<td style="text-align:left;">
17.9%
</td>
<td style="text-align:left;">
18.3%
</td>
</tr>
<tr>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
18.1%
</td>
<td style="text-align:left;">
17.9%
</td>
<td style="text-align:left;">
18.3%
</td>
</tr>
<tr>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
18.1%
</td>
<td style="text-align:left;">
17.9%
</td>
<td style="text-align:left;">
18.3%
</td>
</tr>
<tr>
<td style="text-align:left;">
3
</td>
<td style="text-align:left;">
18.1%
</td>
<td style="text-align:left;">
17.9%
</td>
<td style="text-align:left;">
18.3%
</td>
</tr>
<tr>
<td style="text-align:left;">
4
</td>
<td style="text-align:left;">
18.1%
</td>
<td style="text-align:left;">
17.9%
</td>
<td style="text-align:left;">
18.3%
</td>
</tr>
<tr>
<td style="text-align:left;">
5
</td>
<td style="text-align:left;">
18.9%
</td>
<td style="text-align:left;">
18.7%
</td>
<td style="text-align:left;">
19.0%
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="6">
CHM resolution: 0.3
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
26.9%
</td>
<td style="text-align:left;">
26.7%
</td>
<td style="text-align:left;">
27.1%
</td>
</tr>
<tr>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
26.9%
</td>
<td style="text-align:left;">
26.7%
</td>
<td style="text-align:left;">
27.1%
</td>
</tr>
<tr>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
26.9%
</td>
<td style="text-align:left;">
26.7%
</td>
<td style="text-align:left;">
27.1%
</td>
</tr>
<tr>
<td style="text-align:left;">
3
</td>
<td style="text-align:left;">
26.9%
</td>
<td style="text-align:left;">
26.7%
</td>
<td style="text-align:left;">
27.2%
</td>
</tr>
<tr>
<td style="text-align:left;">
4
</td>
<td style="text-align:left;">
26.9%
</td>
<td style="text-align:left;">
26.7%
</td>
<td style="text-align:left;">
27.1%
</td>
</tr>
<tr>
<td style="text-align:left;">
5
</td>
<td style="text-align:left;">
27.8%
</td>
<td style="text-align:left;">
27.5%
</td>
<td style="text-align:left;">
28.0%
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="6">
CHM resolution: 0.4
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
35.9%
</td>
<td style="text-align:left;">
35.6%
</td>
<td style="text-align:left;">
36.2%
</td>
</tr>
<tr>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
35.9%
</td>
<td style="text-align:left;">
35.6%
</td>
<td style="text-align:left;">
36.2%
</td>
</tr>
<tr>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
35.9%
</td>
<td style="text-align:left;">
35.6%
</td>
<td style="text-align:left;">
36.2%
</td>
</tr>
<tr>
<td style="text-align:left;">
3
</td>
<td style="text-align:left;">
35.9%
</td>
<td style="text-align:left;">
35.6%
</td>
<td style="text-align:left;">
36.3%
</td>
</tr>
<tr>
<td style="text-align:left;">
4
</td>
<td style="text-align:left;">
35.9%
</td>
<td style="text-align:left;">
35.6%
</td>
<td style="text-align:left;">
36.3%
</td>
</tr>
<tr>
<td style="text-align:left;">
5
</td>
<td style="text-align:left;">
36.6%
</td>
<td style="text-align:left;">
36.3%
</td>
<td style="text-align:left;">
37.0%
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="6">
CHM resolution: 0.5
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
43.1%
</td>
<td style="text-align:left;">
42.6%
</td>
<td style="text-align:left;">
43.6%
</td>
</tr>
<tr>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
43.1%
</td>
<td style="text-align:left;">
42.6%
</td>
<td style="text-align:left;">
43.6%
</td>
</tr>
<tr>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
43.1%
</td>
<td style="text-align:left;">
42.5%
</td>
<td style="text-align:left;">
43.6%
</td>
</tr>
<tr>
<td style="text-align:left;">
3
</td>
<td style="text-align:left;">
43.1%
</td>
<td style="text-align:left;">
42.6%
</td>
<td style="text-align:left;">
43.6%
</td>
</tr>
<tr>
<td style="text-align:left;">
4
</td>
<td style="text-align:left;">
43.1%
</td>
<td style="text-align:left;">
42.5%
</td>
<td style="text-align:left;">
43.6%
</td>
</tr>
<tr>
<td style="text-align:left;">
5
</td>
<td style="text-align:left;">
43.4%
</td>
<td style="text-align:left;">
42.9%
</td>
<td style="text-align:left;">
44.0%
</td>
</tr>
</tbody>
</table>
</div>
<p>now we’ll probabilistically test the hypothesis that the inclusion of spectral data improves detection accuracy and quantify by how much. we’ll look at the influence of spectral data based on the CHM resolution</p>
<p>to actually compare the different levels of <code>spectral_weight</code>, we’ll use the MCMC draws to contrast the posterior predictions at different levels of the parameter (see below)</p>
<div class="sourceCode" id="cb380"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb380-1"><a href="stats_method.html#cb380-1" tabindex="-1"></a>contrast_temp <span class="ot">&lt;-</span> </span>
<span id="cb380-2"><a href="stats_method.html#cb380-2" tabindex="-1"></a>  draws_temp <span class="sc">%&gt;%</span> </span>
<span id="cb380-3"><a href="stats_method.html#cb380-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(</span>
<span id="cb380-4"><a href="stats_method.html#cb380-4" tabindex="-1"></a>    <span class="fu">round</span>(chm_res_m,<span class="dv">2</span>) <span class="sc">==</span> <span class="fu">round</span>(chm_res_m,<span class="dv">1</span>) <span class="co"># let&#39;s just look at every 0.1 m (10 cm)</span></span>
<span id="cb380-5"><a href="stats_method.html#cb380-5" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb380-6"><a href="stats_method.html#cb380-6" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(chm_res_m) <span class="sc">%&gt;%</span> </span>
<span id="cb380-7"><a href="stats_method.html#cb380-7" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">compare_levels</span>(</span>
<span id="cb380-8"><a href="stats_method.html#cb380-8" tabindex="-1"></a>    value</span>
<span id="cb380-9"><a href="stats_method.html#cb380-9" tabindex="-1"></a>    , <span class="at">by =</span> spectral_weight</span>
<span id="cb380-10"><a href="stats_method.html#cb380-10" tabindex="-1"></a>    , <span class="at">comparison =</span> </span>
<span id="cb380-11"><a href="stats_method.html#cb380-11" tabindex="-1"></a>      <span class="co"># tidybayes::emmeans_comparison(&quot;revpairwise&quot;) </span></span>
<span id="cb380-12"><a href="stats_method.html#cb380-12" tabindex="-1"></a>      <span class="st">&quot;pairwise&quot;</span></span>
<span id="cb380-13"><a href="stats_method.html#cb380-13" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb380-14"><a href="stats_method.html#cb380-14" tabindex="-1"></a>  <span class="co"># dplyr::glimpse()</span></span>
<span id="cb380-15"><a href="stats_method.html#cb380-15" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">contrast =</span> spectral_weight) <span class="sc">%&gt;%</span> </span>
<span id="cb380-16"><a href="stats_method.html#cb380-16" tabindex="-1"></a>  <span class="co"># group the data before calculating contrast variables %&gt;% </span></span>
<span id="cb380-17"><a href="stats_method.html#cb380-17" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(chm_res_m, contrast) <span class="sc">%&gt;%</span> </span>
<span id="cb380-18"><a href="stats_method.html#cb380-18" tabindex="-1"></a>  <span class="fu">make_contrast_vars</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb380-19"><a href="stats_method.html#cb380-19" tabindex="-1"></a>  <span class="co"># relabel the label for the facets</span></span>
<span id="cb380-20"><a href="stats_method.html#cb380-20" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">chm_res_m =</span> chm_res_m <span class="sc">%&gt;%</span> <span class="fu">factor</span>() <span class="sc">%&gt;%</span> forcats<span class="sc">::</span><span class="fu">fct_relabel</span>(<span class="sc">~</span><span class="fu">paste0</span>(<span class="st">&quot;CHM resolution: &quot;</span>, .x, <span class="at">recycle0 =</span> T)))</span>
<span id="cb380-21"><a href="stats_method.html#cb380-21" tabindex="-1"></a><span class="co"># huh?</span></span>
<span id="cb380-22"><a href="stats_method.html#cb380-22" tabindex="-1"></a><span class="co"># contrast_temp %&gt;% dplyr::glimpse()</span></span>
<span id="cb380-23"><a href="stats_method.html#cb380-23" tabindex="-1"></a></span>
<span id="cb380-24"><a href="stats_method.html#cb380-24" tabindex="-1"></a><span class="co"># plot it</span></span>
<span id="cb380-25"><a href="stats_method.html#cb380-25" tabindex="-1"></a><span class="fu">plt_contrast</span>(</span>
<span id="cb380-26"><a href="stats_method.html#cb380-26" tabindex="-1"></a>  contrast_temp</span>
<span id="cb380-27"><a href="stats_method.html#cb380-27" tabindex="-1"></a>  <span class="co"># , caption_text = form_temp</span></span>
<span id="cb380-28"><a href="stats_method.html#cb380-28" tabindex="-1"></a>  , <span class="at">y_axis_title =</span> <span class="st">&quot;`spectral_weight` contrast&quot;</span></span>
<span id="cb380-29"><a href="stats_method.html#cb380-29" tabindex="-1"></a>  , <span class="at">x_axis_title =</span> <span class="st">&quot;difference (Diameter MAPE)&quot;</span></span>
<span id="cb380-30"><a href="stats_method.html#cb380-30" tabindex="-1"></a>  , <span class="at">facet =</span> <span class="st">&quot;chm_res_m&quot;</span></span>
<span id="cb380-31"><a href="stats_method.html#cb380-31" tabindex="-1"></a>  , <span class="at">label_size =</span> <span class="dv">2</span></span>
<span id="cb380-32"><a href="stats_method.html#cb380-32" tabindex="-1"></a>  , <span class="at">x_expand =</span> <span class="fu">c</span>(<span class="fl">0.5</span>,<span class="fl">0.5</span>)</span>
<span id="cb380-33"><a href="stats_method.html#cb380-33" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb380-34"><a href="stats_method.html#cb380-34" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb380-35"><a href="stats_method.html#cb380-35" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">&quot;posterior predictive distribution of group constrasts with 95% &amp; 50% HDI</span><span class="sc">\n</span><span class="st">by `chm_res_m`&quot;</span></span>
<span id="cb380-36"><a href="stats_method.html#cb380-36" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-364-1.png" width="1008" /></p>
<p>let’s table it</p>
<div class="sourceCode" id="cb381"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb381-1"><a href="stats_method.html#cb381-1" tabindex="-1"></a>contrast_temp <span class="sc">%&gt;%</span> </span>
<span id="cb381-2"><a href="stats_method.html#cb381-2" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">distinct</span>(</span>
<span id="cb381-3"><a href="stats_method.html#cb381-3" tabindex="-1"></a>      chm_res_m, contrast</span>
<span id="cb381-4"><a href="stats_method.html#cb381-4" tabindex="-1"></a>      , median_hdi_est, median_hdi_lower, median_hdi_upper</span>
<span id="cb381-5"><a href="stats_method.html#cb381-5" tabindex="-1"></a>      <span class="co"># , pr_lt_zero </span></span>
<span id="cb381-6"><a href="stats_method.html#cb381-6" tabindex="-1"></a>      , pr_gt_zero</span>
<span id="cb381-7"><a href="stats_method.html#cb381-7" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb381-8"><a href="stats_method.html#cb381-8" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">arrange</span>(chm_res_m, contrast) <span class="sc">%&gt;%</span> </span>
<span id="cb381-9"><a href="stats_method.html#cb381-9" tabindex="-1"></a>    <span class="co"># format pcts</span></span>
<span id="cb381-10"><a href="stats_method.html#cb381-10" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(dplyr<span class="sc">::</span><span class="fu">across</span>(</span>
<span id="cb381-11"><a href="stats_method.html#cb381-11" tabindex="-1"></a>      tidyselect<span class="sc">::</span><span class="fu">starts_with</span>(<span class="st">&quot;median_hdi_&quot;</span>)</span>
<span id="cb381-12"><a href="stats_method.html#cb381-12" tabindex="-1"></a>      , <span class="sc">~</span> scales<span class="sc">::</span><span class="fu">percent</span>(.x, <span class="at">accuracy =</span> <span class="fl">0.1</span>)</span>
<span id="cb381-13"><a href="stats_method.html#cb381-13" tabindex="-1"></a>    )) <span class="sc">%&gt;%</span> </span>
<span id="cb381-14"><a href="stats_method.html#cb381-14" tabindex="-1"></a>    kableExtra<span class="sc">::</span><span class="fu">kbl</span>(</span>
<span id="cb381-15"><a href="stats_method.html#cb381-15" tabindex="-1"></a>      <span class="at">digits =</span> <span class="dv">2</span></span>
<span id="cb381-16"><a href="stats_method.html#cb381-16" tabindex="-1"></a>      , <span class="at">caption =</span> <span class="st">&quot;brms::brm model: 95% HDI of the posterior predictive distribution of group constrasts&quot;</span></span>
<span id="cb381-17"><a href="stats_method.html#cb381-17" tabindex="-1"></a>      , <span class="at">col.names =</span> <span class="fu">c</span>(</span>
<span id="cb381-18"><a href="stats_method.html#cb381-18" tabindex="-1"></a>        <span class="st">&quot;CHM resolution&quot;</span>, <span class="st">&quot;spectral_weight&quot;</span></span>
<span id="cb381-19"><a href="stats_method.html#cb381-19" tabindex="-1"></a>        , <span class="st">&quot;difference (Diameter MAPE)&quot;</span></span>
<span id="cb381-20"><a href="stats_method.html#cb381-20" tabindex="-1"></a>        , <span class="st">&quot;HDI low&quot;</span>, <span class="st">&quot;HDI high&quot;</span></span>
<span id="cb381-21"><a href="stats_method.html#cb381-21" tabindex="-1"></a>        <span class="co"># , &quot;Pr(diff&lt;0)&quot;</span></span>
<span id="cb381-22"><a href="stats_method.html#cb381-22" tabindex="-1"></a>        , <span class="st">&quot;Pr(diff&gt;0)&quot;</span></span>
<span id="cb381-23"><a href="stats_method.html#cb381-23" tabindex="-1"></a>      )</span>
<span id="cb381-24"><a href="stats_method.html#cb381-24" tabindex="-1"></a>      , <span class="at">escape =</span> F</span>
<span id="cb381-25"><a href="stats_method.html#cb381-25" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb381-26"><a href="stats_method.html#cb381-26" tabindex="-1"></a>    kableExtra<span class="sc">::</span><span class="fu">kable_styling</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb381-27"><a href="stats_method.html#cb381-27" tabindex="-1"></a>    kableExtra<span class="sc">::</span><span class="fu">collapse_rows</span>(<span class="at">columns =</span> <span class="dv">1</span>, <span class="at">valign =</span> <span class="st">&quot;top&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb381-28"><a href="stats_method.html#cb381-28" tabindex="-1"></a>    kableExtra<span class="sc">::</span><span class="fu">scroll_box</span>(<span class="at">height =</span> <span class="st">&quot;8in&quot;</span>)</span></code></pre></div>
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:8in; ">
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-365">Table 9.14: </span>brms::brm model: 95% HDI of the posterior predictive distribution of group constrasts
</caption>
<thead>
<tr>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
CHM resolution
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
spectral_weight
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
difference (Diameter MAPE)
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
HDI low
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
HDI high
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
Pr(diff&gt;0)
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="15">
CHM resolution: 0.1
</td>
<td style="text-align:left;">
1 - 0
</td>
<td style="text-align:left;">
0.0%
</td>
<td style="text-align:left;">
-0.2%
</td>
<td style="text-align:left;">
0.2%
</td>
<td style="text-align:left;">
47%
</td>
</tr>
<tr>
<td style="text-align:left;">
2 - 0
</td>
<td style="text-align:left;">
0.0%
</td>
<td style="text-align:left;">
-0.2%
</td>
<td style="text-align:left;">
0.2%
</td>
<td style="text-align:left;">
50%
</td>
</tr>
<tr>
<td style="text-align:left;">
2 - 1
</td>
<td style="text-align:left;">
0.0%
</td>
<td style="text-align:left;">
-0.2%
</td>
<td style="text-align:left;">
0.2%
</td>
<td style="text-align:left;">
53%
</td>
</tr>
<tr>
<td style="text-align:left;">
3 - 0
</td>
<td style="text-align:left;">
0.0%
</td>
<td style="text-align:left;">
-0.2%
</td>
<td style="text-align:left;">
0.2%
</td>
<td style="text-align:left;">
49%
</td>
</tr>
<tr>
<td style="text-align:left;">
3 - 1
</td>
<td style="text-align:left;">
0.0%
</td>
<td style="text-align:left;">
-0.2%
</td>
<td style="text-align:left;">
0.2%
</td>
<td style="text-align:left;">
50%
</td>
</tr>
<tr>
<td style="text-align:left;">
3 - 2
</td>
<td style="text-align:left;">
0.0%
</td>
<td style="text-align:left;">
-0.2%
</td>
<td style="text-align:left;">
0.2%
</td>
<td style="text-align:left;">
50%
</td>
</tr>
<tr>
<td style="text-align:left;">
4 - 0
</td>
<td style="text-align:left;">
0.0%
</td>
<td style="text-align:left;">
-0.2%
</td>
<td style="text-align:left;">
0.2%
</td>
<td style="text-align:left;">
48%
</td>
</tr>
<tr>
<td style="text-align:left;">
4 - 1
</td>
<td style="text-align:left;">
0.0%
</td>
<td style="text-align:left;">
-0.2%
</td>
<td style="text-align:left;">
0.2%
</td>
<td style="text-align:left;">
51%
</td>
</tr>
<tr>
<td style="text-align:left;">
4 - 2
</td>
<td style="text-align:left;">
0.0%
</td>
<td style="text-align:left;">
-0.2%
</td>
<td style="text-align:left;">
0.2%
</td>
<td style="text-align:left;">
50%
</td>
</tr>
<tr>
<td style="text-align:left;">
4 - 3
</td>
<td style="text-align:left;">
0.0%
</td>
<td style="text-align:left;">
-0.2%
</td>
<td style="text-align:left;">
0.2%
</td>
<td style="text-align:left;">
51%
</td>
</tr>
<tr>
<td style="text-align:left;">
5 - 0
</td>
<td style="text-align:left;">
0.6%
</td>
<td style="text-align:left;">
0.4%
</td>
<td style="text-align:left;">
0.8%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
5 - 1
</td>
<td style="text-align:left;">
0.6%
</td>
<td style="text-align:left;">
0.4%
</td>
<td style="text-align:left;">
0.8%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
5 - 2
</td>
<td style="text-align:left;">
0.6%
</td>
<td style="text-align:left;">
0.4%
</td>
<td style="text-align:left;">
0.8%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
5 - 3
</td>
<td style="text-align:left;">
0.6%
</td>
<td style="text-align:left;">
0.4%
</td>
<td style="text-align:left;">
0.8%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
5 - 4
</td>
<td style="text-align:left;">
0.6%
</td>
<td style="text-align:left;">
0.4%
</td>
<td style="text-align:left;">
0.8%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="15">
CHM resolution: 0.2
</td>
<td style="text-align:left;">
1 - 0
</td>
<td style="text-align:left;">
0.0%
</td>
<td style="text-align:left;">
-0.2%
</td>
<td style="text-align:left;">
0.2%
</td>
<td style="text-align:left;">
48%
</td>
</tr>
<tr>
<td style="text-align:left;">
2 - 0
</td>
<td style="text-align:left;">
0.0%
</td>
<td style="text-align:left;">
-0.2%
</td>
<td style="text-align:left;">
0.2%
</td>
<td style="text-align:left;">
48%
</td>
</tr>
<tr>
<td style="text-align:left;">
2 - 1
</td>
<td style="text-align:left;">
0.0%
</td>
<td style="text-align:left;">
-0.2%
</td>
<td style="text-align:left;">
0.2%
</td>
<td style="text-align:left;">
53%
</td>
</tr>
<tr>
<td style="text-align:left;">
3 - 0
</td>
<td style="text-align:left;">
0.0%
</td>
<td style="text-align:left;">
-0.2%
</td>
<td style="text-align:left;">
0.2%
</td>
<td style="text-align:left;">
49%
</td>
</tr>
<tr>
<td style="text-align:left;">
3 - 1
</td>
<td style="text-align:left;">
0.0%
</td>
<td style="text-align:left;">
-0.2%
</td>
<td style="text-align:left;">
0.2%
</td>
<td style="text-align:left;">
49%
</td>
</tr>
<tr>
<td style="text-align:left;">
3 - 2
</td>
<td style="text-align:left;">
0.0%
</td>
<td style="text-align:left;">
-0.2%
</td>
<td style="text-align:left;">
0.2%
</td>
<td style="text-align:left;">
51%
</td>
</tr>
<tr>
<td style="text-align:left;">
4 - 0
</td>
<td style="text-align:left;">
0.0%
</td>
<td style="text-align:left;">
-0.2%
</td>
<td style="text-align:left;">
0.2%
</td>
<td style="text-align:left;">
50%
</td>
</tr>
<tr>
<td style="text-align:left;">
4 - 1
</td>
<td style="text-align:left;">
0.0%
</td>
<td style="text-align:left;">
-0.2%
</td>
<td style="text-align:left;">
0.2%
</td>
<td style="text-align:left;">
50%
</td>
</tr>
<tr>
<td style="text-align:left;">
4 - 2
</td>
<td style="text-align:left;">
0.0%
</td>
<td style="text-align:left;">
-0.2%
</td>
<td style="text-align:left;">
0.2%
</td>
<td style="text-align:left;">
49%
</td>
</tr>
<tr>
<td style="text-align:left;">
4 - 3
</td>
<td style="text-align:left;">
0.0%
</td>
<td style="text-align:left;">
-0.2%
</td>
<td style="text-align:left;">
0.2%
</td>
<td style="text-align:left;">
51%
</td>
</tr>
<tr>
<td style="text-align:left;">
5 - 0
</td>
<td style="text-align:left;">
0.8%
</td>
<td style="text-align:left;">
0.6%
</td>
<td style="text-align:left;">
1.0%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
5 - 1
</td>
<td style="text-align:left;">
0.8%
</td>
<td style="text-align:left;">
0.6%
</td>
<td style="text-align:left;">
1.0%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
5 - 2
</td>
<td style="text-align:left;">
0.8%
</td>
<td style="text-align:left;">
0.6%
</td>
<td style="text-align:left;">
1.0%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
5 - 3
</td>
<td style="text-align:left;">
0.8%
</td>
<td style="text-align:left;">
0.6%
</td>
<td style="text-align:left;">
1.0%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
5 - 4
</td>
<td style="text-align:left;">
0.8%
</td>
<td style="text-align:left;">
0.6%
</td>
<td style="text-align:left;">
1.0%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="15">
CHM resolution: 0.3
</td>
<td style="text-align:left;">
1 - 0
</td>
<td style="text-align:left;">
0.0%
</td>
<td style="text-align:left;">
-0.2%
</td>
<td style="text-align:left;">
0.3%
</td>
<td style="text-align:left;">
49%
</td>
</tr>
<tr>
<td style="text-align:left;">
2 - 0
</td>
<td style="text-align:left;">
0.0%
</td>
<td style="text-align:left;">
-0.2%
</td>
<td style="text-align:left;">
0.3%
</td>
<td style="text-align:left;">
47%
</td>
</tr>
<tr>
<td style="text-align:left;">
2 - 1
</td>
<td style="text-align:left;">
0.0%
</td>
<td style="text-align:left;">
-0.2%
</td>
<td style="text-align:left;">
0.2%
</td>
<td style="text-align:left;">
50%
</td>
</tr>
<tr>
<td style="text-align:left;">
3 - 0
</td>
<td style="text-align:left;">
0.0%
</td>
<td style="text-align:left;">
-0.2%
</td>
<td style="text-align:left;">
0.3%
</td>
<td style="text-align:left;">
48%
</td>
</tr>
<tr>
<td style="text-align:left;">
3 - 1
</td>
<td style="text-align:left;">
0.0%
</td>
<td style="text-align:left;">
-0.2%
</td>
<td style="text-align:left;">
0.3%
</td>
<td style="text-align:left;">
51%
</td>
</tr>
<tr>
<td style="text-align:left;">
3 - 2
</td>
<td style="text-align:left;">
0.0%
</td>
<td style="text-align:left;">
-0.2%
</td>
<td style="text-align:left;">
0.2%
</td>
<td style="text-align:left;">
51%
</td>
</tr>
<tr>
<td style="text-align:left;">
4 - 0
</td>
<td style="text-align:left;">
0.0%
</td>
<td style="text-align:left;">
-0.2%
</td>
<td style="text-align:left;">
0.3%
</td>
<td style="text-align:left;">
49%
</td>
</tr>
<tr>
<td style="text-align:left;">
4 - 1
</td>
<td style="text-align:left;">
0.0%
</td>
<td style="text-align:left;">
-0.2%
</td>
<td style="text-align:left;">
0.3%
</td>
<td style="text-align:left;">
50%
</td>
</tr>
<tr>
<td style="text-align:left;">
4 - 2
</td>
<td style="text-align:left;">
0.0%
</td>
<td style="text-align:left;">
-0.2%
</td>
<td style="text-align:left;">
0.2%
</td>
<td style="text-align:left;">
51%
</td>
</tr>
<tr>
<td style="text-align:left;">
4 - 3
</td>
<td style="text-align:left;">
0.0%
</td>
<td style="text-align:left;">
-0.2%
</td>
<td style="text-align:left;">
0.2%
</td>
<td style="text-align:left;">
51%
</td>
</tr>
<tr>
<td style="text-align:left;">
5 - 0
</td>
<td style="text-align:left;">
0.8%
</td>
<td style="text-align:left;">
0.6%
</td>
<td style="text-align:left;">
1.1%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
5 - 1
</td>
<td style="text-align:left;">
0.9%
</td>
<td style="text-align:left;">
0.6%
</td>
<td style="text-align:left;">
1.1%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
5 - 2
</td>
<td style="text-align:left;">
0.9%
</td>
<td style="text-align:left;">
0.6%
</td>
<td style="text-align:left;">
1.1%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
5 - 3
</td>
<td style="text-align:left;">
0.9%
</td>
<td style="text-align:left;">
0.6%
</td>
<td style="text-align:left;">
1.1%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
5 - 4
</td>
<td style="text-align:left;">
0.8%
</td>
<td style="text-align:left;">
0.6%
</td>
<td style="text-align:left;">
1.1%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="15">
CHM resolution: 0.4
</td>
<td style="text-align:left;">
1 - 0
</td>
<td style="text-align:left;">
0.0%
</td>
<td style="text-align:left;">
-0.4%
</td>
<td style="text-align:left;">
0.4%
</td>
<td style="text-align:left;">
50%
</td>
</tr>
<tr>
<td style="text-align:left;">
2 - 0
</td>
<td style="text-align:left;">
0.0%
</td>
<td style="text-align:left;">
-0.4%
</td>
<td style="text-align:left;">
0.4%
</td>
<td style="text-align:left;">
49%
</td>
</tr>
<tr>
<td style="text-align:left;">
2 - 1
</td>
<td style="text-align:left;">
0.0%
</td>
<td style="text-align:left;">
-0.4%
</td>
<td style="text-align:left;">
0.4%
</td>
<td style="text-align:left;">
49%
</td>
</tr>
<tr>
<td style="text-align:left;">
3 - 0
</td>
<td style="text-align:left;">
0.0%
</td>
<td style="text-align:left;">
-0.4%
</td>
<td style="text-align:left;">
0.3%
</td>
<td style="text-align:left;">
49%
</td>
</tr>
<tr>
<td style="text-align:left;">
3 - 1
</td>
<td style="text-align:left;">
0.0%
</td>
<td style="text-align:left;">
-0.4%
</td>
<td style="text-align:left;">
0.4%
</td>
<td style="text-align:left;">
51%
</td>
</tr>
<tr>
<td style="text-align:left;">
3 - 2
</td>
<td style="text-align:left;">
0.0%
</td>
<td style="text-align:left;">
-0.4%
</td>
<td style="text-align:left;">
0.4%
</td>
<td style="text-align:left;">
54%
</td>
</tr>
<tr>
<td style="text-align:left;">
4 - 0
</td>
<td style="text-align:left;">
0.0%
</td>
<td style="text-align:left;">
-0.4%
</td>
<td style="text-align:left;">
0.4%
</td>
<td style="text-align:left;">
51%
</td>
</tr>
<tr>
<td style="text-align:left;">
4 - 1
</td>
<td style="text-align:left;">
0.0%
</td>
<td style="text-align:left;">
-0.4%
</td>
<td style="text-align:left;">
0.4%
</td>
<td style="text-align:left;">
50%
</td>
</tr>
<tr>
<td style="text-align:left;">
4 - 2
</td>
<td style="text-align:left;">
0.0%
</td>
<td style="text-align:left;">
-0.3%
</td>
<td style="text-align:left;">
0.4%
</td>
<td style="text-align:left;">
52%
</td>
</tr>
<tr>
<td style="text-align:left;">
4 - 3
</td>
<td style="text-align:left;">
0.0%
</td>
<td style="text-align:left;">
-0.4%
</td>
<td style="text-align:left;">
0.4%
</td>
<td style="text-align:left;">
51%
</td>
</tr>
<tr>
<td style="text-align:left;">
5 - 0
</td>
<td style="text-align:left;">
0.7%
</td>
<td style="text-align:left;">
0.3%
</td>
<td style="text-align:left;">
1.1%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
5 - 1
</td>
<td style="text-align:left;">
0.7%
</td>
<td style="text-align:left;">
0.3%
</td>
<td style="text-align:left;">
1.1%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
5 - 2
</td>
<td style="text-align:left;">
0.7%
</td>
<td style="text-align:left;">
0.3%
</td>
<td style="text-align:left;">
1.1%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
5 - 3
</td>
<td style="text-align:left;">
0.7%
</td>
<td style="text-align:left;">
0.3%
</td>
<td style="text-align:left;">
1.1%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
5 - 4
</td>
<td style="text-align:left;">
0.7%
</td>
<td style="text-align:left;">
0.3%
</td>
<td style="text-align:left;">
1.1%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="15">
CHM resolution: 0.5
</td>
<td style="text-align:left;">
1 - 0
</td>
<td style="text-align:left;">
0.0%
</td>
<td style="text-align:left;">
-0.6%
</td>
<td style="text-align:left;">
0.7%
</td>
<td style="text-align:left;">
50%
</td>
</tr>
<tr>
<td style="text-align:left;">
2 - 0
</td>
<td style="text-align:left;">
0.0%
</td>
<td style="text-align:left;">
-0.6%
</td>
<td style="text-align:left;">
0.7%
</td>
<td style="text-align:left;">
51%
</td>
</tr>
<tr>
<td style="text-align:left;">
2 - 1
</td>
<td style="text-align:left;">
0.0%
</td>
<td style="text-align:left;">
-0.7%
</td>
<td style="text-align:left;">
0.7%
</td>
<td style="text-align:left;">
48%
</td>
</tr>
<tr>
<td style="text-align:left;">
3 - 0
</td>
<td style="text-align:left;">
0.0%
</td>
<td style="text-align:left;">
-0.7%
</td>
<td style="text-align:left;">
0.6%
</td>
<td style="text-align:left;">
51%
</td>
</tr>
<tr>
<td style="text-align:left;">
3 - 1
</td>
<td style="text-align:left;">
0.0%
</td>
<td style="text-align:left;">
-0.6%
</td>
<td style="text-align:left;">
0.7%
</td>
<td style="text-align:left;">
50%
</td>
</tr>
<tr>
<td style="text-align:left;">
3 - 2
</td>
<td style="text-align:left;">
0.0%
</td>
<td style="text-align:left;">
-0.6%
</td>
<td style="text-align:left;">
0.6%
</td>
<td style="text-align:left;">
52%
</td>
</tr>
<tr>
<td style="text-align:left;">
4 - 0
</td>
<td style="text-align:left;">
0.0%
</td>
<td style="text-align:left;">
-0.7%
</td>
<td style="text-align:left;">
0.7%
</td>
<td style="text-align:left;">
53%
</td>
</tr>
<tr>
<td style="text-align:left;">
4 - 1
</td>
<td style="text-align:left;">
0.0%
</td>
<td style="text-align:left;">
-0.6%
</td>
<td style="text-align:left;">
0.8%
</td>
<td style="text-align:left;">
51%
</td>
</tr>
<tr>
<td style="text-align:left;">
4 - 2
</td>
<td style="text-align:left;">
0.0%
</td>
<td style="text-align:left;">
-0.6%
</td>
<td style="text-align:left;">
0.7%
</td>
<td style="text-align:left;">
51%
</td>
</tr>
<tr>
<td style="text-align:left;">
4 - 3
</td>
<td style="text-align:left;">
0.0%
</td>
<td style="text-align:left;">
-0.6%
</td>
<td style="text-align:left;">
0.7%
</td>
<td style="text-align:left;">
49%
</td>
</tr>
<tr>
<td style="text-align:left;">
5 - 0
</td>
<td style="text-align:left;">
0.4%
</td>
<td style="text-align:left;">
-0.3%
</td>
<td style="text-align:left;">
1.0%
</td>
<td style="text-align:left;">
85%
</td>
</tr>
<tr>
<td style="text-align:left;">
5 - 1
</td>
<td style="text-align:left;">
0.3%
</td>
<td style="text-align:left;">
-0.3%
</td>
<td style="text-align:left;">
1.1%
</td>
<td style="text-align:left;">
84%
</td>
</tr>
<tr>
<td style="text-align:left;">
5 - 2
</td>
<td style="text-align:left;">
0.4%
</td>
<td style="text-align:left;">
-0.3%
</td>
<td style="text-align:left;">
1.1%
</td>
<td style="text-align:left;">
86%
</td>
</tr>
<tr>
<td style="text-align:left;">
5 - 3
</td>
<td style="text-align:left;">
0.4%
</td>
<td style="text-align:left;">
-0.4%
</td>
<td style="text-align:left;">
1.0%
</td>
<td style="text-align:left;">
86%
</td>
</tr>
<tr>
<td style="text-align:left;">
5 - 4
</td>
<td style="text-align:left;">
0.4%
</td>
<td style="text-align:left;">
-0.3%
</td>
<td style="text-align:left;">
1.0%
</td>
<td style="text-align:left;">
84%
</td>
</tr>
</tbody>
</table>
</div>
<p>although we can be very certain that there are differences in diameter quantification accuracy (&gt;99% probability across most CHM resolutions) when the <code>spectral_weight</code> is set to “5” (i.e. requiring that all spectral criteria be met) compared to the other settings of <code>spectral_weight</code> or not including spectral data, these differences are so small with nearly all of them showing a difference in diameter MAPE of &lt;1%.</p>
</div>
</div>
</div>
</div>
<div id="bayesian-glm---height-mape" class="section level2 hasAnchor" number="9.3">
<h2><span class="header-section-number">9.3</span> Bayesian GLM - Height MAPE<a href="stats_method.html#bayesian-glm---height-mape" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="model-selection-2" class="section level3 hasAnchor" number="9.3.1">
<h3><span class="header-section-number">9.3.1</span> Model selection<a href="stats_method.html#model-selection-2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>we’re going to use a sub-sample of the data to perform model testing. our objective is to construct the model such that it faithfully represents the data.</p>
<p>we reviewed the main effect parameter trends against MAPE <a href="chm_sens_test.html#mape_trends">here</a> and used these to guide our model design. we’ll follow Kurz <a href="https://bookdown.org/content/3686/18.html">2025</a> and compare our models with the LOO information criterion</p>
<blockquote>
<p>Like other information criteria, the LOO values aren’t of interest in and of themselves. However, the values of one model’s LOO relative to that of another is of great interest. We generally prefer models with lower estimates.</p>
</blockquote>
<div class="sourceCode" id="cb382"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb382-1"><a href="stats_method.html#cb382-1" tabindex="-1"></a><span class="co"># subsample data</span></span>
<span id="cb382-2"><a href="stats_method.html#cb382-2" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">222</span>)</span>
<span id="cb382-3"><a href="stats_method.html#cb382-3" tabindex="-1"></a>ms_df_temp <span class="ot">&lt;-</span> param_combos_spectral_ranked <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">slice_sample</span>(<span class="at">prop =</span> <span class="fl">0.11</span>)</span>
<span id="cb382-4"><a href="stats_method.html#cb382-4" tabindex="-1"></a><span class="co"># mcmc setup</span></span>
<span id="cb382-5"><a href="stats_method.html#cb382-5" tabindex="-1"></a>iter_temp <span class="ot">&lt;-</span> <span class="dv">2444</span></span>
<span id="cb382-6"><a href="stats_method.html#cb382-6" tabindex="-1"></a>warmup_temp <span class="ot">&lt;-</span> <span class="dv">1222</span></span>
<span id="cb382-7"><a href="stats_method.html#cb382-7" tabindex="-1"></a>chains_temp <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb382-8"><a href="stats_method.html#cb382-8" tabindex="-1"></a><span class="do">####################################################################</span></span>
<span id="cb382-9"><a href="stats_method.html#cb382-9" tabindex="-1"></a><span class="co"># base model with form selected based on main effect trends</span></span>
<span id="cb382-10"><a href="stats_method.html#cb382-10" tabindex="-1"></a><span class="do">####################################################################</span></span>
<span id="cb382-11"><a href="stats_method.html#cb382-11" tabindex="-1"></a>height_mape_mod1_temp <span class="ot">&lt;-</span> brms<span class="sc">::</span><span class="fu">brm</span>(</span>
<span id="cb382-12"><a href="stats_method.html#cb382-12" tabindex="-1"></a>  <span class="at">formula =</span> pct_diff_height_m_mape <span class="sc">~</span> </span>
<span id="cb382-13"><a href="stats_method.html#cb382-13" tabindex="-1"></a>    <span class="dv">0</span> <span class="sc">+</span> <span class="co"># no intercept to allow all values of spectral_weight to be shown instead of set as the baseline </span></span>
<span id="cb382-14"><a href="stats_method.html#cb382-14" tabindex="-1"></a>    max_ht_m <span class="sc">+</span> max_area_m2 <span class="sc">+</span> convexity_pct <span class="sc">+</span> circle_fit_iou_pct <span class="sc">+</span></span>
<span id="cb382-15"><a href="stats_method.html#cb382-15" tabindex="-1"></a>    chm_res_m <span class="sc">+</span></span>
<span id="cb382-16"><a href="stats_method.html#cb382-16" tabindex="-1"></a>    spectral_weight <span class="sc">+</span> chm_res_m<span class="sc">:</span>spectral_weight</span>
<span id="cb382-17"><a href="stats_method.html#cb382-17" tabindex="-1"></a>  , <span class="at">data =</span> ms_df_temp</span>
<span id="cb382-18"><a href="stats_method.html#cb382-18" tabindex="-1"></a>  , <span class="at">family =</span> <span class="fu">Gamma</span>(<span class="at">link =</span> <span class="st">&quot;log&quot;</span>)</span>
<span id="cb382-19"><a href="stats_method.html#cb382-19" tabindex="-1"></a>  <span class="co"># mcmc</span></span>
<span id="cb382-20"><a href="stats_method.html#cb382-20" tabindex="-1"></a>  , <span class="at">iter =</span> iter_temp, <span class="at">warmup =</span> warmup_temp</span>
<span id="cb382-21"><a href="stats_method.html#cb382-21" tabindex="-1"></a>  , <span class="at">chains =</span> chains_temp</span>
<span id="cb382-22"><a href="stats_method.html#cb382-22" tabindex="-1"></a>  <span class="co"># , control = list(adapt_delta = 0.999, max_treedepth = 13)</span></span>
<span id="cb382-23"><a href="stats_method.html#cb382-23" tabindex="-1"></a>  , <span class="at">cores =</span> lasR<span class="sc">::</span><span class="fu">half_cores</span>()</span>
<span id="cb382-24"><a href="stats_method.html#cb382-24" tabindex="-1"></a>  , <span class="at">file =</span> <span class="fu">paste0</span>(<span class="st">&quot;../data/&quot;</span>, <span class="st">&quot;height_mape_mod1_temp&quot;</span>)</span>
<span id="cb382-25"><a href="stats_method.html#cb382-25" tabindex="-1"></a>)</span>
<span id="cb382-26"><a href="stats_method.html#cb382-26" tabindex="-1"></a>height_mape_mod1_temp <span class="ot">&lt;-</span> brms<span class="sc">::</span><span class="fu">add_criterion</span>(height_mape_mod1_temp, <span class="at">criterion =</span> <span class="st">&quot;loo&quot;</span>)</span>
<span id="cb382-27"><a href="stats_method.html#cb382-27" tabindex="-1"></a><span class="do">####################################################################</span></span>
<span id="cb382-28"><a href="stats_method.html#cb382-28" tabindex="-1"></a><span class="co"># allows slope and curvature of circle_fit_iou_pct to vary by chm_res_m and vice-versa</span></span>
<span id="cb382-29"><a href="stats_method.html#cb382-29" tabindex="-1"></a><span class="do">####################################################################</span></span>
<span id="cb382-30"><a href="stats_method.html#cb382-30" tabindex="-1"></a>height_mape_mod2_temp <span class="ot">&lt;-</span> brms<span class="sc">::</span><span class="fu">brm</span>(</span>
<span id="cb382-31"><a href="stats_method.html#cb382-31" tabindex="-1"></a>  <span class="at">formula =</span> pct_diff_height_m_mape <span class="sc">~</span> </span>
<span id="cb382-32"><a href="stats_method.html#cb382-32" tabindex="-1"></a>    <span class="dv">0</span> <span class="sc">+</span> <span class="co"># no intercept to allow all values of spectral_weight to be shown instead of set as the baseline </span></span>
<span id="cb382-33"><a href="stats_method.html#cb382-33" tabindex="-1"></a>    max_ht_m <span class="sc">+</span> max_area_m2 <span class="sc">+</span> convexity_pct <span class="sc">+</span> </span>
<span id="cb382-34"><a href="stats_method.html#cb382-34" tabindex="-1"></a>    circle_fit_iou_pct <span class="sc">+</span> <span class="fu">I</span>(circle_fit_iou_pct<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> <span class="co"># changed from base model</span></span>
<span id="cb382-35"><a href="stats_method.html#cb382-35" tabindex="-1"></a>    chm_res_m <span class="sc">+</span></span>
<span id="cb382-36"><a href="stats_method.html#cb382-36" tabindex="-1"></a>    spectral_weight <span class="sc">+</span> chm_res_m<span class="sc">:</span>spectral_weight</span>
<span id="cb382-37"><a href="stats_method.html#cb382-37" tabindex="-1"></a>  , <span class="at">data =</span> ms_df_temp</span>
<span id="cb382-38"><a href="stats_method.html#cb382-38" tabindex="-1"></a>  , <span class="at">family =</span> <span class="fu">Gamma</span>(<span class="at">link =</span> <span class="st">&quot;log&quot;</span>)</span>
<span id="cb382-39"><a href="stats_method.html#cb382-39" tabindex="-1"></a>  <span class="co"># mcmc</span></span>
<span id="cb382-40"><a href="stats_method.html#cb382-40" tabindex="-1"></a>  , <span class="at">iter =</span> iter_temp, <span class="at">warmup =</span> warmup_temp</span>
<span id="cb382-41"><a href="stats_method.html#cb382-41" tabindex="-1"></a>  , <span class="at">chains =</span> chains_temp</span>
<span id="cb382-42"><a href="stats_method.html#cb382-42" tabindex="-1"></a>  <span class="co"># , control = list(adapt_delta = 0.999, max_treedepth = 13)</span></span>
<span id="cb382-43"><a href="stats_method.html#cb382-43" tabindex="-1"></a>  , <span class="at">cores =</span> lasR<span class="sc">::</span><span class="fu">half_cores</span>()</span>
<span id="cb382-44"><a href="stats_method.html#cb382-44" tabindex="-1"></a>  , <span class="at">file =</span> <span class="fu">paste0</span>(<span class="st">&quot;../data/&quot;</span>, <span class="st">&quot;height_mape_mod2_temp&quot;</span>)</span>
<span id="cb382-45"><a href="stats_method.html#cb382-45" tabindex="-1"></a>)</span>
<span id="cb382-46"><a href="stats_method.html#cb382-46" tabindex="-1"></a>height_mape_mod2_temp <span class="ot">&lt;-</span> brms<span class="sc">::</span><span class="fu">add_criterion</span>(height_mape_mod2_temp, <span class="at">criterion =</span> <span class="st">&quot;loo&quot;</span>)</span>
<span id="cb382-47"><a href="stats_method.html#cb382-47" tabindex="-1"></a><span class="do">####################################################################</span></span>
<span id="cb382-48"><a href="stats_method.html#cb382-48" tabindex="-1"></a><span class="co"># allows slope and curvature of circle_fit_iou_pct to vary by convexity_pct and vice-versa</span></span>
<span id="cb382-49"><a href="stats_method.html#cb382-49" tabindex="-1"></a><span class="do">####################################################################</span></span>
<span id="cb382-50"><a href="stats_method.html#cb382-50" tabindex="-1"></a>height_mape_mod3_temp <span class="ot">&lt;-</span> brms<span class="sc">::</span><span class="fu">brm</span>(</span>
<span id="cb382-51"><a href="stats_method.html#cb382-51" tabindex="-1"></a>  <span class="at">formula =</span> pct_diff_height_m_mape <span class="sc">~</span> </span>
<span id="cb382-52"><a href="stats_method.html#cb382-52" tabindex="-1"></a>    <span class="dv">0</span> <span class="sc">+</span> <span class="co"># no intercept to allow all values of spectral_weight to be shown instead of set as the baseline </span></span>
<span id="cb382-53"><a href="stats_method.html#cb382-53" tabindex="-1"></a>    max_ht_m <span class="sc">+</span> max_area_m2 <span class="sc">+</span> </span>
<span id="cb382-54"><a href="stats_method.html#cb382-54" tabindex="-1"></a>    convexity_pct <span class="sc">+</span> <span class="fu">I</span>(convexity_pct<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> <span class="co"># changed from base model</span></span>
<span id="cb382-55"><a href="stats_method.html#cb382-55" tabindex="-1"></a>    circle_fit_iou_pct <span class="sc">+</span> <span class="fu">I</span>(circle_fit_iou_pct<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> <span class="co"># changed from base model</span></span>
<span id="cb382-56"><a href="stats_method.html#cb382-56" tabindex="-1"></a>    convexity_pct<span class="sc">:</span>circle_fit_iou_pct <span class="sc">+</span> <span class="co"># changed from base model</span></span>
<span id="cb382-57"><a href="stats_method.html#cb382-57" tabindex="-1"></a>    chm_res_m <span class="sc">+</span></span>
<span id="cb382-58"><a href="stats_method.html#cb382-58" tabindex="-1"></a>    spectral_weight <span class="sc">+</span> chm_res_m<span class="sc">:</span>spectral_weight</span>
<span id="cb382-59"><a href="stats_method.html#cb382-59" tabindex="-1"></a>  , <span class="at">data =</span> ms_df_temp</span>
<span id="cb382-60"><a href="stats_method.html#cb382-60" tabindex="-1"></a>  , <span class="at">family =</span> <span class="fu">Gamma</span>(<span class="at">link =</span> <span class="st">&quot;log&quot;</span>)</span>
<span id="cb382-61"><a href="stats_method.html#cb382-61" tabindex="-1"></a>  <span class="co"># mcmc</span></span>
<span id="cb382-62"><a href="stats_method.html#cb382-62" tabindex="-1"></a>  , <span class="at">iter =</span> iter_temp, <span class="at">warmup =</span> warmup_temp</span>
<span id="cb382-63"><a href="stats_method.html#cb382-63" tabindex="-1"></a>  , <span class="at">chains =</span> chains_temp</span>
<span id="cb382-64"><a href="stats_method.html#cb382-64" tabindex="-1"></a>  <span class="co"># , control = list(adapt_delta = 0.999, max_treedepth = 13)</span></span>
<span id="cb382-65"><a href="stats_method.html#cb382-65" tabindex="-1"></a>  , <span class="at">cores =</span> lasR<span class="sc">::</span><span class="fu">half_cores</span>()</span>
<span id="cb382-66"><a href="stats_method.html#cb382-66" tabindex="-1"></a>  , <span class="at">file =</span> <span class="fu">paste0</span>(<span class="st">&quot;../data/&quot;</span>, <span class="st">&quot;height_mape_mod3_temp&quot;</span>)</span>
<span id="cb382-67"><a href="stats_method.html#cb382-67" tabindex="-1"></a>)</span>
<span id="cb382-68"><a href="stats_method.html#cb382-68" tabindex="-1"></a>height_mape_mod3_temp <span class="ot">&lt;-</span> brms<span class="sc">::</span><span class="fu">add_criterion</span>(height_mape_mod3_temp, <span class="at">criterion =</span> <span class="st">&quot;loo&quot;</span>)</span>
<span id="cb382-69"><a href="stats_method.html#cb382-69" tabindex="-1"></a><span class="do">####################################################################</span></span>
<span id="cb382-70"><a href="stats_method.html#cb382-70" tabindex="-1"></a><span class="co"># a three-way interaction of circle_fit_iou_pct, convexity_pct and chm_res_m</span></span>
<span id="cb382-71"><a href="stats_method.html#cb382-71" tabindex="-1"></a><span class="do">####################################################################</span></span>
<span id="cb382-72"><a href="stats_method.html#cb382-72" tabindex="-1"></a>height_mape_mod4_temp <span class="ot">&lt;-</span> brms<span class="sc">::</span><span class="fu">brm</span>(</span>
<span id="cb382-73"><a href="stats_method.html#cb382-73" tabindex="-1"></a>  <span class="at">formula =</span> pct_diff_height_m_mape <span class="sc">~</span> </span>
<span id="cb382-74"><a href="stats_method.html#cb382-74" tabindex="-1"></a>    <span class="dv">0</span> <span class="sc">+</span> <span class="co"># no intercept to allow all values of spectral_weight to be shown instead of set as the baseline </span></span>
<span id="cb382-75"><a href="stats_method.html#cb382-75" tabindex="-1"></a>    max_ht_m <span class="sc">+</span> max_area_m2 <span class="sc">+</span> </span>
<span id="cb382-76"><a href="stats_method.html#cb382-76" tabindex="-1"></a>    convexity_pct <span class="sc">+</span> <span class="fu">I</span>(convexity_pct<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> <span class="co"># changed from base model</span></span>
<span id="cb382-77"><a href="stats_method.html#cb382-77" tabindex="-1"></a>    circle_fit_iou_pct <span class="sc">+</span> <span class="fu">I</span>(circle_fit_iou_pct<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> <span class="co"># changed from base model</span></span>
<span id="cb382-78"><a href="stats_method.html#cb382-78" tabindex="-1"></a>    convexity_pct<span class="sc">:</span>circle_fit_iou_pct <span class="sc">+</span> <span class="co"># changed from base model</span></span>
<span id="cb382-79"><a href="stats_method.html#cb382-79" tabindex="-1"></a>    chm_res_m <span class="sc">+</span> <span class="fu">I</span>(chm_res_m<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> <span class="co"># changed from base model</span></span>
<span id="cb382-80"><a href="stats_method.html#cb382-80" tabindex="-1"></a>    spectral_weight <span class="sc">+</span> chm_res_m<span class="sc">:</span>spectral_weight</span>
<span id="cb382-81"><a href="stats_method.html#cb382-81" tabindex="-1"></a>  , <span class="at">data =</span> ms_df_temp</span>
<span id="cb382-82"><a href="stats_method.html#cb382-82" tabindex="-1"></a>  , <span class="at">family =</span> <span class="fu">Gamma</span>(<span class="at">link =</span> <span class="st">&quot;log&quot;</span>)</span>
<span id="cb382-83"><a href="stats_method.html#cb382-83" tabindex="-1"></a>  <span class="co"># mcmc</span></span>
<span id="cb382-84"><a href="stats_method.html#cb382-84" tabindex="-1"></a>  , <span class="at">iter =</span> iter_temp, <span class="at">warmup =</span> warmup_temp</span>
<span id="cb382-85"><a href="stats_method.html#cb382-85" tabindex="-1"></a>  , <span class="at">chains =</span> chains_temp</span>
<span id="cb382-86"><a href="stats_method.html#cb382-86" tabindex="-1"></a>  <span class="co"># , control = list(adapt_delta = 0.999, max_treedepth = 13)</span></span>
<span id="cb382-87"><a href="stats_method.html#cb382-87" tabindex="-1"></a>  , <span class="at">cores =</span> lasR<span class="sc">::</span><span class="fu">half_cores</span>()</span>
<span id="cb382-88"><a href="stats_method.html#cb382-88" tabindex="-1"></a>  , <span class="at">file =</span> <span class="fu">paste0</span>(<span class="st">&quot;../data/&quot;</span>, <span class="st">&quot;height_mape_mod4_temp&quot;</span>)</span>
<span id="cb382-89"><a href="stats_method.html#cb382-89" tabindex="-1"></a>)</span>
<span id="cb382-90"><a href="stats_method.html#cb382-90" tabindex="-1"></a>height_mape_mod4_temp <span class="ot">&lt;-</span> brms<span class="sc">::</span><span class="fu">add_criterion</span>(height_mape_mod4_temp, <span class="at">criterion =</span> <span class="st">&quot;loo&quot;</span>)</span>
<span id="cb382-91"><a href="stats_method.html#cb382-91" tabindex="-1"></a><span class="do">####################################################################</span></span>
<span id="cb382-92"><a href="stats_method.html#cb382-92" tabindex="-1"></a><span class="co"># a three-way interaction of circle_fit_iou_pct, convexity_pct and chm_res_m</span></span>
<span id="cb382-93"><a href="stats_method.html#cb382-93" tabindex="-1"></a><span class="do">####################################################################</span></span>
<span id="cb382-94"><a href="stats_method.html#cb382-94" tabindex="-1"></a>height_mape_mod5_temp <span class="ot">&lt;-</span> brms<span class="sc">::</span><span class="fu">brm</span>(</span>
<span id="cb382-95"><a href="stats_method.html#cb382-95" tabindex="-1"></a>  <span class="at">formula =</span> pct_diff_height_m_mape <span class="sc">~</span></span>
<span id="cb382-96"><a href="stats_method.html#cb382-96" tabindex="-1"></a>    <span class="dv">0</span> <span class="sc">+</span> <span class="co"># no intercept to allow all values of spectral_weight to be shown instead of set as the baseline </span></span>
<span id="cb382-97"><a href="stats_method.html#cb382-97" tabindex="-1"></a>    max_ht_m <span class="sc">+</span> max_area_m2 <span class="sc">+</span> </span>
<span id="cb382-98"><a href="stats_method.html#cb382-98" tabindex="-1"></a>    convexity_pct <span class="sc">+</span> <span class="fu">I</span>(convexity_pct<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> <span class="co"># changed from base model</span></span>
<span id="cb382-99"><a href="stats_method.html#cb382-99" tabindex="-1"></a>    circle_fit_iou_pct <span class="sc">+</span> <span class="fu">I</span>(circle_fit_iou_pct<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> <span class="co"># changed from base model</span></span>
<span id="cb382-100"><a href="stats_method.html#cb382-100" tabindex="-1"></a>    convexity_pct<span class="sc">:</span>circle_fit_iou_pct <span class="sc">+</span> <span class="co"># changed from base model</span></span>
<span id="cb382-101"><a href="stats_method.html#cb382-101" tabindex="-1"></a>    convexity_pct<span class="sc">:</span>chm_res_m <span class="sc">+</span> <span class="co"># changed from base model</span></span>
<span id="cb382-102"><a href="stats_method.html#cb382-102" tabindex="-1"></a>    circle_fit_iou_pct<span class="sc">:</span>chm_res_m <span class="sc">+</span> <span class="co"># changed from base model</span></span>
<span id="cb382-103"><a href="stats_method.html#cb382-103" tabindex="-1"></a>    convexity_pct<span class="sc">:</span>circle_fit_iou_pct<span class="sc">:</span>chm_res_m <span class="sc">+</span> <span class="co"># changed from base model</span></span>
<span id="cb382-104"><a href="stats_method.html#cb382-104" tabindex="-1"></a>    chm_res_m <span class="sc">+</span></span>
<span id="cb382-105"><a href="stats_method.html#cb382-105" tabindex="-1"></a>    spectral_weight <span class="sc">+</span> chm_res_m<span class="sc">:</span>spectral_weight</span>
<span id="cb382-106"><a href="stats_method.html#cb382-106" tabindex="-1"></a>  , <span class="at">data =</span> ms_df_temp</span>
<span id="cb382-107"><a href="stats_method.html#cb382-107" tabindex="-1"></a>  , <span class="at">family =</span> <span class="fu">Gamma</span>(<span class="at">link =</span> <span class="st">&quot;log&quot;</span>)</span>
<span id="cb382-108"><a href="stats_method.html#cb382-108" tabindex="-1"></a>  <span class="co"># mcmc</span></span>
<span id="cb382-109"><a href="stats_method.html#cb382-109" tabindex="-1"></a>  , <span class="at">iter =</span> iter_temp, <span class="at">warmup =</span> warmup_temp</span>
<span id="cb382-110"><a href="stats_method.html#cb382-110" tabindex="-1"></a>  , <span class="at">chains =</span> chains_temp</span>
<span id="cb382-111"><a href="stats_method.html#cb382-111" tabindex="-1"></a>  <span class="co"># , control = list(adapt_delta = 0.999, max_treedepth = 13)</span></span>
<span id="cb382-112"><a href="stats_method.html#cb382-112" tabindex="-1"></a>  , <span class="at">cores =</span> lasR<span class="sc">::</span><span class="fu">half_cores</span>()</span>
<span id="cb382-113"><a href="stats_method.html#cb382-113" tabindex="-1"></a>  , <span class="at">file =</span> <span class="fu">paste0</span>(<span class="st">&quot;../data/&quot;</span>, <span class="st">&quot;height_mape_mod5_temp&quot;</span>)</span>
<span id="cb382-114"><a href="stats_method.html#cb382-114" tabindex="-1"></a>)</span>
<span id="cb382-115"><a href="stats_method.html#cb382-115" tabindex="-1"></a>height_mape_mod5_temp <span class="ot">&lt;-</span> brms<span class="sc">::</span><span class="fu">add_criterion</span>(height_mape_mod5_temp, <span class="at">criterion =</span> <span class="st">&quot;loo&quot;</span>)</span>
<span id="cb382-116"><a href="stats_method.html#cb382-116" tabindex="-1"></a><span class="do">####################################################################</span></span>
<span id="cb382-117"><a href="stats_method.html#cb382-117" tabindex="-1"></a><span class="co"># a three-way interaction of circle_fit_iou_pct, convexity_pct and chm_res_m</span></span>
<span id="cb382-118"><a href="stats_method.html#cb382-118" tabindex="-1"></a><span class="do">####################################################################</span></span>
<span id="cb382-119"><a href="stats_method.html#cb382-119" tabindex="-1"></a>height_mape_mod6_temp <span class="ot">&lt;-</span> brms<span class="sc">::</span><span class="fu">brm</span>(</span>
<span id="cb382-120"><a href="stats_method.html#cb382-120" tabindex="-1"></a>  <span class="at">formula =</span> pct_diff_height_m_mape <span class="sc">~</span></span>
<span id="cb382-121"><a href="stats_method.html#cb382-121" tabindex="-1"></a>    <span class="dv">0</span> <span class="sc">+</span> <span class="co"># no intercept to allow all values of spectral_weight to be shown instead of set as the baseline </span></span>
<span id="cb382-122"><a href="stats_method.html#cb382-122" tabindex="-1"></a>    max_ht_m <span class="sc">+</span> max_area_m2 <span class="sc">+</span> </span>
<span id="cb382-123"><a href="stats_method.html#cb382-123" tabindex="-1"></a>    convexity_pct <span class="sc">+</span> <span class="fu">I</span>(convexity_pct<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> <span class="co"># changed from base model</span></span>
<span id="cb382-124"><a href="stats_method.html#cb382-124" tabindex="-1"></a>    circle_fit_iou_pct <span class="sc">+</span> <span class="fu">I</span>(circle_fit_iou_pct<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> <span class="co"># changed from base model</span></span>
<span id="cb382-125"><a href="stats_method.html#cb382-125" tabindex="-1"></a>    convexity_pct<span class="sc">:</span>circle_fit_iou_pct <span class="sc">+</span> <span class="co"># changed from base model</span></span>
<span id="cb382-126"><a href="stats_method.html#cb382-126" tabindex="-1"></a>    convexity_pct<span class="sc">:</span>chm_res_m <span class="sc">+</span> <span class="co"># changed from base model</span></span>
<span id="cb382-127"><a href="stats_method.html#cb382-127" tabindex="-1"></a>    circle_fit_iou_pct<span class="sc">:</span>chm_res_m <span class="sc">+</span> <span class="co"># changed from base model</span></span>
<span id="cb382-128"><a href="stats_method.html#cb382-128" tabindex="-1"></a>    convexity_pct<span class="sc">:</span>circle_fit_iou_pct<span class="sc">:</span>chm_res_m <span class="sc">+</span> <span class="co"># changed from base model</span></span>
<span id="cb382-129"><a href="stats_method.html#cb382-129" tabindex="-1"></a>    chm_res_m <span class="sc">+</span> <span class="fu">I</span>(chm_res_m<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> <span class="co"># changed from base model</span></span>
<span id="cb382-130"><a href="stats_method.html#cb382-130" tabindex="-1"></a>    spectral_weight <span class="sc">+</span> chm_res_m<span class="sc">:</span>spectral_weight</span>
<span id="cb382-131"><a href="stats_method.html#cb382-131" tabindex="-1"></a>  , <span class="at">data =</span> ms_df_temp</span>
<span id="cb382-132"><a href="stats_method.html#cb382-132" tabindex="-1"></a>  , <span class="at">family =</span> <span class="fu">Gamma</span>(<span class="at">link =</span> <span class="st">&quot;log&quot;</span>)</span>
<span id="cb382-133"><a href="stats_method.html#cb382-133" tabindex="-1"></a>  <span class="co"># mcmc</span></span>
<span id="cb382-134"><a href="stats_method.html#cb382-134" tabindex="-1"></a>  , <span class="at">iter =</span> iter_temp, <span class="at">warmup =</span> warmup_temp</span>
<span id="cb382-135"><a href="stats_method.html#cb382-135" tabindex="-1"></a>  , <span class="at">chains =</span> chains_temp</span>
<span id="cb382-136"><a href="stats_method.html#cb382-136" tabindex="-1"></a>  <span class="co"># , control = list(adapt_delta = 0.999, max_treedepth = 13)</span></span>
<span id="cb382-137"><a href="stats_method.html#cb382-137" tabindex="-1"></a>  , <span class="at">cores =</span> lasR<span class="sc">::</span><span class="fu">half_cores</span>()</span>
<span id="cb382-138"><a href="stats_method.html#cb382-138" tabindex="-1"></a>  , <span class="at">file =</span> <span class="fu">paste0</span>(<span class="st">&quot;../data/&quot;</span>, <span class="st">&quot;height_mape_mod6_temp&quot;</span>)</span>
<span id="cb382-139"><a href="stats_method.html#cb382-139" tabindex="-1"></a>)</span>
<span id="cb382-140"><a href="stats_method.html#cb382-140" tabindex="-1"></a>height_mape_mod6_temp <span class="ot">&lt;-</span> brms<span class="sc">::</span><span class="fu">add_criterion</span>(height_mape_mod6_temp, <span class="at">criterion =</span> <span class="st">&quot;loo&quot;</span>)</span></code></pre></div>
<p>compare our models with the LOO information criterion. with the <code>brms::loo_compare()</code> function, we can compute a formal difference score between models with the output rank ordering the models such that the best fitting model appears on top. all models also receive a difference score relative to the best model and a standard error of the difference score</p>
<div class="sourceCode" id="cb383"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb383-1"><a href="stats_method.html#cb383-1" tabindex="-1"></a>brms<span class="sc">::</span><span class="fu">loo_compare</span>(</span>
<span id="cb383-2"><a href="stats_method.html#cb383-2" tabindex="-1"></a>  height_mape_mod1_temp, height_mape_mod2_temp, height_mape_mod3_temp</span>
<span id="cb383-3"><a href="stats_method.html#cb383-3" tabindex="-1"></a>  , height_mape_mod4_temp, height_mape_mod5_temp, height_mape_mod6_temp</span>
<span id="cb383-4"><a href="stats_method.html#cb383-4" tabindex="-1"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb383-5"><a href="stats_method.html#cb383-5" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kbl</span>(<span class="at">caption =</span> <span class="st">&quot;Height MAPE model selection with LOO information criterion&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb383-6"><a href="stats_method.html#cb383-6" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kable_styling</span>()</span></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-368">Table 9.15: </span>Height MAPE model selection with LOO information criterion
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
elpd_diff
</th>
<th style="text-align:right;">
se_diff
</th>
<th style="text-align:right;">
elpd_loo
</th>
<th style="text-align:right;">
se_elpd_loo
</th>
<th style="text-align:right;">
p_loo
</th>
<th style="text-align:right;">
se_p_loo
</th>
<th style="text-align:right;">
looic
</th>
<th style="text-align:right;">
se_looic
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
height_mape_mod6_temp
</td>
<td style="text-align:right;">
0.0000
</td>
<td style="text-align:right;">
0.00000
</td>
<td style="text-align:right;">
6288.058
</td>
<td style="text-align:right;">
113.9030
</td>
<td style="text-align:right;">
44.88877
</td>
<td style="text-align:right;">
5.472842
</td>
<td style="text-align:right;">
-12576.12
</td>
<td style="text-align:right;">
227.8060
</td>
</tr>
<tr>
<td style="text-align:left;">
height_mape_mod5_temp
</td>
<td style="text-align:right;">
-128.8016
</td>
<td style="text-align:right;">
11.38928
</td>
<td style="text-align:right;">
6159.256
</td>
<td style="text-align:right;">
118.7742
</td>
<td style="text-align:right;">
45.39308
</td>
<td style="text-align:right;">
5.826347
</td>
<td style="text-align:right;">
-12318.51
</td>
<td style="text-align:right;">
237.5484
</td>
</tr>
<tr>
<td style="text-align:left;">
height_mape_mod4_temp
</td>
<td style="text-align:right;">
-240.8235
</td>
<td style="text-align:right;">
31.72005
</td>
<td style="text-align:right;">
6047.234
</td>
<td style="text-align:right;">
128.6006
</td>
<td style="text-align:right;">
46.03526
</td>
<td style="text-align:right;">
6.017574
</td>
<td style="text-align:right;">
-12094.47
</td>
<td style="text-align:right;">
257.2011
</td>
</tr>
<tr>
<td style="text-align:left;">
height_mape_mod3_temp
</td>
<td style="text-align:right;">
-343.5301
</td>
<td style="text-align:right;">
34.92927
</td>
<td style="text-align:right;">
5944.528
</td>
<td style="text-align:right;">
133.4217
</td>
<td style="text-align:right;">
45.74430
</td>
<td style="text-align:right;">
6.183430
</td>
<td style="text-align:right;">
-11889.06
</td>
<td style="text-align:right;">
266.8435
</td>
</tr>
<tr>
<td style="text-align:left;">
height_mape_mod2_temp
</td>
<td style="text-align:right;">
-345.5319
</td>
<td style="text-align:right;">
37.53070
</td>
<td style="text-align:right;">
5942.526
</td>
<td style="text-align:right;">
134.4929
</td>
<td style="text-align:right;">
40.24100
</td>
<td style="text-align:right;">
5.598372
</td>
<td style="text-align:right;">
-11885.05
</td>
<td style="text-align:right;">
268.9857
</td>
</tr>
<tr>
<td style="text-align:left;">
height_mape_mod1_temp
</td>
<td style="text-align:right;">
-368.9222
</td>
<td style="text-align:right;">
44.36319
</td>
<td style="text-align:right;">
5919.136
</td>
<td style="text-align:right;">
140.7629
</td>
<td style="text-align:right;">
40.86776
</td>
<td style="text-align:right;">
5.809111
</td>
<td style="text-align:right;">
-11838.27
</td>
<td style="text-align:right;">
281.5258
</td>
</tr>
</tbody>
</table>
<p>we can also look at the AIC-type model weights</p>
<div class="sourceCode" id="cb384"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb384-1"><a href="stats_method.html#cb384-1" tabindex="-1"></a>brms<span class="sc">::</span><span class="fu">model_weights</span>(</span>
<span id="cb384-2"><a href="stats_method.html#cb384-2" tabindex="-1"></a>  height_mape_mod1_temp, height_mape_mod2_temp, height_mape_mod3_temp</span>
<span id="cb384-3"><a href="stats_method.html#cb384-3" tabindex="-1"></a>  , height_mape_mod4_temp, height_mape_mod5_temp, height_mape_mod6_temp</span>
<span id="cb384-4"><a href="stats_method.html#cb384-4" tabindex="-1"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb384-5"><a href="stats_method.html#cb384-5" tabindex="-1"></a>  <span class="fu">round</span>(<span class="at">digits =</span> <span class="dv">4</span>)</span></code></pre></div>
<p>we can also quickly look at the Bayeisan <span class="math inline">\(R^2\)</span> returned from the <code>brms::bayes_R2()</code> function</p>
<div class="sourceCode" id="cb385"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb385-1"><a href="stats_method.html#cb385-1" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(</span>
<span id="cb385-2"><a href="stats_method.html#cb385-2" tabindex="-1"></a>  brms<span class="sc">::</span><span class="fu">bayes_R2</span>(height_mape_mod1_temp,<span class="at">summary=</span>F) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">mod =</span> <span class="st">&quot;height_mape_mod1_temp&quot;</span>)</span>
<span id="cb385-3"><a href="stats_method.html#cb385-3" tabindex="-1"></a>  , brms<span class="sc">::</span><span class="fu">bayes_R2</span>(height_mape_mod2_temp,<span class="at">summary=</span>F) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">mod =</span> <span class="st">&quot;height_mape_mod2_temp&quot;</span>)</span>
<span id="cb385-4"><a href="stats_method.html#cb385-4" tabindex="-1"></a>  , brms<span class="sc">::</span><span class="fu">bayes_R2</span>(height_mape_mod3_temp,<span class="at">summary=</span>F) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">mod =</span> <span class="st">&quot;height_mape_mod3_temp&quot;</span>)</span>
<span id="cb385-5"><a href="stats_method.html#cb385-5" tabindex="-1"></a>  , brms<span class="sc">::</span><span class="fu">bayes_R2</span>(height_mape_mod4_temp,<span class="at">summary=</span>F) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">mod =</span> <span class="st">&quot;height_mape_mod4_temp&quot;</span>)</span>
<span id="cb385-6"><a href="stats_method.html#cb385-6" tabindex="-1"></a>  , brms<span class="sc">::</span><span class="fu">bayes_R2</span>(height_mape_mod5_temp,<span class="at">summary=</span>F) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">mod =</span> <span class="st">&quot;height_mape_mod5_temp&quot;</span>)</span>
<span id="cb385-7"><a href="stats_method.html#cb385-7" tabindex="-1"></a>  , brms<span class="sc">::</span><span class="fu">bayes_R2</span>(height_mape_mod6_temp,<span class="at">summary=</span>F) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">mod =</span> <span class="st">&quot;height_mape_mod6_temp&quot;</span>)</span>
<span id="cb385-8"><a href="stats_method.html#cb385-8" tabindex="-1"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb385-9"><a href="stats_method.html#cb385-9" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">mod =</span> <span class="fu">factor</span>(mod)) <span class="sc">%&gt;%</span> </span>
<span id="cb385-10"><a href="stats_method.html#cb385-10" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="at">mapping=</span>ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">y=</span>R2, <span class="at">x =</span> mod)) <span class="sc">+</span></span>
<span id="cb385-11"><a href="stats_method.html#cb385-11" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">stat_eye</span>(</span>
<span id="cb385-12"><a href="stats_method.html#cb385-12" tabindex="-1"></a>    <span class="at">point_interval =</span> median_hdi, <span class="at">.width =</span> .<span class="dv">95</span></span>
<span id="cb385-13"><a href="stats_method.html#cb385-13" tabindex="-1"></a>    , <span class="at">slab_alpha =</span> <span class="fl">0.95</span></span>
<span id="cb385-14"><a href="stats_method.html#cb385-14" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb385-15"><a href="stats_method.html#cb385-15" tabindex="-1"></a>  <span class="co"># ggplot2::facet_grid(cols = dplyr::vars(spectral_weight)) +</span></span>
<span id="cb385-16"><a href="stats_method.html#cb385-16" tabindex="-1"></a>  <span class="co"># ggplot2::scale_fill_manual(values = pal_chm_res_m) +</span></span>
<span id="cb385-17"><a href="stats_method.html#cb385-17" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Bayesian R-squared&quot;</span>) <span class="sc">+</span></span>
<span id="cb385-18"><a href="stats_method.html#cb385-18" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_light</span>()</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-370-1.png" width="1008" /></p>
<p>the more complex models were selected as the best. because the selected model includes quadratic terms and multiple interactions parameter interpretation will be a challenge, so we will have to rely on plotting the modeled relationships rather than trying to interpret the coefficients.</p>
</div>
<div id="modeling-1" class="section level3 hasAnchor" number="9.3.2">
<h3><span class="header-section-number">9.3.2</span> Modeling<a href="stats_method.html#modeling-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>the fully factored Bayesian statistical model that details the likelihood, linear model, and priors used is the same as above for <a href="stats_method.html#mod_diam_mape2">Diameter MAPE</a></p>
<p>we reviewed the main effect parameter trends against MAPE <a href="chm_sens_test.html#mape_trends">here</a> and used these to guide our model design</p>
<div class="sourceCode" id="cb386"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb386-1"><a href="stats_method.html#cb386-1" tabindex="-1"></a>brms_height_mape_mod <span class="ot">&lt;-</span> brms<span class="sc">::</span><span class="fu">brm</span>(</span>
<span id="cb386-2"><a href="stats_method.html#cb386-2" tabindex="-1"></a>  <span class="at">formula =</span> pct_diff_height_m_mape <span class="sc">~</span></span>
<span id="cb386-3"><a href="stats_method.html#cb386-3" tabindex="-1"></a>    <span class="dv">0</span> <span class="sc">+</span> <span class="co"># no intercept to allow all values of spectral_weight to be shown instead of set as the baseline </span></span>
<span id="cb386-4"><a href="stats_method.html#cb386-4" tabindex="-1"></a>    max_ht_m <span class="sc">+</span> max_area_m2 <span class="sc">+</span> </span>
<span id="cb386-5"><a href="stats_method.html#cb386-5" tabindex="-1"></a>    convexity_pct <span class="sc">+</span> <span class="fu">I</span>(convexity_pct<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> <span class="co"># changed from base model</span></span>
<span id="cb386-6"><a href="stats_method.html#cb386-6" tabindex="-1"></a>    circle_fit_iou_pct <span class="sc">+</span> <span class="fu">I</span>(circle_fit_iou_pct<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> <span class="co"># changed from base model</span></span>
<span id="cb386-7"><a href="stats_method.html#cb386-7" tabindex="-1"></a>    convexity_pct<span class="sc">:</span>circle_fit_iou_pct <span class="sc">+</span> <span class="co"># changed from base model</span></span>
<span id="cb386-8"><a href="stats_method.html#cb386-8" tabindex="-1"></a>    convexity_pct<span class="sc">:</span>chm_res_m <span class="sc">+</span> <span class="co"># changed from base model</span></span>
<span id="cb386-9"><a href="stats_method.html#cb386-9" tabindex="-1"></a>    circle_fit_iou_pct<span class="sc">:</span>chm_res_m <span class="sc">+</span> <span class="co"># changed from base model</span></span>
<span id="cb386-10"><a href="stats_method.html#cb386-10" tabindex="-1"></a>    convexity_pct<span class="sc">:</span>circle_fit_iou_pct<span class="sc">:</span>chm_res_m <span class="sc">+</span> <span class="co"># changed from base model</span></span>
<span id="cb386-11"><a href="stats_method.html#cb386-11" tabindex="-1"></a>    chm_res_m <span class="sc">+</span> <span class="fu">I</span>(chm_res_m<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> <span class="co"># changed from base model</span></span>
<span id="cb386-12"><a href="stats_method.html#cb386-12" tabindex="-1"></a>    spectral_weight <span class="sc">+</span> chm_res_m<span class="sc">:</span>spectral_weight</span>
<span id="cb386-13"><a href="stats_method.html#cb386-13" tabindex="-1"></a>  , <span class="at">data =</span> param_combos_spectral_ranked <span class="co"># %&gt;% dplyr::slice_sample(prop = 0.33)</span></span>
<span id="cb386-14"><a href="stats_method.html#cb386-14" tabindex="-1"></a>  , <span class="at">family =</span> <span class="fu">Gamma</span>(<span class="at">link =</span> <span class="st">&quot;log&quot;</span>)</span>
<span id="cb386-15"><a href="stats_method.html#cb386-15" tabindex="-1"></a>  <span class="co"># mcmc</span></span>
<span id="cb386-16"><a href="stats_method.html#cb386-16" tabindex="-1"></a>  , <span class="at">iter =</span> <span class="dv">14000</span>, <span class="at">warmup =</span> <span class="dv">7000</span></span>
<span id="cb386-17"><a href="stats_method.html#cb386-17" tabindex="-1"></a>  , <span class="at">chains =</span> <span class="dv">4</span></span>
<span id="cb386-18"><a href="stats_method.html#cb386-18" tabindex="-1"></a>  <span class="co"># , control = list(adapt_delta = 0.999, max_treedepth = 13)</span></span>
<span id="cb386-19"><a href="stats_method.html#cb386-19" tabindex="-1"></a>  , <span class="at">cores =</span> lasR<span class="sc">::</span><span class="fu">half_cores</span>()</span>
<span id="cb386-20"><a href="stats_method.html#cb386-20" tabindex="-1"></a>  , <span class="at">file =</span> <span class="fu">paste0</span>(<span class="st">&quot;../data/&quot;</span>, <span class="st">&quot;brms_height_mape_mod&quot;</span>)</span>
<span id="cb386-21"><a href="stats_method.html#cb386-21" tabindex="-1"></a>)</span>
<span id="cb386-22"><a href="stats_method.html#cb386-22" tabindex="-1"></a><span class="co"># brms::make_stancode(brms_height_mape_mod)</span></span>
<span id="cb386-23"><a href="stats_method.html#cb386-23" tabindex="-1"></a><span class="co"># brms::prior_summary(brms_height_mape_mod)</span></span>
<span id="cb386-24"><a href="stats_method.html#cb386-24" tabindex="-1"></a><span class="co"># print(brms_height_mape_mod)</span></span>
<span id="cb386-25"><a href="stats_method.html#cb386-25" tabindex="-1"></a><span class="co"># brms::neff_ratio(brms_height_mape_mod)</span></span>
<span id="cb386-26"><a href="stats_method.html#cb386-26" tabindex="-1"></a><span class="co"># brms::rhat(brms_height_mape_mod)</span></span>
<span id="cb386-27"><a href="stats_method.html#cb386-27" tabindex="-1"></a><span class="co"># brms::nuts_params(brms_height_mape_mod)</span></span></code></pre></div>
<p>The <code>brms::brm</code> model summary</p>
<div class="sourceCode" id="cb387"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb387-1"><a href="stats_method.html#cb387-1" tabindex="-1"></a>brms_height_mape_mod <span class="sc">%&gt;%</span> </span>
<span id="cb387-2"><a href="stats_method.html#cb387-2" tabindex="-1"></a>  brms<span class="sc">::</span><span class="fu">posterior_summary</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb387-3"><a href="stats_method.html#cb387-3" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb387-4"><a href="stats_method.html#cb387-4" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">&quot;parameter&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb387-5"><a href="stats_method.html#cb387-5" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename_with</span>(tolower) <span class="sc">%&gt;%</span> </span>
<span id="cb387-6"><a href="stats_method.html#cb387-6" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(</span>
<span id="cb387-7"><a href="stats_method.html#cb387-7" tabindex="-1"></a>    stringr<span class="sc">::</span><span class="fu">str_starts</span>(parameter, <span class="st">&quot;b_&quot;</span>) </span>
<span id="cb387-8"><a href="stats_method.html#cb387-8" tabindex="-1"></a>    <span class="sc">|</span> parameter <span class="sc">==</span> <span class="st">&quot;phi&quot;</span></span>
<span id="cb387-9"><a href="stats_method.html#cb387-9" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb387-10"><a href="stats_method.html#cb387-10" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kbl</span>(<span class="at">digits =</span> <span class="dv">3</span>, <span class="at">caption =</span> <span class="st">&quot;Bayesian model for Height MAPE&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb387-11"><a href="stats_method.html#cb387-11" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kable_styling</span>()</span></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-373">Table 9.16: </span>Bayesian model for Height MAPE
</caption>
<thead>
<tr>
<th style="text-align:left;">
parameter
</th>
<th style="text-align:right;">
estimate
</th>
<th style="text-align:right;">
est.error
</th>
<th style="text-align:right;">
q2.5
</th>
<th style="text-align:right;">
q97.5
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
b_max_ht_m
</td>
<td style="text-align:right;">
0.075
</td>
<td style="text-align:right;">
0.001
</td>
<td style="text-align:right;">
0.073
</td>
<td style="text-align:right;">
0.077
</td>
</tr>
<tr>
<td style="text-align:left;">
b_max_area_m2
</td>
<td style="text-align:right;">
0.002
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
0.002
</td>
<td style="text-align:right;">
0.002
</td>
</tr>
<tr>
<td style="text-align:left;">
b_convexity_pct
</td>
<td style="text-align:right;">
0.241
</td>
<td style="text-align:right;">
0.022
</td>
<td style="text-align:right;">
0.199
</td>
<td style="text-align:right;">
0.284
</td>
</tr>
<tr>
<td style="text-align:left;">
b_Iconvexity_pctE2
</td>
<td style="text-align:right;">
0.016
</td>
<td style="text-align:right;">
0.014
</td>
<td style="text-align:right;">
-0.012
</td>
<td style="text-align:right;">
0.043
</td>
</tr>
<tr>
<td style="text-align:left;">
b_circle_fit_iou_pct
</td>
<td style="text-align:right;">
-0.750
</td>
<td style="text-align:right;">
0.025
</td>
<td style="text-align:right;">
-0.799
</td>
<td style="text-align:right;">
-0.701
</td>
</tr>
<tr>
<td style="text-align:left;">
b_Icircle_fit_iou_pctE2
</td>
<td style="text-align:right;">
0.333
</td>
<td style="text-align:right;">
0.019
</td>
<td style="text-align:right;">
0.295
</td>
<td style="text-align:right;">
0.370
</td>
</tr>
<tr>
<td style="text-align:left;">
b_chm_res_m
</td>
<td style="text-align:right;">
-1.839
</td>
<td style="text-align:right;">
0.050
</td>
<td style="text-align:right;">
-1.938
</td>
<td style="text-align:right;">
-1.741
</td>
</tr>
<tr>
<td style="text-align:left;">
b_Ichm_res_mE2
</td>
<td style="text-align:right;">
3.247
</td>
<td style="text-align:right;">
0.065
</td>
<td style="text-align:right;">
3.119
</td>
<td style="text-align:right;">
3.375
</td>
</tr>
<tr>
<td style="text-align:left;">
b_spectral_weight0
</td>
<td style="text-align:right;">
-1.793
</td>
<td style="text-align:right;">
0.013
</td>
<td style="text-align:right;">
-1.818
</td>
<td style="text-align:right;">
-1.768
</td>
</tr>
<tr>
<td style="text-align:left;">
b_spectral_weight1
</td>
<td style="text-align:right;">
-1.793
</td>
<td style="text-align:right;">
0.013
</td>
<td style="text-align:right;">
-1.818
</td>
<td style="text-align:right;">
-1.768
</td>
</tr>
<tr>
<td style="text-align:left;">
b_spectral_weight2
</td>
<td style="text-align:right;">
-1.793
</td>
<td style="text-align:right;">
0.013
</td>
<td style="text-align:right;">
-1.818
</td>
<td style="text-align:right;">
-1.768
</td>
</tr>
<tr>
<td style="text-align:left;">
b_spectral_weight3
</td>
<td style="text-align:right;">
-1.793
</td>
<td style="text-align:right;">
0.013
</td>
<td style="text-align:right;">
-1.818
</td>
<td style="text-align:right;">
-1.768
</td>
</tr>
<tr>
<td style="text-align:left;">
b_spectral_weight4
</td>
<td style="text-align:right;">
-1.793
</td>
<td style="text-align:right;">
0.013
</td>
<td style="text-align:right;">
-1.818
</td>
<td style="text-align:right;">
-1.768
</td>
</tr>
<tr>
<td style="text-align:left;">
b_spectral_weight5
</td>
<td style="text-align:right;">
-1.817
</td>
<td style="text-align:right;">
0.013
</td>
<td style="text-align:right;">
-1.842
</td>
<td style="text-align:right;">
-1.792
</td>
</tr>
<tr>
<td style="text-align:left;">
b_convexity_pct:circle_fit_iou_pct
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
0.036
</td>
<td style="text-align:right;">
-0.070
</td>
<td style="text-align:right;">
0.069
</td>
</tr>
<tr>
<td style="text-align:left;">
b_convexity_pct:chm_res_m
</td>
<td style="text-align:right;">
-0.788
</td>
<td style="text-align:right;">
0.052
</td>
<td style="text-align:right;">
-0.892
</td>
<td style="text-align:right;">
-0.685
</td>
</tr>
<tr>
<td style="text-align:left;">
b_circle_fit_iou_pct:chm_res_m
</td>
<td style="text-align:right;">
1.790
</td>
<td style="text-align:right;">
0.057
</td>
<td style="text-align:right;">
1.678
</td>
<td style="text-align:right;">
1.903
</td>
</tr>
<tr>
<td style="text-align:left;">
b_chm_res_m:spectral_weight1
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
0.026
</td>
<td style="text-align:right;">
-0.051
</td>
<td style="text-align:right;">
0.051
</td>
</tr>
<tr>
<td style="text-align:left;">
b_chm_res_m:spectral_weight2
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
0.026
</td>
<td style="text-align:right;">
-0.053
</td>
<td style="text-align:right;">
0.051
</td>
</tr>
<tr>
<td style="text-align:left;">
b_chm_res_m:spectral_weight3
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
0.026
</td>
<td style="text-align:right;">
-0.052
</td>
<td style="text-align:right;">
0.051
</td>
</tr>
<tr>
<td style="text-align:left;">
b_chm_res_m:spectral_weight4
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
0.027
</td>
<td style="text-align:right;">
-0.052
</td>
<td style="text-align:right;">
0.052
</td>
</tr>
<tr>
<td style="text-align:left;">
b_chm_res_m:spectral_weight5
</td>
<td style="text-align:right;">
0.057
</td>
<td style="text-align:right;">
0.026
</td>
<td style="text-align:right;">
0.006
</td>
<td style="text-align:right;">
0.110
</td>
</tr>
<tr>
<td style="text-align:left;">
b_convexity_pct:circle_fit_iou_pct:chm_res_m
</td>
<td style="text-align:right;">
-0.199
</td>
<td style="text-align:right;">
0.106
</td>
<td style="text-align:right;">
-0.407
</td>
<td style="text-align:right;">
0.008
</td>
</tr>
</tbody>
</table>
<p>note the quadratic coefficients ending in <code>E2</code>, Kruschke (2015) provides some insight on how to interpret:</p>
<blockquote>
<p>A quadratic has the form <span class="math inline">\(y = \beta_{0} + \beta_{1}x + \beta_{2}x^{2}\)</span>. When <span class="math inline">\(\beta_{2}\)</span> is zero, the form reduces to a line. Therefore, this extended model can produce any fit that the linear model can. When <span class="math inline">\(\beta_{2}\)</span> is positive, a plot of the curve is a parabola that opens upward. When <span class="math inline">\(\beta_{2}\)</span> is negative, the curve is a parabola that opens downward. We have no reason to think that the curvature in the family-income data is exactly a parabola, but the quadratic trend might describe the data much better than a line alone. (p. 496)</p>
</blockquote>
</div>
<div id="posterior-predictive-checks-2" class="section level3 hasAnchor" number="9.3.3">
<h3><span class="header-section-number">9.3.3</span> Posterior Predictive Checks<a href="stats_method.html#posterior-predictive-checks-2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Markov chain Monte Carlo (MCMC) simulations were conducted using the brms package (Bürkner 2017) to estimate posterior predictive distributions of the parameters of interest. We ran 4 chains of 10,000 iterations with the first 5,000 discarded as burn-in. Trace-plots were utilized to visually assess model convergence.</p>
<p>check the trace plots for problems with convergence of the Markov chains</p>
<div class="sourceCode" id="cb388"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb388-1"><a href="stats_method.html#cb388-1" tabindex="-1"></a><span class="fu">plot</span>(brms_height_mape_mod)</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-374-1.png" width="1008" /><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-374-2.png" width="1008" /><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-374-3.png" width="1008" /><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-374-4.png" width="1008" /><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-374-5.png" width="1008" /></p>
<p>Sufficient convergence was checked with <span class="math inline">\(\hat{R}\)</span> values near 1 (<a href="https://scholar.google.com/scholar?cluster=14209404114665352991&amp;hl=en&amp;as_sdt=0,6">Brooks &amp; Gelman, 1998</a>).</p>
<p>in the plot below, <span class="math inline">\(\hat{R}\)</span> values are colored using different shades (lighter is better). The chosen thresholds are somewhat arbitrary, but can be useful guidelines in practice (<a href="https://mc-stan.org/bayesplot/reference/MCMC-diagnostics.html">Gabry and Mahr 2025</a>):</p>
<ul>
<li>light: below 1.05 (good)</li>
<li>mid: between 1.05 and 1.1 (ok)</li>
<li>dark: above 1.1 (too high)</li>
</ul>
<p>check our <span class="math inline">\(\hat{R}\)</span> values</p>
<div class="sourceCode" id="cb389"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb389-1"><a href="stats_method.html#cb389-1" tabindex="-1"></a>brms<span class="sc">::</span><span class="fu">mcmc_plot</span>(brms_height_mape_mod, <span class="at">type =</span> <span class="st">&quot;rhat_hist&quot;</span>) <span class="sc">+</span></span>
<span id="cb389-2"><a href="stats_method.html#cb389-2" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> scales<span class="sc">::</span><span class="fu">breaks_extended</span>(<span class="at">n =</span> <span class="dv">6</span>)) <span class="sc">+</span></span>
<span id="cb389-3"><a href="stats_method.html#cb389-3" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb389-4"><a href="stats_method.html#cb389-4" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb389-5"><a href="stats_method.html#cb389-5" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;top&quot;</span>, <span class="at">legend.direction =</span> <span class="st">&quot;horizontal&quot;</span></span>
<span id="cb389-6"><a href="stats_method.html#cb389-6" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-375-1.png" width="1008" /></p>
<p>The effective length of an MCMC chain is indicated by the effective sample size (ESS), which refers to the sample size of the MCMC chain <strong>not</strong> to the sample size of the data where acceptable values allow “for reasonably accurate and stable estimates of the limits of the 95% HDI…If accuracy of the HDI limits is not crucial for your application, then a smaller ESS may be sufficient” <a href="https://sites.google.com/site/doingbayesiandataanalysis/">(Kruschke 2015, p. 184)</a></p>
<p>Ratios of effective sample size (ESS) to total sample size with values are colored using different shades (lighter is better). A ratio close to “1” (no autocorrelation) is ideal, while a low ratio suggests the need for more samples or model re-parameterization. Efficiently mixing MCMC chains are important because they guarantee the resulting posterior samples accurately represent the true distribution of model parameters, which is necessary for reliable and precise estimation of parameter values and their associated uncertainties (credible intervals). The chosen thresholds are somewhat arbitrary, but can be useful guidelines in practice (<a href="https://mc-stan.org/bayesplot/reference/MCMC-diagnostics.html">Gabry and Mahr 2025</a>):</p>
<ul>
<li>light: between 0.5 and 1 (high)</li>
<li>mid: between 0.1 and 0.5 (good)</li>
<li>dark: below 0.1 (low)</li>
</ul>
<div class="sourceCode" id="cb390"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb390-1"><a href="stats_method.html#cb390-1" tabindex="-1"></a><span class="co"># and another effective sample size check</span></span>
<span id="cb390-2"><a href="stats_method.html#cb390-2" tabindex="-1"></a>brms<span class="sc">::</span><span class="fu">mcmc_plot</span>(brms_height_mape_mod, <span class="at">type =</span> <span class="st">&quot;neff_hist&quot;</span>) <span class="sc">+</span></span>
<span id="cb390-3"><a href="stats_method.html#cb390-3" tabindex="-1"></a><span class="co"># brms::mcmc_plot(brms_height_mape_mod, type = &quot;neff&quot;) +</span></span>
<span id="cb390-4"><a href="stats_method.html#cb390-4" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="cn">NA</span>), <span class="at">breaks =</span> scales<span class="sc">::</span><span class="fu">breaks_extended</span>(<span class="at">n =</span> <span class="dv">9</span>)) <span class="sc">+</span></span>
<span id="cb390-5"><a href="stats_method.html#cb390-5" tabindex="-1"></a>  <span class="co"># ggplot2::scale_color_discrete(drop = F) +</span></span>
<span id="cb390-6"><a href="stats_method.html#cb390-6" tabindex="-1"></a>  <span class="co"># ggplot2::scale_fill_discrete(drop = F) +</span></span>
<span id="cb390-7"><a href="stats_method.html#cb390-7" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb390-8"><a href="stats_method.html#cb390-8" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb390-9"><a href="stats_method.html#cb390-9" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;top&quot;</span>, <span class="at">legend.direction =</span> <span class="st">&quot;horizontal&quot;</span></span>
<span id="cb390-10"><a href="stats_method.html#cb390-10" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-376-1.png" width="1008" /></p>
<p>Posterior predictive checks were used to evaluate model goodness-of-fit by comparing data simulated from the model with the observed data used to estimate the model parameters (<a href="https://scholar.google.com/scholar?cluster=9228589188684720156&amp;hl=en&amp;as_sdt=0,6">Hobbs &amp; Hooten, 2015</a>). Calculating the proportion of MCMC iterations in which the test statistic (i.e., mean and sum of squares) from the simulated data and observed data are more extreme than one another provides the Bayesian p-value. Lack of fit is indicated by a value close to 0 or 1 while a value of 0.5 indicates perfect fit (<a href="https://scholar.google.com/scholar?cluster=9228589188684720156&amp;hl=en&amp;as_sdt=0,6">Hobbs &amp; Hooten, 2015</a>).</p>
<p>To learn more about this approach to posterior predictive checks, check out Gabry’s (2025) vignette, <a href="https://cran.r-project.org/web/packages/bayesplot/vignettes/graphical-ppcs.html">Graphical posterior predictive checks using the bayesplot package</a>.</p>
<p>posterior-predictive check to make sure the model does an okay job simulating data that resemble the sample data. our objective is to construct the model such that it faithfully represents the data.</p>
<div class="sourceCode" id="cb391"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb391-1"><a href="stats_method.html#cb391-1" tabindex="-1"></a><span class="co"># posterior predictive check</span></span>
<span id="cb391-2"><a href="stats_method.html#cb391-2" tabindex="-1"></a>brms<span class="sc">::</span><span class="fu">pp_check</span>(</span>
<span id="cb391-3"><a href="stats_method.html#cb391-3" tabindex="-1"></a>    brms_height_mape_mod</span>
<span id="cb391-4"><a href="stats_method.html#cb391-4" tabindex="-1"></a>    , <span class="at">type =</span> <span class="st">&quot;dens_overlay&quot;</span></span>
<span id="cb391-5"><a href="stats_method.html#cb391-5" tabindex="-1"></a>    , <span class="at">ndraws =</span> <span class="dv">100</span></span>
<span id="cb391-6"><a href="stats_method.html#cb391-6" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb391-7"><a href="stats_method.html#cb391-7" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;posterior-predictive check (overlaid densities)&quot;</span>) <span class="sc">+</span></span>
<span id="cb391-8"><a href="stats_method.html#cb391-8" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb391-9"><a href="stats_method.html#cb391-9" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb391-10"><a href="stats_method.html#cb391-10" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb391-11"><a href="stats_method.html#cb391-11" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;top&quot;</span>, <span class="at">legend.direction =</span> <span class="st">&quot;horizontal&quot;</span></span>
<span id="cb391-12"><a href="stats_method.html#cb391-12" tabindex="-1"></a>    , <span class="at">legend.text =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>)</span>
<span id="cb391-13"><a href="stats_method.html#cb391-13" tabindex="-1"></a>    , <span class="at">plot.subtitle =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>)</span>
<span id="cb391-14"><a href="stats_method.html#cb391-14" tabindex="-1"></a>    , <span class="at">plot.title =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">9</span>)</span>
<span id="cb391-15"><a href="stats_method.html#cb391-15" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-377-1.png" width="1008" /></p>
<p>another way</p>
<div class="sourceCode" id="cb392"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb392-1"><a href="stats_method.html#cb392-1" tabindex="-1"></a>brms<span class="sc">::</span><span class="fu">pp_check</span>(brms_height_mape_mod, <span class="at">type =</span> <span class="st">&quot;ecdf_overlay&quot;</span>, <span class="at">ndraws =</span> <span class="dv">100</span>) <span class="sc">+</span></span>
<span id="cb392-2"><a href="stats_method.html#cb392-2" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;posterior-predictive check (ECDF: empirical cumulative distribution function)&quot;</span>) <span class="sc">+</span> </span>
<span id="cb392-3"><a href="stats_method.html#cb392-3" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb392-4"><a href="stats_method.html#cb392-4" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb392-5"><a href="stats_method.html#cb392-5" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;top&quot;</span>, <span class="at">legend.direction =</span> <span class="st">&quot;horizontal&quot;</span></span>
<span id="cb392-6"><a href="stats_method.html#cb392-6" tabindex="-1"></a>    , <span class="at">legend.text =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>)</span>
<span id="cb392-7"><a href="stats_method.html#cb392-7" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-378-1.png" width="1008" /></p>
</div>
<div id="conditional-effects-2" class="section level3 hasAnchor" number="9.3.4">
<h3><span class="header-section-number">9.3.4</span> Conditional Effects<a href="stats_method.html#conditional-effects-2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>first, lets look at densities of the posterior samples per parameter</p>
<div class="sourceCode" id="cb393"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb393-1"><a href="stats_method.html#cb393-1" tabindex="-1"></a>brms<span class="sc">::</span><span class="fu">mcmc_plot</span>(brms_height_mape_mod, <span class="at">type =</span> <span class="st">&quot;dens&quot;</span>) <span class="sc">+</span></span>
<span id="cb393-2"><a href="stats_method.html#cb393-2" tabindex="-1"></a>  <span class="co"># ggplot2::theme_light() +</span></span>
<span id="cb393-3"><a href="stats_method.html#cb393-3" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb393-4"><a href="stats_method.html#cb393-4" tabindex="-1"></a>    <span class="at">strip.text =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="fl">7.5</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>)</span>
<span id="cb393-5"><a href="stats_method.html#cb393-5" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-379-1.png" width="1008" /></p>
<p>and we can look at the default coefficient plot that is commonly used in reporting coefficient “significance” in frequentist analysis</p>
<div class="sourceCode" id="cb394"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb394-1"><a href="stats_method.html#cb394-1" tabindex="-1"></a><span class="co"># easy way to get the default coeff plot</span></span>
<span id="cb394-2"><a href="stats_method.html#cb394-2" tabindex="-1"></a>brms<span class="sc">::</span><span class="fu">mcmc_plot</span>(brms_height_mape_mod, <span class="at">variable =</span> <span class="st">&quot;</span><span class="sc">\\</span><span class="st">bb_&quot;</span>, <span class="at">regex =</span> T, <span class="at">type =</span> <span class="st">&quot;intervals&quot;</span>)</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-380-1.png" width="1008" /></p>
<p>Regarding interactions and polynomial models like the one we use, <a href="https://xcelab.net/rm/">McElreath (2015)</a> notes:</p>
<blockquote>
<p>parameters are the linear and square components of the curve, respectively. But that doesn’t make them transparent. You have to plot these model fits to understand what they are saying. (p. 112-113)</p>
</blockquote>
<p>all of the interactions and the quadradic trend of this model combine to make these coefficients by themselves uninterpretable as the coefficients are only meaningful in the context of the other terms in the interaction or by adding the quadratic component</p>
<p>we can do this by checking for the main effects of the individual variables on Height MAPE (averages across all other effects)</p>
<div class="sourceCode" id="cb395"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb395-1"><a href="stats_method.html#cb395-1" tabindex="-1"></a>brms<span class="sc">::</span><span class="fu">conditional_effects</span>(brms_height_mape_mod)</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-381-1.png" width="1008" /><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-381-2.png" width="1008" /><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-381-3.png" width="1008" /><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-381-4.png" width="1008" /><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-381-5.png" width="1008" /><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-381-6.png" width="1008" /><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-381-7.png" width="1008" /><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-381-8.png" width="1008" /><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-381-9.png" width="1008" /><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-381-10.png" width="1008" /></p>
</div>
<div id="posterior-predictive-expectation-1" class="section level3 hasAnchor" number="9.3.5">
<h3><span class="header-section-number">9.3.5</span> Posterior Predictive Expectation<a href="stats_method.html#posterior-predictive-expectation-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>we will test our hypotheses using the posterior distributions of the expected values (i.e., the posterior predictions of the mean) obtained via <code>tidybayes::add_epred_draws()</code>. our analysis will include two stages using parameter levels of the four structural parameters: <code>max_ht_m</code>, <code>max_area_m2</code>, <code>convexity_pct</code>, <code>circle_fit_iou_pct</code>. in practice, these values should be informed by the treatment prescription implemented on the ground.</p>
<p>In the first stage, we will fix the <code>max_ht_m</code> and <code>max_area_m2</code> parameters at levels expected based on the treatment and slash pile construction prescription implemented on the ground. We will then explore the influence of the two geometric shape filtering parameters (<code>circle_fit_iou_pct</code> and <code>convexity_pct</code>) over different levels of the <code>spectral_weight</code> parameter and CHM resolution data.</p>
<p>In the second stage, we will fix all four structural parameters (<code>max_ht_m</code>, <code>max_area_m2</code>, <code>convexity_pct</code>, <code>circle_fit_iou_pct</code>) to explore the influence of the input data, which includes the presence or absence of spectral data and its weighting (i.e. <code>spectral_weight</code>) as well as the CHM resolution (<code>chm_res_m</code>). As in the first stage, the <code>max_ht_m</code>, <code>max_area_m2</code> parameters will be fixed at expected levels based on the slash pile construction prescription while the <code>convexity_pct</code>, <code>circle_fit_iou_pct</code> are fixed at the optimal levels determined based on the Bayesian posterior predictive distribution of <a href="stats_method.html#f_score_epred">detection accuracy</a></p>
<p>as a reminder, here are those parameter levels</p>
<div class="sourceCode" id="cb396"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb396-1"><a href="stats_method.html#cb396-1" tabindex="-1"></a>structural_params_settings <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">glimpse</span>()</span></code></pre></div>
<pre><code>## Rows: 1
## Columns: 4
## $ circle_fit_iou_pct &lt;dbl&gt; 0.35
## $ convexity_pct      &lt;dbl&gt; 0.36
## $ max_ht_m           &lt;dbl&gt; 2.3
## $ max_area_m2        &lt;dbl&gt; 46</code></pre>
<p>now we’ll get the posterior predictive draws but over a range of <code>circle_fit_iou_pct</code> and <code>convexity_pct</code> including the best setting</p>
<div class="sourceCode" id="cb398"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb398-1"><a href="stats_method.html#cb398-1" tabindex="-1"></a>seq_temp <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fl">0.05</span>, <span class="at">to =</span> <span class="fl">1.0</span>, <span class="at">by =</span> <span class="fl">0.1</span>)</span>
<span id="cb398-2"><a href="stats_method.html#cb398-2" tabindex="-1"></a>seq2_temp <span class="ot">&lt;-</span> seq_temp[<span class="fu">seq</span>(<span class="dv">1</span>, <span class="fu">length</span>(seq_temp), <span class="at">by =</span> <span class="dv">2</span>)] <span class="co"># get every other element</span></span>
<span id="cb398-3"><a href="stats_method.html#cb398-3" tabindex="-1"></a><span class="co"># draws</span></span>
<span id="cb398-4"><a href="stats_method.html#cb398-4" tabindex="-1"></a>draws_temp <span class="ot">&lt;-</span> </span>
<span id="cb398-5"><a href="stats_method.html#cb398-5" tabindex="-1"></a>  <span class="co"># get the draws for levels of </span></span>
<span id="cb398-6"><a href="stats_method.html#cb398-6" tabindex="-1"></a>  <span class="co"># spectral_weight circle_fit_iou_pct convexity_pct</span></span>
<span id="cb398-7"><a href="stats_method.html#cb398-7" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">crossing</span>(</span>
<span id="cb398-8"><a href="stats_method.html#cb398-8" tabindex="-1"></a>    param_combos_spectral_ranked <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">distinct</span>(spectral_weight)</span>
<span id="cb398-9"><a href="stats_method.html#cb398-9" tabindex="-1"></a>    , <span class="at">circle_fit_iou_pct =</span> seq_temp <span class="sc">%&gt;%</span> <span class="fu">unique</span>()</span>
<span id="cb398-10"><a href="stats_method.html#cb398-10" tabindex="-1"></a>    , <span class="at">convexity_pct =</span> seq_temp <span class="sc">%&gt;%</span> <span class="fu">unique</span>()</span>
<span id="cb398-11"><a href="stats_method.html#cb398-11" tabindex="-1"></a>    , <span class="at">chm_res_m =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fl">0.1</span>, <span class="at">to =</span> <span class="fl">1.0</span>, <span class="at">by =</span> <span class="fl">0.1</span>)</span>
<span id="cb398-12"><a href="stats_method.html#cb398-12" tabindex="-1"></a>    , <span class="at">max_ht_m =</span> structural_params_settings<span class="sc">$</span>max_ht_m</span>
<span id="cb398-13"><a href="stats_method.html#cb398-13" tabindex="-1"></a>    , <span class="at">max_area_m2 =</span> structural_params_settings<span class="sc">$</span>max_area_m2</span>
<span id="cb398-14"><a href="stats_method.html#cb398-14" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb398-15"><a href="stats_method.html#cb398-15" tabindex="-1"></a>  <span class="co"># dplyr::glimpse()</span></span>
<span id="cb398-16"><a href="stats_method.html#cb398-16" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">add_epred_draws</span>(brms_height_mape_mod, <span class="at">ndraws =</span> <span class="dv">1111</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb398-17"><a href="stats_method.html#cb398-17" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">value =</span> .epred) <span class="sc">%&gt;%</span> </span>
<span id="cb398-18"><a href="stats_method.html#cb398-18" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb398-19"><a href="stats_method.html#cb398-19" tabindex="-1"></a>    <span class="at">is_seq =</span> (convexity_pct <span class="sc">%in%</span> seq_temp) <span class="sc">&amp;</span> (circle_fit_iou_pct <span class="sc">%in%</span> seq_temp)</span>
<span id="cb398-20"><a href="stats_method.html#cb398-20" tabindex="-1"></a>  )</span>
<span id="cb398-21"><a href="stats_method.html#cb398-21" tabindex="-1"></a><span class="co"># # huh?</span></span>
<span id="cb398-22"><a href="stats_method.html#cb398-22" tabindex="-1"></a>draws_temp <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">glimpse</span>()</span></code></pre></div>
<pre><code>## Rows: 6,666,000
## Columns: 12
## Groups: spectral_weight, circle_fit_iou_pct, convexity_pct, chm_res_m, max_ht_m, max_area_m2, .row [6,000]
## $ spectral_weight    &lt;fct&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, …
## $ circle_fit_iou_pct &lt;dbl&gt; 0.05, 0.05, 0.05, 0.05, 0.05, 0.05, 0.05, 0.05, 0.0…
## $ convexity_pct      &lt;dbl&gt; 0.05, 0.05, 0.05, 0.05, 0.05, 0.05, 0.05, 0.05, 0.0…
## $ chm_res_m          &lt;dbl&gt; 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0…
## $ max_ht_m           &lt;dbl&gt; 2.3, 2.3, 2.3, 2.3, 2.3, 2.3, 2.3, 2.3, 2.3, 2.3, 2…
## $ max_area_m2        &lt;dbl&gt; 46, 46, 46, 46, 46, 46, 46, 46, 46, 46, 46, 46, 46,…
## $ .row               &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, …
## $ .chain             &lt;int&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
## $ .iteration         &lt;int&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
## $ .draw              &lt;int&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, …
## $ value              &lt;dbl&gt; 0.1795179, 0.1804930, 0.1812731, 0.1823152, 0.18121…
## $ is_seq             &lt;lgl&gt; TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRU…</code></pre>
<div id="geometric-shape-regularity-2" class="section level4 hasAnchor" number="9.3.5.1">
<h4><span class="header-section-number">9.3.5.1</span> Geometric shape regularity<a href="stats_method.html#geometric-shape-regularity-2" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>let’s look at the influence of the parameters that control the geometric shape regularity filtering: <code>circle_fit_iou_pct</code> and <code>convexity_pct</code>. to do this, we will fix the <code>max_ht_m</code> and <code>max_area_m2</code> parameters at levels expected based on the treatment and slash pile construction prescription implemented on the ground.</p>
<p>In the first stage, we will fix the <code>max_ht_m</code> and <code>max_area_m2</code> parameters at levels expected based on the treatment and slash pile construction prescription implemented on the ground. We will then explore the influence of the two geometric shape filtering parameters (<code>circle_fit_iou_pct</code> and <code>convexity_pct</code>) over different levels of the <code>spectral_weight</code> parameter and CHM resolution data.</p>
<p>In the second stage, we will fix all four structural parameters (<code>max_ht_m</code>, <code>max_area_m2</code>, <code>convexity_pct</code>, <code>circle_fit_iou_pct</code>) to explore the influence of the input data, which includes the presence or absence of spectral data and its weighting (i.e. <code>spectral_weight</code>) as well as the CHM resolution (<code>chm_res_m</code>). As in the first stage, the <code>max_ht_m</code>, <code>max_area_m2</code> parameters will be fixed at expected levels based on the slash pile construction prescription while the <code>convexity_pct</code>, <code>circle_fit_iou_pct</code> will be fixed at the optimal levels determined based on the Bayesian posterior predictive distribution of <a href="stats_method.html#f_score_epred">detection accuracy</a></p>
<div id="circle_fit_iou_pct-2" class="section level5 hasAnchor" number="9.3.5.1.1">
<h5><span class="header-section-number">9.3.5.1.1</span> <code>circle_fit_iou_pct</code><a href="stats_method.html#circle_fit_iou_pct-2" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>we need to look at the influence of <code>circle_fit_iou_pct</code> in the context of the other terms in the interaction</p>
<div class="sourceCode" id="cb400"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb400-1"><a href="stats_method.html#cb400-1" tabindex="-1"></a>draws_temp <span class="sc">%&gt;%</span></span>
<span id="cb400-2"><a href="stats_method.html#cb400-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb400-3"><a href="stats_method.html#cb400-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(</span>
<span id="cb400-4"><a href="stats_method.html#cb400-4" tabindex="-1"></a>    is_seq</span>
<span id="cb400-5"><a href="stats_method.html#cb400-5" tabindex="-1"></a>    , chm_res_m <span class="sc">%in%</span> <span class="fu">seq</span>(<span class="fl">0.1</span>,<span class="fl">0.5</span>,<span class="at">by=</span><span class="fl">0.2</span>)</span>
<span id="cb400-6"><a href="stats_method.html#cb400-6" tabindex="-1"></a>    , convexity_pct <span class="sc">%in%</span> seq2_temp</span>
<span id="cb400-7"><a href="stats_method.html#cb400-7" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb400-8"><a href="stats_method.html#cb400-8" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">convexity_pct =</span> <span class="fu">factor</span>(convexity_pct, <span class="at">ordered =</span> T)) <span class="sc">%&gt;%</span> </span>
<span id="cb400-9"><a href="stats_method.html#cb400-9" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> circle_fit_iou_pct, <span class="at">y =</span> value, <span class="at">color =</span> convexity_pct)) <span class="sc">+</span></span>
<span id="cb400-10"><a href="stats_method.html#cb400-10" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">stat_lineribbon</span>(</span>
<span id="cb400-11"><a href="stats_method.html#cb400-11" tabindex="-1"></a>    <span class="at">point_interval =</span> <span class="st">&quot;median_hdi&quot;</span>, <span class="at">.width =</span> <span class="fu">c</span>(<span class="fl">0.95</span>)</span>
<span id="cb400-12"><a href="stats_method.html#cb400-12" tabindex="-1"></a>    , <span class="at">lwd =</span> <span class="fl">1.1</span></span>
<span id="cb400-13"><a href="stats_method.html#cb400-13" tabindex="-1"></a>    , <span class="at">fill =</span> <span class="cn">NA</span></span>
<span id="cb400-14"><a href="stats_method.html#cb400-14" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb400-15"><a href="stats_method.html#cb400-15" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">facet_grid</span>(<span class="at">cols =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(spectral_weight), <span class="at">rows =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(chm_res_m), <span class="at">labeller =</span> <span class="st">&quot;label_both&quot;</span>, <span class="at">scales =</span> <span class="st">&quot;free_y&quot;</span>) <span class="sc">+</span></span>
<span id="cb400-16"><a href="stats_method.html#cb400-16" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_fill_brewer</span>(<span class="at">palette =</span> <span class="st">&quot;Greys&quot;</span>) <span class="sc">+</span></span>
<span id="cb400-17"><a href="stats_method.html#cb400-17" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_color_viridis_d</span>(<span class="at">option =</span> <span class="st">&quot;mako&quot;</span>, <span class="at">begin =</span> <span class="fl">0.6</span>, <span class="at">end =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb400-18"><a href="stats_method.html#cb400-18" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb400-19"><a href="stats_method.html#cb400-19" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>percent) <span class="sc">+</span></span>
<span id="cb400-20"><a href="stats_method.html#cb400-20" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb400-21"><a href="stats_method.html#cb400-21" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;conditional effect of `circle_fit_iou_pct` on Height MAPE&quot;</span></span>
<span id="cb400-22"><a href="stats_method.html#cb400-22" tabindex="-1"></a>    <span class="co"># , subtitle = &quot;Faceted by spectral_weight and chm_res_m&quot;</span></span>
<span id="cb400-23"><a href="stats_method.html#cb400-23" tabindex="-1"></a>    , <span class="at">x =</span> <span class="st">&quot;`circle_fit_iou_pct`&quot;</span></span>
<span id="cb400-24"><a href="stats_method.html#cb400-24" tabindex="-1"></a>    , <span class="at">y =</span> <span class="st">&quot;Height MAPE&quot;</span></span>
<span id="cb400-25"><a href="stats_method.html#cb400-25" tabindex="-1"></a>    , <span class="at">color =</span> <span class="st">&quot;`convexity_pct`&quot;</span></span>
<span id="cb400-26"><a href="stats_method.html#cb400-26" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb400-27"><a href="stats_method.html#cb400-27" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb400-28"><a href="stats_method.html#cb400-28" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb400-29"><a href="stats_method.html#cb400-29" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;top&quot;</span></span>
<span id="cb400-30"><a href="stats_method.html#cb400-30" tabindex="-1"></a>    , <span class="at">strip.text.x =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb400-31"><a href="stats_method.html#cb400-31" tabindex="-1"></a>    , <span class="at">strip.text.y =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb400-32"><a href="stats_method.html#cb400-32" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb400-33"><a href="stats_method.html#cb400-33" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">guides</span>(</span>
<span id="cb400-34"><a href="stats_method.html#cb400-34" tabindex="-1"></a>    <span class="at">color =</span> ggplot2<span class="sc">::</span><span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">shape =</span> <span class="dv">15</span>, <span class="at">lwd =</span> <span class="dv">8</span>, <span class="at">fill =</span> <span class="cn">NA</span>))</span>
<span id="cb400-35"><a href="stats_method.html#cb400-35" tabindex="-1"></a>    , <span class="at">fill =</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb400-36"><a href="stats_method.html#cb400-36" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-385-1.png" width="1008" /></p>
<p>For all of these faceted plots, note the variation in the y-axis (Predicted Height MAPE) range across different CHM resolution levels. The influence of the <code>circle_fit_iou_pct</code> parameter on the Height MAPE is dependent on the CHM resolution but, unlike diameter quantification, its trend does not change based on the <code>convexity_pct</code> parameter setting. The magnitude of this influence decreases with finer data: for the finest resolution CHM data (0.1m), changes in <code>circle_fit_iou_pct</code> only shift the MAPE by approximately 6 percentage points, while for the coarsest resolution CHM data (0.5m), the shift in MAPE is approximately 11 percentage points as <code>circle_fit_iou_pct</code> is varied. There is a notable shift in the influence of the <code>circle_fit_iou_pct</code> parameter as CHM resolution moves from fine to coarse. With fine resolution CHM data (0.1m), height quantification accuracy improves (MAPE decreases) as the <code>circle_fit_iou_pct</code> parameter is increased toward its highest setting of ‘1’, with improvements stabilizing around 0.6. For moderate resolution CHM data (0.3m), the parabolic relationship between the <code>circle_fit_iou_pct</code> parameter and the Height MAPE becomes evident. Height accuracy is optimized at low-intermediate levels of the <code>circle_fit_iou_pct</code> parameter (e.g., 0.25–0.5), and height quantification accuracy steeply declines (MAPE increases) for values set above this level. For coarse resolution CHM data (0.5m), there is a consistent decrease in height quantification accuracy (increase in MAPE) as the <code>circle_fit_iou_pct</code> parameter is increased toward its highest setting of ‘1’; this trend is opposite of what was found for the fine resolution CHM data. With coarse resolution CHM data, the best height accuracy is achieved at the lowest <code>circle_fit_iou_pct</code> parameter settings, near ‘0’. These seemingly conflicting trends likely occur because the coarser resolution CHM data smoothes out variation in height from the aerial point cloud, while the variability in the elevation profile within a detected slash pile is retained when using finer resolution data.</p>
</div>
<div id="convexity_pct-2" class="section level5 hasAnchor" number="9.3.5.1.2">
<h5><span class="header-section-number">9.3.5.1.2</span> <code>convexity_pct</code><a href="stats_method.html#convexity_pct-2" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>we need to look at the influence of <code>convexity_pct</code> in the context of the other terms in the interaction</p>
<div class="sourceCode" id="cb401"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb401-1"><a href="stats_method.html#cb401-1" tabindex="-1"></a>draws_temp <span class="sc">%&gt;%</span></span>
<span id="cb401-2"><a href="stats_method.html#cb401-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb401-3"><a href="stats_method.html#cb401-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(</span>
<span id="cb401-4"><a href="stats_method.html#cb401-4" tabindex="-1"></a>    is_seq</span>
<span id="cb401-5"><a href="stats_method.html#cb401-5" tabindex="-1"></a>    , chm_res_m <span class="sc">%in%</span> <span class="fu">seq</span>(<span class="fl">0.1</span>,<span class="fl">0.5</span>,<span class="at">by=</span><span class="fl">0.2</span>)</span>
<span id="cb401-6"><a href="stats_method.html#cb401-6" tabindex="-1"></a>    , circle_fit_iou_pct <span class="sc">%in%</span> seq2_temp</span>
<span id="cb401-7"><a href="stats_method.html#cb401-7" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb401-8"><a href="stats_method.html#cb401-8" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">circle_fit_iou_pct =</span> <span class="fu">factor</span>(circle_fit_iou_pct, <span class="at">ordered =</span> T)) <span class="sc">%&gt;%</span> </span>
<span id="cb401-9"><a href="stats_method.html#cb401-9" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> convexity_pct, <span class="at">y =</span> value, <span class="at">color =</span> circle_fit_iou_pct)) <span class="sc">+</span></span>
<span id="cb401-10"><a href="stats_method.html#cb401-10" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">stat_lineribbon</span>(</span>
<span id="cb401-11"><a href="stats_method.html#cb401-11" tabindex="-1"></a>    <span class="at">point_interval =</span> <span class="st">&quot;median_hdi&quot;</span>, <span class="at">.width =</span> <span class="fu">c</span>(<span class="fl">0.95</span>)</span>
<span id="cb401-12"><a href="stats_method.html#cb401-12" tabindex="-1"></a>    , <span class="at">lwd =</span> <span class="fl">1.1</span></span>
<span id="cb401-13"><a href="stats_method.html#cb401-13" tabindex="-1"></a>    , <span class="at">fill =</span> <span class="cn">NA</span></span>
<span id="cb401-14"><a href="stats_method.html#cb401-14" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb401-15"><a href="stats_method.html#cb401-15" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">facet_grid</span>(<span class="at">cols =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(spectral_weight), <span class="at">rows =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(chm_res_m), <span class="at">labeller =</span> <span class="st">&quot;label_both&quot;</span>, <span class="at">scales =</span> <span class="st">&quot;free_y&quot;</span>) <span class="sc">+</span></span>
<span id="cb401-16"><a href="stats_method.html#cb401-16" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_fill_brewer</span>(<span class="at">palette =</span> <span class="st">&quot;Greys&quot;</span>) <span class="sc">+</span></span>
<span id="cb401-17"><a href="stats_method.html#cb401-17" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_color_viridis_d</span>(<span class="at">option =</span> <span class="st">&quot;magma&quot;</span>, <span class="at">begin =</span> <span class="fl">0.5</span>, <span class="at">end =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb401-18"><a href="stats_method.html#cb401-18" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb401-19"><a href="stats_method.html#cb401-19" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>percent) <span class="sc">+</span></span>
<span id="cb401-20"><a href="stats_method.html#cb401-20" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb401-21"><a href="stats_method.html#cb401-21" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;conditional effect of `convexity_pct` on Height MAPE&quot;</span></span>
<span id="cb401-22"><a href="stats_method.html#cb401-22" tabindex="-1"></a>    <span class="co"># , subtitle = &quot;Faceted by spectral_weight and chm_res_m&quot;</span></span>
<span id="cb401-23"><a href="stats_method.html#cb401-23" tabindex="-1"></a>    , <span class="at">x =</span> <span class="st">&quot;`convexity_pct`&quot;</span></span>
<span id="cb401-24"><a href="stats_method.html#cb401-24" tabindex="-1"></a>    , <span class="at">y =</span> <span class="st">&quot;Height MAPE&quot;</span></span>
<span id="cb401-25"><a href="stats_method.html#cb401-25" tabindex="-1"></a>    , <span class="at">color =</span> <span class="st">&quot;`circle_fit_iou_pct`&quot;</span></span>
<span id="cb401-26"><a href="stats_method.html#cb401-26" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb401-27"><a href="stats_method.html#cb401-27" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb401-28"><a href="stats_method.html#cb401-28" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb401-29"><a href="stats_method.html#cb401-29" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;top&quot;</span></span>
<span id="cb401-30"><a href="stats_method.html#cb401-30" tabindex="-1"></a>    , <span class="at">strip.text.x =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb401-31"><a href="stats_method.html#cb401-31" tabindex="-1"></a>    , <span class="at">strip.text.y =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb401-32"><a href="stats_method.html#cb401-32" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb401-33"><a href="stats_method.html#cb401-33" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">guides</span>(</span>
<span id="cb401-34"><a href="stats_method.html#cb401-34" tabindex="-1"></a>    <span class="at">color =</span> ggplot2<span class="sc">::</span><span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">shape =</span> <span class="dv">15</span>, <span class="at">lwd =</span> <span class="dv">8</span>, <span class="at">fill =</span> <span class="cn">NA</span>))</span>
<span id="cb401-35"><a href="stats_method.html#cb401-35" tabindex="-1"></a>    , <span class="at">fill =</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb401-36"><a href="stats_method.html#cb401-36" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-386-1.png" width="1008" /></p>
<p>The model shows that the influence of the <code>convexity_pct</code> parameter on the Height MAPE is primarily conditional on the CHM resolution. The <code>circle_fit_iou_pct</code> parameter further influences the relationship between <code>convexity_pct</code> and height quantification accuracy but only at intermediate CHM resolutions (0.3m). Conversely, at the finest (0.1m) and coarsest (0.5m) CHM data levels, the <code>circle_fit_iou_pct</code> parameter does not alter the relationship between <code>convexity_pct</code> and Height MAPE but alters the magnitude of the influence. The magnitude of the <code>convexity_pct</code> parameter’s influence on Height MAPE is lowest for intermediate CHM resolutions (0.3m), with changes in the parameter only resulting in approximately 1.5 percentage point shifts in MAPE. The influence is significantly larger for other resolutions, causing a 6 percentage point shift over the <code>convexity_pct</code> range at finer resolutions (e.g. 0.1m) and a 10 percentage point influence at coarser resolutions (e.g. 0.5m). There is a notable shift in the optimal trend of the <code>convexity_pct</code> parameter as CHM resolution changes. With fine resolution CHM data (0.1m), height quantification accuracy improves (MAPE decreases) in a very linear trend as the <code>convexity_pct</code> parameter is decreased toward its lowest setting of ‘0’. This indicates that allowing for less regular (more concave/less smooth) segments yields better height accuracy at the finest resolution. This trend reverses for coarse resolution CHM data (0.5m), where there is a consistent decrease in height quantification accuracy (increase in MAPE) as the <code>convexity_pct</code> parameter is decreased toward its lowest setting of ‘0’. With coarse resolution CHM data, the best height accuracy is achieved at the highest <code>convexity_pct</code> parameter settings, near ‘1’. This suggests that at coarser resolutions, a very strict shape requirement is necessary to minimize errors in height estimation. Additionally, for coarser resolution data, the penalty in height quantification accuracy for decreasing <code>convexity_pct</code> toward 0 is steeper when the <code>circle_fit_iou_pct</code> parameter is set to higher levels (e.g., greater than 0.65) than when <code>circle_fit_iou_pct</code> is set to lower values (e.g., less than 0.25). This heightened penalty occurs because simultaneously requiring a pile to be highly circular (<code>circle_fit_iou_pct</code> high) and allowing it to be highly irregular (<code>convexity_pct</code> low) introduces high geometric uncertainty into the segmented area used for height calculation, making such a parameter combination unlikely to be applicable for optimizing height quantification accuracy using this pile detection method.</p>
</div>
<div id="optimizing-geometric-filtering-2" class="section level5 hasAnchor" number="9.3.5.1.3">
<h5><span class="header-section-number">9.3.5.1.3</span> Optimizing geometric filtering<a href="stats_method.html#optimizing-geometric-filtering-2" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>Given the complexity of our model, which includes a non-linear link function and parameter interactions, calculating the optimal parameter values by solving for them algebraically from the model’s coefficients would be prone to error. instead, we can use a robust Bayesian approach that leverages the model’s posterior predictive distribution. This method is powerful because it inherently accounts for all sources of model uncertainty.</p>
<p>first, we’ll generate a large number of predictions across a fine grid of parameter values (e.g. in steps of 0.01) for each posterior draw of the model coefficients. we’ll generate a large number (e.g. 1000+) of posterior predictive draws for each combination of parameter values. for each posterior predictive draw, we’ll then identify the parameter combination that maximizes the Height MAPE and we’ll be left with a posterior distribution of optimal parameter combinations.</p>
<p>this approach demonstrates a key advantage of the Bayesian framework, allowing us to ask complex questions and find the most probable optimal parameter combination while fully accounting for uncertainty.</p>
<p>note, we only extract draws based on not using any spectral data (i.e. <code>spectral_weight</code> = 0) to save on plotting space and because we expect form quantification to only be minimally influenced by the inclusion of spectral data</p>
<div class="sourceCode" id="cb402"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb402-1"><a href="stats_method.html#cb402-1" tabindex="-1"></a><span class="co"># let&#39;s get the draws at a very granular level</span></span>
<span id="cb402-2"><a href="stats_method.html#cb402-2" tabindex="-1"></a>vertex_draws_temp <span class="ot">&lt;-</span> </span>
<span id="cb402-3"><a href="stats_method.html#cb402-3" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">crossing</span>(</span>
<span id="cb402-4"><a href="stats_method.html#cb402-4" tabindex="-1"></a>    param_combos_spectral_ranked <span class="sc">%&gt;%</span> </span>
<span id="cb402-5"><a href="stats_method.html#cb402-5" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">filter</span>(spectral_weight<span class="sc">==</span><span class="st">&quot;0&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb402-6"><a href="stats_method.html#cb402-6" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">distinct</span>(spectral_weight, spectral_weight_fact)</span>
<span id="cb402-7"><a href="stats_method.html#cb402-7" tabindex="-1"></a>    , <span class="at">circle_fit_iou_pct =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fl">0.0</span>, <span class="at">to =</span> <span class="dv">1</span>, <span class="at">by =</span> <span class="fl">0.01</span>) <span class="co"># very granular to identify vertex</span></span>
<span id="cb402-8"><a href="stats_method.html#cb402-8" tabindex="-1"></a>    , <span class="at">convexity_pct =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fl">0.0</span>, <span class="at">to =</span> <span class="dv">1</span>, <span class="at">by =</span> <span class="fl">0.02</span>) <span class="co"># very granular to identify vertex</span></span>
<span id="cb402-9"><a href="stats_method.html#cb402-9" tabindex="-1"></a>    , <span class="at">chm_res_m =</span> <span class="fu">seq</span>(<span class="fl">0.1</span>,<span class="fl">0.5</span>,<span class="at">by=</span><span class="fl">0.1</span>)</span>
<span id="cb402-10"><a href="stats_method.html#cb402-10" tabindex="-1"></a>    , <span class="at">max_ht_m =</span> structural_params_settings<span class="sc">$</span>max_ht_m</span>
<span id="cb402-11"><a href="stats_method.html#cb402-11" tabindex="-1"></a>    , <span class="at">max_area_m2 =</span> structural_params_settings<span class="sc">$</span>max_area_m2</span>
<span id="cb402-12"><a href="stats_method.html#cb402-12" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb402-13"><a href="stats_method.html#cb402-13" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">add_epred_draws</span>(brms_height_mape_mod, <span class="at">ndraws =</span> <span class="dv">1000</span>, <span class="at">value =</span> <span class="st">&quot;value&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb402-14"><a href="stats_method.html#cb402-14" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb402-15"><a href="stats_method.html#cb402-15" tabindex="-1"></a>  <span class="co"># for each draw, get the highest Height MAPE by chm_res_m, spectral_weight</span></span>
<span id="cb402-16"><a href="stats_method.html#cb402-16" tabindex="-1"></a>  <span class="co"># which we&#39;ll use to identify the optimal circle_fit_iou_pct,convexity_pct settings</span></span>
<span id="cb402-17"><a href="stats_method.html#cb402-17" tabindex="-1"></a>  <span class="co"># these are essentially &quot;votes&quot; based on likelihood</span></span>
<span id="cb402-18"><a href="stats_method.html#cb402-18" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(</span>
<span id="cb402-19"><a href="stats_method.html#cb402-19" tabindex="-1"></a>    .draw</span>
<span id="cb402-20"><a href="stats_method.html#cb402-20" tabindex="-1"></a>    , chm_res_m, spectral_weight</span>
<span id="cb402-21"><a href="stats_method.html#cb402-21" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb402-22"><a href="stats_method.html#cb402-22" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(value,circle_fit_iou_pct,convexity_pct) <span class="sc">%&gt;%</span> <span class="co"># notice the ascending sort of value (mape) here to take the lowest </span></span>
<span id="cb402-23"><a href="stats_method.html#cb402-23" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">slice</span>(<span class="dv">1</span>)</span>
<span id="cb402-24"><a href="stats_method.html#cb402-24" tabindex="-1"></a><span class="co"># vertex_draws_temp %&gt;% dplyr::glimpse() # this thing is huge</span></span></code></pre></div>
<p>plot the posterior distribution of optimal parameter setting for <code>circle_fit_iou_pct</code></p>
<div class="sourceCode" id="cb403"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb403-1"><a href="stats_method.html#cb403-1" tabindex="-1"></a>vertex_draws_temp <span class="sc">%&gt;%</span></span>
<span id="cb403-2"><a href="stats_method.html#cb403-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(</span>
<span id="cb403-3"><a href="stats_method.html#cb403-3" tabindex="-1"></a>    chm_res_m <span class="sc">%in%</span> <span class="fu">seq</span>(<span class="fl">0.1</span>,<span class="fl">0.5</span>,<span class="at">by=</span><span class="fl">0.1</span>)</span>
<span id="cb403-4"><a href="stats_method.html#cb403-4" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb403-5"><a href="stats_method.html#cb403-5" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb403-6"><a href="stats_method.html#cb403-6" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> circle_fit_iou_pct)) <span class="sc">+</span></span>
<span id="cb403-7"><a href="stats_method.html#cb403-7" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">stat_dotsinterval</span>(</span>
<span id="cb403-8"><a href="stats_method.html#cb403-8" tabindex="-1"></a>    <span class="at">point_interval =</span> <span class="st">&quot;median_hdci&quot;</span>, <span class="at">.width =</span> <span class="fu">c</span>(<span class="fl">0.95</span>)</span>
<span id="cb403-9"><a href="stats_method.html#cb403-9" tabindex="-1"></a>    , <span class="at">quantiles =</span> <span class="dv">100</span></span>
<span id="cb403-10"><a href="stats_method.html#cb403-10" tabindex="-1"></a>    , <span class="at">point_size =</span> <span class="dv">3</span> </span>
<span id="cb403-11"><a href="stats_method.html#cb403-11" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb403-12"><a href="stats_method.html#cb403-12" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">facet_grid</span>(</span>
<span id="cb403-13"><a href="stats_method.html#cb403-13" tabindex="-1"></a>    <span class="at">cols =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(spectral_weight)</span>
<span id="cb403-14"><a href="stats_method.html#cb403-14" tabindex="-1"></a>    , <span class="at">rows =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(chm_res_m)</span>
<span id="cb403-15"><a href="stats_method.html#cb403-15" tabindex="-1"></a>    , <span class="at">scales =</span> <span class="st">&quot;free_y&quot;</span></span>
<span id="cb403-16"><a href="stats_method.html#cb403-16" tabindex="-1"></a>    , <span class="at">labeller =</span> <span class="st">&quot;label_both&quot;</span></span>
<span id="cb403-17"><a href="stats_method.html#cb403-17" tabindex="-1"></a>    , <span class="at">axes =</span> <span class="st">&quot;all_x&quot;</span></span>
<span id="cb403-18"><a href="stats_method.html#cb403-18" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb403-19"><a href="stats_method.html#cb403-19" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb403-20"><a href="stats_method.html#cb403-20" tabindex="-1"></a>  <span class="co"># ggplot2::scale_x_continuous(limits = c(0,1), breaks = scales::breaks_extended(6)) +</span></span>
<span id="cb403-21"><a href="stats_method.html#cb403-21" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb403-22"><a href="stats_method.html#cb403-22" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb403-23"><a href="stats_method.html#cb403-23" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb403-24"><a href="stats_method.html#cb403-24" tabindex="-1"></a>    <span class="at">strip.text.x =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb403-25"><a href="stats_method.html#cb403-25" tabindex="-1"></a>    , <span class="at">strip.text.y =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb403-26"><a href="stats_method.html#cb403-26" tabindex="-1"></a>    , <span class="at">axis.text.x =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>)</span>
<span id="cb403-27"><a href="stats_method.html#cb403-27" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-388-1.png" width="1008" /></p>
<p>like we saw above, the optimal <code>circle_fit_iou_pct</code> for maximizing Height quantification accuracy shifts from higher (e.g. ~0.6-0.9) for fine resolution CHM data (e.g. &lt;=0.2m) to lower (e.g. &lt;0.25) for coarse resolution CHM data (e.g &gt;=0.4m)</p>
<p>plot the posterior distribution of optimal parameter setting for <code>convexity_pct</code></p>
<div class="sourceCode" id="cb404"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb404-1"><a href="stats_method.html#cb404-1" tabindex="-1"></a>vertex_draws_temp <span class="sc">%&gt;%</span> </span>
<span id="cb404-2"><a href="stats_method.html#cb404-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(</span>
<span id="cb404-3"><a href="stats_method.html#cb404-3" tabindex="-1"></a>    chm_res_m <span class="sc">%in%</span> <span class="fu">seq</span>(<span class="fl">0.1</span>,<span class="fl">0.5</span>,<span class="at">by=</span><span class="fl">0.1</span>)</span>
<span id="cb404-4"><a href="stats_method.html#cb404-4" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb404-5"><a href="stats_method.html#cb404-5" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb404-6"><a href="stats_method.html#cb404-6" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> convexity_pct)) <span class="sc">+</span></span>
<span id="cb404-7"><a href="stats_method.html#cb404-7" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">stat_dotsinterval</span>(</span>
<span id="cb404-8"><a href="stats_method.html#cb404-8" tabindex="-1"></a>    <span class="at">point_interval =</span> <span class="st">&quot;median_hdci&quot;</span>, <span class="at">.width =</span> <span class="fu">c</span>(<span class="fl">0.95</span>)</span>
<span id="cb404-9"><a href="stats_method.html#cb404-9" tabindex="-1"></a>    , <span class="at">quantiles =</span> <span class="dv">100</span></span>
<span id="cb404-10"><a href="stats_method.html#cb404-10" tabindex="-1"></a>    , <span class="at">point_size =</span> <span class="dv">3</span> </span>
<span id="cb404-11"><a href="stats_method.html#cb404-11" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb404-12"><a href="stats_method.html#cb404-12" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">facet_grid</span>(</span>
<span id="cb404-13"><a href="stats_method.html#cb404-13" tabindex="-1"></a>    <span class="at">cols =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(spectral_weight)</span>
<span id="cb404-14"><a href="stats_method.html#cb404-14" tabindex="-1"></a>    , <span class="at">rows =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(chm_res_m)</span>
<span id="cb404-15"><a href="stats_method.html#cb404-15" tabindex="-1"></a>    , <span class="at">scales =</span> <span class="st">&quot;free_y&quot;</span></span>
<span id="cb404-16"><a href="stats_method.html#cb404-16" tabindex="-1"></a>    , <span class="at">labeller =</span> <span class="st">&quot;label_both&quot;</span></span>
<span id="cb404-17"><a href="stats_method.html#cb404-17" tabindex="-1"></a>    , <span class="at">axes =</span> <span class="st">&quot;all_x&quot;</span></span>
<span id="cb404-18"><a href="stats_method.html#cb404-18" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb404-19"><a href="stats_method.html#cb404-19" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb404-20"><a href="stats_method.html#cb404-20" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb404-21"><a href="stats_method.html#cb404-21" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb404-22"><a href="stats_method.html#cb404-22" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb404-23"><a href="stats_method.html#cb404-23" tabindex="-1"></a>    <span class="at">strip.text.x =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb404-24"><a href="stats_method.html#cb404-24" tabindex="-1"></a>    , <span class="at">strip.text.y =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb404-25"><a href="stats_method.html#cb404-25" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-389-1.png" width="1008" /></p>
<p>when the <code>circle_fit_iou_pct</code> parameter is optimized, the influence of <code>convexity_pct</code> on form quantification accuracy is dependent on the CHM resolution. only for the finest resolution CHM data (i.e. 0.1m) tested, the model’s predictions indicate with high certainty that the optimal <code>convexity_pct</code> is its minimum value of ‘0’. for intermediate resolution CHM data (e.g. 0.3m), the 95% HDI for the optimal <code>convexity_pct</code> spans the entire 0-1 range, indicating the model is not confident in any specific setting. for the coarsest resolution CHM data (i.e. 0.5m) tested, the model’s predictions indicate with high certainty that the optimal <code>convexity_pct</code> is its maximum value of ‘1’</p>
<p>we can look at this another way, check it</p>
<div class="sourceCode" id="cb405"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb405-1"><a href="stats_method.html#cb405-1" tabindex="-1"></a>vertex_draws_temp <span class="sc">%&gt;%</span> </span>
<span id="cb405-2"><a href="stats_method.html#cb405-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(</span>
<span id="cb405-3"><a href="stats_method.html#cb405-3" tabindex="-1"></a>    chm_res_m <span class="sc">%in%</span> <span class="fu">seq</span>(<span class="fl">0.1</span>,<span class="fl">0.5</span>,<span class="at">by=</span><span class="fl">0.1</span>)</span>
<span id="cb405-4"><a href="stats_method.html#cb405-4" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb405-5"><a href="stats_method.html#cb405-5" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb405-6"><a href="stats_method.html#cb405-6" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">y =</span> convexity_pct, <span class="at">x =</span> circle_fit_iou_pct)) <span class="sc">+</span></span>
<span id="cb405-7"><a href="stats_method.html#cb405-7" tabindex="-1"></a>  <span class="co"># geom_point(alpha=0.2) +</span></span>
<span id="cb405-8"><a href="stats_method.html#cb405-8" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_jitter</span>(<span class="at">alpha=</span><span class="fl">0.2</span>, <span class="at">height =</span> .<span class="dv">01</span>, <span class="at">width =</span> .<span class="dv">01</span>) <span class="sc">+</span></span>
<span id="cb405-9"><a href="stats_method.html#cb405-9" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">facet_grid</span>(</span>
<span id="cb405-10"><a href="stats_method.html#cb405-10" tabindex="-1"></a>    <span class="at">cols =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(spectral_weight)</span>
<span id="cb405-11"><a href="stats_method.html#cb405-11" tabindex="-1"></a>    , <span class="at">rows =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(chm_res_m)</span>
<span id="cb405-12"><a href="stats_method.html#cb405-12" tabindex="-1"></a>    <span class="co"># , scales = &quot;free_y&quot;</span></span>
<span id="cb405-13"><a href="stats_method.html#cb405-13" tabindex="-1"></a>    , <span class="at">labeller =</span> <span class="st">&quot;label_both&quot;</span></span>
<span id="cb405-14"><a href="stats_method.html#cb405-14" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb405-15"><a href="stats_method.html#cb405-15" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb405-16"><a href="stats_method.html#cb405-16" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb405-17"><a href="stats_method.html#cb405-17" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb405-18"><a href="stats_method.html#cb405-18" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb405-19"><a href="stats_method.html#cb405-19" tabindex="-1"></a>    <span class="at">strip.text.x =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb405-20"><a href="stats_method.html#cb405-20" tabindex="-1"></a>    , <span class="at">strip.text.y =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb405-21"><a href="stats_method.html#cb405-21" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-390-1.png" width="1008" /></p>
<p>note, in the plot above, we slightly “jitter” the points so that they are visible where they would otherwise be stacked on top of each other and only look like a few points instead of the 1000 draws from the posterior we used</p>
<p>let’s table the HDI of the optimal values</p>
<div class="sourceCode" id="cb406"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb406-1"><a href="stats_method.html#cb406-1" tabindex="-1"></a><span class="co"># summarize it</span></span>
<span id="cb406-2"><a href="stats_method.html#cb406-2" tabindex="-1"></a>vertex_draws_temp <span class="ot">&lt;-</span> </span>
<span id="cb406-3"><a href="stats_method.html#cb406-3" tabindex="-1"></a>  vertex_draws_temp <span class="sc">%&gt;%</span> </span>
<span id="cb406-4"><a href="stats_method.html#cb406-4" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(</span>
<span id="cb406-5"><a href="stats_method.html#cb406-5" tabindex="-1"></a>    chm_res_m, spectral_weight</span>
<span id="cb406-6"><a href="stats_method.html#cb406-6" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb406-7"><a href="stats_method.html#cb406-7" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(</span>
<span id="cb406-8"><a href="stats_method.html#cb406-8" tabindex="-1"></a>    <span class="co"># get median_hdi</span></span>
<span id="cb406-9"><a href="stats_method.html#cb406-9" tabindex="-1"></a>    <span class="at">median_hdi_est_circle_fit_iou_pct =</span> tidybayes<span class="sc">::</span><span class="fu">median_hdci</span>(circle_fit_iou_pct)<span class="sc">$</span>y</span>
<span id="cb406-10"><a href="stats_method.html#cb406-10" tabindex="-1"></a>    , <span class="at">median_hdi_lower_circle_fit_iou_pct =</span> tidybayes<span class="sc">::</span><span class="fu">median_hdci</span>(circle_fit_iou_pct)<span class="sc">$</span>ymin</span>
<span id="cb406-11"><a href="stats_method.html#cb406-11" tabindex="-1"></a>    , <span class="at">median_hdi_upper_circle_fit_iou_pct =</span> tidybayes<span class="sc">::</span><span class="fu">median_hdci</span>(circle_fit_iou_pct)<span class="sc">$</span>ymax</span>
<span id="cb406-12"><a href="stats_method.html#cb406-12" tabindex="-1"></a>    <span class="co"># get median_hdi</span></span>
<span id="cb406-13"><a href="stats_method.html#cb406-13" tabindex="-1"></a>    , <span class="at">median_hdi_est_convexity_pct =</span> tidybayes<span class="sc">::</span><span class="fu">median_hdci</span>(convexity_pct)<span class="sc">$</span>y</span>
<span id="cb406-14"><a href="stats_method.html#cb406-14" tabindex="-1"></a>    , <span class="at">median_hdi_lower_convexity_pct =</span> tidybayes<span class="sc">::</span><span class="fu">median_hdci</span>(convexity_pct)<span class="sc">$</span>ymin</span>
<span id="cb406-15"><a href="stats_method.html#cb406-15" tabindex="-1"></a>    , <span class="at">median_hdi_upper_convexity_pct =</span> tidybayes<span class="sc">::</span><span class="fu">median_hdci</span>(convexity_pct)<span class="sc">$</span>ymax</span>
<span id="cb406-16"><a href="stats_method.html#cb406-16" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb406-17"><a href="stats_method.html#cb406-17" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() </span>
<span id="cb406-18"><a href="stats_method.html#cb406-18" tabindex="-1"></a><span class="co"># table it</span></span>
<span id="cb406-19"><a href="stats_method.html#cb406-19" tabindex="-1"></a>vertex_draws_temp <span class="sc">%&gt;%</span> </span>
<span id="cb406-20"><a href="stats_method.html#cb406-20" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kbl</span>(</span>
<span id="cb406-21"><a href="stats_method.html#cb406-21" tabindex="-1"></a>    <span class="at">digits =</span> <span class="dv">2</span></span>
<span id="cb406-22"><a href="stats_method.html#cb406-22" tabindex="-1"></a>    , <span class="at">caption =</span> <span class="st">&quot;&quot;</span></span>
<span id="cb406-23"><a href="stats_method.html#cb406-23" tabindex="-1"></a>    , <span class="at">col.names =</span> <span class="fu">c</span>(</span>
<span id="cb406-24"><a href="stats_method.html#cb406-24" tabindex="-1"></a>      <span class="st">&quot;CHM resolution&quot;</span>, <span class="st">&quot;spectral_weight&quot;</span></span>
<span id="cb406-25"><a href="stats_method.html#cb406-25" tabindex="-1"></a>      , <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;median&quot;</span>, <span class="st">&quot;HDI low&quot;</span>, <span class="st">&quot;HDI high&quot;</span>),<span class="dv">2</span>)</span>
<span id="cb406-26"><a href="stats_method.html#cb406-26" tabindex="-1"></a>    )</span>
<span id="cb406-27"><a href="stats_method.html#cb406-27" tabindex="-1"></a>    , <span class="at">escape =</span> F</span>
<span id="cb406-28"><a href="stats_method.html#cb406-28" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb406-29"><a href="stats_method.html#cb406-29" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kable_styling</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb406-30"><a href="stats_method.html#cb406-30" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">collapse_rows</span>(<span class="at">columns =</span> <span class="dv">1</span>, <span class="at">valign =</span> <span class="st">&quot;top&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb406-31"><a href="stats_method.html#cb406-31" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">add_header_above</span>(<span class="fu">c</span>(</span>
<span id="cb406-32"><a href="stats_method.html#cb406-32" tabindex="-1"></a>    <span class="st">&quot; &quot;</span><span class="ot">=</span><span class="dv">2</span></span>
<span id="cb406-33"><a href="stats_method.html#cb406-33" tabindex="-1"></a>    , <span class="st">&quot;circle_fit_iou_pct&quot;</span> <span class="ot">=</span> <span class="dv">3</span></span>
<span id="cb406-34"><a href="stats_method.html#cb406-34" tabindex="-1"></a>    , <span class="st">&quot;convexity_pct&quot;</span> <span class="ot">=</span> <span class="dv">3</span></span>
<span id="cb406-35"><a href="stats_method.html#cb406-35" tabindex="-1"></a>  ))</span></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-391">Table 9.17: </span>
</caption>
<thead>
<tr>
<th style="empty-cells: hide;border-bottom:hidden;" colspan="2">
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="3">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
circle_fit_iou_pct
</div>
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="3">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
convexity_pct
</div>
</th>
</tr>
<tr>
<th style="text-align:right;">
CHM resolution
</th>
<th style="text-align:left;">
spectral_weight
</th>
<th style="text-align:right;">
median
</th>
<th style="text-align:right;">
HDI low
</th>
<th style="text-align:right;">
HDI high
</th>
<th style="text-align:right;">
median
</th>
<th style="text-align:right;">
HDI low
</th>
<th style="text-align:right;">
HDI high
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
0.1
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:right;">
0.86
</td>
<td style="text-align:right;">
0.81
</td>
<td style="text-align:right;">
0.94
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;">
0.2
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:right;">
0.59
</td>
<td style="text-align:right;">
0.56
</td>
<td style="text-align:right;">
0.63
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;">
0.3
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:right;">
0.37
</td>
<td style="text-align:right;">
0.31
</td>
<td style="text-align:right;">
0.42
</td>
<td style="text-align:right;">
0.56
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
0.4
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:right;">
0.17
</td>
<td style="text-align:right;">
0.13
</td>
<td style="text-align:right;">
0.21
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
0.5
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="input-data-1" class="section level4 hasAnchor" number="9.3.5.2">
<h4><span class="header-section-number">9.3.5.2</span> Input data<a href="stats_method.html#input-data-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>to explore the influence of the input data, which includes the presence or absence of spectral data and its weighting (i.e. <code>spectral_weight</code>) as well as the CHM resolution (<code>chm_res_m</code>), we will fix all four structural parameters (<code>max_ht_m</code>, <code>max_area_m2</code>, <code>convexity_pct</code>, <code>circle_fit_iou_pct</code>). the <code>max_ht_m</code>, <code>max_area_m2</code> parameters will be fixed at expected levels based on the slash pile construction prescription while the <code>convexity_pct</code>, <code>circle_fit_iou_pct</code> will be fixed at the optimal levels determined based on the Bayesian posterior predictive distribution of <a href="stats_method.html#f_score_epred">detection accuracy</a></p>
<p>we’ll make contrasts of the posterior predictions to probabilistically quantify the influence of the input data (e.g. inclusion of spectral data and it’s weighting and CHM resolution)</p>
<p>let’s get the posterior predictive draws</p>
<div class="sourceCode" id="cb407"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb407-1"><a href="stats_method.html#cb407-1" tabindex="-1"></a>draws_temp <span class="ot">&lt;-</span> </span>
<span id="cb407-2"><a href="stats_method.html#cb407-2" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">crossing</span>(</span>
<span id="cb407-3"><a href="stats_method.html#cb407-3" tabindex="-1"></a>    structural_params_settings</span>
<span id="cb407-4"><a href="stats_method.html#cb407-4" tabindex="-1"></a>    , param_combos_spectral_ranked <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">distinct</span>(spectral_weight_fact, spectral_weight)</span>
<span id="cb407-5"><a href="stats_method.html#cb407-5" tabindex="-1"></a>    , param_combos_spectral_ranked <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">distinct</span>(chm_res_m)</span>
<span id="cb407-6"><a href="stats_method.html#cb407-6" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb407-7"><a href="stats_method.html#cb407-7" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">add_epred_draws</span>(brms_height_mape_mod, <span class="at">ndraws =</span> <span class="dv">1111</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb407-8"><a href="stats_method.html#cb407-8" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">value =</span> .epred)</span>
<span id="cb407-9"><a href="stats_method.html#cb407-9" tabindex="-1"></a><span class="co"># # huh?</span></span>
<span id="cb407-10"><a href="stats_method.html#cb407-10" tabindex="-1"></a><span class="co"># draws_temp %&gt;% dplyr::glimpse()</span></span></code></pre></div>
<div id="chm-resolution-2" class="section level5 hasAnchor" number="9.3.5.2.1">
<h5><span class="header-section-number">9.3.5.2.1</span> CHM resolution<a href="stats_method.html#chm-resolution-2" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>first, we’ll look at the impact of changing CHM resolution by the <code>spectral_weight</code> parameter where a value of “0” indicates no spectral data was used (i.e. structural only), the lowest weighting of the spectral data is “1” (only one spectral index threshold must be met), and the highest weighting of spectral data is “5” (all spectral index thresholds must be met).</p>
<p>our questions regarding CHM resolution were:</p>
<ul>
<li>question 1: <em>does CHM resolution influence quantification accuracy?</em></li>
<li>question 2: <em>does the effect of CHM resolution change based on the inclusion of spectral data versus using only structural data?</em></li>
</ul>
<p>we can answer those questions using our model by considering the credible slope of the CHM resolution predictor as a function of the <code>spectral_weight</code> parameter (e.g. Kurz <a href="https://bookdown.org/content/3686/18.html">2025</a>; <a href="https://sites.google.com/site/doingbayesiandataanalysis/">Kruschke (2015, Ch. 18)</a>)</p>
<div class="sourceCode" id="cb408"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb408-1"><a href="stats_method.html#cb408-1" tabindex="-1"></a>draws_temp <span class="sc">%&gt;%</span> </span>
<span id="cb408-2"><a href="stats_method.html#cb408-2" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> chm_res_m, <span class="at">y =</span> value, <span class="at">color =</span> spectral_weight)) <span class="sc">+</span></span>
<span id="cb408-3"><a href="stats_method.html#cb408-3" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">stat_lineribbon</span>(<span class="at">point_interval =</span> <span class="st">&quot;median_hdi&quot;</span>, <span class="at">.width =</span> <span class="fu">c</span>(<span class="fl">0.95</span>)) <span class="sc">+</span></span>
<span id="cb408-4"><a href="stats_method.html#cb408-4" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_fill_brewer</span>(<span class="at">palette =</span> <span class="st">&quot;Greys&quot;</span>) <span class="sc">+</span></span>
<span id="cb408-5"><a href="stats_method.html#cb408-5" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_color_manual</span>(<span class="at">values =</span> pal_spectral_weight) <span class="sc">+</span></span>
<span id="cb408-6"><a href="stats_method.html#cb408-6" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>percent) <span class="sc">+</span></span>
<span id="cb408-7"><a href="stats_method.html#cb408-7" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;CHM resolution&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Height MAPE&quot;</span>) <span class="sc">+</span></span>
<span id="cb408-8"><a href="stats_method.html#cb408-8" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb408-9"><a href="stats_method.html#cb408-9" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb408-10"><a href="stats_method.html#cb408-10" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;top&quot;</span></span>
<span id="cb408-11"><a href="stats_method.html#cb408-11" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb408-12"><a href="stats_method.html#cb408-12" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">guides</span>(</span>
<span id="cb408-13"><a href="stats_method.html#cb408-13" tabindex="-1"></a>    <span class="at">color =</span> ggplot2<span class="sc">::</span><span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">shape =</span> <span class="dv">15</span>, <span class="at">lwd =</span> <span class="dv">8</span>, <span class="at">fill =</span> <span class="cn">NA</span>))</span>
<span id="cb408-14"><a href="stats_method.html#cb408-14" tabindex="-1"></a>    , <span class="at">fill =</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb408-15"><a href="stats_method.html#cb408-15" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-394-1.png" width="1008" /></p>
<p>this trend demonstrates that increasing the coarseness of the CHM data has a minimal impact of about 1 percentage point on Height quantification accuracy for CHM data with resolutions in the range of 0.1m to 0.4m. however, increasing the CHM resolution coarseness beyond this level results in a more significant reduction in Height quantification accuracy (i.e. increase in height MAPE) and height accuracy degrades at an increasing rate the more coarse the CHM data…don’t do it</p>
<p>we can look at the posterior distributions of the expected Height MAPE at different CHM resolution levels by the inclusion (or exclusion) of spectral data and it’s weighting…make sure to note the y-axis range (it’s fairly narrow)</p>
<div class="sourceCode" id="cb409"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb409-1"><a href="stats_method.html#cb409-1" tabindex="-1"></a>draws_temp <span class="sc">%&gt;%</span> </span>
<span id="cb409-2"><a href="stats_method.html#cb409-2" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">y=</span>value, <span class="at">x=</span>chm_res_m)) <span class="sc">+</span></span>
<span id="cb409-3"><a href="stats_method.html#cb409-3" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">stat_eye</span>(</span>
<span id="cb409-4"><a href="stats_method.html#cb409-4" tabindex="-1"></a>    <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">fill =</span> spectral_weight)</span>
<span id="cb409-5"><a href="stats_method.html#cb409-5" tabindex="-1"></a>    , <span class="at">point_interval =</span> median_hdi, <span class="at">.width =</span> .<span class="dv">95</span></span>
<span id="cb409-6"><a href="stats_method.html#cb409-6" tabindex="-1"></a>    , <span class="at">slab_alpha =</span> <span class="fl">0.95</span></span>
<span id="cb409-7"><a href="stats_method.html#cb409-7" tabindex="-1"></a>    , <span class="at">interval_color =</span> <span class="st">&quot;gray44&quot;</span>, <span class="at">linewidth =</span> <span class="dv">1</span></span>
<span id="cb409-8"><a href="stats_method.html#cb409-8" tabindex="-1"></a>    , <span class="at">point_color =</span> <span class="st">&quot;gray44&quot;</span>, <span class="at">point_fill =</span> <span class="st">&quot;gray44&quot;</span>, <span class="at">point_size =</span> <span class="dv">1</span></span>
<span id="cb409-9"><a href="stats_method.html#cb409-9" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb409-10"><a href="stats_method.html#cb409-10" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">facet_grid</span>(<span class="at">cols =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(spectral_weight), <span class="at">labeller =</span> <span class="st">&quot;label_both&quot;</span>) <span class="sc">+</span></span>
<span id="cb409-11"><a href="stats_method.html#cb409-11" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_fill_manual</span>(<span class="at">values =</span> pal_spectral_weight) <span class="sc">+</span></span>
<span id="cb409-12"><a href="stats_method.html#cb409-12" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="cn">NA</span>), <span class="at">labels =</span> scales<span class="sc">::</span>percent, <span class="at">breaks =</span> scales<span class="sc">::</span><span class="fu">breaks_extended</span>(<span class="dv">16</span>)) <span class="sc">+</span></span>
<span id="cb409-13"><a href="stats_method.html#cb409-13" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;CHM resolution&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Height MAPE&quot;</span>) <span class="sc">+</span></span>
<span id="cb409-14"><a href="stats_method.html#cb409-14" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb409-15"><a href="stats_method.html#cb409-15" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb409-16"><a href="stats_method.html#cb409-16" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb409-17"><a href="stats_method.html#cb409-17" tabindex="-1"></a>    , <span class="at">strip.text =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb409-18"><a href="stats_method.html#cb409-18" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-395-1.png" width="1008" /></p>
<p>table that</p>
<div class="sourceCode" id="cb410"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb410-1"><a href="stats_method.html#cb410-1" tabindex="-1"></a>draws_temp <span class="sc">%&gt;%</span> </span>
<span id="cb410-2"><a href="stats_method.html#cb410-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">spectral_weight =</span> forcats<span class="sc">::</span><span class="fu">fct_relabel</span>(spectral_weight,<span class="sc">~</span><span class="fu">paste0</span>(<span class="st">&quot;spectral_weight: &quot;</span>, .x, <span class="at">recycle0 =</span> T))) <span class="sc">%&gt;%</span> </span>
<span id="cb410-3"><a href="stats_method.html#cb410-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(spectral_weight, chm_res_m) <span class="sc">%&gt;%</span></span>
<span id="cb410-4"><a href="stats_method.html#cb410-4" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(</span>
<span id="cb410-5"><a href="stats_method.html#cb410-5" tabindex="-1"></a>    <span class="co"># get median_hdi</span></span>
<span id="cb410-6"><a href="stats_method.html#cb410-6" tabindex="-1"></a>    <span class="at">median_hdi_est =</span> tidybayes<span class="sc">::</span><span class="fu">median_hdci</span>(value)<span class="sc">$</span>y</span>
<span id="cb410-7"><a href="stats_method.html#cb410-7" tabindex="-1"></a>    , <span class="at">median_hdi_lower =</span> tidybayes<span class="sc">::</span><span class="fu">median_hdci</span>(value)<span class="sc">$</span>ymin</span>
<span id="cb410-8"><a href="stats_method.html#cb410-8" tabindex="-1"></a>    , <span class="at">median_hdi_upper =</span> tidybayes<span class="sc">::</span><span class="fu">median_hdci</span>(value)<span class="sc">$</span>ymax</span>
<span id="cb410-9"><a href="stats_method.html#cb410-9" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb410-10"><a href="stats_method.html#cb410-10" tabindex="-1"></a>  <span class="co"># format pcts</span></span>
<span id="cb410-11"><a href="stats_method.html#cb410-11" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(dplyr<span class="sc">::</span><span class="fu">across</span>(</span>
<span id="cb410-12"><a href="stats_method.html#cb410-12" tabindex="-1"></a>    tidyselect<span class="sc">::</span><span class="fu">starts_with</span>(<span class="st">&quot;median_hdi_&quot;</span>)</span>
<span id="cb410-13"><a href="stats_method.html#cb410-13" tabindex="-1"></a>    , <span class="sc">~</span> scales<span class="sc">::</span><span class="fu">percent</span>(.x, <span class="at">accuracy =</span> <span class="fl">0.1</span>)</span>
<span id="cb410-14"><a href="stats_method.html#cb410-14" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb410-15"><a href="stats_method.html#cb410-15" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb410-16"><a href="stats_method.html#cb410-16" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(spectral_weight, chm_res_m) <span class="sc">%&gt;%</span> </span>
<span id="cb410-17"><a href="stats_method.html#cb410-17" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kbl</span>(</span>
<span id="cb410-18"><a href="stats_method.html#cb410-18" tabindex="-1"></a>    <span class="at">digits =</span> <span class="dv">2</span></span>
<span id="cb410-19"><a href="stats_method.html#cb410-19" tabindex="-1"></a>    , <span class="at">caption =</span> <span class="st">&quot;Height MAPE&lt;br&gt;95% HDI of the posterior predictive distribution&quot;</span></span>
<span id="cb410-20"><a href="stats_method.html#cb410-20" tabindex="-1"></a>    , <span class="at">col.names =</span> <span class="fu">c</span>(</span>
<span id="cb410-21"><a href="stats_method.html#cb410-21" tabindex="-1"></a>      <span class="st">&quot;spectral_weight&quot;</span>, <span class="st">&quot;CHM resolution&quot;</span></span>
<span id="cb410-22"><a href="stats_method.html#cb410-22" tabindex="-1"></a>      , <span class="fu">c</span>(<span class="st">&quot;Height MAPE&lt;br&gt;median&quot;</span>, <span class="st">&quot;HDI low&quot;</span>, <span class="st">&quot;HDI high&quot;</span>)</span>
<span id="cb410-23"><a href="stats_method.html#cb410-23" tabindex="-1"></a>    )</span>
<span id="cb410-24"><a href="stats_method.html#cb410-24" tabindex="-1"></a>    , <span class="at">escape =</span> F</span>
<span id="cb410-25"><a href="stats_method.html#cb410-25" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb410-26"><a href="stats_method.html#cb410-26" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kable_styling</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb410-27"><a href="stats_method.html#cb410-27" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">collapse_rows</span>(<span class="at">columns =</span> <span class="dv">1</span>, <span class="at">valign =</span> <span class="st">&quot;top&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb410-28"><a href="stats_method.html#cb410-28" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">scroll_box</span>(<span class="at">height =</span> <span class="st">&quot;8in&quot;</span>)</span></code></pre></div>
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:8in; ">
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-396">Table 9.18: </span>Height MAPE<br>95% HDI of the posterior predictive distribution
</caption>
<thead>
<tr>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
spectral_weight
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
CHM resolution
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
Height MAPE<br>median
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
HDI low
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
HDI high
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="5">
spectral_weight: 0
</td>
<td style="text-align:right;">
0.1
</td>
<td style="text-align:left;">
16.7%
</td>
<td style="text-align:left;">
16.5%
</td>
<td style="text-align:left;">
16.9%
</td>
</tr>
<tr>
<td style="text-align:right;">
0.2
</td>
<td style="text-align:left;">
15.8%
</td>
<td style="text-align:left;">
15.7%
</td>
<td style="text-align:left;">
15.9%
</td>
</tr>
<tr>
<td style="text-align:right;">
0.3
</td>
<td style="text-align:left;">
16.0%
</td>
<td style="text-align:left;">
15.9%
</td>
<td style="text-align:left;">
16.1%
</td>
</tr>
<tr>
<td style="text-align:right;">
0.4
</td>
<td style="text-align:left;">
17.2%
</td>
<td style="text-align:left;">
17.1%
</td>
<td style="text-align:left;">
17.4%
</td>
</tr>
<tr>
<td style="text-align:right;">
0.5
</td>
<td style="text-align:left;">
19.8%
</td>
<td style="text-align:left;">
19.6%
</td>
<td style="text-align:left;">
20.0%
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="5">
spectral_weight: 1
</td>
<td style="text-align:right;">
0.1
</td>
<td style="text-align:left;">
16.7%
</td>
<td style="text-align:left;">
16.6%
</td>
<td style="text-align:left;">
16.9%
</td>
</tr>
<tr>
<td style="text-align:right;">
0.2
</td>
<td style="text-align:left;">
15.8%
</td>
<td style="text-align:left;">
15.7%
</td>
<td style="text-align:left;">
15.9%
</td>
</tr>
<tr>
<td style="text-align:right;">
0.3
</td>
<td style="text-align:left;">
16.0%
</td>
<td style="text-align:left;">
15.9%
</td>
<td style="text-align:left;">
16.1%
</td>
</tr>
<tr>
<td style="text-align:right;">
0.4
</td>
<td style="text-align:left;">
17.2%
</td>
<td style="text-align:left;">
17.1%
</td>
<td style="text-align:left;">
17.4%
</td>
</tr>
<tr>
<td style="text-align:right;">
0.5
</td>
<td style="text-align:left;">
19.8%
</td>
<td style="text-align:left;">
19.6%
</td>
<td style="text-align:left;">
20.0%
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="5">
spectral_weight: 2
</td>
<td style="text-align:right;">
0.1
</td>
<td style="text-align:left;">
16.7%
</td>
<td style="text-align:left;">
16.6%
</td>
<td style="text-align:left;">
16.9%
</td>
</tr>
<tr>
<td style="text-align:right;">
0.2
</td>
<td style="text-align:left;">
15.8%
</td>
<td style="text-align:left;">
15.7%
</td>
<td style="text-align:left;">
15.9%
</td>
</tr>
<tr>
<td style="text-align:right;">
0.3
</td>
<td style="text-align:left;">
16.0%
</td>
<td style="text-align:left;">
15.9%
</td>
<td style="text-align:left;">
16.1%
</td>
</tr>
<tr>
<td style="text-align:right;">
0.4
</td>
<td style="text-align:left;">
17.2%
</td>
<td style="text-align:left;">
17.1%
</td>
<td style="text-align:left;">
17.4%
</td>
</tr>
<tr>
<td style="text-align:right;">
0.5
</td>
<td style="text-align:left;">
19.8%
</td>
<td style="text-align:left;">
19.6%
</td>
<td style="text-align:left;">
20.0%
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="5">
spectral_weight: 3
</td>
<td style="text-align:right;">
0.1
</td>
<td style="text-align:left;">
16.7%
</td>
<td style="text-align:left;">
16.6%
</td>
<td style="text-align:left;">
16.9%
</td>
</tr>
<tr>
<td style="text-align:right;">
0.2
</td>
<td style="text-align:left;">
15.8%
</td>
<td style="text-align:left;">
15.7%
</td>
<td style="text-align:left;">
16.0%
</td>
</tr>
<tr>
<td style="text-align:right;">
0.3
</td>
<td style="text-align:left;">
16.0%
</td>
<td style="text-align:left;">
15.9%
</td>
<td style="text-align:left;">
16.1%
</td>
</tr>
<tr>
<td style="text-align:right;">
0.4
</td>
<td style="text-align:left;">
17.2%
</td>
<td style="text-align:left;">
17.1%
</td>
<td style="text-align:left;">
17.4%
</td>
</tr>
<tr>
<td style="text-align:right;">
0.5
</td>
<td style="text-align:left;">
19.8%
</td>
<td style="text-align:left;">
19.6%
</td>
<td style="text-align:left;">
20.0%
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="5">
spectral_weight: 4
</td>
<td style="text-align:right;">
0.1
</td>
<td style="text-align:left;">
16.7%
</td>
<td style="text-align:left;">
16.6%
</td>
<td style="text-align:left;">
16.9%
</td>
</tr>
<tr>
<td style="text-align:right;">
0.2
</td>
<td style="text-align:left;">
15.8%
</td>
<td style="text-align:left;">
15.7%
</td>
<td style="text-align:left;">
15.9%
</td>
</tr>
<tr>
<td style="text-align:right;">
0.3
</td>
<td style="text-align:left;">
16.0%
</td>
<td style="text-align:left;">
15.9%
</td>
<td style="text-align:left;">
16.1%
</td>
</tr>
<tr>
<td style="text-align:right;">
0.4
</td>
<td style="text-align:left;">
17.2%
</td>
<td style="text-align:left;">
17.1%
</td>
<td style="text-align:left;">
17.4%
</td>
</tr>
<tr>
<td style="text-align:right;">
0.5
</td>
<td style="text-align:left;">
19.8%
</td>
<td style="text-align:left;">
19.6%
</td>
<td style="text-align:left;">
20.0%
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="5">
spectral_weight: 5
</td>
<td style="text-align:right;">
0.1
</td>
<td style="text-align:left;">
16.4%
</td>
<td style="text-align:left;">
16.2%
</td>
<td style="text-align:left;">
16.6%
</td>
</tr>
<tr>
<td style="text-align:right;">
0.2
</td>
<td style="text-align:left;">
15.6%
</td>
<td style="text-align:left;">
15.5%
</td>
<td style="text-align:left;">
15.7%
</td>
</tr>
<tr>
<td style="text-align:right;">
0.3
</td>
<td style="text-align:left;">
15.9%
</td>
<td style="text-align:left;">
15.8%
</td>
<td style="text-align:left;">
16.0%
</td>
</tr>
<tr>
<td style="text-align:right;">
0.4
</td>
<td style="text-align:left;">
17.2%
</td>
<td style="text-align:left;">
17.1%
</td>
<td style="text-align:left;">
17.3%
</td>
</tr>
<tr>
<td style="text-align:right;">
0.5
</td>
<td style="text-align:left;">
19.9%
</td>
<td style="text-align:left;">
19.7%
</td>
<td style="text-align:left;">
20.1%
</td>
</tr>
</tbody>
</table>
</div>
<p>note that even though these figures make it seem that height quantification accuracy is much worse for the coarser resolution CHM data compared to the finer resolution data, there is only a ~3 percentage point increase in height MAPE from the finest resolution 0.1m to the coarsest resolution 0.5m tested. for example, when spectral data is not included (i.e. <code>spectral_weight</code> = 0) the predicted Height MAPE is 15.3% using 0.1m CHM data and 18.1% when using 0.5m CHM data.</p>
<p>now we’ll probabilistically test the hypothesis that coarser resolution CHM data results in lower Height quantification accuracy and determine by how much. we’ll look at the influence of CHM resolution based on the inclusion of spectral data (or exclusion) and it’s weighting determined by the <code>spectral_weight</code> parameter</p>
<div class="sourceCode" id="cb411"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb411-1"><a href="stats_method.html#cb411-1" tabindex="-1"></a>contrast_temp <span class="ot">&lt;-</span> </span>
<span id="cb411-2"><a href="stats_method.html#cb411-2" tabindex="-1"></a>  draws_temp <span class="sc">%&gt;%</span> </span>
<span id="cb411-3"><a href="stats_method.html#cb411-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(</span>
<span id="cb411-4"><a href="stats_method.html#cb411-4" tabindex="-1"></a>    <span class="fu">round</span>(chm_res_m,<span class="dv">2</span>) <span class="sc">==</span> <span class="fu">round</span>(chm_res_m,<span class="dv">1</span>) <span class="co"># let&#39;s just look at every 0.1 m (10 cm)</span></span>
<span id="cb411-5"><a href="stats_method.html#cb411-5" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb411-6"><a href="stats_method.html#cb411-6" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(spectral_weight) <span class="sc">%&gt;%</span> </span>
<span id="cb411-7"><a href="stats_method.html#cb411-7" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">compare_levels</span>(</span>
<span id="cb411-8"><a href="stats_method.html#cb411-8" tabindex="-1"></a>    value</span>
<span id="cb411-9"><a href="stats_method.html#cb411-9" tabindex="-1"></a>    , <span class="at">by =</span> chm_res_m</span>
<span id="cb411-10"><a href="stats_method.html#cb411-10" tabindex="-1"></a>    , <span class="at">comparison =</span> </span>
<span id="cb411-11"><a href="stats_method.html#cb411-11" tabindex="-1"></a>      <span class="co"># &quot;control&quot;</span></span>
<span id="cb411-12"><a href="stats_method.html#cb411-12" tabindex="-1"></a>      <span class="co"># tidybayes::emmeans_comparison(&quot;revpairwise&quot;) </span></span>
<span id="cb411-13"><a href="stats_method.html#cb411-13" tabindex="-1"></a>      <span class="st">&quot;pairwise&quot;</span></span>
<span id="cb411-14"><a href="stats_method.html#cb411-14" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb411-15"><a href="stats_method.html#cb411-15" tabindex="-1"></a>  <span class="co"># dplyr::glimpse()</span></span>
<span id="cb411-16"><a href="stats_method.html#cb411-16" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">contrast =</span> chm_res_m) <span class="sc">%&gt;%</span> </span>
<span id="cb411-17"><a href="stats_method.html#cb411-17" tabindex="-1"></a>  <span class="co"># group the data before calculating contrast variables %&gt;% </span></span>
<span id="cb411-18"><a href="stats_method.html#cb411-18" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(spectral_weight, contrast) <span class="sc">%&gt;%</span> </span>
<span id="cb411-19"><a href="stats_method.html#cb411-19" tabindex="-1"></a>  <span class="fu">make_contrast_vars</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb411-20"><a href="stats_method.html#cb411-20" tabindex="-1"></a>  <span class="co"># relabel the label for the facets</span></span>
<span id="cb411-21"><a href="stats_method.html#cb411-21" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">spectral_weight =</span> forcats<span class="sc">::</span><span class="fu">fct_relabel</span>(spectral_weight,<span class="sc">~</span><span class="fu">paste0</span>(<span class="st">&quot;spectral_weight: &quot;</span>, .x, <span class="at">recycle0 =</span> T)))</span>
<span id="cb411-22"><a href="stats_method.html#cb411-22" tabindex="-1"></a><span class="co"># huh?</span></span>
<span id="cb411-23"><a href="stats_method.html#cb411-23" tabindex="-1"></a><span class="co"># contrast_temp %&gt;% dplyr::glimpse()</span></span>
<span id="cb411-24"><a href="stats_method.html#cb411-24" tabindex="-1"></a></span>
<span id="cb411-25"><a href="stats_method.html#cb411-25" tabindex="-1"></a><span class="co"># plot it</span></span>
<span id="cb411-26"><a href="stats_method.html#cb411-26" tabindex="-1"></a><span class="fu">plt_contrast</span>(</span>
<span id="cb411-27"><a href="stats_method.html#cb411-27" tabindex="-1"></a>  contrast_temp</span>
<span id="cb411-28"><a href="stats_method.html#cb411-28" tabindex="-1"></a>  <span class="co"># , caption_text = form_temp</span></span>
<span id="cb411-29"><a href="stats_method.html#cb411-29" tabindex="-1"></a>  , <span class="at">y_axis_title =</span> <span class="st">&quot;CHM resolution contrast&quot;</span></span>
<span id="cb411-30"><a href="stats_method.html#cb411-30" tabindex="-1"></a>  , <span class="at">x_axis_title =</span> <span class="st">&quot;difference (Height MAPE)&quot;</span></span>
<span id="cb411-31"><a href="stats_method.html#cb411-31" tabindex="-1"></a>  , <span class="at">facet =</span> <span class="st">&quot;spectral_weight&quot;</span></span>
<span id="cb411-32"><a href="stats_method.html#cb411-32" tabindex="-1"></a>  , <span class="at">label_size =</span> <span class="dv">0</span></span>
<span id="cb411-33"><a href="stats_method.html#cb411-33" tabindex="-1"></a>  , <span class="at">x_expand =</span> <span class="fu">c</span>(<span class="fl">0.3</span>,<span class="fl">0.3</span>)</span>
<span id="cb411-34"><a href="stats_method.html#cb411-34" tabindex="-1"></a>  , <span class="at">annotate_which =</span> <span class="st">&quot;both&quot;</span></span>
<span id="cb411-35"><a href="stats_method.html#cb411-35" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb411-36"><a href="stats_method.html#cb411-36" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb411-37"><a href="stats_method.html#cb411-37" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">&quot;posterior predictive distribution of group constrasts with 95% &amp; 50% HDI</span><span class="sc">\n</span><span class="st">by `spectral_weight`&quot;</span></span>
<span id="cb411-38"><a href="stats_method.html#cb411-38" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-397-1.png" width="1008" /></p>
<p>let’s table it</p>
<div class="sourceCode" id="cb412"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb412-1"><a href="stats_method.html#cb412-1" tabindex="-1"></a>contrast_temp <span class="sc">%&gt;%</span> </span>
<span id="cb412-2"><a href="stats_method.html#cb412-2" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">distinct</span>(</span>
<span id="cb412-3"><a href="stats_method.html#cb412-3" tabindex="-1"></a>      spectral_weight, contrast</span>
<span id="cb412-4"><a href="stats_method.html#cb412-4" tabindex="-1"></a>      , median_hdi_est, median_hdi_lower, median_hdi_upper</span>
<span id="cb412-5"><a href="stats_method.html#cb412-5" tabindex="-1"></a>      , pr_gt_zero <span class="co"># , pr_lt_zero</span></span>
<span id="cb412-6"><a href="stats_method.html#cb412-6" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb412-7"><a href="stats_method.html#cb412-7" tabindex="-1"></a>    <span class="co"># format pcts</span></span>
<span id="cb412-8"><a href="stats_method.html#cb412-8" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(dplyr<span class="sc">::</span><span class="fu">across</span>(</span>
<span id="cb412-9"><a href="stats_method.html#cb412-9" tabindex="-1"></a>      tidyselect<span class="sc">::</span><span class="fu">starts_with</span>(<span class="st">&quot;median_hdi_&quot;</span>)</span>
<span id="cb412-10"><a href="stats_method.html#cb412-10" tabindex="-1"></a>      , <span class="sc">~</span> scales<span class="sc">::</span><span class="fu">percent</span>(.x, <span class="at">accuracy =</span> <span class="fl">0.1</span>)</span>
<span id="cb412-11"><a href="stats_method.html#cb412-11" tabindex="-1"></a>    )) <span class="sc">%&gt;%</span> </span>
<span id="cb412-12"><a href="stats_method.html#cb412-12" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">arrange</span>(spectral_weight, contrast) <span class="sc">%&gt;%</span> </span>
<span id="cb412-13"><a href="stats_method.html#cb412-13" tabindex="-1"></a>    kableExtra<span class="sc">::</span><span class="fu">kbl</span>(</span>
<span id="cb412-14"><a href="stats_method.html#cb412-14" tabindex="-1"></a>      <span class="at">digits =</span> <span class="dv">2</span></span>
<span id="cb412-15"><a href="stats_method.html#cb412-15" tabindex="-1"></a>      , <span class="at">caption =</span> <span class="st">&quot;brms::brm model: 95% HDI of the posterior predictive distribution of group constrasts&quot;</span></span>
<span id="cb412-16"><a href="stats_method.html#cb412-16" tabindex="-1"></a>      , <span class="at">col.names =</span> <span class="fu">c</span>(</span>
<span id="cb412-17"><a href="stats_method.html#cb412-17" tabindex="-1"></a>        <span class="st">&quot;spectral_weight&quot;</span>, <span class="st">&quot;CHM res. contrast&quot;</span></span>
<span id="cb412-18"><a href="stats_method.html#cb412-18" tabindex="-1"></a>        , <span class="st">&quot;difference (Height MAPE)&quot;</span></span>
<span id="cb412-19"><a href="stats_method.html#cb412-19" tabindex="-1"></a>        , <span class="st">&quot;HDI low&quot;</span>, <span class="st">&quot;HDI high&quot;</span></span>
<span id="cb412-20"><a href="stats_method.html#cb412-20" tabindex="-1"></a>        , <span class="st">&quot;Pr(diff&gt;0)&quot;</span></span>
<span id="cb412-21"><a href="stats_method.html#cb412-21" tabindex="-1"></a>      )</span>
<span id="cb412-22"><a href="stats_method.html#cb412-22" tabindex="-1"></a>      , <span class="at">escape =</span> F</span>
<span id="cb412-23"><a href="stats_method.html#cb412-23" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb412-24"><a href="stats_method.html#cb412-24" tabindex="-1"></a>    kableExtra<span class="sc">::</span><span class="fu">kable_styling</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb412-25"><a href="stats_method.html#cb412-25" tabindex="-1"></a>    kableExtra<span class="sc">::</span><span class="fu">collapse_rows</span>(<span class="at">columns =</span> <span class="dv">1</span>, <span class="at">valign =</span> <span class="st">&quot;top&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb412-26"><a href="stats_method.html#cb412-26" tabindex="-1"></a>    kableExtra<span class="sc">::</span><span class="fu">scroll_box</span>(<span class="at">height =</span> <span class="st">&quot;8in&quot;</span>)</span></code></pre></div>
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:8in; ">
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-398">Table 9.19: </span>brms::brm model: 95% HDI of the posterior predictive distribution of group constrasts
</caption>
<thead>
<tr>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
spectral_weight
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
CHM res. contrast
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
difference (Height MAPE)
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
HDI low
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
HDI high
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
Pr(diff&gt;0)
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="10">
spectral_weight: 0
</td>
<td style="text-align:left;">
0.2 - 0.1
</td>
<td style="text-align:left;">
-0.9%
</td>
<td style="text-align:left;">
-1.0%
</td>
<td style="text-align:left;">
-0.8%
</td>
<td style="text-align:left;">
0%
</td>
</tr>
<tr>
<td style="text-align:left;">
0.3 - 0.1
</td>
<td style="text-align:left;">
-0.7%
</td>
<td style="text-align:left;">
-0.9%
</td>
<td style="text-align:left;">
-0.6%
</td>
<td style="text-align:left;">
0%
</td>
</tr>
<tr>
<td style="text-align:left;">
0.3 - 0.2
</td>
<td style="text-align:left;">
0.2%
</td>
<td style="text-align:left;">
0.1%
</td>
<td style="text-align:left;">
0.2%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
0.4 - 0.1
</td>
<td style="text-align:left;">
0.5%
</td>
<td style="text-align:left;">
0.3%
</td>
<td style="text-align:left;">
0.7%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
0.4 - 0.2
</td>
<td style="text-align:left;">
1.4%
</td>
<td style="text-align:left;">
1.3%
</td>
<td style="text-align:left;">
1.5%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
0.4 - 0.3
</td>
<td style="text-align:left;">
1.3%
</td>
<td style="text-align:left;">
1.2%
</td>
<td style="text-align:left;">
1.3%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
0.5 - 0.1
</td>
<td style="text-align:left;">
3.1%
</td>
<td style="text-align:left;">
2.8%
</td>
<td style="text-align:left;">
3.4%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
0.5 - 0.2
</td>
<td style="text-align:left;">
4.0%
</td>
<td style="text-align:left;">
3.8%
</td>
<td style="text-align:left;">
4.2%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
0.5 - 0.3
</td>
<td style="text-align:left;">
3.8%
</td>
<td style="text-align:left;">
3.7%
</td>
<td style="text-align:left;">
4.0%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
0.5 - 0.4
</td>
<td style="text-align:left;">
2.6%
</td>
<td style="text-align:left;">
2.5%
</td>
<td style="text-align:left;">
2.7%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="10">
spectral_weight: 1
</td>
<td style="text-align:left;">
0.2 - 0.1
</td>
<td style="text-align:left;">
-0.9%
</td>
<td style="text-align:left;">
-1.0%
</td>
<td style="text-align:left;">
-0.8%
</td>
<td style="text-align:left;">
0%
</td>
</tr>
<tr>
<td style="text-align:left;">
0.3 - 0.1
</td>
<td style="text-align:left;">
-0.7%
</td>
<td style="text-align:left;">
-0.9%
</td>
<td style="text-align:left;">
-0.6%
</td>
<td style="text-align:left;">
0%
</td>
</tr>
<tr>
<td style="text-align:left;">
0.3 - 0.2
</td>
<td style="text-align:left;">
0.2%
</td>
<td style="text-align:left;">
0.1%
</td>
<td style="text-align:left;">
0.2%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
0.4 - 0.1
</td>
<td style="text-align:left;">
0.5%
</td>
<td style="text-align:left;">
0.3%
</td>
<td style="text-align:left;">
0.7%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
0.4 - 0.2
</td>
<td style="text-align:left;">
1.4%
</td>
<td style="text-align:left;">
1.3%
</td>
<td style="text-align:left;">
1.5%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
0.4 - 0.3
</td>
<td style="text-align:left;">
1.2%
</td>
<td style="text-align:left;">
1.2%
</td>
<td style="text-align:left;">
1.3%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
0.5 - 0.1
</td>
<td style="text-align:left;">
3.1%
</td>
<td style="text-align:left;">
2.8%
</td>
<td style="text-align:left;">
3.4%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
0.5 - 0.2
</td>
<td style="text-align:left;">
4.0%
</td>
<td style="text-align:left;">
3.8%
</td>
<td style="text-align:left;">
4.2%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
0.5 - 0.3
</td>
<td style="text-align:left;">
3.8%
</td>
<td style="text-align:left;">
3.7%
</td>
<td style="text-align:left;">
4.0%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
0.5 - 0.4
</td>
<td style="text-align:left;">
2.6%
</td>
<td style="text-align:left;">
2.5%
</td>
<td style="text-align:left;">
2.7%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="10">
spectral_weight: 2
</td>
<td style="text-align:left;">
0.2 - 0.1
</td>
<td style="text-align:left;">
-0.9%
</td>
<td style="text-align:left;">
-1.0%
</td>
<td style="text-align:left;">
-0.8%
</td>
<td style="text-align:left;">
0%
</td>
</tr>
<tr>
<td style="text-align:left;">
0.3 - 0.1
</td>
<td style="text-align:left;">
-0.7%
</td>
<td style="text-align:left;">
-0.9%
</td>
<td style="text-align:left;">
-0.6%
</td>
<td style="text-align:left;">
0%
</td>
</tr>
<tr>
<td style="text-align:left;">
0.3 - 0.2
</td>
<td style="text-align:left;">
0.2%
</td>
<td style="text-align:left;">
0.1%
</td>
<td style="text-align:left;">
0.2%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
0.4 - 0.1
</td>
<td style="text-align:left;">
0.5%
</td>
<td style="text-align:left;">
0.3%
</td>
<td style="text-align:left;">
0.7%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
0.4 - 0.2
</td>
<td style="text-align:left;">
1.4%
</td>
<td style="text-align:left;">
1.3%
</td>
<td style="text-align:left;">
1.5%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
0.4 - 0.3
</td>
<td style="text-align:left;">
1.2%
</td>
<td style="text-align:left;">
1.2%
</td>
<td style="text-align:left;">
1.3%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
0.5 - 0.1
</td>
<td style="text-align:left;">
3.1%
</td>
<td style="text-align:left;">
2.8%
</td>
<td style="text-align:left;">
3.4%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
0.5 - 0.2
</td>
<td style="text-align:left;">
4.0%
</td>
<td style="text-align:left;">
3.8%
</td>
<td style="text-align:left;">
4.2%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
0.5 - 0.3
</td>
<td style="text-align:left;">
3.8%
</td>
<td style="text-align:left;">
3.6%
</td>
<td style="text-align:left;">
4.0%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
0.5 - 0.4
</td>
<td style="text-align:left;">
2.6%
</td>
<td style="text-align:left;">
2.5%
</td>
<td style="text-align:left;">
2.7%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="10">
spectral_weight: 3
</td>
<td style="text-align:left;">
0.2 - 0.1
</td>
<td style="text-align:left;">
-0.9%
</td>
<td style="text-align:left;">
-1.0%
</td>
<td style="text-align:left;">
-0.8%
</td>
<td style="text-align:left;">
0%
</td>
</tr>
<tr>
<td style="text-align:left;">
0.3 - 0.1
</td>
<td style="text-align:left;">
-0.7%
</td>
<td style="text-align:left;">
-0.9%
</td>
<td style="text-align:left;">
-0.6%
</td>
<td style="text-align:left;">
0%
</td>
</tr>
<tr>
<td style="text-align:left;">
0.3 - 0.2
</td>
<td style="text-align:left;">
0.2%
</td>
<td style="text-align:left;">
0.1%
</td>
<td style="text-align:left;">
0.2%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
0.4 - 0.1
</td>
<td style="text-align:left;">
0.5%
</td>
<td style="text-align:left;">
0.3%
</td>
<td style="text-align:left;">
0.7%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
0.4 - 0.2
</td>
<td style="text-align:left;">
1.4%
</td>
<td style="text-align:left;">
1.3%
</td>
<td style="text-align:left;">
1.5%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
0.4 - 0.3
</td>
<td style="text-align:left;">
1.2%
</td>
<td style="text-align:left;">
1.2%
</td>
<td style="text-align:left;">
1.3%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
0.5 - 0.1
</td>
<td style="text-align:left;">
3.1%
</td>
<td style="text-align:left;">
2.8%
</td>
<td style="text-align:left;">
3.4%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
0.5 - 0.2
</td>
<td style="text-align:left;">
4.0%
</td>
<td style="text-align:left;">
3.8%
</td>
<td style="text-align:left;">
4.2%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
0.5 - 0.3
</td>
<td style="text-align:left;">
3.8%
</td>
<td style="text-align:left;">
3.7%
</td>
<td style="text-align:left;">
4.0%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
0.5 - 0.4
</td>
<td style="text-align:left;">
2.6%
</td>
<td style="text-align:left;">
2.5%
</td>
<td style="text-align:left;">
2.7%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="10">
spectral_weight: 4
</td>
<td style="text-align:left;">
0.2 - 0.1
</td>
<td style="text-align:left;">
-0.9%
</td>
<td style="text-align:left;">
-1.0%
</td>
<td style="text-align:left;">
-0.8%
</td>
<td style="text-align:left;">
0%
</td>
</tr>
<tr>
<td style="text-align:left;">
0.3 - 0.1
</td>
<td style="text-align:left;">
-0.7%
</td>
<td style="text-align:left;">
-0.9%
</td>
<td style="text-align:left;">
-0.6%
</td>
<td style="text-align:left;">
0%
</td>
</tr>
<tr>
<td style="text-align:left;">
0.3 - 0.2
</td>
<td style="text-align:left;">
0.2%
</td>
<td style="text-align:left;">
0.1%
</td>
<td style="text-align:left;">
0.2%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
0.4 - 0.1
</td>
<td style="text-align:left;">
0.5%
</td>
<td style="text-align:left;">
0.3%
</td>
<td style="text-align:left;">
0.7%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
0.4 - 0.2
</td>
<td style="text-align:left;">
1.4%
</td>
<td style="text-align:left;">
1.3%
</td>
<td style="text-align:left;">
1.5%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
0.4 - 0.3
</td>
<td style="text-align:left;">
1.2%
</td>
<td style="text-align:left;">
1.2%
</td>
<td style="text-align:left;">
1.3%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
0.5 - 0.1
</td>
<td style="text-align:left;">
3.1%
</td>
<td style="text-align:left;">
2.8%
</td>
<td style="text-align:left;">
3.4%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
0.5 - 0.2
</td>
<td style="text-align:left;">
4.0%
</td>
<td style="text-align:left;">
3.8%
</td>
<td style="text-align:left;">
4.2%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
0.5 - 0.3
</td>
<td style="text-align:left;">
3.8%
</td>
<td style="text-align:left;">
3.7%
</td>
<td style="text-align:left;">
4.0%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
0.5 - 0.4
</td>
<td style="text-align:left;">
2.6%
</td>
<td style="text-align:left;">
2.5%
</td>
<td style="text-align:left;">
2.7%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="10">
spectral_weight: 5
</td>
<td style="text-align:left;">
0.2 - 0.1
</td>
<td style="text-align:left;">
-0.8%
</td>
<td style="text-align:left;">
-0.9%
</td>
<td style="text-align:left;">
-0.7%
</td>
<td style="text-align:left;">
0%
</td>
</tr>
<tr>
<td style="text-align:left;">
0.3 - 0.1
</td>
<td style="text-align:left;">
-0.5%
</td>
<td style="text-align:left;">
-0.7%
</td>
<td style="text-align:left;">
-0.4%
</td>
<td style="text-align:left;">
0%
</td>
</tr>
<tr>
<td style="text-align:left;">
0.3 - 0.2
</td>
<td style="text-align:left;">
0.3%
</td>
<td style="text-align:left;">
0.2%
</td>
<td style="text-align:left;">
0.3%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
0.4 - 0.1
</td>
<td style="text-align:left;">
0.8%
</td>
<td style="text-align:left;">
0.6%
</td>
<td style="text-align:left;">
1.0%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
0.4 - 0.2
</td>
<td style="text-align:left;">
1.6%
</td>
<td style="text-align:left;">
1.5%
</td>
<td style="text-align:left;">
1.7%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
0.4 - 0.3
</td>
<td style="text-align:left;">
1.3%
</td>
<td style="text-align:left;">
1.3%
</td>
<td style="text-align:left;">
1.4%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
0.5 - 0.1
</td>
<td style="text-align:left;">
3.5%
</td>
<td style="text-align:left;">
3.3%
</td>
<td style="text-align:left;">
3.8%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
0.5 - 0.2
</td>
<td style="text-align:left;">
4.3%
</td>
<td style="text-align:left;">
4.1%
</td>
<td style="text-align:left;">
4.5%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
0.5 - 0.3
</td>
<td style="text-align:left;">
4.0%
</td>
<td style="text-align:left;">
3.9%
</td>
<td style="text-align:left;">
4.2%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
<tr>
<td style="text-align:left;">
0.5 - 0.4
</td>
<td style="text-align:left;">
2.7%
</td>
<td style="text-align:left;">
2.6%
</td>
<td style="text-align:left;">
2.8%
</td>
<td style="text-align:left;">
100%
</td>
</tr>
</tbody>
</table>
</div>
<p>these contrasts confirm what we saw by looking at the predicted relationship between CHM resolution and height MAPE, that increasing the coarseness of the CHM data has a minimal impact of about 1 percentage point on Height quantification accuracy for CHM data with resolutions in the range of 0.1m to 0.4m. however, increasing the CHM resolution coarseness beyond this level results in a more significant reduction in Height quantification accuracy (i.e. increase in height MAPE) and accuracy degrades at an increasing rate the more coarse the CHM data. for example, when spectral data is not included (i.e. <code>spectral_weight</code> = 0) the predicted difference in Height MAPE is ~1% when going from 0.1m to 0.2m-0.4m CHM data but a decrease in height quantification accuracy of ~4 percentage points is predicted going from 0.2m to 0.5m CHM data, for example.</p>
</div>
<div id="spectral-data-2" class="section level5 hasAnchor" number="9.3.5.2.2">
<h5><span class="header-section-number">9.3.5.2.2</span> Spectral data<a href="stats_method.html#spectral-data-2" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>now we’ll look at the impact of including (or excluding) spectral data and the weighting of the <code>spectral_weight</code> parameter where a value of “0” indicates no spectral data was used (i.e. structural only), the lowest weighting of the spectral data is “1” (only one spectral index threshold must be met), and the highest weighting of spectral data is “5” (all spectral index thresholds must be met).</p>
<p><em>Note</em>:
we expect that the spectral data does not significantly alter the quantification of slash pile form. this is because spectral information is used solely to filter candidate piles, meaning it neither reshapes existing ones nor introduces new detections.</p>
<div class="sourceCode" id="cb413"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb413-1"><a href="stats_method.html#cb413-1" tabindex="-1"></a><span class="co"># viridis::rocket(5, begin = 0.9, end = 0.6) %&gt;% scales::show_col()</span></span>
<span id="cb413-2"><a href="stats_method.html#cb413-2" tabindex="-1"></a><span class="co"># brms::posterior_summary(brms_height_mape_mod)</span></span>
<span id="cb413-3"><a href="stats_method.html#cb413-3" tabindex="-1"></a>draws_temp <span class="sc">%&gt;%</span> </span>
<span id="cb413-4"><a href="stats_method.html#cb413-4" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(</span>
<span id="cb413-5"><a href="stats_method.html#cb413-5" tabindex="-1"></a>    <span class="fu">round</span>(chm_res_m,<span class="dv">2</span>) <span class="sc">==</span> <span class="fu">round</span>(chm_res_m,<span class="dv">1</span>) <span class="co"># let&#39;s just look at every 0.1 m (10 cm)</span></span>
<span id="cb413-6"><a href="stats_method.html#cb413-6" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb413-7"><a href="stats_method.html#cb413-7" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> spectral_weight, <span class="at">y =</span> value, <span class="at">color =</span> <span class="fu">factor</span>(chm_res_m))) <span class="sc">+</span></span>
<span id="cb413-8"><a href="stats_method.html#cb413-8" tabindex="-1"></a>  <span class="co"># tidybayes::stat_halfeye() +</span></span>
<span id="cb413-9"><a href="stats_method.html#cb413-9" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">stat_lineribbon</span>(<span class="at">point_interval =</span> <span class="st">&quot;median_hdi&quot;</span>, <span class="at">.width =</span> <span class="fu">c</span>(<span class="fl">0.95</span>)) <span class="sc">+</span></span>
<span id="cb413-10"><a href="stats_method.html#cb413-10" tabindex="-1"></a>  <span class="co"># ggplot2::facet_wrap(facets = dplyr::vars(spectral_weight))</span></span>
<span id="cb413-11"><a href="stats_method.html#cb413-11" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_fill_brewer</span>(<span class="at">palette =</span> <span class="st">&quot;Greys&quot;</span>) <span class="sc">+</span></span>
<span id="cb413-12"><a href="stats_method.html#cb413-12" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_color_viridis_d</span>(<span class="at">option =</span> <span class="st">&quot;rocket&quot;</span>, <span class="at">begin =</span> <span class="fl">0.9</span>, <span class="at">end =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb413-13"><a href="stats_method.html#cb413-13" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>percent) <span class="sc">+</span></span>
<span id="cb413-14"><a href="stats_method.html#cb413-14" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;`spectral_weight`&quot;</span>, <span class="at">color =</span> <span class="st">&quot;CHM resolution&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Height MAPE&quot;</span>) <span class="sc">+</span></span>
<span id="cb413-15"><a href="stats_method.html#cb413-15" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb413-16"><a href="stats_method.html#cb413-16" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb413-17"><a href="stats_method.html#cb413-17" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;top&quot;</span></span>
<span id="cb413-18"><a href="stats_method.html#cb413-18" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb413-19"><a href="stats_method.html#cb413-19" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">guides</span>(</span>
<span id="cb413-20"><a href="stats_method.html#cb413-20" tabindex="-1"></a>    <span class="at">color =</span> ggplot2<span class="sc">::</span><span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">shape =</span> <span class="dv">15</span>, <span class="at">lwd =</span> <span class="dv">8</span>, <span class="at">fill =</span> <span class="cn">NA</span>))</span>
<span id="cb413-21"><a href="stats_method.html#cb413-21" tabindex="-1"></a>    , <span class="at">fill =</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb413-22"><a href="stats_method.html#cb413-22" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-399-1.png" width="1008" /></p>
<p>while there is a slight change in height quantification accuracy at the highest spectral weighting, the inclusion of spectral data and the setting of the <code>spectral_weight</code> parameter does not significantly alter the height quantification accuracy irrespective of the CHM resolution</p>
<p>we can look at the posterior distributions of the expected Height MAPE at different <code>spectral_weight</code> settings by the input CHM resolution</p>
<div class="sourceCode" id="cb414"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb414-1"><a href="stats_method.html#cb414-1" tabindex="-1"></a>draws_temp <span class="sc">%&gt;%</span> </span>
<span id="cb414-2"><a href="stats_method.html#cb414-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(</span>
<span id="cb414-3"><a href="stats_method.html#cb414-3" tabindex="-1"></a>    <span class="fu">round</span>(chm_res_m,<span class="dv">2</span>) <span class="sc">==</span> <span class="fu">round</span>(chm_res_m,<span class="dv">1</span>) <span class="co"># let&#39;s just look at every 0.1 m (10 cm)</span></span>
<span id="cb414-4"><a href="stats_method.html#cb414-4" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb414-5"><a href="stats_method.html#cb414-5" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">chm_res_m =</span> chm_res_m <span class="sc">%&gt;%</span> <span class="fu">factor</span>() <span class="sc">%&gt;%</span> forcats<span class="sc">::</span><span class="fu">fct_relabel</span>(<span class="sc">~</span><span class="fu">paste0</span>(<span class="st">&quot;CHM resolution: &quot;</span>, .x, <span class="at">recycle0 =</span> T))) <span class="sc">%&gt;%</span> </span>
<span id="cb414-6"><a href="stats_method.html#cb414-6" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">y=</span>value, <span class="at">x=</span>spectral_weight)) <span class="sc">+</span></span>
<span id="cb414-7"><a href="stats_method.html#cb414-7" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">stat_eye</span>(</span>
<span id="cb414-8"><a href="stats_method.html#cb414-8" tabindex="-1"></a>    <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">fill =</span> chm_res_m)</span>
<span id="cb414-9"><a href="stats_method.html#cb414-9" tabindex="-1"></a>    , <span class="at">point_interval =</span> median_hdi, <span class="at">.width =</span> .<span class="dv">95</span></span>
<span id="cb414-10"><a href="stats_method.html#cb414-10" tabindex="-1"></a>    , <span class="at">slab_alpha =</span> <span class="fl">0.95</span></span>
<span id="cb414-11"><a href="stats_method.html#cb414-11" tabindex="-1"></a>    , <span class="at">interval_color =</span> <span class="st">&quot;gray44&quot;</span>, <span class="at">linewidth =</span> <span class="dv">1</span></span>
<span id="cb414-12"><a href="stats_method.html#cb414-12" tabindex="-1"></a>    , <span class="at">point_color =</span> <span class="st">&quot;gray44&quot;</span>, <span class="at">point_fill =</span> <span class="st">&quot;gray44&quot;</span>, <span class="at">point_size =</span> <span class="dv">1</span></span>
<span id="cb414-13"><a href="stats_method.html#cb414-13" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb414-14"><a href="stats_method.html#cb414-14" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">facet_grid</span>(<span class="at">cols =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(chm_res_m)) <span class="sc">+</span></span>
<span id="cb414-15"><a href="stats_method.html#cb414-15" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_fill_viridis_d</span>(<span class="at">option =</span> <span class="st">&quot;rocket&quot;</span>, <span class="at">begin =</span> <span class="fl">0.9</span>, <span class="at">end =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb414-16"><a href="stats_method.html#cb414-16" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="cn">NA</span>), <span class="at">labels =</span> scales<span class="sc">::</span>percent, <span class="at">breaks =</span> scales<span class="sc">::</span><span class="fu">breaks_extended</span>(<span class="dv">16</span>)) <span class="sc">+</span></span>
<span id="cb414-17"><a href="stats_method.html#cb414-17" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;`spectral_weight`&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Height MAPE&quot;</span>) <span class="sc">+</span></span>
<span id="cb414-18"><a href="stats_method.html#cb414-18" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb414-19"><a href="stats_method.html#cb414-19" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb414-20"><a href="stats_method.html#cb414-20" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb414-21"><a href="stats_method.html#cb414-21" tabindex="-1"></a>    , <span class="at">strip.text =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb414-22"><a href="stats_method.html#cb414-22" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-400-1.png" width="1008" /></p>
<p>we already saw this same data above in our CHM resolution testing, but we’ll table that again but this time grouping by CHM resolution</p>
<div class="sourceCode" id="cb415"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb415-1"><a href="stats_method.html#cb415-1" tabindex="-1"></a>draws_temp <span class="sc">%&gt;%</span> </span>
<span id="cb415-2"><a href="stats_method.html#cb415-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(</span>
<span id="cb415-3"><a href="stats_method.html#cb415-3" tabindex="-1"></a>    <span class="fu">round</span>(chm_res_m,<span class="dv">2</span>) <span class="sc">==</span> <span class="fu">round</span>(chm_res_m,<span class="dv">1</span>) <span class="co"># let&#39;s just look at every 0.1 m (10 cm)</span></span>
<span id="cb415-4"><a href="stats_method.html#cb415-4" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb415-5"><a href="stats_method.html#cb415-5" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">chm_res_m =</span> chm_res_m <span class="sc">%&gt;%</span> <span class="fu">factor</span>() <span class="sc">%&gt;%</span> forcats<span class="sc">::</span><span class="fu">fct_relabel</span>(<span class="sc">~</span><span class="fu">paste0</span>(<span class="st">&quot;CHM resolution: &quot;</span>, .x, <span class="at">recycle0 =</span> T))) <span class="sc">%&gt;%</span> </span>
<span id="cb415-6"><a href="stats_method.html#cb415-6" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(chm_res_m, spectral_weight) <span class="sc">%&gt;%</span></span>
<span id="cb415-7"><a href="stats_method.html#cb415-7" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(</span>
<span id="cb415-8"><a href="stats_method.html#cb415-8" tabindex="-1"></a>    <span class="co"># get median_hdi</span></span>
<span id="cb415-9"><a href="stats_method.html#cb415-9" tabindex="-1"></a>    <span class="at">median_hdi_est =</span> tidybayes<span class="sc">::</span><span class="fu">median_hdci</span>(value)<span class="sc">$</span>y</span>
<span id="cb415-10"><a href="stats_method.html#cb415-10" tabindex="-1"></a>    , <span class="at">median_hdi_lower =</span> tidybayes<span class="sc">::</span><span class="fu">median_hdci</span>(value)<span class="sc">$</span>ymin</span>
<span id="cb415-11"><a href="stats_method.html#cb415-11" tabindex="-1"></a>    , <span class="at">median_hdi_upper =</span> tidybayes<span class="sc">::</span><span class="fu">median_hdci</span>(value)<span class="sc">$</span>ymax</span>
<span id="cb415-12"><a href="stats_method.html#cb415-12" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb415-13"><a href="stats_method.html#cb415-13" tabindex="-1"></a>  <span class="co"># format pcts</span></span>
<span id="cb415-14"><a href="stats_method.html#cb415-14" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(dplyr<span class="sc">::</span><span class="fu">across</span>(</span>
<span id="cb415-15"><a href="stats_method.html#cb415-15" tabindex="-1"></a>    tidyselect<span class="sc">::</span><span class="fu">starts_with</span>(<span class="st">&quot;median_hdi_&quot;</span>)</span>
<span id="cb415-16"><a href="stats_method.html#cb415-16" tabindex="-1"></a>    , <span class="sc">~</span> scales<span class="sc">::</span><span class="fu">percent</span>(.x, <span class="at">accuracy =</span> <span class="fl">0.1</span>)</span>
<span id="cb415-17"><a href="stats_method.html#cb415-17" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb415-18"><a href="stats_method.html#cb415-18" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb415-19"><a href="stats_method.html#cb415-19" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(chm_res_m,spectral_weight) <span class="sc">%&gt;%</span> </span>
<span id="cb415-20"><a href="stats_method.html#cb415-20" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kbl</span>(</span>
<span id="cb415-21"><a href="stats_method.html#cb415-21" tabindex="-1"></a>    <span class="at">digits =</span> <span class="dv">2</span></span>
<span id="cb415-22"><a href="stats_method.html#cb415-22" tabindex="-1"></a>    , <span class="at">caption =</span> <span class="st">&quot;Height MAPE&lt;br&gt;95% HDI of the posterior predictive distribution&quot;</span></span>
<span id="cb415-23"><a href="stats_method.html#cb415-23" tabindex="-1"></a>    , <span class="at">col.names =</span> <span class="fu">c</span>(</span>
<span id="cb415-24"><a href="stats_method.html#cb415-24" tabindex="-1"></a>      <span class="st">&quot;CHM resolution&quot;</span>, <span class="st">&quot;spectral_weight&quot;</span></span>
<span id="cb415-25"><a href="stats_method.html#cb415-25" tabindex="-1"></a>      , <span class="fu">c</span>(<span class="st">&quot;Height MAPE&lt;br&gt;median&quot;</span>, <span class="st">&quot;HDI low&quot;</span>, <span class="st">&quot;HDI high&quot;</span>)</span>
<span id="cb415-26"><a href="stats_method.html#cb415-26" tabindex="-1"></a>    )</span>
<span id="cb415-27"><a href="stats_method.html#cb415-27" tabindex="-1"></a>    , <span class="at">escape =</span> F</span>
<span id="cb415-28"><a href="stats_method.html#cb415-28" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb415-29"><a href="stats_method.html#cb415-29" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kable_styling</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb415-30"><a href="stats_method.html#cb415-30" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">collapse_rows</span>(<span class="at">columns =</span> <span class="dv">1</span>, <span class="at">valign =</span> <span class="st">&quot;top&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb415-31"><a href="stats_method.html#cb415-31" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">scroll_box</span>(<span class="at">height =</span> <span class="st">&quot;8in&quot;</span>)</span></code></pre></div>
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:8in; ">
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-401">Table 9.20: </span>Height MAPE<br>95% HDI of the posterior predictive distribution
</caption>
<thead>
<tr>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
CHM resolution
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
spectral_weight
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
Height MAPE<br>median
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
HDI low
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
HDI high
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="6">
CHM resolution: 0.1
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
16.7%
</td>
<td style="text-align:left;">
16.5%
</td>
<td style="text-align:left;">
16.9%
</td>
</tr>
<tr>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
16.7%
</td>
<td style="text-align:left;">
16.6%
</td>
<td style="text-align:left;">
16.9%
</td>
</tr>
<tr>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
16.7%
</td>
<td style="text-align:left;">
16.6%
</td>
<td style="text-align:left;">
16.9%
</td>
</tr>
<tr>
<td style="text-align:left;">
3
</td>
<td style="text-align:left;">
16.7%
</td>
<td style="text-align:left;">
16.6%
</td>
<td style="text-align:left;">
16.9%
</td>
</tr>
<tr>
<td style="text-align:left;">
4
</td>
<td style="text-align:left;">
16.7%
</td>
<td style="text-align:left;">
16.6%
</td>
<td style="text-align:left;">
16.9%
</td>
</tr>
<tr>
<td style="text-align:left;">
5
</td>
<td style="text-align:left;">
16.4%
</td>
<td style="text-align:left;">
16.2%
</td>
<td style="text-align:left;">
16.6%
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="6">
CHM resolution: 0.2
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
15.8%
</td>
<td style="text-align:left;">
15.7%
</td>
<td style="text-align:left;">
15.9%
</td>
</tr>
<tr>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
15.8%
</td>
<td style="text-align:left;">
15.7%
</td>
<td style="text-align:left;">
15.9%
</td>
</tr>
<tr>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
15.8%
</td>
<td style="text-align:left;">
15.7%
</td>
<td style="text-align:left;">
15.9%
</td>
</tr>
<tr>
<td style="text-align:left;">
3
</td>
<td style="text-align:left;">
15.8%
</td>
<td style="text-align:left;">
15.7%
</td>
<td style="text-align:left;">
16.0%
</td>
</tr>
<tr>
<td style="text-align:left;">
4
</td>
<td style="text-align:left;">
15.8%
</td>
<td style="text-align:left;">
15.7%
</td>
<td style="text-align:left;">
15.9%
</td>
</tr>
<tr>
<td style="text-align:left;">
5
</td>
<td style="text-align:left;">
15.6%
</td>
<td style="text-align:left;">
15.5%
</td>
<td style="text-align:left;">
15.7%
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="6">
CHM resolution: 0.3
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
16.0%
</td>
<td style="text-align:left;">
15.9%
</td>
<td style="text-align:left;">
16.1%
</td>
</tr>
<tr>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
16.0%
</td>
<td style="text-align:left;">
15.9%
</td>
<td style="text-align:left;">
16.1%
</td>
</tr>
<tr>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
16.0%
</td>
<td style="text-align:left;">
15.9%
</td>
<td style="text-align:left;">
16.1%
</td>
</tr>
<tr>
<td style="text-align:left;">
3
</td>
<td style="text-align:left;">
16.0%
</td>
<td style="text-align:left;">
15.9%
</td>
<td style="text-align:left;">
16.1%
</td>
</tr>
<tr>
<td style="text-align:left;">
4
</td>
<td style="text-align:left;">
16.0%
</td>
<td style="text-align:left;">
15.9%
</td>
<td style="text-align:left;">
16.1%
</td>
</tr>
<tr>
<td style="text-align:left;">
5
</td>
<td style="text-align:left;">
15.9%
</td>
<td style="text-align:left;">
15.8%
</td>
<td style="text-align:left;">
16.0%
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="6">
CHM resolution: 0.4
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
17.2%
</td>
<td style="text-align:left;">
17.1%
</td>
<td style="text-align:left;">
17.4%
</td>
</tr>
<tr>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
17.2%
</td>
<td style="text-align:left;">
17.1%
</td>
<td style="text-align:left;">
17.4%
</td>
</tr>
<tr>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
17.2%
</td>
<td style="text-align:left;">
17.1%
</td>
<td style="text-align:left;">
17.4%
</td>
</tr>
<tr>
<td style="text-align:left;">
3
</td>
<td style="text-align:left;">
17.2%
</td>
<td style="text-align:left;">
17.1%
</td>
<td style="text-align:left;">
17.4%
</td>
</tr>
<tr>
<td style="text-align:left;">
4
</td>
<td style="text-align:left;">
17.2%
</td>
<td style="text-align:left;">
17.1%
</td>
<td style="text-align:left;">
17.4%
</td>
</tr>
<tr>
<td style="text-align:left;">
5
</td>
<td style="text-align:left;">
17.2%
</td>
<td style="text-align:left;">
17.1%
</td>
<td style="text-align:left;">
17.3%
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="6">
CHM resolution: 0.5
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
19.8%
</td>
<td style="text-align:left;">
19.6%
</td>
<td style="text-align:left;">
20.0%
</td>
</tr>
<tr>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
19.8%
</td>
<td style="text-align:left;">
19.6%
</td>
<td style="text-align:left;">
20.0%
</td>
</tr>
<tr>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
19.8%
</td>
<td style="text-align:left;">
19.6%
</td>
<td style="text-align:left;">
20.0%
</td>
</tr>
<tr>
<td style="text-align:left;">
3
</td>
<td style="text-align:left;">
19.8%
</td>
<td style="text-align:left;">
19.6%
</td>
<td style="text-align:left;">
20.0%
</td>
</tr>
<tr>
<td style="text-align:left;">
4
</td>
<td style="text-align:left;">
19.8%
</td>
<td style="text-align:left;">
19.6%
</td>
<td style="text-align:left;">
20.0%
</td>
</tr>
<tr>
<td style="text-align:left;">
5
</td>
<td style="text-align:left;">
19.9%
</td>
<td style="text-align:left;">
19.7%
</td>
<td style="text-align:left;">
20.1%
</td>
</tr>
</tbody>
</table>
</div>
<p>now we’ll probabilistically test the hypothesis that the inclusion of spectral data improves detection accuracy and quantify by how much. we’ll look at the influence of spectral data based on the CHM resolution</p>
<p>to actually compare the different levels of <code>spectral_weight</code>, we’ll use the MCMC draws to contrast the posterior predictions at different levels of the parameter (see below)</p>
<div class="sourceCode" id="cb416"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb416-1"><a href="stats_method.html#cb416-1" tabindex="-1"></a>contrast_temp <span class="ot">&lt;-</span> </span>
<span id="cb416-2"><a href="stats_method.html#cb416-2" tabindex="-1"></a>  draws_temp <span class="sc">%&gt;%</span> </span>
<span id="cb416-3"><a href="stats_method.html#cb416-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(</span>
<span id="cb416-4"><a href="stats_method.html#cb416-4" tabindex="-1"></a>    <span class="fu">round</span>(chm_res_m,<span class="dv">2</span>) <span class="sc">==</span> <span class="fu">round</span>(chm_res_m,<span class="dv">1</span>) <span class="co"># let&#39;s just look at every 0.1 m (10 cm)</span></span>
<span id="cb416-5"><a href="stats_method.html#cb416-5" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb416-6"><a href="stats_method.html#cb416-6" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(chm_res_m) <span class="sc">%&gt;%</span> </span>
<span id="cb416-7"><a href="stats_method.html#cb416-7" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">compare_levels</span>(</span>
<span id="cb416-8"><a href="stats_method.html#cb416-8" tabindex="-1"></a>    value</span>
<span id="cb416-9"><a href="stats_method.html#cb416-9" tabindex="-1"></a>    , <span class="at">by =</span> spectral_weight</span>
<span id="cb416-10"><a href="stats_method.html#cb416-10" tabindex="-1"></a>    , <span class="at">comparison =</span> </span>
<span id="cb416-11"><a href="stats_method.html#cb416-11" tabindex="-1"></a>      <span class="co"># tidybayes::emmeans_comparison(&quot;revpairwise&quot;) </span></span>
<span id="cb416-12"><a href="stats_method.html#cb416-12" tabindex="-1"></a>      <span class="st">&quot;pairwise&quot;</span></span>
<span id="cb416-13"><a href="stats_method.html#cb416-13" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb416-14"><a href="stats_method.html#cb416-14" tabindex="-1"></a>  <span class="co"># dplyr::glimpse()</span></span>
<span id="cb416-15"><a href="stats_method.html#cb416-15" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">contrast =</span> spectral_weight) <span class="sc">%&gt;%</span> </span>
<span id="cb416-16"><a href="stats_method.html#cb416-16" tabindex="-1"></a>  <span class="co"># group the data before calculating contrast variables %&gt;% </span></span>
<span id="cb416-17"><a href="stats_method.html#cb416-17" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(chm_res_m, contrast) <span class="sc">%&gt;%</span> </span>
<span id="cb416-18"><a href="stats_method.html#cb416-18" tabindex="-1"></a>  <span class="fu">make_contrast_vars</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb416-19"><a href="stats_method.html#cb416-19" tabindex="-1"></a>  <span class="co"># relabel the label for the facets</span></span>
<span id="cb416-20"><a href="stats_method.html#cb416-20" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">chm_res_m =</span> chm_res_m <span class="sc">%&gt;%</span> <span class="fu">factor</span>() <span class="sc">%&gt;%</span> forcats<span class="sc">::</span><span class="fu">fct_relabel</span>(<span class="sc">~</span><span class="fu">paste0</span>(<span class="st">&quot;CHM resolution: &quot;</span>, .x, <span class="at">recycle0 =</span> T)))</span>
<span id="cb416-21"><a href="stats_method.html#cb416-21" tabindex="-1"></a><span class="co"># huh?</span></span>
<span id="cb416-22"><a href="stats_method.html#cb416-22" tabindex="-1"></a><span class="co"># contrast_temp %&gt;% dplyr::glimpse()</span></span>
<span id="cb416-23"><a href="stats_method.html#cb416-23" tabindex="-1"></a></span>
<span id="cb416-24"><a href="stats_method.html#cb416-24" tabindex="-1"></a><span class="co"># plot it</span></span>
<span id="cb416-25"><a href="stats_method.html#cb416-25" tabindex="-1"></a><span class="fu">plt_contrast</span>(</span>
<span id="cb416-26"><a href="stats_method.html#cb416-26" tabindex="-1"></a>  contrast_temp</span>
<span id="cb416-27"><a href="stats_method.html#cb416-27" tabindex="-1"></a>  <span class="co"># , caption_text = form_temp</span></span>
<span id="cb416-28"><a href="stats_method.html#cb416-28" tabindex="-1"></a>  , <span class="at">y_axis_title =</span> <span class="st">&quot;`spectral_weight` contrast&quot;</span></span>
<span id="cb416-29"><a href="stats_method.html#cb416-29" tabindex="-1"></a>  , <span class="at">x_axis_title =</span> <span class="st">&quot;difference (Height MAPE)&quot;</span></span>
<span id="cb416-30"><a href="stats_method.html#cb416-30" tabindex="-1"></a>  , <span class="at">facet =</span> <span class="st">&quot;chm_res_m&quot;</span></span>
<span id="cb416-31"><a href="stats_method.html#cb416-31" tabindex="-1"></a>  , <span class="at">label_size =</span> <span class="fl">1.7</span></span>
<span id="cb416-32"><a href="stats_method.html#cb416-32" tabindex="-1"></a>  , <span class="at">x_expand =</span> <span class="fu">c</span>(<span class="fl">0.4</span>,<span class="fl">0.3</span>)</span>
<span id="cb416-33"><a href="stats_method.html#cb416-33" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb416-34"><a href="stats_method.html#cb416-34" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb416-35"><a href="stats_method.html#cb416-35" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">&quot;posterior predictive distribution of group constrasts with 95% &amp; 50% HDI</span><span class="sc">\n</span><span class="st">by `chm_res_m`&quot;</span></span>
<span id="cb416-36"><a href="stats_method.html#cb416-36" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-402-1.png" width="1008" /></p>
<p>let’s table it</p>
<div class="sourceCode" id="cb417"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb417-1"><a href="stats_method.html#cb417-1" tabindex="-1"></a>contrast_temp <span class="sc">%&gt;%</span> </span>
<span id="cb417-2"><a href="stats_method.html#cb417-2" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">distinct</span>(</span>
<span id="cb417-3"><a href="stats_method.html#cb417-3" tabindex="-1"></a>      chm_res_m, contrast</span>
<span id="cb417-4"><a href="stats_method.html#cb417-4" tabindex="-1"></a>      , median_hdi_est, median_hdi_lower, median_hdi_upper</span>
<span id="cb417-5"><a href="stats_method.html#cb417-5" tabindex="-1"></a>      <span class="co"># , pr_lt_zero </span></span>
<span id="cb417-6"><a href="stats_method.html#cb417-6" tabindex="-1"></a>      , pr_gt_zero</span>
<span id="cb417-7"><a href="stats_method.html#cb417-7" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb417-8"><a href="stats_method.html#cb417-8" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">arrange</span>(chm_res_m, contrast) <span class="sc">%&gt;%</span> </span>
<span id="cb417-9"><a href="stats_method.html#cb417-9" tabindex="-1"></a>    <span class="co"># format pcts</span></span>
<span id="cb417-10"><a href="stats_method.html#cb417-10" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(dplyr<span class="sc">::</span><span class="fu">across</span>(</span>
<span id="cb417-11"><a href="stats_method.html#cb417-11" tabindex="-1"></a>      tidyselect<span class="sc">::</span><span class="fu">starts_with</span>(<span class="st">&quot;median_hdi_&quot;</span>)</span>
<span id="cb417-12"><a href="stats_method.html#cb417-12" tabindex="-1"></a>      , <span class="sc">~</span> scales<span class="sc">::</span><span class="fu">percent</span>(.x, <span class="at">accuracy =</span> <span class="fl">0.1</span>)</span>
<span id="cb417-13"><a href="stats_method.html#cb417-13" tabindex="-1"></a>    )) <span class="sc">%&gt;%</span> </span>
<span id="cb417-14"><a href="stats_method.html#cb417-14" tabindex="-1"></a>    kableExtra<span class="sc">::</span><span class="fu">kbl</span>(</span>
<span id="cb417-15"><a href="stats_method.html#cb417-15" tabindex="-1"></a>      <span class="at">digits =</span> <span class="dv">2</span></span>
<span id="cb417-16"><a href="stats_method.html#cb417-16" tabindex="-1"></a>      , <span class="at">caption =</span> <span class="st">&quot;brms::brm model: 95% HDI of the posterior predictive distribution of group constrasts&quot;</span></span>
<span id="cb417-17"><a href="stats_method.html#cb417-17" tabindex="-1"></a>      , <span class="at">col.names =</span> <span class="fu">c</span>(</span>
<span id="cb417-18"><a href="stats_method.html#cb417-18" tabindex="-1"></a>        <span class="st">&quot;CHM resolution&quot;</span>, <span class="st">&quot;spectral_weight&quot;</span></span>
<span id="cb417-19"><a href="stats_method.html#cb417-19" tabindex="-1"></a>        , <span class="st">&quot;difference (Height MAPE)&quot;</span></span>
<span id="cb417-20"><a href="stats_method.html#cb417-20" tabindex="-1"></a>        , <span class="st">&quot;HDI low&quot;</span>, <span class="st">&quot;HDI high&quot;</span></span>
<span id="cb417-21"><a href="stats_method.html#cb417-21" tabindex="-1"></a>        <span class="co"># , &quot;Pr(diff&lt;0)&quot;</span></span>
<span id="cb417-22"><a href="stats_method.html#cb417-22" tabindex="-1"></a>        , <span class="st">&quot;Pr(diff&gt;0)&quot;</span></span>
<span id="cb417-23"><a href="stats_method.html#cb417-23" tabindex="-1"></a>      )</span>
<span id="cb417-24"><a href="stats_method.html#cb417-24" tabindex="-1"></a>      , <span class="at">escape =</span> F</span>
<span id="cb417-25"><a href="stats_method.html#cb417-25" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb417-26"><a href="stats_method.html#cb417-26" tabindex="-1"></a>    kableExtra<span class="sc">::</span><span class="fu">kable_styling</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb417-27"><a href="stats_method.html#cb417-27" tabindex="-1"></a>    kableExtra<span class="sc">::</span><span class="fu">collapse_rows</span>(<span class="at">columns =</span> <span class="dv">1</span>, <span class="at">valign =</span> <span class="st">&quot;top&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb417-28"><a href="stats_method.html#cb417-28" tabindex="-1"></a>    kableExtra<span class="sc">::</span><span class="fu">scroll_box</span>(<span class="at">height =</span> <span class="st">&quot;8in&quot;</span>)</span></code></pre></div>
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:8in; ">
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-403">Table 9.21: </span>brms::brm model: 95% HDI of the posterior predictive distribution of group constrasts
</caption>
<thead>
<tr>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
CHM resolution
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
spectral_weight
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
difference (Height MAPE)
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
HDI low
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
HDI high
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
Pr(diff&gt;0)
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="15">
CHM resolution: 0.1
</td>
<td style="text-align:left;">
1 - 0
</td>
<td style="text-align:left;">
0.0%
</td>
<td style="text-align:left;">
-0.2%
</td>
<td style="text-align:left;">
0.3%
</td>
<td style="text-align:left;">
50%
</td>
</tr>
<tr>
<td style="text-align:left;">
2 - 0
</td>
<td style="text-align:left;">
0.0%
</td>
<td style="text-align:left;">
-0.2%
</td>
<td style="text-align:left;">
0.2%
</td>
<td style="text-align:left;">
51%
</td>
</tr>
<tr>
<td style="text-align:left;">
2 - 1
</td>
<td style="text-align:left;">
0.0%
</td>
<td style="text-align:left;">
-0.2%
</td>
<td style="text-align:left;">
0.2%
</td>
<td style="text-align:left;">
52%
</td>
</tr>
<tr>
<td style="text-align:left;">
3 - 0
</td>
<td style="text-align:left;">
0.0%
</td>
<td style="text-align:left;">
-0.2%
</td>
<td style="text-align:left;">
0.2%
</td>
<td style="text-align:left;">
51%
</td>
</tr>
<tr>
<td style="text-align:left;">
3 - 1
</td>
<td style="text-align:left;">
0.0%
</td>
<td style="text-align:left;">
-0.2%
</td>
<td style="text-align:left;">
0.2%
</td>
<td style="text-align:left;">
53%
</td>
</tr>
<tr>
<td style="text-align:left;">
3 - 2
</td>
<td style="text-align:left;">
0.0%
</td>
<td style="text-align:left;">
-0.2%
</td>
<td style="text-align:left;">
0.2%
</td>
<td style="text-align:left;">
50%
</td>
</tr>
<tr>
<td style="text-align:left;">
4 - 0
</td>
<td style="text-align:left;">
0.0%
</td>
<td style="text-align:left;">
-0.2%
</td>
<td style="text-align:left;">
0.2%
</td>
<td style="text-align:left;">
50%
</td>
</tr>
<tr>
<td style="text-align:left;">
4 - 1
</td>
<td style="text-align:left;">
0.0%
</td>
<td style="text-align:left;">
-0.2%
</td>
<td style="text-align:left;">
0.2%
</td>
<td style="text-align:left;">
51%
</td>
</tr>
<tr>
<td style="text-align:left;">
4 - 2
</td>
<td style="text-align:left;">
0.0%
</td>
<td style="text-align:left;">
-0.2%
</td>
<td style="text-align:left;">
0.2%
</td>
<td style="text-align:left;">
49%
</td>
</tr>
<tr>
<td style="text-align:left;">
4 - 3
</td>
<td style="text-align:left;">
0.0%
</td>
<td style="text-align:left;">
-0.2%
</td>
<td style="text-align:left;">
0.2%
</td>
<td style="text-align:left;">
48%
</td>
</tr>
<tr>
<td style="text-align:left;">
5 - 0
</td>
<td style="text-align:left;">
-0.3%
</td>
<td style="text-align:left;">
-0.5%
</td>
<td style="text-align:left;">
-0.1%
</td>
<td style="text-align:left;">
0%
</td>
</tr>
<tr>
<td style="text-align:left;">
5 - 1
</td>
<td style="text-align:left;">
-0.3%
</td>
<td style="text-align:left;">
-0.5%
</td>
<td style="text-align:left;">
-0.1%
</td>
<td style="text-align:left;">
0%
</td>
</tr>
<tr>
<td style="text-align:left;">
5 - 2
</td>
<td style="text-align:left;">
-0.3%
</td>
<td style="text-align:left;">
-0.5%
</td>
<td style="text-align:left;">
-0.1%
</td>
<td style="text-align:left;">
0%
</td>
</tr>
<tr>
<td style="text-align:left;">
5 - 3
</td>
<td style="text-align:left;">
-0.3%
</td>
<td style="text-align:left;">
-0.5%
</td>
<td style="text-align:left;">
-0.1%
</td>
<td style="text-align:left;">
0%
</td>
</tr>
<tr>
<td style="text-align:left;">
5 - 4
</td>
<td style="text-align:left;">
-0.3%
</td>
<td style="text-align:left;">
-0.5%
</td>
<td style="text-align:left;">
-0.1%
</td>
<td style="text-align:left;">
0%
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="15">
CHM resolution: 0.2
</td>
<td style="text-align:left;">
1 - 0
</td>
<td style="text-align:left;">
0.0%
</td>
<td style="text-align:left;">
-0.1%
</td>
<td style="text-align:left;">
0.2%
</td>
<td style="text-align:left;">
50%
</td>
</tr>
<tr>
<td style="text-align:left;">
2 - 0
</td>
<td style="text-align:left;">
0.0%
</td>
<td style="text-align:left;">
-0.1%
</td>
<td style="text-align:left;">
0.1%
</td>
<td style="text-align:left;">
50%
</td>
</tr>
<tr>
<td style="text-align:left;">
2 - 1
</td>
<td style="text-align:left;">
0.0%
</td>
<td style="text-align:left;">
-0.1%
</td>
<td style="text-align:left;">
0.1%
</td>
<td style="text-align:left;">
50%
</td>
</tr>
<tr>
<td style="text-align:left;">
3 - 0
</td>
<td style="text-align:left;">
0.0%
</td>
<td style="text-align:left;">
-0.1%
</td>
<td style="text-align:left;">
0.1%
</td>
<td style="text-align:left;">
51%
</td>
</tr>
<tr>
<td style="text-align:left;">
3 - 1
</td>
<td style="text-align:left;">
0.0%
</td>
<td style="text-align:left;">
-0.1%
</td>
<td style="text-align:left;">
0.1%
</td>
<td style="text-align:left;">
53%
</td>
</tr>
<tr>
<td style="text-align:left;">
3 - 2
</td>
<td style="text-align:left;">
0.0%
</td>
<td style="text-align:left;">
-0.1%
</td>
<td style="text-align:left;">
0.1%
</td>
<td style="text-align:left;">
50%
</td>
</tr>
<tr>
<td style="text-align:left;">
4 - 0
</td>
<td style="text-align:left;">
0.0%
</td>
<td style="text-align:left;">
-0.1%
</td>
<td style="text-align:left;">
0.1%
</td>
<td style="text-align:left;">
50%
</td>
</tr>
<tr>
<td style="text-align:left;">
4 - 1
</td>
<td style="text-align:left;">
0.0%
</td>
<td style="text-align:left;">
-0.1%
</td>
<td style="text-align:left;">
0.1%
</td>
<td style="text-align:left;">
50%
</td>
</tr>
<tr>
<td style="text-align:left;">
4 - 2
</td>
<td style="text-align:left;">
0.0%
</td>
<td style="text-align:left;">
-0.1%
</td>
<td style="text-align:left;">
0.1%
</td>
<td style="text-align:left;">
49%
</td>
</tr>
<tr>
<td style="text-align:left;">
4 - 3
</td>
<td style="text-align:left;">
0.0%
</td>
<td style="text-align:left;">
-0.1%
</td>
<td style="text-align:left;">
0.1%
</td>
<td style="text-align:left;">
47%
</td>
</tr>
<tr>
<td style="text-align:left;">
5 - 0
</td>
<td style="text-align:left;">
-0.2%
</td>
<td style="text-align:left;">
-0.3%
</td>
<td style="text-align:left;">
-0.1%
</td>
<td style="text-align:left;">
0%
</td>
</tr>
<tr>
<td style="text-align:left;">
5 - 1
</td>
<td style="text-align:left;">
-0.2%
</td>
<td style="text-align:left;">
-0.3%
</td>
<td style="text-align:left;">
-0.1%
</td>
<td style="text-align:left;">
0%
</td>
</tr>
<tr>
<td style="text-align:left;">
5 - 2
</td>
<td style="text-align:left;">
-0.2%
</td>
<td style="text-align:left;">
-0.3%
</td>
<td style="text-align:left;">
-0.1%
</td>
<td style="text-align:left;">
1%
</td>
</tr>
<tr>
<td style="text-align:left;">
5 - 3
</td>
<td style="text-align:left;">
-0.2%
</td>
<td style="text-align:left;">
-0.3%
</td>
<td style="text-align:left;">
-0.1%
</td>
<td style="text-align:left;">
0%
</td>
</tr>
<tr>
<td style="text-align:left;">
5 - 4
</td>
<td style="text-align:left;">
-0.2%
</td>
<td style="text-align:left;">
-0.3%
</td>
<td style="text-align:left;">
-0.1%
</td>
<td style="text-align:left;">
0%
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="15">
CHM resolution: 0.3
</td>
<td style="text-align:left;">
1 - 0
</td>
<td style="text-align:left;">
0.0%
</td>
<td style="text-align:left;">
-0.1%
</td>
<td style="text-align:left;">
0.1%
</td>
<td style="text-align:left;">
50%
</td>
</tr>
<tr>
<td style="text-align:left;">
2 - 0
</td>
<td style="text-align:left;">
0.0%
</td>
<td style="text-align:left;">
-0.1%
</td>
<td style="text-align:left;">
0.1%
</td>
<td style="text-align:left;">
51%
</td>
</tr>
<tr>
<td style="text-align:left;">
2 - 1
</td>
<td style="text-align:left;">
0.0%
</td>
<td style="text-align:left;">
-0.1%
</td>
<td style="text-align:left;">
0.1%
</td>
<td style="text-align:left;">
52%
</td>
</tr>
<tr>
<td style="text-align:left;">
3 - 0
</td>
<td style="text-align:left;">
0.0%
</td>
<td style="text-align:left;">
-0.1%
</td>
<td style="text-align:left;">
0.1%
</td>
<td style="text-align:left;">
52%
</td>
</tr>
<tr>
<td style="text-align:left;">
3 - 1
</td>
<td style="text-align:left;">
0.0%
</td>
<td style="text-align:left;">
-0.1%
</td>
<td style="text-align:left;">
0.1%
</td>
<td style="text-align:left;">
52%
</td>
</tr>
<tr>
<td style="text-align:left;">
3 - 2
</td>
<td style="text-align:left;">
0.0%
</td>
<td style="text-align:left;">
-0.1%
</td>
<td style="text-align:left;">
0.1%
</td>
<td style="text-align:left;">
51%
</td>
</tr>
<tr>
<td style="text-align:left;">
4 - 0
</td>
<td style="text-align:left;">
0.0%
</td>
<td style="text-align:left;">
-0.1%
</td>
<td style="text-align:left;">
0.1%
</td>
<td style="text-align:left;">
49%
</td>
</tr>
<tr>
<td style="text-align:left;">
4 - 1
</td>
<td style="text-align:left;">
0.0%
</td>
<td style="text-align:left;">
-0.1%
</td>
<td style="text-align:left;">
0.1%
</td>
<td style="text-align:left;">
50%
</td>
</tr>
<tr>
<td style="text-align:left;">
4 - 2
</td>
<td style="text-align:left;">
0.0%
</td>
<td style="text-align:left;">
-0.1%
</td>
<td style="text-align:left;">
0.1%
</td>
<td style="text-align:left;">
50%
</td>
</tr>
<tr>
<td style="text-align:left;">
4 - 3
</td>
<td style="text-align:left;">
0.0%
</td>
<td style="text-align:left;">
-0.1%
</td>
<td style="text-align:left;">
0.1%
</td>
<td style="text-align:left;">
47%
</td>
</tr>
<tr>
<td style="text-align:left;">
5 - 0
</td>
<td style="text-align:left;">
-0.1%
</td>
<td style="text-align:left;">
-0.2%
</td>
<td style="text-align:left;">
0.0%
</td>
<td style="text-align:left;">
3%
</td>
</tr>
<tr>
<td style="text-align:left;">
5 - 1
</td>
<td style="text-align:left;">
-0.1%
</td>
<td style="text-align:left;">
-0.2%
</td>
<td style="text-align:left;">
0.0%
</td>
<td style="text-align:left;">
3%
</td>
</tr>
<tr>
<td style="text-align:left;">
5 - 2
</td>
<td style="text-align:left;">
-0.1%
</td>
<td style="text-align:left;">
-0.2%
</td>
<td style="text-align:left;">
0.0%
</td>
<td style="text-align:left;">
2%
</td>
</tr>
<tr>
<td style="text-align:left;">
5 - 3
</td>
<td style="text-align:left;">
-0.1%
</td>
<td style="text-align:left;">
-0.2%
</td>
<td style="text-align:left;">
0.0%
</td>
<td style="text-align:left;">
2%
</td>
</tr>
<tr>
<td style="text-align:left;">
5 - 4
</td>
<td style="text-align:left;">
-0.1%
</td>
<td style="text-align:left;">
-0.2%
</td>
<td style="text-align:left;">
0.0%
</td>
<td style="text-align:left;">
2%
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="15">
CHM resolution: 0.4
</td>
<td style="text-align:left;">
1 - 0
</td>
<td style="text-align:left;">
0.0%
</td>
<td style="text-align:left;">
-0.1%
</td>
<td style="text-align:left;">
0.2%
</td>
<td style="text-align:left;">
50%
</td>
</tr>
<tr>
<td style="text-align:left;">
2 - 0
</td>
<td style="text-align:left;">
0.0%
</td>
<td style="text-align:left;">
-0.2%
</td>
<td style="text-align:left;">
0.1%
</td>
<td style="text-align:left;">
49%
</td>
</tr>
<tr>
<td style="text-align:left;">
2 - 1
</td>
<td style="text-align:left;">
0.0%
</td>
<td style="text-align:left;">
-0.2%
</td>
<td style="text-align:left;">
0.1%
</td>
<td style="text-align:left;">
50%
</td>
</tr>
<tr>
<td style="text-align:left;">
3 - 0
</td>
<td style="text-align:left;">
0.0%
</td>
<td style="text-align:left;">
-0.1%
</td>
<td style="text-align:left;">
0.2%
</td>
<td style="text-align:left;">
49%
</td>
</tr>
<tr>
<td style="text-align:left;">
3 - 1
</td>
<td style="text-align:left;">
0.0%
</td>
<td style="text-align:left;">
-0.2%
</td>
<td style="text-align:left;">
0.1%
</td>
<td style="text-align:left;">
50%
</td>
</tr>
<tr>
<td style="text-align:left;">
3 - 2
</td>
<td style="text-align:left;">
0.0%
</td>
<td style="text-align:left;">
-0.1%
</td>
<td style="text-align:left;">
0.2%
</td>
<td style="text-align:left;">
50%
</td>
</tr>
<tr>
<td style="text-align:left;">
4 - 0
</td>
<td style="text-align:left;">
0.0%
</td>
<td style="text-align:left;">
-0.2%
</td>
<td style="text-align:left;">
0.1%
</td>
<td style="text-align:left;">
49%
</td>
</tr>
<tr>
<td style="text-align:left;">
4 - 1
</td>
<td style="text-align:left;">
0.0%
</td>
<td style="text-align:left;">
-0.1%
</td>
<td style="text-align:left;">
0.1%
</td>
<td style="text-align:left;">
49%
</td>
</tr>
<tr>
<td style="text-align:left;">
4 - 2
</td>
<td style="text-align:left;">
0.0%
</td>
<td style="text-align:left;">
-0.1%
</td>
<td style="text-align:left;">
0.1%
</td>
<td style="text-align:left;">
51%
</td>
</tr>
<tr>
<td style="text-align:left;">
4 - 3
</td>
<td style="text-align:left;">
0.0%
</td>
<td style="text-align:left;">
-0.2%
</td>
<td style="text-align:left;">
0.1%
</td>
<td style="text-align:left;">
50%
</td>
</tr>
<tr>
<td style="text-align:left;">
5 - 0
</td>
<td style="text-align:left;">
0.0%
</td>
<td style="text-align:left;">
-0.2%
</td>
<td style="text-align:left;">
0.1%
</td>
<td style="text-align:left;">
41%
</td>
</tr>
<tr>
<td style="text-align:left;">
5 - 1
</td>
<td style="text-align:left;">
0.0%
</td>
<td style="text-align:left;">
-0.2%
</td>
<td style="text-align:left;">
0.1%
</td>
<td style="text-align:left;">
39%
</td>
</tr>
<tr>
<td style="text-align:left;">
5 - 2
</td>
<td style="text-align:left;">
0.0%
</td>
<td style="text-align:left;">
-0.2%
</td>
<td style="text-align:left;">
0.1%
</td>
<td style="text-align:left;">
41%
</td>
</tr>
<tr>
<td style="text-align:left;">
5 - 3
</td>
<td style="text-align:left;">
0.0%
</td>
<td style="text-align:left;">
-0.2%
</td>
<td style="text-align:left;">
0.1%
</td>
<td style="text-align:left;">
40%
</td>
</tr>
<tr>
<td style="text-align:left;">
5 - 4
</td>
<td style="text-align:left;">
0.0%
</td>
<td style="text-align:left;">
-0.2%
</td>
<td style="text-align:left;">
0.1%
</td>
<td style="text-align:left;">
40%
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="15">
CHM resolution: 0.5
</td>
<td style="text-align:left;">
1 - 0
</td>
<td style="text-align:left;">
0.0%
</td>
<td style="text-align:left;">
-0.2%
</td>
<td style="text-align:left;">
0.3%
</td>
<td style="text-align:left;">
49%
</td>
</tr>
<tr>
<td style="text-align:left;">
2 - 0
</td>
<td style="text-align:left;">
0.0%
</td>
<td style="text-align:left;">
-0.3%
</td>
<td style="text-align:left;">
0.2%
</td>
<td style="text-align:left;">
50%
</td>
</tr>
<tr>
<td style="text-align:left;">
2 - 1
</td>
<td style="text-align:left;">
0.0%
</td>
<td style="text-align:left;">
-0.2%
</td>
<td style="text-align:left;">
0.2%
</td>
<td style="text-align:left;">
50%
</td>
</tr>
<tr>
<td style="text-align:left;">
3 - 0
</td>
<td style="text-align:left;">
0.0%
</td>
<td style="text-align:left;">
-0.3%
</td>
<td style="text-align:left;">
0.2%
</td>
<td style="text-align:left;">
49%
</td>
</tr>
<tr>
<td style="text-align:left;">
3 - 1
</td>
<td style="text-align:left;">
0.0%
</td>
<td style="text-align:left;">
-0.2%
</td>
<td style="text-align:left;">
0.3%
</td>
<td style="text-align:left;">
50%
</td>
</tr>
<tr>
<td style="text-align:left;">
3 - 2
</td>
<td style="text-align:left;">
0.0%
</td>
<td style="text-align:left;">
-0.2%
</td>
<td style="text-align:left;">
0.3%
</td>
<td style="text-align:left;">
48%
</td>
</tr>
<tr>
<td style="text-align:left;">
4 - 0
</td>
<td style="text-align:left;">
0.0%
</td>
<td style="text-align:left;">
-0.3%
</td>
<td style="text-align:left;">
0.2%
</td>
<td style="text-align:left;">
49%
</td>
</tr>
<tr>
<td style="text-align:left;">
4 - 1
</td>
<td style="text-align:left;">
0.0%
</td>
<td style="text-align:left;">
-0.2%
</td>
<td style="text-align:left;">
0.3%
</td>
<td style="text-align:left;">
49%
</td>
</tr>
<tr>
<td style="text-align:left;">
4 - 2
</td>
<td style="text-align:left;">
0.0%
</td>
<td style="text-align:left;">
-0.2%
</td>
<td style="text-align:left;">
0.2%
</td>
<td style="text-align:left;">
50%
</td>
</tr>
<tr>
<td style="text-align:left;">
4 - 3
</td>
<td style="text-align:left;">
0.0%
</td>
<td style="text-align:left;">
-0.3%
</td>
<td style="text-align:left;">
0.2%
</td>
<td style="text-align:left;">
51%
</td>
</tr>
<tr>
<td style="text-align:left;">
5 - 0
</td>
<td style="text-align:left;">
0.1%
</td>
<td style="text-align:left;">
-0.2%
</td>
<td style="text-align:left;">
0.3%
</td>
<td style="text-align:left;">
76%
</td>
</tr>
<tr>
<td style="text-align:left;">
5 - 1
</td>
<td style="text-align:left;">
0.1%
</td>
<td style="text-align:left;">
-0.1%
</td>
<td style="text-align:left;">
0.3%
</td>
<td style="text-align:left;">
77%
</td>
</tr>
<tr>
<td style="text-align:left;">
5 - 2
</td>
<td style="text-align:left;">
0.1%
</td>
<td style="text-align:left;">
-0.2%
</td>
<td style="text-align:left;">
0.3%
</td>
<td style="text-align:left;">
77%
</td>
</tr>
<tr>
<td style="text-align:left;">
5 - 3
</td>
<td style="text-align:left;">
0.1%
</td>
<td style="text-align:left;">
-0.2%
</td>
<td style="text-align:left;">
0.3%
</td>
<td style="text-align:left;">
76%
</td>
</tr>
<tr>
<td style="text-align:left;">
5 - 4
</td>
<td style="text-align:left;">
0.1%
</td>
<td style="text-align:left;">
-0.2%
</td>
<td style="text-align:left;">
0.3%
</td>
<td style="text-align:left;">
76%
</td>
</tr>
</tbody>
</table>
</div>
<p>although we can be very certain that there are differences in Height quantification accuracy (&gt;99% probability across most CHM resolutions) when the <code>spectral_weight</code> is set to “5” (i.e. requiring that all spectral criteria be met) compared to the other settings of <code>spectral_weight</code> or not including spectral data for the finer resolution CHM data (e.g. &lt;0.4m), these differences are so small with nearly all of them showing a difference in Height MAPE of &lt;1%</p>
</div>
</div>
</div>
</div>
<div id="hey_balanced_acc" class="section level2 hasAnchor" number="9.4">
<h2><span class="header-section-number">9.4</span> Balanced Accuracy Bayesian Optimization<a href="stats_method.html#hey_balanced_acc" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>now we’re going to find the optimal parameter settings for our pile detection methodology by using the Bayesian models we developed for F-score (<code>brms_f_score_mod</code>) and MAPE for height (<code>brms_height_mape_mod</code>) and diameter (<code>brms_diam_mape_mod</code>). we’ll use <code>tidybayes::add_epred_draws()</code> to obtain the posterior predictions of the expected value (e.g. F-score) from each model across a common grid of parameter settings (<code>newdata</code>). the predictions from each model will be joined on the parameter settings and draw number (<code>.draw</code>). then we’ll use a customized ranking filter on each posterior draw to find the parameter combination that best balances detection and quantification accuracy. This approach allows us to weight the accuracies according to specific objectives, such as sacrificing some form quantification accuracy to gain better detection accuracy. this methodology is statistically sound because it accounts for uncertainty by using the full posterior distribution from all models throughout the optimization process. unlike methods that rely on single point estimates (like our initial sensitivity testing), this approach can handle complex, non-linear, and interactive relationships. The final output is not a single optimal solution but a <em>posterior distribution of optimal settings</em>, which quantifies the range of credible parameter values that satisfy the optimization criteria.</p>
<p>first, let’s generate the grid to see how many different parameter combinations we’re testing. note, we hold the <code>max_ht_m</code> (2.3 m) and <code>max_area_m2</code> (46 m<sup>2</sup>) parameters constant based on our expectations from the treatment prescription implemented on the ground. if we didn’t do this, we would risk over-fitting the optimization based on the training data used.</p>
<div class="sourceCode" id="cb418"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb418-1"><a href="stats_method.html#cb418-1" tabindex="-1"></a><span class="co"># grid of parameter settings for use in each tidybayes::add_epred_draws() call</span></span>
<span id="cb418-2"><a href="stats_method.html#cb418-2" tabindex="-1"></a>newdata_temp <span class="ot">&lt;-</span> tidyr<span class="sc">::</span><span class="fu">crossing</span>(</span>
<span id="cb418-3"><a href="stats_method.html#cb418-3" tabindex="-1"></a>  param_combos_spectral_ranked <span class="sc">%&gt;%</span> </span>
<span id="cb418-4"><a href="stats_method.html#cb418-4" tabindex="-1"></a>    <span class="co"># dplyr::filter(spectral_weight %in% c(&quot;0&quot;,&quot;4&quot;,&quot;5&quot;)) %&gt;% </span></span>
<span id="cb418-5"><a href="stats_method.html#cb418-5" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">distinct</span>(spectral_weight)</span>
<span id="cb418-6"><a href="stats_method.html#cb418-6" tabindex="-1"></a>  , <span class="at">circle_fit_iou_pct =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="fl">1.0</span>, <span class="at">by =</span> <span class="fl">0.02</span>)</span>
<span id="cb418-7"><a href="stats_method.html#cb418-7" tabindex="-1"></a>  , <span class="at">convexity_pct =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="fl">1.0</span>, <span class="at">by =</span> <span class="fl">0.02</span>)</span>
<span id="cb418-8"><a href="stats_method.html#cb418-8" tabindex="-1"></a>  , <span class="at">chm_res_m =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fl">0.1</span>, <span class="at">to =</span> <span class="fl">0.5</span>, <span class="at">by =</span> <span class="fl">0.05</span>)</span>
<span id="cb418-9"><a href="stats_method.html#cb418-9" tabindex="-1"></a>  , <span class="at">max_ht_m =</span> structural_params_settings<span class="sc">$</span>max_ht_m <span class="co"># seq(from = 2.1, to = 4.3, length.out = 5)</span></span>
<span id="cb418-10"><a href="stats_method.html#cb418-10" tabindex="-1"></a>  , <span class="at">max_area_m2 =</span> structural_params_settings<span class="sc">$</span>max_area_m2 <span class="co"># seq(from = 20, to = 55, length.out = 5)</span></span>
<span id="cb418-11"><a href="stats_method.html#cb418-11" tabindex="-1"></a>)</span>
<span id="cb418-12"><a href="stats_method.html#cb418-12" tabindex="-1"></a><span class="co"># huh?</span></span>
<span id="cb418-13"><a href="stats_method.html#cb418-13" tabindex="-1"></a>newdata_temp <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">glimpse</span>()</span></code></pre></div>
<pre><code>## Rows: 140,454
## Columns: 6
## $ spectral_weight    &lt;fct&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, …
## $ circle_fit_iou_pct &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, …
## $ convexity_pct      &lt;dbl&gt; 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.0…
## $ chm_res_m          &lt;dbl&gt; 0.10, 0.15, 0.20, 0.25, 0.30, 0.35, 0.40, 0.45, 0.5…
## $ max_ht_m           &lt;dbl&gt; 2.3, 2.3, 2.3, 2.3, 2.3, 2.3, 2.3, 2.3, 2.3, 2.3, 2…
## $ max_area_m2        &lt;dbl&gt; 46, 46, 46, 46, 46, 46, 46, 46, 46, 46, 46, 46, 46,…</code></pre>
<div class="sourceCode" id="cb420"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb420-1"><a href="stats_method.html#cb420-1" tabindex="-1"></a><span class="co"># nrow(newdata_temp)/nrow(param_combos_spectral_ranked)</span></span></code></pre></div>
<p>the number of records in our <code>newdata</code> is the number of different parameter combinations we’re testing for each draw. modelling allows us to test so many more possible combinations (4.0 times more here) than getting point estimates as we did with our sensitivity testing!</p>
<p>get the posterior predictions from the detection accuracy model F-score (<code>brms_f_score_mod</code>) and MAPE for height (<code>brms_height_mape_mod</code>) and diameter (<code>brms_diam_mape_mod</code>) for quantification accuracy</p>
<div class="sourceCode" id="cb421"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb421-1"><a href="stats_method.html#cb421-1" tabindex="-1"></a><span class="co"># names of variables to join the draws on </span></span>
<span id="cb421-2"><a href="stats_method.html#cb421-2" tabindex="-1"></a>join_names_temp <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">names</span>(newdata_temp), <span class="st">&quot;.draw&quot;</span>)</span>
<span id="cb421-3"><a href="stats_method.html#cb421-3" tabindex="-1"></a>ndraws_temp <span class="ot">&lt;-</span> <span class="dv">333</span></span>
<span id="cb421-4"><a href="stats_method.html#cb421-4" tabindex="-1"></a><span class="co"># draws</span></span>
<span id="cb421-5"><a href="stats_method.html#cb421-5" tabindex="-1"></a>full_draws_temp <span class="ot">&lt;-</span> </span>
<span id="cb421-6"><a href="stats_method.html#cb421-6" tabindex="-1"></a>  <span class="co"># brms_f_score_mod</span></span>
<span id="cb421-7"><a href="stats_method.html#cb421-7" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">add_epred_draws</span>(<span class="at">newdata =</span> newdata_temp, <span class="at">object =</span> brms_f_score_mod, <span class="at">ndraws =</span> ndraws_temp, <span class="at">value =</span> <span class="st">&quot;f_score&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb421-8"><a href="stats_method.html#cb421-8" tabindex="-1"></a>  <span class="co"># join brms_diam_mape_mod</span></span>
<span id="cb421-9"><a href="stats_method.html#cb421-9" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">inner_join</span>(</span>
<span id="cb421-10"><a href="stats_method.html#cb421-10" tabindex="-1"></a>    tidybayes<span class="sc">::</span><span class="fu">add_epred_draws</span>(<span class="at">newdata =</span> newdata_temp, <span class="at">object =</span> brms_diam_mape_mod, <span class="at">ndraws =</span> ndraws_temp, <span class="at">value =</span> <span class="st">&quot;diameter_mape&quot;</span>)  </span>
<span id="cb421-11"><a href="stats_method.html#cb421-11" tabindex="-1"></a>    , <span class="at">by =</span> join_names_temp</span>
<span id="cb421-12"><a href="stats_method.html#cb421-12" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb421-13"><a href="stats_method.html#cb421-13" tabindex="-1"></a>  <span class="co"># join brms_height_mape_mod</span></span>
<span id="cb421-14"><a href="stats_method.html#cb421-14" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">inner_join</span>(</span>
<span id="cb421-15"><a href="stats_method.html#cb421-15" tabindex="-1"></a>    tidybayes<span class="sc">::</span><span class="fu">add_epred_draws</span>(<span class="at">newdata =</span> newdata_temp, <span class="at">object =</span> brms_height_mape_mod, <span class="at">ndraws =</span> ndraws_temp, <span class="at">value =</span> <span class="st">&quot;height_mape&quot;</span>)  </span>
<span id="cb421-16"><a href="stats_method.html#cb421-16" tabindex="-1"></a>    , <span class="at">by =</span> join_names_temp</span>
<span id="cb421-17"><a href="stats_method.html#cb421-17" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb421-18"><a href="stats_method.html#cb421-18" tabindex="-1"></a>  <span class="co"># select</span></span>
<span id="cb421-19"><a href="stats_method.html#cb421-19" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(dplyr<span class="sc">::</span><span class="fu">all_of</span>(</span>
<span id="cb421-20"><a href="stats_method.html#cb421-20" tabindex="-1"></a>    <span class="fu">c</span>(join_names_temp, <span class="st">&quot;f_score&quot;</span>, <span class="st">&quot;diameter_mape&quot;</span>, <span class="st">&quot;height_mape&quot;</span>)</span>
<span id="cb421-21"><a href="stats_method.html#cb421-21" tabindex="-1"></a>  ))</span>
<span id="cb421-22"><a href="stats_method.html#cb421-22" tabindex="-1"></a><span class="co"># huh?</span></span>
<span id="cb421-23"><a href="stats_method.html#cb421-23" tabindex="-1"></a>full_draws_temp <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">glimpse</span>()</span></code></pre></div>
<pre><code>## Rows: 46,771,182
## Columns: 10
## Groups: spectral_weight, circle_fit_iou_pct, convexity_pct, chm_res_m, max_ht_m, max_area_m2 [140,454]
## $ spectral_weight    &lt;fct&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, …
## $ circle_fit_iou_pct &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, …
## $ convexity_pct      &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, …
## $ chm_res_m          &lt;dbl&gt; 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0…
## $ max_ht_m           &lt;dbl&gt; 2.3, 2.3, 2.3, 2.3, 2.3, 2.3, 2.3, 2.3, 2.3, 2.3, 2…
## $ max_area_m2        &lt;dbl&gt; 46, 46, 46, 46, 46, 46, 46, 46, 46, 46, 46, 46, 46,…
## $ .draw              &lt;int&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, …
## $ f_score            &lt;dbl&gt; 0.6170156, 0.5835475, 0.5902940, 0.6036380, 0.60168…
## $ diameter_mape      &lt;dbl&gt; 0.1016914, 0.1031600, 0.1029575, 0.1013529, 0.10385…
## $ height_mape        &lt;dbl&gt; 0.1809501, 0.1842020, 0.1868028, 0.1835908, 0.18351…</code></pre>
<p>the number of records should be equal to the number of records in our <code>newdata</code> multiplied by the number of draws (<code>ndraws</code>)</p>
<div class="sourceCode" id="cb423"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb423-1"><a href="stats_method.html#cb423-1" tabindex="-1"></a><span class="fu">identical</span>(</span>
<span id="cb423-2"><a href="stats_method.html#cb423-2" tabindex="-1"></a>  <span class="fu">as.numeric</span>(<span class="fu">nrow</span>(newdata_temp)<span class="sc">*</span>ndraws_temp)</span>
<span id="cb423-3"><a href="stats_method.html#cb423-3" tabindex="-1"></a>  , <span class="fu">nrow</span>(full_draws_temp) <span class="sc">%&gt;%</span> <span class="fu">as.numeric</span>()</span>
<span id="cb423-4"><a href="stats_method.html#cb423-4" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div id="balanced-accuracy-selection" class="section level3 hasAnchor" number="9.4.1">
<h3><span class="header-section-number">9.4.1</span> Balanced Accuracy Selection<a href="stats_method.html#balanced-accuracy-selection" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>now we’ll use a customized ranking filter on each posterior draw to find the parameter combination that best balances detection and quantification accuracy. This approach allows us to weight the accuracies according to specific objectives, such as sacrificing some form quantification accuracy to gain better detection accuracy</p>
<div class="sourceCode" id="cb425"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb425-1"><a href="stats_method.html#cb425-1" tabindex="-1"></a><span class="co"># weights need to add to 1</span></span>
<span id="cb425-2"><a href="stats_method.html#cb425-2" tabindex="-1"></a>weight_detection_temp <span class="ot">&lt;-</span> <span class="fl">0.7</span></span>
<span id="cb425-3"><a href="stats_method.html#cb425-3" tabindex="-1"></a>weight_quantification_temp <span class="ot">&lt;-</span> <span class="fl">0.3</span></span>
<span id="cb425-4"><a href="stats_method.html#cb425-4" tabindex="-1"></a><span class="co"># rank the draws</span></span>
<span id="cb425-5"><a href="stats_method.html#cb425-5" tabindex="-1"></a>best_balanced_accuracy_combos <span class="ot">&lt;-</span> </span>
<span id="cb425-6"><a href="stats_method.html#cb425-6" tabindex="-1"></a>  full_draws_temp <span class="sc">%&gt;%</span> </span>
<span id="cb425-7"><a href="stats_method.html#cb425-7" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(.draw) <span class="sc">%&gt;%</span> </span>
<span id="cb425-8"><a href="stats_method.html#cb425-8" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb425-9"><a href="stats_method.html#cb425-9" tabindex="-1"></a>    <span class="at">pct_rank_detection =</span> dplyr<span class="sc">::</span><span class="fu">percent_rank</span>(f_score) </span>
<span id="cb425-10"><a href="stats_method.html#cb425-10" tabindex="-1"></a>    , dplyr<span class="sc">::</span><span class="fu">across</span>(</span>
<span id="cb425-11"><a href="stats_method.html#cb425-11" tabindex="-1"></a>      <span class="at">.cols =</span> tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_mape&quot;</span>)</span>
<span id="cb425-12"><a href="stats_method.html#cb425-12" tabindex="-1"></a>      , <span class="at">.fn =</span> <span class="sc">~</span>dplyr<span class="sc">::</span><span class="fu">percent_rank</span>(<span class="sc">-</span>.x) <span class="co"># -mape so largest gets highest pct rank</span></span>
<span id="cb425-13"><a href="stats_method.html#cb425-13" tabindex="-1"></a>      , <span class="at">.names =</span> <span class="st">&quot;{.col}_pct_rank&quot;</span></span>
<span id="cb425-14"><a href="stats_method.html#cb425-14" tabindex="-1"></a>    )</span>
<span id="cb425-15"><a href="stats_method.html#cb425-15" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb425-16"><a href="stats_method.html#cb425-16" tabindex="-1"></a>  <span class="co"># average of mapes to get quantification mape average</span></span>
<span id="cb425-17"><a href="stats_method.html#cb425-17" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb425-18"><a href="stats_method.html#cb425-18" tabindex="-1"></a>    <span class="at">pct_rank_quantification =</span> (height_mape_pct_rank<span class="sc">+</span>diameter_mape_pct_rank)<span class="sc">/</span><span class="dv">2</span></span>
<span id="cb425-19"><a href="stats_method.html#cb425-19" tabindex="-1"></a>    <span class="co"># apply weights to get balanced_accuracy (0-1) with 1 being best</span></span>
<span id="cb425-20"><a href="stats_method.html#cb425-20" tabindex="-1"></a>    , <span class="at">balanced_accuracy =</span> (weight_detection_temp<span class="sc">*</span>pct_rank_detection) <span class="sc">+</span> (weight_quantification_temp<span class="sc">*</span>pct_rank_quantification)</span>
<span id="cb425-21"><a href="stats_method.html#cb425-21" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb425-22"><a href="stats_method.html#cb425-22" tabindex="-1"></a>  <span class="co"># dplyr::filter(.draw==1) %&gt;% dplyr::arrange(desc(balanced_accuracy)) %&gt;% View()</span></span>
<span id="cb425-23"><a href="stats_method.html#cb425-23" tabindex="-1"></a>  <span class="co"># for each draw, find the setting that maximizes balanced_accuracy</span></span>
<span id="cb425-24"><a href="stats_method.html#cb425-24" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(.draw) <span class="sc">%&gt;%</span></span>
<span id="cb425-25"><a href="stats_method.html#cb425-25" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">slice_max</span>(<span class="at">order_by =</span> balanced_accuracy, <span class="at">n =</span> <span class="dv">1</span>, <span class="at">with_ties =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb425-26"><a href="stats_method.html#cb425-26" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb425-27"><a href="stats_method.html#cb425-27" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>tidyselect<span class="sc">::</span><span class="fu">starts_with</span>(<span class="st">&quot;pct_rank_&quot;</span>), <span class="sc">-</span>tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_pct_rank&quot;</span>), <span class="sc">-</span>balanced_accuracy)</span>
<span id="cb425-28"><a href="stats_method.html#cb425-28" tabindex="-1"></a><span class="co"># add on the structural only data</span></span>
<span id="cb425-29"><a href="stats_method.html#cb425-29" tabindex="-1"></a>best_balanced_accuracy_combos <span class="ot">&lt;-</span> </span>
<span id="cb425-30"><a href="stats_method.html#cb425-30" tabindex="-1"></a>  full_draws_temp <span class="sc">%&gt;%</span> </span>
<span id="cb425-31"><a href="stats_method.html#cb425-31" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(spectral_weight<span class="sc">==</span><span class="st">&quot;0&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb425-32"><a href="stats_method.html#cb425-32" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(.draw) <span class="sc">%&gt;%</span> </span>
<span id="cb425-33"><a href="stats_method.html#cb425-33" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb425-34"><a href="stats_method.html#cb425-34" tabindex="-1"></a>    <span class="at">pct_rank_detection =</span> dplyr<span class="sc">::</span><span class="fu">percent_rank</span>(f_score) </span>
<span id="cb425-35"><a href="stats_method.html#cb425-35" tabindex="-1"></a>    , dplyr<span class="sc">::</span><span class="fu">across</span>(</span>
<span id="cb425-36"><a href="stats_method.html#cb425-36" tabindex="-1"></a>      <span class="at">.cols =</span> tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_mape&quot;</span>)</span>
<span id="cb425-37"><a href="stats_method.html#cb425-37" tabindex="-1"></a>      , <span class="at">.fn =</span> <span class="sc">~</span>dplyr<span class="sc">::</span><span class="fu">percent_rank</span>(<span class="sc">-</span>.x) <span class="co"># -mape so largest gets highest pct rank</span></span>
<span id="cb425-38"><a href="stats_method.html#cb425-38" tabindex="-1"></a>      , <span class="at">.names =</span> <span class="st">&quot;{.col}_pct_rank&quot;</span></span>
<span id="cb425-39"><a href="stats_method.html#cb425-39" tabindex="-1"></a>    )</span>
<span id="cb425-40"><a href="stats_method.html#cb425-40" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb425-41"><a href="stats_method.html#cb425-41" tabindex="-1"></a>  <span class="co"># average of mapes to get quantification mape average</span></span>
<span id="cb425-42"><a href="stats_method.html#cb425-42" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb425-43"><a href="stats_method.html#cb425-43" tabindex="-1"></a>    <span class="at">pct_rank_quantification =</span> (height_mape_pct_rank<span class="sc">+</span>diameter_mape_pct_rank)<span class="sc">/</span><span class="dv">2</span></span>
<span id="cb425-44"><a href="stats_method.html#cb425-44" tabindex="-1"></a>    <span class="co"># apply weights to get balanced_accuracy (0-1) with 1 being best</span></span>
<span id="cb425-45"><a href="stats_method.html#cb425-45" tabindex="-1"></a>    , <span class="at">balanced_accuracy =</span> (weight_detection_temp<span class="sc">*</span>pct_rank_detection) <span class="sc">+</span> (weight_quantification_temp<span class="sc">*</span>pct_rank_quantification)</span>
<span id="cb425-46"><a href="stats_method.html#cb425-46" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb425-47"><a href="stats_method.html#cb425-47" tabindex="-1"></a>  <span class="co"># dplyr::filter(.draw==1) %&gt;% dplyr::arrange(desc(balanced_accuracy)) %&gt;% View()</span></span>
<span id="cb425-48"><a href="stats_method.html#cb425-48" tabindex="-1"></a>  <span class="co"># for each draw, find the setting that maximizes balanced_accuracy</span></span>
<span id="cb425-49"><a href="stats_method.html#cb425-49" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(.draw) <span class="sc">%&gt;%</span></span>
<span id="cb425-50"><a href="stats_method.html#cb425-50" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">slice_max</span>(<span class="at">order_by =</span> balanced_accuracy, <span class="at">n =</span> <span class="dv">1</span>, <span class="at">with_ties =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb425-51"><a href="stats_method.html#cb425-51" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb425-52"><a href="stats_method.html#cb425-52" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>tidyselect<span class="sc">::</span><span class="fu">starts_with</span>(<span class="st">&quot;pct_rank_&quot;</span>), <span class="sc">-</span>tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_pct_rank&quot;</span>), <span class="sc">-</span>balanced_accuracy) <span class="sc">%&gt;%</span> </span>
<span id="cb425-53"><a href="stats_method.html#cb425-53" tabindex="-1"></a>  <span class="co"># add on data fusion combos</span></span>
<span id="cb425-54"><a href="stats_method.html#cb425-54" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">method_input_data =</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb425-55"><a href="stats_method.html#cb425-55" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(</span>
<span id="cb425-56"><a href="stats_method.html#cb425-56" tabindex="-1"></a>    best_balanced_accuracy_combos <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">method_input_data =</span> <span class="dv">1</span>)</span>
<span id="cb425-57"><a href="stats_method.html#cb425-57" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb425-58"><a href="stats_method.html#cb425-58" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb425-59"><a href="stats_method.html#cb425-59" tabindex="-1"></a>    <span class="at">method_input_data =</span> <span class="fu">factor</span>(method_input_data, <span class="at">levels =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;structural only&quot;</span>, <span class="st">&quot;structural+spectral&quot;</span>), <span class="at">ordered =</span> T)</span>
<span id="cb425-60"><a href="stats_method.html#cb425-60" tabindex="-1"></a>  )</span>
<span id="cb425-61"><a href="stats_method.html#cb425-61" tabindex="-1"></a></span>
<span id="cb425-62"><a href="stats_method.html#cb425-62" tabindex="-1"></a><span class="co"># huh?  </span></span>
<span id="cb425-63"><a href="stats_method.html#cb425-63" tabindex="-1"></a>best_balanced_accuracy_combos <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">glimpse</span>()</span></code></pre></div>
<pre><code>## Rows: 666
## Columns: 11
## $ spectral_weight    &lt;fct&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, …
## $ circle_fit_iou_pct &lt;dbl&gt; 0.44, 0.44, 0.44, 0.44, 0.44, 0.44, 0.44, 0.44, 0.4…
## $ convexity_pct      &lt;dbl&gt; 0.08, 0.10, 0.08, 0.10, 0.06, 0.08, 0.08, 0.10, 0.0…
## $ chm_res_m          &lt;dbl&gt; 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0…
## $ max_ht_m           &lt;dbl&gt; 2.3, 2.3, 2.3, 2.3, 2.3, 2.3, 2.3, 2.3, 2.3, 2.3, 2…
## $ max_area_m2        &lt;dbl&gt; 46, 46, 46, 46, 46, 46, 46, 46, 46, 46, 46, 46, 46,…
## $ .draw              &lt;int&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, …
## $ f_score            &lt;dbl&gt; 0.8069613, 0.7946836, 0.8002498, 0.7988866, 0.79587…
## $ diameter_mape      &lt;dbl&gt; 0.1089178, 0.1095609, 0.1086618, 0.1091353, 0.10854…
## $ height_mape        &lt;dbl&gt; 0.1545983, 0.1555827, 0.1558584, 0.1555255, 0.15532…
## $ method_input_data  &lt;ord&gt; structural only, structural only, structural only, …</code></pre>
<div class="sourceCode" id="cb427"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb427-1"><a href="stats_method.html#cb427-1" tabindex="-1"></a><span class="co"># best_balanced_accuracy_combos %&gt;% dplyr::select(max_area_m2) %&gt;% summary()</span></span></code></pre></div>
<p>the number of records 333 corresponds to the number of draws we got from the posterior predictive distribution, each one selected as the parameter combination that best balanced detection and quantification accuracy from the 140,454 tested for the data fusion approach</p>
<p>this output is not a single optimal solution but a <em>posterior distribution of optimal settings</em>, which quantifies the range of credible parameter values that satisfy the optimization criteria.</p>
<p>we’ll have data for both the structural only method and the data fusion method (i.e. “structural+spectral”)</p>
<div class="sourceCode" id="cb428"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb428-1"><a href="stats_method.html#cb428-1" tabindex="-1"></a>best_balanced_accuracy_combos <span class="sc">%&gt;%</span> </span>
<span id="cb428-2"><a href="stats_method.html#cb428-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">count</span>(method_input_data)</span></code></pre></div>
<pre><code>## # A tibble: 2 × 2
##   method_input_data       n
##   &lt;ord&gt;               &lt;int&gt;
## 1 structural only       333
## 2 structural+spectral   333</code></pre>
<p>we also tested different parameter combinations in the absence of spectral data (i.e. <code>spectral_weight</code> = 0) so that we get optimal settings for cases when we only have structural data to attempt to detect piles from</p>
<p>the number of parameter combinations tested per draw with structural data only is equivalent to the number of combinations tested per draw for the data fusion approach divided by six (for <code>spectral_weight</code> setting “1”-“5” and without spectral data “0”):</p>
<div class="sourceCode" id="cb430"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb430-1"><a href="stats_method.html#cb430-1" tabindex="-1"></a>full_draws_temp <span class="sc">%&gt;%</span> </span>
<span id="cb430-2"><a href="stats_method.html#cb430-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(spectral_weight<span class="sc">==</span><span class="st">&quot;0&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb430-3"><a href="stats_method.html#cb430-3" tabindex="-1"></a>  <span class="fu">nrow</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb430-4"><a href="stats_method.html#cb430-4" tabindex="-1"></a>  <span class="st">`</span><span class="at">/</span><span class="st">`</span>(ndraws_temp) <span class="sc">%&gt;%</span> </span>
<span id="cb430-5"><a href="stats_method.html#cb430-5" tabindex="-1"></a>  scales<span class="sc">::</span><span class="fu">comma</span>(<span class="at">accuracy=</span><span class="dv">1</span>)</span></code></pre></div>
<pre><code>## [1] &quot;23,409&quot;</code></pre>
<p>pivot to long</p>
<div class="sourceCode" id="cb432"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb432-1"><a href="stats_method.html#cb432-1" tabindex="-1"></a><span class="co"># pivot to long</span></span>
<span id="cb432-2"><a href="stats_method.html#cb432-2" tabindex="-1"></a>best_balanced_accuracy_combos_long <span class="ot">&lt;-</span> </span>
<span id="cb432-3"><a href="stats_method.html#cb432-3" tabindex="-1"></a>  best_balanced_accuracy_combos <span class="sc">%&gt;%</span> </span>
<span id="cb432-4"><a href="stats_method.html#cb432-4" tabindex="-1"></a>  <span class="co"># get rid of vars we fixed</span></span>
<span id="cb432-5"><a href="stats_method.html#cb432-5" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(max_ht_m, max_area_m2)) <span class="sc">%&gt;%</span> </span>
<span id="cb432-6"><a href="stats_method.html#cb432-6" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb432-7"><a href="stats_method.html#cb432-7" tabindex="-1"></a>    <span class="at">spectral_weight =</span> spectral_weight <span class="sc">%&gt;%</span> <span class="fu">as.character</span>() <span class="sc">%&gt;%</span> <span class="fu">as.numeric</span>()</span>
<span id="cb432-8"><a href="stats_method.html#cb432-8" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb432-9"><a href="stats_method.html#cb432-9" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span><span class="fu">c</span>(.draw,method_input_data))</span></code></pre></div>
<p>let’s get the same data but by different CHM resolution levels tested to represent the optimal setting if CHM resolution is fixed and cannot be selected</p>
<div class="sourceCode" id="cb433"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb433-1"><a href="stats_method.html#cb433-1" tabindex="-1"></a><span class="co"># let&#39;s get the same data but by different CHM resolution levels tested to represent the optimal setting if CHM resolution is fixed and cannot be selected</span></span>
<span id="cb433-2"><a href="stats_method.html#cb433-2" tabindex="-1"></a><span class="co"># rank the draws</span></span>
<span id="cb433-3"><a href="stats_method.html#cb433-3" tabindex="-1"></a>best_balanced_accuracy_combos_chm <span class="ot">&lt;-</span> </span>
<span id="cb433-4"><a href="stats_method.html#cb433-4" tabindex="-1"></a>  full_draws_temp <span class="sc">%&gt;%</span> </span>
<span id="cb433-5"><a href="stats_method.html#cb433-5" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(.draw, chm_res_m) <span class="sc">%&gt;%</span> </span>
<span id="cb433-6"><a href="stats_method.html#cb433-6" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb433-7"><a href="stats_method.html#cb433-7" tabindex="-1"></a>    <span class="at">pct_rank_detection =</span> dplyr<span class="sc">::</span><span class="fu">percent_rank</span>(f_score) </span>
<span id="cb433-8"><a href="stats_method.html#cb433-8" tabindex="-1"></a>    , dplyr<span class="sc">::</span><span class="fu">across</span>(</span>
<span id="cb433-9"><a href="stats_method.html#cb433-9" tabindex="-1"></a>      <span class="at">.cols =</span> tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_mape&quot;</span>)</span>
<span id="cb433-10"><a href="stats_method.html#cb433-10" tabindex="-1"></a>      , <span class="at">.fn =</span> <span class="sc">~</span>dplyr<span class="sc">::</span><span class="fu">percent_rank</span>(<span class="sc">-</span>.x) <span class="co"># -mape so largest gets highest pct rank</span></span>
<span id="cb433-11"><a href="stats_method.html#cb433-11" tabindex="-1"></a>      , <span class="at">.names =</span> <span class="st">&quot;{.col}_pct_rank&quot;</span></span>
<span id="cb433-12"><a href="stats_method.html#cb433-12" tabindex="-1"></a>    )</span>
<span id="cb433-13"><a href="stats_method.html#cb433-13" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb433-14"><a href="stats_method.html#cb433-14" tabindex="-1"></a>  <span class="co"># average of mapes to get quantification mape average</span></span>
<span id="cb433-15"><a href="stats_method.html#cb433-15" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb433-16"><a href="stats_method.html#cb433-16" tabindex="-1"></a>    <span class="at">pct_rank_quantification =</span> (height_mape_pct_rank<span class="sc">+</span>diameter_mape_pct_rank)<span class="sc">/</span><span class="dv">2</span></span>
<span id="cb433-17"><a href="stats_method.html#cb433-17" tabindex="-1"></a>    <span class="co"># apply weights to get balanced_accuracy (0-1) with 1 being best</span></span>
<span id="cb433-18"><a href="stats_method.html#cb433-18" tabindex="-1"></a>    , <span class="at">balanced_accuracy =</span> (weight_detection_temp<span class="sc">*</span>pct_rank_detection) <span class="sc">+</span> (weight_quantification_temp<span class="sc">*</span>pct_rank_quantification)</span>
<span id="cb433-19"><a href="stats_method.html#cb433-19" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb433-20"><a href="stats_method.html#cb433-20" tabindex="-1"></a>  <span class="co"># dplyr::filter(.draw==1) %&gt;% dplyr::arrange(desc(balanced_accuracy)) %&gt;% View()</span></span>
<span id="cb433-21"><a href="stats_method.html#cb433-21" tabindex="-1"></a>  <span class="co"># for each draw, find the setting that maximizes balanced_accuracy</span></span>
<span id="cb433-22"><a href="stats_method.html#cb433-22" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(.draw, chm_res_m) <span class="sc">%&gt;%</span></span>
<span id="cb433-23"><a href="stats_method.html#cb433-23" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">slice_max</span>(<span class="at">order_by =</span> balanced_accuracy, <span class="at">n =</span> <span class="dv">1</span>, <span class="at">with_ties =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb433-24"><a href="stats_method.html#cb433-24" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb433-25"><a href="stats_method.html#cb433-25" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>tidyselect<span class="sc">::</span><span class="fu">starts_with</span>(<span class="st">&quot;pct_rank_&quot;</span>), <span class="sc">-</span>tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_pct_rank&quot;</span>), <span class="sc">-</span>balanced_accuracy)</span>
<span id="cb433-26"><a href="stats_method.html#cb433-26" tabindex="-1"></a><span class="co"># add on the structural only data</span></span>
<span id="cb433-27"><a href="stats_method.html#cb433-27" tabindex="-1"></a>best_balanced_accuracy_combos_chm <span class="ot">&lt;-</span> </span>
<span id="cb433-28"><a href="stats_method.html#cb433-28" tabindex="-1"></a>  full_draws_temp <span class="sc">%&gt;%</span> </span>
<span id="cb433-29"><a href="stats_method.html#cb433-29" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(spectral_weight<span class="sc">==</span><span class="st">&quot;0&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb433-30"><a href="stats_method.html#cb433-30" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(.draw, chm_res_m) <span class="sc">%&gt;%</span> </span>
<span id="cb433-31"><a href="stats_method.html#cb433-31" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb433-32"><a href="stats_method.html#cb433-32" tabindex="-1"></a>    <span class="at">pct_rank_detection =</span> dplyr<span class="sc">::</span><span class="fu">percent_rank</span>(f_score) </span>
<span id="cb433-33"><a href="stats_method.html#cb433-33" tabindex="-1"></a>    , dplyr<span class="sc">::</span><span class="fu">across</span>(</span>
<span id="cb433-34"><a href="stats_method.html#cb433-34" tabindex="-1"></a>      <span class="at">.cols =</span> tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_mape&quot;</span>)</span>
<span id="cb433-35"><a href="stats_method.html#cb433-35" tabindex="-1"></a>      , <span class="at">.fn =</span> <span class="sc">~</span>dplyr<span class="sc">::</span><span class="fu">percent_rank</span>(<span class="sc">-</span>.x) <span class="co"># -mape so largest gets highest pct rank</span></span>
<span id="cb433-36"><a href="stats_method.html#cb433-36" tabindex="-1"></a>      , <span class="at">.names =</span> <span class="st">&quot;{.col}_pct_rank&quot;</span></span>
<span id="cb433-37"><a href="stats_method.html#cb433-37" tabindex="-1"></a>    )</span>
<span id="cb433-38"><a href="stats_method.html#cb433-38" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb433-39"><a href="stats_method.html#cb433-39" tabindex="-1"></a>  <span class="co"># average of mapes to get quantification mape average</span></span>
<span id="cb433-40"><a href="stats_method.html#cb433-40" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb433-41"><a href="stats_method.html#cb433-41" tabindex="-1"></a>    <span class="at">pct_rank_quantification =</span> (height_mape_pct_rank<span class="sc">+</span>diameter_mape_pct_rank)<span class="sc">/</span><span class="dv">2</span></span>
<span id="cb433-42"><a href="stats_method.html#cb433-42" tabindex="-1"></a>    <span class="co"># apply weights to get balanced_accuracy (0-1) with 1 being best</span></span>
<span id="cb433-43"><a href="stats_method.html#cb433-43" tabindex="-1"></a>    , <span class="at">balanced_accuracy =</span> (weight_detection_temp<span class="sc">*</span>pct_rank_detection) <span class="sc">+</span> (weight_quantification_temp<span class="sc">*</span>pct_rank_quantification)</span>
<span id="cb433-44"><a href="stats_method.html#cb433-44" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb433-45"><a href="stats_method.html#cb433-45" tabindex="-1"></a>  <span class="co"># dplyr::filter(.draw==1) %&gt;% dplyr::arrange(desc(balanced_accuracy)) %&gt;% View()</span></span>
<span id="cb433-46"><a href="stats_method.html#cb433-46" tabindex="-1"></a>  <span class="co"># for each draw, find the setting that maximizes balanced_accuracy</span></span>
<span id="cb433-47"><a href="stats_method.html#cb433-47" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(.draw, chm_res_m) <span class="sc">%&gt;%</span></span>
<span id="cb433-48"><a href="stats_method.html#cb433-48" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">slice_max</span>(<span class="at">order_by =</span> balanced_accuracy, <span class="at">n =</span> <span class="dv">1</span>, <span class="at">with_ties =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb433-49"><a href="stats_method.html#cb433-49" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb433-50"><a href="stats_method.html#cb433-50" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>tidyselect<span class="sc">::</span><span class="fu">starts_with</span>(<span class="st">&quot;pct_rank_&quot;</span>), <span class="sc">-</span>tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_pct_rank&quot;</span>), <span class="sc">-</span>balanced_accuracy) <span class="sc">%&gt;%</span> </span>
<span id="cb433-51"><a href="stats_method.html#cb433-51" tabindex="-1"></a>  <span class="co"># add on data fusion combos</span></span>
<span id="cb433-52"><a href="stats_method.html#cb433-52" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">method_input_data =</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb433-53"><a href="stats_method.html#cb433-53" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(</span>
<span id="cb433-54"><a href="stats_method.html#cb433-54" tabindex="-1"></a>    best_balanced_accuracy_combos_chm <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">method_input_data =</span> <span class="dv">1</span>)</span>
<span id="cb433-55"><a href="stats_method.html#cb433-55" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb433-56"><a href="stats_method.html#cb433-56" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb433-57"><a href="stats_method.html#cb433-57" tabindex="-1"></a>    <span class="at">method_input_data =</span> <span class="fu">factor</span>(method_input_data, <span class="at">levels =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;structural only&quot;</span>, <span class="st">&quot;structural+spectral&quot;</span>), <span class="at">ordered =</span> T)</span>
<span id="cb433-58"><a href="stats_method.html#cb433-58" tabindex="-1"></a>  )</span>
<span id="cb433-59"><a href="stats_method.html#cb433-59" tabindex="-1"></a><span class="co"># huh?  </span></span>
<span id="cb433-60"><a href="stats_method.html#cb433-60" tabindex="-1"></a>best_balanced_accuracy_combos_chm <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">glimpse</span>()</span></code></pre></div>
<pre><code>## Rows: 5,994
## Columns: 11
## $ spectral_weight    &lt;fct&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, …
## $ circle_fit_iou_pct &lt;dbl&gt; 0.36, 0.40, 0.40, 0.40, 0.36, 0.34, 0.34, 0.34, 0.3…
## $ convexity_pct      &lt;dbl&gt; 0.16, 0.18, 0.22, 0.30, 0.36, 0.44, 0.48, 0.54, 0.5…
## $ chm_res_m          &lt;dbl&gt; 0.10, 0.15, 0.20, 0.25, 0.30, 0.35, 0.40, 0.45, 0.5…
## $ max_ht_m           &lt;dbl&gt; 2.3, 2.3, 2.3, 2.3, 2.3, 2.3, 2.3, 2.3, 2.3, 2.3, 2…
## $ max_area_m2        &lt;dbl&gt; 46, 46, 46, 46, 46, 46, 46, 46, 46, 46, 46, 46, 46,…
## $ .draw              &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, …
## $ f_score            &lt;dbl&gt; 0.8348130, 0.7974862, 0.7661282, 0.7378913, 0.71128…
## $ diameter_mape      &lt;dbl&gt; 0.1098208, 0.1422830, 0.1800632, 0.2222840, 0.26884…
## $ height_mape        &lt;dbl&gt; 0.1602975, 0.1554388, 0.1550191, 0.1568298, 0.15998…
## $ method_input_data  &lt;ord&gt; structural only, structural only, structural only, …</code></pre>
<div class="sourceCode" id="cb435"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb435-1"><a href="stats_method.html#cb435-1" tabindex="-1"></a><span class="co"># best_balanced_accuracy_combos_chm %&gt;% </span></span>
<span id="cb435-2"><a href="stats_method.html#cb435-2" tabindex="-1"></a><span class="co">#   dplyr::ungroup() %&gt;% </span></span>
<span id="cb435-3"><a href="stats_method.html#cb435-3" tabindex="-1"></a><span class="co">#   dplyr::count(chm_res_m,method_input_data)</span></span></code></pre></div>
</div>
<div id="overall-across-chm-resolution-2" class="section level3 hasAnchor" number="9.4.2">
<h3><span class="header-section-number">9.4.2</span> Overall (across CHM resolution)<a href="stats_method.html#overall-across-chm-resolution-2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>these recommendations are for users who can generate a CHM from the original point cloud (e.g. using <code>cloud2trees::cloud2raster()</code>). This is a critical distinction because creating a new CHM at the desired resolution is a fundamentally different process than simply disaggregating an existing, coarser raster.</p>
<div id="posterior-distribution-of-optimal-settings" class="section level4 hasAnchor" number="9.4.2.1">
<h4><span class="header-section-number">9.4.2.1</span> Posterior distribution of optimal settings<a href="stats_method.html#posterior-distribution-of-optimal-settings" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>let’s check out the posterior distribution of optimal settings for each parameter. remember, it is these parameter settings <em>combined</em> that are expected to yield the best balance between detection and quantification accuracy based on our weighting</p>
<p>note, we distinguish the optimal settings based on the availability of spectral data which determines whether or not we can use a data fusion (i.e. “structural+spectral”) approach</p>
<div class="sourceCode" id="cb436"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb436-1"><a href="stats_method.html#cb436-1" tabindex="-1"></a><span class="co"># plot it</span></span>
<span id="cb436-2"><a href="stats_method.html#cb436-2" tabindex="-1"></a>best_balanced_accuracy_combos_long <span class="sc">%&gt;%</span> </span>
<span id="cb436-3"><a href="stats_method.html#cb436-3" tabindex="-1"></a>  <span class="co"># filter out accuracy metrics</span></span>
<span id="cb436-4"><a href="stats_method.html#cb436-4" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(name<span class="sc">!=</span><span class="st">&quot;f_score&quot;</span>, <span class="sc">!</span>stringr<span class="sc">::</span><span class="fu">str_ends</span>(name, <span class="st">&quot;_mape&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb436-5"><a href="stats_method.html#cb436-5" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> value)) <span class="sc">+</span></span>
<span id="cb436-6"><a href="stats_method.html#cb436-6" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">stat_dotsinterval</span>(</span>
<span id="cb436-7"><a href="stats_method.html#cb436-7" tabindex="-1"></a>    <span class="at">point_interval =</span> <span class="st">&quot;median_hdci&quot;</span>, <span class="at">.width =</span> <span class="fu">c</span>(<span class="fl">0.95</span>)</span>
<span id="cb436-8"><a href="stats_method.html#cb436-8" tabindex="-1"></a>    , <span class="at">quantiles =</span> <span class="dv">100</span></span>
<span id="cb436-9"><a href="stats_method.html#cb436-9" tabindex="-1"></a>    , <span class="at">point_size =</span> <span class="dv">3</span> </span>
<span id="cb436-10"><a href="stats_method.html#cb436-10" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb436-11"><a href="stats_method.html#cb436-11" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">facet_grid</span>(</span>
<span id="cb436-12"><a href="stats_method.html#cb436-12" tabindex="-1"></a>    <span class="at">rows =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(method_input_data)</span>
<span id="cb436-13"><a href="stats_method.html#cb436-13" tabindex="-1"></a>    , <span class="at">cols =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(name)</span>
<span id="cb436-14"><a href="stats_method.html#cb436-14" tabindex="-1"></a>    , <span class="at">scales =</span> <span class="st">&quot;free_x&quot;</span></span>
<span id="cb436-15"><a href="stats_method.html#cb436-15" tabindex="-1"></a>    , <span class="at">axes =</span> <span class="st">&quot;all_x&quot;</span></span>
<span id="cb436-16"><a href="stats_method.html#cb436-16" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb436-17"><a href="stats_method.html#cb436-17" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb436-18"><a href="stats_method.html#cb436-18" tabindex="-1"></a>  <span class="co"># ggplot2::scale_x_continuous(expand = ggplot2::expansion(mult = 1.2)) +</span></span>
<span id="cb436-19"><a href="stats_method.html#cb436-19" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb436-20"><a href="stats_method.html#cb436-20" tabindex="-1"></a>    <span class="at">x=</span><span class="st">&quot;&quot;</span></span>
<span id="cb436-21"><a href="stats_method.html#cb436-21" tabindex="-1"></a>    , <span class="at">subtitle =</span> <span class="fu">paste0</span>(</span>
<span id="cb436-22"><a href="stats_method.html#cb436-22" tabindex="-1"></a>     <span class="st">&quot;predicted optimal parameter settings based on both detection and quantification accuracy&quot;</span></span>
<span id="cb436-23"><a href="stats_method.html#cb436-23" tabindex="-1"></a>    )</span>
<span id="cb436-24"><a href="stats_method.html#cb436-24" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb436-25"><a href="stats_method.html#cb436-25" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb436-26"><a href="stats_method.html#cb436-26" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb436-27"><a href="stats_method.html#cb436-27" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb436-28"><a href="stats_method.html#cb436-28" tabindex="-1"></a>    , <span class="at">strip.text.x =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">9</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb436-29"><a href="stats_method.html#cb436-29" tabindex="-1"></a>    , <span class="at">strip.text.y =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb436-30"><a href="stats_method.html#cb436-30" tabindex="-1"></a>    , <span class="at">axis.text.x =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>, <span class="at">angle =</span> <span class="dv">90</span>)</span>
<span id="cb436-31"><a href="stats_method.html#cb436-31" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-414-1.png" width="1008" /></p>
<p>let’s table the HDI of the optimal values</p>
<div class="sourceCode" id="cb437"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb437-1"><a href="stats_method.html#cb437-1" tabindex="-1"></a><span class="co"># let&#39;s save these optimal settings for later use</span></span>
<span id="cb437-2"><a href="stats_method.html#cb437-2" tabindex="-1"></a><span class="co"># summarize it</span></span>
<span id="cb437-3"><a href="stats_method.html#cb437-3" tabindex="-1"></a>optimal_param_settings <span class="ot">&lt;-</span> best_balanced_accuracy_combos_long <span class="sc">%&gt;%</span> </span>
<span id="cb437-4"><a href="stats_method.html#cb437-4" tabindex="-1"></a>  <span class="co"># filter out accuracy metrics</span></span>
<span id="cb437-5"><a href="stats_method.html#cb437-5" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(name<span class="sc">!=</span><span class="st">&quot;f_score&quot;</span>, <span class="sc">!</span>stringr<span class="sc">::</span><span class="fu">str_ends</span>(name, <span class="st">&quot;_mape&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb437-6"><a href="stats_method.html#cb437-6" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(method_input_data,name) <span class="sc">%&gt;%</span> </span>
<span id="cb437-7"><a href="stats_method.html#cb437-7" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(</span>
<span id="cb437-8"><a href="stats_method.html#cb437-8" tabindex="-1"></a>    <span class="co"># get median_hdi</span></span>
<span id="cb437-9"><a href="stats_method.html#cb437-9" tabindex="-1"></a>    <span class="at">median_hdi_est =</span> tidybayes<span class="sc">::</span><span class="fu">median_hdci</span>(value)<span class="sc">$</span>y</span>
<span id="cb437-10"><a href="stats_method.html#cb437-10" tabindex="-1"></a>    , <span class="at">median_hdi_lower =</span> tidybayes<span class="sc">::</span><span class="fu">median_hdci</span>(value)<span class="sc">$</span>ymin</span>
<span id="cb437-11"><a href="stats_method.html#cb437-11" tabindex="-1"></a>    , <span class="at">median_hdi_upper =</span> tidybayes<span class="sc">::</span><span class="fu">median_hdci</span>(value)<span class="sc">$</span>ymax</span>
<span id="cb437-12"><a href="stats_method.html#cb437-12" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb437-13"><a href="stats_method.html#cb437-13" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>()</span>
<span id="cb437-14"><a href="stats_method.html#cb437-14" tabindex="-1"></a><span class="co"># table it</span></span>
<span id="cb437-15"><a href="stats_method.html#cb437-15" tabindex="-1"></a>optimal_param_settings <span class="sc">%&gt;%</span> </span>
<span id="cb437-16"><a href="stats_method.html#cb437-16" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(dplyr<span class="sc">::</span><span class="fu">across</span>(</span>
<span id="cb437-17"><a href="stats_method.html#cb437-17" tabindex="-1"></a>    tidyselect<span class="sc">::</span><span class="fu">starts_with</span>(<span class="st">&quot;median_hdi&quot;</span>)</span>
<span id="cb437-18"><a href="stats_method.html#cb437-18" tabindex="-1"></a>    , <span class="sc">~</span>dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb437-19"><a href="stats_method.html#cb437-19" tabindex="-1"></a>      name <span class="sc">==</span> <span class="st">&quot;spectral_weight&quot;</span> <span class="sc">~</span> scales<span class="sc">::</span><span class="fu">comma</span>(.x,<span class="at">accuracy=</span><span class="dv">1</span>)</span>
<span id="cb437-20"><a href="stats_method.html#cb437-20" tabindex="-1"></a>      , T <span class="sc">~</span>scales<span class="sc">::</span><span class="fu">comma</span>(.x,<span class="at">accuracy=</span>.<span class="dv">01</span>)</span>
<span id="cb437-21"><a href="stats_method.html#cb437-21" tabindex="-1"></a>    )</span>
<span id="cb437-22"><a href="stats_method.html#cb437-22" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb437-23"><a href="stats_method.html#cb437-23" tabindex="-1"></a>  <span class="co"># table it</span></span>
<span id="cb437-24"><a href="stats_method.html#cb437-24" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kbl</span>(</span>
<span id="cb437-25"><a href="stats_method.html#cb437-25" tabindex="-1"></a>    <span class="at">caption =</span> <span class="fu">paste0</span>(</span>
<span id="cb437-26"><a href="stats_method.html#cb437-26" tabindex="-1"></a>     <span class="st">&quot;predicted optimal parameter settings based on both detection and quantification accuracy&quot;</span></span>
<span id="cb437-27"><a href="stats_method.html#cb437-27" tabindex="-1"></a>    )</span>
<span id="cb437-28"><a href="stats_method.html#cb437-28" tabindex="-1"></a>    , <span class="at">col.names =</span> <span class="fu">c</span>(</span>
<span id="cb437-29"><a href="stats_method.html#cb437-29" tabindex="-1"></a>      <span class="st">&quot;.&quot;</span>, <span class="st">&quot;parameter&quot;</span></span>
<span id="cb437-30"><a href="stats_method.html#cb437-30" tabindex="-1"></a>      , <span class="fu">c</span>(<span class="st">&quot;median&quot;</span>, <span class="st">&quot;HDI low&quot;</span>, <span class="st">&quot;HDI high&quot;</span>)</span>
<span id="cb437-31"><a href="stats_method.html#cb437-31" tabindex="-1"></a>    )</span>
<span id="cb437-32"><a href="stats_method.html#cb437-32" tabindex="-1"></a>    , <span class="at">escape =</span> F</span>
<span id="cb437-33"><a href="stats_method.html#cb437-33" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb437-34"><a href="stats_method.html#cb437-34" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kable_styling</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb437-35"><a href="stats_method.html#cb437-35" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">collapse_rows</span>(<span class="at">columns =</span> <span class="dv">1</span>, <span class="at">valign =</span> <span class="st">&quot;top&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb437-36"><a href="stats_method.html#cb437-36" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">add_header_above</span>(<span class="fu">c</span>(</span>
<span id="cb437-37"><a href="stats_method.html#cb437-37" tabindex="-1"></a>    <span class="st">&quot; &quot;</span><span class="ot">=</span><span class="dv">2</span></span>
<span id="cb437-38"><a href="stats_method.html#cb437-38" tabindex="-1"></a>    , <span class="st">&quot;optimal setting&quot;</span> <span class="ot">=</span> <span class="dv">3</span></span>
<span id="cb437-39"><a href="stats_method.html#cb437-39" tabindex="-1"></a>  ))</span></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-415">Table 9.22: </span>predicted optimal parameter settings based on both detection and quantification accuracy
</caption>
<thead>
<tr>
<th style="empty-cells: hide;border-bottom:hidden;" colspan="2">
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="3">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
optimal setting
</div>
</th>
</tr>
<tr>
<th style="text-align:left;">
.
</th>
<th style="text-align:left;">
parameter
</th>
<th style="text-align:left;">
median
</th>
<th style="text-align:left;">
HDI low
</th>
<th style="text-align:left;">
HDI high
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="4">
structural only
</td>
<td style="text-align:left;">
chm_res_m
</td>
<td style="text-align:left;">
0.10
</td>
<td style="text-align:left;">
0.10
</td>
<td style="text-align:left;">
0.10
</td>
</tr>
<tr>
<td style="text-align:left;">
circle_fit_iou_pct
</td>
<td style="text-align:left;">
0.44
</td>
<td style="text-align:left;">
0.44
</td>
<td style="text-align:left;">
0.46
</td>
</tr>
<tr>
<td style="text-align:left;">
convexity_pct
</td>
<td style="text-align:left;">
0.08
</td>
<td style="text-align:left;">
0.06
</td>
<td style="text-align:left;">
0.12
</td>
</tr>
<tr>
<td style="text-align:left;">
spectral_weight
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
0
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="4">
structural+spectral
</td>
<td style="text-align:left;">
chm_res_m
</td>
<td style="text-align:left;">
0.10
</td>
<td style="text-align:left;">
0.10
</td>
<td style="text-align:left;">
0.10
</td>
</tr>
<tr>
<td style="text-align:left;">
circle_fit_iou_pct
</td>
<td style="text-align:left;">
0.46
</td>
<td style="text-align:left;">
0.44
</td>
<td style="text-align:left;">
0.48
</td>
</tr>
<tr>
<td style="text-align:left;">
convexity_pct
</td>
<td style="text-align:left;">
0.08
</td>
<td style="text-align:left;">
0.04
</td>
<td style="text-align:left;">
0.10
</td>
</tr>
<tr>
<td style="text-align:left;">
spectral_weight
</td>
<td style="text-align:left;">
5
</td>
<td style="text-align:left;">
4
</td>
<td style="text-align:left;">
5
</td>
</tr>
</tbody>
</table>
<p>based on the training data and our model, we have a high degree of certainty that these optimal parameter settings will return the best balanced accuracy. this is evidenced by the 95% highest density intervals (HDIs) of the posterior distribution of optimal solutions, which are either very narrow or centered on a single parameter setting, indicating low uncertainty in the model’s recommendation. However, it is crucial to remember that these settings should be refined based on the <em>actual, on-the-ground treatment prescription and implementation</em>. For example, if a prescription called for piles to be constructed as half-frustum of a cone with rounded ends (lolwut; <a href="https://scholar.google.com/scholar?cluster=3292666862612204856&amp;hl=en&amp;as_sdt=0,6">Hardy 1996</a>), these settings would be inappropriate since they assume mostly circular pile footprints which the method (based on the <code>convexity_pct</code> and <code>circle_fit_iou_pct</code> settings) would not be suited for</p>
</div>
<div id="posterior-distribution-of-accuracy" class="section level4 hasAnchor" number="9.4.2.2">
<h4><span class="header-section-number">9.4.2.2</span> Posterior distribution of accuracy<a href="stats_method.html#posterior-distribution-of-accuracy" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>what can we expect from a detection and form quantification accuracy perspective?</p>
<p>note, we distinguish the predicted accuracies based on the availability of spectral data which determines whether or not we can use a data fusion (i.e. “structural+spectral”) approach</p>
<div class="sourceCode" id="cb438"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb438-1"><a href="stats_method.html#cb438-1" tabindex="-1"></a><span class="co"># plot it</span></span>
<span id="cb438-2"><a href="stats_method.html#cb438-2" tabindex="-1"></a>best_balanced_accuracy_combos_long <span class="sc">%&gt;%</span> </span>
<span id="cb438-3"><a href="stats_method.html#cb438-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb438-4"><a href="stats_method.html#cb438-4" tabindex="-1"></a>  <span class="co"># filter for accuracy metrics</span></span>
<span id="cb438-5"><a href="stats_method.html#cb438-5" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(name<span class="sc">==</span><span class="st">&quot;f_score&quot;</span> <span class="sc">|</span> stringr<span class="sc">::</span><span class="fu">str_ends</span>(name, <span class="st">&quot;_mape&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb438-6"><a href="stats_method.html#cb438-6" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb438-7"><a href="stats_method.html#cb438-7" tabindex="-1"></a>    <span class="at">name =</span> name <span class="sc">%&gt;%</span> </span>
<span id="cb438-8"><a href="stats_method.html#cb438-8" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_replace_all</span>(<span class="st">&quot;_mape&quot;</span>, <span class="st">&quot;_MAPE&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb438-9"><a href="stats_method.html#cb438-9" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_replace_all</span>(<span class="st">&quot;f_score&quot;</span>, <span class="st">&quot;F-score&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb438-10"><a href="stats_method.html#cb438-10" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_replace_all</span>(<span class="st">&quot;_&quot;</span>, <span class="st">&quot; &quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb438-11"><a href="stats_method.html#cb438-11" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_squish</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb438-12"><a href="stats_method.html#cb438-12" tabindex="-1"></a>      <span class="fu">factor</span>(<span class="at">ordered =</span> T) <span class="sc">%&gt;%</span> </span>
<span id="cb438-13"><a href="stats_method.html#cb438-13" tabindex="-1"></a>      forcats<span class="sc">::</span><span class="fu">fct_relevel</span>(<span class="st">&quot;F-score&quot;</span>)</span>
<span id="cb438-14"><a href="stats_method.html#cb438-14" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb438-15"><a href="stats_method.html#cb438-15" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> value)) <span class="sc">+</span></span>
<span id="cb438-16"><a href="stats_method.html#cb438-16" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">stat_dotsinterval</span>(</span>
<span id="cb438-17"><a href="stats_method.html#cb438-17" tabindex="-1"></a>    <span class="at">point_interval =</span> <span class="st">&quot;median_hdci&quot;</span>, <span class="at">.width =</span> <span class="fu">c</span>(<span class="fl">0.95</span>)</span>
<span id="cb438-18"><a href="stats_method.html#cb438-18" tabindex="-1"></a>    , <span class="at">quantiles =</span> <span class="dv">100</span></span>
<span id="cb438-19"><a href="stats_method.html#cb438-19" tabindex="-1"></a>    , <span class="at">point_size =</span> <span class="dv">3</span></span>
<span id="cb438-20"><a href="stats_method.html#cb438-20" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb438-21"><a href="stats_method.html#cb438-21" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">facet_grid</span>(</span>
<span id="cb438-22"><a href="stats_method.html#cb438-22" tabindex="-1"></a>    <span class="at">rows =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(method_input_data)</span>
<span id="cb438-23"><a href="stats_method.html#cb438-23" tabindex="-1"></a>    , <span class="at">cols =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(name)</span>
<span id="cb438-24"><a href="stats_method.html#cb438-24" tabindex="-1"></a>    , <span class="at">scales =</span> <span class="st">&quot;free_x&quot;</span></span>
<span id="cb438-25"><a href="stats_method.html#cb438-25" tabindex="-1"></a>    , <span class="at">axes =</span> <span class="st">&quot;all_x&quot;</span></span>
<span id="cb438-26"><a href="stats_method.html#cb438-26" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb438-27"><a href="stats_method.html#cb438-27" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb438-28"><a href="stats_method.html#cb438-28" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_x_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>percent) <span class="sc">+</span></span>
<span id="cb438-29"><a href="stats_method.html#cb438-29" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb438-30"><a href="stats_method.html#cb438-30" tabindex="-1"></a>    <span class="at">x=</span><span class="st">&quot;&quot;</span></span>
<span id="cb438-31"><a href="stats_method.html#cb438-31" tabindex="-1"></a>    , <span class="at">subtitle =</span> <span class="fu">paste0</span>(</span>
<span id="cb438-32"><a href="stats_method.html#cb438-32" tabindex="-1"></a>     <span class="st">&quot;predicted pile detection and form quantification accuracy metrics&quot;</span></span>
<span id="cb438-33"><a href="stats_method.html#cb438-33" tabindex="-1"></a>     , <span class="st">&quot;</span><span class="sc">\n</span><span class="st">using optimal parameter settings based on both detection and quantification accuracy&quot;</span></span>
<span id="cb438-34"><a href="stats_method.html#cb438-34" tabindex="-1"></a>    )</span>
<span id="cb438-35"><a href="stats_method.html#cb438-35" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb438-36"><a href="stats_method.html#cb438-36" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb438-37"><a href="stats_method.html#cb438-37" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb438-38"><a href="stats_method.html#cb438-38" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb438-39"><a href="stats_method.html#cb438-39" tabindex="-1"></a>    , <span class="at">strip.text =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb438-40"><a href="stats_method.html#cb438-40" tabindex="-1"></a>    , <span class="at">axis.text.x =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>, <span class="at">angle =</span> <span class="dv">90</span>)</span>
<span id="cb438-41"><a href="stats_method.html#cb438-41" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-416-1.png" width="1008" /></p>
<p>let’s table the HDI of the predicted accuracy metrics</p>
<div class="sourceCode" id="cb439"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb439-1"><a href="stats_method.html#cb439-1" tabindex="-1"></a><span class="co"># summarize it</span></span>
<span id="cb439-2"><a href="stats_method.html#cb439-2" tabindex="-1"></a>best_balanced_accuracy_combos_long <span class="sc">%&gt;%</span> </span>
<span id="cb439-3"><a href="stats_method.html#cb439-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb439-4"><a href="stats_method.html#cb439-4" tabindex="-1"></a>  <span class="co"># filter for accuracy metrics</span></span>
<span id="cb439-5"><a href="stats_method.html#cb439-5" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(name<span class="sc">==</span><span class="st">&quot;f_score&quot;</span> <span class="sc">|</span> stringr<span class="sc">::</span><span class="fu">str_ends</span>(name, <span class="st">&quot;_mape&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb439-6"><a href="stats_method.html#cb439-6" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb439-7"><a href="stats_method.html#cb439-7" tabindex="-1"></a>    <span class="at">name =</span> name <span class="sc">%&gt;%</span> </span>
<span id="cb439-8"><a href="stats_method.html#cb439-8" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_replace_all</span>(<span class="st">&quot;_mape&quot;</span>, <span class="st">&quot;_MAPE&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb439-9"><a href="stats_method.html#cb439-9" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_replace_all</span>(<span class="st">&quot;f_score&quot;</span>, <span class="st">&quot;F-score&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb439-10"><a href="stats_method.html#cb439-10" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_replace_all</span>(<span class="st">&quot;_&quot;</span>, <span class="st">&quot; &quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb439-11"><a href="stats_method.html#cb439-11" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_squish</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb439-12"><a href="stats_method.html#cb439-12" tabindex="-1"></a>      <span class="fu">factor</span>(<span class="at">ordered =</span> T) <span class="sc">%&gt;%</span> </span>
<span id="cb439-13"><a href="stats_method.html#cb439-13" tabindex="-1"></a>      forcats<span class="sc">::</span><span class="fu">fct_relevel</span>(<span class="st">&quot;F-score&quot;</span>)</span>
<span id="cb439-14"><a href="stats_method.html#cb439-14" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb439-15"><a href="stats_method.html#cb439-15" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(method_input_data, name) <span class="sc">%&gt;%</span> </span>
<span id="cb439-16"><a href="stats_method.html#cb439-16" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(</span>
<span id="cb439-17"><a href="stats_method.html#cb439-17" tabindex="-1"></a>    <span class="co"># get median_hdi</span></span>
<span id="cb439-18"><a href="stats_method.html#cb439-18" tabindex="-1"></a>    <span class="at">median_hdi_est =</span> tidybayes<span class="sc">::</span><span class="fu">median_hdci</span>(value)<span class="sc">$</span>y</span>
<span id="cb439-19"><a href="stats_method.html#cb439-19" tabindex="-1"></a>    , <span class="at">median_hdi_lower =</span> tidybayes<span class="sc">::</span><span class="fu">median_hdci</span>(value)<span class="sc">$</span>ymin</span>
<span id="cb439-20"><a href="stats_method.html#cb439-20" tabindex="-1"></a>    , <span class="at">median_hdi_upper =</span> tidybayes<span class="sc">::</span><span class="fu">median_hdci</span>(value)<span class="sc">$</span>ymax</span>
<span id="cb439-21"><a href="stats_method.html#cb439-21" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb439-22"><a href="stats_method.html#cb439-22" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb439-23"><a href="stats_method.html#cb439-23" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(dplyr<span class="sc">::</span><span class="fu">across</span>(</span>
<span id="cb439-24"><a href="stats_method.html#cb439-24" tabindex="-1"></a>    tidyselect<span class="sc">::</span><span class="fu">starts_with</span>(<span class="st">&quot;median_hdi&quot;</span>)</span>
<span id="cb439-25"><a href="stats_method.html#cb439-25" tabindex="-1"></a>    , <span class="sc">~</span> scales<span class="sc">::</span><span class="fu">percent</span>(.x,<span class="at">accuracy=</span>.<span class="dv">1</span>)</span>
<span id="cb439-26"><a href="stats_method.html#cb439-26" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb439-27"><a href="stats_method.html#cb439-27" tabindex="-1"></a>  <span class="co"># table it</span></span>
<span id="cb439-28"><a href="stats_method.html#cb439-28" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kbl</span>(</span>
<span id="cb439-29"><a href="stats_method.html#cb439-29" tabindex="-1"></a>    <span class="at">caption =</span> <span class="fu">paste0</span>(</span>
<span id="cb439-30"><a href="stats_method.html#cb439-30" tabindex="-1"></a>     <span class="st">&quot;predicted pile detection and form quantification accuracy metrics&quot;</span></span>
<span id="cb439-31"><a href="stats_method.html#cb439-31" tabindex="-1"></a>     , <span class="st">&quot;&lt;br&gt;using optimal parameter settings based on both detection and quantification accuracy&quot;</span></span>
<span id="cb439-32"><a href="stats_method.html#cb439-32" tabindex="-1"></a>    )</span>
<span id="cb439-33"><a href="stats_method.html#cb439-33" tabindex="-1"></a>    , <span class="at">col.names =</span> <span class="fu">c</span>(</span>
<span id="cb439-34"><a href="stats_method.html#cb439-34" tabindex="-1"></a>      <span class="st">&quot;.&quot;</span>, <span class="st">&quot;metric&quot;</span></span>
<span id="cb439-35"><a href="stats_method.html#cb439-35" tabindex="-1"></a>      , <span class="fu">c</span>(<span class="st">&quot;median&quot;</span>, <span class="st">&quot;HDI low&quot;</span>, <span class="st">&quot;HDI high&quot;</span>)</span>
<span id="cb439-36"><a href="stats_method.html#cb439-36" tabindex="-1"></a>    )</span>
<span id="cb439-37"><a href="stats_method.html#cb439-37" tabindex="-1"></a>    , <span class="at">escape =</span> F</span>
<span id="cb439-38"><a href="stats_method.html#cb439-38" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb439-39"><a href="stats_method.html#cb439-39" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kable_styling</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb439-40"><a href="stats_method.html#cb439-40" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">collapse_rows</span>(<span class="at">columns =</span> <span class="dv">1</span>, <span class="at">valign =</span> <span class="st">&quot;top&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb439-41"><a href="stats_method.html#cb439-41" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">add_header_above</span>(<span class="fu">c</span>(</span>
<span id="cb439-42"><a href="stats_method.html#cb439-42" tabindex="-1"></a>    <span class="st">&quot; &quot;</span><span class="ot">=</span><span class="dv">2</span></span>
<span id="cb439-43"><a href="stats_method.html#cb439-43" tabindex="-1"></a>    , <span class="st">&quot;predicted value&quot;</span> <span class="ot">=</span> <span class="dv">3</span></span>
<span id="cb439-44"><a href="stats_method.html#cb439-44" tabindex="-1"></a>  ))</span></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-417">Table 9.23: </span>predicted pile detection and form quantification accuracy metrics<br>using optimal parameter settings based on both detection and quantification accuracy
</caption>
<thead>
<tr>
<th style="empty-cells: hide;border-bottom:hidden;" colspan="2">
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="3">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
predicted value
</div>
</th>
</tr>
<tr>
<th style="text-align:left;">
.
</th>
<th style="text-align:left;">
metric
</th>
<th style="text-align:left;">
median
</th>
<th style="text-align:left;">
HDI low
</th>
<th style="text-align:left;">
HDI high
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="3">
structural only
</td>
<td style="text-align:left;">
F-score
</td>
<td style="text-align:left;">
79.7%
</td>
<td style="text-align:left;">
78.9%
</td>
<td style="text-align:left;">
80.5%
</td>
</tr>
<tr>
<td style="text-align:left;">
diameter MAPE
</td>
<td style="text-align:left;">
10.9%
</td>
<td style="text-align:left;">
10.8%
</td>
<td style="text-align:left;">
11.0%
</td>
</tr>
<tr>
<td style="text-align:left;">
height MAPE
</td>
<td style="text-align:left;">
15.6%
</td>
<td style="text-align:left;">
15.4%
</td>
<td style="text-align:left;">
15.7%
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="3">
structural+spectral
</td>
<td style="text-align:left;">
F-score
</td>
<td style="text-align:left;">
83.1%
</td>
<td style="text-align:left;">
82.4%
</td>
<td style="text-align:left;">
83.8%
</td>
</tr>
<tr>
<td style="text-align:left;">
diameter MAPE
</td>
<td style="text-align:left;">
11.4%
</td>
<td style="text-align:left;">
10.7%
</td>
<td style="text-align:left;">
11.6%
</td>
</tr>
<tr>
<td style="text-align:left;">
height MAPE
</td>
<td style="text-align:left;">
15.3%
</td>
<td style="text-align:left;">
15.1%
</td>
<td style="text-align:left;">
15.5%
</td>
</tr>
</tbody>
</table>
<p>The narrow 95% highest density intervals (HDIs) of the posterior distribution for the accuracy metrics indicate a high degree of confidence that the method is capable of high detection and form quantification accuracy. This predicted performance, however, is <em>contingent on using the specific optimal parameter settings</em> identified in this analysis. These expectations are specific to the training data, which consisted of piles that were generally circular with few irregularities in their footprint. As such, these results should not be anticipated if the actual on-the-ground pile prescription and implementation differ from those of this training data. Similarly, the same level of accuracy should not be expected if the parameterization of the detection method is altered, even when applied to piles with similar shapes and structures.</p>
</div>
</div>
<div id="by-chm-resolution-2" class="section level3 hasAnchor" number="9.4.3">
<h3><span class="header-section-number">9.4.3</span> by CHM resolution<a href="stats_method.html#by-chm-resolution-2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>these recommendations are for users who <em>cannot</em> generate a CHM from the original point cloud and only have access to a CHM at a provided resolution (assuming that resolution is &lt;= 0.5)</p>
<div class="sourceCode" id="cb440"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb440-1"><a href="stats_method.html#cb440-1" tabindex="-1"></a><span class="co"># pivot to long</span></span>
<span id="cb440-2"><a href="stats_method.html#cb440-2" tabindex="-1"></a>best_balanced_accuracy_combos_long <span class="ot">&lt;-</span> </span>
<span id="cb440-3"><a href="stats_method.html#cb440-3" tabindex="-1"></a>  best_balanced_accuracy_combos_chm <span class="sc">%&gt;%</span> </span>
<span id="cb440-4"><a href="stats_method.html#cb440-4" tabindex="-1"></a>  <span class="co"># get rid of vars we fixed</span></span>
<span id="cb440-5"><a href="stats_method.html#cb440-5" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(max_ht_m, max_area_m2)) <span class="sc">%&gt;%</span> </span>
<span id="cb440-6"><a href="stats_method.html#cb440-6" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb440-7"><a href="stats_method.html#cb440-7" tabindex="-1"></a>    <span class="at">spectral_weight =</span> spectral_weight <span class="sc">%&gt;%</span> <span class="fu">as.character</span>() <span class="sc">%&gt;%</span> <span class="fu">as.numeric</span>()</span>
<span id="cb440-8"><a href="stats_method.html#cb440-8" tabindex="-1"></a>    , <span class="at">chm_res_m_desc =</span> <span class="fu">paste0</span>(chm_res_m, <span class="st">&quot;m CHM&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">factor</span>() <span class="sc">%&gt;%</span> forcats<span class="sc">::</span><span class="fu">fct_reorder</span>(chm_res_m)</span>
<span id="cb440-9"><a href="stats_method.html#cb440-9" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb440-10"><a href="stats_method.html#cb440-10" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span><span class="fu">c</span>(.draw,method_input_data,chm_res_m,chm_res_m_desc))</span>
<span id="cb440-11"><a href="stats_method.html#cb440-11" tabindex="-1"></a><span class="co"># best_balanced_accuracy_combos_long %&gt;% dplyr::glimpse()</span></span>
<span id="cb440-12"><a href="stats_method.html#cb440-12" tabindex="-1"></a><span class="co"># best_balanced_accuracy_combos_long %&gt;% dplyr::ungroup() %&gt;% dplyr::count(name)</span></span></code></pre></div>
<div id="posterior-distribution-of-optimal-settings-1" class="section level4 hasAnchor" number="9.4.3.1">
<h4><span class="header-section-number">9.4.3.1</span> Posterior distribution of optimal settings<a href="stats_method.html#posterior-distribution-of-optimal-settings-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>let’s check out the posterior distribution of optimal settings for each parameter. remember, it is these parameter settings <em>combined</em> that are expected to yield the best balance between detection and quantification accuracy based on our weighting</p>
<div id="data-fusion-1" class="section level5 hasAnchor" number="9.4.3.1.1">
<h5><span class="header-section-number">9.4.3.1.1</span> Data Fusion<a href="stats_method.html#data-fusion-1" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>let’s start with the data fusion approach which assumes users have RGB data to complement the structural CHM data</p>
<div class="sourceCode" id="cb441"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb441-1"><a href="stats_method.html#cb441-1" tabindex="-1"></a><span class="co"># plot it</span></span>
<span id="cb441-2"><a href="stats_method.html#cb441-2" tabindex="-1"></a>best_balanced_accuracy_combos_long <span class="sc">%&gt;%</span> </span>
<span id="cb441-3"><a href="stats_method.html#cb441-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(method_input_data<span class="sc">==</span><span class="st">&quot;structural+spectral&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb441-4"><a href="stats_method.html#cb441-4" tabindex="-1"></a>  <span class="co"># filter out accuracy metrics</span></span>
<span id="cb441-5"><a href="stats_method.html#cb441-5" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(name<span class="sc">!=</span><span class="st">&quot;f_score&quot;</span>, <span class="sc">!</span>stringr<span class="sc">::</span><span class="fu">str_ends</span>(name, <span class="st">&quot;_mape&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb441-6"><a href="stats_method.html#cb441-6" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> value)) <span class="sc">+</span></span>
<span id="cb441-7"><a href="stats_method.html#cb441-7" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">stat_dotsinterval</span>(</span>
<span id="cb441-8"><a href="stats_method.html#cb441-8" tabindex="-1"></a>    <span class="at">point_interval =</span> <span class="st">&quot;median_hdci&quot;</span>, <span class="at">.width =</span> <span class="fu">c</span>(<span class="fl">0.95</span>)</span>
<span id="cb441-9"><a href="stats_method.html#cb441-9" tabindex="-1"></a>    , <span class="at">quantiles =</span> <span class="dv">100</span></span>
<span id="cb441-10"><a href="stats_method.html#cb441-10" tabindex="-1"></a>    , <span class="at">point_size =</span> <span class="dv">3</span> </span>
<span id="cb441-11"><a href="stats_method.html#cb441-11" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb441-12"><a href="stats_method.html#cb441-12" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">facet_grid</span>(</span>
<span id="cb441-13"><a href="stats_method.html#cb441-13" tabindex="-1"></a>    <span class="at">rows =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(chm_res_m_desc)</span>
<span id="cb441-14"><a href="stats_method.html#cb441-14" tabindex="-1"></a>    , <span class="at">cols =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(name)</span>
<span id="cb441-15"><a href="stats_method.html#cb441-15" tabindex="-1"></a>    , <span class="at">scales =</span> <span class="st">&quot;free_x&quot;</span></span>
<span id="cb441-16"><a href="stats_method.html#cb441-16" tabindex="-1"></a>    , <span class="at">axes =</span> <span class="st">&quot;all_x&quot;</span></span>
<span id="cb441-17"><a href="stats_method.html#cb441-17" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb441-18"><a href="stats_method.html#cb441-18" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb441-19"><a href="stats_method.html#cb441-19" tabindex="-1"></a>  <span class="co"># ggplot2::scale_x_continuous(expand = ggplot2::expansion(mult = 1.2)) +</span></span>
<span id="cb441-20"><a href="stats_method.html#cb441-20" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb441-21"><a href="stats_method.html#cb441-21" tabindex="-1"></a>    <span class="at">x=</span><span class="st">&quot;&quot;</span></span>
<span id="cb441-22"><a href="stats_method.html#cb441-22" tabindex="-1"></a>    , <span class="at">subtitle =</span> <span class="fu">paste0</span>(</span>
<span id="cb441-23"><a href="stats_method.html#cb441-23" tabindex="-1"></a>     <span class="st">&quot;Data Fusion (structural+spectral)&quot;</span></span>
<span id="cb441-24"><a href="stats_method.html#cb441-24" tabindex="-1"></a>     , <span class="st">&quot;</span><span class="sc">\n</span><span class="st">predicted optimal parameter settings based on both detection and quantification accuracy&quot;</span></span>
<span id="cb441-25"><a href="stats_method.html#cb441-25" tabindex="-1"></a>    )</span>
<span id="cb441-26"><a href="stats_method.html#cb441-26" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb441-27"><a href="stats_method.html#cb441-27" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb441-28"><a href="stats_method.html#cb441-28" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb441-29"><a href="stats_method.html#cb441-29" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb441-30"><a href="stats_method.html#cb441-30" tabindex="-1"></a>    , <span class="at">strip.text.x =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">9</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb441-31"><a href="stats_method.html#cb441-31" tabindex="-1"></a>    , <span class="at">strip.text.y =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">7</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb441-32"><a href="stats_method.html#cb441-32" tabindex="-1"></a>    , <span class="at">axis.text.x =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">7</span>, <span class="at">angle =</span> <span class="dv">90</span>)</span>
<span id="cb441-33"><a href="stats_method.html#cb441-33" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-420-1.png" width="1008" /></p>
<p>let’s table the HDI of the optimal values</p>
<div class="sourceCode" id="cb442"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb442-1"><a href="stats_method.html#cb442-1" tabindex="-1"></a><span class="co"># summarize it</span></span>
<span id="cb442-2"><a href="stats_method.html#cb442-2" tabindex="-1"></a>best_balanced_accuracy_combos_long <span class="sc">%&gt;%</span> </span>
<span id="cb442-3"><a href="stats_method.html#cb442-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(method_input_data<span class="sc">==</span><span class="st">&quot;structural+spectral&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb442-4"><a href="stats_method.html#cb442-4" tabindex="-1"></a>  <span class="co"># filter out accuracy metrics</span></span>
<span id="cb442-5"><a href="stats_method.html#cb442-5" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(name<span class="sc">!=</span><span class="st">&quot;f_score&quot;</span>, <span class="sc">!</span>stringr<span class="sc">::</span><span class="fu">str_ends</span>(name, <span class="st">&quot;_mape&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb442-6"><a href="stats_method.html#cb442-6" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(chm_res_m_desc,method_input_data,name) <span class="sc">%&gt;%</span> </span>
<span id="cb442-7"><a href="stats_method.html#cb442-7" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(</span>
<span id="cb442-8"><a href="stats_method.html#cb442-8" tabindex="-1"></a>    <span class="co"># get median_hdi</span></span>
<span id="cb442-9"><a href="stats_method.html#cb442-9" tabindex="-1"></a>    <span class="at">median_hdi_est =</span> tidybayes<span class="sc">::</span><span class="fu">median_hdci</span>(value)<span class="sc">$</span>y</span>
<span id="cb442-10"><a href="stats_method.html#cb442-10" tabindex="-1"></a>    , <span class="at">median_hdi_lower =</span> tidybayes<span class="sc">::</span><span class="fu">median_hdci</span>(value)<span class="sc">$</span>ymin</span>
<span id="cb442-11"><a href="stats_method.html#cb442-11" tabindex="-1"></a>    , <span class="at">median_hdi_upper =</span> tidybayes<span class="sc">::</span><span class="fu">median_hdci</span>(value)<span class="sc">$</span>ymax</span>
<span id="cb442-12"><a href="stats_method.html#cb442-12" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb442-13"><a href="stats_method.html#cb442-13" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb442-14"><a href="stats_method.html#cb442-14" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(dplyr<span class="sc">::</span><span class="fu">across</span>(</span>
<span id="cb442-15"><a href="stats_method.html#cb442-15" tabindex="-1"></a>    tidyselect<span class="sc">::</span><span class="fu">starts_with</span>(<span class="st">&quot;median_hdi&quot;</span>)</span>
<span id="cb442-16"><a href="stats_method.html#cb442-16" tabindex="-1"></a>    , <span class="sc">~</span>dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb442-17"><a href="stats_method.html#cb442-17" tabindex="-1"></a>      name <span class="sc">==</span> <span class="st">&quot;spectral_weight&quot;</span> <span class="sc">~</span> scales<span class="sc">::</span><span class="fu">comma</span>(.x,<span class="at">accuracy=</span><span class="dv">1</span>)</span>
<span id="cb442-18"><a href="stats_method.html#cb442-18" tabindex="-1"></a>      , T <span class="sc">~</span>scales<span class="sc">::</span><span class="fu">comma</span>(.x,<span class="at">accuracy=</span>.<span class="dv">01</span>)</span>
<span id="cb442-19"><a href="stats_method.html#cb442-19" tabindex="-1"></a>    )</span>
<span id="cb442-20"><a href="stats_method.html#cb442-20" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb442-21"><a href="stats_method.html#cb442-21" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>method_input_data) <span class="sc">%&gt;%</span> </span>
<span id="cb442-22"><a href="stats_method.html#cb442-22" tabindex="-1"></a>  <span class="co"># table it</span></span>
<span id="cb442-23"><a href="stats_method.html#cb442-23" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kbl</span>(</span>
<span id="cb442-24"><a href="stats_method.html#cb442-24" tabindex="-1"></a>    <span class="at">caption =</span> <span class="fu">paste0</span>(</span>
<span id="cb442-25"><a href="stats_method.html#cb442-25" tabindex="-1"></a>      <span class="st">&quot;Data Fusion (structural+spectral)&quot;</span></span>
<span id="cb442-26"><a href="stats_method.html#cb442-26" tabindex="-1"></a>      , <span class="st">&quot;&lt;br&gt;predicted optimal parameter settings based on both detection and quantification accuracy&quot;</span></span>
<span id="cb442-27"><a href="stats_method.html#cb442-27" tabindex="-1"></a>    )</span>
<span id="cb442-28"><a href="stats_method.html#cb442-28" tabindex="-1"></a>    , <span class="at">col.names =</span> <span class="fu">c</span>(</span>
<span id="cb442-29"><a href="stats_method.html#cb442-29" tabindex="-1"></a>      <span class="st">&quot;CHM resolution&quot;</span>, <span class="st">&quot;parameter&quot;</span></span>
<span id="cb442-30"><a href="stats_method.html#cb442-30" tabindex="-1"></a>      , <span class="fu">c</span>(<span class="st">&quot;median&quot;</span>, <span class="st">&quot;HDI low&quot;</span>, <span class="st">&quot;HDI high&quot;</span>)</span>
<span id="cb442-31"><a href="stats_method.html#cb442-31" tabindex="-1"></a>    )</span>
<span id="cb442-32"><a href="stats_method.html#cb442-32" tabindex="-1"></a>    , <span class="at">escape =</span> F</span>
<span id="cb442-33"><a href="stats_method.html#cb442-33" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb442-34"><a href="stats_method.html#cb442-34" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kable_styling</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb442-35"><a href="stats_method.html#cb442-35" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">collapse_rows</span>(<span class="at">columns =</span> <span class="dv">1</span>, <span class="at">valign =</span> <span class="st">&quot;top&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb442-36"><a href="stats_method.html#cb442-36" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">add_header_above</span>(<span class="fu">c</span>(</span>
<span id="cb442-37"><a href="stats_method.html#cb442-37" tabindex="-1"></a>    <span class="st">&quot; &quot;</span><span class="ot">=</span><span class="dv">2</span></span>
<span id="cb442-38"><a href="stats_method.html#cb442-38" tabindex="-1"></a>    , <span class="st">&quot;optimal setting&quot;</span> <span class="ot">=</span> <span class="dv">3</span></span>
<span id="cb442-39"><a href="stats_method.html#cb442-39" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb442-40"><a href="stats_method.html#cb442-40" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">scroll_box</span>(<span class="at">height =</span> <span class="st">&quot;8in&quot;</span>)</span></code></pre></div>
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:8in; ">
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-421">Table 9.24: </span>Data Fusion (structural+spectral)<br>predicted optimal parameter settings based on both detection and quantification accuracy
</caption>
<thead>
<tr>
<th style="empty-cells: hide;border-bottom:hidden;position: sticky; top:0; background-color: #FFFFFF;" colspan="2">
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; position: sticky; top:0; background-color: #FFFFFF;" colspan="3">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
optimal setting
</div>
</th>
</tr>
<tr>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
CHM resolution
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
parameter
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
median
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
HDI low
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
HDI high
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="3">
0.1m CHM
</td>
<td style="text-align:left;">
circle_fit_iou_pct
</td>
<td style="text-align:left;">
0.44
</td>
<td style="text-align:left;">
0.42
</td>
<td style="text-align:left;">
0.48
</td>
</tr>
<tr>
<td style="text-align:left;">
convexity_pct
</td>
<td style="text-align:left;">
0.08
</td>
<td style="text-align:left;">
0.00
</td>
<td style="text-align:left;">
0.14
</td>
</tr>
<tr>
<td style="text-align:left;">
spectral_weight
</td>
<td style="text-align:left;">
4
</td>
<td style="text-align:left;">
4
</td>
<td style="text-align:left;">
5
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="3">
0.15m CHM
</td>
<td style="text-align:left;">
circle_fit_iou_pct
</td>
<td style="text-align:left;">
0.46
</td>
<td style="text-align:left;">
0.44
</td>
<td style="text-align:left;">
0.48
</td>
</tr>
<tr>
<td style="text-align:left;">
convexity_pct
</td>
<td style="text-align:left;">
0.14
</td>
<td style="text-align:left;">
0.10
</td>
<td style="text-align:left;">
0.18
</td>
</tr>
<tr>
<td style="text-align:left;">
spectral_weight
</td>
<td style="text-align:left;">
4
</td>
<td style="text-align:left;">
4
</td>
<td style="text-align:left;">
5
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="3">
0.2m CHM
</td>
<td style="text-align:left;">
circle_fit_iou_pct
</td>
<td style="text-align:left;">
0.48
</td>
<td style="text-align:left;">
0.42
</td>
<td style="text-align:left;">
0.48
</td>
</tr>
<tr>
<td style="text-align:left;">
convexity_pct
</td>
<td style="text-align:left;">
0.20
</td>
<td style="text-align:left;">
0.16
</td>
<td style="text-align:left;">
0.24
</td>
</tr>
<tr>
<td style="text-align:left;">
spectral_weight
</td>
<td style="text-align:left;">
4
</td>
<td style="text-align:left;">
4
</td>
<td style="text-align:left;">
5
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="3">
0.25m CHM
</td>
<td style="text-align:left;">
circle_fit_iou_pct
</td>
<td style="text-align:left;">
0.46
</td>
<td style="text-align:left;">
0.40
</td>
<td style="text-align:left;">
0.48
</td>
</tr>
<tr>
<td style="text-align:left;">
convexity_pct
</td>
<td style="text-align:left;">
0.24
</td>
<td style="text-align:left;">
0.20
</td>
<td style="text-align:left;">
0.32
</td>
</tr>
<tr>
<td style="text-align:left;">
spectral_weight
</td>
<td style="text-align:left;">
4
</td>
<td style="text-align:left;">
4
</td>
<td style="text-align:left;">
5
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="3">
0.3m CHM
</td>
<td style="text-align:left;">
circle_fit_iou_pct
</td>
<td style="text-align:left;">
0.38
</td>
<td style="text-align:left;">
0.36
</td>
<td style="text-align:left;">
0.42
</td>
</tr>
<tr>
<td style="text-align:left;">
convexity_pct
</td>
<td style="text-align:left;">
0.40
</td>
<td style="text-align:left;">
0.36
</td>
<td style="text-align:left;">
0.48
</td>
</tr>
<tr>
<td style="text-align:left;">
spectral_weight
</td>
<td style="text-align:left;">
4
</td>
<td style="text-align:left;">
4
</td>
<td style="text-align:left;">
5
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="3">
0.35m CHM
</td>
<td style="text-align:left;">
circle_fit_iou_pct
</td>
<td style="text-align:left;">
0.34
</td>
<td style="text-align:left;">
0.30
</td>
<td style="text-align:left;">
0.36
</td>
</tr>
<tr>
<td style="text-align:left;">
convexity_pct
</td>
<td style="text-align:left;">
0.58
</td>
<td style="text-align:left;">
0.54
</td>
<td style="text-align:left;">
0.66
</td>
</tr>
<tr>
<td style="text-align:left;">
spectral_weight
</td>
<td style="text-align:left;">
5
</td>
<td style="text-align:left;">
4
</td>
<td style="text-align:left;">
5
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="3">
0.4m CHM
</td>
<td style="text-align:left;">
circle_fit_iou_pct
</td>
<td style="text-align:left;">
0.32
</td>
<td style="text-align:left;">
0.30
</td>
<td style="text-align:left;">
0.32
</td>
</tr>
<tr>
<td style="text-align:left;">
convexity_pct
</td>
<td style="text-align:left;">
0.68
</td>
<td style="text-align:left;">
0.60
</td>
<td style="text-align:left;">
0.70
</td>
</tr>
<tr>
<td style="text-align:left;">
spectral_weight
</td>
<td style="text-align:left;">
5
</td>
<td style="text-align:left;">
4
</td>
<td style="text-align:left;">
5
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="3">
0.45m CHM
</td>
<td style="text-align:left;">
circle_fit_iou_pct
</td>
<td style="text-align:left;">
0.30
</td>
<td style="text-align:left;">
0.28
</td>
<td style="text-align:left;">
0.30
</td>
</tr>
<tr>
<td style="text-align:left;">
convexity_pct
</td>
<td style="text-align:left;">
0.70
</td>
<td style="text-align:left;">
0.68
</td>
<td style="text-align:left;">
0.72
</td>
</tr>
<tr>
<td style="text-align:left;">
spectral_weight
</td>
<td style="text-align:left;">
5
</td>
<td style="text-align:left;">
5
</td>
<td style="text-align:left;">
5
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="3">
0.5m CHM
</td>
<td style="text-align:left;">
circle_fit_iou_pct
</td>
<td style="text-align:left;">
0.28
</td>
<td style="text-align:left;">
0.26
</td>
<td style="text-align:left;">
0.28
</td>
</tr>
<tr>
<td style="text-align:left;">
convexity_pct
</td>
<td style="text-align:left;">
0.76
</td>
<td style="text-align:left;">
0.72
</td>
<td style="text-align:left;">
0.76
</td>
</tr>
<tr>
<td style="text-align:left;">
spectral_weight
</td>
<td style="text-align:left;">
5
</td>
<td style="text-align:left;">
5
</td>
<td style="text-align:left;">
5
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="structural-only-1" class="section level5 hasAnchor" number="9.4.3.1.2">
<h5><span class="header-section-number">9.4.3.1.2</span> Structural only<a href="stats_method.html#structural-only-1" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>now we’ll consider an approach that only uses structural data without the benefit of supplemental spectral data</p>
<div class="sourceCode" id="cb443"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb443-1"><a href="stats_method.html#cb443-1" tabindex="-1"></a><span class="co"># plot it</span></span>
<span id="cb443-2"><a href="stats_method.html#cb443-2" tabindex="-1"></a>best_balanced_accuracy_combos_long <span class="sc">%&gt;%</span> </span>
<span id="cb443-3"><a href="stats_method.html#cb443-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(method_input_data<span class="sc">==</span><span class="st">&quot;structural only&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb443-4"><a href="stats_method.html#cb443-4" tabindex="-1"></a>  <span class="co"># filter out accuracy metrics</span></span>
<span id="cb443-5"><a href="stats_method.html#cb443-5" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(name<span class="sc">!=</span><span class="st">&quot;f_score&quot;</span>, <span class="sc">!</span>stringr<span class="sc">::</span><span class="fu">str_ends</span>(name, <span class="st">&quot;_mape&quot;</span>), name<span class="sc">!=</span><span class="st">&quot;spectral_weight&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb443-6"><a href="stats_method.html#cb443-6" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> value)) <span class="sc">+</span></span>
<span id="cb443-7"><a href="stats_method.html#cb443-7" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">stat_dotsinterval</span>(</span>
<span id="cb443-8"><a href="stats_method.html#cb443-8" tabindex="-1"></a>    <span class="at">point_interval =</span> <span class="st">&quot;median_hdci&quot;</span>, <span class="at">.width =</span> <span class="fu">c</span>(<span class="fl">0.95</span>)</span>
<span id="cb443-9"><a href="stats_method.html#cb443-9" tabindex="-1"></a>    , <span class="at">quantiles =</span> <span class="dv">100</span></span>
<span id="cb443-10"><a href="stats_method.html#cb443-10" tabindex="-1"></a>    , <span class="at">point_size =</span> <span class="dv">3</span> </span>
<span id="cb443-11"><a href="stats_method.html#cb443-11" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb443-12"><a href="stats_method.html#cb443-12" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">facet_grid</span>(</span>
<span id="cb443-13"><a href="stats_method.html#cb443-13" tabindex="-1"></a>    <span class="at">rows =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(chm_res_m_desc)</span>
<span id="cb443-14"><a href="stats_method.html#cb443-14" tabindex="-1"></a>    , <span class="at">cols =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(name)</span>
<span id="cb443-15"><a href="stats_method.html#cb443-15" tabindex="-1"></a>    , <span class="at">scales =</span> <span class="st">&quot;free_x&quot;</span></span>
<span id="cb443-16"><a href="stats_method.html#cb443-16" tabindex="-1"></a>    , <span class="at">axes =</span> <span class="st">&quot;all_x&quot;</span></span>
<span id="cb443-17"><a href="stats_method.html#cb443-17" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb443-18"><a href="stats_method.html#cb443-18" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb443-19"><a href="stats_method.html#cb443-19" tabindex="-1"></a>  <span class="co"># ggplot2::scale_x_continuous(expand = ggplot2::expansion(mult = 1.2)) +</span></span>
<span id="cb443-20"><a href="stats_method.html#cb443-20" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb443-21"><a href="stats_method.html#cb443-21" tabindex="-1"></a>    <span class="at">x=</span><span class="st">&quot;&quot;</span></span>
<span id="cb443-22"><a href="stats_method.html#cb443-22" tabindex="-1"></a>    , <span class="at">subtitle =</span> <span class="fu">paste0</span>(</span>
<span id="cb443-23"><a href="stats_method.html#cb443-23" tabindex="-1"></a>     <span class="st">&quot;Structural only&quot;</span></span>
<span id="cb443-24"><a href="stats_method.html#cb443-24" tabindex="-1"></a>     , <span class="st">&quot;</span><span class="sc">\n</span><span class="st">predicted optimal parameter settings based on both detection and quantification accuracy&quot;</span></span>
<span id="cb443-25"><a href="stats_method.html#cb443-25" tabindex="-1"></a>    )</span>
<span id="cb443-26"><a href="stats_method.html#cb443-26" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb443-27"><a href="stats_method.html#cb443-27" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb443-28"><a href="stats_method.html#cb443-28" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb443-29"><a href="stats_method.html#cb443-29" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb443-30"><a href="stats_method.html#cb443-30" tabindex="-1"></a>    , <span class="at">strip.text.x =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">9</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb443-31"><a href="stats_method.html#cb443-31" tabindex="-1"></a>    , <span class="at">strip.text.y =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">7</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb443-32"><a href="stats_method.html#cb443-32" tabindex="-1"></a>    , <span class="at">axis.text.x =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">7</span>, <span class="at">angle =</span> <span class="dv">90</span>)</span>
<span id="cb443-33"><a href="stats_method.html#cb443-33" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-422-1.png" width="1008" /></p>
<p>let’s table the HDI of the optimal values</p>
<div class="sourceCode" id="cb444"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb444-1"><a href="stats_method.html#cb444-1" tabindex="-1"></a><span class="co"># summarize it</span></span>
<span id="cb444-2"><a href="stats_method.html#cb444-2" tabindex="-1"></a>best_balanced_accuracy_combos_long <span class="sc">%&gt;%</span> </span>
<span id="cb444-3"><a href="stats_method.html#cb444-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(method_input_data<span class="sc">==</span><span class="st">&quot;structural only&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb444-4"><a href="stats_method.html#cb444-4" tabindex="-1"></a>  <span class="co"># filter out accuracy metrics</span></span>
<span id="cb444-5"><a href="stats_method.html#cb444-5" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(name<span class="sc">!=</span><span class="st">&quot;f_score&quot;</span>, <span class="sc">!</span>stringr<span class="sc">::</span><span class="fu">str_ends</span>(name, <span class="st">&quot;_mape&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb444-6"><a href="stats_method.html#cb444-6" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(chm_res_m_desc,method_input_data,name) <span class="sc">%&gt;%</span> </span>
<span id="cb444-7"><a href="stats_method.html#cb444-7" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(</span>
<span id="cb444-8"><a href="stats_method.html#cb444-8" tabindex="-1"></a>    <span class="co"># get median_hdi</span></span>
<span id="cb444-9"><a href="stats_method.html#cb444-9" tabindex="-1"></a>    <span class="at">median_hdi_est =</span> tidybayes<span class="sc">::</span><span class="fu">median_hdci</span>(value)<span class="sc">$</span>y</span>
<span id="cb444-10"><a href="stats_method.html#cb444-10" tabindex="-1"></a>    , <span class="at">median_hdi_lower =</span> tidybayes<span class="sc">::</span><span class="fu">median_hdci</span>(value)<span class="sc">$</span>ymin</span>
<span id="cb444-11"><a href="stats_method.html#cb444-11" tabindex="-1"></a>    , <span class="at">median_hdi_upper =</span> tidybayes<span class="sc">::</span><span class="fu">median_hdci</span>(value)<span class="sc">$</span>ymax</span>
<span id="cb444-12"><a href="stats_method.html#cb444-12" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb444-13"><a href="stats_method.html#cb444-13" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb444-14"><a href="stats_method.html#cb444-14" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(dplyr<span class="sc">::</span><span class="fu">across</span>(</span>
<span id="cb444-15"><a href="stats_method.html#cb444-15" tabindex="-1"></a>    tidyselect<span class="sc">::</span><span class="fu">starts_with</span>(<span class="st">&quot;median_hdi&quot;</span>)</span>
<span id="cb444-16"><a href="stats_method.html#cb444-16" tabindex="-1"></a>    , <span class="sc">~</span>dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb444-17"><a href="stats_method.html#cb444-17" tabindex="-1"></a>      name <span class="sc">==</span> <span class="st">&quot;spectral_weight&quot;</span> <span class="sc">~</span> scales<span class="sc">::</span><span class="fu">comma</span>(.x,<span class="at">accuracy=</span><span class="dv">1</span>)</span>
<span id="cb444-18"><a href="stats_method.html#cb444-18" tabindex="-1"></a>      , T <span class="sc">~</span>scales<span class="sc">::</span><span class="fu">comma</span>(.x,<span class="at">accuracy=</span>.<span class="dv">01</span>)</span>
<span id="cb444-19"><a href="stats_method.html#cb444-19" tabindex="-1"></a>    )</span>
<span id="cb444-20"><a href="stats_method.html#cb444-20" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb444-21"><a href="stats_method.html#cb444-21" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>method_input_data) <span class="sc">%&gt;%</span> </span>
<span id="cb444-22"><a href="stats_method.html#cb444-22" tabindex="-1"></a>  <span class="co"># table it</span></span>
<span id="cb444-23"><a href="stats_method.html#cb444-23" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kbl</span>(</span>
<span id="cb444-24"><a href="stats_method.html#cb444-24" tabindex="-1"></a>    <span class="at">caption =</span> <span class="fu">paste0</span>(</span>
<span id="cb444-25"><a href="stats_method.html#cb444-25" tabindex="-1"></a>      <span class="st">&quot;Structural only&quot;</span></span>
<span id="cb444-26"><a href="stats_method.html#cb444-26" tabindex="-1"></a>      , <span class="st">&quot;&lt;br&gt;predicted optimal parameter settings based on both detection and quantification accuracy&quot;</span></span>
<span id="cb444-27"><a href="stats_method.html#cb444-27" tabindex="-1"></a>    )</span>
<span id="cb444-28"><a href="stats_method.html#cb444-28" tabindex="-1"></a>    , <span class="at">col.names =</span> <span class="fu">c</span>(</span>
<span id="cb444-29"><a href="stats_method.html#cb444-29" tabindex="-1"></a>      <span class="st">&quot;CHM resolution&quot;</span>, <span class="st">&quot;parameter&quot;</span></span>
<span id="cb444-30"><a href="stats_method.html#cb444-30" tabindex="-1"></a>      , <span class="fu">c</span>(<span class="st">&quot;median&quot;</span>, <span class="st">&quot;HDI low&quot;</span>, <span class="st">&quot;HDI high&quot;</span>)</span>
<span id="cb444-31"><a href="stats_method.html#cb444-31" tabindex="-1"></a>    )</span>
<span id="cb444-32"><a href="stats_method.html#cb444-32" tabindex="-1"></a>    , <span class="at">escape =</span> F</span>
<span id="cb444-33"><a href="stats_method.html#cb444-33" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb444-34"><a href="stats_method.html#cb444-34" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kable_styling</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb444-35"><a href="stats_method.html#cb444-35" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">collapse_rows</span>(<span class="at">columns =</span> <span class="dv">1</span>, <span class="at">valign =</span> <span class="st">&quot;top&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb444-36"><a href="stats_method.html#cb444-36" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">add_header_above</span>(<span class="fu">c</span>(</span>
<span id="cb444-37"><a href="stats_method.html#cb444-37" tabindex="-1"></a>    <span class="st">&quot; &quot;</span><span class="ot">=</span><span class="dv">2</span></span>
<span id="cb444-38"><a href="stats_method.html#cb444-38" tabindex="-1"></a>    , <span class="st">&quot;optimal setting&quot;</span> <span class="ot">=</span> <span class="dv">3</span></span>
<span id="cb444-39"><a href="stats_method.html#cb444-39" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb444-40"><a href="stats_method.html#cb444-40" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">scroll_box</span>(<span class="at">height =</span> <span class="st">&quot;8in&quot;</span>)</span></code></pre></div>
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:8in; ">
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-423">Table 9.25: </span>Structural only<br>predicted optimal parameter settings based on both detection and quantification accuracy
</caption>
<thead>
<tr>
<th style="empty-cells: hide;border-bottom:hidden;position: sticky; top:0; background-color: #FFFFFF;" colspan="2">
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; position: sticky; top:0; background-color: #FFFFFF;" colspan="3">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
optimal setting
</div>
</th>
</tr>
<tr>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
CHM resolution
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
parameter
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
median
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
HDI low
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
HDI high
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="3">
0.1m CHM
</td>
<td style="text-align:left;">
circle_fit_iou_pct
</td>
<td style="text-align:left;">
0.38
</td>
<td style="text-align:left;">
0.36
</td>
<td style="text-align:left;">
0.38
</td>
</tr>
<tr>
<td style="text-align:left;">
convexity_pct
</td>
<td style="text-align:left;">
0.16
</td>
<td style="text-align:left;">
0.14
</td>
<td style="text-align:left;">
0.18
</td>
</tr>
<tr>
<td style="text-align:left;">
spectral_weight
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
0
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="3">
0.15m CHM
</td>
<td style="text-align:left;">
circle_fit_iou_pct
</td>
<td style="text-align:left;">
0.40
</td>
<td style="text-align:left;">
0.38
</td>
<td style="text-align:left;">
0.40
</td>
</tr>
<tr>
<td style="text-align:left;">
convexity_pct
</td>
<td style="text-align:left;">
0.22
</td>
<td style="text-align:left;">
0.18
</td>
<td style="text-align:left;">
0.24
</td>
</tr>
<tr>
<td style="text-align:left;">
spectral_weight
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
0
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="3">
0.2m CHM
</td>
<td style="text-align:left;">
circle_fit_iou_pct
</td>
<td style="text-align:left;">
0.40
</td>
<td style="text-align:left;">
0.40
</td>
<td style="text-align:left;">
0.42
</td>
</tr>
<tr>
<td style="text-align:left;">
convexity_pct
</td>
<td style="text-align:left;">
0.26
</td>
<td style="text-align:left;">
0.22
</td>
<td style="text-align:left;">
0.28
</td>
</tr>
<tr>
<td style="text-align:left;">
spectral_weight
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
0
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="3">
0.25m CHM
</td>
<td style="text-align:left;">
circle_fit_iou_pct
</td>
<td style="text-align:left;">
0.40
</td>
<td style="text-align:left;">
0.40
</td>
<td style="text-align:left;">
0.42
</td>
</tr>
<tr>
<td style="text-align:left;">
convexity_pct
</td>
<td style="text-align:left;">
0.30
</td>
<td style="text-align:left;">
0.30
</td>
<td style="text-align:left;">
0.32
</td>
</tr>
<tr>
<td style="text-align:left;">
spectral_weight
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
0
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="3">
0.3m CHM
</td>
<td style="text-align:left;">
circle_fit_iou_pct
</td>
<td style="text-align:left;">
0.38
</td>
<td style="text-align:left;">
0.36
</td>
<td style="text-align:left;">
0.38
</td>
</tr>
<tr>
<td style="text-align:left;">
convexity_pct
</td>
<td style="text-align:left;">
0.38
</td>
<td style="text-align:left;">
0.36
</td>
<td style="text-align:left;">
0.40
</td>
</tr>
<tr>
<td style="text-align:left;">
spectral_weight
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
0
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="3">
0.35m CHM
</td>
<td style="text-align:left;">
circle_fit_iou_pct
</td>
<td style="text-align:left;">
0.36
</td>
<td style="text-align:left;">
0.34
</td>
<td style="text-align:left;">
0.36
</td>
</tr>
<tr>
<td style="text-align:left;">
convexity_pct
</td>
<td style="text-align:left;">
0.46
</td>
<td style="text-align:left;">
0.44
</td>
<td style="text-align:left;">
0.48
</td>
</tr>
<tr>
<td style="text-align:left;">
spectral_weight
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
0
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="3">
0.4m CHM
</td>
<td style="text-align:left;">
circle_fit_iou_pct
</td>
<td style="text-align:left;">
0.34
</td>
<td style="text-align:left;">
0.34
</td>
<td style="text-align:left;">
0.36
</td>
</tr>
<tr>
<td style="text-align:left;">
convexity_pct
</td>
<td style="text-align:left;">
0.48
</td>
<td style="text-align:left;">
0.48
</td>
<td style="text-align:left;">
0.50
</td>
</tr>
<tr>
<td style="text-align:left;">
spectral_weight
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
0
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="3">
0.45m CHM
</td>
<td style="text-align:left;">
circle_fit_iou_pct
</td>
<td style="text-align:left;">
0.34
</td>
<td style="text-align:left;">
0.34
</td>
<td style="text-align:left;">
0.36
</td>
</tr>
<tr>
<td style="text-align:left;">
convexity_pct
</td>
<td style="text-align:left;">
0.52
</td>
<td style="text-align:left;">
0.52
</td>
<td style="text-align:left;">
0.54
</td>
</tr>
<tr>
<td style="text-align:left;">
spectral_weight
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
0
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="3">
0.5m CHM
</td>
<td style="text-align:left;">
circle_fit_iou_pct
</td>
<td style="text-align:left;">
0.34
</td>
<td style="text-align:left;">
0.34
</td>
<td style="text-align:left;">
0.34
</td>
</tr>
<tr>
<td style="text-align:left;">
convexity_pct
</td>
<td style="text-align:left;">
0.56
</td>
<td style="text-align:left;">
0.56
</td>
<td style="text-align:left;">
0.58
</td>
</tr>
<tr>
<td style="text-align:left;">
spectral_weight
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
0
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div id="posterior-distribution-of-accuracy-1" class="section level4 hasAnchor" number="9.4.3.2">
<h4><span class="header-section-number">9.4.3.2</span> Posterior distribution of accuracy<a href="stats_method.html#posterior-distribution-of-accuracy-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>what can we expect from a detection and form quantification accuracy perspective?</p>
<div id="data-fusion-2" class="section level5 hasAnchor" number="9.4.3.2.1">
<h5><span class="header-section-number">9.4.3.2.1</span> Data Fusion<a href="stats_method.html#data-fusion-2" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>let’s start with the data fusion approach which assumes users have RGB data to complement the structural CHM data</p>
<div class="sourceCode" id="cb445"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb445-1"><a href="stats_method.html#cb445-1" tabindex="-1"></a><span class="co"># plot it</span></span>
<span id="cb445-2"><a href="stats_method.html#cb445-2" tabindex="-1"></a>best_balanced_accuracy_combos_long <span class="sc">%&gt;%</span> </span>
<span id="cb445-3"><a href="stats_method.html#cb445-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(method_input_data<span class="sc">==</span><span class="st">&quot;structural+spectral&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb445-4"><a href="stats_method.html#cb445-4" tabindex="-1"></a>  <span class="co"># filter out accuracy metrics</span></span>
<span id="cb445-5"><a href="stats_method.html#cb445-5" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(name<span class="sc">==</span><span class="st">&quot;f_score&quot;</span> <span class="sc">|</span> stringr<span class="sc">::</span><span class="fu">str_ends</span>(name, <span class="st">&quot;_mape&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb445-6"><a href="stats_method.html#cb445-6" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb445-7"><a href="stats_method.html#cb445-7" tabindex="-1"></a>    <span class="at">name =</span> name <span class="sc">%&gt;%</span> </span>
<span id="cb445-8"><a href="stats_method.html#cb445-8" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_replace_all</span>(<span class="st">&quot;_mape&quot;</span>, <span class="st">&quot;_MAPE&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb445-9"><a href="stats_method.html#cb445-9" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_replace_all</span>(<span class="st">&quot;f_score&quot;</span>, <span class="st">&quot;F-score&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb445-10"><a href="stats_method.html#cb445-10" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_replace_all</span>(<span class="st">&quot;_&quot;</span>, <span class="st">&quot; &quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb445-11"><a href="stats_method.html#cb445-11" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_squish</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb445-12"><a href="stats_method.html#cb445-12" tabindex="-1"></a>      <span class="fu">factor</span>(<span class="at">ordered =</span> T) <span class="sc">%&gt;%</span> </span>
<span id="cb445-13"><a href="stats_method.html#cb445-13" tabindex="-1"></a>      forcats<span class="sc">::</span><span class="fu">fct_relevel</span>(<span class="st">&quot;F-score&quot;</span>)</span>
<span id="cb445-14"><a href="stats_method.html#cb445-14" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb445-15"><a href="stats_method.html#cb445-15" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> value)) <span class="sc">+</span></span>
<span id="cb445-16"><a href="stats_method.html#cb445-16" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">stat_dotsinterval</span>(</span>
<span id="cb445-17"><a href="stats_method.html#cb445-17" tabindex="-1"></a>    <span class="at">point_interval =</span> <span class="st">&quot;median_hdci&quot;</span>, <span class="at">.width =</span> <span class="fu">c</span>(<span class="fl">0.95</span>)</span>
<span id="cb445-18"><a href="stats_method.html#cb445-18" tabindex="-1"></a>    , <span class="at">quantiles =</span> <span class="dv">100</span></span>
<span id="cb445-19"><a href="stats_method.html#cb445-19" tabindex="-1"></a>    , <span class="at">point_size =</span> <span class="dv">3</span> </span>
<span id="cb445-20"><a href="stats_method.html#cb445-20" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb445-21"><a href="stats_method.html#cb445-21" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">facet_grid</span>(</span>
<span id="cb445-22"><a href="stats_method.html#cb445-22" tabindex="-1"></a>    <span class="at">rows =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(chm_res_m_desc)</span>
<span id="cb445-23"><a href="stats_method.html#cb445-23" tabindex="-1"></a>    , <span class="at">cols =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(name)</span>
<span id="cb445-24"><a href="stats_method.html#cb445-24" tabindex="-1"></a>    , <span class="at">scales =</span> <span class="st">&quot;free_x&quot;</span></span>
<span id="cb445-25"><a href="stats_method.html#cb445-25" tabindex="-1"></a>    , <span class="at">axes =</span> <span class="st">&quot;all_x&quot;</span></span>
<span id="cb445-26"><a href="stats_method.html#cb445-26" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb445-27"><a href="stats_method.html#cb445-27" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb445-28"><a href="stats_method.html#cb445-28" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_x_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>percent) <span class="sc">+</span></span>
<span id="cb445-29"><a href="stats_method.html#cb445-29" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb445-30"><a href="stats_method.html#cb445-30" tabindex="-1"></a>    <span class="at">x=</span><span class="st">&quot;&quot;</span></span>
<span id="cb445-31"><a href="stats_method.html#cb445-31" tabindex="-1"></a>    , <span class="at">subtitle =</span> <span class="fu">paste0</span>(</span>
<span id="cb445-32"><a href="stats_method.html#cb445-32" tabindex="-1"></a>     <span class="st">&quot;Data Fusion (structural+spectral)&quot;</span></span>
<span id="cb445-33"><a href="stats_method.html#cb445-33" tabindex="-1"></a>     , <span class="st">&quot;</span><span class="sc">\n</span><span class="st">predicted pile detection and form quantification accuracy metrics&quot;</span></span>
<span id="cb445-34"><a href="stats_method.html#cb445-34" tabindex="-1"></a>     , <span class="st">&quot;</span><span class="sc">\n</span><span class="st">using optimal parameter settings based on both detection and quantification accuracy&quot;</span></span>
<span id="cb445-35"><a href="stats_method.html#cb445-35" tabindex="-1"></a>    )</span>
<span id="cb445-36"><a href="stats_method.html#cb445-36" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb445-37"><a href="stats_method.html#cb445-37" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb445-38"><a href="stats_method.html#cb445-38" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb445-39"><a href="stats_method.html#cb445-39" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb445-40"><a href="stats_method.html#cb445-40" tabindex="-1"></a>    , <span class="at">strip.text.x =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">9</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb445-41"><a href="stats_method.html#cb445-41" tabindex="-1"></a>    , <span class="at">strip.text.y =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">7</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb445-42"><a href="stats_method.html#cb445-42" tabindex="-1"></a>    , <span class="at">axis.text.x =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">7</span>, <span class="at">angle =</span> <span class="dv">90</span>)</span>
<span id="cb445-43"><a href="stats_method.html#cb445-43" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-424-1.png" width="1008" /></p>
<p>let’s table the HDI of the predicted accuracy metrics</p>
<div class="sourceCode" id="cb446"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb446-1"><a href="stats_method.html#cb446-1" tabindex="-1"></a><span class="co"># summarize it</span></span>
<span id="cb446-2"><a href="stats_method.html#cb446-2" tabindex="-1"></a>best_balanced_accuracy_combos_long <span class="sc">%&gt;%</span> </span>
<span id="cb446-3"><a href="stats_method.html#cb446-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(method_input_data<span class="sc">==</span><span class="st">&quot;structural+spectral&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb446-4"><a href="stats_method.html#cb446-4" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb446-5"><a href="stats_method.html#cb446-5" tabindex="-1"></a>  <span class="co"># filter for accuracy metrics</span></span>
<span id="cb446-6"><a href="stats_method.html#cb446-6" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(name<span class="sc">==</span><span class="st">&quot;f_score&quot;</span> <span class="sc">|</span> stringr<span class="sc">::</span><span class="fu">str_ends</span>(name, <span class="st">&quot;_mape&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb446-7"><a href="stats_method.html#cb446-7" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb446-8"><a href="stats_method.html#cb446-8" tabindex="-1"></a>    <span class="at">name =</span> name <span class="sc">%&gt;%</span> </span>
<span id="cb446-9"><a href="stats_method.html#cb446-9" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_replace_all</span>(<span class="st">&quot;_mape&quot;</span>, <span class="st">&quot;_MAPE&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb446-10"><a href="stats_method.html#cb446-10" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_replace_all</span>(<span class="st">&quot;f_score&quot;</span>, <span class="st">&quot;F-score&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb446-11"><a href="stats_method.html#cb446-11" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_replace_all</span>(<span class="st">&quot;_&quot;</span>, <span class="st">&quot; &quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb446-12"><a href="stats_method.html#cb446-12" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_squish</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb446-13"><a href="stats_method.html#cb446-13" tabindex="-1"></a>      <span class="fu">factor</span>(<span class="at">ordered =</span> T) <span class="sc">%&gt;%</span> </span>
<span id="cb446-14"><a href="stats_method.html#cb446-14" tabindex="-1"></a>      forcats<span class="sc">::</span><span class="fu">fct_relevel</span>(<span class="st">&quot;F-score&quot;</span>)</span>
<span id="cb446-15"><a href="stats_method.html#cb446-15" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb446-16"><a href="stats_method.html#cb446-16" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(chm_res_m_desc, method_input_data, name) <span class="sc">%&gt;%</span> </span>
<span id="cb446-17"><a href="stats_method.html#cb446-17" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(</span>
<span id="cb446-18"><a href="stats_method.html#cb446-18" tabindex="-1"></a>    <span class="co"># get median_hdi</span></span>
<span id="cb446-19"><a href="stats_method.html#cb446-19" tabindex="-1"></a>    <span class="at">median_hdi_est =</span> tidybayes<span class="sc">::</span><span class="fu">median_hdci</span>(value)<span class="sc">$</span>y</span>
<span id="cb446-20"><a href="stats_method.html#cb446-20" tabindex="-1"></a>    , <span class="at">median_hdi_lower =</span> tidybayes<span class="sc">::</span><span class="fu">median_hdci</span>(value)<span class="sc">$</span>ymin</span>
<span id="cb446-21"><a href="stats_method.html#cb446-21" tabindex="-1"></a>    , <span class="at">median_hdi_upper =</span> tidybayes<span class="sc">::</span><span class="fu">median_hdci</span>(value)<span class="sc">$</span>ymax</span>
<span id="cb446-22"><a href="stats_method.html#cb446-22" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb446-23"><a href="stats_method.html#cb446-23" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb446-24"><a href="stats_method.html#cb446-24" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(dplyr<span class="sc">::</span><span class="fu">across</span>(</span>
<span id="cb446-25"><a href="stats_method.html#cb446-25" tabindex="-1"></a>    tidyselect<span class="sc">::</span><span class="fu">starts_with</span>(<span class="st">&quot;median_hdi&quot;</span>)</span>
<span id="cb446-26"><a href="stats_method.html#cb446-26" tabindex="-1"></a>    , <span class="sc">~</span> scales<span class="sc">::</span><span class="fu">percent</span>(.x,<span class="at">accuracy=</span>.<span class="dv">1</span>)</span>
<span id="cb446-27"><a href="stats_method.html#cb446-27" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb446-28"><a href="stats_method.html#cb446-28" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>method_input_data) <span class="sc">%&gt;%</span> </span>
<span id="cb446-29"><a href="stats_method.html#cb446-29" tabindex="-1"></a>  <span class="co"># table it</span></span>
<span id="cb446-30"><a href="stats_method.html#cb446-30" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kbl</span>(</span>
<span id="cb446-31"><a href="stats_method.html#cb446-31" tabindex="-1"></a>    <span class="at">caption =</span> <span class="fu">paste0</span>(</span>
<span id="cb446-32"><a href="stats_method.html#cb446-32" tabindex="-1"></a>     <span class="st">&quot;Data Fusion (structural+spectral)&quot;</span></span>
<span id="cb446-33"><a href="stats_method.html#cb446-33" tabindex="-1"></a>     , <span class="st">&quot;&lt;br&gt;predicted pile detection and form quantification accuracy metrics&quot;</span></span>
<span id="cb446-34"><a href="stats_method.html#cb446-34" tabindex="-1"></a>     , <span class="st">&quot;&lt;br&gt;using optimal parameter settings based on both detection and quantification accuracy&quot;</span></span>
<span id="cb446-35"><a href="stats_method.html#cb446-35" tabindex="-1"></a>    )</span>
<span id="cb446-36"><a href="stats_method.html#cb446-36" tabindex="-1"></a>    , <span class="at">col.names =</span> <span class="fu">c</span>(</span>
<span id="cb446-37"><a href="stats_method.html#cb446-37" tabindex="-1"></a>      <span class="st">&quot;CHM Resolution&quot;</span>, <span class="st">&quot;metric&quot;</span></span>
<span id="cb446-38"><a href="stats_method.html#cb446-38" tabindex="-1"></a>      , <span class="fu">c</span>(<span class="st">&quot;median&quot;</span>, <span class="st">&quot;HDI low&quot;</span>, <span class="st">&quot;HDI high&quot;</span>)</span>
<span id="cb446-39"><a href="stats_method.html#cb446-39" tabindex="-1"></a>    )</span>
<span id="cb446-40"><a href="stats_method.html#cb446-40" tabindex="-1"></a>    , <span class="at">escape =</span> F</span>
<span id="cb446-41"><a href="stats_method.html#cb446-41" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb446-42"><a href="stats_method.html#cb446-42" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kable_styling</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb446-43"><a href="stats_method.html#cb446-43" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">collapse_rows</span>(<span class="at">columns =</span> <span class="dv">1</span>, <span class="at">valign =</span> <span class="st">&quot;top&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb446-44"><a href="stats_method.html#cb446-44" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">add_header_above</span>(<span class="fu">c</span>(</span>
<span id="cb446-45"><a href="stats_method.html#cb446-45" tabindex="-1"></a>    <span class="st">&quot; &quot;</span><span class="ot">=</span><span class="dv">2</span></span>
<span id="cb446-46"><a href="stats_method.html#cb446-46" tabindex="-1"></a>    , <span class="st">&quot;predicted value&quot;</span> <span class="ot">=</span> <span class="dv">3</span></span>
<span id="cb446-47"><a href="stats_method.html#cb446-47" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb446-48"><a href="stats_method.html#cb446-48" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">scroll_box</span>(<span class="at">height =</span> <span class="st">&quot;8in&quot;</span>)</span></code></pre></div>
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:8in; ">
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-425">Table 9.26: </span>Data Fusion (structural+spectral)<br>predicted pile detection and form quantification accuracy metrics<br>using optimal parameter settings based on both detection and quantification accuracy
</caption>
<thead>
<tr>
<th style="empty-cells: hide;border-bottom:hidden;position: sticky; top:0; background-color: #FFFFFF;" colspan="2">
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; position: sticky; top:0; background-color: #FFFFFF;" colspan="3">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
predicted value
</div>
</th>
</tr>
<tr>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
CHM Resolution
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
metric
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
median
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
HDI low
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
HDI high
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="3">
0.1m CHM
</td>
<td style="text-align:left;">
F-score
</td>
<td style="text-align:left;">
83.5%
</td>
<td style="text-align:left;">
82.7%
</td>
<td style="text-align:left;">
84.9%
</td>
</tr>
<tr>
<td style="text-align:left;">
diameter MAPE
</td>
<td style="text-align:left;">
10.9%
</td>
<td style="text-align:left;">
10.7%
</td>
<td style="text-align:left;">
11.2%
</td>
</tr>
<tr>
<td style="text-align:left;">
height MAPE
</td>
<td style="text-align:left;">
15.5%
</td>
<td style="text-align:left;">
15.3%
</td>
<td style="text-align:left;">
15.7%
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="3">
0.15m CHM
</td>
<td style="text-align:left;">
F-score
</td>
<td style="text-align:left;">
80.3%
</td>
<td style="text-align:left;">
79.7%
</td>
<td style="text-align:left;">
82.3%
</td>
</tr>
<tr>
<td style="text-align:left;">
diameter MAPE
</td>
<td style="text-align:left;">
14.1%
</td>
<td style="text-align:left;">
13.9%
</td>
<td style="text-align:left;">
15.0%
</td>
</tr>
<tr>
<td style="text-align:left;">
height MAPE
</td>
<td style="text-align:left;">
15.3%
</td>
<td style="text-align:left;">
15.2%
</td>
<td style="text-align:left;">
15.4%
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="3">
0.2m CHM
</td>
<td style="text-align:left;">
F-score
</td>
<td style="text-align:left;">
77.3%
</td>
<td style="text-align:left;">
76.6%
</td>
<td style="text-align:left;">
80.7%
</td>
</tr>
<tr>
<td style="text-align:left;">
diameter MAPE
</td>
<td style="text-align:left;">
17.8%
</td>
<td style="text-align:left;">
17.6%
</td>
<td style="text-align:left;">
18.8%
</td>
</tr>
<tr>
<td style="text-align:left;">
height MAPE
</td>
<td style="text-align:left;">
15.4%
</td>
<td style="text-align:left;">
15.2%
</td>
<td style="text-align:left;">
15.5%
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="3">
0.25m CHM
</td>
<td style="text-align:left;">
F-score
</td>
<td style="text-align:left;">
75.1%
</td>
<td style="text-align:left;">
74.1%
</td>
<td style="text-align:left;">
79.2%
</td>
</tr>
<tr>
<td style="text-align:left;">
diameter MAPE
</td>
<td style="text-align:left;">
21.9%
</td>
<td style="text-align:left;">
21.7%
</td>
<td style="text-align:left;">
23.1%
</td>
</tr>
<tr>
<td style="text-align:left;">
height MAPE
</td>
<td style="text-align:left;">
15.6%
</td>
<td style="text-align:left;">
15.5%
</td>
<td style="text-align:left;">
15.7%
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="3">
0.3m CHM
</td>
<td style="text-align:left;">
F-score
</td>
<td style="text-align:left;">
74.6%
</td>
<td style="text-align:left;">
72.9%
</td>
<td style="text-align:left;">
77.8%
</td>
</tr>
<tr>
<td style="text-align:left;">
diameter MAPE
</td>
<td style="text-align:left;">
26.8%
</td>
<td style="text-align:left;">
26.4%
</td>
<td style="text-align:left;">
27.8%
</td>
</tr>
<tr>
<td style="text-align:left;">
height MAPE
</td>
<td style="text-align:left;">
15.9%
</td>
<td style="text-align:left;">
15.8%
</td>
<td style="text-align:left;">
16.0%
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="3">
0.35m CHM
</td>
<td style="text-align:left;">
F-score
</td>
<td style="text-align:left;">
69.2%
</td>
<td style="text-align:left;">
67.7%
</td>
<td style="text-align:left;">
73.0%
</td>
</tr>
<tr>
<td style="text-align:left;">
diameter MAPE
</td>
<td style="text-align:left;">
31.3%
</td>
<td style="text-align:left;">
30.8%
</td>
<td style="text-align:left;">
32.3%
</td>
</tr>
<tr>
<td style="text-align:left;">
height MAPE
</td>
<td style="text-align:left;">
16.2%
</td>
<td style="text-align:left;">
16.1%
</td>
<td style="text-align:left;">
16.3%
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="3">
0.4m CHM
</td>
<td style="text-align:left;">
F-score
</td>
<td style="text-align:left;">
67.0%
</td>
<td style="text-align:left;">
65.1%
</td>
<td style="text-align:left;">
69.1%
</td>
</tr>
<tr>
<td style="text-align:left;">
diameter MAPE
</td>
<td style="text-align:left;">
35.7%
</td>
<td style="text-align:left;">
35.2%
</td>
<td style="text-align:left;">
36.0%
</td>
</tr>
<tr>
<td style="text-align:left;">
height MAPE
</td>
<td style="text-align:left;">
16.7%
</td>
<td style="text-align:left;">
16.5%
</td>
<td style="text-align:left;">
16.8%
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="3">
0.45m CHM
</td>
<td style="text-align:left;">
F-score
</td>
<td style="text-align:left;">
66.1%
</td>
<td style="text-align:left;">
64.5%
</td>
<td style="text-align:left;">
67.3%
</td>
</tr>
<tr>
<td style="text-align:left;">
diameter MAPE
</td>
<td style="text-align:left;">
39.5%
</td>
<td style="text-align:left;">
39.1%
</td>
<td style="text-align:left;">
39.9%
</td>
</tr>
<tr>
<td style="text-align:left;">
height MAPE
</td>
<td style="text-align:left;">
17.4%
</td>
<td style="text-align:left;">
17.2%
</td>
<td style="text-align:left;">
17.5%
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="3">
0.5m CHM
</td>
<td style="text-align:left;">
F-score
</td>
<td style="text-align:left;">
63.9%
</td>
<td style="text-align:left;">
62.8%
</td>
<td style="text-align:left;">
65.1%
</td>
</tr>
<tr>
<td style="text-align:left;">
diameter MAPE
</td>
<td style="text-align:left;">
42.3%
</td>
<td style="text-align:left;">
41.7%
</td>
<td style="text-align:left;">
42.8%
</td>
</tr>
<tr>
<td style="text-align:left;">
height MAPE
</td>
<td style="text-align:left;">
18.2%
</td>
<td style="text-align:left;">
18.0%
</td>
<td style="text-align:left;">
18.4%
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="structural-only-2" class="section level5 hasAnchor" number="9.4.3.2.2">
<h5><span class="header-section-number">9.4.3.2.2</span> Structural only<a href="stats_method.html#structural-only-2" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>now we’ll consider an approach that only uses structural data without the benefit of supplemental spectral data</p>
<div class="sourceCode" id="cb447"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb447-1"><a href="stats_method.html#cb447-1" tabindex="-1"></a><span class="co"># plot it</span></span>
<span id="cb447-2"><a href="stats_method.html#cb447-2" tabindex="-1"></a>best_balanced_accuracy_combos_long <span class="sc">%&gt;%</span> </span>
<span id="cb447-3"><a href="stats_method.html#cb447-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(method_input_data<span class="sc">==</span><span class="st">&quot;structural only&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb447-4"><a href="stats_method.html#cb447-4" tabindex="-1"></a>  <span class="co"># filter out accuracy metrics</span></span>
<span id="cb447-5"><a href="stats_method.html#cb447-5" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(name<span class="sc">==</span><span class="st">&quot;f_score&quot;</span> <span class="sc">|</span> stringr<span class="sc">::</span><span class="fu">str_ends</span>(name, <span class="st">&quot;_mape&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb447-6"><a href="stats_method.html#cb447-6" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb447-7"><a href="stats_method.html#cb447-7" tabindex="-1"></a>    <span class="at">name =</span> name <span class="sc">%&gt;%</span> </span>
<span id="cb447-8"><a href="stats_method.html#cb447-8" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_replace_all</span>(<span class="st">&quot;_mape&quot;</span>, <span class="st">&quot;_MAPE&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb447-9"><a href="stats_method.html#cb447-9" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_replace_all</span>(<span class="st">&quot;f_score&quot;</span>, <span class="st">&quot;F-score&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb447-10"><a href="stats_method.html#cb447-10" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_replace_all</span>(<span class="st">&quot;_&quot;</span>, <span class="st">&quot; &quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb447-11"><a href="stats_method.html#cb447-11" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_squish</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb447-12"><a href="stats_method.html#cb447-12" tabindex="-1"></a>      <span class="fu">factor</span>(<span class="at">ordered =</span> T) <span class="sc">%&gt;%</span> </span>
<span id="cb447-13"><a href="stats_method.html#cb447-13" tabindex="-1"></a>      forcats<span class="sc">::</span><span class="fu">fct_relevel</span>(<span class="st">&quot;F-score&quot;</span>)</span>
<span id="cb447-14"><a href="stats_method.html#cb447-14" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb447-15"><a href="stats_method.html#cb447-15" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> value)) <span class="sc">+</span></span>
<span id="cb447-16"><a href="stats_method.html#cb447-16" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">stat_dotsinterval</span>(</span>
<span id="cb447-17"><a href="stats_method.html#cb447-17" tabindex="-1"></a>    <span class="at">point_interval =</span> <span class="st">&quot;median_hdci&quot;</span>, <span class="at">.width =</span> <span class="fu">c</span>(<span class="fl">0.95</span>)</span>
<span id="cb447-18"><a href="stats_method.html#cb447-18" tabindex="-1"></a>    , <span class="at">quantiles =</span> <span class="dv">100</span></span>
<span id="cb447-19"><a href="stats_method.html#cb447-19" tabindex="-1"></a>    , <span class="at">point_size =</span> <span class="dv">3</span> </span>
<span id="cb447-20"><a href="stats_method.html#cb447-20" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb447-21"><a href="stats_method.html#cb447-21" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">facet_grid</span>(</span>
<span id="cb447-22"><a href="stats_method.html#cb447-22" tabindex="-1"></a>    <span class="at">rows =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(chm_res_m_desc)</span>
<span id="cb447-23"><a href="stats_method.html#cb447-23" tabindex="-1"></a>    , <span class="at">cols =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(name)</span>
<span id="cb447-24"><a href="stats_method.html#cb447-24" tabindex="-1"></a>    , <span class="at">scales =</span> <span class="st">&quot;free_x&quot;</span></span>
<span id="cb447-25"><a href="stats_method.html#cb447-25" tabindex="-1"></a>    , <span class="at">axes =</span> <span class="st">&quot;all_x&quot;</span></span>
<span id="cb447-26"><a href="stats_method.html#cb447-26" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb447-27"><a href="stats_method.html#cb447-27" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb447-28"><a href="stats_method.html#cb447-28" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_x_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>percent) <span class="sc">+</span></span>
<span id="cb447-29"><a href="stats_method.html#cb447-29" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb447-30"><a href="stats_method.html#cb447-30" tabindex="-1"></a>    <span class="at">x=</span><span class="st">&quot;&quot;</span></span>
<span id="cb447-31"><a href="stats_method.html#cb447-31" tabindex="-1"></a>    , <span class="at">subtitle =</span> <span class="fu">paste0</span>(</span>
<span id="cb447-32"><a href="stats_method.html#cb447-32" tabindex="-1"></a>     <span class="st">&quot;Structural only&quot;</span></span>
<span id="cb447-33"><a href="stats_method.html#cb447-33" tabindex="-1"></a>     , <span class="st">&quot;</span><span class="sc">\n</span><span class="st">predicted pile detection and form quantification accuracy metrics&quot;</span></span>
<span id="cb447-34"><a href="stats_method.html#cb447-34" tabindex="-1"></a>     , <span class="st">&quot;</span><span class="sc">\n</span><span class="st">using optimal parameter settings based on both detection and quantification accuracy&quot;</span></span>
<span id="cb447-35"><a href="stats_method.html#cb447-35" tabindex="-1"></a>    )</span>
<span id="cb447-36"><a href="stats_method.html#cb447-36" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb447-37"><a href="stats_method.html#cb447-37" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb447-38"><a href="stats_method.html#cb447-38" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb447-39"><a href="stats_method.html#cb447-39" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb447-40"><a href="stats_method.html#cb447-40" tabindex="-1"></a>    , <span class="at">strip.text.x =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">9</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb447-41"><a href="stats_method.html#cb447-41" tabindex="-1"></a>    , <span class="at">strip.text.y =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">7</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb447-42"><a href="stats_method.html#cb447-42" tabindex="-1"></a>    , <span class="at">axis.text.x =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">7</span>, <span class="at">angle =</span> <span class="dv">90</span>)</span>
<span id="cb447-43"><a href="stats_method.html#cb447-43" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-426-1.png" width="1008" /></p>
<p>let’s table the HDI of the predicted accuracy metrics</p>
<div class="sourceCode" id="cb448"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb448-1"><a href="stats_method.html#cb448-1" tabindex="-1"></a><span class="co"># summarize it</span></span>
<span id="cb448-2"><a href="stats_method.html#cb448-2" tabindex="-1"></a>best_balanced_accuracy_combos_long <span class="sc">%&gt;%</span> </span>
<span id="cb448-3"><a href="stats_method.html#cb448-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(method_input_data<span class="sc">==</span><span class="st">&quot;structural only&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb448-4"><a href="stats_method.html#cb448-4" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb448-5"><a href="stats_method.html#cb448-5" tabindex="-1"></a>  <span class="co"># filter for accuracy metrics</span></span>
<span id="cb448-6"><a href="stats_method.html#cb448-6" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(name<span class="sc">==</span><span class="st">&quot;f_score&quot;</span> <span class="sc">|</span> stringr<span class="sc">::</span><span class="fu">str_ends</span>(name, <span class="st">&quot;_mape&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb448-7"><a href="stats_method.html#cb448-7" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb448-8"><a href="stats_method.html#cb448-8" tabindex="-1"></a>    <span class="at">name =</span> name <span class="sc">%&gt;%</span> </span>
<span id="cb448-9"><a href="stats_method.html#cb448-9" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_replace_all</span>(<span class="st">&quot;_mape&quot;</span>, <span class="st">&quot;_MAPE&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb448-10"><a href="stats_method.html#cb448-10" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_replace_all</span>(<span class="st">&quot;f_score&quot;</span>, <span class="st">&quot;F-score&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb448-11"><a href="stats_method.html#cb448-11" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_replace_all</span>(<span class="st">&quot;_&quot;</span>, <span class="st">&quot; &quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb448-12"><a href="stats_method.html#cb448-12" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_squish</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb448-13"><a href="stats_method.html#cb448-13" tabindex="-1"></a>      <span class="fu">factor</span>(<span class="at">ordered =</span> T) <span class="sc">%&gt;%</span> </span>
<span id="cb448-14"><a href="stats_method.html#cb448-14" tabindex="-1"></a>      forcats<span class="sc">::</span><span class="fu">fct_relevel</span>(<span class="st">&quot;F-score&quot;</span>)</span>
<span id="cb448-15"><a href="stats_method.html#cb448-15" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb448-16"><a href="stats_method.html#cb448-16" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(chm_res_m_desc, method_input_data, name) <span class="sc">%&gt;%</span> </span>
<span id="cb448-17"><a href="stats_method.html#cb448-17" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(</span>
<span id="cb448-18"><a href="stats_method.html#cb448-18" tabindex="-1"></a>    <span class="co"># get median_hdi</span></span>
<span id="cb448-19"><a href="stats_method.html#cb448-19" tabindex="-1"></a>    <span class="at">median_hdi_est =</span> tidybayes<span class="sc">::</span><span class="fu">median_hdci</span>(value)<span class="sc">$</span>y</span>
<span id="cb448-20"><a href="stats_method.html#cb448-20" tabindex="-1"></a>    , <span class="at">median_hdi_lower =</span> tidybayes<span class="sc">::</span><span class="fu">median_hdci</span>(value)<span class="sc">$</span>ymin</span>
<span id="cb448-21"><a href="stats_method.html#cb448-21" tabindex="-1"></a>    , <span class="at">median_hdi_upper =</span> tidybayes<span class="sc">::</span><span class="fu">median_hdci</span>(value)<span class="sc">$</span>ymax</span>
<span id="cb448-22"><a href="stats_method.html#cb448-22" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb448-23"><a href="stats_method.html#cb448-23" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb448-24"><a href="stats_method.html#cb448-24" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(dplyr<span class="sc">::</span><span class="fu">across</span>(</span>
<span id="cb448-25"><a href="stats_method.html#cb448-25" tabindex="-1"></a>    tidyselect<span class="sc">::</span><span class="fu">starts_with</span>(<span class="st">&quot;median_hdi&quot;</span>)</span>
<span id="cb448-26"><a href="stats_method.html#cb448-26" tabindex="-1"></a>    , <span class="sc">~</span> scales<span class="sc">::</span><span class="fu">percent</span>(.x,<span class="at">accuracy=</span>.<span class="dv">1</span>)</span>
<span id="cb448-27"><a href="stats_method.html#cb448-27" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb448-28"><a href="stats_method.html#cb448-28" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>method_input_data) <span class="sc">%&gt;%</span> </span>
<span id="cb448-29"><a href="stats_method.html#cb448-29" tabindex="-1"></a>  <span class="co"># table it</span></span>
<span id="cb448-30"><a href="stats_method.html#cb448-30" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kbl</span>(</span>
<span id="cb448-31"><a href="stats_method.html#cb448-31" tabindex="-1"></a>    <span class="at">caption =</span> <span class="fu">paste0</span>(</span>
<span id="cb448-32"><a href="stats_method.html#cb448-32" tabindex="-1"></a>     <span class="st">&quot;Structural only&quot;</span></span>
<span id="cb448-33"><a href="stats_method.html#cb448-33" tabindex="-1"></a>     , <span class="st">&quot;&lt;br&gt;predicted pile detection and form quantification accuracy metrics&quot;</span></span>
<span id="cb448-34"><a href="stats_method.html#cb448-34" tabindex="-1"></a>     , <span class="st">&quot;&lt;br&gt;using optimal parameter settings based on both detection and quantification accuracy&quot;</span></span>
<span id="cb448-35"><a href="stats_method.html#cb448-35" tabindex="-1"></a>    )</span>
<span id="cb448-36"><a href="stats_method.html#cb448-36" tabindex="-1"></a>    , <span class="at">col.names =</span> <span class="fu">c</span>(</span>
<span id="cb448-37"><a href="stats_method.html#cb448-37" tabindex="-1"></a>      <span class="st">&quot;CHM Resolution&quot;</span>, <span class="st">&quot;metric&quot;</span></span>
<span id="cb448-38"><a href="stats_method.html#cb448-38" tabindex="-1"></a>      , <span class="fu">c</span>(<span class="st">&quot;median&quot;</span>, <span class="st">&quot;HDI low&quot;</span>, <span class="st">&quot;HDI high&quot;</span>)</span>
<span id="cb448-39"><a href="stats_method.html#cb448-39" tabindex="-1"></a>    )</span>
<span id="cb448-40"><a href="stats_method.html#cb448-40" tabindex="-1"></a>    , <span class="at">escape =</span> F</span>
<span id="cb448-41"><a href="stats_method.html#cb448-41" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb448-42"><a href="stats_method.html#cb448-42" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kable_styling</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb448-43"><a href="stats_method.html#cb448-43" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">collapse_rows</span>(<span class="at">columns =</span> <span class="dv">1</span>, <span class="at">valign =</span> <span class="st">&quot;top&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb448-44"><a href="stats_method.html#cb448-44" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">add_header_above</span>(<span class="fu">c</span>(</span>
<span id="cb448-45"><a href="stats_method.html#cb448-45" tabindex="-1"></a>    <span class="st">&quot; &quot;</span><span class="ot">=</span><span class="dv">2</span></span>
<span id="cb448-46"><a href="stats_method.html#cb448-46" tabindex="-1"></a>    , <span class="st">&quot;predicted value&quot;</span> <span class="ot">=</span> <span class="dv">3</span></span>
<span id="cb448-47"><a href="stats_method.html#cb448-47" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb448-48"><a href="stats_method.html#cb448-48" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">scroll_box</span>(<span class="at">height =</span> <span class="st">&quot;8in&quot;</span>)</span></code></pre></div>
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:8in; ">
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-427">Table 9.27: </span>Structural only<br>predicted pile detection and form quantification accuracy metrics<br>using optimal parameter settings based on both detection and quantification accuracy
</caption>
<thead>
<tr>
<th style="empty-cells: hide;border-bottom:hidden;position: sticky; top:0; background-color: #FFFFFF;" colspan="2">
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; position: sticky; top:0; background-color: #FFFFFF;" colspan="3">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
predicted value
</div>
</th>
</tr>
<tr>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
CHM Resolution
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
metric
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
median
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
HDI low
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
HDI high
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="3">
0.1m CHM
</td>
<td style="text-align:left;">
F-score
</td>
<td style="text-align:left;">
82.4%
</td>
<td style="text-align:left;">
81.7%
</td>
<td style="text-align:left;">
83.2%
</td>
</tr>
<tr>
<td style="text-align:left;">
diameter MAPE
</td>
<td style="text-align:left;">
11.0%
</td>
<td style="text-align:left;">
10.8%
</td>
<td style="text-align:left;">
11.1%
</td>
</tr>
<tr>
<td style="text-align:left;">
height MAPE
</td>
<td style="text-align:left;">
16.0%
</td>
<td style="text-align:left;">
15.9%
</td>
<td style="text-align:left;">
16.2%
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="3">
0.15m CHM
</td>
<td style="text-align:left;">
F-score
</td>
<td style="text-align:left;">
79.1%
</td>
<td style="text-align:left;">
78.4%
</td>
<td style="text-align:left;">
79.9%
</td>
</tr>
<tr>
<td style="text-align:left;">
diameter MAPE
</td>
<td style="text-align:left;">
14.3%
</td>
<td style="text-align:left;">
14.1%
</td>
<td style="text-align:left;">
14.4%
</td>
</tr>
<tr>
<td style="text-align:left;">
height MAPE
</td>
<td style="text-align:left;">
15.7%
</td>
<td style="text-align:left;">
15.5%
</td>
<td style="text-align:left;">
15.8%
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="3">
0.2m CHM
</td>
<td style="text-align:left;">
F-score
</td>
<td style="text-align:left;">
75.9%
</td>
<td style="text-align:left;">
75.2%
</td>
<td style="text-align:left;">
76.6%
</td>
</tr>
<tr>
<td style="text-align:left;">
diameter MAPE
</td>
<td style="text-align:left;">
18.0%
</td>
<td style="text-align:left;">
17.9%
</td>
<td style="text-align:left;">
18.2%
</td>
</tr>
<tr>
<td style="text-align:left;">
height MAPE
</td>
<td style="text-align:left;">
15.6%
</td>
<td style="text-align:left;">
15.4%
</td>
<td style="text-align:left;">
15.7%
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="3">
0.25m CHM
</td>
<td style="text-align:left;">
F-score
</td>
<td style="text-align:left;">
72.9%
</td>
<td style="text-align:left;">
72.2%
</td>
<td style="text-align:left;">
73.5%
</td>
</tr>
<tr>
<td style="text-align:left;">
diameter MAPE
</td>
<td style="text-align:left;">
22.2%
</td>
<td style="text-align:left;">
22.0%
</td>
<td style="text-align:left;">
22.4%
</td>
</tr>
<tr>
<td style="text-align:left;">
height MAPE
</td>
<td style="text-align:left;">
15.7%
</td>
<td style="text-align:left;">
15.6%
</td>
<td style="text-align:left;">
15.8%
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="3">
0.3m CHM
</td>
<td style="text-align:left;">
F-score
</td>
<td style="text-align:left;">
70.2%
</td>
<td style="text-align:left;">
69.4%
</td>
<td style="text-align:left;">
70.7%
</td>
</tr>
<tr>
<td style="text-align:left;">
diameter MAPE
</td>
<td style="text-align:left;">
26.8%
</td>
<td style="text-align:left;">
26.6%
</td>
<td style="text-align:left;">
27.1%
</td>
</tr>
<tr>
<td style="text-align:left;">
height MAPE
</td>
<td style="text-align:left;">
16.0%
</td>
<td style="text-align:left;">
15.9%
</td>
<td style="text-align:left;">
16.1%
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="3">
0.35m CHM
</td>
<td style="text-align:left;">
F-score
</td>
<td style="text-align:left;">
67.0%
</td>
<td style="text-align:left;">
66.2%
</td>
<td style="text-align:left;">
67.6%
</td>
</tr>
<tr>
<td style="text-align:left;">
diameter MAPE
</td>
<td style="text-align:left;">
31.4%
</td>
<td style="text-align:left;">
31.1%
</td>
<td style="text-align:left;">
31.7%
</td>
</tr>
<tr>
<td style="text-align:left;">
height MAPE
</td>
<td style="text-align:left;">
16.4%
</td>
<td style="text-align:left;">
16.3%
</td>
<td style="text-align:left;">
16.5%
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="3">
0.4m CHM
</td>
<td style="text-align:left;">
F-score
</td>
<td style="text-align:left;">
64.3%
</td>
<td style="text-align:left;">
63.4%
</td>
<td style="text-align:left;">
65.1%
</td>
</tr>
<tr>
<td style="text-align:left;">
diameter MAPE
</td>
<td style="text-align:left;">
35.8%
</td>
<td style="text-align:left;">
35.5%
</td>
<td style="text-align:left;">
36.2%
</td>
</tr>
<tr>
<td style="text-align:left;">
height MAPE
</td>
<td style="text-align:left;">
17.0%
</td>
<td style="text-align:left;">
16.9%
</td>
<td style="text-align:left;">
17.2%
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="3">
0.45m CHM
</td>
<td style="text-align:left;">
F-score
</td>
<td style="text-align:left;">
61.8%
</td>
<td style="text-align:left;">
60.8%
</td>
<td style="text-align:left;">
62.8%
</td>
</tr>
<tr>
<td style="text-align:left;">
diameter MAPE
</td>
<td style="text-align:left;">
39.8%
</td>
<td style="text-align:left;">
39.3%
</td>
<td style="text-align:left;">
40.2%
</td>
</tr>
<tr>
<td style="text-align:left;">
height MAPE
</td>
<td style="text-align:left;">
17.9%
</td>
<td style="text-align:left;">
17.8%
</td>
<td style="text-align:left;">
18.1%
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="3">
0.5m CHM
</td>
<td style="text-align:left;">
F-score
</td>
<td style="text-align:left;">
59.8%
</td>
<td style="text-align:left;">
58.5%
</td>
<td style="text-align:left;">
61.0%
</td>
</tr>
<tr>
<td style="text-align:left;">
diameter MAPE
</td>
<td style="text-align:left;">
43.0%
</td>
<td style="text-align:left;">
42.5%
</td>
<td style="text-align:left;">
43.6%
</td>
</tr>
<tr>
<td style="text-align:left;">
height MAPE
</td>
<td style="text-align:left;">
19.1%
</td>
<td style="text-align:left;">
18.9%
</td>
<td style="text-align:left;">
19.3%
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</div>
<div id="training_detect_final" class="section level2 hasAnchor" number="9.5">
<h2><span class="header-section-number">9.5</span> Balanced Accuracy Validation<a href="stats_method.html#training_detect_final" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>let’s test these optimal settings on the actual data to see how close our model came to properly predicting the accuracies. we’ll test using the data fusion method since we have the RGB data</p>
<div id="detection" class="section level3 hasAnchor" number="9.5.1">
<h3><span class="header-section-number">9.5.1</span> Detection<a href="stats_method.html#detection" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>remember the optimal parameter settings we identified assuming we have spectral data for a data fusion approach? we’ll use those settings for the structural parameters and set the <code>spectral_weight</code> parameter to the lower end of it’s 95% HDI to be less restrictive with the spectral filtering (e.g. if HDI includes ‘4’ and ‘5’, use ‘4’) while maintaining high anticipated accuracy because these HDI’s include the full range of optimal settings based on our balanced accuracy.</p>
<div class="sourceCode" id="cb449"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb449-1"><a href="stats_method.html#cb449-1" tabindex="-1"></a><span class="co"># remember the optimal_param_settings!</span></span>
<span id="cb449-2"><a href="stats_method.html#cb449-2" tabindex="-1"></a>optimal_temp <span class="ot">&lt;-</span> </span>
<span id="cb449-3"><a href="stats_method.html#cb449-3" tabindex="-1"></a>  optimal_param_settings <span class="sc">%&gt;%</span></span>
<span id="cb449-4"><a href="stats_method.html#cb449-4" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(method_input_data <span class="sc">==</span> <span class="st">&quot;structural+spectral&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb449-5"><a href="stats_method.html#cb449-5" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb449-6"><a href="stats_method.html#cb449-6" tabindex="-1"></a>    <span class="at">median_hdi_est =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb449-7"><a href="stats_method.html#cb449-7" tabindex="-1"></a>      name <span class="sc">==</span> <span class="st">&quot;spectral_weight&quot;</span> <span class="sc">~</span> median_hdi_lower</span>
<span id="cb449-8"><a href="stats_method.html#cb449-8" tabindex="-1"></a>      , T <span class="sc">~</span> median_hdi_est</span>
<span id="cb449-9"><a href="stats_method.html#cb449-9" tabindex="-1"></a>    )</span>
<span id="cb449-10"><a href="stats_method.html#cb449-10" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb449-11"><a href="stats_method.html#cb449-11" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(name,median_hdi_est) <span class="sc">%&gt;%</span> </span>
<span id="cb449-12"><a href="stats_method.html#cb449-12" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_wider</span>(<span class="at">names_from =</span> name, <span class="at">values_from =</span> median_hdi_est) <span class="sc">%&gt;%</span> </span>
<span id="cb449-13"><a href="stats_method.html#cb449-13" tabindex="-1"></a>  <span class="co"># add on the fixed values</span></span>
<span id="cb449-14"><a href="stats_method.html#cb449-14" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">bind_cols</span>(</span>
<span id="cb449-15"><a href="stats_method.html#cb449-15" tabindex="-1"></a>    structural_params_settings <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(max_ht_m,max_area_m2)</span>
<span id="cb449-16"><a href="stats_method.html#cb449-16" tabindex="-1"></a>  )</span>
<span id="cb449-17"><a href="stats_method.html#cb449-17" tabindex="-1"></a><span class="co"># huh?</span></span>
<span id="cb449-18"><a href="stats_method.html#cb449-18" tabindex="-1"></a>optimal_temp <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">glimpse</span>()</span></code></pre></div>
<pre><code>## Rows: 1
## Columns: 6
## $ chm_res_m          &lt;dbl&gt; 0.1
## $ circle_fit_iou_pct &lt;dbl&gt; 0.46
## $ convexity_pct      &lt;dbl&gt; 0.08
## $ spectral_weight    &lt;dbl&gt; 4
## $ max_ht_m           &lt;dbl&gt; 2.3
## $ max_area_m2        &lt;dbl&gt; 46</code></pre>
<p>first, we need to read in the CHM data at the optimal resolution as predicted by the model</p>
<div class="sourceCode" id="cb451"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb451-1"><a href="stats_method.html#cb451-1" tabindex="-1"></a><span class="co"># set chm res</span></span>
<span id="cb451-2"><a href="stats_method.html#cb451-2" tabindex="-1"></a>chm_res_m_temp <span class="ot">&lt;-</span> optimal_temp<span class="sc">$</span>chm_res_m</span>
<span id="cb451-3"><a href="stats_method.html#cb451-3" tabindex="-1"></a>dir_temp <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&quot;../data/point_cloud_processing_delivery_chm&quot;</span>,chm_res_m_temp,<span class="st">&quot;m&quot;</span>)</span>
<span id="cb451-4"><a href="stats_method.html#cb451-4" tabindex="-1"></a><span class="co"># do it</span></span>
<span id="cb451-5"><a href="stats_method.html#cb451-5" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">dir.exists</span>(dir_temp)){</span>
<span id="cb451-6"><a href="stats_method.html#cb451-6" tabindex="-1"></a>  <span class="co"># cloud2trees</span></span>
<span id="cb451-7"><a href="stats_method.html#cb451-7" tabindex="-1"></a>  cloud2raster_ans <span class="ot">&lt;-</span> cloud2trees<span class="sc">::</span><span class="fu">cloud2raster</span>(</span>
<span id="cb451-8"><a href="stats_method.html#cb451-8" tabindex="-1"></a>    <span class="at">output_dir =</span> <span class="st">&quot;../data&quot;</span></span>
<span id="cb451-9"><a href="stats_method.html#cb451-9" tabindex="-1"></a>    , <span class="at">input_las_dir =</span> <span class="st">&quot;f:</span><span class="sc">\\</span><span class="st">PFDP_Data</span><span class="sc">\\</span><span class="st">p4pro_images</span><span class="sc">\\</span><span class="st">P4Pro_06_17_2021_half_half_optimal</span><span class="sc">\\</span><span class="st">2_densification</span><span class="sc">\\</span><span class="st">point_cloud&quot;</span></span>
<span id="cb451-10"><a href="stats_method.html#cb451-10" tabindex="-1"></a>    , <span class="at">accuracy_level =</span> <span class="dv">2</span></span>
<span id="cb451-11"><a href="stats_method.html#cb451-11" tabindex="-1"></a>    , <span class="at">keep_intrmdt =</span> T</span>
<span id="cb451-12"><a href="stats_method.html#cb451-12" tabindex="-1"></a>    , <span class="at">dtm_res_m =</span> <span class="fl">0.25</span></span>
<span id="cb451-13"><a href="stats_method.html#cb451-13" tabindex="-1"></a>    , <span class="at">chm_res_m =</span> chm_res_m_temp</span>
<span id="cb451-14"><a href="stats_method.html#cb451-14" tabindex="-1"></a>    , <span class="at">min_height =</span> <span class="dv">0</span> <span class="co"># effectively generates a DSM based on non-ground points</span></span>
<span id="cb451-15"><a href="stats_method.html#cb451-15" tabindex="-1"></a>  )</span>
<span id="cb451-16"><a href="stats_method.html#cb451-16" tabindex="-1"></a>  <span class="co"># rename</span></span>
<span id="cb451-17"><a href="stats_method.html#cb451-17" tabindex="-1"></a>  <span class="fu">file.rename</span>(<span class="at">from =</span> <span class="st">&quot;../data/point_cloud_processing_delivery&quot;</span>, <span class="at">to =</span> dir_temp)</span>
<span id="cb451-18"><a href="stats_method.html#cb451-18" tabindex="-1"></a>}<span class="cf">else</span>{</span>
<span id="cb451-19"><a href="stats_method.html#cb451-19" tabindex="-1"></a>  dtm_temp <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rast</span>( <span class="fu">file.path</span>(dir_temp, <span class="st">&quot;dtm_0.25m.tif&quot;</span>) )</span>
<span id="cb451-20"><a href="stats_method.html#cb451-20" tabindex="-1"></a>  chm_temp <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rast</span>( <span class="fu">file.path</span>(dir_temp, <span class="fu">paste0</span>(<span class="st">&quot;chm_&quot;</span>, chm_res_m_temp,<span class="st">&quot;m.tif&quot;</span>)) )</span>
<span id="cb451-21"><a href="stats_method.html#cb451-21" tabindex="-1"></a>  </span>
<span id="cb451-22"><a href="stats_method.html#cb451-22" tabindex="-1"></a>  cloud2raster_ans <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb451-23"><a href="stats_method.html#cb451-23" tabindex="-1"></a>    <span class="st">&quot;dtm_rast&quot;</span> <span class="ot">=</span> dtm_temp</span>
<span id="cb451-24"><a href="stats_method.html#cb451-24" tabindex="-1"></a>    , <span class="st">&quot;chm_rast&quot;</span> <span class="ot">=</span> chm_temp</span>
<span id="cb451-25"><a href="stats_method.html#cb451-25" tabindex="-1"></a>  )</span>
<span id="cb451-26"><a href="stats_method.html#cb451-26" tabindex="-1"></a>}</span></code></pre></div>
<p>we’ll only work with the CHM in the study unit boundary plus a buffer to limit the amount of data we process</p>
<div class="sourceCode" id="cb452"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb452-1"><a href="stats_method.html#cb452-1" tabindex="-1"></a>chm_rast_temp <span class="ot">&lt;-</span> cloud2raster_ans<span class="sc">$</span>chm_rast <span class="sc">%&gt;%</span> </span>
<span id="cb452-2"><a href="stats_method.html#cb452-2" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">crop</span>(</span>
<span id="cb452-3"><a href="stats_method.html#cb452-3" tabindex="-1"></a>    stand_boundary <span class="sc">%&gt;%</span> </span>
<span id="cb452-4"><a href="stats_method.html#cb452-4" tabindex="-1"></a>      sf<span class="sc">::</span><span class="fu">st_buffer</span>(<span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb452-5"><a href="stats_method.html#cb452-5" tabindex="-1"></a>      terra<span class="sc">::</span><span class="fu">vect</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb452-6"><a href="stats_method.html#cb452-6" tabindex="-1"></a>      terra<span class="sc">::</span><span class="fu">project</span>(terra<span class="sc">::</span><span class="fu">crs</span>(cloud2raster_ans<span class="sc">$</span>chm_rast))</span>
<span id="cb452-7"><a href="stats_method.html#cb452-7" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb452-8"><a href="stats_method.html#cb452-8" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">mask</span>(</span>
<span id="cb452-9"><a href="stats_method.html#cb452-9" tabindex="-1"></a>    stand_boundary <span class="sc">%&gt;%</span> </span>
<span id="cb452-10"><a href="stats_method.html#cb452-10" tabindex="-1"></a>      sf<span class="sc">::</span><span class="fu">st_buffer</span>(<span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb452-11"><a href="stats_method.html#cb452-11" tabindex="-1"></a>      terra<span class="sc">::</span><span class="fu">vect</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb452-12"><a href="stats_method.html#cb452-12" tabindex="-1"></a>      terra<span class="sc">::</span><span class="fu">project</span>(terra<span class="sc">::</span><span class="fu">crs</span>(cloud2raster_ans<span class="sc">$</span>chm_rast))</span>
<span id="cb452-13"><a href="stats_method.html#cb452-13" tabindex="-1"></a>  )</span>
<span id="cb452-14"><a href="stats_method.html#cb452-14" tabindex="-1"></a><span class="co"># # huh?</span></span>
<span id="cb452-15"><a href="stats_method.html#cb452-15" tabindex="-1"></a><span class="co"># chm_rast_temp %&gt;%</span></span>
<span id="cb452-16"><a href="stats_method.html#cb452-16" tabindex="-1"></a><span class="co">#   terra::aggregate(fact = 2, na.rm=T) %&gt;%  #, fun = &quot;median&quot;, cores = lasR::half_cores(), na.rm = T) %&gt;%</span></span>
<span id="cb452-17"><a href="stats_method.html#cb452-17" tabindex="-1"></a><span class="co">#   terra::plot(col = viridis::plasma(100), axes = F)</span></span>
<span id="cb452-18"><a href="stats_method.html#cb452-18" tabindex="-1"></a><span class="co">#   terra::plot(</span></span>
<span id="cb452-19"><a href="stats_method.html#cb452-19" tabindex="-1"></a><span class="co">#     stand_boundary %&gt;%</span></span>
<span id="cb452-20"><a href="stats_method.html#cb452-20" tabindex="-1"></a><span class="co">#       terra::vect() %&gt;%</span></span>
<span id="cb452-21"><a href="stats_method.html#cb452-21" tabindex="-1"></a><span class="co">#       terra::project(terra::crs(cloud2raster_ans$chm_rast))</span></span>
<span id="cb452-22"><a href="stats_method.html#cb452-22" tabindex="-1"></a><span class="co">#     , add = T, border = &quot;black&quot;, col = NA, lwd = 1.2</span></span>
<span id="cb452-23"><a href="stats_method.html#cb452-23" tabindex="-1"></a><span class="co">#   )</span></span>
<span id="cb452-24"><a href="stats_method.html#cb452-24" tabindex="-1"></a><span class="co">#   terra::plot(</span></span>
<span id="cb452-25"><a href="stats_method.html#cb452-25" tabindex="-1"></a><span class="co">#     slash_piles_polys %&gt;%</span></span>
<span id="cb452-26"><a href="stats_method.html#cb452-26" tabindex="-1"></a><span class="co">#       terra::vect() %&gt;%</span></span>
<span id="cb452-27"><a href="stats_method.html#cb452-27" tabindex="-1"></a><span class="co">#       terra::project(terra::crs(cloud2raster_ans$chm_rast))</span></span>
<span id="cb452-28"><a href="stats_method.html#cb452-28" tabindex="-1"></a><span class="co">#     , add = T, border = &quot;blue&quot;, col = NA, lwd = 1.2</span></span>
<span id="cb452-29"><a href="stats_method.html#cb452-29" tabindex="-1"></a><span class="co">#   )</span></span></code></pre></div>
<p>we’re going to use our handy-dandy <code>slash_pile_detect_watershed()</code> function we defined in <a href="raster_watershed.html#slash_pile_detect_watershed">this earlier section</a>.</p>
<div class="sourceCode" id="cb453"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb453-1"><a href="stats_method.html#cb453-1" tabindex="-1"></a>outdir_temp <span class="ot">&lt;-</span> <span class="st">&quot;../data/PFDP_Data/PFDP_SlashPiles/&quot;</span></span>
<span id="cb453-2"><a href="stats_method.html#cb453-2" tabindex="-1"></a>fnm_temp <span class="ot">&lt;-</span> <span class="fu">file.path</span>(outdir_temp,<span class="st">&quot;structural_candidate_segments.gpkg&quot;</span>)</span>
<span id="cb453-3"><a href="stats_method.html#cb453-3" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(fnm_temp)){</span>
<span id="cb453-4"><a href="stats_method.html#cb453-4" tabindex="-1"></a>  <span class="fu">set.seed</span>(<span class="dv">77</span>)</span>
<span id="cb453-5"><a href="stats_method.html#cb453-5" tabindex="-1"></a>  slash_pile_detect_watershed_ans <span class="ot">&lt;-</span> <span class="fu">slash_pile_detect_watershed</span>(</span>
<span id="cb453-6"><a href="stats_method.html#cb453-6" tabindex="-1"></a>    <span class="at">chm_rast =</span> chm_rast_temp</span>
<span id="cb453-7"><a href="stats_method.html#cb453-7" tabindex="-1"></a>    <span class="do">#### height and area thresholds for the detected piles</span></span>
<span id="cb453-8"><a href="stats_method.html#cb453-8" tabindex="-1"></a>    <span class="co"># these should be based on data from the literature or expectations based on the prescription</span></span>
<span id="cb453-9"><a href="stats_method.html#cb453-9" tabindex="-1"></a>    , <span class="at">max_ht_m =</span> optimal_temp<span class="sc">$</span>max_ht_m <span class="co"># set the max expected pile height</span></span>
<span id="cb453-10"><a href="stats_method.html#cb453-10" tabindex="-1"></a>    , <span class="at">min_ht_m =</span> <span class="fl">0.5</span> <span class="co"># set the min expected pile height</span></span>
<span id="cb453-11"><a href="stats_method.html#cb453-11" tabindex="-1"></a>    , <span class="at">min_area_m2 =</span> <span class="dv">2</span> <span class="co"># set the min expected pile area # (5*0.3048)^2 = prescription minimum = 2.322 # ((5*0.95)*0.3048)^2 = 2.1 = 5% less than minimum</span></span>
<span id="cb453-12"><a href="stats_method.html#cb453-12" tabindex="-1"></a>    , <span class="at">max_area_m2 =</span> optimal_temp<span class="sc">$</span>max_area_m2 <span class="co"># set the max expected pile area</span></span>
<span id="cb453-13"><a href="stats_method.html#cb453-13" tabindex="-1"></a>    <span class="do">#### irregularity filtering</span></span>
<span id="cb453-14"><a href="stats_method.html#cb453-14" tabindex="-1"></a>    <span class="co"># 1 = perfectly convex (no inward angles); 0 = so many inward angles</span></span>
<span id="cb453-15"><a href="stats_method.html#cb453-15" tabindex="-1"></a>    <span class="co"># values closer to 1 remove more irregular segments; </span></span>
<span id="cb453-16"><a href="stats_method.html#cb453-16" tabindex="-1"></a>      <span class="co"># values closer to 0 keep more irregular segments (and also regular segments)</span></span>
<span id="cb453-17"><a href="stats_method.html#cb453-17" tabindex="-1"></a>    <span class="co"># these will all be further filtered for their circularity and later smoothed to remove blocky edges</span></span>
<span id="cb453-18"><a href="stats_method.html#cb453-18" tabindex="-1"></a>    <span class="co"># and most inward angles by applying a convex hull to the original detected segment</span></span>
<span id="cb453-19"><a href="stats_method.html#cb453-19" tabindex="-1"></a>    , <span class="at">convexity_pct =</span> optimal_temp<span class="sc">$</span>convexity_pct <span class="co"># min required overlap between the predicted pile and the convex hull of the predicted pile</span></span>
<span id="cb453-20"><a href="stats_method.html#cb453-20" tabindex="-1"></a>    <span class="do">#### circularity filtering</span></span>
<span id="cb453-21"><a href="stats_method.html#cb453-21" tabindex="-1"></a>    <span class="co"># 1 = perfectly circular; 0 = not circular (e.g. linear) but also circular</span></span>
<span id="cb453-22"><a href="stats_method.html#cb453-22" tabindex="-1"></a>    <span class="co"># min required IoU between the predicted pile and the best fit circle of the predicted pile</span></span>
<span id="cb453-23"><a href="stats_method.html#cb453-23" tabindex="-1"></a>    , <span class="at">circle_fit_iou_pct =</span> optimal_temp<span class="sc">$</span>circle_fit_iou_pct</span>
<span id="cb453-24"><a href="stats_method.html#cb453-24" tabindex="-1"></a>    <span class="do">#### shape refinement &amp; overlap removal</span></span>
<span id="cb453-25"><a href="stats_method.html#cb453-25" tabindex="-1"></a>    <span class="do">## smooth_segs = T ... convex hulls of raster detected segments are returned, any that overlap are removed</span></span>
<span id="cb453-26"><a href="stats_method.html#cb453-26" tabindex="-1"></a>    <span class="do">## smooth_segs = F ... raster detected segments are returned (blocky) if they meet all prior rules</span></span>
<span id="cb453-27"><a href="stats_method.html#cb453-27" tabindex="-1"></a>    , <span class="at">smooth_segs =</span> T</span>
<span id="cb453-28"><a href="stats_method.html#cb453-28" tabindex="-1"></a>  )</span>
<span id="cb453-29"><a href="stats_method.html#cb453-29" tabindex="-1"></a>  <span class="co"># save</span></span>
<span id="cb453-30"><a href="stats_method.html#cb453-30" tabindex="-1"></a>  slash_pile_detect_watershed_ans <span class="sc">%&gt;%</span> sf<span class="sc">::</span><span class="fu">st_write</span>(fnm_temp, <span class="at">append =</span> F)</span>
<span id="cb453-31"><a href="stats_method.html#cb453-31" tabindex="-1"></a>}<span class="cf">else</span>{</span>
<span id="cb453-32"><a href="stats_method.html#cb453-32" tabindex="-1"></a>  slash_pile_detect_watershed_ans <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_read</span>(fnm_temp, <span class="at">quiet=</span>T)</span>
<span id="cb453-33"><a href="stats_method.html#cb453-33" tabindex="-1"></a>}</span>
<span id="cb453-34"><a href="stats_method.html#cb453-34" tabindex="-1"></a><span class="co"># what did we get?</span></span>
<span id="cb453-35"><a href="stats_method.html#cb453-35" tabindex="-1"></a>slash_pile_detect_watershed_ans <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">glimpse</span>()</span></code></pre></div>
<pre><code>## Rows: 162
## Columns: 8
## $ pred_id         &lt;int&gt; 1, 2, 3, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17…
## $ area_m2         &lt;dbl&gt; 16.610, 40.330, 5.985, 8.365, 45.635, 18.900, 38.120, …
## $ volume_m3       &lt;dbl&gt; 10.676970, 40.098363, 5.079741, 9.044556, 46.122434, 1…
## $ max_height_m    &lt;dbl&gt; 2.235, 2.300, 2.219, 2.300, 2.300, 2.300, 2.300, 2.300…
## $ volume_per_area &lt;dbl&gt; 0.6428037, 0.9942565, 0.8487454, 1.0812380, 1.0106811,…
## $ pct_chull       &lt;dbl&gt; 0.6688742, 0.6020332, 0.7084378, 0.7136880, 0.7242248,…
## $ diameter_m      &lt;dbl&gt; 7.564390, 9.323626, 3.511410, 3.832754, 8.475848, 6.35…
## $ geom            &lt;POLYGON [m]&gt; POLYGON ((499475 4317902, 4..., POLYGON ((4994…</code></pre>
<p>Now we’ll filter the structurally-detected candidate slash piles using the RGB spectral data with the <code>polygon_spectral_filtering()</code> function we defined in <a href="data_fusion.html#polygon_spectral_filtering">this earlier section</a>. if you were wondering, yes, this function is also handy-dandy.</p>
<div class="sourceCode" id="cb455"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb455-1"><a href="stats_method.html#cb455-1" tabindex="-1"></a>final_predicted_slash_piles <span class="ot">&lt;-</span> <span class="fu">polygon_spectral_filtering</span>(</span>
<span id="cb455-2"><a href="stats_method.html#cb455-2" tabindex="-1"></a>  <span class="at">sf_data =</span> slash_pile_detect_watershed_ans</span>
<span id="cb455-3"><a href="stats_method.html#cb455-3" tabindex="-1"></a>  , <span class="at">rgb_rast =</span> ortho_rast</span>
<span id="cb455-4"><a href="stats_method.html#cb455-4" tabindex="-1"></a>  <span class="co"># define the band index</span></span>
<span id="cb455-5"><a href="stats_method.html#cb455-5" tabindex="-1"></a>  , <span class="at">red_band_idx =</span> <span class="dv">1</span></span>
<span id="cb455-6"><a href="stats_method.html#cb455-6" tabindex="-1"></a>  , <span class="at">green_band_idx =</span> <span class="dv">2</span></span>
<span id="cb455-7"><a href="stats_method.html#cb455-7" tabindex="-1"></a>  , <span class="at">blue_band_idx =</span> <span class="dv">3</span></span>
<span id="cb455-8"><a href="stats_method.html#cb455-8" tabindex="-1"></a>  <span class="co"># spectral weighting</span></span>
<span id="cb455-9"><a href="stats_method.html#cb455-9" tabindex="-1"></a>  , <span class="at">spectral_weight =</span> optimal_temp<span class="sc">$</span>spectral_weight</span>
<span id="cb455-10"><a href="stats_method.html#cb455-10" tabindex="-1"></a>)</span>
<span id="cb455-11"><a href="stats_method.html#cb455-11" tabindex="-1"></a><span class="co"># add is_in_stand</span></span>
<span id="cb455-12"><a href="stats_method.html#cb455-12" tabindex="-1"></a>final_predicted_slash_piles <span class="ot">&lt;-</span> final_predicted_slash_piles <span class="sc">%&gt;%</span> </span>
<span id="cb455-13"><a href="stats_method.html#cb455-13" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb455-14"><a href="stats_method.html#cb455-14" tabindex="-1"></a>    <span class="at">is_in_stand =</span> pred_id <span class="sc">%in%</span> (</span>
<span id="cb455-15"><a href="stats_method.html#cb455-15" tabindex="-1"></a>      final_predicted_slash_piles <span class="sc">%&gt;%</span> </span>
<span id="cb455-16"><a href="stats_method.html#cb455-16" tabindex="-1"></a>      sf<span class="sc">::</span><span class="fu">st_intersection</span>(stand_boundary <span class="sc">%&gt;%</span> sf<span class="sc">::</span><span class="fu">st_transform</span>(sf<span class="sc">::</span><span class="fu">st_crs</span>(final_predicted_slash_piles))) <span class="sc">%&gt;%</span> </span>
<span id="cb455-17"><a href="stats_method.html#cb455-17" tabindex="-1"></a>      sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb455-18"><a href="stats_method.html#cb455-18" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">pull</span>(pred_id)</span>
<span id="cb455-19"><a href="stats_method.html#cb455-19" tabindex="-1"></a>    )</span>
<span id="cb455-20"><a href="stats_method.html#cb455-20" tabindex="-1"></a>  )</span></code></pre></div>
<p>what did we get?</p>
<div class="sourceCode" id="cb456"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb456-1"><a href="stats_method.html#cb456-1" tabindex="-1"></a><span class="co"># huh?</span></span>
<span id="cb456-2"><a href="stats_method.html#cb456-2" tabindex="-1"></a>final_predicted_slash_piles <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">glimpse</span>()</span></code></pre></div>
<pre><code>## Rows: 138
## Columns: 24
## $ pred_id          &lt;int&gt; 1, 2, 6, 7, 8, 9, 10, 12, 13, 14, 15, 16, 17, 20, 23,…
## $ area_m2          &lt;dbl&gt; 16.610, 40.330, 45.635, 18.900, 38.120, 24.750, 27.76…
## $ volume_m3        &lt;dbl&gt; 10.676970, 40.098363, 46.122434, 16.298983, 44.237940…
## $ max_height_m     &lt;dbl&gt; 2.235, 2.300, 2.300, 2.300, 2.300, 2.300, 2.300, 2.29…
## $ volume_per_area  &lt;dbl&gt; 0.6428037, 0.9942565, 1.0106811, 0.8623801, 1.1604916…
## $ pct_chull        &lt;dbl&gt; 0.6688742, 0.6020332, 0.7242248, 0.6248677, 0.7678384…
## $ diameter_m       &lt;dbl&gt; 7.564390, 9.323626, 8.475848, 6.350591, 7.564390, 6.3…
## $ rast_agg_grvi    &lt;dbl&gt; 0.015843167, 0.019939091, -0.025123385, 0.025851542, …
## $ rast_agg_rgri    &lt;dbl&gt; 0.9688079, 0.9609014, 1.0515417, 0.9495998, 1.0410348…
## $ rast_agg_vdvi    &lt;dbl&gt; 0.057569480, 0.062395341, 0.005857862, -0.021179659, …
## $ rast_agg_rgbvi   &lt;dbl&gt; 0.11875952, 0.12856891, 0.01387664, -0.03608864, -0.0…
## $ rast_agg_exg     &lt;dbl&gt; 0.078261125, 0.084960841, 0.007825763, -0.028041575, …
## $ rast_agg_exr     &lt;dbl&gt; 0.12790022, 0.12446414, 0.15849203, 0.10745823, 0.148…
## $ rast_agg_exgr    &lt;dbl&gt; -0.050100114, -0.040813919, -0.150284529, -0.13186515…
## $ rast_agg_bi      &lt;dbl&gt; 0.37303904, 0.39702669, 0.53180724, 0.11501748, 0.455…
## $ rast_agg_sat     &lt;dbl&gt; 0.18757563, 0.20254081, 0.11597003, 0.15812179, 0.054…
## $ geom             &lt;POLYGON [m]&gt; POLYGON ((499475 4317902, 4..., POLYGON ((499…
## $ inrange_th_exgr  &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,…
## $ inrange_th_rgri  &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,…
## $ inrange_th_vdvi  &lt;dbl&gt; 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,…
## $ inrange_th_bi    &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 1, 1, 1,…
## $ inrange_th_sat   &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,…
## $ inrange_th_votes &lt;dbl&gt; 4, 4, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 4, 4, 5, 5, 5,…
## $ is_in_stand      &lt;lgl&gt; TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE,…</code></pre>
<div class="sourceCode" id="cb458"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb458-1"><a href="stats_method.html#cb458-1" tabindex="-1"></a><span class="co"># final_predicted_slash_piles %&gt;%</span></span>
<span id="cb458-2"><a href="stats_method.html#cb458-2" tabindex="-1"></a><span class="co">#   sf::st_drop_geometry() %&gt;% </span></span>
<span id="cb458-3"><a href="stats_method.html#cb458-3" tabindex="-1"></a><span class="co">#   dplyr::count(inrange_th_votes)</span></span></code></pre></div>
<p>how many piles were removed?</p>
<div class="sourceCode" id="cb459"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb459-1"><a href="stats_method.html#cb459-1" tabindex="-1"></a><span class="co"># how many piles were removed?</span></span>
<span id="cb459-2"><a href="stats_method.html#cb459-2" tabindex="-1"></a><span class="fu">nrow</span>(slash_pile_detect_watershed_ans)<span class="sc">-</span><span class="fu">nrow</span>(final_predicted_slash_piles)</span></code></pre></div>
<pre><code>## [1] 24</code></pre>
<div class="sourceCode" id="cb461"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb461-1"><a href="stats_method.html#cb461-1" tabindex="-1"></a><span class="co"># what proportion were removed?</span></span>
<span id="cb461-2"><a href="stats_method.html#cb461-2" tabindex="-1"></a>scales<span class="sc">::</span><span class="fu">percent</span>(</span>
<span id="cb461-3"><a href="stats_method.html#cb461-3" tabindex="-1"></a>  (<span class="fu">nrow</span>(slash_pile_detect_watershed_ans)<span class="sc">-</span><span class="fu">nrow</span>(final_predicted_slash_piles))<span class="sc">/</span><span class="fu">nrow</span>(slash_pile_detect_watershed_ans)</span>
<span id="cb461-4"><a href="stats_method.html#cb461-4" tabindex="-1"></a>  , <span class="at">accuracy=</span><span class="fl">0.1</span></span>
<span id="cb461-5"><a href="stats_method.html#cb461-5" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## [1] &quot;14.8%&quot;</code></pre>
</div>
<div id="instance-match-accuracy-assessment" class="section level3 hasAnchor" number="9.5.2">
<h3><span class="header-section-number">9.5.2</span> Instance Match &amp; Accuracy Assessment<a href="stats_method.html#instance-match-accuracy-assessment" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>now apply the instance matching process we outlined in this <a href="method-evaluation.html#iou_match">earlier section</a> to establish True Positives (TP), False Positives (FP, commissions), and False Negatives (FN, omissions)</p>
<div class="sourceCode" id="cb463"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb463-1"><a href="stats_method.html#cb463-1" tabindex="-1"></a><span class="co"># ground truth and prediction matching process</span></span>
<span id="cb463-2"><a href="stats_method.html#cb463-2" tabindex="-1"></a>ground_truth_prediction_match_ans <span class="ot">&lt;-</span> <span class="fu">ground_truth_prediction_match</span>(</span>
<span id="cb463-3"><a href="stats_method.html#cb463-3" tabindex="-1"></a>  <span class="at">ground_truth =</span> </span>
<span id="cb463-4"><a href="stats_method.html#cb463-4" tabindex="-1"></a>    slash_piles_polys <span class="sc">%&gt;%</span> </span>
<span id="cb463-5"><a href="stats_method.html#cb463-5" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(is_in_stand) <span class="sc">%&gt;%</span> </span>
<span id="cb463-6"><a href="stats_method.html#cb463-6" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">arrange</span>(<span class="fu">desc</span>(field_diameter_m)) <span class="sc">%&gt;%</span> </span>
<span id="cb463-7"><a href="stats_method.html#cb463-7" tabindex="-1"></a>    sf<span class="sc">::</span><span class="fu">st_transform</span>(sf<span class="sc">::</span><span class="fu">st_crs</span>(final_predicted_slash_piles))</span>
<span id="cb463-8"><a href="stats_method.html#cb463-8" tabindex="-1"></a>  , <span class="at">gt_id =</span> <span class="st">&quot;pile_id&quot;</span></span>
<span id="cb463-9"><a href="stats_method.html#cb463-9" tabindex="-1"></a>  , <span class="at">predictions =</span> final_predicted_slash_piles <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(is_in_stand)</span>
<span id="cb463-10"><a href="stats_method.html#cb463-10" tabindex="-1"></a>  , <span class="at">pred_id =</span> <span class="st">&quot;pred_id&quot;</span></span>
<span id="cb463-11"><a href="stats_method.html#cb463-11" tabindex="-1"></a>  , <span class="at">min_iou_pct =</span> <span class="fl">0.05</span></span>
<span id="cb463-12"><a href="stats_method.html#cb463-12" tabindex="-1"></a>)</span>
<span id="cb463-13"><a href="stats_method.html#cb463-13" tabindex="-1"></a><span class="co"># add data from gt and pred piles</span></span>
<span id="cb463-14"><a href="stats_method.html#cb463-14" tabindex="-1"></a>ground_truth_prediction_match_ans <span class="ot">&lt;-</span></span>
<span id="cb463-15"><a href="stats_method.html#cb463-15" tabindex="-1"></a>  ground_truth_prediction_match_ans <span class="sc">%&gt;%</span> </span>
<span id="cb463-16"><a href="stats_method.html#cb463-16" tabindex="-1"></a>  <span class="co"># add area of gt</span></span>
<span id="cb463-17"><a href="stats_method.html#cb463-17" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(</span>
<span id="cb463-18"><a href="stats_method.html#cb463-18" tabindex="-1"></a>    slash_piles_polys <span class="sc">%&gt;%</span> </span>
<span id="cb463-19"><a href="stats_method.html#cb463-19" tabindex="-1"></a>      sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb463-20"><a href="stats_method.html#cb463-20" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">filter</span>(is_in_stand) <span class="sc">%&gt;%</span> </span>
<span id="cb463-21"><a href="stats_method.html#cb463-21" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb463-22"><a href="stats_method.html#cb463-22" tabindex="-1"></a>        pile_id</span>
<span id="cb463-23"><a href="stats_method.html#cb463-23" tabindex="-1"></a>        , image_gt_area_m2</span>
<span id="cb463-24"><a href="stats_method.html#cb463-24" tabindex="-1"></a>        , image_gt_diameter_m</span>
<span id="cb463-25"><a href="stats_method.html#cb463-25" tabindex="-1"></a>        , field_gt_volume_m3</span>
<span id="cb463-26"><a href="stats_method.html#cb463-26" tabindex="-1"></a>        , height_m</span>
<span id="cb463-27"><a href="stats_method.html#cb463-27" tabindex="-1"></a>        , field_diameter_m</span>
<span id="cb463-28"><a href="stats_method.html#cb463-28" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span> </span>
<span id="cb463-29"><a href="stats_method.html#cb463-29" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">rename</span>(</span>
<span id="cb463-30"><a href="stats_method.html#cb463-30" tabindex="-1"></a>        <span class="at">gt_height_m =</span> height_m</span>
<span id="cb463-31"><a href="stats_method.html#cb463-31" tabindex="-1"></a>        , <span class="at">gt_diameter_m =</span> field_diameter_m</span>
<span id="cb463-32"><a href="stats_method.html#cb463-32" tabindex="-1"></a>        , <span class="at">gt_area_m2 =</span> image_gt_area_m2</span>
<span id="cb463-33"><a href="stats_method.html#cb463-33" tabindex="-1"></a>        , <span class="at">gt_volume_m3 =</span> field_gt_volume_m3</span>
<span id="cb463-34"><a href="stats_method.html#cb463-34" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span> </span>
<span id="cb463-35"><a href="stats_method.html#cb463-35" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">pile_id=</span><span class="fu">as.numeric</span>(pile_id))</span>
<span id="cb463-36"><a href="stats_method.html#cb463-36" tabindex="-1"></a>    , <span class="at">by =</span> <span class="st">&quot;pile_id&quot;</span></span>
<span id="cb463-37"><a href="stats_method.html#cb463-37" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb463-38"><a href="stats_method.html#cb463-38" tabindex="-1"></a>  <span class="co"># add info from predictions</span></span>
<span id="cb463-39"><a href="stats_method.html#cb463-39" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(</span>
<span id="cb463-40"><a href="stats_method.html#cb463-40" tabindex="-1"></a>    slash_pile_detect_watershed_ans <span class="sc">%&gt;%</span></span>
<span id="cb463-41"><a href="stats_method.html#cb463-41" tabindex="-1"></a>      sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span></span>
<span id="cb463-42"><a href="stats_method.html#cb463-42" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb463-43"><a href="stats_method.html#cb463-43" tabindex="-1"></a>        pred_id</span>
<span id="cb463-44"><a href="stats_method.html#cb463-44" tabindex="-1"></a>        , area_m2, volume_m3, max_height_m, diameter_m</span>
<span id="cb463-45"><a href="stats_method.html#cb463-45" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span> </span>
<span id="cb463-46"><a href="stats_method.html#cb463-46" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">rename</span>(</span>
<span id="cb463-47"><a href="stats_method.html#cb463-47" tabindex="-1"></a>        <span class="at">pred_area_m2 =</span> area_m2, <span class="at">pred_volume_m3 =</span> volume_m3</span>
<span id="cb463-48"><a href="stats_method.html#cb463-48" tabindex="-1"></a>        , <span class="at">pred_height_m =</span> max_height_m, <span class="at">pred_diameter_m =</span> diameter_m</span>
<span id="cb463-49"><a href="stats_method.html#cb463-49" tabindex="-1"></a>      )</span>
<span id="cb463-50"><a href="stats_method.html#cb463-50" tabindex="-1"></a>    , <span class="at">by =</span> dplyr<span class="sc">::</span><span class="fu">join_by</span>(pred_id)</span>
<span id="cb463-51"><a href="stats_method.html#cb463-51" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb463-52"><a href="stats_method.html#cb463-52" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb463-53"><a href="stats_method.html#cb463-53" tabindex="-1"></a>    <span class="do">### calculate these based on the formulas below...agg_ground_truth_match() depends on those formulas</span></span>
<span id="cb463-54"><a href="stats_method.html#cb463-54" tabindex="-1"></a>    <span class="co"># ht diffs</span></span>
<span id="cb463-55"><a href="stats_method.html#cb463-55" tabindex="-1"></a>    <span class="at">diff_height_m =</span> pred_height_m<span class="sc">-</span>gt_height_m</span>
<span id="cb463-56"><a href="stats_method.html#cb463-56" tabindex="-1"></a>    , <span class="at">pct_diff_height_m =</span> (gt_height_m<span class="sc">-</span>pred_height_m)<span class="sc">/</span>gt_height_m</span>
<span id="cb463-57"><a href="stats_method.html#cb463-57" tabindex="-1"></a>    <span class="co"># diameter</span></span>
<span id="cb463-58"><a href="stats_method.html#cb463-58" tabindex="-1"></a>    , <span class="at">diff_field_diameter_m =</span> pred_diameter_m<span class="sc">-</span>gt_diameter_m</span>
<span id="cb463-59"><a href="stats_method.html#cb463-59" tabindex="-1"></a>    , <span class="at">pct_diff_field_diameter_m =</span> (gt_diameter_m<span class="sc">-</span>pred_diameter_m)<span class="sc">/</span>gt_diameter_m</span>
<span id="cb463-60"><a href="stats_method.html#cb463-60" tabindex="-1"></a>    <span class="co"># image diameter</span></span>
<span id="cb463-61"><a href="stats_method.html#cb463-61" tabindex="-1"></a>    , <span class="at">diff_image_diameter_m =</span> pred_diameter_m<span class="sc">-</span>image_gt_diameter_m</span>
<span id="cb463-62"><a href="stats_method.html#cb463-62" tabindex="-1"></a>    , <span class="at">pct_diff_image_diameter_m =</span> (image_gt_diameter_m<span class="sc">-</span>pred_diameter_m)<span class="sc">/</span>image_gt_diameter_m</span>
<span id="cb463-63"><a href="stats_method.html#cb463-63" tabindex="-1"></a>    <span class="co"># area diffs</span></span>
<span id="cb463-64"><a href="stats_method.html#cb463-64" tabindex="-1"></a>    , <span class="at">diff_area_m2 =</span> pred_area_m2<span class="sc">-</span>gt_area_m2</span>
<span id="cb463-65"><a href="stats_method.html#cb463-65" tabindex="-1"></a>    , <span class="at">pct_diff_area_m2 =</span> (gt_area_m2<span class="sc">-</span>pred_area_m2)<span class="sc">/</span>gt_area_m2</span>
<span id="cb463-66"><a href="stats_method.html#cb463-66" tabindex="-1"></a>    </span>
<span id="cb463-67"><a href="stats_method.html#cb463-67" tabindex="-1"></a>  )</span>
<span id="cb463-68"><a href="stats_method.html#cb463-68" tabindex="-1"></a><span class="co"># huh?</span></span>
<span id="cb463-69"><a href="stats_method.html#cb463-69" tabindex="-1"></a>ground_truth_prediction_match_ans <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">glimpse</span>()</span></code></pre></div>
<pre><code>## Rows: 151
## Columns: 23
## $ pile_id                   &lt;dbl&gt; 194, 82, 76, 8, 187, 77, 189, 132, 111, 131,…
## $ i_area                    &lt;dbl&gt; 44.907459, 36.745987, 19.083370, 27.643199, …
## $ u_area                    &lt;dbl&gt; 54.767766, 41.666730, 22.405358, 30.096676, …
## $ iou                       &lt;dbl&gt; 0.8199615, 0.8819024, 0.8517324, 0.9184802, …
## $ pred_id                   &lt;int&gt; 6, 8, 115, 13, 12, 10, 26, 104, 47, 141, 150…
## $ match_grp                 &lt;ord&gt; true positive, true positive, true positive,…
## $ gt_area_m2                &lt;dbl&gt; 54.040225, 40.292717, 21.308728, 28.909875, …
## $ image_gt_diameter_m       &lt;dbl&gt; 8.966741, 7.892174, 5.909959, 7.595808, 6.88…
## $ gt_volume_m3              &lt;dbl&gt; 183.079674, 97.299997, 91.178437, 75.349118,…
## $ gt_height_m               &lt;dbl&gt; 6.4008, 4.2672, 4.7244, 4.2672, 3.2004, 2.43…
## $ gt_diameter_m             &lt;dbl&gt; 8.53440, 7.62000, 7.01040, 6.70560, 6.46176,…
## $ pred_area_m2              &lt;dbl&gt; 45.635, 38.120, 20.180, 28.830, 24.930, 27.7…
## $ pred_volume_m3            &lt;dbl&gt; 46.122434, 44.237940, 16.008302, 30.692573, …
## $ pred_height_m             &lt;dbl&gt; 2.300, 2.300, 1.731, 2.298, 2.299, 2.300, 2.…
## $ pred_diameter_m           &lt;dbl&gt; 8.475848, 7.564390, 5.679789, 7.375636, 6.64…
## $ diff_height_m             &lt;dbl&gt; -4.10080005, -1.96720005, -2.99340005, -1.96…
## $ pct_diff_height_m         &lt;dbl&gt; 0.6406699237, 0.4610048856, 0.6336042785, 0.…
## $ diff_field_diameter_m     &lt;dbl&gt; -0.05855196, -0.05560974, -1.33061127, 0.670…
## $ pct_diff_field_diameter_m &lt;dbl&gt; 0.006860700, 0.007297866, 0.189805328, -0.09…
## $ diff_image_diameter_m     &lt;dbl&gt; -0.49089339, -0.32778417, -0.23016998, -0.22…
## $ pct_diff_image_diameter_m &lt;dbl&gt; 0.05474602, 0.04153281, 0.03894612, 0.028986…
## $ diff_area_m2              &lt;dbl&gt; -8.4052248, -2.1727174, -1.1287281, -0.07987…
## $ pct_diff_area_m2          &lt;dbl&gt; 0.155536452, 0.053923327, 0.052970225, 0.002…</code></pre>
<div class="sourceCode" id="cb465"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb465-1"><a href="stats_method.html#cb465-1" tabindex="-1"></a><span class="co"># diff_diameter_m &gt; diff_field_diameter_m</span></span>
<span id="cb465-2"><a href="stats_method.html#cb465-2" tabindex="-1"></a><span class="co"># pct_diff_diameter_m &gt; pct_diff_field_diameter_m</span></span></code></pre></div>
<p>Now we’ll aggregate the instance matching results to calculate overall performance assessment metrics. Here, we take the counts of True Positives (TP), False Positives (FP, commissions), and False Negatives (FN, omissions), to determine overall accuracy. This aggregation will give us two types of results:</p>
<ul>
<li><a href="method-evaluation.html#detect_metrics_form">detection accuracy metrics</a>: such as Recall, Precision, and F-score, are calculated directly by aggregating these raw TP, FP, and FN counts and quantifies the method’s ability to find the piles</li>
<li><a href="method-evaluation.html#quant_metrics_form">quantification accuracy metrics</a>: such as RMSE, MAPE, and Mean Error of pile form measurements (e.g. height, diameter) are calculated by aggregating the differences between the estimated pile attributes and the ground truth values for instances classified as True Positives. These metrics tell us about the method’s ability to accurately quantify the form of the piles it successfully identified</li>
</ul>
<div class="sourceCode" id="cb466"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb466-1"><a href="stats_method.html#cb466-1" tabindex="-1"></a>agg_ground_truth_match_ans <span class="ot">&lt;-</span> <span class="fu">agg_ground_truth_match</span>(<span class="at">ground_truth_prediction_match_ans =</span> ground_truth_prediction_match_ans)</span>
<span id="cb466-2"><a href="stats_method.html#cb466-2" tabindex="-1"></a><span class="co"># huh?</span></span>
<span id="cb466-3"><a href="stats_method.html#cb466-3" tabindex="-1"></a><span class="co"># agg_ground_truth_match_ans %&gt;% dplyr::glimpse()</span></span></code></pre></div>
<p>let’s table the relevant accuracy metrics</p>
<div class="sourceCode" id="cb467"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb467-1"><a href="stats_method.html#cb467-1" tabindex="-1"></a>kbl_agg_gt_match <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb467-2"><a href="stats_method.html#cb467-2" tabindex="-1"></a>  agg_ground_truth_match_df</span>
<span id="cb467-3"><a href="stats_method.html#cb467-3" tabindex="-1"></a>  , <span class="at">caption =</span> <span class="st">&quot;pile detection and form quantification accuracy metrics&quot;</span></span>
<span id="cb467-4"><a href="stats_method.html#cb467-4" tabindex="-1"></a>) {</span>
<span id="cb467-5"><a href="stats_method.html#cb467-5" tabindex="-1"></a>  <span class="co"># let&#39;s table the most relevant metrics</span></span>
<span id="cb467-6"><a href="stats_method.html#cb467-6" tabindex="-1"></a>  agg_ground_truth_match_df <span class="sc">%&gt;%</span> </span>
<span id="cb467-7"><a href="stats_method.html#cb467-7" tabindex="-1"></a>  <span class="co"># first select to arrange eval_metric</span></span>
<span id="cb467-8"><a href="stats_method.html#cb467-8" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb467-9"><a href="stats_method.html#cb467-9" tabindex="-1"></a>    <span class="co"># detection cnt</span></span>
<span id="cb467-10"><a href="stats_method.html#cb467-10" tabindex="-1"></a>    tp_n, fn_n, fp_n</span>
<span id="cb467-11"><a href="stats_method.html#cb467-11" tabindex="-1"></a>    <span class="co"># detection</span></span>
<span id="cb467-12"><a href="stats_method.html#cb467-12" tabindex="-1"></a>    , f_score, recall, precision</span>
<span id="cb467-13"><a href="stats_method.html#cb467-13" tabindex="-1"></a>    <span class="co"># quantification</span></span>
<span id="cb467-14"><a href="stats_method.html#cb467-14" tabindex="-1"></a>    , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_mean&quot;</span>)</span>
<span id="cb467-15"><a href="stats_method.html#cb467-15" tabindex="-1"></a>    , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_rmse&quot;</span>)</span>
<span id="cb467-16"><a href="stats_method.html#cb467-16" tabindex="-1"></a>    <span class="co"># , tidyselect::ends_with(&quot;_rrmse&quot;)</span></span>
<span id="cb467-17"><a href="stats_method.html#cb467-17" tabindex="-1"></a>    , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_mape&quot;</span>)</span>
<span id="cb467-18"><a href="stats_method.html#cb467-18" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb467-19"><a href="stats_method.html#cb467-19" tabindex="-1"></a>  <span class="co"># second select to arrange pile_metric</span></span>
<span id="cb467-20"><a href="stats_method.html#cb467-20" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb467-21"><a href="stats_method.html#cb467-21" tabindex="-1"></a>    <span class="co"># detection cnt</span></span>
<span id="cb467-22"><a href="stats_method.html#cb467-22" tabindex="-1"></a>    tp_n, fn_n, fp_n</span>
<span id="cb467-23"><a href="stats_method.html#cb467-23" tabindex="-1"></a>    <span class="co"># detection</span></span>
<span id="cb467-24"><a href="stats_method.html#cb467-24" tabindex="-1"></a>    , f_score, recall, precision</span>
<span id="cb467-25"><a href="stats_method.html#cb467-25" tabindex="-1"></a>    <span class="co"># quantification</span></span>
<span id="cb467-26"><a href="stats_method.html#cb467-26" tabindex="-1"></a>    , <span class="fu">c</span>(tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;volume&quot;</span>) <span class="sc">&amp;</span> <span class="sc">!</span>tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;paraboloid&quot;</span>))</span>
<span id="cb467-27"><a href="stats_method.html#cb467-27" tabindex="-1"></a>    , tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;area&quot;</span>)</span>
<span id="cb467-28"><a href="stats_method.html#cb467-28" tabindex="-1"></a>    , tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;height&quot;</span>)</span>
<span id="cb467-29"><a href="stats_method.html#cb467-29" tabindex="-1"></a>    , tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;diameter&quot;</span>)</span>
<span id="cb467-30"><a href="stats_method.html#cb467-30" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb467-31"><a href="stats_method.html#cb467-31" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb467-32"><a href="stats_method.html#cb467-32" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">across</span>(</span>
<span id="cb467-33"><a href="stats_method.html#cb467-33" tabindex="-1"></a>      <span class="at">.cols =</span> <span class="fu">c</span>(f_score, recall, precision, tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_mape&quot;</span>))</span>
<span id="cb467-34"><a href="stats_method.html#cb467-34" tabindex="-1"></a>      , <span class="at">.fn =</span> <span class="sc">~</span> scales<span class="sc">::</span><span class="fu">percent</span>(.x, <span class="at">accuracy =</span> <span class="dv">1</span>)</span>
<span id="cb467-35"><a href="stats_method.html#cb467-35" tabindex="-1"></a>    )</span>
<span id="cb467-36"><a href="stats_method.html#cb467-36" tabindex="-1"></a>    , dplyr<span class="sc">::</span><span class="fu">across</span>(</span>
<span id="cb467-37"><a href="stats_method.html#cb467-37" tabindex="-1"></a>      <span class="at">.cols =</span> <span class="fu">c</span>(tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_mean&quot;</span>))</span>
<span id="cb467-38"><a href="stats_method.html#cb467-38" tabindex="-1"></a>      , <span class="at">.fn =</span> <span class="sc">~</span> scales<span class="sc">::</span><span class="fu">comma</span>(.x, <span class="at">accuracy =</span> <span class="fl">0.01</span>)</span>
<span id="cb467-39"><a href="stats_method.html#cb467-39" tabindex="-1"></a>    )</span>
<span id="cb467-40"><a href="stats_method.html#cb467-40" tabindex="-1"></a>    , dplyr<span class="sc">::</span><span class="fu">across</span>(</span>
<span id="cb467-41"><a href="stats_method.html#cb467-41" tabindex="-1"></a>      <span class="at">.cols =</span> <span class="fu">c</span>(tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_rmse&quot;</span>))</span>
<span id="cb467-42"><a href="stats_method.html#cb467-42" tabindex="-1"></a>      , <span class="at">.fn =</span> <span class="sc">~</span> scales<span class="sc">::</span><span class="fu">comma</span>(.x, <span class="at">accuracy =</span> <span class="fl">0.1</span>)</span>
<span id="cb467-43"><a href="stats_method.html#cb467-43" tabindex="-1"></a>    )</span>
<span id="cb467-44"><a href="stats_method.html#cb467-44" tabindex="-1"></a>    , dplyr<span class="sc">::</span><span class="fu">across</span>(</span>
<span id="cb467-45"><a href="stats_method.html#cb467-45" tabindex="-1"></a>      <span class="at">.cols =</span> <span class="fu">c</span>(tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_n&quot;</span>))</span>
<span id="cb467-46"><a href="stats_method.html#cb467-46" tabindex="-1"></a>      , <span class="at">.fn =</span> <span class="sc">~</span> scales<span class="sc">::</span><span class="fu">comma</span>(.x, <span class="at">accuracy =</span> <span class="dv">1</span>)</span>
<span id="cb467-47"><a href="stats_method.html#cb467-47" tabindex="-1"></a>    )</span>
<span id="cb467-48"><a href="stats_method.html#cb467-48" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb467-49"><a href="stats_method.html#cb467-49" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(</span>
<span id="cb467-50"><a href="stats_method.html#cb467-50" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">c</span>(</span>
<span id="cb467-51"><a href="stats_method.html#cb467-51" tabindex="-1"></a>      tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_n&quot;</span>)</span>
<span id="cb467-52"><a href="stats_method.html#cb467-52" tabindex="-1"></a>      , f_score, recall, precision</span>
<span id="cb467-53"><a href="stats_method.html#cb467-53" tabindex="-1"></a>      , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_rmse&quot;</span>)</span>
<span id="cb467-54"><a href="stats_method.html#cb467-54" tabindex="-1"></a>      , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_rrmse&quot;</span>)</span>
<span id="cb467-55"><a href="stats_method.html#cb467-55" tabindex="-1"></a>      , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_mean&quot;</span>)</span>
<span id="cb467-56"><a href="stats_method.html#cb467-56" tabindex="-1"></a>      , tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_mape&quot;</span>)</span>
<span id="cb467-57"><a href="stats_method.html#cb467-57" tabindex="-1"></a>    )</span>
<span id="cb467-58"><a href="stats_method.html#cb467-58" tabindex="-1"></a>    , <span class="at">names_to =</span> <span class="st">&quot;metric&quot;</span></span>
<span id="cb467-59"><a href="stats_method.html#cb467-59" tabindex="-1"></a>    , <span class="at">values_to =</span> <span class="st">&quot;value&quot;</span></span>
<span id="cb467-60"><a href="stats_method.html#cb467-60" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb467-61"><a href="stats_method.html#cb467-61" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb467-62"><a href="stats_method.html#cb467-62" tabindex="-1"></a>    <span class="at">eval_metric =</span> metric <span class="sc">%&gt;%</span> </span>
<span id="cb467-63"><a href="stats_method.html#cb467-63" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_extract</span>(<span class="st">&quot;(_rmse|_rrmse|_mean|_mape|f_score|recall|precision|tp_n|fn_n|fp_n)$&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb467-64"><a href="stats_method.html#cb467-64" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_remove_all</span>(<span class="st">&quot;_n$&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb467-65"><a href="stats_method.html#cb467-65" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_remove_all</span>(<span class="st">&quot;_&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb467-66"><a href="stats_method.html#cb467-66" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_replace_all</span>(<span class="st">&quot;mean&quot;</span>,<span class="st">&quot;me&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb467-67"><a href="stats_method.html#cb467-67" tabindex="-1"></a>      <span class="fu">toupper</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb467-68"><a href="stats_method.html#cb467-68" tabindex="-1"></a>      <span class="fu">factor</span>(</span>
<span id="cb467-69"><a href="stats_method.html#cb467-69" tabindex="-1"></a>        <span class="at">ordered =</span> T</span>
<span id="cb467-70"><a href="stats_method.html#cb467-70" tabindex="-1"></a>        , <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;TP&quot;</span>,<span class="st">&quot;FN&quot;</span>,<span class="st">&quot;FP&quot;</span>, <span class="st">&quot;FSCORE&quot;</span>,<span class="st">&quot;RECALL&quot;</span>,<span class="st">&quot;PRECISION&quot;</span>, <span class="st">&quot;ME&quot;</span>,<span class="st">&quot;RMSE&quot;</span>,<span class="st">&quot;RRMSE&quot;</span>,<span class="st">&quot;MAPE&quot;</span>)</span>
<span id="cb467-71"><a href="stats_method.html#cb467-71" tabindex="-1"></a>        , <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;TP&quot;</span>,<span class="st">&quot;FN&quot;</span>,<span class="st">&quot;FP&quot;</span>, <span class="st">&quot;F-score&quot;</span>,<span class="st">&quot;Recall&quot;</span>,<span class="st">&quot;Precision&quot;</span>, <span class="st">&quot;ME&quot;</span>,<span class="st">&quot;RMSE&quot;</span>,<span class="st">&quot;RRMSE&quot;</span>,<span class="st">&quot;MAPE&quot;</span>)</span>
<span id="cb467-72"><a href="stats_method.html#cb467-72" tabindex="-1"></a>      )</span>
<span id="cb467-73"><a href="stats_method.html#cb467-73" tabindex="-1"></a>    , <span class="at">pile_metric =</span> metric <span class="sc">%&gt;%</span> </span>
<span id="cb467-74"><a href="stats_method.html#cb467-74" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_remove</span>(<span class="st">&quot;(_rmse|_rrmse|_mean|_mape)$&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb467-75"><a href="stats_method.html#cb467-75" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_extract</span>(<span class="st">&quot;(paraboloid_volume|volume|area|height|diameter)&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb467-76"><a href="stats_method.html#cb467-76" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">coalesce</span>(<span class="st">&quot;detection&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb467-77"><a href="stats_method.html#cb467-77" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_c</span>(</span>
<span id="cb467-78"><a href="stats_method.html#cb467-78" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb467-79"><a href="stats_method.html#cb467-79" tabindex="-1"></a>          stringr<span class="sc">::</span><span class="fu">str_detect</span>(metric,<span class="st">&quot;(field|image)&quot;</span>) <span class="sc">~</span> <span class="fu">paste0</span>(<span class="st">&quot; (&quot;</span>, stringr<span class="sc">::</span><span class="fu">str_extract</span>(metric,<span class="st">&quot;(field|image)&quot;</span>), <span class="st">&quot;)&quot;</span>)</span>
<span id="cb467-80"><a href="stats_method.html#cb467-80" tabindex="-1"></a>          , T <span class="sc">~</span> <span class="st">&quot;&quot;</span></span>
<span id="cb467-81"><a href="stats_method.html#cb467-81" tabindex="-1"></a>        )</span>
<span id="cb467-82"><a href="stats_method.html#cb467-82" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span> </span>
<span id="cb467-83"><a href="stats_method.html#cb467-83" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_replace</span>(<span class="st">&quot;area&quot;</span>, <span class="st">&quot;area m&lt;sup&gt;2&lt;/sup&gt;&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb467-84"><a href="stats_method.html#cb467-84" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_replace</span>(<span class="st">&quot;volume&quot;</span>, <span class="st">&quot;volume m&lt;sup&gt;3&lt;/sup&gt;&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb467-85"><a href="stats_method.html#cb467-85" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_replace</span>(<span class="st">&quot;diameter&quot;</span>, <span class="st">&quot;diameter m&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb467-86"><a href="stats_method.html#cb467-86" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_replace</span>(<span class="st">&quot;height&quot;</span>, <span class="st">&quot;height m&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb467-87"><a href="stats_method.html#cb467-87" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_to_sentence</span>()</span>
<span id="cb467-88"><a href="stats_method.html#cb467-88" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb467-89"><a href="stats_method.html#cb467-89" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb467-90"><a href="stats_method.html#cb467-90" tabindex="-1"></a>    <span class="at">pile_metric =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb467-91"><a href="stats_method.html#cb467-91" tabindex="-1"></a>      pile_metric <span class="sc">==</span> <span class="st">&quot;Detection&quot;</span> <span class="sc">&amp;</span> eval_metric <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;TP&quot;</span>,<span class="st">&quot;FN&quot;</span>,<span class="st">&quot;FP&quot;</span>) <span class="sc">~</span> <span class="st">&quot;Detection Count&quot;</span></span>
<span id="cb467-92"><a href="stats_method.html#cb467-92" tabindex="-1"></a>      , T <span class="sc">~</span> pile_metric</span>
<span id="cb467-93"><a href="stats_method.html#cb467-93" tabindex="-1"></a>    )</span>
<span id="cb467-94"><a href="stats_method.html#cb467-94" tabindex="-1"></a>    , <span class="at">sorter =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb467-95"><a href="stats_method.html#cb467-95" tabindex="-1"></a>      pile_metric<span class="sc">==</span><span class="st">&quot;Detection Count&quot;</span> <span class="sc">~</span> <span class="dv">1</span></span>
<span id="cb467-96"><a href="stats_method.html#cb467-96" tabindex="-1"></a>      , pile_metric<span class="sc">==</span><span class="st">&quot;Detection&quot;</span> <span class="sc">~</span> <span class="dv">2</span></span>
<span id="cb467-97"><a href="stats_method.html#cb467-97" tabindex="-1"></a>      , T <span class="sc">~</span> <span class="dv">3</span></span>
<span id="cb467-98"><a href="stats_method.html#cb467-98" tabindex="-1"></a>    )</span>
<span id="cb467-99"><a href="stats_method.html#cb467-99" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb467-100"><a href="stats_method.html#cb467-100" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(sorter, pile_metric, eval_metric) <span class="sc">%&gt;%</span> </span>
<span id="cb467-101"><a href="stats_method.html#cb467-101" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(pile_metric,eval_metric,value) <span class="sc">%&gt;%</span> </span>
<span id="cb467-102"><a href="stats_method.html#cb467-102" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kbl</span>(</span>
<span id="cb467-103"><a href="stats_method.html#cb467-103" tabindex="-1"></a>    <span class="at">caption =</span> caption</span>
<span id="cb467-104"><a href="stats_method.html#cb467-104" tabindex="-1"></a>    , <span class="at">col.names =</span> <span class="fu">c</span>(</span>
<span id="cb467-105"><a href="stats_method.html#cb467-105" tabindex="-1"></a>      <span class="st">&quot;.&quot;</span>, <span class="st">&quot;&quot;</span></span>
<span id="cb467-106"><a href="stats_method.html#cb467-106" tabindex="-1"></a>      , <span class="st">&quot;value&quot;</span></span>
<span id="cb467-107"><a href="stats_method.html#cb467-107" tabindex="-1"></a>    )</span>
<span id="cb467-108"><a href="stats_method.html#cb467-108" tabindex="-1"></a>    , <span class="at">escape =</span> F</span>
<span id="cb467-109"><a href="stats_method.html#cb467-109" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb467-110"><a href="stats_method.html#cb467-110" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kable_styling</span>(<span class="at">font_size =</span> <span class="dv">12</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb467-111"><a href="stats_method.html#cb467-111" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">collapse_rows</span>(<span class="at">columns =</span> <span class="dv">1</span>, <span class="at">valign =</span> <span class="st">&quot;top&quot;</span>)</span>
<span id="cb467-112"><a href="stats_method.html#cb467-112" tabindex="-1"></a>}</span></code></pre></div>
<p>use the function we just defined to make a nice summary table</p>
<div class="sourceCode" id="cb468"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb468-1"><a href="stats_method.html#cb468-1" tabindex="-1"></a><span class="co"># do it</span></span>
<span id="cb468-2"><a href="stats_method.html#cb468-2" tabindex="-1"></a><span class="fu">kbl_agg_gt_match</span>(</span>
<span id="cb468-3"><a href="stats_method.html#cb468-3" tabindex="-1"></a>  agg_ground_truth_match_ans</span>
<span id="cb468-4"><a href="stats_method.html#cb468-4" tabindex="-1"></a>  , <span class="at">caption =</span> <span class="st">&quot;pile detection and form quantification accuracy metrics&lt;br&gt;data fusion PSINF ponderosa pine training site&quot;</span></span>
<span id="cb468-5"><a href="stats_method.html#cb468-5" tabindex="-1"></a>)</span></code></pre></div>
<table class="table" style="font-size: 12px; margin-left: auto; margin-right: auto;">
<caption style="font-size: initial !important;">
<span id="tab:unnamed-chunk-441">Table 9.28: </span>pile detection and form quantification accuracy metrics<br>data fusion PSINF ponderosa pine training site
</caption>
<thead>
<tr>
<th style="text-align:left;">
.
</th>
<th style="text-align:left;">
</th>
<th style="text-align:left;">
value
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="3">
Detection Count
</td>
<td style="text-align:left;">
TP
</td>
<td style="text-align:left;">
107
</td>
</tr>
<tr>
<td style="text-align:left;">
FN
</td>
<td style="text-align:left;">
14
</td>
</tr>
<tr>
<td style="text-align:left;">
FP
</td>
<td style="text-align:left;">
30
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="3">
Detection
</td>
<td style="text-align:left;">
F-score
</td>
<td style="text-align:left;">
83%
</td>
</tr>
<tr>
<td style="text-align:left;">
Recall
</td>
<td style="text-align:left;">
88%
</td>
</tr>
<tr>
<td style="text-align:left;">
Precision
</td>
<td style="text-align:left;">
78%
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="3">
Area m<sup>2</sup>
</td>
<td style="text-align:left;">
ME
</td>
<td style="text-align:left;">
-0.63
</td>
</tr>
<tr>
<td style="text-align:left;">
RMSE
</td>
<td style="text-align:left;">
2.1
</td>
</tr>
<tr>
<td style="text-align:left;">
MAPE
</td>
<td style="text-align:left;">
12%
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="3">
Diameter m (field)
</td>
<td style="text-align:left;">
ME
</td>
<td style="text-align:left;">
0.21
</td>
</tr>
<tr>
<td style="text-align:left;">
RMSE
</td>
<td style="text-align:left;">
0.6
</td>
</tr>
<tr>
<td style="text-align:left;">
MAPE
</td>
<td style="text-align:left;">
11%
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="3">
Diameter m (image)
</td>
<td style="text-align:left;">
ME
</td>
<td style="text-align:left;">
-0.17
</td>
</tr>
<tr>
<td style="text-align:left;">
RMSE
</td>
<td style="text-align:left;">
0.4
</td>
</tr>
<tr>
<td style="text-align:left;">
MAPE
</td>
<td style="text-align:left;">
8%
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="3">
Height m
</td>
<td style="text-align:left;">
ME
</td>
<td style="text-align:left;">
-0.20
</td>
</tr>
<tr>
<td style="text-align:left;">
RMSE
</td>
<td style="text-align:left;">
0.7
</td>
</tr>
<tr>
<td style="text-align:left;">
MAPE
</td>
<td style="text-align:left;">
15%
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb469"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb469-1"><a href="stats_method.html#cb469-1" tabindex="-1"></a><span class="co"># save the table for full comparison at the very end</span></span>
<span id="cb469-2"><a href="stats_method.html#cb469-2" tabindex="-1"></a>all_agg_ground_truth_match_ans_fp <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">&quot;../data/&quot;</span>,<span class="st">&quot;all_agg_ground_truth_match_ans.gpkg&quot;</span>)</span>
<span id="cb469-3"><a href="stats_method.html#cb469-3" tabindex="-1"></a><span class="co"># make a function to convert the sf data to the same format for all</span></span>
<span id="cb469-4"><a href="stats_method.html#cb469-4" tabindex="-1"></a>all_agg_ground_truth_sf_format <span class="ot">&lt;-</span> <span class="cf">function</span>(stand_boundary, <span class="at">site =</span> <span class="st">&quot;you didn&#39;t name this site&quot;</span>) {</span>
<span id="cb469-5"><a href="stats_method.html#cb469-5" tabindex="-1"></a>  ret <span class="ot">&lt;-</span> stand_boundary <span class="sc">%&gt;%</span> </span>
<span id="cb469-6"><a href="stats_method.html#cb469-6" tabindex="-1"></a>    sf<span class="sc">::</span><span class="fu">st_union</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb469-7"><a href="stats_method.html#cb469-7" tabindex="-1"></a>    sf<span class="sc">::</span><span class="fu">st_sf</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb469-8"><a href="stats_method.html#cb469-8" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">site_area_m2 =</span> sf<span class="sc">::</span><span class="fu">st_area</span>(.) <span class="sc">%&gt;%</span> <span class="fu">as.numeric</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb469-9"><a href="stats_method.html#cb469-9" tabindex="-1"></a>    sf<span class="sc">::</span><span class="fu">st_centroid</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb469-10"><a href="stats_method.html#cb469-10" tabindex="-1"></a>    sf<span class="sc">::</span><span class="fu">st_sf</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb469-11"><a href="stats_method.html#cb469-11" tabindex="-1"></a>    sf<span class="sc">::</span><span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="dv">5070</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb469-12"><a href="stats_method.html#cb469-12" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">site =</span> site)</span>
<span id="cb469-13"><a href="stats_method.html#cb469-13" tabindex="-1"></a>  <span class="fu">return</span>(ret)</span>
<span id="cb469-14"><a href="stats_method.html#cb469-14" tabindex="-1"></a>}</span>
<span id="cb469-15"><a href="stats_method.html#cb469-15" tabindex="-1"></a><span class="co"># write data</span></span>
<span id="cb469-16"><a href="stats_method.html#cb469-16" tabindex="-1"></a><span class="fu">all_agg_ground_truth_sf_format</span>(</span>
<span id="cb469-17"><a href="stats_method.html#cb469-17" tabindex="-1"></a>  <span class="at">stand_boundary =</span> stand_boundary</span>
<span id="cb469-18"><a href="stats_method.html#cb469-18" tabindex="-1"></a>  , <span class="at">site =</span> <span class="st">&quot;PSINF ponderosa pine training site&quot;</span></span>
<span id="cb469-19"><a href="stats_method.html#cb469-19" tabindex="-1"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb469-20"><a href="stats_method.html#cb469-20" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">bind_cols</span>(</span>
<span id="cb469-21"><a href="stats_method.html#cb469-21" tabindex="-1"></a>  agg_ground_truth_match_ans</span>
<span id="cb469-22"><a href="stats_method.html#cb469-22" tabindex="-1"></a>  <span class="co"># join on aggregated form quantifications that we have for all</span></span>
<span id="cb469-23"><a href="stats_method.html#cb469-23" tabindex="-1"></a>  , ground_truth_prediction_match_ans <span class="sc">%&gt;%</span> </span>
<span id="cb469-24"><a href="stats_method.html#cb469-24" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb469-25"><a href="stats_method.html#cb469-25" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">summarise</span>(</span>
<span id="cb469-26"><a href="stats_method.html#cb469-26" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">across</span>(</span>
<span id="cb469-27"><a href="stats_method.html#cb469-27" tabindex="-1"></a>        <span class="fu">c</span>(image_gt_diameter_m, pred_diameter_m, gt_area_m2, pred_area_m2, pred_volume_m3, pred_height_m)</span>
<span id="cb469-28"><a href="stats_method.html#cb469-28" tabindex="-1"></a>        , <span class="sc">~</span> <span class="fu">sum</span>(.x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb469-29"><a href="stats_method.html#cb469-29" tabindex="-1"></a>      )</span>
<span id="cb469-30"><a href="stats_method.html#cb469-30" tabindex="-1"></a>    )</span>
<span id="cb469-31"><a href="stats_method.html#cb469-31" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb469-32"><a href="stats_method.html#cb469-32" tabindex="-1"></a>  <span class="co"># dplyr::glimpse()</span></span>
<span id="cb469-33"><a href="stats_method.html#cb469-33" tabindex="-1"></a>  <span class="co"># readr::write_csv(file = all_agg_ground_truth_match_ans_fp, append = F, progress = F)</span></span>
<span id="cb469-34"><a href="stats_method.html#cb469-34" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_write</span>(<span class="at">dsn =</span> all_agg_ground_truth_match_ans_fp, <span class="at">append =</span> F, <span class="at">quiet =</span> T)</span></code></pre></div>
<p>let’s compare these with the predicted accuracies from the model</p>
<div class="sourceCode" id="cb470"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb470-1"><a href="stats_method.html#cb470-1" tabindex="-1"></a>best_balanced_accuracy_combos <span class="sc">%&gt;%</span> </span>
<span id="cb470-2"><a href="stats_method.html#cb470-2" tabindex="-1"></a>  <span class="co"># get rid of vars we fixed</span></span>
<span id="cb470-3"><a href="stats_method.html#cb470-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(max_ht_m, max_area_m2)) <span class="sc">%&gt;%</span> </span>
<span id="cb470-4"><a href="stats_method.html#cb470-4" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb470-5"><a href="stats_method.html#cb470-5" tabindex="-1"></a>    <span class="at">spectral_weight =</span> spectral_weight <span class="sc">%&gt;%</span> <span class="fu">as.character</span>() <span class="sc">%&gt;%</span> <span class="fu">as.numeric</span>()</span>
<span id="cb470-6"><a href="stats_method.html#cb470-6" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb470-7"><a href="stats_method.html#cb470-7" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span><span class="fu">c</span>(.draw,method_input_data)) <span class="sc">%&gt;%</span> </span>
<span id="cb470-8"><a href="stats_method.html#cb470-8" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb470-9"><a href="stats_method.html#cb470-9" tabindex="-1"></a>  <span class="co"># filter for accuracy metrics</span></span>
<span id="cb470-10"><a href="stats_method.html#cb470-10" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(name<span class="sc">==</span><span class="st">&quot;f_score&quot;</span> <span class="sc">|</span> stringr<span class="sc">::</span><span class="fu">str_ends</span>(name, <span class="st">&quot;_mape&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb470-11"><a href="stats_method.html#cb470-11" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb470-12"><a href="stats_method.html#cb470-12" tabindex="-1"></a>    <span class="at">name =</span> name <span class="sc">%&gt;%</span> </span>
<span id="cb470-13"><a href="stats_method.html#cb470-13" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_replace_all</span>(<span class="st">&quot;_mape&quot;</span>, <span class="st">&quot;_MAPE&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb470-14"><a href="stats_method.html#cb470-14" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_replace_all</span>(<span class="st">&quot;f_score&quot;</span>, <span class="st">&quot;F-score&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb470-15"><a href="stats_method.html#cb470-15" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_replace_all</span>(<span class="st">&quot;_&quot;</span>, <span class="st">&quot; &quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb470-16"><a href="stats_method.html#cb470-16" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_squish</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb470-17"><a href="stats_method.html#cb470-17" tabindex="-1"></a>      <span class="fu">factor</span>(<span class="at">ordered =</span> T) <span class="sc">%&gt;%</span> </span>
<span id="cb470-18"><a href="stats_method.html#cb470-18" tabindex="-1"></a>      forcats<span class="sc">::</span><span class="fu">fct_relevel</span>(<span class="st">&quot;F-score&quot;</span>)</span>
<span id="cb470-19"><a href="stats_method.html#cb470-19" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb470-20"><a href="stats_method.html#cb470-20" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(method_input_data <span class="sc">==</span> <span class="st">&quot;structural+spectral&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb470-21"><a href="stats_method.html#cb470-21" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> value)) <span class="sc">+</span></span>
<span id="cb470-22"><a href="stats_method.html#cb470-22" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">stat_dotsinterval</span>(</span>
<span id="cb470-23"><a href="stats_method.html#cb470-23" tabindex="-1"></a>    <span class="at">point_interval =</span> <span class="st">&quot;median_hdci&quot;</span>, <span class="at">.width =</span> <span class="fu">c</span>(<span class="fl">0.99</span>)</span>
<span id="cb470-24"><a href="stats_method.html#cb470-24" tabindex="-1"></a>    , <span class="at">quantiles =</span> <span class="dv">100</span></span>
<span id="cb470-25"><a href="stats_method.html#cb470-25" tabindex="-1"></a>    , <span class="at">point_size =</span> <span class="dv">3</span></span>
<span id="cb470-26"><a href="stats_method.html#cb470-26" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb470-27"><a href="stats_method.html#cb470-27" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_vline</span>(</span>
<span id="cb470-28"><a href="stats_method.html#cb470-28" tabindex="-1"></a>    <span class="at">data =</span> </span>
<span id="cb470-29"><a href="stats_method.html#cb470-29" tabindex="-1"></a>      agg_ground_truth_match_ans <span class="sc">%&gt;%</span> </span>
<span id="cb470-30"><a href="stats_method.html#cb470-30" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">select</span>(f_score,pct_diff_field_diameter_m_mape,pct_diff_height_m_mape) <span class="sc">%&gt;%</span> </span>
<span id="cb470-31"><a href="stats_method.html#cb470-31" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">rename</span>(</span>
<span id="cb470-32"><a href="stats_method.html#cb470-32" tabindex="-1"></a>        <span class="at">diameter_mape=</span>pct_diff_field_diameter_m_mape</span>
<span id="cb470-33"><a href="stats_method.html#cb470-33" tabindex="-1"></a>        , <span class="at">height_mape=</span>pct_diff_height_m_mape</span>
<span id="cb470-34"><a href="stats_method.html#cb470-34" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span> </span>
<span id="cb470-35"><a href="stats_method.html#cb470-35" tabindex="-1"></a>      tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(<span class="at">cols =</span> dplyr<span class="sc">::</span><span class="fu">everything</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb470-36"><a href="stats_method.html#cb470-36" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb470-37"><a href="stats_method.html#cb470-37" tabindex="-1"></a>      <span class="co"># filter for accuracy metrics</span></span>
<span id="cb470-38"><a href="stats_method.html#cb470-38" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">filter</span>(name<span class="sc">==</span><span class="st">&quot;f_score&quot;</span> <span class="sc">|</span> stringr<span class="sc">::</span><span class="fu">str_ends</span>(name, <span class="st">&quot;_mape&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb470-39"><a href="stats_method.html#cb470-39" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb470-40"><a href="stats_method.html#cb470-40" tabindex="-1"></a>        <span class="at">name =</span> name <span class="sc">%&gt;%</span> </span>
<span id="cb470-41"><a href="stats_method.html#cb470-41" tabindex="-1"></a>          stringr<span class="sc">::</span><span class="fu">str_replace_all</span>(<span class="st">&quot;_mape&quot;</span>, <span class="st">&quot;_MAPE&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb470-42"><a href="stats_method.html#cb470-42" tabindex="-1"></a>          stringr<span class="sc">::</span><span class="fu">str_replace_all</span>(<span class="st">&quot;f_score&quot;</span>, <span class="st">&quot;F-score&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb470-43"><a href="stats_method.html#cb470-43" tabindex="-1"></a>          stringr<span class="sc">::</span><span class="fu">str_replace_all</span>(<span class="st">&quot;_&quot;</span>, <span class="st">&quot; &quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb470-44"><a href="stats_method.html#cb470-44" tabindex="-1"></a>          stringr<span class="sc">::</span><span class="fu">str_squish</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb470-45"><a href="stats_method.html#cb470-45" tabindex="-1"></a>          <span class="fu">factor</span>(<span class="at">ordered =</span> T) <span class="sc">%&gt;%</span> </span>
<span id="cb470-46"><a href="stats_method.html#cb470-46" tabindex="-1"></a>          forcats<span class="sc">::</span><span class="fu">fct_relevel</span>(<span class="st">&quot;F-score&quot;</span>)</span>
<span id="cb470-47"><a href="stats_method.html#cb470-47" tabindex="-1"></a>      )</span>
<span id="cb470-48"><a href="stats_method.html#cb470-48" tabindex="-1"></a>    , <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">xintercept=</span>value)</span>
<span id="cb470-49"><a href="stats_method.html#cb470-49" tabindex="-1"></a>    , <span class="at">color =</span> <span class="st">&quot;navy&quot;</span>, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.7</span></span>
<span id="cb470-50"><a href="stats_method.html#cb470-50" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb470-51"><a href="stats_method.html#cb470-51" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">facet_grid</span>(</span>
<span id="cb470-52"><a href="stats_method.html#cb470-52" tabindex="-1"></a>    <span class="at">cols =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(name)</span>
<span id="cb470-53"><a href="stats_method.html#cb470-53" tabindex="-1"></a>    , <span class="at">scales =</span> <span class="st">&quot;free_x&quot;</span></span>
<span id="cb470-54"><a href="stats_method.html#cb470-54" tabindex="-1"></a>    , <span class="at">axes =</span> <span class="st">&quot;all_x&quot;</span></span>
<span id="cb470-55"><a href="stats_method.html#cb470-55" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb470-56"><a href="stats_method.html#cb470-56" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb470-57"><a href="stats_method.html#cb470-57" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_x_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>percent, <span class="at">expand =</span> ggplot2<span class="sc">::</span><span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">1.1</span>,<span class="fl">1.1</span>))) <span class="sc">+</span></span>
<span id="cb470-58"><a href="stats_method.html#cb470-58" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb470-59"><a href="stats_method.html#cb470-59" tabindex="-1"></a>    <span class="at">x=</span><span class="st">&quot;&quot;</span></span>
<span id="cb470-60"><a href="stats_method.html#cb470-60" tabindex="-1"></a>    , <span class="at">subtitle =</span> <span class="fu">paste0</span>(</span>
<span id="cb470-61"><a href="stats_method.html#cb470-61" tabindex="-1"></a>      <span class="st">&quot;Data Fusion predictions with actual results in blue&quot;</span></span>
<span id="cb470-62"><a href="stats_method.html#cb470-62" tabindex="-1"></a>     , <span class="st">&quot;</span><span class="sc">\n</span><span class="st">predicted pile detection and form quantification accuracy metrics&quot;</span></span>
<span id="cb470-63"><a href="stats_method.html#cb470-63" tabindex="-1"></a>     , <span class="st">&quot;</span><span class="sc">\n</span><span class="st">using optimal parameter settings based on both detection and quantification accuracy&quot;</span></span>
<span id="cb470-64"><a href="stats_method.html#cb470-64" tabindex="-1"></a>    )</span>
<span id="cb470-65"><a href="stats_method.html#cb470-65" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb470-66"><a href="stats_method.html#cb470-66" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb470-67"><a href="stats_method.html#cb470-67" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb470-68"><a href="stats_method.html#cb470-68" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb470-69"><a href="stats_method.html#cb470-69" tabindex="-1"></a>    , <span class="at">strip.text =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb470-70"><a href="stats_method.html#cb470-70" tabindex="-1"></a>    , <span class="at">axis.text.x =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>, <span class="at">angle =</span> <span class="dv">90</span>)</span>
<span id="cb470-71"><a href="stats_method.html#cb470-71" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-442-1.png" width="1008" /></p>
<p>pretty close!</p>
<p>let’s now look at the summary stats of ground truth piles</p>
<div class="sourceCode" id="cb471"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb471-1"><a href="stats_method.html#cb471-1" tabindex="-1"></a><span class="fu">kbl_form_sum_stats</span>(</span>
<span id="cb471-2"><a href="stats_method.html#cb471-2" tabindex="-1"></a>  slash_piles_polys <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(is_in_stand) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">!</span>tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&quot;volume_m3&quot;</span>))</span>
<span id="cb471-3"><a href="stats_method.html#cb471-3" tabindex="-1"></a>  , <span class="at">caption =</span> <span class="st">&quot;Ground Truth Piles: summary statistics for form measurements&lt;br&gt;PSINF ponderosa pine training site&quot;</span></span>
<span id="cb471-4"><a href="stats_method.html#cb471-4" tabindex="-1"></a>)</span></code></pre></div>
<table class="table" style="font-size: 13px; margin-left: auto; margin-right: auto;">
<caption style="font-size: initial !important;">
<span id="tab:unnamed-chunk-443">Table 9.29: </span>Ground Truth Piles: summary statistics for form measurements<br>PSINF ponderosa pine training site
</caption>
<thead>
<tr>
<th style="text-align:right;">
# piles
</th>
<th style="text-align:left;">
Metric
</th>
<th style="text-align:left;">
Mean
</th>
<th style="text-align:left;">
Std Dev
</th>
<th style="text-align:left;">
q 10%
</th>
<th style="text-align:left;">
Median
</th>
<th style="text-align:left;">
q 90%
</th>
<th style="text-align:left;">
Range
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;vertical-align: top !important;" rowspan="5">
121
</td>
<td style="text-align:left;">
Height m
</td>
<td style="text-align:left;">
2.2
</td>
<td style="text-align:left;">
0.8
</td>
<td style="text-align:left;">
1.7
</td>
<td style="text-align:left;">
2.0
</td>
<td style="text-align:left;">
2.3
</td>
<td style="text-align:left;">
1.5—6.4
</td>
</tr>
<tr>
<td style="text-align:left;">
Diameter m (image)
</td>
<td style="text-align:left;">
3.8
</td>
<td style="text-align:left;">
1.3
</td>
<td style="text-align:left;">
3.0
</td>
<td style="text-align:left;">
3.5
</td>
<td style="text-align:left;">
4.5
</td>
<td style="text-align:left;">
2.6—10.2
</td>
</tr>
<tr>
<td style="text-align:left;">
Diameter m (field)
</td>
<td style="text-align:left;">
3.4
</td>
<td style="text-align:left;">
1.2
</td>
<td style="text-align:left;">
2.8
</td>
<td style="text-align:left;">
3.1
</td>
<td style="text-align:left;">
4.0
</td>
<td style="text-align:left;">
2.4—9.0
</td>
</tr>
<tr>
<td style="text-align:left;">
Area m<sup>2</sup> (image)
</td>
<td style="text-align:left;">
9.8
</td>
<td style="text-align:left;">
9.4
</td>
<td style="text-align:left;">
5.6
</td>
<td style="text-align:left;">
7.1
</td>
<td style="text-align:left;">
11.9
</td>
<td style="text-align:left;">
3.9—59.3
</td>
</tr>
<tr>
<td style="text-align:left;">
Area m<sup>2</sup> (field)
</td>
<td style="text-align:left;">
10.5
</td>
<td style="text-align:left;">
10.2
</td>
<td style="text-align:left;">
6.2
</td>
<td style="text-align:left;">
7.6
</td>
<td style="text-align:left;">
12.3
</td>
<td style="text-align:left;">
4.7—63.1
</td>
</tr>
</tbody>
</table>
<p>and let’s look at the summary stats of the predicted piles</p>
<div class="sourceCode" id="cb472"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb472-1"><a href="stats_method.html#cb472-1" tabindex="-1"></a><span class="fu">kbl_form_sum_stats</span>(</span>
<span id="cb472-2"><a href="stats_method.html#cb472-2" tabindex="-1"></a>  final_predicted_slash_piles <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(is_in_stand)</span>
<span id="cb472-3"><a href="stats_method.html#cb472-3" tabindex="-1"></a>  , <span class="at">caption =</span> <span class="st">&quot;Predicted Piles: summary statistics for form measurements&lt;br&gt;PSINF ponderosa pine training site&quot;</span></span>
<span id="cb472-4"><a href="stats_method.html#cb472-4" tabindex="-1"></a>)</span></code></pre></div>
<table class="table" style="font-size: 13px; margin-left: auto; margin-right: auto;">
<caption style="font-size: initial !important;">
<span id="tab:unnamed-chunk-444">Table 9.30: </span>Predicted Piles: summary statistics for form measurements<br>PSINF ponderosa pine training site
</caption>
<thead>
<tr>
<th style="text-align:right;">
# piles
</th>
<th style="text-align:left;">
Metric
</th>
<th style="text-align:left;">
Mean
</th>
<th style="text-align:left;">
Std Dev
</th>
<th style="text-align:left;">
q 10%
</th>
<th style="text-align:left;">
Median
</th>
<th style="text-align:left;">
q 90%
</th>
<th style="text-align:left;">
Range
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;vertical-align: top !important;" rowspan="4">
137
</td>
<td style="text-align:left;">
Height m
</td>
<td style="text-align:left;">
1.9
</td>
<td style="text-align:left;">
0.4
</td>
<td style="text-align:left;">
1.5
</td>
<td style="text-align:left;">
2.0
</td>
<td style="text-align:left;">
2.3
</td>
<td style="text-align:left;">
0.7—2.3
</td>
</tr>
<tr>
<td style="text-align:left;">
Diameter m
</td>
<td style="text-align:left;">
3.6
</td>
<td style="text-align:left;">
1.2
</td>
<td style="text-align:left;">
2.6
</td>
<td style="text-align:left;">
3.3
</td>
<td style="text-align:left;">
4.7
</td>
<td style="text-align:left;">
2.0—9.3
</td>
</tr>
<tr>
<td style="text-align:left;">
Area m<sup>2</sup>
</td>
<td style="text-align:left;">
8.2
</td>
<td style="text-align:left;">
6.8
</td>
<td style="text-align:left;">
3.6
</td>
<td style="text-align:left;">
6.4
</td>
<td style="text-align:left;">
13.1
</td>
<td style="text-align:left;">
2.4—45.6
</td>
</tr>
<tr>
<td style="text-align:left;">
Volume m<sup>3</sup>
</td>
<td style="text-align:left;">
7.0
</td>
<td style="text-align:left;">
7.6
</td>
<td style="text-align:left;">
2.6
</td>
<td style="text-align:left;">
5.0
</td>
<td style="text-align:left;">
10.8
</td>
<td style="text-align:left;">
0.8—46.1
</td>
</tr>
</tbody>
</table>
<p>let’s look at these on the RGB</p>
<div class="sourceCode" id="cb473"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb473-1"><a href="stats_method.html#cb473-1" tabindex="-1"></a><span class="co"># plot it</span></span>
<span id="cb473-2"><a href="stats_method.html#cb473-2" tabindex="-1"></a><span class="fu">ortho_plt_fn</span>(<span class="at">my_ortho_rast =</span> ortho_rast, <span class="at">stand =</span> stand_boundary <span class="sc">%&gt;%</span> sf<span class="sc">::</span><span class="fu">st_transform</span>(sf<span class="sc">::</span><span class="fu">st_crs</span>(ortho_rast)), <span class="at">buffer =</span> <span class="dv">10</span>) <span class="sc">+</span></span>
<span id="cb473-3"><a href="stats_method.html#cb473-3" tabindex="-1"></a><span class="co"># ggplot2::ggplot() +</span></span>
<span id="cb473-4"><a href="stats_method.html#cb473-4" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_sf</span>(<span class="at">data =</span> stand_boundary <span class="sc">%&gt;%</span> sf<span class="sc">::</span><span class="fu">st_transform</span>(sf<span class="sc">::</span><span class="fu">st_crs</span>(ortho_rast)), <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">lwd =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb473-5"><a href="stats_method.html#cb473-5" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_sf</span>(</span>
<span id="cb473-6"><a href="stats_method.html#cb473-6" tabindex="-1"></a>    <span class="at">data =</span> </span>
<span id="cb473-7"><a href="stats_method.html#cb473-7" tabindex="-1"></a>      slash_piles_polys <span class="sc">%&gt;%</span> </span>
<span id="cb473-8"><a href="stats_method.html#cb473-8" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">filter</span>(is_in_stand) <span class="sc">%&gt;%</span> </span>
<span id="cb473-9"><a href="stats_method.html#cb473-9" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">left_join</span>(</span>
<span id="cb473-10"><a href="stats_method.html#cb473-10" tabindex="-1"></a>        ground_truth_prediction_match_ans <span class="sc">%&gt;%</span> </span>
<span id="cb473-11"><a href="stats_method.html#cb473-11" tabindex="-1"></a>          dplyr<span class="sc">::</span><span class="fu">select</span>(pile_id,match_grp)</span>
<span id="cb473-12"><a href="stats_method.html#cb473-12" tabindex="-1"></a>        , <span class="at">by =</span> <span class="st">&quot;pile_id&quot;</span></span>
<span id="cb473-13"><a href="stats_method.html#cb473-13" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span> </span>
<span id="cb473-14"><a href="stats_method.html#cb473-14" tabindex="-1"></a>      sf<span class="sc">::</span><span class="fu">st_transform</span>(sf<span class="sc">::</span><span class="fu">st_crs</span>(ortho_rast))</span>
<span id="cb473-15"><a href="stats_method.html#cb473-15" tabindex="-1"></a>    , <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">fill =</span> match_grp)</span>
<span id="cb473-16"><a href="stats_method.html#cb473-16" tabindex="-1"></a>    , <span class="at">color =</span> <span class="cn">NA</span> ,<span class="at">alpha=</span><span class="fl">0.6</span></span>
<span id="cb473-17"><a href="stats_method.html#cb473-17" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb473-18"><a href="stats_method.html#cb473-18" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_sf</span>(</span>
<span id="cb473-19"><a href="stats_method.html#cb473-19" tabindex="-1"></a>    <span class="at">data =</span></span>
<span id="cb473-20"><a href="stats_method.html#cb473-20" tabindex="-1"></a>      final_predicted_slash_piles <span class="sc">%&gt;%</span> </span>
<span id="cb473-21"><a href="stats_method.html#cb473-21" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">filter</span>(is_in_stand) <span class="sc">%&gt;%</span> </span>
<span id="cb473-22"><a href="stats_method.html#cb473-22" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">left_join</span>(</span>
<span id="cb473-23"><a href="stats_method.html#cb473-23" tabindex="-1"></a>        ground_truth_prediction_match_ans <span class="sc">%&gt;%</span></span>
<span id="cb473-24"><a href="stats_method.html#cb473-24" tabindex="-1"></a>          dplyr<span class="sc">::</span><span class="fu">select</span>(pred_id,match_grp)</span>
<span id="cb473-25"><a href="stats_method.html#cb473-25" tabindex="-1"></a>        , <span class="at">by =</span> <span class="st">&quot;pred_id&quot;</span></span>
<span id="cb473-26"><a href="stats_method.html#cb473-26" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span> </span>
<span id="cb473-27"><a href="stats_method.html#cb473-27" tabindex="-1"></a>      sf<span class="sc">::</span><span class="fu">st_transform</span>(sf<span class="sc">::</span><span class="fu">st_crs</span>(ortho_rast))</span>
<span id="cb473-28"><a href="stats_method.html#cb473-28" tabindex="-1"></a>    , <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">fill =</span> match_grp, <span class="at">color =</span> match_grp)</span>
<span id="cb473-29"><a href="stats_method.html#cb473-29" tabindex="-1"></a>    , <span class="at">alpha =</span> <span class="dv">0</span></span>
<span id="cb473-30"><a href="stats_method.html#cb473-30" tabindex="-1"></a>    , <span class="at">lwd =</span> <span class="fl">0.3</span></span>
<span id="cb473-31"><a href="stats_method.html#cb473-31" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb473-32"><a href="stats_method.html#cb473-32" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_fill_manual</span>(<span class="at">values =</span> pal_match_grp, <span class="at">name =</span> <span class="st">&quot;&quot;</span>) <span class="sc">+</span></span>
<span id="cb473-33"><a href="stats_method.html#cb473-33" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_color_manual</span>(<span class="at">values =</span> pal_match_grp, <span class="at">name =</span> <span class="st">&quot;&quot;</span>) <span class="sc">+</span></span>
<span id="cb473-34"><a href="stats_method.html#cb473-34" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;top&quot;</span>) <span class="sc">+</span></span>
<span id="cb473-35"><a href="stats_method.html#cb473-35" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">guides</span>(</span>
<span id="cb473-36"><a href="stats_method.html#cb473-36" tabindex="-1"></a>    <span class="at">fill =</span> ggplot2<span class="sc">::</span><span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">color =</span> <span class="fu">c</span>(<span class="cn">NA</span>,<span class="cn">NA</span>,pal_match_grp[<span class="st">&quot;commission&quot;</span>])))</span>
<span id="cb473-37"><a href="stats_method.html#cb473-37" tabindex="-1"></a>    , <span class="at">color =</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb473-38"><a href="stats_method.html#cb473-38" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## |---------|---------|---------|---------|=========================================                                          </code></pre>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-445-1.png" width="1008" /></p>
<p>there are many TP matches there!</p>
<div class="sourceCode" id="cb475"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb475-1"><a href="stats_method.html#cb475-1" tabindex="-1"></a>agg_ground_truth_match_ans <span class="sc">%&gt;%</span> </span>
<span id="cb475-2"><a href="stats_method.html#cb475-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_n&quot;</span>))</span></code></pre></div>
<pre><code>## # A tibble: 1 × 3
##    tp_n  fp_n  fn_n
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1   107    30    14</code></pre>
<p>let’s look at some examples on our RGB image</p>
<p><strong>commissions (false positives)</strong></p>
<p>predicted pile outlined in brown</p>
<div class="sourceCode" id="cb477"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb477-1"><a href="stats_method.html#cb477-1" tabindex="-1"></a>plts_temp <span class="ot">&lt;-</span></span>
<span id="cb477-2"><a href="stats_method.html#cb477-2" tabindex="-1"></a>  <span class="fu">which</span>(ground_truth_prediction_match_ans<span class="sc">$</span>match_grp <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;commission&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb477-3"><a href="stats_method.html#cb477-3" tabindex="-1"></a>  <span class="fu">sample</span>( <span class="fu">min</span>(<span class="dv">16</span>,agg_ground_truth_match_ans<span class="sc">$</span>fp_n) ) <span class="sc">%&gt;%</span> </span>
<span id="cb477-4"><a href="stats_method.html#cb477-4" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">map</span>(<span class="cf">function</span>(x){</span>
<span id="cb477-5"><a href="stats_method.html#cb477-5" tabindex="-1"></a>    dta <span class="ot">&lt;-</span> ground_truth_prediction_match_ans <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">slice</span>(x)</span>
<span id="cb477-6"><a href="stats_method.html#cb477-6" tabindex="-1"></a>    pr <span class="ot">&lt;-</span> final_predicted_slash_piles <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(pred_id<span class="sc">==</span>dta<span class="sc">$</span>pred_id)</span>
<span id="cb477-7"><a href="stats_method.html#cb477-7" tabindex="-1"></a>    <span class="co">#plt</span></span>
<span id="cb477-8"><a href="stats_method.html#cb477-8" tabindex="-1"></a>    <span class="fu">ortho_plt_fn</span>(<span class="at">my_ortho_rast=</span>ortho_rast, <span class="at">stand=</span>sf<span class="sc">::</span><span class="fu">st_union</span>(pr), <span class="at">buffer=</span><span class="dv">6</span>) <span class="sc">+</span></span>
<span id="cb477-9"><a href="stats_method.html#cb477-9" tabindex="-1"></a>      ggplot2<span class="sc">::</span><span class="fu">geom_sf</span>(<span class="at">data =</span> pr, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">color =</span> <span class="st">&quot;brown&quot;</span>, <span class="at">lwd =</span> <span class="fl">0.5</span>)</span>
<span id="cb477-10"><a href="stats_method.html#cb477-10" tabindex="-1"></a>  })</span>
<span id="cb477-11"><a href="stats_method.html#cb477-11" tabindex="-1"></a><span class="co"># combine</span></span>
<span id="cb477-12"><a href="stats_method.html#cb477-12" tabindex="-1"></a>patchwork<span class="sc">::</span><span class="fu">wrap_plots</span>(</span>
<span id="cb477-13"><a href="stats_method.html#cb477-13" tabindex="-1"></a>  plts_temp</span>
<span id="cb477-14"><a href="stats_method.html#cb477-14" tabindex="-1"></a>  , <span class="at">ncol =</span> <span class="dv">4</span></span>
<span id="cb477-15"><a href="stats_method.html#cb477-15" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-447-1.png" width="816" /></p>
<p>there are rocks, shadows, root bundles, downed trees with branches…</p>
<p><strong>omissions (false negatives)</strong></p>
<p>actual piles outlined in blue</p>
<div class="sourceCode" id="cb478"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb478-1"><a href="stats_method.html#cb478-1" tabindex="-1"></a>plts_temp <span class="ot">&lt;-</span></span>
<span id="cb478-2"><a href="stats_method.html#cb478-2" tabindex="-1"></a>  <span class="fu">which</span>(ground_truth_prediction_match_ans<span class="sc">$</span>match_grp <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;omission&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb478-3"><a href="stats_method.html#cb478-3" tabindex="-1"></a>  <span class="fu">sample</span>( <span class="fu">min</span>(<span class="dv">16</span>,agg_ground_truth_match_ans<span class="sc">$</span>fn_n) ) <span class="sc">%&gt;%</span> </span>
<span id="cb478-4"><a href="stats_method.html#cb478-4" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">map</span>(<span class="cf">function</span>(x){</span>
<span id="cb478-5"><a href="stats_method.html#cb478-5" tabindex="-1"></a>    dta <span class="ot">&lt;-</span> ground_truth_prediction_match_ans <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">slice</span>(x)</span>
<span id="cb478-6"><a href="stats_method.html#cb478-6" tabindex="-1"></a>    gt <span class="ot">&lt;-</span> slash_piles_polys <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(pile_id<span class="sc">==</span>dta<span class="sc">$</span>pile_id)</span>
<span id="cb478-7"><a href="stats_method.html#cb478-7" tabindex="-1"></a></span>
<span id="cb478-8"><a href="stats_method.html#cb478-8" tabindex="-1"></a>    <span class="co">#plt</span></span>
<span id="cb478-9"><a href="stats_method.html#cb478-9" tabindex="-1"></a>    <span class="fu">ortho_plt_fn</span>(<span class="at">my_ortho_rast=</span>ortho_rast, <span class="at">stand=</span>sf<span class="sc">::</span><span class="fu">st_union</span>(gt), <span class="at">buffer=</span><span class="dv">6</span>) <span class="sc">+</span></span>
<span id="cb478-10"><a href="stats_method.html#cb478-10" tabindex="-1"></a>      ggplot2<span class="sc">::</span><span class="fu">geom_sf</span>(<span class="at">data =</span> gt, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">color =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">lwd =</span> <span class="fl">0.6</span>)</span>
<span id="cb478-11"><a href="stats_method.html#cb478-11" tabindex="-1"></a>  })</span>
<span id="cb478-12"><a href="stats_method.html#cb478-12" tabindex="-1"></a><span class="co"># combine</span></span>
<span id="cb478-13"><a href="stats_method.html#cb478-13" tabindex="-1"></a>patchwork<span class="sc">::</span><span class="fu">wrap_plots</span>(</span>
<span id="cb478-14"><a href="stats_method.html#cb478-14" tabindex="-1"></a>  plts_temp</span>
<span id="cb478-15"><a href="stats_method.html#cb478-15" tabindex="-1"></a>  , <span class="at">ncol =</span> <span class="dv">4</span></span>
<span id="cb478-16"><a href="stats_method.html#cb478-16" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-448-1.png" width="816" /></p>
<p>for the most part, those are irregularly shaped or have unexpected spectral signatures (e.g. very white or entirely in dark shadows). however, the machine piles might have been larger than our expected area threshold <code>max_area_m2</code> or taller than our expected height threshold <code>max_ht_m</code></p>
</div>
<div id="training_detect_final_volcomp" class="section level3 hasAnchor" number="9.5.3">
<h3><span class="header-section-number">9.5.3</span> Volume Comparison<a href="stats_method.html#training_detect_final_volcomp" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The ground truth dataset used for developing and tuning all slash pile detection parameters includes direct data for field-measured height, field-measured diameter, and image-annotated area (based on pile perimeters). Accuracy and error metrics, such as ME, RMSE, and MAPE, will be only calculated for these direct measurements.</p>
<p>We excluded quantification accuracy metrics for derived volume because the resulting value would not constitute a true “error”. Comparing our predicted volume to a volume that was <em>not</em> directly measured, but instead calculated using a geometric assumption (like assuming a perfectly circular base and paraboloid shape) would be inappropriate. This is because any resulting difference between the prediction and the ground truth would be a blend of three inseparable factors: the error of the remote-sensing prediction method, the error in the direct field measurements (diameter/height), and the error introduced by the geometric shape assumption. Reporting such combined errors would be misleading, as it would be impossible to isolate the true performance of our remote-sensing method alone.</p>
<p>Instead, data involving derived values of volume based on field measurements and a shape assumption and its comparison to our irregularly shaped CHM-derived volume will be treated simply as data points for insight into the differences. Using geometric shape assumptions for estimating pile volume is the standard practice when implementing prescriptions or preparing for slash pile burning (<a href="https://permanent.fdlp.gov/gpo45282/index.htm">Hardy 1996</a>; <a href="https://doi.org/10.5849/forsci.13-501">Long &amp; Boston 2014</a>). This comparison will help us understand the discrepancy between our irregularly shaped CHM-derived volume and the volume calculated assuming a perfectly circular base and paraboloid shape with field-measured height and diameter. This approach will still provide valuable context about the impact of the perfectly circular base and paraboloid geometric assumptions without falsely attributing the error of the simplified model to the remote-sensing method itself.</p>
<p>let’s do that now</p>
<ul>
<li><strong>field-measured piles</strong>
<ul>
<li><strong>volume</strong> assumes a paraboloid shape, with volume calculated using the field-measured diameter (as the width) and height. we’ll refer to this as “Allometric Field Volume” to indicate the field measurement is derived using a shape assumption.</li>
</ul></li>
<li><strong>predicted piles</strong>
<ul>
<li><strong>volume</strong> calculated from the elevation profile of the irregular predicted pile footprint, without assuming a specific geometric shape. we’ll refer to this as “Predicted Volume” to indicate the predicted measurement is from our CHM-based detection methodology</li>
</ul></li>
</ul>
<p>We would generally expect that the allometric field volume is larger than the predicted volume because the allometric calculation assumes a perfectly regular geometric shape (circular base and paraboloid) based on maximum field dimensions (height and diameter). this process effectively encloses the actual, irregular pile form within a simplified geometric dome which inherently neglects and sits above the actual irregularities and voids in the pile structure, likely leading to an overestimation of the volume.</p>
<p>we already added volume measurements to the TP matches for both the ground truth and predicted piles, summary of that data</p>
<div class="sourceCode" id="cb479"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb479-1"><a href="stats_method.html#cb479-1" tabindex="-1"></a>ground_truth_prediction_match_ans <span class="sc">%&gt;%</span> </span>
<span id="cb479-2"><a href="stats_method.html#cb479-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(match_grp<span class="sc">==</span><span class="st">&quot;true positive&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb479-3"><a href="stats_method.html#cb479-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(gt_volume_m3, pred_volume_m3) <span class="sc">%&gt;%</span> </span>
<span id="cb479-4"><a href="stats_method.html#cb479-4" tabindex="-1"></a>  <span class="fu">summary</span>()</span></code></pre></div>
<pre><code>##   gt_volume_m3     pred_volume_m3  
##  Min.   :  4.270   Min.   : 1.109  
##  1st Qu.:  6.564   1st Qu.: 4.276  
##  Median :  7.497   Median : 5.216  
##  Mean   : 12.375   Mean   : 7.136  
##  3rd Qu.:  8.746   3rd Qu.: 7.054  
##  Max.   :183.080   Max.   :46.122</code></pre>
<p>those don’t really look like they match up well…let’s explore</p>
<div class="sourceCode" id="cb481"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb481-1"><a href="stats_method.html#cb481-1" tabindex="-1"></a>ground_truth_prediction_match_ans <span class="sc">%&gt;%</span> </span>
<span id="cb481-2"><a href="stats_method.html#cb481-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(match_grp<span class="sc">==</span><span class="st">&quot;true positive&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb481-3"><a href="stats_method.html#cb481-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">diff_volume_m3 =</span> gt_volume_m3 <span class="sc">-</span> pred_volume_m3) <span class="sc">%&gt;%</span> </span>
<span id="cb481-4"><a href="stats_method.html#cb481-4" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">y =</span> gt_volume_m3, <span class="at">x =</span> pred_volume_m3)) <span class="sc">+</span></span>
<span id="cb481-5"><a href="stats_method.html#cb481-5" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_abline</span>(<span class="at">lwd =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb481-6"><a href="stats_method.html#cb481-6" tabindex="-1"></a>  <span class="co"># ggplot2::geom_point(ggplot2::aes(color = diff_volume_m3)) +</span></span>
<span id="cb481-7"><a href="stats_method.html#cb481-7" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">&quot;navy&quot;</span>) <span class="sc">+</span></span>
<span id="cb481-8"><a href="stats_method.html#cb481-8" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="at">se=</span>F, <span class="at">color =</span> <span class="st">&quot;tomato&quot;</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb481-9"><a href="stats_method.html#cb481-9" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_color_viridis_c</span>(<span class="at">option =</span> <span class="st">&quot;mako&quot;</span>, <span class="at">direction =</span> <span class="sc">-</span><span class="dv">1</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb481-10"><a href="stats_method.html#cb481-10" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">max</span>( <span class="fu">max</span>(ground_truth_prediction_match_ans<span class="sc">$</span>pred_volume_m3,<span class="at">na.rm=</span>T), <span class="fu">max</span>(ground_truth_prediction_match_ans<span class="sc">$</span>gt_volume_m3,<span class="at">na.rm=</span>T) ) )) <span class="sc">+</span></span>
<span id="cb481-11"><a href="stats_method.html#cb481-11" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">max</span>( <span class="fu">max</span>(ground_truth_prediction_match_ans<span class="sc">$</span>pred_volume_m3,<span class="at">na.rm=</span>T), <span class="fu">max</span>(ground_truth_prediction_match_ans<span class="sc">$</span>gt_volume_m3,<span class="at">na.rm=</span>T) ) )) <span class="sc">+</span></span>
<span id="cb481-12"><a href="stats_method.html#cb481-12" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb481-13"><a href="stats_method.html#cb481-13" tabindex="-1"></a>    <span class="at">y =</span> latex2exp<span class="sc">::</span><span class="fu">TeX</span>(<span class="st">&quot;allometric field volume $m^3$&quot;</span>)</span>
<span id="cb481-14"><a href="stats_method.html#cb481-14" tabindex="-1"></a>    , <span class="at">x =</span> latex2exp<span class="sc">::</span><span class="fu">TeX</span>(<span class="st">&quot;predicted volume $m^3$&quot;</span>)</span>
<span id="cb481-15"><a href="stats_method.html#cb481-15" tabindex="-1"></a>    <span class="co"># , color = &quot;image-field\ndiameter diff.&quot;</span></span>
<span id="cb481-16"><a href="stats_method.html#cb481-16" tabindex="-1"></a>    , <span class="at">subtitle =</span> latex2exp<span class="sc">::</span><span class="fu">TeX</span>(<span class="st">&quot;bulk volume ($m^3$) comparison&quot;</span>)</span>
<span id="cb481-17"><a href="stats_method.html#cb481-17" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb481-18"><a href="stats_method.html#cb481-18" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_light</span>()</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-450-1.png" width="1008" /></p>
<p>this is exactly what we expected: for true positive matches, there is a clear systematic difference with the plot showing that the volume calculated using the idealized, regular shape assumption (allometric field volume) is consistently larger than the predicted volume derived from the CHM</p>
<p>let’s check these using <code>lm()</code></p>
<div class="sourceCode" id="cb482"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb482-1"><a href="stats_method.html#cb482-1" tabindex="-1"></a>lm_temp <span class="ot">&lt;-</span> <span class="fu">lm</span>(gt_volume_m3 <span class="sc">~</span> pred_volume_m3, <span class="at">data =</span> ground_truth_prediction_match_ans <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(match_grp<span class="sc">==</span><span class="st">&quot;true positive&quot;</span>))</span>
<span id="cb482-2"><a href="stats_method.html#cb482-2" tabindex="-1"></a><span class="fu">summary</span>(lm_temp)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = gt_volume_m3 ~ pred_volume_m3, data = ground_truth_prediction_match_ans %&gt;% 
##     dplyr::filter(match_grp == &quot;true positive&quot;))
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -37.174  -3.524   0.247   3.327  66.142 
## 
## Coefficients:
##                Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)     -6.7649     1.5273  -4.429 2.33e-05 ***
## pred_volume_m3   2.6820     0.1517  17.682  &lt; 2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 11.15 on 105 degrees of freedom
## Multiple R-squared:  0.7486, Adjusted R-squared:  0.7462 
## F-statistic: 312.6 on 1 and 105 DF,  p-value: &lt; 2.2e-16</code></pre>
<p>These linear model results (intercept = -6.76, slope = 2.68) indicate a strong proportional bias that significantly increases with pile size. The high slope (2.68) coupled with the negative intercept (-6.76) indicate that the volume difference is not a simple constant offset (e.g. slope of ~1.0 and intercept of &gt;0 if our hypothesis of consistently higher allometric field volume is true), but rather a scaling issue that is driven by the largest piles. The much larger allometric field volume estimates relative to the CHM-predicted volumes for the largest piles exert a strong influence on the predicted form of the liner model, pulling the slope steeply upward and forcing the intercept below zero as a mathematical artifact. Despite the predicted negative intercept, visual inspection of the data shows that most allometric field volumes are larger than the CHM-predicted volumes, even for smaller piles. The slope value indicates that for every 1 m<sup>3</sup> increase in predicted volume, the allometric field volume increases by nearly 2.68 m<sup>3</sup>. This data suggests that the geometric assumptions of the allometric model potentially introduce substantial scaling error which may limit its reliability (especially for larger piles) for accurately estimating the volume of real-world piles which have heterogeneous footprints and elevation profiles.</p>
<p>before we compare the volume measurements in aggregate, let’s look at the distributions</p>
<div class="sourceCode" id="cb484"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb484-1"><a href="stats_method.html#cb484-1" tabindex="-1"></a>vol_df_temp <span class="ot">&lt;-</span> </span>
<span id="cb484-2"><a href="stats_method.html#cb484-2" tabindex="-1"></a>  ground_truth_prediction_match_ans <span class="sc">%&gt;%</span> </span>
<span id="cb484-3"><a href="stats_method.html#cb484-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(match_grp<span class="sc">==</span><span class="st">&quot;true positive&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb484-4"><a href="stats_method.html#cb484-4" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(pile_id,gt_volume_m3,pred_volume_m3) <span class="sc">%&gt;%</span> </span>
<span id="cb484-5"><a href="stats_method.html#cb484-5" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span><span class="fu">c</span>(pile_id)) <span class="sc">%&gt;%</span> </span>
<span id="cb484-6"><a href="stats_method.html#cb484-6" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb484-7"><a href="stats_method.html#cb484-7" tabindex="-1"></a>    <span class="at">name =</span> <span class="fu">factor</span>(</span>
<span id="cb484-8"><a href="stats_method.html#cb484-8" tabindex="-1"></a>      name</span>
<span id="cb484-9"><a href="stats_method.html#cb484-9" tabindex="-1"></a>      , <span class="at">ordered =</span> T</span>
<span id="cb484-10"><a href="stats_method.html#cb484-10" tabindex="-1"></a>      , <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;gt_volume_m3&quot;</span>,<span class="st">&quot;pred_volume_m3&quot;</span>)</span>
<span id="cb484-11"><a href="stats_method.html#cb484-11" tabindex="-1"></a>      , <span class="at">labels =</span> <span class="fu">c</span>(</span>
<span id="cb484-12"><a href="stats_method.html#cb484-12" tabindex="-1"></a>        <span class="st">&quot;allometric field volume&quot;</span></span>
<span id="cb484-13"><a href="stats_method.html#cb484-13" tabindex="-1"></a>        , <span class="st">&quot;predicted volume&quot;</span></span>
<span id="cb484-14"><a href="stats_method.html#cb484-14" tabindex="-1"></a>      )</span>
<span id="cb484-15"><a href="stats_method.html#cb484-15" tabindex="-1"></a>    )</span>
<span id="cb484-16"><a href="stats_method.html#cb484-16" tabindex="-1"></a>  ) </span>
<span id="cb484-17"><a href="stats_method.html#cb484-17" tabindex="-1"></a><span class="co"># plot dist</span></span>
<span id="cb484-18"><a href="stats_method.html#cb484-18" tabindex="-1"></a>vol_df_temp <span class="sc">%&gt;%</span> </span>
<span id="cb484-19"><a href="stats_method.html#cb484-19" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">color =</span> name, <span class="at">fill =</span> name)) <span class="sc">+</span></span>
<span id="cb484-20"><a href="stats_method.html#cb484-20" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_density</span>(<span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">y=</span>ggplot2<span class="sc">::</span><span class="fu">after_stat</span>(scaled)), <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb484-21"><a href="stats_method.html#cb484-21" tabindex="-1"></a>  harrypotter<span class="sc">::</span><span class="fu">scale_color_hp_d</span>(<span class="at">option =</span> <span class="st">&quot;lunalovegood&quot;</span>) <span class="sc">+</span></span>
<span id="cb484-22"><a href="stats_method.html#cb484-22" tabindex="-1"></a>  harrypotter<span class="sc">::</span><span class="fu">scale_fill_hp_d</span>(<span class="at">option =</span> <span class="st">&quot;lunalovegood&quot;</span>) <span class="sc">+</span></span>
<span id="cb484-23"><a href="stats_method.html#cb484-23" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>,<span class="at">breaks=</span><span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb484-24"><a href="stats_method.html#cb484-24" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb484-25"><a href="stats_method.html#cb484-25" tabindex="-1"></a>    <span class="at">color=</span><span class="st">&quot;&quot;</span>,<span class="at">fill=</span><span class="st">&quot;&quot;</span>,<span class="at">x=</span>latex2exp<span class="sc">::</span><span class="fu">TeX</span>(<span class="st">&quot;volume $m^3$&quot;</span>)</span>
<span id="cb484-26"><a href="stats_method.html#cb484-26" tabindex="-1"></a>    , <span class="at">subtitle =</span> latex2exp<span class="sc">::</span><span class="fu">TeX</span>(<span class="st">&quot;bulk volume ($m^3$) comparison of distributions&quot;</span>)</span>
<span id="cb484-27"><a href="stats_method.html#cb484-27" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb484-28"><a href="stats_method.html#cb484-28" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb484-29"><a href="stats_method.html#cb484-29" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb484-30"><a href="stats_method.html#cb484-30" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;top&quot;</span></span>
<span id="cb484-31"><a href="stats_method.html#cb484-31" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-452-1.png" width="1008" /></p>
<p>slope plots are neat too</p>
<div class="sourceCode" id="cb485"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb485-1"><a href="stats_method.html#cb485-1" tabindex="-1"></a>vol_df_temp <span class="sc">%&gt;%</span> </span>
<span id="cb485-2"><a href="stats_method.html#cb485-2" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(</span>
<span id="cb485-3"><a href="stats_method.html#cb485-3" tabindex="-1"></a>    <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> name, <span class="at">y =</span> value, <span class="at">group =</span> pile_id)</span>
<span id="cb485-4"><a href="stats_method.html#cb485-4" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb485-5"><a href="stats_method.html#cb485-5" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_line</span>(<span class="at">key_glyph =</span> <span class="st">&quot;point&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>, <span class="at">color =</span> <span class="st">&quot;gray&quot;</span>, <span class="at">lwd =</span> <span class="fl">1.1</span>) <span class="sc">+</span></span>
<span id="cb485-6"><a href="stats_method.html#cb485-6" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_point</span>(<span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">color =</span> name), <span class="at">alpha =</span> <span class="fl">0.7</span>, <span class="at">size =</span> <span class="fl">2.5</span>) <span class="sc">+</span></span>
<span id="cb485-7"><a href="stats_method.html#cb485-7" tabindex="-1"></a>  harrypotter<span class="sc">::</span><span class="fu">scale_color_hp_d</span>(<span class="at">option =</span> <span class="st">&quot;lunalovegood&quot;</span>) <span class="sc">+</span></span>
<span id="cb485-8"><a href="stats_method.html#cb485-8" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb485-9"><a href="stats_method.html#cb485-9" tabindex="-1"></a>    <span class="at">color=</span><span class="st">&quot;&quot;</span></span>
<span id="cb485-10"><a href="stats_method.html#cb485-10" tabindex="-1"></a>    , <span class="at">y =</span> latex2exp<span class="sc">::</span><span class="fu">TeX</span>(<span class="st">&quot;volume $m^3$&quot;</span>)</span>
<span id="cb485-11"><a href="stats_method.html#cb485-11" tabindex="-1"></a>    , <span class="at">x =</span> <span class="st">&quot;&quot;</span></span>
<span id="cb485-12"><a href="stats_method.html#cb485-12" tabindex="-1"></a>    , <span class="at">subtitle =</span> latex2exp<span class="sc">::</span><span class="fu">TeX</span>(<span class="st">&quot;bulk volume ($m^3$) comparison at the pile level&quot;</span>)</span>
<span id="cb485-13"><a href="stats_method.html#cb485-13" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb485-14"><a href="stats_method.html#cb485-14" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb485-15"><a href="stats_method.html#cb485-15" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb485-16"><a href="stats_method.html#cb485-16" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb485-17"><a href="stats_method.html#cb485-17" tabindex="-1"></a>    , <span class="at">axis.title =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>)</span>
<span id="cb485-18"><a href="stats_method.html#cb485-18" tabindex="-1"></a>    , <span class="at">axis.text =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>)</span>
<span id="cb485-19"><a href="stats_method.html#cb485-19" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-453-1.png" width="1008" /></p>
<p>what if we only look at the smaller piles?</p>
<div class="sourceCode" id="cb486"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb486-1"><a href="stats_method.html#cb486-1" tabindex="-1"></a>vol_df_temp <span class="sc">%&gt;%</span> </span>
<span id="cb486-2"><a href="stats_method.html#cb486-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(</span>
<span id="cb486-3"><a href="stats_method.html#cb486-3" tabindex="-1"></a>    value <span class="sc">&lt;</span> <span class="fu">quantile</span>(vol_df_temp<span class="sc">$</span>value, <span class="at">probs =</span> <span class="fl">0.938</span>)</span>
<span id="cb486-4"><a href="stats_method.html#cb486-4" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb486-5"><a href="stats_method.html#cb486-5" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(</span>
<span id="cb486-6"><a href="stats_method.html#cb486-6" tabindex="-1"></a>    <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> name, <span class="at">y =</span> value, <span class="at">group =</span> pile_id)</span>
<span id="cb486-7"><a href="stats_method.html#cb486-7" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb486-8"><a href="stats_method.html#cb486-8" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_line</span>(<span class="at">key_glyph =</span> <span class="st">&quot;point&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>, <span class="at">color =</span> <span class="st">&quot;gray&quot;</span>, <span class="at">lwd =</span> <span class="fl">1.1</span>) <span class="sc">+</span></span>
<span id="cb486-9"><a href="stats_method.html#cb486-9" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_point</span>(<span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">color =</span> name), <span class="at">alpha =</span> <span class="fl">0.7</span>, <span class="at">size =</span> <span class="fl">2.5</span>) <span class="sc">+</span></span>
<span id="cb486-10"><a href="stats_method.html#cb486-10" tabindex="-1"></a>  harrypotter<span class="sc">::</span><span class="fu">scale_color_hp_d</span>(<span class="at">option =</span> <span class="st">&quot;lunalovegood&quot;</span>) <span class="sc">+</span></span>
<span id="cb486-11"><a href="stats_method.html#cb486-11" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb486-12"><a href="stats_method.html#cb486-12" tabindex="-1"></a>    <span class="at">color=</span><span class="st">&quot;&quot;</span></span>
<span id="cb486-13"><a href="stats_method.html#cb486-13" tabindex="-1"></a>    , <span class="at">y =</span> latex2exp<span class="sc">::</span><span class="fu">TeX</span>(<span class="st">&quot;volume $m^3$&quot;</span>)</span>
<span id="cb486-14"><a href="stats_method.html#cb486-14" tabindex="-1"></a>    , <span class="at">x =</span> <span class="st">&quot;&quot;</span></span>
<span id="cb486-15"><a href="stats_method.html#cb486-15" tabindex="-1"></a>    , <span class="at">subtitle =</span> latex2exp<span class="sc">::</span><span class="fu">TeX</span>(<span class="st">&quot;bulk volume ($m^3$) comparison at the pile level for the smaller piles&quot;</span>)</span>
<span id="cb486-16"><a href="stats_method.html#cb486-16" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb486-17"><a href="stats_method.html#cb486-17" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb486-18"><a href="stats_method.html#cb486-18" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb486-19"><a href="stats_method.html#cb486-19" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb486-20"><a href="stats_method.html#cb486-20" tabindex="-1"></a>    , <span class="at">axis.title =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>)</span>
<span id="cb486-21"><a href="stats_method.html#cb486-21" tabindex="-1"></a>    , <span class="at">axis.text =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>)</span>
<span id="cb486-22"><a href="stats_method.html#cb486-22" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-454-1.png" width="1008" /></p>
<p>let’s compare aggregated volume measurements for the true positive matches</p>
<p><strong>Mean Difference (MD):</strong>
<span class="math display">\[\text{MD} = \frac{1}{N} \sum_{i=1}^{N} (\text{Allometric Volume}_i - \text{Predicted Volume}_i)\]</span></p>
<p><strong>Percent Mean Difference:</strong>
<span class="math display">\[\%\text{MD} = \frac{\text{MD}}{\text{Mean}(\text{Predicted Volume})} \times 100\]</span></p>
<div class="sourceCode" id="cb487"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb487-1"><a href="stats_method.html#cb487-1" tabindex="-1"></a>vol_agg_df_temp <span class="ot">&lt;-</span> </span>
<span id="cb487-2"><a href="stats_method.html#cb487-2" tabindex="-1"></a>  ground_truth_prediction_match_ans <span class="sc">%&gt;%</span> </span>
<span id="cb487-3"><a href="stats_method.html#cb487-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(match_grp<span class="sc">==</span><span class="st">&quot;true positive&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb487-4"><a href="stats_method.html#cb487-4" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb487-5"><a href="stats_method.html#cb487-5" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(</span>
<span id="cb487-6"><a href="stats_method.html#cb487-6" tabindex="-1"></a>    <span class="at">mean_diff =</span> <span class="fu">mean</span>(gt_volume_m3<span class="sc">-</span>pred_volume_m3)</span>
<span id="cb487-7"><a href="stats_method.html#cb487-7" tabindex="-1"></a>    , <span class="at">sd_diff =</span> <span class="fu">sd</span>(gt_volume_m3<span class="sc">-</span>pred_volume_m3)</span>
<span id="cb487-8"><a href="stats_method.html#cb487-8" tabindex="-1"></a>    , <span class="at">mean_gt_volume_m3 =</span> <span class="fu">mean</span>(gt_volume_m3,<span class="at">na.rm =</span> T)</span>
<span id="cb487-9"><a href="stats_method.html#cb487-9" tabindex="-1"></a>    , <span class="at">mean_pred_volume_m3 =</span> <span class="fu">mean</span>(pred_volume_m3,<span class="at">na.rm =</span> T)</span>
<span id="cb487-10"><a href="stats_method.html#cb487-10" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb487-11"><a href="stats_method.html#cb487-11" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb487-12"><a href="stats_method.html#cb487-12" tabindex="-1"></a>    <span class="at">pct_mean_diff =</span> mean_diff<span class="sc">/</span>mean_pred_volume_m3</span>
<span id="cb487-13"><a href="stats_method.html#cb487-13" tabindex="-1"></a>  )</span></code></pre></div>
<p>what did we get?</p>
<div class="sourceCode" id="cb488"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb488-1"><a href="stats_method.html#cb488-1" tabindex="-1"></a>vol_agg_df_temp <span class="sc">%&gt;%</span> </span>
<span id="cb488-2"><a href="stats_method.html#cb488-2" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(dplyr<span class="sc">::</span><span class="fu">everything</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb488-3"><a href="stats_method.html#cb488-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb488-4"><a href="stats_method.html#cb488-4" tabindex="-1"></a>    <span class="at">value =</span> </span>
<span id="cb488-5"><a href="stats_method.html#cb488-5" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb488-6"><a href="stats_method.html#cb488-6" tabindex="-1"></a>        stringr<span class="sc">::</span><span class="fu">str_starts</span>(name, <span class="st">&quot;pct_&quot;</span>) <span class="sc">~</span> scales<span class="sc">::</span><span class="fu">percent</span>(value, <span class="at">accuracy =</span> <span class="fl">0.1</span>)</span>
<span id="cb488-7"><a href="stats_method.html#cb488-7" tabindex="-1"></a>        , T <span class="sc">~</span> scales<span class="sc">::</span><span class="fu">comma</span>(value, <span class="at">accuracy =</span> <span class="fl">0.1</span>)</span>
<span id="cb488-8"><a href="stats_method.html#cb488-8" tabindex="-1"></a>      )</span>
<span id="cb488-9"><a href="stats_method.html#cb488-9" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb488-10"><a href="stats_method.html#cb488-10" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kbl</span>(</span>
<span id="cb488-11"><a href="stats_method.html#cb488-11" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">&quot;comparison of aggregated allometric field volume and predicted volume&quot;</span></span>
<span id="cb488-12"><a href="stats_method.html#cb488-12" tabindex="-1"></a>    , <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">&quot;metric&quot;</span>, <span class="st">&quot;value&quot;</span>)</span>
<span id="cb488-13"><a href="stats_method.html#cb488-13" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb488-14"><a href="stats_method.html#cb488-14" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kable_styling</span>()</span></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-456">Table 9.31: </span>comparison of aggregated allometric field volume and predicted volume
</caption>
<thead>
<tr>
<th style="text-align:left;">
metric
</th>
<th style="text-align:left;">
value
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
mean_diff
</td>
<td style="text-align:left;">
5.2
</td>
</tr>
<tr>
<td style="text-align:left;">
sd_diff
</td>
<td style="text-align:left;">
16.3
</td>
</tr>
<tr>
<td style="text-align:left;">
mean_gt_volume_m3
</td>
<td style="text-align:left;">
12.4
</td>
</tr>
<tr>
<td style="text-align:left;">
mean_pred_volume_m3
</td>
<td style="text-align:left;">
7.1
</td>
</tr>
<tr>
<td style="text-align:left;">
pct_mean_diff
</td>
<td style="text-align:left;">
73.4%
</td>
</tr>
</tbody>
</table>
<p>we’ll dig into the MD shortly but before we move on let’s focus on the percent mean difference. We calcualted a %MD of 73.4% which indicates a major systematic difference where the allometric field volume is, on average, 73.4% larger than our CHM-predicted volume. This large relative difference shows how much the geometric assumptions inflate the volume compared to the irregular volumes measured by our remote sensing-based method.</p>
<p>let’s make a Bland-Altman plot to compare the two measurement methods. this plot uses the average of the two measurements (approximate size) on the x-axis and the difference (bias) between the two measurements on the y-axis</p>
<div class="sourceCode" id="cb489"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb489-1"><a href="stats_method.html#cb489-1" tabindex="-1"></a>ground_truth_prediction_match_ans <span class="sc">%&gt;%</span> </span>
<span id="cb489-2"><a href="stats_method.html#cb489-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(match_grp<span class="sc">==</span><span class="st">&quot;true positive&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb489-3"><a href="stats_method.html#cb489-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb489-4"><a href="stats_method.html#cb489-4" tabindex="-1"></a>  <span class="co"># calc needed metrics</span></span>
<span id="cb489-5"><a href="stats_method.html#cb489-5" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb489-6"><a href="stats_method.html#cb489-6" tabindex="-1"></a>    <span class="at">mean_vol =</span> (gt_volume_m3<span class="sc">+</span>pred_volume_m3)<span class="sc">/</span><span class="dv">2</span></span>
<span id="cb489-7"><a href="stats_method.html#cb489-7" tabindex="-1"></a>    , <span class="at">diff_vol =</span> (gt_volume_m3<span class="sc">-</span>pred_volume_m3) <span class="co"># match the order used in vol_agg_df_temp</span></span>
<span id="cb489-8"><a href="stats_method.html#cb489-8" tabindex="-1"></a>    , <span class="at">scale_diff =</span> <span class="fu">ifelse</span>(diff_vol <span class="sc">&lt;</span> <span class="dv">0</span>, <span class="sc">-</span><span class="fu">abs</span>(diff_vol) <span class="sc">/</span> <span class="fu">abs</span>(<span class="fu">min</span>(diff_vol)), diff_vol <span class="sc">/</span> <span class="fu">max</span>(diff_vol))</span>
<span id="cb489-9"><a href="stats_method.html#cb489-9" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb489-10"><a href="stats_method.html#cb489-10" tabindex="-1"></a>  <span class="co"># ggplot() + geom_point(aes(x=diff_vol,y=0, color=scale_diff)) + scale_color_gradient2(mid = &quot;gray&quot;, midpoint = 0, low = &quot;red&quot;, high = &quot;blue&quot;)</span></span>
<span id="cb489-11"><a href="stats_method.html#cb489-11" tabindex="-1"></a>  <span class="co"># plot</span></span>
<span id="cb489-12"><a href="stats_method.html#cb489-12" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(</span>
<span id="cb489-13"><a href="stats_method.html#cb489-13" tabindex="-1"></a>    <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> mean_vol, <span class="at">y =</span> diff_vol)</span>
<span id="cb489-14"><a href="stats_method.html#cb489-14" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb489-15"><a href="stats_method.html#cb489-15" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">lwd =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb489-16"><a href="stats_method.html#cb489-16" tabindex="-1"></a>  <span class="co"># mean difference (bias)</span></span>
<span id="cb489-17"><a href="stats_method.html#cb489-17" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_hline</span>(</span>
<span id="cb489-18"><a href="stats_method.html#cb489-18" tabindex="-1"></a>    <span class="at">yintercept =</span> vol_agg_df_temp<span class="sc">$</span>mean_diff</span>
<span id="cb489-19"><a href="stats_method.html#cb489-19" tabindex="-1"></a>    , <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>, <span class="at">color =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">lwd =</span> <span class="dv">1</span></span>
<span id="cb489-20"><a href="stats_method.html#cb489-20" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb489-21"><a href="stats_method.html#cb489-21" tabindex="-1"></a>  <span class="co"># upper limit</span></span>
<span id="cb489-22"><a href="stats_method.html#cb489-22" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_hline</span>(</span>
<span id="cb489-23"><a href="stats_method.html#cb489-23" tabindex="-1"></a>    <span class="at">yintercept =</span> vol_agg_df_temp<span class="sc">$</span>mean_diff<span class="fl">+1.96</span><span class="sc">*</span>vol_agg_df_temp<span class="sc">$</span>sd_diff</span>
<span id="cb489-24"><a href="stats_method.html#cb489-24" tabindex="-1"></a>    , <span class="at">linetype =</span> <span class="st">&quot;dotted&quot;</span>, <span class="at">color =</span> <span class="st">&quot;red&quot;</span>, <span class="at">lwd =</span> <span class="dv">1</span></span>
<span id="cb489-25"><a href="stats_method.html#cb489-25" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb489-26"><a href="stats_method.html#cb489-26" tabindex="-1"></a>  <span class="co"># lower limit</span></span>
<span id="cb489-27"><a href="stats_method.html#cb489-27" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_hline</span>(</span>
<span id="cb489-28"><a href="stats_method.html#cb489-28" tabindex="-1"></a>    <span class="at">yintercept =</span> vol_agg_df_temp<span class="sc">$</span>mean_diff<span class="fl">-1.96</span><span class="sc">*</span>vol_agg_df_temp<span class="sc">$</span>sd_diff</span>
<span id="cb489-29"><a href="stats_method.html#cb489-29" tabindex="-1"></a>    , <span class="at">linetype =</span> <span class="st">&quot;dotted&quot;</span>, <span class="at">color =</span> <span class="st">&quot;red&quot;</span>, <span class="at">lwd =</span> <span class="dv">1</span></span>
<span id="cb489-30"><a href="stats_method.html#cb489-30" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb489-31"><a href="stats_method.html#cb489-31" tabindex="-1"></a>  <span class="co"># annotations</span></span>
<span id="cb489-32"><a href="stats_method.html#cb489-32" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">annotate</span>(</span>
<span id="cb489-33"><a href="stats_method.html#cb489-33" tabindex="-1"></a>    <span class="st">&quot;text&quot;</span></span>
<span id="cb489-34"><a href="stats_method.html#cb489-34" tabindex="-1"></a>    , <span class="at">x =</span> <span class="cn">Inf</span></span>
<span id="cb489-35"><a href="stats_method.html#cb489-35" tabindex="-1"></a>    , <span class="at">y =</span> vol_agg_df_temp<span class="sc">$</span>mean_diff</span>
<span id="cb489-36"><a href="stats_method.html#cb489-36" tabindex="-1"></a>    , <span class="at">label =</span> latex2exp<span class="sc">::</span><span class="fu">TeX</span>(</span>
<span id="cb489-37"><a href="stats_method.html#cb489-37" tabindex="-1"></a>      <span class="fu">paste0</span>(</span>
<span id="cb489-38"><a href="stats_method.html#cb489-38" tabindex="-1"></a>        <span class="st">&quot;mean difference (bias): &quot;</span></span>
<span id="cb489-39"><a href="stats_method.html#cb489-39" tabindex="-1"></a>        , scales<span class="sc">::</span><span class="fu">comma</span>(vol_agg_df_temp<span class="sc">$</span>mean_diff, <span class="at">accuracy =</span> <span class="fl">0.01</span>)</span>
<span id="cb489-40"><a href="stats_method.html#cb489-40" tabindex="-1"></a>        , <span class="st">&quot; $m^3$&quot;</span></span>
<span id="cb489-41"><a href="stats_method.html#cb489-41" tabindex="-1"></a>      )</span>
<span id="cb489-42"><a href="stats_method.html#cb489-42" tabindex="-1"></a>      , <span class="at">output =</span> <span class="st">&quot;character&quot;</span></span>
<span id="cb489-43"><a href="stats_method.html#cb489-43" tabindex="-1"></a>    )</span>
<span id="cb489-44"><a href="stats_method.html#cb489-44" tabindex="-1"></a>    , <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.5</span></span>
<span id="cb489-45"><a href="stats_method.html#cb489-45" tabindex="-1"></a>    , <span class="at">hjust =</span> <span class="dv">1</span></span>
<span id="cb489-46"><a href="stats_method.html#cb489-46" tabindex="-1"></a>    , <span class="at">color =</span> <span class="st">&quot;blue&quot;</span></span>
<span id="cb489-47"><a href="stats_method.html#cb489-47" tabindex="-1"></a>    , <span class="at">size =</span> <span class="dv">4</span></span>
<span id="cb489-48"><a href="stats_method.html#cb489-48" tabindex="-1"></a>    , <span class="at">parse =</span> <span class="cn">TRUE</span></span>
<span id="cb489-49"><a href="stats_method.html#cb489-49" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb489-50"><a href="stats_method.html#cb489-50" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">annotate</span>(</span>
<span id="cb489-51"><a href="stats_method.html#cb489-51" tabindex="-1"></a>    <span class="st">&quot;text&quot;</span></span>
<span id="cb489-52"><a href="stats_method.html#cb489-52" tabindex="-1"></a>    , <span class="at">x =</span> <span class="cn">Inf</span></span>
<span id="cb489-53"><a href="stats_method.html#cb489-53" tabindex="-1"></a>    , <span class="at">y =</span> vol_agg_df_temp<span class="sc">$</span>mean_diff<span class="fl">+1.96</span><span class="sc">*</span>vol_agg_df_temp<span class="sc">$</span>sd_diff</span>
<span id="cb489-54"><a href="stats_method.html#cb489-54" tabindex="-1"></a>    , <span class="at">label =</span> latex2exp<span class="sc">::</span><span class="fu">TeX</span>(</span>
<span id="cb489-55"><a href="stats_method.html#cb489-55" tabindex="-1"></a>      <span class="fu">paste0</span>(</span>
<span id="cb489-56"><a href="stats_method.html#cb489-56" tabindex="-1"></a>        <span class="st">&quot;+1.96 SD: &quot;</span></span>
<span id="cb489-57"><a href="stats_method.html#cb489-57" tabindex="-1"></a>        , scales<span class="sc">::</span><span class="fu">comma</span>(vol_agg_df_temp<span class="sc">$</span>mean_diff<span class="fl">+1.96</span><span class="sc">*</span>vol_agg_df_temp<span class="sc">$</span>sd_diff, <span class="at">accuracy =</span> <span class="fl">0.01</span>)</span>
<span id="cb489-58"><a href="stats_method.html#cb489-58" tabindex="-1"></a>        , <span class="st">&quot; $m^3$&quot;</span></span>
<span id="cb489-59"><a href="stats_method.html#cb489-59" tabindex="-1"></a>      )</span>
<span id="cb489-60"><a href="stats_method.html#cb489-60" tabindex="-1"></a>      , <span class="at">output =</span> <span class="st">&quot;character&quot;</span></span>
<span id="cb489-61"><a href="stats_method.html#cb489-61" tabindex="-1"></a>    )</span>
<span id="cb489-62"><a href="stats_method.html#cb489-62" tabindex="-1"></a>    , <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.5</span></span>
<span id="cb489-63"><a href="stats_method.html#cb489-63" tabindex="-1"></a>    , <span class="at">hjust =</span> <span class="dv">1</span></span>
<span id="cb489-64"><a href="stats_method.html#cb489-64" tabindex="-1"></a>    , <span class="at">color =</span> <span class="st">&quot;red&quot;</span></span>
<span id="cb489-65"><a href="stats_method.html#cb489-65" tabindex="-1"></a>    , <span class="at">size =</span> <span class="dv">4</span></span>
<span id="cb489-66"><a href="stats_method.html#cb489-66" tabindex="-1"></a>    , <span class="at">parse =</span> <span class="cn">TRUE</span></span>
<span id="cb489-67"><a href="stats_method.html#cb489-67" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb489-68"><a href="stats_method.html#cb489-68" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">annotate</span>(</span>
<span id="cb489-69"><a href="stats_method.html#cb489-69" tabindex="-1"></a>    <span class="st">&quot;text&quot;</span></span>
<span id="cb489-70"><a href="stats_method.html#cb489-70" tabindex="-1"></a>    , <span class="at">x =</span> <span class="cn">Inf</span></span>
<span id="cb489-71"><a href="stats_method.html#cb489-71" tabindex="-1"></a>    , <span class="at">y =</span> vol_agg_df_temp<span class="sc">$</span>mean_diff<span class="fl">-1.96</span><span class="sc">*</span>vol_agg_df_temp<span class="sc">$</span>sd_diff</span>
<span id="cb489-72"><a href="stats_method.html#cb489-72" tabindex="-1"></a>    , <span class="at">label =</span> latex2exp<span class="sc">::</span><span class="fu">TeX</span>(</span>
<span id="cb489-73"><a href="stats_method.html#cb489-73" tabindex="-1"></a>      <span class="fu">paste0</span>(</span>
<span id="cb489-74"><a href="stats_method.html#cb489-74" tabindex="-1"></a>        <span class="st">&quot;-1.96 SD: &quot;</span></span>
<span id="cb489-75"><a href="stats_method.html#cb489-75" tabindex="-1"></a>        , scales<span class="sc">::</span><span class="fu">comma</span>(vol_agg_df_temp<span class="sc">$</span>mean_diff<span class="fl">-1.96</span><span class="sc">*</span>vol_agg_df_temp<span class="sc">$</span>sd_diff, <span class="at">accuracy =</span> <span class="fl">0.01</span>)</span>
<span id="cb489-76"><a href="stats_method.html#cb489-76" tabindex="-1"></a>        , <span class="st">&quot; $m^3$&quot;</span></span>
<span id="cb489-77"><a href="stats_method.html#cb489-77" tabindex="-1"></a>      )</span>
<span id="cb489-78"><a href="stats_method.html#cb489-78" tabindex="-1"></a>      , <span class="at">output =</span> <span class="st">&quot;character&quot;</span></span>
<span id="cb489-79"><a href="stats_method.html#cb489-79" tabindex="-1"></a>    )</span>
<span id="cb489-80"><a href="stats_method.html#cb489-80" tabindex="-1"></a>    , <span class="at">vjust =</span> <span class="fl">1.5</span></span>
<span id="cb489-81"><a href="stats_method.html#cb489-81" tabindex="-1"></a>    , <span class="at">hjust =</span> <span class="dv">1</span></span>
<span id="cb489-82"><a href="stats_method.html#cb489-82" tabindex="-1"></a>    , <span class="at">color =</span> <span class="st">&quot;red&quot;</span></span>
<span id="cb489-83"><a href="stats_method.html#cb489-83" tabindex="-1"></a>    , <span class="at">size =</span> <span class="dv">4</span></span>
<span id="cb489-84"><a href="stats_method.html#cb489-84" tabindex="-1"></a>    , <span class="at">parse =</span> <span class="cn">TRUE</span></span>
<span id="cb489-85"><a href="stats_method.html#cb489-85" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb489-86"><a href="stats_method.html#cb489-86" tabindex="-1"></a>  <span class="co"># points</span></span>
<span id="cb489-87"><a href="stats_method.html#cb489-87" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_point</span>(<span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">color =</span> scale_diff), <span class="at">size =</span> <span class="fl">1.9</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb489-88"><a href="stats_method.html#cb489-88" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_color_steps2</span>(<span class="at">mid =</span> <span class="st">&quot;gray&quot;</span>, <span class="at">midpoint =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb489-89"><a href="stats_method.html#cb489-89" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb489-90"><a href="stats_method.html#cb489-90" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">&quot;Bland-Altman plot: allometric field volume vs predicted volume&quot;</span></span>
<span id="cb489-91"><a href="stats_method.html#cb489-91" tabindex="-1"></a>    , <span class="at">x =</span> latex2exp<span class="sc">::</span><span class="fu">TeX</span>(<span class="st">&quot;mean volume ($m^3$)&quot;</span>)</span>
<span id="cb489-92"><a href="stats_method.html#cb489-92" tabindex="-1"></a>    , <span class="at">y =</span> latex2exp<span class="sc">::</span><span class="fu">TeX</span>(<span class="st">&quot;difference (allometric - predicted volume $m^3$)&quot;</span>)</span>
<span id="cb489-93"><a href="stats_method.html#cb489-93" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb489-94"><a href="stats_method.html#cb489-94" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb489-95"><a href="stats_method.html#cb489-95" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-457-1.png" width="1008" /></p>
<p>That’s a lot of plotting to show that the mean difference is 5.24 m<sup>3</sup>. Points falling outside the 95% interval on the plot are instances of significant disagreement between the two volume measurements for those specific data points. These outliers indicate that, for a particular pile, the difference between the allometric field volume and the predicted volume is unusually large, suggesting a potential failure in either the CHM segmentation process, the quality of the original field measurements, the geometric shape assumption, or a combination thereof. We should investigate these extreme disagreements further to see what is happening</p>
<p>before we do that, let’s use a paired t-test to determine if the mean difference (MD) between the allometric field volume and the predicted volume is statistically significant (i.e. significantly different from zero)</p>
<div class="sourceCode" id="cb490"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb490-1"><a href="stats_method.html#cb490-1" tabindex="-1"></a><span class="co"># is the mean difference between the two volumes significantly different from zero</span></span>
<span id="cb490-2"><a href="stats_method.html#cb490-2" tabindex="-1"></a>ttest_temp <span class="ot">&lt;-</span> <span class="fu">t.test</span>(</span>
<span id="cb490-3"><a href="stats_method.html#cb490-3" tabindex="-1"></a>  ground_truth_prediction_match_ans <span class="sc">%&gt;%</span> </span>
<span id="cb490-4"><a href="stats_method.html#cb490-4" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(match_grp <span class="sc">==</span> <span class="st">&quot;true positive&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb490-5"><a href="stats_method.html#cb490-5" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">pull</span>(gt_volume_m3)</span>
<span id="cb490-6"><a href="stats_method.html#cb490-6" tabindex="-1"></a>  , ground_truth_prediction_match_ans <span class="sc">%&gt;%</span> </span>
<span id="cb490-7"><a href="stats_method.html#cb490-7" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(match_grp <span class="sc">==</span> <span class="st">&quot;true positive&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb490-8"><a href="stats_method.html#cb490-8" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">pull</span>(pred_volume_m3)</span>
<span id="cb490-9"><a href="stats_method.html#cb490-9" tabindex="-1"></a>  , <span class="at">paired =</span> <span class="cn">TRUE</span></span>
<span id="cb490-10"><a href="stats_method.html#cb490-10" tabindex="-1"></a>)</span>
<span id="cb490-11"><a href="stats_method.html#cb490-11" tabindex="-1"></a>ttest_temp</span></code></pre></div>
<pre><code>## 
##  Paired t-test
## 
## data:  ground_truth_prediction_match_ans %&gt;% dplyr::filter(match_grp == &quot;true positive&quot;) %&gt;% dplyr::pull(gt_volume_m3) and ground_truth_prediction_match_ans %&gt;% dplyr::filter(match_grp == &quot;true positive&quot;) %&gt;% dplyr::pull(pred_volume_m3)
## t = 3.3155, df = 106, p-value = 0.001253
## alternative hypothesis: true mean difference is not equal to 0
## 95 percent confidence interval:
##  2.106105 8.371658
## sample estimates:
## mean difference 
##        5.238881</code></pre>
<p>that’s neat, the test gave us the same mean difference (MD) of 5.24 m<sup>3</sup> that we calculated above. also, the p-value of 0.00125 is less than 0.05, meaning we should reject the null hypothesis that the true mean difference is zero. this confirms that the systematic difference (or bias) we observed where allometric volume is larger than our predicted volume is statistically significant and not due to random chance.</p>
<div id="extreme-volume-disagreements" class="section level4 hasAnchor" number="9.5.3.1">
<h4><span class="header-section-number">9.5.3.1</span> Extreme Volume Disagreements<a href="stats_method.html#extreme-volume-disagreements" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>let’s investigate the extreme disagreements further to see what is happening</p>
<div class="sourceCode" id="cb492"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb492-1"><a href="stats_method.html#cb492-1" tabindex="-1"></a>bad_vol_df_temp <span class="ot">&lt;-</span> </span>
<span id="cb492-2"><a href="stats_method.html#cb492-2" tabindex="-1"></a>  ground_truth_prediction_match_ans <span class="sc">%&gt;%</span> </span>
<span id="cb492-3"><a href="stats_method.html#cb492-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(match_grp<span class="sc">==</span><span class="st">&quot;true positive&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb492-4"><a href="stats_method.html#cb492-4" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb492-5"><a href="stats_method.html#cb492-5" tabindex="-1"></a>  <span class="co"># calc needed metrics</span></span>
<span id="cb492-6"><a href="stats_method.html#cb492-6" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb492-7"><a href="stats_method.html#cb492-7" tabindex="-1"></a>    <span class="at">diff_vol =</span> (gt_volume_m3<span class="sc">-</span>pred_volume_m3) <span class="co"># match the order used in vol_agg_df_temp</span></span>
<span id="cb492-8"><a href="stats_method.html#cb492-8" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb492-9"><a href="stats_method.html#cb492-9" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(</span>
<span id="cb492-10"><a href="stats_method.html#cb492-10" tabindex="-1"></a>    diff_vol <span class="sc">&lt;</span> (vol_agg_df_temp<span class="sc">$</span>mean_diff<span class="fl">-1.96</span><span class="sc">*</span>vol_agg_df_temp<span class="sc">$</span>sd_diff)</span>
<span id="cb492-11"><a href="stats_method.html#cb492-11" tabindex="-1"></a>    <span class="sc">|</span> diff_vol <span class="sc">&gt;</span> (vol_agg_df_temp<span class="sc">$</span>mean_diff<span class="fl">+1.96</span><span class="sc">*</span>vol_agg_df_temp<span class="sc">$</span>sd_diff)</span>
<span id="cb492-12"><a href="stats_method.html#cb492-12" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb492-13"><a href="stats_method.html#cb492-13" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(</span>
<span id="cb492-14"><a href="stats_method.html#cb492-14" tabindex="-1"></a>    slash_piles_polys <span class="sc">%&gt;%</span> </span>
<span id="cb492-15"><a href="stats_method.html#cb492-15" tabindex="-1"></a>      sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb492-16"><a href="stats_method.html#cb492-16" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">select</span>(pile_id, comment) <span class="sc">%&gt;%</span> </span>
<span id="cb492-17"><a href="stats_method.html#cb492-17" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">pile_type =</span> comment)</span>
<span id="cb492-18"><a href="stats_method.html#cb492-18" tabindex="-1"></a>    , <span class="at">by =</span> <span class="st">&quot;pile_id&quot;</span></span>
<span id="cb492-19"><a href="stats_method.html#cb492-19" tabindex="-1"></a>  )</span>
<span id="cb492-20"><a href="stats_method.html#cb492-20" tabindex="-1"></a><span class="co"># what are the differences?</span></span>
<span id="cb492-21"><a href="stats_method.html#cb492-21" tabindex="-1"></a>bad_vol_df_temp <span class="sc">%&gt;%</span> </span>
<span id="cb492-22"><a href="stats_method.html#cb492-22" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb492-23"><a href="stats_method.html#cb492-23" tabindex="-1"></a>    pile_id, pile_type</span>
<span id="cb492-24"><a href="stats_method.html#cb492-24" tabindex="-1"></a>    , gt_height_m, pred_height_m, diff_height_m</span>
<span id="cb492-25"><a href="stats_method.html#cb492-25" tabindex="-1"></a>    , gt_diameter_m, pred_diameter_m, diff_field_diameter_m</span>
<span id="cb492-26"><a href="stats_method.html#cb492-26" tabindex="-1"></a>    , gt_volume_m3, pred_volume_m3</span>
<span id="cb492-27"><a href="stats_method.html#cb492-27" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb492-28"><a href="stats_method.html#cb492-28" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb492-29"><a href="stats_method.html#cb492-29" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">across</span>(</span>
<span id="cb492-30"><a href="stats_method.html#cb492-30" tabindex="-1"></a>      <span class="at">.cols =</span> <span class="sc">-</span><span class="fu">c</span>(pile_id,pile_type)</span>
<span id="cb492-31"><a href="stats_method.html#cb492-31" tabindex="-1"></a>      , <span class="at">.fns =</span> <span class="sc">~</span> scales<span class="sc">::</span><span class="fu">comma</span>(.x,<span class="at">accuracy=</span><span class="fl">0.01</span>)</span>
<span id="cb492-32"><a href="stats_method.html#cb492-32" tabindex="-1"></a>    )</span>
<span id="cb492-33"><a href="stats_method.html#cb492-33" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb492-34"><a href="stats_method.html#cb492-34" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kbl</span>(</span>
<span id="cb492-35"><a href="stats_method.html#cb492-35" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">&quot;Volume measurement outliers: comparison of ground truth and predicted piles&quot;</span></span>
<span id="cb492-36"><a href="stats_method.html#cb492-36" tabindex="-1"></a>    <span class="co"># , col.names = c(&quot;metric&quot;, &quot;value&quot;)</span></span>
<span id="cb492-37"><a href="stats_method.html#cb492-37" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb492-38"><a href="stats_method.html#cb492-38" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kable_styling</span>(<span class="at">font_size =</span> <span class="fl">9.8</span>)</span></code></pre></div>
<table class="table" style="font-size: 9.8px; margin-left: auto; margin-right: auto;">
<caption style="font-size: initial !important;">
<span id="tab:unnamed-chunk-459">Table 9.32: </span>Volume measurement outliers: comparison of ground truth and predicted piles
</caption>
<thead>
<tr>
<th style="text-align:right;">
pile_id
</th>
<th style="text-align:left;">
pile_type
</th>
<th style="text-align:left;">
gt_height_m
</th>
<th style="text-align:left;">
pred_height_m
</th>
<th style="text-align:left;">
diff_height_m
</th>
<th style="text-align:left;">
gt_diameter_m
</th>
<th style="text-align:left;">
pred_diameter_m
</th>
<th style="text-align:left;">
diff_field_diameter_m
</th>
<th style="text-align:left;">
gt_volume_m3
</th>
<th style="text-align:left;">
pred_volume_m3
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
194
</td>
<td style="text-align:left;">
Mechanical Pile
</td>
<td style="text-align:left;">
6.40
</td>
<td style="text-align:left;">
2.30
</td>
<td style="text-align:left;">
-4.10
</td>
<td style="text-align:left;">
8.53
</td>
<td style="text-align:left;">
8.48
</td>
<td style="text-align:left;">
-0.06
</td>
<td style="text-align:left;">
183.08
</td>
<td style="text-align:left;">
46.12
</td>
</tr>
<tr>
<td style="text-align:right;">
82
</td>
<td style="text-align:left;">
Mechanical Pile
</td>
<td style="text-align:left;">
4.27
</td>
<td style="text-align:left;">
2.30
</td>
<td style="text-align:left;">
-1.97
</td>
<td style="text-align:left;">
7.62
</td>
<td style="text-align:left;">
7.56
</td>
<td style="text-align:left;">
-0.06
</td>
<td style="text-align:left;">
97.30
</td>
<td style="text-align:left;">
44.24
</td>
</tr>
<tr>
<td style="text-align:right;">
76
</td>
<td style="text-align:left;">
Mechanical Pile
</td>
<td style="text-align:left;">
4.72
</td>
<td style="text-align:left;">
1.73
</td>
<td style="text-align:left;">
-2.99
</td>
<td style="text-align:left;">
7.01
</td>
<td style="text-align:left;">
5.68
</td>
<td style="text-align:left;">
-1.33
</td>
<td style="text-align:left;">
91.18
</td>
<td style="text-align:left;">
16.01
</td>
</tr>
<tr>
<td style="text-align:right;">
8
</td>
<td style="text-align:left;">
Mechanical Pile
</td>
<td style="text-align:left;">
4.27
</td>
<td style="text-align:left;">
2.30
</td>
<td style="text-align:left;">
-1.97
</td>
<td style="text-align:left;">
6.71
</td>
<td style="text-align:left;">
7.38
</td>
<td style="text-align:left;">
0.67
</td>
<td style="text-align:left;">
75.35
</td>
<td style="text-align:left;">
30.69
</td>
</tr>
</tbody>
</table>
<p>All these instances of extreme volume disagreement at the PSINF ponderosa pine training site are specific to mechanical piles and it looks like the field-measured height is much different than the CHM height. This suggests that the optimal <code>max_ht_m</code> parameter determined during sensitivity and statistical testing was set too low to properly include the upper extent of these taller machine piles. The parameter was optimized this way because the training data featured a much higher frequency of smaller, shorter hand piles, causing the statistical tuning to be inherently biased toward those dominant smaller objects. This finding highlights the difficulty of creating a single-stage process capable of simultaneously detecting distinct pile forms such as small hand piles and larger machine piles. A workaround for this challenge is to execute the pile detection process in two stages: the first parameterized specifically for the expected size, form, and spectral signature of the hand piles, and a second stage parameterized for the expectations of the larger machine piles and then combine the predictions into a final prediction set.</p>
<div class="sourceCode" id="cb493"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb493-1"><a href="stats_method.html#cb493-1" tabindex="-1"></a>bad_vol_df_temp <span class="sc">%&gt;%</span> </span>
<span id="cb493-2"><a href="stats_method.html#cb493-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb493-3"><a href="stats_method.html#cb493-3" tabindex="-1"></a>    pile_id</span>
<span id="cb493-4"><a href="stats_method.html#cb493-4" tabindex="-1"></a>    , gt_height_m, pred_height_m</span>
<span id="cb493-5"><a href="stats_method.html#cb493-5" tabindex="-1"></a>    , gt_diameter_m, pred_diameter_m</span>
<span id="cb493-6"><a href="stats_method.html#cb493-6" tabindex="-1"></a>    , gt_volume_m3, pred_volume_m3</span>
<span id="cb493-7"><a href="stats_method.html#cb493-7" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb493-8"><a href="stats_method.html#cb493-8" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(</span>
<span id="cb493-9"><a href="stats_method.html#cb493-9" tabindex="-1"></a>    <span class="at">cols =</span> <span class="sc">-</span><span class="fu">c</span>(pile_id)</span>
<span id="cb493-10"><a href="stats_method.html#cb493-10" tabindex="-1"></a>    , <span class="at">names_to =</span> <span class="st">&quot;metric&quot;</span></span>
<span id="cb493-11"><a href="stats_method.html#cb493-11" tabindex="-1"></a>    , <span class="at">values_to =</span> <span class="st">&quot;value&quot;</span></span>
<span id="cb493-12"><a href="stats_method.html#cb493-12" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb493-13"><a href="stats_method.html#cb493-13" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb493-14"><a href="stats_method.html#cb493-14" tabindex="-1"></a>    <span class="at">which_data =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb493-15"><a href="stats_method.html#cb493-15" tabindex="-1"></a>        stringr<span class="sc">::</span><span class="fu">str_starts</span>(metric,<span class="st">&quot;gt_&quot;</span>) <span class="sc">~</span> <span class="st">&quot;ground &#39;truth&#39;&quot;</span></span>
<span id="cb493-16"><a href="stats_method.html#cb493-16" tabindex="-1"></a>        , stringr<span class="sc">::</span><span class="fu">str_starts</span>(metric,<span class="st">&quot;pred_&quot;</span>) <span class="sc">~</span> <span class="st">&quot;prediction&quot;</span></span>
<span id="cb493-17"><a href="stats_method.html#cb493-17" tabindex="-1"></a>        , T <span class="sc">~</span> <span class="st">&quot;error&quot;</span></span>
<span id="cb493-18"><a href="stats_method.html#cb493-18" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span> </span>
<span id="cb493-19"><a href="stats_method.html#cb493-19" tabindex="-1"></a>      <span class="fu">ordered</span>()</span>
<span id="cb493-20"><a href="stats_method.html#cb493-20" tabindex="-1"></a>    , <span class="at">pile_metric =</span> metric <span class="sc">%&gt;%</span> </span>
<span id="cb493-21"><a href="stats_method.html#cb493-21" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_remove</span>(<span class="st">&quot;(_rmse|_rrmse|_mean|_mape)$&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb493-22"><a href="stats_method.html#cb493-22" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_extract</span>(<span class="st">&quot;(paraboloid_volume|volume|area|height|diameter)&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb493-23"><a href="stats_method.html#cb493-23" tabindex="-1"></a>      <span class="fu">factor</span>(</span>
<span id="cb493-24"><a href="stats_method.html#cb493-24" tabindex="-1"></a>        <span class="at">ordered =</span> T</span>
<span id="cb493-25"><a href="stats_method.html#cb493-25" tabindex="-1"></a>        , <span class="at">levels =</span> <span class="fu">c</span>(</span>
<span id="cb493-26"><a href="stats_method.html#cb493-26" tabindex="-1"></a>          <span class="st">&quot;volume&quot;</span></span>
<span id="cb493-27"><a href="stats_method.html#cb493-27" tabindex="-1"></a>          , <span class="st">&quot;paraboloid_volume&quot;</span></span>
<span id="cb493-28"><a href="stats_method.html#cb493-28" tabindex="-1"></a>          , <span class="st">&quot;area&quot;</span></span>
<span id="cb493-29"><a href="stats_method.html#cb493-29" tabindex="-1"></a>          , <span class="st">&quot;height&quot;</span></span>
<span id="cb493-30"><a href="stats_method.html#cb493-30" tabindex="-1"></a>          , <span class="st">&quot;diameter&quot;</span></span>
<span id="cb493-31"><a href="stats_method.html#cb493-31" tabindex="-1"></a>        )</span>
<span id="cb493-32"><a href="stats_method.html#cb493-32" tabindex="-1"></a>        , <span class="at">labels =</span> <span class="fu">c</span>(</span>
<span id="cb493-33"><a href="stats_method.html#cb493-33" tabindex="-1"></a>          <span class="st">&quot;Volume (m3)&quot;</span></span>
<span id="cb493-34"><a href="stats_method.html#cb493-34" tabindex="-1"></a>          , <span class="st">&quot;Volume paraboloid&quot;</span></span>
<span id="cb493-35"><a href="stats_method.html#cb493-35" tabindex="-1"></a>          , <span class="st">&quot;Area (m2)&quot;</span></span>
<span id="cb493-36"><a href="stats_method.html#cb493-36" tabindex="-1"></a>          , <span class="st">&quot;Height (m)&quot;</span></span>
<span id="cb493-37"><a href="stats_method.html#cb493-37" tabindex="-1"></a>          , <span class="st">&quot;Diameter (m)&quot;</span></span>
<span id="cb493-38"><a href="stats_method.html#cb493-38" tabindex="-1"></a>        )</span>
<span id="cb493-39"><a href="stats_method.html#cb493-39" tabindex="-1"></a>      )</span>
<span id="cb493-40"><a href="stats_method.html#cb493-40" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb493-41"><a href="stats_method.html#cb493-41" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(</span>
<span id="cb493-42"><a href="stats_method.html#cb493-42" tabindex="-1"></a>    <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> which_data, <span class="at">y =</span> value, <span class="at">label =</span> scales<span class="sc">::</span><span class="fu">comma</span>(value,<span class="at">accuracy=</span><span class="fl">0.1</span>), <span class="at">group =</span> pile_id)</span>
<span id="cb493-43"><a href="stats_method.html#cb493-43" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb493-44"><a href="stats_method.html#cb493-44" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_line</span>(<span class="at">key_glyph =</span> <span class="st">&quot;point&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>, <span class="at">color =</span> <span class="st">&quot;gray&quot;</span>, <span class="at">lwd =</span> <span class="fl">1.1</span>) <span class="sc">+</span></span>
<span id="cb493-45"><a href="stats_method.html#cb493-45" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_point</span>(<span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">color =</span> which_data), <span class="at">alpha =</span> <span class="fl">0.8</span>, <span class="at">size =</span> <span class="fl">2.5</span>) <span class="sc">+</span></span>
<span id="cb493-46"><a href="stats_method.html#cb493-46" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;blue&quot;</span>,<span class="st">&quot;brown&quot;</span>)) <span class="sc">+</span></span>
<span id="cb493-47"><a href="stats_method.html#cb493-47" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_text</span>(</span>
<span id="cb493-48"><a href="stats_method.html#cb493-48" tabindex="-1"></a>    <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.25</span></span>
<span id="cb493-49"><a href="stats_method.html#cb493-49" tabindex="-1"></a>    , <span class="at">show.legend =</span> <span class="cn">FALSE</span></span>
<span id="cb493-50"><a href="stats_method.html#cb493-50" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb493-51"><a href="stats_method.html#cb493-51" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">facet_grid</span>(<span class="at">rows =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(pile_metric), <span class="at">scales =</span> <span class="st">&quot;free_y&quot;</span>) <span class="sc">+</span></span>
<span id="cb493-52"><a href="stats_method.html#cb493-52" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>comma, <span class="at">expand =</span> ggplot2<span class="sc">::</span><span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.05</span>,.<span class="dv">32</span>))) <span class="sc">+</span></span>
<span id="cb493-53"><a href="stats_method.html#cb493-53" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb493-54"><a href="stats_method.html#cb493-54" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;&quot;</span>, <span class="at">y =</span> <span class="st">&quot;&quot;</span>, <span class="at">color =</span> <span class="st">&quot;&quot;</span></span>
<span id="cb493-55"><a href="stats_method.html#cb493-55" tabindex="-1"></a>    , <span class="at">subtitle =</span> <span class="st">&quot;Volume measurement outliers: comparison of measurements&quot;</span></span>
<span id="cb493-56"><a href="stats_method.html#cb493-56" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb493-57"><a href="stats_method.html#cb493-57" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb493-58"><a href="stats_method.html#cb493-58" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb493-59"><a href="stats_method.html#cb493-59" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb493-60"><a href="stats_method.html#cb493-60" tabindex="-1"></a>    , <span class="at">strip.text =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb493-61"><a href="stats_method.html#cb493-61" tabindex="-1"></a>  ) </span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-460-1.png" width="1008" /></p>
<p>RGB with the predicted piles (brown) and the ground-truth piles (blue)</p>
<div class="sourceCode" id="cb494"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb494-1"><a href="stats_method.html#cb494-1" tabindex="-1"></a><span class="co"># plot RGB</span></span>
<span id="cb494-2"><a href="stats_method.html#cb494-2" tabindex="-1"></a>plts_temp <span class="ot">&lt;-</span></span>
<span id="cb494-3"><a href="stats_method.html#cb494-3" tabindex="-1"></a>  <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(bad_vol_df_temp) <span class="sc">%&gt;%</span> </span>
<span id="cb494-4"><a href="stats_method.html#cb494-4" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">map</span>(<span class="cf">function</span>(x){</span>
<span id="cb494-5"><a href="stats_method.html#cb494-5" tabindex="-1"></a>    dta <span class="ot">&lt;-</span> bad_vol_df_temp <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">slice</span>(x)</span>
<span id="cb494-6"><a href="stats_method.html#cb494-6" tabindex="-1"></a>    gt <span class="ot">&lt;-</span> slash_piles_polys <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(pile_id<span class="sc">==</span>dta<span class="sc">$</span>pile_id)</span>
<span id="cb494-7"><a href="stats_method.html#cb494-7" tabindex="-1"></a>    pr <span class="ot">&lt;-</span> final_predicted_slash_piles <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(pred_id<span class="sc">==</span>dta<span class="sc">$</span>pred_id)</span>
<span id="cb494-8"><a href="stats_method.html#cb494-8" tabindex="-1"></a>    <span class="co">#plt</span></span>
<span id="cb494-9"><a href="stats_method.html#cb494-9" tabindex="-1"></a>    <span class="fu">ortho_plt_fn</span>(<span class="at">my_ortho_rast=</span>ortho_rast, <span class="at">stand=</span>sf<span class="sc">::</span><span class="fu">st_union</span>(gt,pr), <span class="at">buffer=</span><span class="dv">6</span>) <span class="sc">+</span></span>
<span id="cb494-10"><a href="stats_method.html#cb494-10" tabindex="-1"></a>      ggplot2<span class="sc">::</span><span class="fu">geom_sf</span>(<span class="at">data =</span> gt, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">color =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">lwd =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb494-11"><a href="stats_method.html#cb494-11" tabindex="-1"></a>      ggplot2<span class="sc">::</span><span class="fu">geom_sf</span>(<span class="at">data =</span> pr, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">color =</span> <span class="st">&quot;brown&quot;</span>, <span class="at">lwd =</span> <span class="fl">0.5</span>)</span>
<span id="cb494-12"><a href="stats_method.html#cb494-12" tabindex="-1"></a>  })</span>
<span id="cb494-13"><a href="stats_method.html#cb494-13" tabindex="-1"></a><span class="co"># combine</span></span>
<span id="cb494-14"><a href="stats_method.html#cb494-14" tabindex="-1"></a>patchwork<span class="sc">::</span><span class="fu">wrap_plots</span>(</span>
<span id="cb494-15"><a href="stats_method.html#cb494-15" tabindex="-1"></a>  plts_temp</span>
<span id="cb494-16"><a href="stats_method.html#cb494-16" tabindex="-1"></a>  , <span class="at">ncol =</span> <span class="dv">2</span></span>
<span id="cb494-17"><a href="stats_method.html#cb494-17" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-461-1.png" width="1008" /></p>
<div class="sourceCode" id="cb495"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb495-1"><a href="stats_method.html#cb495-1" tabindex="-1"></a>ggplot2<span class="sc">::</span><span class="fu">ggsave</span>(<span class="st">&quot;../data/PFDP_Data/bad_vol.jpg&quot;</span>, <span class="at">height =</span> <span class="fl">8.5</span>, <span class="at">width =</span> <span class="fl">8.5</span>)</span></code></pre></div>
<p>just looking at the RGB, the pile footprints are in good alignment</p>
<p>let’s look at the CHM</p>
<div class="sourceCode" id="cb496"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb496-1"><a href="stats_method.html#cb496-1" tabindex="-1"></a><span class="co"># cloud2raster_ans$chm_rast %&gt;% </span></span>
<span id="cb496-2"><a href="stats_method.html#cb496-2" tabindex="-1"></a><span class="co">#   terra::clamp(upper = structural_params_settings$max_ht_m, lower = 0, values = F) %&gt;% </span></span>
<span id="cb496-3"><a href="stats_method.html#cb496-3" tabindex="-1"></a><span class="co">#   terra::plot()</span></span>
<span id="cb496-4"><a href="stats_method.html#cb496-4" tabindex="-1"></a><span class="co"># bad_vol_df_temp %&gt;% dplyr::glimpse()</span></span>
<span id="cb496-5"><a href="stats_method.html#cb496-5" tabindex="-1"></a><span class="co"># plot RGB + CHM</span></span>
<span id="cb496-6"><a href="stats_method.html#cb496-6" tabindex="-1"></a>plts_temp <span class="ot">&lt;-</span></span>
<span id="cb496-7"><a href="stats_method.html#cb496-7" tabindex="-1"></a>  <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(bad_vol_df_temp) <span class="sc">%&gt;%</span> </span>
<span id="cb496-8"><a href="stats_method.html#cb496-8" tabindex="-1"></a>  <span class="co"># sample(1) %&gt;% </span></span>
<span id="cb496-9"><a href="stats_method.html#cb496-9" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">map</span>(<span class="cf">function</span>(x){</span>
<span id="cb496-10"><a href="stats_method.html#cb496-10" tabindex="-1"></a>    dta <span class="ot">&lt;-</span> bad_vol_df_temp <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">slice</span>(x)</span>
<span id="cb496-11"><a href="stats_method.html#cb496-11" tabindex="-1"></a>    gt <span class="ot">&lt;-</span> slash_piles_polys <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(pile_id<span class="sc">==</span>dta<span class="sc">$</span>pile_id)</span>
<span id="cb496-12"><a href="stats_method.html#cb496-12" tabindex="-1"></a>    pr <span class="ot">&lt;-</span> final_predicted_slash_piles <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(pred_id<span class="sc">==</span>dta<span class="sc">$</span>pred_id)</span>
<span id="cb496-13"><a href="stats_method.html#cb496-13" tabindex="-1"></a>    <span class="co">#plt</span></span>
<span id="cb496-14"><a href="stats_method.html#cb496-14" tabindex="-1"></a>    <span class="fu">ortho_plt_fn</span>(<span class="at">my_ortho_rast=</span>ortho_rast, <span class="at">stand=</span>sf<span class="sc">::</span><span class="fu">st_union</span>(gt,pr), <span class="at">buffer=</span><span class="dv">6</span>) <span class="sc">+</span></span>
<span id="cb496-15"><a href="stats_method.html#cb496-15" tabindex="-1"></a>      ggplot2<span class="sc">::</span><span class="fu">geom_tile</span>(</span>
<span id="cb496-16"><a href="stats_method.html#cb496-16" tabindex="-1"></a>        <span class="at">data =</span> cloud2raster_ans<span class="sc">$</span>chm_rast <span class="sc">%&gt;%</span> </span>
<span id="cb496-17"><a href="stats_method.html#cb496-17" tabindex="-1"></a>          terra<span class="sc">::</span><span class="fu">crop</span>(</span>
<span id="cb496-18"><a href="stats_method.html#cb496-18" tabindex="-1"></a>            sf<span class="sc">::</span><span class="fu">st_union</span>(gt,pr) <span class="sc">%&gt;%</span> </span>
<span id="cb496-19"><a href="stats_method.html#cb496-19" tabindex="-1"></a>              sf<span class="sc">::</span><span class="fu">st_transform</span>(terra<span class="sc">::</span><span class="fu">crs</span>(cloud2raster_ans<span class="sc">$</span>chm_rast)) <span class="sc">%&gt;%</span> </span>
<span id="cb496-20"><a href="stats_method.html#cb496-20" tabindex="-1"></a>              terra<span class="sc">::</span><span class="fu">vect</span>()</span>
<span id="cb496-21"><a href="stats_method.html#cb496-21" tabindex="-1"></a>          ) <span class="sc">%&gt;%</span> </span>
<span id="cb496-22"><a href="stats_method.html#cb496-22" tabindex="-1"></a>          terra<span class="sc">::</span><span class="fu">mask</span>(</span>
<span id="cb496-23"><a href="stats_method.html#cb496-23" tabindex="-1"></a>            sf<span class="sc">::</span><span class="fu">st_union</span>(gt,pr) <span class="sc">%&gt;%</span> </span>
<span id="cb496-24"><a href="stats_method.html#cb496-24" tabindex="-1"></a>              sf<span class="sc">::</span><span class="fu">st_transform</span>(terra<span class="sc">::</span><span class="fu">crs</span>(cloud2raster_ans<span class="sc">$</span>chm_rast)) <span class="sc">%&gt;%</span> </span>
<span id="cb496-25"><a href="stats_method.html#cb496-25" tabindex="-1"></a>              terra<span class="sc">::</span><span class="fu">vect</span>()</span>
<span id="cb496-26"><a href="stats_method.html#cb496-26" tabindex="-1"></a>          ) <span class="sc">%&gt;%</span> </span>
<span id="cb496-27"><a href="stats_method.html#cb496-27" tabindex="-1"></a>          <span class="co"># slice the chm below our desired height</span></span>
<span id="cb496-28"><a href="stats_method.html#cb496-28" tabindex="-1"></a>          <span class="co"># this is what slash_pile_detect_watershed() does</span></span>
<span id="cb496-29"><a href="stats_method.html#cb496-29" tabindex="-1"></a>          terra<span class="sc">::</span><span class="fu">clamp</span>(<span class="at">upper =</span> structural_params_settings<span class="sc">$</span>max_ht_m, <span class="at">lower =</span> <span class="dv">0</span>, <span class="at">values =</span> F) <span class="sc">%&gt;%</span></span>
<span id="cb496-30"><a href="stats_method.html#cb496-30" tabindex="-1"></a>          terra<span class="sc">::</span><span class="fu">as.data.frame</span>(<span class="at">xy=</span>T) <span class="sc">%&gt;%</span> </span>
<span id="cb496-31"><a href="stats_method.html#cb496-31" tabindex="-1"></a>          dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">f=</span><span class="dv">3</span>)</span>
<span id="cb496-32"><a href="stats_method.html#cb496-32" tabindex="-1"></a>        , <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x=</span>x,<span class="at">y=</span>y,<span class="at">fill=</span>f)</span>
<span id="cb496-33"><a href="stats_method.html#cb496-33" tabindex="-1"></a>        , <span class="at">alpha =</span> <span class="fl">0.5</span></span>
<span id="cb496-34"><a href="stats_method.html#cb496-34" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb496-35"><a href="stats_method.html#cb496-35" tabindex="-1"></a>      ggplot2<span class="sc">::</span><span class="fu">scale_fill_viridis_c</span>(<span class="at">option =</span> <span class="st">&quot;plasma&quot;</span>, <span class="at">na.value =</span> <span class="st">&quot;gray&quot;</span>,<span class="at">name =</span> <span class="st">&quot;CHM (m)&quot;</span>) <span class="sc">+</span></span>
<span id="cb496-36"><a href="stats_method.html#cb496-36" tabindex="-1"></a>      ggplot2<span class="sc">::</span><span class="fu">geom_sf</span>(<span class="at">data =</span> gt, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">color =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">lwd =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb496-37"><a href="stats_method.html#cb496-37" tabindex="-1"></a>      ggplot2<span class="sc">::</span><span class="fu">geom_sf</span>(<span class="at">data =</span> pr, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">color =</span> <span class="st">&quot;brown&quot;</span>, <span class="at">lwd =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb496-38"><a href="stats_method.html#cb496-38" tabindex="-1"></a>      ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb496-39"><a href="stats_method.html#cb496-39" tabindex="-1"></a>        <span class="at">subtitle =</span> <span class="fu">paste0</span>(</span>
<span id="cb496-40"><a href="stats_method.html#cb496-40" tabindex="-1"></a>          <span class="st">&quot;GT ht: &quot;</span>, <span class="fu">round</span>(dta<span class="sc">$</span>gt_height_m,<span class="dv">1</span>)</span>
<span id="cb496-41"><a href="stats_method.html#cb496-41" tabindex="-1"></a>          , <span class="st">&quot; | Pred ht: &quot;</span>, <span class="fu">round</span>(dta<span class="sc">$</span>pred_height_m,<span class="dv">1</span>)</span>
<span id="cb496-42"><a href="stats_method.html#cb496-42" tabindex="-1"></a>          , <span class="st">&quot;</span><span class="sc">\n</span><span class="st">GT dia: &quot;</span>, <span class="fu">round</span>(dta<span class="sc">$</span>gt_diameter_m,<span class="dv">1</span>)</span>
<span id="cb496-43"><a href="stats_method.html#cb496-43" tabindex="-1"></a>          , <span class="st">&quot; | Pred dia: &quot;</span>, <span class="fu">round</span>(dta<span class="sc">$</span>pred_diameter_m,<span class="dv">1</span>)</span>
<span id="cb496-44"><a href="stats_method.html#cb496-44" tabindex="-1"></a>        )</span>
<span id="cb496-45"><a href="stats_method.html#cb496-45" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb496-46"><a href="stats_method.html#cb496-46" tabindex="-1"></a>      ggplot2<span class="sc">::</span><span class="fu">theme</span>(<span class="at">legend.text =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">6</span>),<span class="at">legend.title =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">6</span>))</span>
<span id="cb496-47"><a href="stats_method.html#cb496-47" tabindex="-1"></a>  })</span>
<span id="cb496-48"><a href="stats_method.html#cb496-48" tabindex="-1"></a><span class="co"># plts_temp</span></span>
<span id="cb496-49"><a href="stats_method.html#cb496-49" tabindex="-1"></a><span class="co"># combine</span></span>
<span id="cb496-50"><a href="stats_method.html#cb496-50" tabindex="-1"></a>patchwork<span class="sc">::</span><span class="fu">wrap_plots</span>(</span>
<span id="cb496-51"><a href="stats_method.html#cb496-51" tabindex="-1"></a>  plts_temp</span>
<span id="cb496-52"><a href="stats_method.html#cb496-52" tabindex="-1"></a>  , <span class="at">ncol =</span> <span class="dv">2</span></span>
<span id="cb496-53"><a href="stats_method.html#cb496-53" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-462-1.png" width="816" /></p>
<p>The predicted diameters generally align well with the field-measured diameters. However, the field-measured heights for some piles appear unusually high compared to the CHM-derived data.</p>
<p>Our pile detection methodology uses a specific height slice of the CHM based on the <code>max_ht_m</code> parameter. This process then keeps only predicted piles that meet the height threshold across the <em>majority of their area</em>. The <code>convexity_pct</code> parameter functions to filter out predictions where excessive pile top area was removed by the CHM slicing and acts as a safeguard against misclassifying tall objects (like trees) as piles that would have the majority of their top removed by the slicing.</p>
<p>After filtering for expected height, our detection methodology calculates the predicted height as the maximum CHM cell value within the expected height range (i.e. up to the <code>max_ht_m</code> setting), which effectively caps any actual height values above this threshold. For our training data, we assumed a maximum height of 2.30m. The field data contains heights up to 6.40m for these volume outliers, which would only be expected of the largest machine piles. In these extreme cases, the significant volume difference observed in the outliers is magnified by both potentially incorrect field measurements and the systematic capping of the predicted height.</p>
<p>To mitigate the risk of vastly underpredicted heights for these tall outliers, one can increase the <code>convexity_pct</code> parameter. Making this filtering more strict will remove the outlier height predictions and improve height quantification accuracy for true positive matches, but will likely reduce the detection rate as these piles become false negatives (omissions). Alternatively, one could increase the <code>max_ht_m</code> setting to be less restrictive with the height filtering; this would have the effect of estimating a more accurate height value for these tall piles but would potentially introduce new false positive predictions that are actually trees (or yurts?). If spectral data is available to filter these after structural segmentation, then this might be the preferred path to improve height quantification accuracy while maintaining detection accuracy. The choice ultimately depends on whether the user prioritizes detection rate or height quantification accuracy.</p>
<p>There is precedent for smoothing the height of piles from aerial data point cloud data. Trofymow et al. (<a href="https://scholar.google.com/scholar?cluster=3556811352833339764&amp;hl=en&amp;as_sdt=0,6">2013</a>) calculated pile height as the 95th percentile height of the height-normalized points within the pile polygon. This method was chosen after their preliminary analysis showed it best excluded points from isolated logs extending above the pile while retaining the main pile structure. Our method achieves a functionally similar result for the largest piles by capping the maximum CHM value and smoothing out extreme height measurements.</p>
<p>we can look a the full CHM without capping the height to see how the field-measured values compare to the unfiltered CHM height profile within the pile footprint</p>
<div class="sourceCode" id="cb497"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb497-1"><a href="stats_method.html#cb497-1" tabindex="-1"></a><span class="co"># cloud2raster_ans$chm_rast %&gt;% </span></span>
<span id="cb497-2"><a href="stats_method.html#cb497-2" tabindex="-1"></a><span class="co">#   terra::clamp(upper = structural_params_settings$max_ht_m, lower = 0, values = F) %&gt;% </span></span>
<span id="cb497-3"><a href="stats_method.html#cb497-3" tabindex="-1"></a><span class="co">#   terra::plot()</span></span>
<span id="cb497-4"><a href="stats_method.html#cb497-4" tabindex="-1"></a><span class="co"># bad_vol_df_temp %&gt;% dplyr::glimpse()</span></span>
<span id="cb497-5"><a href="stats_method.html#cb497-5" tabindex="-1"></a><span class="co"># plot RGB + CHM</span></span>
<span id="cb497-6"><a href="stats_method.html#cb497-6" tabindex="-1"></a>plts_temp <span class="ot">&lt;-</span></span>
<span id="cb497-7"><a href="stats_method.html#cb497-7" tabindex="-1"></a>  <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(bad_vol_df_temp) <span class="sc">%&gt;%</span> </span>
<span id="cb497-8"><a href="stats_method.html#cb497-8" tabindex="-1"></a>  <span class="co"># sample(1) %&gt;% </span></span>
<span id="cb497-9"><a href="stats_method.html#cb497-9" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">map</span>(<span class="cf">function</span>(x){</span>
<span id="cb497-10"><a href="stats_method.html#cb497-10" tabindex="-1"></a>    dta <span class="ot">&lt;-</span> bad_vol_df_temp <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">slice</span>(x)</span>
<span id="cb497-11"><a href="stats_method.html#cb497-11" tabindex="-1"></a>    gt <span class="ot">&lt;-</span> slash_piles_polys <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(pile_id<span class="sc">==</span>dta<span class="sc">$</span>pile_id)</span>
<span id="cb497-12"><a href="stats_method.html#cb497-12" tabindex="-1"></a>    pr <span class="ot">&lt;-</span> final_predicted_slash_piles <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(pred_id<span class="sc">==</span>dta<span class="sc">$</span>pred_id)</span>
<span id="cb497-13"><a href="stats_method.html#cb497-13" tabindex="-1"></a>    <span class="co">#plt</span></span>
<span id="cb497-14"><a href="stats_method.html#cb497-14" tabindex="-1"></a>    <span class="fu">ortho_plt_fn</span>(<span class="at">my_ortho_rast=</span>ortho_rast, <span class="at">stand=</span>sf<span class="sc">::</span><span class="fu">st_union</span>(gt,pr), <span class="at">buffer=</span><span class="dv">6</span>) <span class="sc">+</span></span>
<span id="cb497-15"><a href="stats_method.html#cb497-15" tabindex="-1"></a>      ggplot2<span class="sc">::</span><span class="fu">geom_tile</span>(</span>
<span id="cb497-16"><a href="stats_method.html#cb497-16" tabindex="-1"></a>        <span class="at">data =</span> cloud2raster_ans<span class="sc">$</span>chm_rast <span class="sc">%&gt;%</span> </span>
<span id="cb497-17"><a href="stats_method.html#cb497-17" tabindex="-1"></a>          terra<span class="sc">::</span><span class="fu">crop</span>(</span>
<span id="cb497-18"><a href="stats_method.html#cb497-18" tabindex="-1"></a>            sf<span class="sc">::</span><span class="fu">st_union</span>(gt,pr) <span class="sc">%&gt;%</span> </span>
<span id="cb497-19"><a href="stats_method.html#cb497-19" tabindex="-1"></a>              sf<span class="sc">::</span><span class="fu">st_transform</span>(terra<span class="sc">::</span><span class="fu">crs</span>(cloud2raster_ans<span class="sc">$</span>chm_rast)) <span class="sc">%&gt;%</span> </span>
<span id="cb497-20"><a href="stats_method.html#cb497-20" tabindex="-1"></a>              terra<span class="sc">::</span><span class="fu">vect</span>()</span>
<span id="cb497-21"><a href="stats_method.html#cb497-21" tabindex="-1"></a>          ) <span class="sc">%&gt;%</span> </span>
<span id="cb497-22"><a href="stats_method.html#cb497-22" tabindex="-1"></a>          terra<span class="sc">::</span><span class="fu">mask</span>(</span>
<span id="cb497-23"><a href="stats_method.html#cb497-23" tabindex="-1"></a>            sf<span class="sc">::</span><span class="fu">st_union</span>(gt,pr) <span class="sc">%&gt;%</span> </span>
<span id="cb497-24"><a href="stats_method.html#cb497-24" tabindex="-1"></a>              sf<span class="sc">::</span><span class="fu">st_transform</span>(terra<span class="sc">::</span><span class="fu">crs</span>(cloud2raster_ans<span class="sc">$</span>chm_rast)) <span class="sc">%&gt;%</span> </span>
<span id="cb497-25"><a href="stats_method.html#cb497-25" tabindex="-1"></a>              terra<span class="sc">::</span><span class="fu">vect</span>()</span>
<span id="cb497-26"><a href="stats_method.html#cb497-26" tabindex="-1"></a>          ) <span class="sc">%&gt;%</span> </span>
<span id="cb497-27"><a href="stats_method.html#cb497-27" tabindex="-1"></a>          <span class="co"># DON&#39;T slice the chm below our desired height</span></span>
<span id="cb497-28"><a href="stats_method.html#cb497-28" tabindex="-1"></a>          <span class="co"># terra::clamp(upper = structural_params_settings$max_ht_m, lower = 0, values = F) %&gt;%</span></span>
<span id="cb497-29"><a href="stats_method.html#cb497-29" tabindex="-1"></a>          terra<span class="sc">::</span><span class="fu">as.data.frame</span>(<span class="at">xy=</span>T) <span class="sc">%&gt;%</span> </span>
<span id="cb497-30"><a href="stats_method.html#cb497-30" tabindex="-1"></a>          dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">f=</span><span class="dv">3</span>)</span>
<span id="cb497-31"><a href="stats_method.html#cb497-31" tabindex="-1"></a>        , <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x=</span>x,<span class="at">y=</span>y,<span class="at">fill=</span>f)</span>
<span id="cb497-32"><a href="stats_method.html#cb497-32" tabindex="-1"></a>        , <span class="at">alpha =</span> <span class="fl">0.5</span></span>
<span id="cb497-33"><a href="stats_method.html#cb497-33" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb497-34"><a href="stats_method.html#cb497-34" tabindex="-1"></a>      ggplot2<span class="sc">::</span><span class="fu">scale_fill_viridis_c</span>(<span class="at">option =</span> <span class="st">&quot;plasma&quot;</span>, <span class="at">na.value =</span> <span class="st">&quot;gray&quot;</span>,<span class="at">name =</span> <span class="st">&quot;CHM (m)&quot;</span>, <span class="at">breaks =</span> scales<span class="sc">::</span><span class="fu">breaks_extended</span>(<span class="at">n=</span><span class="dv">7</span>)) <span class="sc">+</span></span>
<span id="cb497-35"><a href="stats_method.html#cb497-35" tabindex="-1"></a>      ggplot2<span class="sc">::</span><span class="fu">geom_sf</span>(<span class="at">data =</span> gt, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">color =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">lwd =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb497-36"><a href="stats_method.html#cb497-36" tabindex="-1"></a>      ggplot2<span class="sc">::</span><span class="fu">geom_sf</span>(<span class="at">data =</span> pr, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">color =</span> <span class="st">&quot;brown&quot;</span>, <span class="at">lwd =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb497-37"><a href="stats_method.html#cb497-37" tabindex="-1"></a>      ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb497-38"><a href="stats_method.html#cb497-38" tabindex="-1"></a>        <span class="at">subtitle =</span> <span class="fu">paste0</span>(</span>
<span id="cb497-39"><a href="stats_method.html#cb497-39" tabindex="-1"></a>          <span class="st">&quot;GT ht: &quot;</span>, <span class="fu">round</span>(dta<span class="sc">$</span>gt_height_m,<span class="dv">1</span>)</span>
<span id="cb497-40"><a href="stats_method.html#cb497-40" tabindex="-1"></a>          , <span class="st">&quot; | Pred ht: &quot;</span>, <span class="fu">round</span>(dta<span class="sc">$</span>pred_height_m,<span class="dv">1</span>)</span>
<span id="cb497-41"><a href="stats_method.html#cb497-41" tabindex="-1"></a>          , <span class="st">&quot;</span><span class="sc">\n</span><span class="st">GT dia: &quot;</span>, <span class="fu">round</span>(dta<span class="sc">$</span>gt_diameter_m,<span class="dv">1</span>)</span>
<span id="cb497-42"><a href="stats_method.html#cb497-42" tabindex="-1"></a>          , <span class="st">&quot; | Pred dia: &quot;</span>, <span class="fu">round</span>(dta<span class="sc">$</span>pred_diameter_m,<span class="dv">1</span>)</span>
<span id="cb497-43"><a href="stats_method.html#cb497-43" tabindex="-1"></a>        )</span>
<span id="cb497-44"><a href="stats_method.html#cb497-44" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb497-45"><a href="stats_method.html#cb497-45" tabindex="-1"></a>      ggplot2<span class="sc">::</span><span class="fu">theme</span>(<span class="at">legend.text =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">6</span>),<span class="at">legend.title =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">6</span>))</span>
<span id="cb497-46"><a href="stats_method.html#cb497-46" tabindex="-1"></a>  })</span>
<span id="cb497-47"><a href="stats_method.html#cb497-47" tabindex="-1"></a><span class="co"># plts_temp</span></span>
<span id="cb497-48"><a href="stats_method.html#cb497-48" tabindex="-1"></a><span class="co"># combine</span></span>
<span id="cb497-49"><a href="stats_method.html#cb497-49" tabindex="-1"></a>patchwork<span class="sc">::</span><span class="fu">wrap_plots</span>(</span>
<span id="cb497-50"><a href="stats_method.html#cb497-50" tabindex="-1"></a>  plts_temp</span>
<span id="cb497-51"><a href="stats_method.html#cb497-51" tabindex="-1"></a>  , <span class="at">ncol =</span> <span class="dv">2</span></span>
<span id="cb497-52"><a href="stats_method.html#cb497-52" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-463-1.png" width="816" /></p>
<p>Visual inspection of the unfiltered CHM (note the CHM scale range) within the footprint of these volume outliers confirms that the field-measured values are misaligned with the CHM profile by at least 1m for some of the most extreme outliers, supporting the theory that the significant volume and height differences observed are magnified by potentially incorrect field measurements.</p>
</div>
<div id="allometric-volume-comparison" class="section level4 hasAnchor" number="9.5.3.2">
<h4><span class="header-section-number">9.5.3.2</span> Allometric Volume Comparison<a href="stats_method.html#allometric-volume-comparison" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The volume comparison <a href="stats_method.html#training_detect_final_volcomp">immediately above</a> compared the allometric field volume using a geometric shape assumption (paraboloid) with the predicted volume based on the irregular CHM elevation profile. Thus, the volume difference included the impact of the shape assumption. In an attempt to remove the influence of comparing a regular shape (field measured) to an irregular shape (predicted volume), we’ll perform a comparison analysis where both volume calculations are based on the same paraboloid shape assumption. This should provide insight into the differences related only to the predicted versus field-measured maximum dimensions of height and diameter.</p>
<p>In the following section, we compare volume predictions against field measured data where both volume calculations utilize the same paraboloid shape assumption. For this analysis, we’ll update the predicted volume only using the following volume definitions:</p>
<ul>
<li><strong>field-measured piles</strong>
<ul>
<li><strong>volume</strong> assumes a paraboloid shape, with volume calculated using the field-measured diameter (as the width) and height. we’ll refer to this as “Allometric Field Volume” to indicate the field measurement is derived using a shape assumption.</li>
</ul></li>
<li><strong>predicted piles</strong>
<ul>
<li><strong>volume</strong> assumes a paraboloid shape, with volume calculated using the predicted diameter (as the width) and height. we’ll refer to this as “Allometric Predicted Volume” to indicate the measurement is derived using a shape assumption.</li>
</ul></li>
</ul>
<p>We would generally expect that the allometric field volume will not be uniformly larger or smaller than the predicted allometric volume, as the volume difference will be the net result of two competing influences: the observed overestimation of diameter (0.21 m mean error) and the observed underestimation of height (-0.20 m mean error) propagating through the volume calculation formula.</p>
<p>let’s first update the predicted volume to calculate the allometric predicted volume where the volume formula for a paraboloid is:</p>
<p><span class="math display">\[
V = \frac{1}{8}\pi \cdot width^2 \cdot height
\]</span>
we expect the allometric predicted volume to be larger than the predicted volume calculated based on the irregular elevation profile in the CHM because assuming a geometric shape smooths all the voids and irregularities ( which more accurately reflect reality ;) )</p>
<div class="sourceCode" id="cb498"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb498-1"><a href="stats_method.html#cb498-1" tabindex="-1"></a>ground_truth_prediction_match_ans <span class="ot">&lt;-</span> ground_truth_prediction_match_ans <span class="sc">%&gt;%</span> </span>
<span id="cb498-2"><a href="stats_method.html#cb498-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb498-3"><a href="stats_method.html#cb498-3" tabindex="-1"></a>    <span class="at">pred_allom_volume_m3 =</span> (<span class="dv">1</span><span class="sc">/</span><span class="dv">8</span>) <span class="sc">*</span> pi <span class="sc">*</span> (pred_diameter_m<span class="sc">^</span><span class="dv">2</span>) <span class="sc">*</span> pred_height_m</span>
<span id="cb498-4"><a href="stats_method.html#cb498-4" tabindex="-1"></a>  )</span>
<span id="cb498-5"><a href="stats_method.html#cb498-5" tabindex="-1"></a><span class="co"># summarize it</span></span>
<span id="cb498-6"><a href="stats_method.html#cb498-6" tabindex="-1"></a>ground_truth_prediction_match_ans <span class="sc">%&gt;%</span> </span>
<span id="cb498-7"><a href="stats_method.html#cb498-7" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(match_grp<span class="sc">==</span><span class="st">&quot;true positive&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb498-8"><a href="stats_method.html#cb498-8" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(gt_volume_m3, pred_volume_m3, pred_allom_volume_m3) <span class="sc">%&gt;%</span> </span>
<span id="cb498-9"><a href="stats_method.html#cb498-9" tabindex="-1"></a>  <span class="fu">summary</span>()</span></code></pre></div>
<pre><code>##   gt_volume_m3     pred_volume_m3   pred_allom_volume_m3
##  Min.   :  4.270   Min.   : 1.109   Min.   : 2.822      
##  1st Qu.:  6.564   1st Qu.: 4.276   1st Qu.: 6.547      
##  Median :  7.497   Median : 5.216   Median : 7.785      
##  Mean   : 12.375   Mean   : 7.136   Mean   :10.732      
##  3rd Qu.:  8.746   3rd Qu.: 7.054   3rd Qu.: 9.782      
##  Max.   :183.080   Max.   :46.122   Max.   :64.886</code></pre>
<p>nice, the allometric predicted volume is larger than the predicted volume calculated based on the irregular elevation profile in the CHM</p>
<div class="sourceCode" id="cb500"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb500-1"><a href="stats_method.html#cb500-1" tabindex="-1"></a>ground_truth_prediction_match_ans <span class="sc">%&gt;%</span> </span>
<span id="cb500-2"><a href="stats_method.html#cb500-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(match_grp<span class="sc">==</span><span class="st">&quot;true positive&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb500-3"><a href="stats_method.html#cb500-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">diff_volume_m3 =</span> gt_volume_m3 <span class="sc">-</span> pred_allom_volume_m3) <span class="sc">%&gt;%</span> </span>
<span id="cb500-4"><a href="stats_method.html#cb500-4" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">y =</span> gt_volume_m3, <span class="at">x =</span> pred_allom_volume_m3)) <span class="sc">+</span></span>
<span id="cb500-5"><a href="stats_method.html#cb500-5" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_abline</span>(<span class="at">lwd =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb500-6"><a href="stats_method.html#cb500-6" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">&quot;navy&quot;</span>) <span class="sc">+</span></span>
<span id="cb500-7"><a href="stats_method.html#cb500-7" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="at">se=</span>F, <span class="at">color =</span> <span class="st">&quot;tomato&quot;</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb500-8"><a href="stats_method.html#cb500-8" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_color_viridis_c</span>(<span class="at">option =</span> <span class="st">&quot;mako&quot;</span>, <span class="at">direction =</span> <span class="sc">-</span><span class="dv">1</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb500-9"><a href="stats_method.html#cb500-9" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">max</span>( <span class="fu">max</span>(ground_truth_prediction_match_ans<span class="sc">$</span>pred_allom_volume_m3,<span class="at">na.rm=</span>T), <span class="fu">max</span>(ground_truth_prediction_match_ans<span class="sc">$</span>gt_volume_m3,<span class="at">na.rm=</span>T) ) )) <span class="sc">+</span></span>
<span id="cb500-10"><a href="stats_method.html#cb500-10" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">max</span>( <span class="fu">max</span>(ground_truth_prediction_match_ans<span class="sc">$</span>pred_allom_volume_m3,<span class="at">na.rm=</span>T), <span class="fu">max</span>(ground_truth_prediction_match_ans<span class="sc">$</span>gt_volume_m3,<span class="at">na.rm=</span>T) ) )) <span class="sc">+</span></span>
<span id="cb500-11"><a href="stats_method.html#cb500-11" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb500-12"><a href="stats_method.html#cb500-12" tabindex="-1"></a>    <span class="at">y =</span> latex2exp<span class="sc">::</span><span class="fu">TeX</span>(<span class="st">&quot;allometric field volume $m^3$&quot;</span>)</span>
<span id="cb500-13"><a href="stats_method.html#cb500-13" tabindex="-1"></a>    , <span class="at">x =</span> latex2exp<span class="sc">::</span><span class="fu">TeX</span>(<span class="st">&quot;allometric predicted volume $m^3$&quot;</span>)</span>
<span id="cb500-14"><a href="stats_method.html#cb500-14" tabindex="-1"></a>    <span class="co"># , color = &quot;image-field\ndiameter diff.&quot;</span></span>
<span id="cb500-15"><a href="stats_method.html#cb500-15" tabindex="-1"></a>    , <span class="at">subtitle =</span> latex2exp<span class="sc">::</span><span class="fu">TeX</span>(<span class="st">&quot;bulk volume ($m^3$) comparison&quot;</span>)</span>
<span id="cb500-16"><a href="stats_method.html#cb500-16" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb500-17"><a href="stats_method.html#cb500-17" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_light</span>()</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-466-1.png" width="1008" /></p>
<p>the differences between the predictions for the larger field measured piles are pulling the slope of the line upwards but for the smaller piles, the volume differences are clustered around the line of equality</p>
<p>before we compare the volume measurements in aggregate, let’s look at the distributions</p>
<div class="sourceCode" id="cb501"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb501-1"><a href="stats_method.html#cb501-1" tabindex="-1"></a>vol_df_temp <span class="ot">&lt;-</span> </span>
<span id="cb501-2"><a href="stats_method.html#cb501-2" tabindex="-1"></a>  ground_truth_prediction_match_ans <span class="sc">%&gt;%</span> </span>
<span id="cb501-3"><a href="stats_method.html#cb501-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(match_grp<span class="sc">==</span><span class="st">&quot;true positive&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb501-4"><a href="stats_method.html#cb501-4" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(pile_id,gt_volume_m3,pred_allom_volume_m3) <span class="sc">%&gt;%</span> </span>
<span id="cb501-5"><a href="stats_method.html#cb501-5" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span><span class="fu">c</span>(pile_id)) <span class="sc">%&gt;%</span> </span>
<span id="cb501-6"><a href="stats_method.html#cb501-6" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb501-7"><a href="stats_method.html#cb501-7" tabindex="-1"></a>    <span class="at">name =</span> <span class="fu">factor</span>(</span>
<span id="cb501-8"><a href="stats_method.html#cb501-8" tabindex="-1"></a>      name</span>
<span id="cb501-9"><a href="stats_method.html#cb501-9" tabindex="-1"></a>      , <span class="at">ordered =</span> T</span>
<span id="cb501-10"><a href="stats_method.html#cb501-10" tabindex="-1"></a>      , <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;gt_volume_m3&quot;</span>,<span class="st">&quot;pred_allom_volume_m3&quot;</span>)</span>
<span id="cb501-11"><a href="stats_method.html#cb501-11" tabindex="-1"></a>      , <span class="at">labels =</span> <span class="fu">c</span>(</span>
<span id="cb501-12"><a href="stats_method.html#cb501-12" tabindex="-1"></a>        <span class="st">&quot;allometric field volume&quot;</span></span>
<span id="cb501-13"><a href="stats_method.html#cb501-13" tabindex="-1"></a>        , <span class="st">&quot;allometric predicted volume&quot;</span></span>
<span id="cb501-14"><a href="stats_method.html#cb501-14" tabindex="-1"></a>      )</span>
<span id="cb501-15"><a href="stats_method.html#cb501-15" tabindex="-1"></a>    )</span>
<span id="cb501-16"><a href="stats_method.html#cb501-16" tabindex="-1"></a>  ) </span>
<span id="cb501-17"><a href="stats_method.html#cb501-17" tabindex="-1"></a><span class="co"># plot dist</span></span>
<span id="cb501-18"><a href="stats_method.html#cb501-18" tabindex="-1"></a>vol_df_temp <span class="sc">%&gt;%</span> </span>
<span id="cb501-19"><a href="stats_method.html#cb501-19" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">color =</span> name, <span class="at">fill =</span> name)) <span class="sc">+</span></span>
<span id="cb501-20"><a href="stats_method.html#cb501-20" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_density</span>(<span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">y=</span>ggplot2<span class="sc">::</span><span class="fu">after_stat</span>(scaled)), <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb501-21"><a href="stats_method.html#cb501-21" tabindex="-1"></a>  harrypotter<span class="sc">::</span><span class="fu">scale_color_hp_d</span>(<span class="at">option =</span> <span class="st">&quot;lunalovegood&quot;</span>) <span class="sc">+</span></span>
<span id="cb501-22"><a href="stats_method.html#cb501-22" tabindex="-1"></a>  harrypotter<span class="sc">::</span><span class="fu">scale_fill_hp_d</span>(<span class="at">option =</span> <span class="st">&quot;lunalovegood&quot;</span>) <span class="sc">+</span></span>
<span id="cb501-23"><a href="stats_method.html#cb501-23" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>,<span class="at">breaks=</span><span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb501-24"><a href="stats_method.html#cb501-24" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb501-25"><a href="stats_method.html#cb501-25" tabindex="-1"></a>    <span class="at">color=</span><span class="st">&quot;&quot;</span>,<span class="at">fill=</span><span class="st">&quot;&quot;</span>,<span class="at">x=</span>latex2exp<span class="sc">::</span><span class="fu">TeX</span>(<span class="st">&quot;allometric volume $m^3$&quot;</span>)</span>
<span id="cb501-26"><a href="stats_method.html#cb501-26" tabindex="-1"></a>    , <span class="at">subtitle =</span> latex2exp<span class="sc">::</span><span class="fu">TeX</span>(<span class="st">&quot;Allometric bulk volume ($m^3$) comparison of distributions&quot;</span>)</span>
<span id="cb501-27"><a href="stats_method.html#cb501-27" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb501-28"><a href="stats_method.html#cb501-28" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb501-29"><a href="stats_method.html#cb501-29" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb501-30"><a href="stats_method.html#cb501-30" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;top&quot;</span></span>
<span id="cb501-31"><a href="stats_method.html#cb501-31" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-467-1.png" width="1008" /></p>
<p>nice, the distributions overlap much more than the volume comparison between the allometric field value and the irregular, CHM-derived prediction</p>
<p>slope plots are neat too</p>
<div class="sourceCode" id="cb502"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb502-1"><a href="stats_method.html#cb502-1" tabindex="-1"></a>vol_df_temp <span class="sc">%&gt;%</span> </span>
<span id="cb502-2"><a href="stats_method.html#cb502-2" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(</span>
<span id="cb502-3"><a href="stats_method.html#cb502-3" tabindex="-1"></a>    <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> name, <span class="at">y =</span> value, <span class="at">group =</span> pile_id)</span>
<span id="cb502-4"><a href="stats_method.html#cb502-4" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb502-5"><a href="stats_method.html#cb502-5" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_line</span>(<span class="at">key_glyph =</span> <span class="st">&quot;point&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>, <span class="at">color =</span> <span class="st">&quot;gray&quot;</span>, <span class="at">lwd =</span> <span class="fl">1.1</span>) <span class="sc">+</span></span>
<span id="cb502-6"><a href="stats_method.html#cb502-6" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_point</span>(<span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">color =</span> name), <span class="at">alpha =</span> <span class="fl">0.7</span>, <span class="at">size =</span> <span class="fl">2.5</span>) <span class="sc">+</span></span>
<span id="cb502-7"><a href="stats_method.html#cb502-7" tabindex="-1"></a>  harrypotter<span class="sc">::</span><span class="fu">scale_color_hp_d</span>(<span class="at">option =</span> <span class="st">&quot;lunalovegood&quot;</span>) <span class="sc">+</span></span>
<span id="cb502-8"><a href="stats_method.html#cb502-8" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb502-9"><a href="stats_method.html#cb502-9" tabindex="-1"></a>    <span class="at">color=</span><span class="st">&quot;&quot;</span></span>
<span id="cb502-10"><a href="stats_method.html#cb502-10" tabindex="-1"></a>    , <span class="at">y =</span> latex2exp<span class="sc">::</span><span class="fu">TeX</span>(<span class="st">&quot;allometric volume $m^3$&quot;</span>)</span>
<span id="cb502-11"><a href="stats_method.html#cb502-11" tabindex="-1"></a>    , <span class="at">x =</span> <span class="st">&quot;&quot;</span></span>
<span id="cb502-12"><a href="stats_method.html#cb502-12" tabindex="-1"></a>    , <span class="at">subtitle =</span> latex2exp<span class="sc">::</span><span class="fu">TeX</span>(<span class="st">&quot;Allometric bulk volume ($m^3$) comparison at the pile level&quot;</span>)</span>
<span id="cb502-13"><a href="stats_method.html#cb502-13" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb502-14"><a href="stats_method.html#cb502-14" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb502-15"><a href="stats_method.html#cb502-15" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb502-16"><a href="stats_method.html#cb502-16" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb502-17"><a href="stats_method.html#cb502-17" tabindex="-1"></a>    , <span class="at">axis.title =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>)</span>
<span id="cb502-18"><a href="stats_method.html#cb502-18" tabindex="-1"></a>    , <span class="at">axis.text =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>)</span>
<span id="cb502-19"><a href="stats_method.html#cb502-19" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-468-1.png" width="1008" /></p>
<p>what if we only look at the smaller piles?</p>
<div class="sourceCode" id="cb503"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb503-1"><a href="stats_method.html#cb503-1" tabindex="-1"></a>vol_df_temp <span class="sc">%&gt;%</span> </span>
<span id="cb503-2"><a href="stats_method.html#cb503-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(</span>
<span id="cb503-3"><a href="stats_method.html#cb503-3" tabindex="-1"></a>    value <span class="sc">&lt;</span> <span class="fu">quantile</span>(vol_df_temp<span class="sc">$</span>value, <span class="at">probs =</span> <span class="fl">0.938</span>)</span>
<span id="cb503-4"><a href="stats_method.html#cb503-4" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb503-5"><a href="stats_method.html#cb503-5" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(</span>
<span id="cb503-6"><a href="stats_method.html#cb503-6" tabindex="-1"></a>    <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> name, <span class="at">y =</span> value, <span class="at">group =</span> pile_id)</span>
<span id="cb503-7"><a href="stats_method.html#cb503-7" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb503-8"><a href="stats_method.html#cb503-8" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_line</span>(<span class="at">key_glyph =</span> <span class="st">&quot;point&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>, <span class="at">color =</span> <span class="st">&quot;gray&quot;</span>, <span class="at">lwd =</span> <span class="fl">1.1</span>) <span class="sc">+</span></span>
<span id="cb503-9"><a href="stats_method.html#cb503-9" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_point</span>(<span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">color =</span> name), <span class="at">alpha =</span> <span class="fl">0.7</span>, <span class="at">size =</span> <span class="fl">2.5</span>) <span class="sc">+</span></span>
<span id="cb503-10"><a href="stats_method.html#cb503-10" tabindex="-1"></a>  harrypotter<span class="sc">::</span><span class="fu">scale_color_hp_d</span>(<span class="at">option =</span> <span class="st">&quot;lunalovegood&quot;</span>) <span class="sc">+</span></span>
<span id="cb503-11"><a href="stats_method.html#cb503-11" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb503-12"><a href="stats_method.html#cb503-12" tabindex="-1"></a>    <span class="at">color=</span><span class="st">&quot;&quot;</span></span>
<span id="cb503-13"><a href="stats_method.html#cb503-13" tabindex="-1"></a>    , <span class="at">y =</span> latex2exp<span class="sc">::</span><span class="fu">TeX</span>(<span class="st">&quot;allometric volume $m^3$&quot;</span>)</span>
<span id="cb503-14"><a href="stats_method.html#cb503-14" tabindex="-1"></a>    , <span class="at">x =</span> <span class="st">&quot;&quot;</span></span>
<span id="cb503-15"><a href="stats_method.html#cb503-15" tabindex="-1"></a>    , <span class="at">subtitle =</span> latex2exp<span class="sc">::</span><span class="fu">TeX</span>(<span class="st">&quot;Allometric bulk volume ($m^3$) comparison at the pile level for the smaller piles&quot;</span>)</span>
<span id="cb503-16"><a href="stats_method.html#cb503-16" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb503-17"><a href="stats_method.html#cb503-17" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb503-18"><a href="stats_method.html#cb503-18" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb503-19"><a href="stats_method.html#cb503-19" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb503-20"><a href="stats_method.html#cb503-20" tabindex="-1"></a>    , <span class="at">axis.title =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>)</span>
<span id="cb503-21"><a href="stats_method.html#cb503-21" tabindex="-1"></a>    , <span class="at">axis.text =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>)</span>
<span id="cb503-22"><a href="stats_method.html#cb503-22" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-469-1.png" width="1008" /></p>
<p>there is much more variability in this slope plot than the volume comparison between the allometric field value and the irregular, CHM-derived prediction</p>
<p>let’s compare aggregated volume measurements for the true positive matches</p>
<div class="sourceCode" id="cb504"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb504-1"><a href="stats_method.html#cb504-1" tabindex="-1"></a>vol_agg_df_temp <span class="ot">&lt;-</span> </span>
<span id="cb504-2"><a href="stats_method.html#cb504-2" tabindex="-1"></a>  ground_truth_prediction_match_ans <span class="sc">%&gt;%</span> </span>
<span id="cb504-3"><a href="stats_method.html#cb504-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(match_grp<span class="sc">==</span><span class="st">&quot;true positive&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb504-4"><a href="stats_method.html#cb504-4" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb504-5"><a href="stats_method.html#cb504-5" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(</span>
<span id="cb504-6"><a href="stats_method.html#cb504-6" tabindex="-1"></a>    <span class="at">mean_diff =</span> <span class="fu">mean</span>(gt_volume_m3<span class="sc">-</span>pred_allom_volume_m3)</span>
<span id="cb504-7"><a href="stats_method.html#cb504-7" tabindex="-1"></a>    , <span class="at">sd_diff =</span> <span class="fu">sd</span>(gt_volume_m3<span class="sc">-</span>pred_allom_volume_m3)</span>
<span id="cb504-8"><a href="stats_method.html#cb504-8" tabindex="-1"></a>    , <span class="at">mean_gt_volume_m3 =</span> <span class="fu">mean</span>(gt_volume_m3,<span class="at">na.rm =</span> T)</span>
<span id="cb504-9"><a href="stats_method.html#cb504-9" tabindex="-1"></a>    , <span class="at">mean_pred_allom_volume_m3 =</span> <span class="fu">mean</span>(pred_allom_volume_m3,<span class="at">na.rm =</span> T)</span>
<span id="cb504-10"><a href="stats_method.html#cb504-10" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb504-11"><a href="stats_method.html#cb504-11" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb504-12"><a href="stats_method.html#cb504-12" tabindex="-1"></a>    <span class="at">pct_mean_diff =</span> mean_diff<span class="sc">/</span>mean_pred_allom_volume_m3</span>
<span id="cb504-13"><a href="stats_method.html#cb504-13" tabindex="-1"></a>  )</span></code></pre></div>
<p>what did we get?</p>
<div class="sourceCode" id="cb505"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb505-1"><a href="stats_method.html#cb505-1" tabindex="-1"></a>vol_agg_df_temp <span class="sc">%&gt;%</span> </span>
<span id="cb505-2"><a href="stats_method.html#cb505-2" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(dplyr<span class="sc">::</span><span class="fu">everything</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb505-3"><a href="stats_method.html#cb505-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb505-4"><a href="stats_method.html#cb505-4" tabindex="-1"></a>    <span class="at">value =</span> </span>
<span id="cb505-5"><a href="stats_method.html#cb505-5" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb505-6"><a href="stats_method.html#cb505-6" tabindex="-1"></a>        stringr<span class="sc">::</span><span class="fu">str_starts</span>(name, <span class="st">&quot;pct_&quot;</span>) <span class="sc">~</span> scales<span class="sc">::</span><span class="fu">percent</span>(value, <span class="at">accuracy =</span> <span class="fl">0.1</span>)</span>
<span id="cb505-7"><a href="stats_method.html#cb505-7" tabindex="-1"></a>        , T <span class="sc">~</span> scales<span class="sc">::</span><span class="fu">comma</span>(value, <span class="at">accuracy =</span> <span class="fl">0.1</span>)</span>
<span id="cb505-8"><a href="stats_method.html#cb505-8" tabindex="-1"></a>      )</span>
<span id="cb505-9"><a href="stats_method.html#cb505-9" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb505-10"><a href="stats_method.html#cb505-10" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kbl</span>(</span>
<span id="cb505-11"><a href="stats_method.html#cb505-11" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">&quot;comparison of aggregated allometric field volume and allometric predicted volume&quot;</span></span>
<span id="cb505-12"><a href="stats_method.html#cb505-12" tabindex="-1"></a>    , <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">&quot;metric&quot;</span>, <span class="st">&quot;value&quot;</span>)</span>
<span id="cb505-13"><a href="stats_method.html#cb505-13" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb505-14"><a href="stats_method.html#cb505-14" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kable_styling</span>()</span></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-471">Table 9.33: </span>comparison of aggregated allometric field volume and allometric predicted volume
</caption>
<thead>
<tr>
<th style="text-align:left;">
metric
</th>
<th style="text-align:left;">
value
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
mean_diff
</td>
<td style="text-align:left;">
1.6
</td>
</tr>
<tr>
<td style="text-align:left;">
sd_diff
</td>
<td style="text-align:left;">
14.8
</td>
</tr>
<tr>
<td style="text-align:left;">
mean_gt_volume_m3
</td>
<td style="text-align:left;">
12.4
</td>
</tr>
<tr>
<td style="text-align:left;">
mean_pred_allom_volume_m3
</td>
<td style="text-align:left;">
10.7
</td>
</tr>
<tr>
<td style="text-align:left;">
pct_mean_diff
</td>
<td style="text-align:left;">
15.3%
</td>
</tr>
</tbody>
</table>
<p>we’ll dig into the MD shortly but before we move on let’s focus on the percent mean difference. We calcualted a %MD of 15.3% which indicates a slight systematic difference where the allometric field volume is, on average, 15.3% larger than our predicted allometric volume.</p>
<p>let’s make a Bland-Altman plot to compare the two measurement methods. this plot uses the average of the two measurements (approximate size) on the x-axis and the difference (bias) between the two measurements on the y-axis</p>
<div class="sourceCode" id="cb506"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb506-1"><a href="stats_method.html#cb506-1" tabindex="-1"></a>ground_truth_prediction_match_ans <span class="sc">%&gt;%</span> </span>
<span id="cb506-2"><a href="stats_method.html#cb506-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(match_grp<span class="sc">==</span><span class="st">&quot;true positive&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb506-3"><a href="stats_method.html#cb506-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb506-4"><a href="stats_method.html#cb506-4" tabindex="-1"></a>  <span class="co"># calc needed metrics</span></span>
<span id="cb506-5"><a href="stats_method.html#cb506-5" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb506-6"><a href="stats_method.html#cb506-6" tabindex="-1"></a>    <span class="at">mean_vol =</span> (gt_volume_m3<span class="sc">+</span>pred_allom_volume_m3)<span class="sc">/</span><span class="dv">2</span></span>
<span id="cb506-7"><a href="stats_method.html#cb506-7" tabindex="-1"></a>    , <span class="at">diff_vol =</span> (gt_volume_m3<span class="sc">-</span>pred_allom_volume_m3) <span class="co"># match the order used in vol_agg_df_temp</span></span>
<span id="cb506-8"><a href="stats_method.html#cb506-8" tabindex="-1"></a>    , <span class="at">scale_diff =</span> <span class="fu">ifelse</span>(diff_vol <span class="sc">&lt;</span> <span class="dv">0</span>, <span class="sc">-</span><span class="fu">abs</span>(diff_vol) <span class="sc">/</span> <span class="fu">abs</span>(<span class="fu">min</span>(diff_vol)), diff_vol <span class="sc">/</span> <span class="fu">max</span>(diff_vol))</span>
<span id="cb506-9"><a href="stats_method.html#cb506-9" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb506-10"><a href="stats_method.html#cb506-10" tabindex="-1"></a>  <span class="co"># ggplot() + geom_point(aes(x=diff_vol,y=0, color=scale_diff)) + scale_color_gradient2(mid = &quot;gray&quot;, midpoint = 0, low = &quot;red&quot;, high = &quot;blue&quot;)</span></span>
<span id="cb506-11"><a href="stats_method.html#cb506-11" tabindex="-1"></a>  <span class="co"># plot</span></span>
<span id="cb506-12"><a href="stats_method.html#cb506-12" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(</span>
<span id="cb506-13"><a href="stats_method.html#cb506-13" tabindex="-1"></a>    <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> mean_vol, <span class="at">y =</span> diff_vol)</span>
<span id="cb506-14"><a href="stats_method.html#cb506-14" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb506-15"><a href="stats_method.html#cb506-15" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">lwd =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb506-16"><a href="stats_method.html#cb506-16" tabindex="-1"></a>  <span class="co"># mean difference (bias)</span></span>
<span id="cb506-17"><a href="stats_method.html#cb506-17" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_hline</span>(</span>
<span id="cb506-18"><a href="stats_method.html#cb506-18" tabindex="-1"></a>    <span class="at">yintercept =</span> vol_agg_df_temp<span class="sc">$</span>mean_diff</span>
<span id="cb506-19"><a href="stats_method.html#cb506-19" tabindex="-1"></a>    , <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>, <span class="at">color =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">lwd =</span> <span class="dv">1</span></span>
<span id="cb506-20"><a href="stats_method.html#cb506-20" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb506-21"><a href="stats_method.html#cb506-21" tabindex="-1"></a>  <span class="co"># upper limit</span></span>
<span id="cb506-22"><a href="stats_method.html#cb506-22" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_hline</span>(</span>
<span id="cb506-23"><a href="stats_method.html#cb506-23" tabindex="-1"></a>    <span class="at">yintercept =</span> vol_agg_df_temp<span class="sc">$</span>mean_diff<span class="fl">+1.96</span><span class="sc">*</span>vol_agg_df_temp<span class="sc">$</span>sd_diff</span>
<span id="cb506-24"><a href="stats_method.html#cb506-24" tabindex="-1"></a>    , <span class="at">linetype =</span> <span class="st">&quot;dotted&quot;</span>, <span class="at">color =</span> <span class="st">&quot;red&quot;</span>, <span class="at">lwd =</span> <span class="dv">1</span></span>
<span id="cb506-25"><a href="stats_method.html#cb506-25" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb506-26"><a href="stats_method.html#cb506-26" tabindex="-1"></a>  <span class="co"># lower limit</span></span>
<span id="cb506-27"><a href="stats_method.html#cb506-27" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_hline</span>(</span>
<span id="cb506-28"><a href="stats_method.html#cb506-28" tabindex="-1"></a>    <span class="at">yintercept =</span> vol_agg_df_temp<span class="sc">$</span>mean_diff<span class="fl">-1.96</span><span class="sc">*</span>vol_agg_df_temp<span class="sc">$</span>sd_diff</span>
<span id="cb506-29"><a href="stats_method.html#cb506-29" tabindex="-1"></a>    , <span class="at">linetype =</span> <span class="st">&quot;dotted&quot;</span>, <span class="at">color =</span> <span class="st">&quot;red&quot;</span>, <span class="at">lwd =</span> <span class="dv">1</span></span>
<span id="cb506-30"><a href="stats_method.html#cb506-30" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb506-31"><a href="stats_method.html#cb506-31" tabindex="-1"></a>  <span class="co"># annotations</span></span>
<span id="cb506-32"><a href="stats_method.html#cb506-32" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">annotate</span>(</span>
<span id="cb506-33"><a href="stats_method.html#cb506-33" tabindex="-1"></a>    <span class="st">&quot;text&quot;</span></span>
<span id="cb506-34"><a href="stats_method.html#cb506-34" tabindex="-1"></a>    , <span class="at">x =</span> <span class="cn">Inf</span></span>
<span id="cb506-35"><a href="stats_method.html#cb506-35" tabindex="-1"></a>    , <span class="at">y =</span> vol_agg_df_temp<span class="sc">$</span>mean_diff</span>
<span id="cb506-36"><a href="stats_method.html#cb506-36" tabindex="-1"></a>    , <span class="at">label =</span> latex2exp<span class="sc">::</span><span class="fu">TeX</span>(</span>
<span id="cb506-37"><a href="stats_method.html#cb506-37" tabindex="-1"></a>      <span class="fu">paste0</span>(</span>
<span id="cb506-38"><a href="stats_method.html#cb506-38" tabindex="-1"></a>        <span class="st">&quot;mean difference (bias): &quot;</span></span>
<span id="cb506-39"><a href="stats_method.html#cb506-39" tabindex="-1"></a>        , scales<span class="sc">::</span><span class="fu">comma</span>(vol_agg_df_temp<span class="sc">$</span>mean_diff, <span class="at">accuracy =</span> <span class="fl">0.01</span>)</span>
<span id="cb506-40"><a href="stats_method.html#cb506-40" tabindex="-1"></a>        , <span class="st">&quot; $m^3$&quot;</span></span>
<span id="cb506-41"><a href="stats_method.html#cb506-41" tabindex="-1"></a>      )</span>
<span id="cb506-42"><a href="stats_method.html#cb506-42" tabindex="-1"></a>      , <span class="at">output =</span> <span class="st">&quot;character&quot;</span></span>
<span id="cb506-43"><a href="stats_method.html#cb506-43" tabindex="-1"></a>    )</span>
<span id="cb506-44"><a href="stats_method.html#cb506-44" tabindex="-1"></a>    , <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.5</span></span>
<span id="cb506-45"><a href="stats_method.html#cb506-45" tabindex="-1"></a>    , <span class="at">hjust =</span> <span class="dv">1</span></span>
<span id="cb506-46"><a href="stats_method.html#cb506-46" tabindex="-1"></a>    , <span class="at">color =</span> <span class="st">&quot;blue&quot;</span></span>
<span id="cb506-47"><a href="stats_method.html#cb506-47" tabindex="-1"></a>    , <span class="at">size =</span> <span class="dv">4</span></span>
<span id="cb506-48"><a href="stats_method.html#cb506-48" tabindex="-1"></a>    , <span class="at">parse =</span> <span class="cn">TRUE</span></span>
<span id="cb506-49"><a href="stats_method.html#cb506-49" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb506-50"><a href="stats_method.html#cb506-50" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">annotate</span>(</span>
<span id="cb506-51"><a href="stats_method.html#cb506-51" tabindex="-1"></a>    <span class="st">&quot;text&quot;</span></span>
<span id="cb506-52"><a href="stats_method.html#cb506-52" tabindex="-1"></a>    , <span class="at">x =</span> <span class="cn">Inf</span></span>
<span id="cb506-53"><a href="stats_method.html#cb506-53" tabindex="-1"></a>    , <span class="at">y =</span> vol_agg_df_temp<span class="sc">$</span>mean_diff<span class="fl">+1.96</span><span class="sc">*</span>vol_agg_df_temp<span class="sc">$</span>sd_diff</span>
<span id="cb506-54"><a href="stats_method.html#cb506-54" tabindex="-1"></a>    , <span class="at">label =</span> latex2exp<span class="sc">::</span><span class="fu">TeX</span>(</span>
<span id="cb506-55"><a href="stats_method.html#cb506-55" tabindex="-1"></a>      <span class="fu">paste0</span>(</span>
<span id="cb506-56"><a href="stats_method.html#cb506-56" tabindex="-1"></a>        <span class="st">&quot;+1.96 SD: &quot;</span></span>
<span id="cb506-57"><a href="stats_method.html#cb506-57" tabindex="-1"></a>        , scales<span class="sc">::</span><span class="fu">comma</span>(vol_agg_df_temp<span class="sc">$</span>mean_diff<span class="fl">+1.96</span><span class="sc">*</span>vol_agg_df_temp<span class="sc">$</span>sd_diff, <span class="at">accuracy =</span> <span class="fl">0.01</span>)</span>
<span id="cb506-58"><a href="stats_method.html#cb506-58" tabindex="-1"></a>        , <span class="st">&quot; $m^3$&quot;</span></span>
<span id="cb506-59"><a href="stats_method.html#cb506-59" tabindex="-1"></a>      )</span>
<span id="cb506-60"><a href="stats_method.html#cb506-60" tabindex="-1"></a>      , <span class="at">output =</span> <span class="st">&quot;character&quot;</span></span>
<span id="cb506-61"><a href="stats_method.html#cb506-61" tabindex="-1"></a>    )</span>
<span id="cb506-62"><a href="stats_method.html#cb506-62" tabindex="-1"></a>    , <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.5</span></span>
<span id="cb506-63"><a href="stats_method.html#cb506-63" tabindex="-1"></a>    , <span class="at">hjust =</span> <span class="dv">1</span></span>
<span id="cb506-64"><a href="stats_method.html#cb506-64" tabindex="-1"></a>    , <span class="at">color =</span> <span class="st">&quot;red&quot;</span></span>
<span id="cb506-65"><a href="stats_method.html#cb506-65" tabindex="-1"></a>    , <span class="at">size =</span> <span class="dv">4</span></span>
<span id="cb506-66"><a href="stats_method.html#cb506-66" tabindex="-1"></a>    , <span class="at">parse =</span> <span class="cn">TRUE</span></span>
<span id="cb506-67"><a href="stats_method.html#cb506-67" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb506-68"><a href="stats_method.html#cb506-68" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">annotate</span>(</span>
<span id="cb506-69"><a href="stats_method.html#cb506-69" tabindex="-1"></a>    <span class="st">&quot;text&quot;</span></span>
<span id="cb506-70"><a href="stats_method.html#cb506-70" tabindex="-1"></a>    , <span class="at">x =</span> <span class="cn">Inf</span></span>
<span id="cb506-71"><a href="stats_method.html#cb506-71" tabindex="-1"></a>    , <span class="at">y =</span> vol_agg_df_temp<span class="sc">$</span>mean_diff<span class="fl">-1.96</span><span class="sc">*</span>vol_agg_df_temp<span class="sc">$</span>sd_diff</span>
<span id="cb506-72"><a href="stats_method.html#cb506-72" tabindex="-1"></a>    , <span class="at">label =</span> latex2exp<span class="sc">::</span><span class="fu">TeX</span>(</span>
<span id="cb506-73"><a href="stats_method.html#cb506-73" tabindex="-1"></a>      <span class="fu">paste0</span>(</span>
<span id="cb506-74"><a href="stats_method.html#cb506-74" tabindex="-1"></a>        <span class="st">&quot;-1.96 SD: &quot;</span></span>
<span id="cb506-75"><a href="stats_method.html#cb506-75" tabindex="-1"></a>        , scales<span class="sc">::</span><span class="fu">comma</span>(vol_agg_df_temp<span class="sc">$</span>mean_diff<span class="fl">-1.96</span><span class="sc">*</span>vol_agg_df_temp<span class="sc">$</span>sd_diff, <span class="at">accuracy =</span> <span class="fl">0.01</span>)</span>
<span id="cb506-76"><a href="stats_method.html#cb506-76" tabindex="-1"></a>        , <span class="st">&quot; $m^3$&quot;</span></span>
<span id="cb506-77"><a href="stats_method.html#cb506-77" tabindex="-1"></a>      )</span>
<span id="cb506-78"><a href="stats_method.html#cb506-78" tabindex="-1"></a>      , <span class="at">output =</span> <span class="st">&quot;character&quot;</span></span>
<span id="cb506-79"><a href="stats_method.html#cb506-79" tabindex="-1"></a>    )</span>
<span id="cb506-80"><a href="stats_method.html#cb506-80" tabindex="-1"></a>    , <span class="at">vjust =</span> <span class="fl">1.5</span></span>
<span id="cb506-81"><a href="stats_method.html#cb506-81" tabindex="-1"></a>    , <span class="at">hjust =</span> <span class="dv">1</span></span>
<span id="cb506-82"><a href="stats_method.html#cb506-82" tabindex="-1"></a>    , <span class="at">color =</span> <span class="st">&quot;red&quot;</span></span>
<span id="cb506-83"><a href="stats_method.html#cb506-83" tabindex="-1"></a>    , <span class="at">size =</span> <span class="dv">4</span></span>
<span id="cb506-84"><a href="stats_method.html#cb506-84" tabindex="-1"></a>    , <span class="at">parse =</span> <span class="cn">TRUE</span></span>
<span id="cb506-85"><a href="stats_method.html#cb506-85" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb506-86"><a href="stats_method.html#cb506-86" tabindex="-1"></a>  <span class="co"># points</span></span>
<span id="cb506-87"><a href="stats_method.html#cb506-87" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_point</span>(<span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">color =</span> scale_diff), <span class="at">size =</span> <span class="fl">1.9</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb506-88"><a href="stats_method.html#cb506-88" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_color_steps2</span>(<span class="at">mid =</span> <span class="st">&quot;gray&quot;</span>, <span class="at">midpoint =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb506-89"><a href="stats_method.html#cb506-89" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb506-90"><a href="stats_method.html#cb506-90" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">&quot;Bland-Altman plot: allometric field volume vs allometric predicted volume&quot;</span></span>
<span id="cb506-91"><a href="stats_method.html#cb506-91" tabindex="-1"></a>    , <span class="at">x =</span> latex2exp<span class="sc">::</span><span class="fu">TeX</span>(<span class="st">&quot;mean allometric volume ($m^3$)&quot;</span>)</span>
<span id="cb506-92"><a href="stats_method.html#cb506-92" tabindex="-1"></a>    , <span class="at">y =</span> latex2exp<span class="sc">::</span><span class="fu">TeX</span>(<span class="st">&quot;difference (allometric field - allometric predicted volume $m^3$)&quot;</span>)</span>
<span id="cb506-93"><a href="stats_method.html#cb506-93" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb506-94"><a href="stats_method.html#cb506-94" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb506-95"><a href="stats_method.html#cb506-95" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-472-1.png" width="1008" /></p>
<p>That’s a lot of plotting to show that the mean difference is 1.64 m<sup>3</sup>. This is a significant improvement over our comparison between the allometric field value and the irregular, CHM-derived prediction</p>
<p>let’s use a paired t-test to determine if the mean difference (MD) between the allometric field volume and the allometric predicted volume is statistically significant (i.e. significantly different from zero)</p>
<div class="sourceCode" id="cb507"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb507-1"><a href="stats_method.html#cb507-1" tabindex="-1"></a><span class="co"># is the mean difference between the two volumes significantly different from zero</span></span>
<span id="cb507-2"><a href="stats_method.html#cb507-2" tabindex="-1"></a>ttest_temp <span class="ot">&lt;-</span> <span class="fu">t.test</span>(</span>
<span id="cb507-3"><a href="stats_method.html#cb507-3" tabindex="-1"></a>  ground_truth_prediction_match_ans <span class="sc">%&gt;%</span> </span>
<span id="cb507-4"><a href="stats_method.html#cb507-4" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(match_grp <span class="sc">==</span> <span class="st">&quot;true positive&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb507-5"><a href="stats_method.html#cb507-5" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">pull</span>(gt_volume_m3)</span>
<span id="cb507-6"><a href="stats_method.html#cb507-6" tabindex="-1"></a>  , ground_truth_prediction_match_ans <span class="sc">%&gt;%</span> </span>
<span id="cb507-7"><a href="stats_method.html#cb507-7" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(match_grp <span class="sc">==</span> <span class="st">&quot;true positive&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb507-8"><a href="stats_method.html#cb507-8" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">pull</span>(pred_allom_volume_m3)</span>
<span id="cb507-9"><a href="stats_method.html#cb507-9" tabindex="-1"></a>  , <span class="at">paired =</span> <span class="cn">TRUE</span></span>
<span id="cb507-10"><a href="stats_method.html#cb507-10" tabindex="-1"></a>)</span>
<span id="cb507-11"><a href="stats_method.html#cb507-11" tabindex="-1"></a>ttest_temp</span></code></pre></div>
<pre><code>## 
##  Paired t-test
## 
## data:  ground_truth_prediction_match_ans %&gt;% dplyr::filter(match_grp == &quot;true positive&quot;) %&gt;% dplyr::pull(gt_volume_m3) and ground_truth_prediction_match_ans %&gt;% dplyr::filter(match_grp == &quot;true positive&quot;) %&gt;% dplyr::pull(pred_allom_volume_m3)
## t = 1.1504, df = 106, p-value = 0.2526
## alternative hypothesis: true mean difference is not equal to 0
## 95 percent confidence interval:
##  -1.188974  4.475875
## sample estimates:
## mean difference 
##         1.64345</code></pre>
<p>Wow, the p-value of 0.253 is greater than 0.05 (even 0.10), meaning we <em>fail</em> to reject the null hypothesis that the true mean difference is zero. That is, the mean difference between the field-measured volume and the predicted volume is not different than zero when both are forced to use the same paraboloid shape assumption. This contrasts sharply with the previously observed major systematic difference between the allometric field volume and the predicted irregular, CHM-derived volume. The non-significant difference strongly suggests that the major volume discrepancy noted earlier was primarily due to the geometric irregularity of the actual piles, and not to systematic prediction bias in our CHM-derived height and diameter measurements.</p>
</div>
</div>
<div id="stand-level-aggregation" class="section level3 hasAnchor" number="9.5.4">
<h3><span class="header-section-number">9.5.4</span> Stand-level Aggregation<a href="stats_method.html#stand-level-aggregation" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>before we leave, let’s summarize the measurement values of the predictions (true positive and false positive) and the ground truth data (true positive and false negative) over the entire stand (this is similar to a basal area comparison in a forest inventory)</p>
<div class="sourceCode" id="cb509"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb509-1"><a href="stats_method.html#cb509-1" tabindex="-1"></a>sum_df_temp <span class="ot">&lt;-</span></span>
<span id="cb509-2"><a href="stats_method.html#cb509-2" tabindex="-1"></a>  ground_truth_prediction_match_ans <span class="sc">%&gt;%</span> </span>
<span id="cb509-3"><a href="stats_method.html#cb509-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">gt_allom_volume_m3 =</span> gt_volume_m3) <span class="sc">%&gt;%</span> </span>
<span id="cb509-4"><a href="stats_method.html#cb509-4" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb509-5"><a href="stats_method.html#cb509-5" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(pred_id)) <span class="sc">%&gt;%</span> </span>
<span id="cb509-6"><a href="stats_method.html#cb509-6" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(</span>
<span id="cb509-7"><a href="stats_method.html#cb509-7" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">across</span>(</span>
<span id="cb509-8"><a href="stats_method.html#cb509-8" tabindex="-1"></a>      <span class="at">.cols =</span> tidyselect<span class="sc">::</span><span class="fu">starts_with</span>(<span class="st">&quot;gt_&quot;</span>) <span class="sc">|</span> tidyselect<span class="sc">::</span><span class="fu">starts_with</span>(<span class="st">&quot;pred_&quot;</span>)</span>
<span id="cb509-9"><a href="stats_method.html#cb509-9" tabindex="-1"></a>      , <span class="sc">~</span><span class="fu">sum</span>(.x,<span class="at">na.rm=</span>T)</span>
<span id="cb509-10"><a href="stats_method.html#cb509-10" tabindex="-1"></a>    )</span>
<span id="cb509-11"><a href="stats_method.html#cb509-11" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb509-12"><a href="stats_method.html#cb509-12" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(</span>
<span id="cb509-13"><a href="stats_method.html#cb509-13" tabindex="-1"></a>    <span class="at">cols =</span> dplyr<span class="sc">::</span><span class="fu">everything</span>()</span>
<span id="cb509-14"><a href="stats_method.html#cb509-14" tabindex="-1"></a>    , <span class="at">names_to =</span> <span class="st">&quot;metric&quot;</span></span>
<span id="cb509-15"><a href="stats_method.html#cb509-15" tabindex="-1"></a>    , <span class="at">values_to =</span> <span class="st">&quot;value&quot;</span></span>
<span id="cb509-16"><a href="stats_method.html#cb509-16" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb509-17"><a href="stats_method.html#cb509-17" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb509-18"><a href="stats_method.html#cb509-18" tabindex="-1"></a>    <span class="at">which_data =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb509-19"><a href="stats_method.html#cb509-19" tabindex="-1"></a>        stringr<span class="sc">::</span><span class="fu">str_starts</span>(metric,<span class="st">&quot;gt_&quot;</span>) <span class="sc">~</span> <span class="st">&quot;ground truth&quot;</span></span>
<span id="cb509-20"><a href="stats_method.html#cb509-20" tabindex="-1"></a>        , stringr<span class="sc">::</span><span class="fu">str_starts</span>(metric,<span class="st">&quot;pred_&quot;</span>) <span class="sc">~</span> <span class="st">&quot;prediction&quot;</span></span>
<span id="cb509-21"><a href="stats_method.html#cb509-21" tabindex="-1"></a>        , T <span class="sc">~</span> <span class="st">&quot;error&quot;</span></span>
<span id="cb509-22"><a href="stats_method.html#cb509-22" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span> </span>
<span id="cb509-23"><a href="stats_method.html#cb509-23" tabindex="-1"></a>      <span class="fu">ordered</span>()</span>
<span id="cb509-24"><a href="stats_method.html#cb509-24" tabindex="-1"></a>    , <span class="at">pile_metric =</span> metric <span class="sc">%&gt;%</span> </span>
<span id="cb509-25"><a href="stats_method.html#cb509-25" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_remove</span>(<span class="st">&quot;(_rmse|_rrmse|_mean|_mape)$&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb509-26"><a href="stats_method.html#cb509-26" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_extract</span>(<span class="st">&quot;(allom_volume|volume|area|height|diameter)&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb509-27"><a href="stats_method.html#cb509-27" tabindex="-1"></a>      <span class="fu">factor</span>(</span>
<span id="cb509-28"><a href="stats_method.html#cb509-28" tabindex="-1"></a>        <span class="at">ordered =</span> T</span>
<span id="cb509-29"><a href="stats_method.html#cb509-29" tabindex="-1"></a>        , <span class="at">levels =</span> <span class="fu">c</span>(</span>
<span id="cb509-30"><a href="stats_method.html#cb509-30" tabindex="-1"></a>          <span class="st">&quot;height&quot;</span></span>
<span id="cb509-31"><a href="stats_method.html#cb509-31" tabindex="-1"></a>          , <span class="st">&quot;diameter&quot;</span></span>
<span id="cb509-32"><a href="stats_method.html#cb509-32" tabindex="-1"></a>          , <span class="st">&quot;area&quot;</span></span>
<span id="cb509-33"><a href="stats_method.html#cb509-33" tabindex="-1"></a>          , <span class="st">&quot;allom_volume&quot;</span></span>
<span id="cb509-34"><a href="stats_method.html#cb509-34" tabindex="-1"></a>          , <span class="st">&quot;volume&quot;</span></span>
<span id="cb509-35"><a href="stats_method.html#cb509-35" tabindex="-1"></a>        )</span>
<span id="cb509-36"><a href="stats_method.html#cb509-36" tabindex="-1"></a>        , <span class="at">labels =</span> <span class="fu">c</span>(</span>
<span id="cb509-37"><a href="stats_method.html#cb509-37" tabindex="-1"></a>          <span class="st">&quot;Height (m)&quot;</span></span>
<span id="cb509-38"><a href="stats_method.html#cb509-38" tabindex="-1"></a>          , <span class="st">&quot;Diameter (m)&quot;</span></span>
<span id="cb509-39"><a href="stats_method.html#cb509-39" tabindex="-1"></a>          , <span class="st">&quot;Area (m2)&quot;</span></span>
<span id="cb509-40"><a href="stats_method.html#cb509-40" tabindex="-1"></a>          , <span class="st">&quot;Allometric Volume (m3)&quot;</span></span>
<span id="cb509-41"><a href="stats_method.html#cb509-41" tabindex="-1"></a>          , <span class="st">&quot;Irregular Volume (m3)&quot;</span></span>
<span id="cb509-42"><a href="stats_method.html#cb509-42" tabindex="-1"></a>        )</span>
<span id="cb509-43"><a href="stats_method.html#cb509-43" tabindex="-1"></a>      )</span>
<span id="cb509-44"><a href="stats_method.html#cb509-44" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb509-45"><a href="stats_method.html#cb509-45" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(pile_metric) <span class="sc">%&gt;%</span> </span>
<span id="cb509-46"><a href="stats_method.html#cb509-46" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(pile_metric,which_data) <span class="sc">%&gt;%</span> </span>
<span id="cb509-47"><a href="stats_method.html#cb509-47" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb509-48"><a href="stats_method.html#cb509-48" tabindex="-1"></a>    <span class="at">pct_diff =</span> (value<span class="sc">-</span>dplyr<span class="sc">::</span><span class="fu">lag</span>(value))<span class="sc">/</span>dplyr<span class="sc">::</span><span class="fu">lag</span>(value) </span>
<span id="cb509-49"><a href="stats_method.html#cb509-49" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb509-50"><a href="stats_method.html#cb509-50" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>()</span>
<span id="cb509-51"><a href="stats_method.html#cb509-51" tabindex="-1"></a>  <span class="co"># dplyr::filter(pile_metric!=&quot;Irregular Volume (m3)&quot;)</span></span></code></pre></div>
<p>plot</p>
<div class="sourceCode" id="cb510"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb510-1"><a href="stats_method.html#cb510-1" tabindex="-1"></a><span class="co"># plot it</span></span>
<span id="cb510-2"><a href="stats_method.html#cb510-2" tabindex="-1"></a>sum_df_temp <span class="sc">%&gt;%</span> </span>
<span id="cb510-3"><a href="stats_method.html#cb510-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb510-4"><a href="stats_method.html#cb510-4" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb510-5"><a href="stats_method.html#cb510-5" tabindex="-1"></a>    <span class="at">stand_id=</span><span class="dv">1</span></span>
<span id="cb510-6"><a href="stats_method.html#cb510-6" tabindex="-1"></a>    , <span class="at">lab =</span> <span class="fu">paste0</span>(</span>
<span id="cb510-7"><a href="stats_method.html#cb510-7" tabindex="-1"></a>      scales<span class="sc">::</span><span class="fu">comma</span>(value,<span class="at">accuracy=</span><span class="fl">0.1</span>)</span>
<span id="cb510-8"><a href="stats_method.html#cb510-8" tabindex="-1"></a>      , dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb510-9"><a href="stats_method.html#cb510-9" tabindex="-1"></a>        <span class="fu">is.na</span>(pct_diff) <span class="sc">~</span> <span class="st">&quot;&quot;</span></span>
<span id="cb510-10"><a href="stats_method.html#cb510-10" tabindex="-1"></a>        , T <span class="sc">~</span> <span class="fu">paste0</span>(</span>
<span id="cb510-11"><a href="stats_method.html#cb510-11" tabindex="-1"></a>          <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span></span>
<span id="cb510-12"><a href="stats_method.html#cb510-12" tabindex="-1"></a>          , <span class="fu">ifelse</span>(pct_diff<span class="sc">&lt;</span><span class="dv">0</span>,<span class="st">&quot;-&quot;</span>,<span class="st">&quot;+&quot;</span>)</span>
<span id="cb510-13"><a href="stats_method.html#cb510-13" tabindex="-1"></a>          ,scales<span class="sc">::</span><span class="fu">percent</span>(<span class="fu">abs</span>(pct_diff),<span class="at">accuracy=</span><span class="fl">0.1</span>)</span>
<span id="cb510-14"><a href="stats_method.html#cb510-14" tabindex="-1"></a>        )</span>
<span id="cb510-15"><a href="stats_method.html#cb510-15" tabindex="-1"></a>      )</span>
<span id="cb510-16"><a href="stats_method.html#cb510-16" tabindex="-1"></a>    )</span>
<span id="cb510-17"><a href="stats_method.html#cb510-17" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb510-18"><a href="stats_method.html#cb510-18" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(</span>
<span id="cb510-19"><a href="stats_method.html#cb510-19" tabindex="-1"></a>    <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(</span>
<span id="cb510-20"><a href="stats_method.html#cb510-20" tabindex="-1"></a>      <span class="at">x =</span> which_data</span>
<span id="cb510-21"><a href="stats_method.html#cb510-21" tabindex="-1"></a>      , <span class="at">y =</span> value</span>
<span id="cb510-22"><a href="stats_method.html#cb510-22" tabindex="-1"></a>      , <span class="at">label =</span> lab</span>
<span id="cb510-23"><a href="stats_method.html#cb510-23" tabindex="-1"></a>      , <span class="at">group =</span> stand_id</span>
<span id="cb510-24"><a href="stats_method.html#cb510-24" tabindex="-1"></a>    )</span>
<span id="cb510-25"><a href="stats_method.html#cb510-25" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb510-26"><a href="stats_method.html#cb510-26" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_line</span>(<span class="at">key_glyph =</span> <span class="st">&quot;point&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>, <span class="at">color =</span> <span class="st">&quot;gray&quot;</span>, <span class="at">lwd =</span> <span class="fl">1.1</span>) <span class="sc">+</span></span>
<span id="cb510-27"><a href="stats_method.html#cb510-27" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_col</span>(<span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">fill =</span> which_data), <span class="at">alpha =</span> <span class="dv">1</span>, <span class="at">width =</span> <span class="fl">0.4</span>) <span class="sc">+</span></span>
<span id="cb510-28"><a href="stats_method.html#cb510-28" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;blue&quot;</span>,<span class="st">&quot;brown&quot;</span>)) <span class="sc">+</span></span>
<span id="cb510-29"><a href="stats_method.html#cb510-29" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;blue&quot;</span>,<span class="st">&quot;brown&quot;</span>)) <span class="sc">+</span></span>
<span id="cb510-30"><a href="stats_method.html#cb510-30" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_text</span>(</span>
<span id="cb510-31"><a href="stats_method.html#cb510-31" tabindex="-1"></a>    <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.25</span></span>
<span id="cb510-32"><a href="stats_method.html#cb510-32" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb510-33"><a href="stats_method.html#cb510-33" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">facet_wrap</span>(<span class="at">facets =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(pile_metric), <span class="at">scales =</span> <span class="st">&quot;free_y&quot;</span>, <span class="at">axes =</span> <span class="st">&quot;all_x&quot;</span>) <span class="sc">+</span></span>
<span id="cb510-34"><a href="stats_method.html#cb510-34" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>comma, <span class="at">expand =</span> ggplot2<span class="sc">::</span><span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="dv">0</span>,.<span class="dv">3</span>)), <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb510-35"><a href="stats_method.html#cb510-35" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb510-36"><a href="stats_method.html#cb510-36" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;&quot;</span>, <span class="at">y =</span> <span class="st">&quot;&quot;</span></span>
<span id="cb510-37"><a href="stats_method.html#cb510-37" tabindex="-1"></a>    , <span class="at">subtitle =</span> <span class="st">&quot;Comparison of aggregated measurements at the stand level&quot;</span></span>
<span id="cb510-38"><a href="stats_method.html#cb510-38" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb510-39"><a href="stats_method.html#cb510-39" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb510-40"><a href="stats_method.html#cb510-40" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb510-41"><a href="stats_method.html#cb510-41" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb510-42"><a href="stats_method.html#cb510-42" tabindex="-1"></a>    , <span class="at">axis.text.x =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb510-43"><a href="stats_method.html#cb510-43" tabindex="-1"></a>    , <span class="at">strip.text =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb510-44"><a href="stats_method.html#cb510-44" tabindex="-1"></a>    , <span class="at">panel.grid =</span> ggplot2<span class="sc">::</span><span class="fu">element_blank</span>()</span>
<span id="cb510-45"><a href="stats_method.html#cb510-45" tabindex="-1"></a>  ) </span></code></pre></div>
<p><img src="manitou_slash_piles_files/figure-html/unnamed-chunk-475-1.png" width="1008" /></p>
<p>table it</p>
<div class="sourceCode" id="cb511"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb511-1"><a href="stats_method.html#cb511-1" tabindex="-1"></a>sum_df_temp <span class="sc">%&gt;%</span> </span>
<span id="cb511-2"><a href="stats_method.html#cb511-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(pile_metric, which_data, value, pct_diff) <span class="sc">%&gt;%</span> </span>
<span id="cb511-3"><a href="stats_method.html#cb511-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb511-4"><a href="stats_method.html#cb511-4" tabindex="-1"></a>    <span class="at">value =</span> scales<span class="sc">::</span><span class="fu">comma</span>(value,<span class="at">accuracy=</span><span class="fl">0.1</span>)</span>
<span id="cb511-5"><a href="stats_method.html#cb511-5" tabindex="-1"></a>    , <span class="at">pct_diff =</span> scales<span class="sc">::</span><span class="fu">percent</span>(pct_diff,<span class="at">accuracy=</span><span class="fl">0.1</span>)</span>
<span id="cb511-6"><a href="stats_method.html#cb511-6" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb511-7"><a href="stats_method.html#cb511-7" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kbl</span>(</span>
<span id="cb511-8"><a href="stats_method.html#cb511-8" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">&quot;Comparison of aggregated measurements at the stand level&quot;</span></span>
<span id="cb511-9"><a href="stats_method.html#cb511-9" tabindex="-1"></a>    , <span class="at">col.names =</span> <span class="fu">c</span>(</span>
<span id="cb511-10"><a href="stats_method.html#cb511-10" tabindex="-1"></a>      <span class="st">&quot;.&quot;</span>, <span class="st">&quot;measurement source&quot;</span></span>
<span id="cb511-11"><a href="stats_method.html#cb511-11" tabindex="-1"></a>      , <span class="st">&quot;stand-level total&quot;</span>, <span class="st">&quot;% difference&quot;</span></span>
<span id="cb511-12"><a href="stats_method.html#cb511-12" tabindex="-1"></a>    )</span>
<span id="cb511-13"><a href="stats_method.html#cb511-13" tabindex="-1"></a>    , <span class="at">escape =</span> F</span>
<span id="cb511-14"><a href="stats_method.html#cb511-14" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb511-15"><a href="stats_method.html#cb511-15" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kable_styling</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb511-16"><a href="stats_method.html#cb511-16" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">collapse_rows</span>(<span class="at">columns =</span> <span class="dv">1</span>, <span class="at">valign =</span> <span class="st">&quot;top&quot;</span>)</span></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-476">Table 9.34: </span>Comparison of aggregated measurements at the stand level
</caption>
<thead>
<tr>
<th style="text-align:left;">
.
</th>
<th style="text-align:left;">
measurement source
</th>
<th style="text-align:left;">
stand-level total
</th>
<th style="text-align:left;">
% difference
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="2">
Height (m)
</td>
<td style="text-align:left;">
ground truth
</td>
<td style="text-align:left;">
263.7
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
prediction
</td>
<td style="text-align:left;">
263.0
</td>
<td style="text-align:left;">
-0.2%
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="2">
Diameter (m)
</td>
<td style="text-align:left;">
ground truth
</td>
<td style="text-align:left;">
417.1
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
prediction
</td>
<td style="text-align:left;">
486.6
</td>
<td style="text-align:left;">
16.7%
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="2">
Area (m2)
</td>
<td style="text-align:left;">
ground truth
</td>
<td style="text-align:left;">
1,185.5
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
prediction
</td>
<td style="text-align:left;">
1,121.2
</td>
<td style="text-align:left;">
-5.4%
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="2">
Allometric Volume (m3)
</td>
<td style="text-align:left;">
ground truth
</td>
<td style="text-align:left;">
1,813.8
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
prediction
</td>
<td style="text-align:left;">
1,526.9
</td>
<td style="text-align:left;">
-15.8%
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="2">
Irregular Volume (m3)
</td>
<td style="text-align:left;">
ground truth
</td>
<td style="text-align:left;">
1,813.8
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
prediction
</td>
<td style="text-align:left;">
952.5
</td>
<td style="text-align:left;">
-47.5%
</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="chm_sens_test.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="method-validation-pinyon-juniper.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
  "sharing": {
    "github": false,
    "facebook": true,
    "twitter": true,
    "linkedin": false,
    "weibo": false,
    "instapaper": false,
    "vk": false,
    "whatsapp": false,
    "all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
  },
  "fontsettings": {
    "theme": "white",
    "family": "sans",
    "size": 2
  },
  "edit": {
    "link": null,
    "text": null
  },
  "history": {
    "link": null,
    "text": null
  },
  "view": {
    "link": null,
    "text": null
  },
  "download": null,
  "search": {
    "engine": "fuse",
    "options": null
  },
  "toc": {
    "collapse": "subsection"
  }
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
