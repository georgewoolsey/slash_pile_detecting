--- 
title: "Aerial Imagery and Point Cloud Data for Slash Pile Quantification"
author: "George Woolsey"
date: "`r format(Sys.time(), '%d %B, %Y')`"
site: bookdown::bookdown_site
output: 
  bookdown::gitbook:
    includes:
      in_header: header.html
documentclass: book
book_filename: "manitou_slash_piles"
output_dir: "../docs"
language:
  ui:
    chapter_name: "Section "
delete_merged_file: true
bibliography: [packages.bib]
biblio-style: apalike
csl: https://raw.githubusercontent.com/citation-style-language/styles/master/research-institute-for-nature-and-forest.csl
suppress-bibliography: true
lang: en-US
zotero: true
link-citations: true
description: "Using the bookdown package to write a book of data exploration. The output format for this example is bookdown::gitbook."
---

# Introduction

Code in support of "A General Method using UAS Data for Automated Slash Pile Detection and Quantification"

Increasing active forest management activities generate non-commercial residues (slash) that are often aggregated into piles for disposal. However, pile burning is associated with increased operational costs and significant external environmental costs ([Mott et al., 2021](https://doi.org/10.1016/j.foreco.2021.119251); [Barker et al., 2025](https://doi.org/10.3389/ffgc.2024.1496190); [Axlund et al., 2025](https://doi.org/10.1016/j.tfp.2025.101081)), motivating the need for improved quantification and management. While remote sensing techniques using point clouds consistently offer improved pile quantification accuracy over traditional field methods ([Trofymow et al., 2014](https://doi.org/10.1139/cjfr-2013-0281); [Guth et al., 2025](https://doi.org/10.3389/ffgc.2025.1663753)), there is a lack of automated methods for simultaneously detecting and quantifying piles across an broad treatment extents. To overcome this we propose a geometry-based, rules-based framework that leverages the proven success of object segmentation frameworks in CWD (e.g. [dos Santos et al., 2025](https://doi.org/10.3390/rs17040651)) and tree detection (e.g. [Tinkham & Woolsey, 2024](https://doi.org/10.3390/rs16203844)) and offers superior managerial relevance due to its inherent traceability and direct alignment with known pile construction parameters defined in silvicultural prescriptions.

## Objective

The objective of this study is to present a training-free, rules-based methodology for identifying slash piles from UAS data. The presented approach aims to enable high transferability by using user-defined geometric and size thresholds to identify pile candidates from aerial point cloud data, which can then be refined through a data fusion process incorporating spectral (i.e. RGB) data when available.

## Data and Site Descriptions{#data_desc}

We have remote sensing data acquired from a UAS platform and accompanying ground truth data for four different study sites. For all study sites we have:

* Aerial RGB imagery captured by a UAS platform
* Aerial point cloud data generated by processing the UAS imagery using digital aerial photogrammetry (DAP) techniques (specifically, structure from motion [SfM])
* Image-annotated slash pile perimeters digitized in a Geographic Information System (GIS) using field-collected point locations as a guide overlaid on the UAS-collected RGB imagery

For the one study site only we have: 
* Field-collected slash pile point locations with height and diameter measurements

Data from all study sites will be used to validate the slash pile detection methodology. Data from the study site with field-collected pile measurements will be used to test the slash pile quantification accuracies acheived by the proposed methodology. 

The following table provides an overview of the four sites utilized in this study, detailing the unique characteristics of each location and how the data was collected. We structured the validation effort to compare performance across a wide spectrum of data collection platforms, pile sizes, construction methods, and surrounding vegetation types, which required specific parameter adaptations for each site. This summary highlights the distinct ecological and structural challenges inherent to each evaluation site.

| Site Name | Pile Type | Validation Data Type | Unique Features & Ecology | Data Collection (UAS Platform & Parameters) |
| :--- | :--- | :--- | :--- | :--- |
| **PSINF Mixed Conifer Site** | Hand Piles and smaller machine piles | Image-annotated footprints and field-measured height and diameter | Located in the Pike and San Isabel National Forest (PSINF) in CO, US. Mixed conifer stand with variable ground cover and canopy density. | Switchblade-Elite (Vision Aerial) with 24.2 MP RGB sensor (16 mm lens). Altitude xx m, 90% forward and 85% side overlap, 4 m/s speed. |
| **TRFO-BLM Pinyon-Juniper Site** | Hand Piles | Image-annotated footprints based on field collected point locations | Located on BLM land in CO, US. Arid environment with dry vegetation including standing dead pinyon-juniper. Piles are smaller, simpler, and hand-stacked. | Freefly Astro with Sony ILX-LR1 (35mm lens). Altitude 243.84 m (terrain following), 85% forward and 80% side overlap. |
| **BHEF Ponderosa Pine Site** | Machine Piles | Image-annotated footprints | Located in the Black Hills Experimental Forest (BHEF) in SD, US. Piles are massive, mechanically built, and irregularly shaped (e.g. not necessarily circular). Tree regeneration is expected. | DJI Phantom 4 Pro with 20 MP RGB sensor (8.8 mm lens). Altitude 80 m, 90% forward and 85% side overlap, 4 m/s speed. |
| **ARNF Ponderosa Pine Site** | Machine Piles | Image-annotated footprints | Located in the Arapahoe and Roosevelt National Forest (ARNF) in CO, US. Ponderosa pine forest with a climate similar to PSINF. Machine piles are massive but more circular and regular. Less regeneration is expected. | Switchblade-Elite (Vision Aerial) with 24.2 MP RGB sensor (16 mm lens). Altitude xx m, 90% forward and 85% side overlap, 4 m/s speed. |

### Silvicultural Prescriptions

Below, we summarize the silvicultural prescriptions from the study sites with a specific focus on highlighting information on slash pile construction while also providing information on management objectives. 

#### PSINF Mixed Conifer Site

Information is from the silvicultural prescriptions for the "Carroll Lakes Project" (unit 4) administered by the Pikes Peak Ranger District. 

The PSINF site is classified as Ponderosa pine (*Pinus ponderosa*) and dry-mesic mixed conifer, where a "free thin" prescription was implemented across an 8.9 ha (22-acre) treatment unit using a combination of mechanical equipment and hand-thinning. The pre-treatment overstory consisted of Engelmann spruce (*Picea engelmannii*), blue spruce (*Picea pungens*), Ponderosa pine, and Douglas-fir (*Pseudotsuga menziesii*), alongside a quaking aspen (*Populus tremuloides*) component. Management objectives focused on transitioning the forest from mid-closed to more open and complex structural stages by promoting a heterogeneous, "groupy" spatial arrangement. These efforts prioritized the retention of large or old-growth trees and the expansion of aspen to create a landscape capable of supporting natural wildfire and insect disturbance regimes within their historical ranges. 

For the harvesting process, larger trees were whole-tree yarded and skidded to landings for processing with residual waste mechanically piled, while smaller material was hand-piled throughout the site. Additionally, the prescription required the retention of 50 linear feet per acre of downed coarse woody debris (at least 12 inches in diameter) independent of the piled material.

#### TRFO-BLM Pinyon-Juniper Site

Located on Bureau of Land Management (BLM) land in the Colorado Southwest District managed by the Tres Rios Field Office (TRFO-BLM) the treatment was part of a "Pinyon-Juniper Adaptive Silviculture Project" with a uniform thinning treatment prescription. In this heavy intensity uniform thinning treatment unit, the prescription was designed to reduce fuel loads by maintaining significant spacing between residual tree crowns. The prescription prioritizes the retention of healthy, productive, and large-diameter pinyon pine (Pinus edulis) and Rocky Mountain juniper (Juniperus scopulorum) trees. This thinning strategy aims for a residual forest structure characterized by open interspaces with uniform gaps between trees that minimize vertical and horizontal fuel continuity.

Fortunately for the present research, we have the exact, detailed wording of the slash pile construction prescription:

>No less than 90% of all cut trees, live limbs and slash shall be piled. Piles are to be constructed to facilitate burning by the government at a later date. Minimum pile size is 5x5x5 feet. The contractor shall construct piles that are sufficiently compacted to allow for a high percentage of consumption from burning, this may require multiple cutting of stems, compacting the pile with equipment or other approved techniques. Piles should be constructed with branches and smaller diameter fuels piled on bottom and larger limbs/bole wood piled on top. Piles should be spaced appropriately away from leave trees to avoid damage from burning. Anticipate flame lengths twice the piled fuel height when placing piles i.e (5 ft tall pile will have 10 ft flame lengths so pile should be placed at least 10 ft away from the nearest reserve trees). Piles will be constructed in a way to prevent toppling. Piles may be placed on stumps. Oak and other brush cut will need to be added to the piles. Piles shall not be constructed in swales, streams, springs, or within 15 feet any recreational trail within the units. Piles shall not be placed on or near any cadastral survey markers. Piles may not be built under any electrical transmission line or utility line. Piles shall be free of soil.

Site managers also provided anecdotal feedback about the on-the-ground prescription implementation, noting that the piles were "larger than expected" and "messy," and were constructed too close to residual trees. The prescription specified a minimum pile size of 1.5 meters (5 feet) long, wide, and tall, but provided no explicit maximum size. This absence of a maximum size makes the anecdotal feedback particularly relevant for setting up our pile detection methodology. The close proximity of piles to trees, which resulted in tree mortality on other units when piles were burned, may also complicate our detection methodology, as the structural and spectral signatures of the piles and trees may merge in both the CHM and RGB raster data.

#### BHEF Ponderosa Pine Site

The study at the Black Hills Experimental Forest included a series of ponderosa pine (*Pinus ponderosa*) mechanical treatments designed to transition stands from uniform densities to a heterogeneous mosaic of individuals, clumps, and openings. The silvicultural objectives prioritize both horizontal and vertical complexity, using varying tree-marking strategies to recreate historical stand structures and spatial distributions. Five distinct marking approaches were implemented to promote a "groupy" forest structure, ranging from fixed cut-to-leave ratios to a specialized Individuals, Clumps, and Openings (ICO) prescription. Following the marking process, the units were mechanically thinned using whole-tree removal with trees skidded to designated landing areas for processing and all residual material mechanically piled at the landings.

#### ARNF Ponderosa Pine Site

Information is from the silvicultural prescriptions for the "Cherokee Park Project" (units 18, 19) administered by the Canyon Lakes Ranger District. 

The ARNF site is classified as predominantly a Ponderosa pine (*Pinus ponderosa*) and Douglas-fir (*Pseudotsuga menziesii*) forest. Treatment objectives are to restore ecosystems to a state representative of natural disturbance regimes while reducing crown fire risk. The silvicultural prescription, characterized as group selection with retention and variable matrix thinning, aims to create a heterogeneous, multi-aged stand structure defined by irregular openings and clusters of interlocking tree crowns. Mechanical thinning was focused on removing smaller diameter classes and competing Douglas-fir to prioritize the retention of the largest, healthiest, and oldest Ponderosa pine across the treatment area. The desired residual structure is horizontally and vertically diverse where untreated patches and variable tree densities create a complex arrangement of individual trees, clumps, and clearings. During mechanical harvest, trees were whole-tree yarded and skidded to landings for processing with residual waste mechanically piled for future prescribed burning.

## Analysis Plan

We will follow the general analysis outline in five distinct sections:

1. **Data Overview:** We will detail the study sites, summarize the number of piles and the pile size based on available measurements, and review the RGB orthomosaic data
2. **Point Cloud Processing:** We will demonstrate how to process the point cloud data to generate the required inputs for the propose pile detection method.
3. **Geometry-based Slash Pile Detection:** We will detail the geometry-based slash pile detection method which uses user-defined thresholds applied to geometric features from a Canopy Height Model (CHM) derived from UAS-DAP point cloud data.
4. **Spectral Refinement Methodology:** We will detail the complementary spectral refinement methodology which uses RGB data to filter the structurally-detected candidate piles.
5. **Method Evaluation Detail:** We will detail and demonstrate our method evaluation process in which we review detection accuracy metrics (e.g. Precision, Recall, F-Score) and quantification accuracy metrics (e.g. height MAPE, diameter RMSE, etc.)
6. **Experimental Methodology Predictions:** We will make predictions using our proposed training-free, rules-based methodology for identifying slash piles from UAS data with the structural and spectral data fusion approach.
7. **Detection Accuracy:** We will evaluate the accuracy of the structural-plus-spectral data fusion methodology in terms of slash pile detection (F-score, Recall, Precision).
8. **Quantification Accuracy:** We will evaluate the accuracy of the structural-plus-spectral data fusion methodology in terms of slash pile form quantification (e.g. height and diameter MAPE, RMSE, ME).
9. **Sensitivity Analysis:** Finally, we will perform a sensitivity analysis on the key user-defined parameters of the proposed method to systematically quantify the impact of each varied parameter on the stability and performance of the slash pile detection.

```{r, include=FALSE, echo=FALSE}
knitr::write_bib(c(
  .packages(),
  "bookdown"
  , "knitr"
  , "rmarkdown"
  , "tidyverse"
  , "viridis"
  , "RColorBrewer"
  , "scales"
  , "latex2exp"
  , "mapview"
  , "kableExtra"
  , "patchwork"
  , "ggnewscale"
  , "terra"
  , "lwgeom"
  , "sf"
  , "brms"
  , "tidybayes"
  , "rgl"
  , "cloud2trees"
), 'packages.bib')
```

```{r,include=F,eval=FALSE}
# # 1. Get a list of .Rmd files that DO NOT start with "_"
# # Pattern breakdown:
# # ^      = starts at the beginning of the filename
# # [^_]   = first character is NOT an underscore
# # .*     = followed by any number of characters
# # \\.Rmd$ = ends with the .Rmd extension
# rmd_files <- list.files(pattern = "^[^_].*\\.Rmd$", full.names = TRUE)
# 
# # 2. Execute as before
# lapply(rmd_files, function(rmd_file) {
#   temp_r_script <- tempfile(fileext = ".R")
#   knitr::purl(rmd_file, output = temp_r_script, quiet = TRUE, documentation = 0)
#   sys.source(temp_r_script, envir = globalenv())
#   unlink(temp_r_script)
# })
# 
# 1. List .Rmd files, excluding those starting with "_"
rmd_files <- list.files(pattern = "^[^_].*\\.Rmd$", full.names = TRUE)

# 2. Iterate using walk() for side effects
# Uses the ~ shorthand for an anonymous function where .x is each file
purrr::walk(rmd_files, ~ {
  temp_r_script <- tempfile(fileext = ".R")
  
  # Extract code (purl) and execute (sys.source)
  knitr::purl(.x, output = temp_r_script, quiet = TRUE, documentation = 0)
  sys.source(temp_r_script, envir = globalenv())
  
  # Cleanup
  unlink(temp_r_script)
})



```

